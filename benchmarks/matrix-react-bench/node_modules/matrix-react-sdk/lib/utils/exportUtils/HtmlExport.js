"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _Exporter = _interopRequireDefault(require("./Exporter"));

var _Media = require("../../customisations/Media");

var _event = require("matrix-js-sdk/src/models/event");

var _server = require("react-dom/server");

var _Layout = require("../../settings/enums/Layout");

var _MessagePanel = require("../../components/structures/MessagePanel");

var _DateUtils = require("../../DateUtils");

var _Permalinks = require("../permalinks/Permalinks");

var _languageHandler = require("../../languageHandler");

var _event2 = require("matrix-js-sdk/src/@types/event");

var Avatar = _interopRequireWildcard(require("../../Avatar"));

var _EventTile = _interopRequireWildcard(require("../../components/views/rooms/EventTile"));

var _DateSeparator = _interopRequireDefault(require("../../components/views/messages/DateSeparator"));

var _BaseAvatar = _interopRequireDefault(require("../../components/views/avatars/BaseAvatar"));

var _exportJS = _interopRequireDefault(require("!!raw-loader!./exportJS"));

var _MatrixClientContext = _interopRequireDefault(require("../../contexts/MatrixClientContext"));

var _exportCSS = _interopRequireDefault(require("./exportCSS"));

var _TextForEvent = require("../../TextForEvent");

var _logger = require("matrix-js-sdk/src/logger");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class HTMLExporter extends _Exporter.default {
  constructor(room, exportType, exportOptions, setProgressText) {
    super(room, exportType, exportOptions, setProgressText);
    (0, _defineProperty2.default)(this, "avatars", void 0);
    (0, _defineProperty2.default)(this, "permalinkCreator", void 0);
    (0, _defineProperty2.default)(this, "totalSize", void 0);
    (0, _defineProperty2.default)(this, "mediaOmitText", void 0);
    this.avatars = new Map();
    this.permalinkCreator = new _Permalinks.RoomPermalinkCreator(this.room);
    this.totalSize = 0;
    this.mediaOmitText = !this.exportOptions.attachmentsIncluded ? (0, _languageHandler._t)("Media omitted") : (0, _languageHandler._t)("Media omitted - file size limit exceeded");
  }

  async getRoomAvatar() {
    let blob;
    const avatarUrl = Avatar.avatarUrlForRoom(this.room, 32, 32, "crop");
    const avatarPath = "room.png";

    if (avatarUrl) {
      try {
        const image = await fetch(avatarUrl);
        blob = await image.blob();
        this.totalSize += blob.size;
        this.addFile(avatarPath, blob);
      } catch (err) {
        _logger.logger.log("Failed to fetch room's avatar" + err);
      }
    }

    const avatar = /*#__PURE__*/_react.default.createElement(_BaseAvatar.default, {
      width: 32,
      height: 32,
      name: this.room.name,
      title: this.room.name,
      url: blob ? avatarPath : null,
      resizeMethod: "crop"
    });

    return (0, _server.renderToStaticMarkup)(avatar);
  }

  async wrapHTML(content) {
    var _this$room$currentSta, _this$room, _this$room$getMember, _this$room2, _this$room2$getMember, _this$room$currentSta2, _this$room$currentSta3;

    const roomAvatar = await this.getRoomAvatar();
    const exportDate = (0, _DateUtils.formatFullDateNoDayNoTime)(new Date());
    const creator = (_this$room$currentSta = this.room.currentState.getStateEvents(_event2.EventType.RoomCreate, "")) === null || _this$room$currentSta === void 0 ? void 0 : _this$room$currentSta.getSender();
    const creatorName = ((_this$room = this.room) === null || _this$room === void 0 ? void 0 : (_this$room$getMember = _this$room.getMember(creator)) === null || _this$room$getMember === void 0 ? void 0 : _this$room$getMember.rawDisplayName) || creator;
    const exporter = this.client.getUserId();
    const exporterName = (_this$room2 = this.room) === null || _this$room2 === void 0 ? void 0 : (_this$room2$getMember = _this$room2.getMember(exporter)) === null || _this$room2$getMember === void 0 ? void 0 : _this$room2$getMember.rawDisplayName;
    const topic = ((_this$room$currentSta2 = this.room.currentState.getStateEvents(_event2.EventType.RoomTopic, "")) === null || _this$room$currentSta2 === void 0 ? void 0 : (_this$room$currentSta3 = _this$room$currentSta2.getContent()) === null || _this$room$currentSta3 === void 0 ? void 0 : _this$room$currentSta3.topic) || "";
    const createdText = (0, _languageHandler._t)("%(creatorName)s created this room.", {
      creatorName
    });
    const exportedText = (0, _server.renderToStaticMarkup)( /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This is the start of export of <roomName/>. Exported by <exporterDetails/> at %(exportDate)s.", {
      exportDate
    }, {
      roomName: () => /*#__PURE__*/_react.default.createElement("b", null, this.room.name),
      exporterDetails: () => /*#__PURE__*/_react.default.createElement("a", {
        href: `https://matrix.to/#/${exporter}`,
        target: "_blank",
        rel: "noopener noreferrer"
      }, exporterName ? /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("b", null, exporterName), " (" + exporter + ")") : /*#__PURE__*/_react.default.createElement("b", null, exporter))
    })));
    const topicText = topic ? (0, _languageHandler._t)("Topic: %(topic)s", {
      topic
    }) : "";
    return `
          <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8" />
                <meta http-equiv="X-UA-Compatible" content="IE=edge" />
                <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                <link href="css/style.css" rel="stylesheet" />
                <script src="js/script.js"></script>
                <title>Exported Data</title>
            </head>
            <body style="height: 100vh;">
                <section
                id="matrixchat"
                style="height: 100%; overflow: auto"
                class="notranslate"
                >
                <div class="mx_MatrixChat_wrapper" aria-hidden="false">
                    <div class="mx_MatrixChat">
                    <main class="mx_RoomView">
                        <div class="mx_RoomHeader light-panel">
                        <div class="mx_RoomHeader_wrapper" aria-owns="mx_RightPanel">
                            <div class="mx_RoomHeader_avatar">
                            <div class="mx_DecoratedRoomAvatar">
                               ${roomAvatar}
                            </div>
                            </div>
                            <div class="mx_RoomHeader_name">
                            <div
                                dir="auto"
                                class="mx_RoomHeader_nametext"
                                title="${this.room.name}"
                            >
                                ${this.room.name}
                            </div>
                            </div>
                            <div class="mx_RoomHeader_topic" dir="auto"> ${topic} </div>
                        </div>
                        </div>
                        <div class="mx_MainSplit">
                        <div class="mx_RoomView_body">
                            <div
                            class="mx_RoomView_timeline mx_RoomView_timeline_rr_enabled"
                            >
                            <div
                                class="
                                mx_AutoHideScrollbar
                                mx_ScrollPanel
                                mx_RoomView_messagePanel
                                mx_GroupLayout
                                "
                            >
                                <div class="mx_RoomView_messageListWrapper">
                                <ol
                                    class="mx_RoomView_MessageList"
                                    aria-live="polite"
                                    role="list"
                                >
                                <div class="mx_NewRoomIntro">
                                    ${roomAvatar}
                                    <h2> ${this.room.name} </h2>
                                    <p> ${createdText} <br/><br/> ${exportedText} </p>
                                    <br/>
                                    <p> ${topicText} </p>
                                </div>
                                ${content}
                                </ol>
                                </div>
                            </div>
                            </div>
                            <div class="mx_RoomView_statusArea">
                            <div class="mx_RoomView_statusAreaBox">
                                <div class="mx_RoomView_statusAreaBox_line"></div>
                            </div>
                            </div>
                        </div>
                        </div>
                    </main>
                    </div>
                </div>
                </section>
                <div id="snackbar"/>
            </body>
        </html>`;
  }

  getAvatarURL(event) {
    const member = event.sender;
    return member.getMxcAvatarUrl() && (0, _Media.mediaFromMxc)(member.getMxcAvatarUrl()).getThumbnailOfSourceHttp(30, 30, "crop");
  }

  async saveAvatarIfNeeded(event) {
    const member = event.sender;

    if (!this.avatars.has(member.userId)) {
      try {
        const avatarUrl = this.getAvatarURL(event);
        this.avatars.set(member.userId, true);
        const image = await fetch(avatarUrl);
        const blob = await image.blob();
        this.addFile(`users/${member.userId.replace(/:/g, '-')}.png`, blob);
      } catch (err) {
        _logger.logger.log("Failed to fetch user's avatar" + err);
      }
    }
  }

  getDateSeparator(event) {
    const ts = event.getTs();

    const dateSeparator = /*#__PURE__*/_react.default.createElement("li", {
      key: ts
    }, /*#__PURE__*/_react.default.createElement(_DateSeparator.default, {
      forExport: true,
      key: ts,
      ts: ts
    }));

    return (0, _server.renderToStaticMarkup)(dateSeparator);
  }

  needsDateSeparator(event, prevEvent) {
    if (prevEvent == null) return true;
    return (0, _DateUtils.wantsDateSeparator)(prevEvent.getDate(), event.getDate());
  }

  getEventTile(mxEv, continuation) {
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Export_EventWrapper",
      id: mxEv.getId()
    }, /*#__PURE__*/_react.default.createElement(_MatrixClientContext.default.Provider, {
      value: this.client
    }, /*#__PURE__*/_react.default.createElement(_EventTile.default, {
      mxEvent: mxEv,
      continuation: continuation,
      isRedacted: mxEv.isRedacted(),
      replacingEventId: mxEv.replacingEventId(),
      forExport: true,
      readReceipts: null,
      alwaysShowTimestamps: true,
      readReceiptMap: null,
      showUrlPreview: false,
      checkUnmounting: () => false,
      isTwelveHour: false,
      last: false,
      lastInSection: false,
      permalinkCreator: this.permalinkCreator,
      lastSuccessful: false,
      isSelectedEvent: false,
      getRelationsForEvent: null,
      showReactions: false,
      layout: _Layout.Layout.Group,
      enableFlair: false,
      showReadReceipts: false
    })));
  }

  async getEventTileMarkup(mxEv, continuation, filePath) {
    const hasAvatar = !!this.getAvatarURL(mxEv);
    if (hasAvatar) await this.saveAvatarIfNeeded(mxEv);
    const EventTile = this.getEventTile(mxEv, continuation);
    let eventTileMarkup;

    if (mxEv.getContent().msgtype == _event2.MsgType.Emote || mxEv.getContent().msgtype == _event2.MsgType.Notice || mxEv.getContent().msgtype === _event2.MsgType.Text) {
      // to linkify textual events, we'll need lifecycle methods which won't be invoked in renderToString
      // So, we'll have to render the component into a temporary root element
      const tempRoot = document.createElement('div');

      _reactDom.default.render(EventTile, tempRoot);

      eventTileMarkup = tempRoot.innerHTML;
    } else {
      eventTileMarkup = (0, _server.renderToStaticMarkup)(EventTile);
    }

    if (filePath) {
      var _mxEv$getContent$file;

      const mxc = mxEv.getContent().url || ((_mxEv$getContent$file = mxEv.getContent().file) === null || _mxEv$getContent$file === void 0 ? void 0 : _mxEv$getContent$file.url);
      eventTileMarkup = eventTileMarkup.split(mxc).join(filePath);
    }

    eventTileMarkup = eventTileMarkup.replace(/<span class="mx_MFileBody_info_icon".*?>.*?<\/span>/, '');

    if (hasAvatar) {
      eventTileMarkup = eventTileMarkup.replace(encodeURI(this.getAvatarURL(mxEv)).replace(/&/g, '&amp;'), `users/${mxEv.sender.userId.replace(/:/g, "-")}.png`);
    }

    return eventTileMarkup;
  }

  createModifiedEvent(text, mxEv, italic = true) {
    const modifiedContent = {
      msgtype: "m.text",
      body: `${text}`,
      format: "org.matrix.custom.html",
      formatted_body: `${text}`
    };

    if (italic) {
      modifiedContent.formatted_body = '<em>' + modifiedContent.formatted_body + '</em>';
      modifiedContent.body = '*' + modifiedContent.body + '*';
    }

    const modifiedEvent = new _event.MatrixEvent();
    modifiedEvent.event = mxEv.event;
    modifiedEvent.sender = mxEv.sender;
    modifiedEvent.event.type = "m.room.message";
    modifiedEvent.event.content = modifiedContent;
    return modifiedEvent;
  }

  async createMessageBody(mxEv, joined = false) {
    let eventTile;

    try {
      if (this.isAttachment(mxEv)) {
        if (this.exportOptions.attachmentsIncluded) {
          try {
            const blob = await this.getMediaBlob(mxEv);

            if (this.totalSize + blob.size > this.exportOptions.maxSize) {
              eventTile = await this.getEventTileMarkup(this.createModifiedEvent(this.mediaOmitText, mxEv), joined);
            } else {
              this.totalSize += blob.size;
              const filePath = this.getFilePath(mxEv);
              eventTile = await this.getEventTileMarkup(mxEv, joined, filePath);

              if (this.totalSize == this.exportOptions.maxSize) {
                this.exportOptions.attachmentsIncluded = false;
              }

              this.addFile(filePath, blob);
            }
          } catch (e) {
            _logger.logger.log("Error while fetching file" + e);

            eventTile = await this.getEventTileMarkup(this.createModifiedEvent((0, _languageHandler._t)("Error fetching file"), mxEv), joined);
          }
        } else {
          eventTile = await this.getEventTileMarkup(this.createModifiedEvent(this.mediaOmitText, mxEv), joined);
        }
      } else eventTile = await this.getEventTileMarkup(mxEv, joined);
    } catch (e) {
      // TODO: Handle callEvent errors
      _logger.logger.error(e);

      eventTile = await this.getEventTileMarkup(this.createModifiedEvent((0, _TextForEvent.textForEvent)(mxEv), mxEv, false), joined);
    }

    return eventTile;
  }

  async createHTML(events, start) {
    let content = "";
    let prevEvent = null;

    for (let i = start; i < Math.min(start + 1000, events.length); i++) {
      const event = events[i];
      this.updateProgress(`Processing event ${i + 1} out of ${events.length}`, false, true);
      if (this.cancelled) return this.cleanUp();
      if (!(0, _EventTile.haveTileForEvent)(event)) continue;
      content += this.needsDateSeparator(event, prevEvent) ? this.getDateSeparator(event) : "";
      const shouldBeJoined = !this.needsDateSeparator(event, prevEvent) && (0, _MessagePanel.shouldFormContinuation)(prevEvent, event, false);
      const body = await this.createMessageBody(event, shouldBeJoined);
      this.totalSize += Buffer.byteLength(body);
      content += body;
      prevEvent = event;
    }

    return await this.wrapHTML(content);
  }

  async export() {
    this.updateProgress("Starting export...");
    const fetchStart = performance.now();
    const res = await this.getRequiredEvents();
    const fetchEnd = performance.now();
    this.updateProgress(`Fetched ${res.length} events in ${(fetchEnd - fetchStart) / 1000}s`, true, false);
    this.updateProgress("Creating HTML...");

    for (let page = 0; page < res.length / 1000; page++) {
      const html = await this.createHTML(res, page * 1000);
      this.addFile(`messages${page ? page + 1 : ""}.html`, new Blob([html]));
    }

    const exportCSS = await (0, _exportCSS.default)();
    this.addFile("css/style.css", new Blob([exportCSS]));
    this.addFile("js/script.js", new Blob([_exportJS.default]));
    await this.downloadZIP();
    const exportEnd = performance.now();

    if (this.cancelled) {
      _logger.logger.info("Export cancelled successfully");
    } else {
      this.updateProgress("Export successful!");
      this.updateProgress(`Exported ${res.length} events in ${(exportEnd - fetchStart) / 1000} seconds`);
    }

    this.cleanUp();
  }

}

exports.default = HTMLExporter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9leHBvcnRVdGlscy9IdG1sRXhwb3J0LnRzeCJdLCJuYW1lcyI6WyJIVE1MRXhwb3J0ZXIiLCJFeHBvcnRlciIsImNvbnN0cnVjdG9yIiwicm9vbSIsImV4cG9ydFR5cGUiLCJleHBvcnRPcHRpb25zIiwic2V0UHJvZ3Jlc3NUZXh0IiwiYXZhdGFycyIsIk1hcCIsInBlcm1hbGlua0NyZWF0b3IiLCJSb29tUGVybWFsaW5rQ3JlYXRvciIsInRvdGFsU2l6ZSIsIm1lZGlhT21pdFRleHQiLCJhdHRhY2htZW50c0luY2x1ZGVkIiwiZ2V0Um9vbUF2YXRhciIsImJsb2IiLCJhdmF0YXJVcmwiLCJBdmF0YXIiLCJhdmF0YXJVcmxGb3JSb29tIiwiYXZhdGFyUGF0aCIsImltYWdlIiwiZmV0Y2giLCJzaXplIiwiYWRkRmlsZSIsImVyciIsImxvZ2dlciIsImxvZyIsImF2YXRhciIsIm5hbWUiLCJ3cmFwSFRNTCIsImNvbnRlbnQiLCJyb29tQXZhdGFyIiwiZXhwb3J0RGF0ZSIsIkRhdGUiLCJjcmVhdG9yIiwiY3VycmVudFN0YXRlIiwiZ2V0U3RhdGVFdmVudHMiLCJFdmVudFR5cGUiLCJSb29tQ3JlYXRlIiwiZ2V0U2VuZGVyIiwiY3JlYXRvck5hbWUiLCJnZXRNZW1iZXIiLCJyYXdEaXNwbGF5TmFtZSIsImV4cG9ydGVyIiwiY2xpZW50IiwiZ2V0VXNlcklkIiwiZXhwb3J0ZXJOYW1lIiwidG9waWMiLCJSb29tVG9waWMiLCJnZXRDb250ZW50IiwiY3JlYXRlZFRleHQiLCJleHBvcnRlZFRleHQiLCJyb29tTmFtZSIsImV4cG9ydGVyRGV0YWlscyIsInRvcGljVGV4dCIsImdldEF2YXRhclVSTCIsImV2ZW50IiwibWVtYmVyIiwic2VuZGVyIiwiZ2V0TXhjQXZhdGFyVXJsIiwiZ2V0VGh1bWJuYWlsT2ZTb3VyY2VIdHRwIiwic2F2ZUF2YXRhcklmTmVlZGVkIiwiaGFzIiwidXNlcklkIiwic2V0IiwicmVwbGFjZSIsImdldERhdGVTZXBhcmF0b3IiLCJ0cyIsImdldFRzIiwiZGF0ZVNlcGFyYXRvciIsIm5lZWRzRGF0ZVNlcGFyYXRvciIsInByZXZFdmVudCIsImdldERhdGUiLCJnZXRFdmVudFRpbGUiLCJteEV2IiwiY29udGludWF0aW9uIiwiZ2V0SWQiLCJpc1JlZGFjdGVkIiwicmVwbGFjaW5nRXZlbnRJZCIsIkxheW91dCIsIkdyb3VwIiwiZ2V0RXZlbnRUaWxlTWFya3VwIiwiZmlsZVBhdGgiLCJoYXNBdmF0YXIiLCJFdmVudFRpbGUiLCJldmVudFRpbGVNYXJrdXAiLCJtc2d0eXBlIiwiTXNnVHlwZSIsIkVtb3RlIiwiTm90aWNlIiwiVGV4dCIsInRlbXBSb290IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiUmVhY3RET00iLCJyZW5kZXIiLCJpbm5lckhUTUwiLCJteGMiLCJ1cmwiLCJmaWxlIiwic3BsaXQiLCJqb2luIiwiZW5jb2RlVVJJIiwiY3JlYXRlTW9kaWZpZWRFdmVudCIsInRleHQiLCJpdGFsaWMiLCJtb2RpZmllZENvbnRlbnQiLCJib2R5IiwiZm9ybWF0IiwiZm9ybWF0dGVkX2JvZHkiLCJtb2RpZmllZEV2ZW50IiwiTWF0cml4RXZlbnQiLCJ0eXBlIiwiY3JlYXRlTWVzc2FnZUJvZHkiLCJqb2luZWQiLCJldmVudFRpbGUiLCJpc0F0dGFjaG1lbnQiLCJnZXRNZWRpYUJsb2IiLCJtYXhTaXplIiwiZ2V0RmlsZVBhdGgiLCJlIiwiZXJyb3IiLCJjcmVhdGVIVE1MIiwiZXZlbnRzIiwic3RhcnQiLCJpIiwiTWF0aCIsIm1pbiIsImxlbmd0aCIsInVwZGF0ZVByb2dyZXNzIiwiY2FuY2VsbGVkIiwiY2xlYW5VcCIsInNob3VsZEJlSm9pbmVkIiwiQnVmZmVyIiwiYnl0ZUxlbmd0aCIsImV4cG9ydCIsImZldGNoU3RhcnQiLCJwZXJmb3JtYW5jZSIsIm5vdyIsInJlcyIsImdldFJlcXVpcmVkRXZlbnRzIiwiZmV0Y2hFbmQiLCJwYWdlIiwiaHRtbCIsIkJsb2IiLCJleHBvcnRDU1MiLCJleHBvcnRK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b3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBSZWFjdERPTSBmcm9tIFwicmVhY3QtZG9tXCI7XG5pbXBvcnQgRXhwb3J0ZXIgZnJvbSBcIi4vRXhwb3J0ZXJcIjtcbmltcG9ydCB7IG1lZGlhRnJvbU14YyB9IGZyb20gXCIuLi8uLi9jdXN0b21pc2F0aW9ucy9NZWRpYVwiO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuaW1wb3J0IHsgTWF0cml4RXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50XCI7XG5pbXBvcnQgeyByZW5kZXJUb1N0YXRpY01hcmt1cCB9IGZyb20gXCJyZWFjdC1kb20vc2VydmVyXCI7XG5pbXBvcnQgeyBMYXlvdXQgfSBmcm9tIFwiLi4vLi4vc2V0dGluZ3MvZW51bXMvTGF5b3V0XCI7XG5pbXBvcnQgeyBzaG91bGRGb3JtQ29udGludWF0aW9uIH0gZnJvbSBcIi4uLy4uL2NvbXBvbmVudHMvc3RydWN0dXJlcy9NZXNzYWdlUGFuZWxcIjtcbmltcG9ydCB7IGZvcm1hdEZ1bGxEYXRlTm9EYXlOb1RpbWUsIHdhbnRzRGF0ZVNlcGFyYXRvciB9IGZyb20gXCIuLi8uLi9EYXRlVXRpbHNcIjtcbmltcG9ydCB7IFJvb21QZXJtYWxpbmtDcmVhdG9yIH0gZnJvbSBcIi4uL3Blcm1hbGlua3MvUGVybWFsaW5rc1wiO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgeyBFdmVudFR5cGUsIE1zZ1R5cGUgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvQHR5cGVzL2V2ZW50XCI7XG5pbXBvcnQgKiBhcyBBdmF0YXIgZnJvbSBcIi4uLy4uL0F2YXRhclwiO1xuaW1wb3J0IEV2ZW50VGlsZSwgeyBoYXZlVGlsZUZvckV2ZW50IH0gZnJvbSBcIi4uLy4uL2NvbXBvbmVudHMvdmlld3Mvcm9vbXMvRXZlbnRUaWxlXCI7XG5pbXBvcnQgRGF0ZVNlcGFyYXRvciBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy92aWV3cy9tZXNzYWdlcy9EYXRlU2VwYXJhdG9yXCI7XG5pbXBvcnQgQmFzZUF2YXRhciBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy92aWV3cy9hdmF0YXJzL0Jhc2VBdmF0YXJcIjtcbmltcG9ydCBleHBvcnRKUyBmcm9tIFwiISFyYXctbG9hZGVyIS4vZXhwb3J0SlNcIjtcbmltcG9ydCB7IEV4cG9ydFR5cGUgfSBmcm9tIFwiLi9leHBvcnRVdGlsc1wiO1xuaW1wb3J0IHsgSUV4cG9ydE9wdGlvbnMgfSBmcm9tIFwiLi9leHBvcnRVdGlsc1wiO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCBnZXRFeHBvcnRDU1MgZnJvbSBcIi4vZXhwb3J0Q1NTXCI7XG5pbXBvcnQgeyB0ZXh0Rm9yRXZlbnQgfSBmcm9tIFwiLi4vLi4vVGV4dEZvckV2ZW50XCI7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSFRNTEV4cG9ydGVyIGV4dGVuZHMgRXhwb3J0ZXIge1xuICAgIHByb3RlY3RlZCBhdmF0YXJzOiBNYXA8c3RyaW5nLCBib29sZWFuPjtcbiAgICBwcm90ZWN0ZWQgcGVybWFsaW5rQ3JlYXRvcjogUm9vbVBlcm1hbGlua0NyZWF0b3I7XG4gICAgcHJvdGVjdGVkIHRvdGFsU2l6ZTogbnVtYmVyO1xuICAgIHByb3RlY3RlZCBtZWRpYU9taXRUZXh0OiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcm9vbTogUm9vbSxcbiAgICAgICAgZXhwb3J0VHlwZTogRXhwb3J0VHlwZSxcbiAgICAgICAgZXhwb3J0T3B0aW9uczogSUV4cG9ydE9wdGlvbnMsXG4gICAgICAgIHNldFByb2dyZXNzVGV4dDogUmVhY3QuRGlzcGF0Y2g8UmVhY3QuU2V0U3RhdGVBY3Rpb248c3RyaW5nPj4sXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKHJvb20sIGV4cG9ydFR5cGUsIGV4cG9ydE9wdGlvbnMsIHNldFByb2dyZXNzVGV4dCk7XG4gICAgICAgIHRoaXMuYXZhdGFycyA9IG5ldyBNYXA8c3RyaW5nLCBib29sZWFuPigpO1xuICAgICAgICB0aGlzLnBlcm1hbGlua0NyZWF0b3IgPSBuZXcgUm9vbVBlcm1hbGlua0NyZWF0b3IodGhpcy5yb29tKTtcbiAgICAgICAgdGhpcy50b3RhbFNpemUgPSAwO1xuICAgICAgICB0aGlzLm1lZGlhT21pdFRleHQgPSAhdGhpcy5leHBvcnRPcHRpb25zLmF0dGFjaG1lbnRzSW5jbHVkZWRcbiAgICAgICAgICAgID8gX3QoXCJNZWRpYSBvbWl0dGVkXCIpXG4gICAgICAgICAgICA6IF90KFwiTWVkaWEgb21pdHRlZCAtIGZpbGUgc2l6ZSBsaW1pdCBleGNlZWRlZFwiKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgZ2V0Um9vbUF2YXRhcigpIHtcbiAgICAgICAgbGV0IGJsb2I6IEJsb2I7XG4gICAgICAgIGNvbnN0IGF2YXRhclVybCA9IEF2YXRhci5hdmF0YXJVcmxGb3JSb29tKHRoaXMucm9vbSwgMzIsIDMyLCBcImNyb3BcIik7XG4gICAgICAgIGNvbnN0IGF2YXRhclBhdGggPSBcInJvb20ucG5nXCI7XG4gICAgICAgIGlmIChhdmF0YXJVcmwpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW1hZ2UgPSBhd2FpdCBmZXRjaChhdmF0YXJVcmwpO1xuICAgICAgICAgICAgICAgIGJsb2IgPSBhd2FpdCBpbWFnZS5ibG9iKCk7XG4gICAgICAgICAgICAgICAgdGhpcy50b3RhbFNpemUgKz0gYmxvYi5zaXplO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkRmlsZShhdmF0YXJQYXRoLCBibG9iKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coXCJGYWlsZWQgdG8gZmV0Y2ggcm9vbSdzIGF2YXRhclwiICsgZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhdmF0YXIgPSAoXG4gICAgICAgICAgICA8QmFzZUF2YXRhclxuICAgICAgICAgICAgICAgIHdpZHRoPXszMn1cbiAgICAgICAgICAgICAgICBoZWlnaHQ9ezMyfVxuICAgICAgICAgICAgICAgIG5hbWU9e3RoaXMucm9vbS5uYW1lfVxuICAgICAgICAgICAgICAgIHRpdGxlPXt0aGlzLnJvb20ubmFtZX1cbiAgICAgICAgICAgICAgICB1cmw9e2Jsb2IgPyBhdmF0YXJQYXRoIDogbnVsbH1cbiAgICAgICAgICAgICAgICByZXNpemVNZXRob2Q9XCJjcm9wXCJcbiAgICAgICAgICAgIC8+XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiByZW5kZXJUb1N0YXRpY01hcmt1cChhdmF0YXIpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBhc3luYyB3cmFwSFRNTChjb250ZW50OiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgcm9vbUF2YXRhciA9IGF3YWl0IHRoaXMuZ2V0Um9vbUF2YXRhcigpO1xuICAgICAgICBjb25zdCBleHBvcnREYXRlID0gZm9ybWF0RnVsbERhdGVOb0RheU5vVGltZShuZXcgRGF0ZSgpKTtcbiAgICAgICAgY29uc3QgY3JlYXRvciA9IHRoaXMucm9vbS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoRXZlbnRUeXBlLlJvb21DcmVhdGUsIFwiXCIpPy5nZXRTZW5kZXIoKTtcbiAgICAgICAgY29uc3QgY3JlYXRvck5hbWUgPSB0aGlzLnJvb20/LmdldE1lbWJlcihjcmVhdG9yKT8ucmF3RGlzcGxheU5hbWUgfHwgY3JlYXRvcjtcbiAgICAgICAgY29uc3QgZXhwb3J0ZXIgPSB0aGlzLmNsaWVudC5nZXRVc2VySWQoKTtcbiAgICAgICAgY29uc3QgZXhwb3J0ZXJOYW1lID0gdGhpcy5yb29tPy5nZXRNZW1iZXIoZXhwb3J0ZXIpPy5yYXdEaXNwbGF5TmFtZTtcbiAgICAgICAgY29uc3QgdG9waWMgPSB0aGlzLnJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKEV2ZW50VHlwZS5Sb29tVG9waWMsIFwiXCIpPy5nZXRDb250ZW50KCk/LnRvcGljIHx8IFwiXCI7XG4gICAgICAgIGNvbnN0IGNyZWF0ZWRUZXh0ID0gX3QoXCIlKGNyZWF0b3JOYW1lKXMgY3JlYXRlZCB0aGlzIHJvb20uXCIsIHtcbiAgICAgICAgICAgIGNyZWF0b3JOYW1lLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBleHBvcnRlZFRleHQgPSByZW5kZXJUb1N0YXRpY01hcmt1cChcbiAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiVGhpcyBpcyB0aGUgc3RhcnQgb2YgZXhwb3J0IG9mIDxyb29tTmFtZS8+LiBFeHBvcnRlZCBieSA8ZXhwb3J0ZXJEZXRhaWxzLz4gYXQgJShleHBvcnREYXRlKXMuXCIsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydERhdGUsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb21OYW1lOiAoKSA9PiA8Yj57IHRoaXMucm9vbS5uYW1lIH08L2I+LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3J0ZXJEZXRhaWxzOiAoKSA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJlZj17YGh0dHBzOi8vbWF0cml4LnRvLyMvJHtleHBvcnRlcn1gfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ9XCJfYmxhbmtcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWw9XCJub29wZW5lciBub3JlZmVycmVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgZXhwb3J0ZXJOYW1lID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Yj57IGV4cG9ydGVyTmFtZSB9PC9iPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgXCIgKFwiICsgZXhwb3J0ZXIgKyBcIilcIiB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxiPnsgZXhwb3J0ZXIgfTwvYj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgIDwvcD4sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgdG9waWNUZXh0ID0gdG9waWMgPyBfdChcIlRvcGljOiAlKHRvcGljKXNcIiwgeyB0b3BpYyB9KSA6IFwiXCI7XG5cbiAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICA8IURPQ1RZUEUgaHRtbD5cbiAgICAgICAgICAgIDxodG1sIGxhbmc9XCJlblwiPlxuICAgICAgICAgICAgPGhlYWQ+XG4gICAgICAgICAgICAgICAgPG1ldGEgY2hhcnNldD1cIlVURi04XCIgLz5cbiAgICAgICAgICAgICAgICA8bWV0YSBodHRwLWVxdWl2PVwiWC1VQS1Db21wYXRpYmxlXCIgY29udGVudD1cIklFPWVkZ2VcIiAvPlxuICAgICAgICAgICAgICAgIDxtZXRhIG5hbWU9XCJ2aWV3cG9ydFwiIGNvbnRlbnQ9XCJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wXCIgLz5cbiAgICAgICAgICAgICAgICA8bGluayBocmVmPVwiY3NzL3N0eWxlLmNzc1wiIHJlbD1cInN0eWxlc2hlZXRcIiAvPlxuICAgICAgICAgICAgICAgIDxzY3JpcHQgc3JjPVwianMvc2NyaXB0LmpzXCI+PC9zY3JpcHQ+XG4gICAgICAgICAgICAgICAgPHRpdGxlPkV4cG9ydGVkIERhdGE8L3RpdGxlPlxuICAgICAgICAgICAgPC9oZWFkPlxuICAgICAgICAgICAgPGJvZHkgc3R5bGU9XCJoZWlnaHQ6IDEwMHZoO1wiPlxuICAgICAgICAgICAgICAgIDxzZWN0aW9uXG4gICAgICAgICAgICAgICAgaWQ9XCJtYXRyaXhjaGF0XCJcbiAgICAgICAgICAgICAgICBzdHlsZT1cImhlaWdodDogMTAwJTsgb3ZlcmZsb3c6IGF1dG9cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwibm90cmFuc2xhdGVcIlxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfTWF0cml4Q2hhdF93cmFwcGVyXCIgYXJpYS1oaWRkZW49XCJmYWxzZVwiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfTWF0cml4Q2hhdFwiPlxuICAgICAgICAgICAgICAgICAgICA8bWFpbiBjbGFzcz1cIm14X1Jvb21WaWV3XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfUm9vbUhlYWRlciBsaWdodC1wYW5lbFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm14X1Jvb21IZWFkZXJfd3JhcHBlclwiIGFyaWEtb3ducz1cIm14X1JpZ2h0UGFuZWxcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfUm9vbUhlYWRlcl9hdmF0YXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfRGVjb3JhdGVkUm9vbUF2YXRhclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cm9vbUF2YXRhcn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfUm9vbUhlYWRlcl9uYW1lXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXI9XCJhdXRvXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJteF9Sb29tSGVhZGVyX25hbWV0ZXh0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9XCIke3RoaXMucm9vbS5uYW1lfVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3RoaXMucm9vbS5uYW1lfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJteF9Sb29tSGVhZGVyX3RvcGljXCIgZGlyPVwiYXV0b1wiPiAke3RvcGljfSA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfTWFpblNwbGl0XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfUm9vbVZpZXdfYm9keVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cIm14X1Jvb21WaWV3X3RpbWVsaW5lIG14X1Jvb21WaWV3X3RpbWVsaW5lX3JyX2VuYWJsZWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG14X0F1dG9IaWRlU2Nyb2xsYmFyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG14X1Njcm9sbFBhbmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG14X1Jvb21WaWV3X21lc3NhZ2VQYW5lbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteF9Hcm91cExheW91dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm14X1Jvb21WaWV3X21lc3NhZ2VMaXN0V3JhcHBlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b2xcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwibXhfUm9vbVZpZXdfTWVzc2FnZUxpc3RcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS1saXZlPVwicG9saXRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU9XCJsaXN0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfTmV3Um9vbUludHJvXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3Jvb21BdmF0YXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDI+ICR7dGhpcy5yb29tLm5hbWV9IDwvaDI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD4gJHtjcmVhdGVkVGV4dH0gPGJyLz48YnIvPiAke2V4cG9ydGVkVGV4dH0gPC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPiAke3RvcGljVGV4dH0gPC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtjb250ZW50fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L29sPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXhfUm9vbVZpZXdfc3RhdHVzQXJlYVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJteF9Sb29tVmlld19zdGF0dXNBcmVhQm94XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJteF9Sb29tVmlld19zdGF0dXNBcmVhQm94X2xpbmVcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvbWFpbj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9zZWN0aW9uPlxuICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJzbmFja2JhclwiLz5cbiAgICAgICAgICAgIDwvYm9keT5cbiAgICAgICAgPC9odG1sPmA7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldEF2YXRhclVSTChldmVudDogTWF0cml4RXZlbnQpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBtZW1iZXIgPSBldmVudC5zZW5kZXI7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBtZW1iZXIuZ2V0TXhjQXZhdGFyVXJsKCkgJiZcbiAgICAgICAgICAgIG1lZGlhRnJvbU14YyhtZW1iZXIuZ2V0TXhjQXZhdGFyVXJsKCkpLmdldFRodW1ibmFpbE9mU291cmNlSHR0cChcbiAgICAgICAgICAgICAgICAzMCxcbiAgICAgICAgICAgICAgICAzMCxcbiAgICAgICAgICAgICAgICBcImNyb3BcIixcbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgc2F2ZUF2YXRhcklmTmVlZGVkKGV2ZW50OiBNYXRyaXhFdmVudCkge1xuICAgICAgICBjb25zdCBtZW1iZXIgPSBldmVudC5zZW5kZXI7XG4gICAgICAgIGlmICghdGhpcy5hdmF0YXJzLmhhcyhtZW1iZXIudXNlcklkKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdmF0YXJVcmwgPSB0aGlzLmdldEF2YXRhclVSTChldmVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hdmF0YXJzLnNldChtZW1iZXIudXNlcklkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZSA9IGF3YWl0IGZldGNoKGF2YXRhclVybCk7XG4gICAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IGltYWdlLmJsb2IoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEZpbGUoYHVzZXJzLyR7bWVtYmVyLnVzZXJJZC5yZXBsYWNlKC86L2csICctJyl9LnBuZ2AsIGJsb2IpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIkZhaWxlZCB0byBmZXRjaCB1c2VyJ3MgYXZhdGFyXCIgKyBlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldERhdGVTZXBhcmF0b3IoZXZlbnQ6IE1hdHJpeEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHRzID0gZXZlbnQuZ2V0VHMoKTtcbiAgICAgICAgY29uc3QgZGF0ZVNlcGFyYXRvciA9IDxsaSBrZXk9e3RzfT48RGF0ZVNlcGFyYXRvciBmb3JFeHBvcnQ9e3RydWV9IGtleT17dHN9IHRzPXt0c30gLz48L2xpPjtcbiAgICAgICAgcmV0dXJuIHJlbmRlclRvU3RhdGljTWFya3VwKGRhdGVTZXBhcmF0b3IpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBuZWVkc0RhdGVTZXBhcmF0b3IoZXZlbnQ6IE1hdHJpeEV2ZW50LCBwcmV2RXZlbnQ6IE1hdHJpeEV2ZW50KSB7XG4gICAgICAgIGlmIChwcmV2RXZlbnQgPT0gbnVsbCkgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiB3YW50c0RhdGVTZXBhcmF0b3IocHJldkV2ZW50LmdldERhdGUoKSwgZXZlbnQuZ2V0RGF0ZSgpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RXZlbnRUaWxlKG14RXY6IE1hdHJpeEV2ZW50LCBjb250aW51YXRpb246IGJvb2xlYW4pIHtcbiAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfRXhwb3J0X0V2ZW50V3JhcHBlclwiIGlkPXtteEV2LmdldElkKCl9PlxuICAgICAgICAgICAgPE1hdHJpeENsaWVudENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3RoaXMuY2xpZW50fT5cbiAgICAgICAgICAgICAgICA8RXZlbnRUaWxlXG4gICAgICAgICAgICAgICAgICAgIG14RXZlbnQ9e214RXZ9XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVhdGlvbj17Y29udGludWF0aW9ufVxuICAgICAgICAgICAgICAgICAgICBpc1JlZGFjdGVkPXtteEV2LmlzUmVkYWN0ZWQoKX1cbiAgICAgICAgICAgICAgICAgICAgcmVwbGFjaW5nRXZlbnRJZD17bXhFdi5yZXBsYWNpbmdFdmVudElkKCl9XG4gICAgICAgICAgICAgICAgICAgIGZvckV4cG9ydD17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgcmVhZFJlY2VpcHRzPXtudWxsfVxuICAgICAgICAgICAgICAgICAgICBhbHdheXNTaG93VGltZXN0YW1wcz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgcmVhZFJlY2VpcHRNYXA9e251bGx9XG4gICAgICAgICAgICAgICAgICAgIHNob3dVcmxQcmV2aWV3PXtmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgY2hlY2tVbm1vdW50aW5nPXsoKSA9PiBmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgaXNUd2VsdmVIb3VyPXtmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgbGFzdD17ZmFsc2V9XG4gICAgICAgICAgICAgICAgICAgIGxhc3RJblNlY3Rpb249e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICBwZXJtYWxpbmtDcmVhdG9yPXt0aGlzLnBlcm1hbGlua0NyZWF0b3J9XG4gICAgICAgICAgICAgICAgICAgIGxhc3RTdWNjZXNzZnVsPXtmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZEV2ZW50PXtmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgZ2V0UmVsYXRpb25zRm9yRXZlbnQ9e251bGx9XG4gICAgICAgICAgICAgICAgICAgIHNob3dSZWFjdGlvbnM9e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICBsYXlvdXQ9e0xheW91dC5Hcm91cH1cbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlRmxhaXI9e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICBzaG93UmVhZFJlY2VpcHRzPXtmYWxzZX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9NYXRyaXhDbGllbnRDb250ZXh0LlByb3ZpZGVyPlxuICAgICAgICA8L2Rpdj47XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIGdldEV2ZW50VGlsZU1hcmt1cChteEV2OiBNYXRyaXhFdmVudCwgY29udGludWF0aW9uOiBib29sZWFuLCBmaWxlUGF0aD86IHN0cmluZykge1xuICAgICAgICBjb25zdCBoYXNBdmF0YXIgPSAhIXRoaXMuZ2V0QXZhdGFyVVJMKG14RXYpO1xuICAgICAgICBpZiAoaGFzQXZhdGFyKSBhd2FpdCB0aGlzLnNhdmVBdmF0YXJJZk5lZWRlZChteEV2KTtcbiAgICAgICAgY29uc3QgRXZlbnRUaWxlID0gdGhpcy5nZXRFdmVudFRpbGUobXhFdiwgY29udGludWF0aW9uKTtcbiAgICAgICAgbGV0IGV2ZW50VGlsZU1hcmt1cDogc3RyaW5nO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIG14RXYuZ2V0Q29udGVudCgpLm1zZ3R5cGUgPT0gTXNnVHlwZS5FbW90ZSB8fFxuICAgICAgICAgICAgbXhFdi5nZXRDb250ZW50KCkubXNndHlwZSA9PSBNc2dUeXBlLk5vdGljZSB8fFxuICAgICAgICAgICAgbXhFdi5nZXRDb250ZW50KCkubXNndHlwZSA9PT0gTXNnVHlwZS5UZXh0XG4gICAgICAgICkge1xuICAgICAgICAgICAgLy8gdG8gbGlua2lmeSB0ZXh0dWFsIGV2ZW50cywgd2UnbGwgbmVlZCBsaWZlY3ljbGUgbWV0aG9kcyB3aGljaCB3b24ndCBiZSBpbnZva2VkIGluIHJlbmRlclRvU3RyaW5nXG4gICAgICAgICAgICAvLyBTbywgd2UnbGwgaGF2ZSB0byByZW5kZXIgdGhlIGNvbXBvbmVudCBpbnRvIGEgdGVtcG9yYXJ5IHJvb3QgZWxlbWVudFxuICAgICAgICAgICAgY29uc3QgdGVtcFJvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIFJlYWN0RE9NLnJlbmRlcihcbiAgICAgICAgICAgICAgICBFdmVudFRpbGUsXG4gICAgICAgICAgICAgICAgdGVtcFJvb3QsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgZXZlbnRUaWxlTWFya3VwID0gdGVtcFJvb3QuaW5uZXJIVE1MO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZXZlbnRUaWxlTWFya3VwID0gcmVuZGVyVG9TdGF0aWNNYXJrdXAoRXZlbnRUaWxlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmaWxlUGF0aCkge1xuICAgICAgICAgICAgY29uc3QgbXhjID0gbXhFdi5nZXRDb250ZW50KCkudXJsIHx8IG14RXYuZ2V0Q29udGVudCgpLmZpbGU/LnVybDtcbiAgICAgICAgICAgIGV2ZW50VGlsZU1hcmt1cCA9IGV2ZW50VGlsZU1hcmt1cC5zcGxpdChteGMpLmpvaW4oZmlsZVBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50VGlsZU1hcmt1cCA9IGV2ZW50VGlsZU1hcmt1cC5yZXBsYWNlKC88c3BhbiBjbGFzcz1cIm14X01GaWxlQm9keV9pbmZvX2ljb25cIi4qPz4uKj88XFwvc3Bhbj4vLCAnJyk7XG4gICAgICAgIGlmIChoYXNBdmF0YXIpIHtcbiAgICAgICAgICAgIGV2ZW50VGlsZU1hcmt1cCA9IGV2ZW50VGlsZU1hcmt1cC5yZXBsYWNlKFxuICAgICAgICAgICAgICAgIGVuY29kZVVSSSh0aGlzLmdldEF2YXRhclVSTChteEV2KSkucmVwbGFjZSgvJi9nLCAnJmFtcDsnKSxcbiAgICAgICAgICAgICAgICBgdXNlcnMvJHtteEV2LnNlbmRlci51c2VySWQucmVwbGFjZSgvOi9nLCBcIi1cIil9LnBuZ2AsXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBldmVudFRpbGVNYXJrdXA7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGNyZWF0ZU1vZGlmaWVkRXZlbnQodGV4dDogc3RyaW5nLCBteEV2OiBNYXRyaXhFdmVudCwgaXRhbGljPXRydWUpIHtcbiAgICAgICAgY29uc3QgbW9kaWZpZWRDb250ZW50ID0ge1xuICAgICAgICAgICAgbXNndHlwZTogXCJtLnRleHRcIixcbiAgICAgICAgICAgIGJvZHk6IGAke3RleHR9YCxcbiAgICAgICAgICAgIGZvcm1hdDogXCJvcmcubWF0cml4LmN1c3RvbS5odG1sXCIsXG4gICAgICAgICAgICBmb3JtYXR0ZWRfYm9keTogYCR7dGV4dH1gLFxuICAgICAgICB9O1xuICAgICAgICBpZiAoaXRhbGljKSB7XG4gICAgICAgICAgICBtb2RpZmllZENvbnRlbnQuZm9ybWF0dGVkX2JvZHkgPSAnPGVtPicgKyBtb2RpZmllZENvbnRlbnQuZm9ybWF0dGVkX2JvZHkgKyAnPC9lbT4nO1xuICAgICAgICAgICAgbW9kaWZpZWRDb250ZW50LmJvZHkgPSAnKicgKyBtb2RpZmllZENvbnRlbnQuYm9keSArICcqJztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtb2RpZmllZEV2ZW50ID0gbmV3IE1hdHJpeEV2ZW50KCk7XG4gICAgICAgIG1vZGlmaWVkRXZlbnQuZXZlbnQgPSBteEV2LmV2ZW50O1xuICAgICAgICBtb2RpZmllZEV2ZW50LnNlbmRlciA9IG14RXYuc2VuZGVyO1xuICAgICAgICBtb2RpZmllZEV2ZW50LmV2ZW50LnR5cGUgPSBcIm0ucm9vbS5tZXNzYWdlXCI7XG4gICAgICAgIG1vZGlmaWVkRXZlbnQuZXZlbnQuY29udGVudCA9IG1vZGlmaWVkQ29udGVudDtcbiAgICAgICAgcmV0dXJuIG1vZGlmaWVkRXZlbnQ7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIGNyZWF0ZU1lc3NhZ2VCb2R5KG14RXY6IE1hdHJpeEV2ZW50LCBqb2luZWQgPSBmYWxzZSkge1xuICAgICAgICBsZXQgZXZlbnRUaWxlOiBzdHJpbmc7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0F0dGFjaG1lbnQobXhFdikpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5leHBvcnRPcHRpb25zLmF0dGFjaG1lbnRzSW5jbHVkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCB0aGlzLmdldE1lZGlhQmxvYihteEV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvdGFsU2l6ZSArIGJsb2Iuc2l6ZSA+IHRoaXMuZXhwb3J0T3B0aW9ucy5tYXhTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRUaWxlID0gYXdhaXQgdGhpcy5nZXRFdmVudFRpbGVNYXJrdXAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlTW9kaWZpZWRFdmVudCh0aGlzLm1lZGlhT21pdFRleHQsIG14RXYpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbFNpemUgKz0gYmxvYi5zaXplO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gdGhpcy5nZXRGaWxlUGF0aChteEV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFRpbGUgPSBhd2FpdCB0aGlzLmdldEV2ZW50VGlsZU1hcmt1cChteEV2LCBqb2luZWQsIGZpbGVQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50b3RhbFNpemUgPT0gdGhpcy5leHBvcnRPcHRpb25zLm1heFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBvcnRPcHRpb25zLmF0dGFjaG1lbnRzSW5jbHVkZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRGaWxlKGZpbGVQYXRoLCBibG9iKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIkVycm9yIHdoaWxlIGZldGNoaW5nIGZpbGVcIiArIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRUaWxlID0gYXdhaXQgdGhpcy5nZXRFdmVudFRpbGVNYXJrdXAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVNb2RpZmllZEV2ZW50KF90KFwiRXJyb3IgZmV0Y2hpbmcgZmlsZVwiKSwgbXhFdiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50VGlsZSA9IGF3YWl0IHRoaXMuZ2V0RXZlbnRUaWxlTWFya3VwKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVNb2RpZmllZEV2ZW50KHRoaXMubWVkaWFPbWl0VGV4dCwgbXhFdiksXG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luZWQsXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGV2ZW50VGlsZSA9IGF3YWl0IHRoaXMuZ2V0RXZlbnRUaWxlTWFya3VwKG14RXYsIGpvaW5lZCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IEhhbmRsZSBjYWxsRXZlbnQgZXJyb3JzXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZSk7XG4gICAgICAgICAgICBldmVudFRpbGUgPSBhd2FpdCB0aGlzLmdldEV2ZW50VGlsZU1hcmt1cChcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZU1vZGlmaWVkRXZlbnQodGV4dEZvckV2ZW50KG14RXYpLCBteEV2LCBmYWxzZSksXG4gICAgICAgICAgICAgICAgam9pbmVkLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBldmVudFRpbGU7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIGNyZWF0ZUhUTUwoZXZlbnRzOiBNYXRyaXhFdmVudFtdLCBzdGFydDogbnVtYmVyKSB7XG4gICAgICAgIGxldCBjb250ZW50ID0gXCJcIjtcbiAgICAgICAgbGV0IHByZXZFdmVudCA9IG51bGw7XG4gICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IE1hdGgubWluKHN0YXJ0ICsgMTAwMCwgZXZlbnRzLmxlbmd0aCk7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBldmVudHNbaV07XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKGBQcm9jZXNzaW5nIGV2ZW50ICR7aSArIDF9IG91dCBvZiAke2V2ZW50cy5sZW5ndGh9YCwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FuY2VsbGVkKSByZXR1cm4gdGhpcy5jbGVhblVwKCk7XG4gICAgICAgICAgICBpZiAoIWhhdmVUaWxlRm9yRXZlbnQoZXZlbnQpKSBjb250aW51ZTtcblxuICAgICAgICAgICAgY29udGVudCArPSB0aGlzLm5lZWRzRGF0ZVNlcGFyYXRvcihldmVudCwgcHJldkV2ZW50KSA/IHRoaXMuZ2V0RGF0ZVNlcGFyYXRvcihldmVudCkgOiBcIlwiO1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkQmVKb2luZWQgPSAhdGhpcy5uZWVkc0RhdGVTZXBhcmF0b3IoZXZlbnQsIHByZXZFdmVudClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIHNob3VsZEZvcm1Db250aW51YXRpb24ocHJldkV2ZW50LCBldmVudCwgZmFsc2UpO1xuICAgICAgICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHRoaXMuY3JlYXRlTWVzc2FnZUJvZHkoZXZlbnQsIHNob3VsZEJlSm9pbmVkKTtcbiAgICAgICAgICAgIHRoaXMudG90YWxTaXplICs9IEJ1ZmZlci5ieXRlTGVuZ3RoKGJvZHkpO1xuICAgICAgICAgICAgY29udGVudCArPSBib2R5O1xuICAgICAgICAgICAgcHJldkV2ZW50ID0gZXZlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMud3JhcEhUTUwoY29udGVudCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGV4cG9ydCgpIHtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzcyhcIlN0YXJ0aW5nIGV4cG9ydC4uLlwiKTtcblxuICAgICAgICBjb25zdCBmZXRjaFN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0UmVxdWlyZWRFdmVudHMoKTtcbiAgICAgICAgY29uc3QgZmV0Y2hFbmQgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKGBGZXRjaGVkICR7cmVzLmxlbmd0aH0gZXZlbnRzIGluICR7KGZldGNoRW5kIC0gZmV0Y2hTdGFydCkvMTAwMH1zYCwgdHJ1ZSwgZmFsc2UpO1xuXG4gICAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3MoXCJDcmVhdGluZyBIVE1MLi4uXCIpO1xuICAgICAgICBmb3IgKGxldCBwYWdlID0gMDsgcGFnZSA8IHJlcy5sZW5ndGggLyAxMDAwOyBwYWdlKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGh0bWwgPSBhd2FpdCB0aGlzLmNyZWF0ZUhUTUwocmVzLCBwYWdlICogMTAwMCk7XG4gICAgICAgICAgICB0aGlzLmFkZEZpbGUoYG1lc3NhZ2VzJHtwYWdlID8gcGFnZSArIDEgOiBcIlwifS5odG1sYCwgbmV3IEJsb2IoW2h0bWxdKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZXhwb3J0Q1NTID0gYXdhaXQgZ2V0RXhwb3J0Q1NTKCk7XG4gICAgICAgIHRoaXMuYWRkRmlsZShcImNzcy9zdHlsZS5jc3NcIiwgbmV3IEJsb2IoW2V4cG9ydENTU10pKTtcbiAgICAgICAgdGhpcy5hZGRGaWxlKFwianMvc2NyaXB0LmpzXCIsIG5ldyBCbG9iKFtleHBvcnRKU10pKTtcblxuICAgICAgICBhd2FpdCB0aGlzLmRvd25sb2FkWklQKCk7XG5cbiAgICAgICAgY29uc3QgZXhwb3J0RW5kID0gcGVyZm9ybWFuY2Uubm93KCk7XG5cbiAgICAgICAgaWYgKHRoaXMuY2FuY2VsbGVkKSB7XG4gICAgICAgICAgICBsb2dnZXIuaW5mbyhcIkV4cG9ydCBjYW5jZWxsZWQgc3VjY2Vzc2Z1bGx5XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzcyhcIkV4cG9ydCBzdWNjZXNzZnVsIVwiKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3MoYEV4cG9ydGVkICR7cmVzLmxlbmd0aH0gZXZlbnRzIGluICR7KGV4cG9ydEVuZCAtIGZldGNoU3RhcnQpLzEwMDB9IHNlY29uZHNgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2xlYW5VcCgpO1xuICAgIH1cbn1cblxuIl19