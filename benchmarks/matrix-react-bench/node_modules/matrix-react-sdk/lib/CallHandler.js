"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.VIRTUAL_ROOM_EVENT_TYPE = exports.PlaceCallType = exports.PROTOCOL_SIP_VIRTUAL = exports.PROTOCOL_SIP_NATIVE = exports.PROTOCOL_PSTN_PREFIXED = exports.PROTOCOL_PSTN = exports.CallHandlerEvent = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _MatrixClientPeg = require("./MatrixClientPeg");

var _Modal = _interopRequireDefault(require("./Modal"));

var _languageHandler = require("./languageHandler");

var _dispatcher = _interopRequireDefault(require("./dispatcher/dispatcher"));

var _WidgetUtils = _interopRequireDefault(require("./utils/WidgetUtils"));

var _SettingsStore = _interopRequireDefault(require("./settings/SettingsStore"));

var _Jitsi = require("./widgets/Jitsi");

var _WidgetType = require("./widgets/WidgetType");

var _SettingLevel = require("./settings/SettingLevel");

var _rfc = require("rfc4648");

var _QuestionDialog = _interopRequireDefault(require("./components/views/dialogs/QuestionDialog"));

var _ErrorDialog = _interopRequireDefault(require("./components/views/dialogs/ErrorDialog"));

var _WidgetStore = _interopRequireDefault(require("./stores/WidgetStore"));

var _WidgetMessagingStore = require("./stores/widgets/WidgetMessagingStore");

var _ElementWidgetActions = require("./stores/widgets/ElementWidgetActions");

var _call = require("matrix-js-sdk/src/webrtc/call");

var _Analytics = _interopRequireDefault(require("./Analytics"));

var _CountlyAnalytics = _interopRequireDefault(require("./CountlyAnalytics"));

var _UIFeature = require("./settings/UIFeature");

var _logger = require("matrix-js-sdk/src/logger");

var _actions = require("./dispatcher/actions");

var _VoipUserMapper = _interopRequireDefault(require("./VoipUserMapper"));

var _ManagedHybrid = require("./widgets/ManagedHybrid");

var _randomstring = require("matrix-js-sdk/src/randomstring");

var _events = _interopRequireDefault(require("events"));

var _SdkConfig = _interopRequireDefault(require("./SdkConfig"));

var _createRoom = require("./createRoom");

var _PushRules = require("matrix-js-sdk/src/@types/PushRules");

var _pushprocessor = require("matrix-js-sdk/src/pushprocessor");

var _WidgetLayoutStore = require("./stores/widgets/WidgetLayoutStore");

var _IncomingCallToast = _interopRequireWildcard(require("./toasts/IncomingCallToast"));

var _ToastStore = _interopRequireDefault(require("./stores/ToastStore"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2015, 2016 OpenMarket Ltd
Copyright 2017, 2018 New Vector Ltd
Copyright 2019 - 2021 The Matrix.org Foundation C.I.C.
Copyright 2021 Å imon Brandner <simon.bra.ag@gmail.com>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

/*
 * Manages a list of all the currently active calls.
 *
 * This handler dispatches when voip calls are added/updated/removed from this list:
 * {
 *   action: 'call_state'
 *   room_id: <room ID of the call>
 * }
 *
 * To know the state of the call, this handler exposes a getter to
 * obtain the call for a room:
 *   var call = CallHandler.getCall(roomId)
 *   var state = call.call_state; // ringing|ringback|connected|ended|busy|stop_ringback|stop_ringing
 *
 * This handler listens for and handles the following actions:
 * {
 *   action: 'place_call',
 *   type: 'voice|video',
 *   room_id: <room that the place call button was pressed in>
 * }
 *
 * {
 *   action: 'incoming_call'
 *   call: MatrixCall
 * }
 *
 * {
 *   action: 'hangup'
 *   room_id: <room that the hangup button was pressed in>
 * }
 *
 * {
 *   action: 'answer'
 *   room_id: <room that the answer button was pressed in>
 * }
 */
const PROTOCOL_PSTN = 'm.protocol.pstn';
exports.PROTOCOL_PSTN = PROTOCOL_PSTN;
const PROTOCOL_PSTN_PREFIXED = 'im.vector.protocol.pstn';
exports.PROTOCOL_PSTN_PREFIXED = PROTOCOL_PSTN_PREFIXED;
const PROTOCOL_SIP_NATIVE = 'im.vector.protocol.sip_native';
exports.PROTOCOL_SIP_NATIVE = PROTOCOL_SIP_NATIVE;
const PROTOCOL_SIP_VIRTUAL = 'im.vector.protocol.sip_virtual';
exports.PROTOCOL_SIP_VIRTUAL = PROTOCOL_SIP_VIRTUAL;
const CHECK_PROTOCOLS_ATTEMPTS = 3; // Event type for room account data and room creation content used to mark rooms as virtual rooms
// (and store the ID of their native room)

const VIRTUAL_ROOM_EVENT_TYPE = 'im.vector.is_virtual_room';
exports.VIRTUAL_ROOM_EVENT_TYPE = VIRTUAL_ROOM_EVENT_TYPE;
var AudioID;

(function (AudioID) {
  AudioID["Ring"] = "ringAudio";
  AudioID["Ringback"] = "ringbackAudio";
  AudioID["CallEnd"] = "callendAudio";
  AudioID["Busy"] = "busyAudio";
})(AudioID || (AudioID = {}));

let PlaceCallType;
exports.PlaceCallType = PlaceCallType;

(function (PlaceCallType) {
  PlaceCallType["Voice"] = "voice";
  PlaceCallType["Video"] = "video";
})(PlaceCallType || (exports.PlaceCallType = PlaceCallType = {}));

let CallHandlerEvent;
exports.CallHandlerEvent = CallHandlerEvent;

(function (CallHandlerEvent) {
  CallHandlerEvent["CallsChanged"] = "calls_changed";
  CallHandlerEvent["CallChangeRoom"] = "call_change_room";
  CallHandlerEvent["SilencedCallsChanged"] = "silenced_calls_changed";
})(CallHandlerEvent || (exports.CallHandlerEvent = CallHandlerEvent = {}));

class CallHandler extends _events.default {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "calls", new Map());
    (0, _defineProperty2.default)(this, "transferees", new Map());
    (0, _defineProperty2.default)(this, "audioPromises", new Map());
    (0, _defineProperty2.default)(this, "dispatcherRef", null);
    (0, _defineProperty2.default)(this, "supportsPstnProtocol", null);
    (0, _defineProperty2.default)(this, "pstnSupportPrefixed", null);
    (0, _defineProperty2.default)(this, "supportsSipNativeVirtual", null);
    (0, _defineProperty2.default)(this, "pstnSupportCheckTimer", void 0);
    (0, _defineProperty2.default)(this, "invitedRoomsAreVirtual", new Map());
    (0, _defineProperty2.default)(this, "invitedRoomCheckInProgress", false);
    (0, _defineProperty2.default)(this, "assertedIdentityNativeUsers", new Map());
    (0, _defineProperty2.default)(this, "silencedCalls", new Set());
    (0, _defineProperty2.default)(this, "onCallIncoming", call => {
      // we dispatch this synchronously to make sure that the event
      // handlers on the call are set up immediately (so that if
      // we get an immediate hangup, we don't get a stuck call)
      _dispatcher.default.dispatch({
        action: 'incoming_call',
        call: call
      }, true);
    });
    (0, _defineProperty2.default)(this, "onCallStateChanged", (newState, oldState, call) => {
      if (!this.matchesCallForThisRoom(call)) return;
      const mappedRoomId = this.roomIdForCall(call);
      this.setCallState(call, newState);

      switch (oldState) {
        case _call.CallState.Ringing:
          this.pause(AudioID.Ring);
          break;

        case _call.CallState.InviteSent:
          this.pause(AudioID.Ringback);
          break;
      }

      if (newState !== _call.CallState.Ringing) {
        this.silencedCalls.delete(call.callId);
      }

      switch (newState) {
        case _call.CallState.Ringing:
          {
            const incomingCallPushRule = new _pushprocessor.PushProcessor(_MatrixClientPeg.MatrixClientPeg.get()).getPushRuleById(_PushRules.RuleId.IncomingCall);
            const pushRuleEnabled = incomingCallPushRule === null || incomingCallPushRule === void 0 ? void 0 : incomingCallPushRule.enabled;
            const tweakSetToRing = incomingCallPushRule === null || incomingCallPushRule === void 0 ? void 0 : incomingCallPushRule.actions.some(action => action.set_tweak === _PushRules.TweakName.Sound && action.value === "ring");

            if (pushRuleEnabled && tweakSetToRing) {
              this.play(AudioID.Ring);
            } else {
              this.silenceCall(call.callId);
            }

            break;
          }

        case _call.CallState.InviteSent:
          {
            this.play(AudioID.Ringback);
            break;
          }

        case _call.CallState.Ended:
          {
            const hangupReason = call.hangupReason;

            _Analytics.default.trackEvent('voip', 'callEnded', 'hangupReason', hangupReason);

            this.removeCallForRoom(mappedRoomId);

            if (oldState === _call.CallState.InviteSent && call.hangupParty === _call.CallParty.Remote) {
              this.play(AudioID.Busy); // Don't show a modal when we got rejected/the call was hung up

              if (!hangupReason || [_call.CallErrorCode.UserHangup, "user hangup"].includes(hangupReason)) break;
              let title;
              let description; // TODO: We should either do away with these or figure out a copy for each code (expect user_hangup...)

              if (call.hangupReason === _call.CallErrorCode.UserBusy) {
                title = (0, _languageHandler._t)("User Busy");
                description = (0, _languageHandler._t)("The user you called is busy.");
              } else {
                title = (0, _languageHandler._t)("Call Failed");
                description = (0, _languageHandler._t)("The call could not be established");
              }

              _Modal.default.createTrackedDialog('Call Handler', 'Call Failed', _ErrorDialog.default, {
                title,
                description
              });
            } else if (hangupReason === _call.CallErrorCode.AnsweredElsewhere && oldState === _call.CallState.Connecting) {
              _Modal.default.createTrackedDialog('Call Handler', 'Call Failed', _ErrorDialog.default, {
                title: (0, _languageHandler._t)("Answered Elsewhere"),
                description: (0, _languageHandler._t)("The call was answered on another device.")
              });
            } else if (oldState !== _call.CallState.Fledgling && oldState !== _call.CallState.Ringing) {
              // don't play the end-call sound for calls that never got off the ground
              this.play(AudioID.CallEnd);
            }

            this.logCallStats(call, mappedRoomId);
            break;
          }
      }
    });
    (0, _defineProperty2.default)(this, "onAction", payload => {
      switch (payload.action) {
        case 'place_call':
          {
            // We might be using managed hybrid widgets
            if ((0, _ManagedHybrid.isManagedHybridWidgetEnabled)()) {
              (0, _ManagedHybrid.addManagedHybridWidget)(payload.room_id);
              return;
            } // if the runtime env doesn't do VoIP, whine.


            if (!_MatrixClientPeg.MatrixClientPeg.get().supportsVoip()) {
              _Modal.default.createTrackedDialog('Call Handler', 'VoIP is unsupported', _ErrorDialog.default, {
                title: (0, _languageHandler._t)('VoIP is unsupported'),
                description: (0, _languageHandler._t)('You cannot place VoIP calls in this browser.')
              });

              return;
            } // don't allow > 2 calls to be placed.


            if (this.getAllActiveCalls().length > 1) {
              _Modal.default.createTrackedDialog('Call Handler', 'Existing Call', _ErrorDialog.default, {
                title: (0, _languageHandler._t)('Too Many Calls'),
                description: (0, _languageHandler._t)("You've reached the maximum number of simultaneous calls.")
              });

              return;
            }

            const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(payload.room_id);

            if (!room) {
              _logger.logger.error(`Room ${payload.room_id} does not exist.`);

              return;
            } // We leave the check for whether there's already a call in this room until later,
            // otherwise it can race.


            const members = room.getJoinedMembers();

            if (members.length <= 1) {
              _Modal.default.createTrackedDialog('Call Handler', 'Cannot place call with self', _ErrorDialog.default, {
                description: (0, _languageHandler._t)('You cannot place a call with yourself.')
              });

              return;
            } else if (members.length === 2) {
              _logger.logger.info(`Place ${payload.type} call in ${payload.room_id}`);

              this.placeCall(payload.room_id, payload.type, payload.transferee);
            } else {
              // > 2
              _dispatcher.default.dispatch({
                action: "place_conference_call",
                room_id: payload.room_id,
                type: payload.type
              });
            }
          }
          break;

        case 'place_conference_call':
          _logger.logger.info("Place conference call in " + payload.room_id);

          _Analytics.default.trackEvent('voip', 'placeConferenceCall');

          _CountlyAnalytics.default.instance.trackStartCall(payload.room_id, payload.type === PlaceCallType.Video, true);

          this.startCallApp(payload.room_id, payload.type);
          break;

        case 'end_conference':
          _logger.logger.info("Terminating conference call in " + payload.room_id);

          this.terminateCallApp(payload.room_id);
          break;

        case 'hangup_conference':
          _logger.logger.info("Leaving conference call in " + payload.room_id);

          this.hangupCallApp(payload.room_id);
          break;

        case 'incoming_call':
          {
            // if the runtime env doesn't do VoIP, stop here.
            if (!_MatrixClientPeg.MatrixClientPeg.get().supportsVoip()) {
              return;
            }

            const call = payload.call;
            const mappedRoomId = CallHandler.sharedInstance().roomIdForCall(call);

            if (this.getCallForRoom(mappedRoomId)) {
              _logger.logger.log("Got incoming call for room " + mappedRoomId + " but there's already a call for this room: ignoring");

              return;
            }

            _Analytics.default.trackEvent('voip', 'receiveCall', 'type', call.type);

            this.addCallForRoom(mappedRoomId, call);
            this.setCallListeners(call); // Explicitly handle first state change

            this.onCallStateChanged(call.state, null, call); // get ready to send encrypted events in the room, so if the user does answer
            // the call, we'll be ready to send. NB. This is the protocol-level room ID not
            // the mapped one: that's where we'll send the events.

            const cli = _MatrixClientPeg.MatrixClientPeg.get();

            cli.prepareToEncrypt(cli.getRoom(call.roomId));
          }
          break;

        case 'hangup':
        case 'reject':
          this.stopRingingIfPossible(this.calls.get(payload.room_id).callId);

          if (!this.calls.get(payload.room_id)) {
            return; // no call to hangup
          }

          if (payload.action === 'reject') {
            this.calls.get(payload.room_id).reject();
          } else {
            this.calls.get(payload.room_id).hangup(_call.CallErrorCode.UserHangup, false);
          } // don't remove the call yet: let the hangup event handler do it (otherwise it will throw
          // the hangup event away)


          break;

        case 'hangup_all':
          this.stopRingingIfPossible(this.calls.get(payload.room_id).callId);

          for (const call of this.calls.values()) {
            call.hangup(_call.CallErrorCode.UserHangup, false);
          }

          break;

        case 'answer':
          {
            this.stopRingingIfPossible(this.calls.get(payload.room_id).callId);

            if (!this.calls.has(payload.room_id)) {
              return; // no call to answer
            }

            if (this.getAllActiveCalls().length > 1) {
              _Modal.default.createTrackedDialog('Call Handler', 'Existing Call', _ErrorDialog.default, {
                title: (0, _languageHandler._t)('Too Many Calls'),
                description: (0, _languageHandler._t)("You've reached the maximum number of simultaneous calls.")
              });

              return;
            }

            const call = this.calls.get(payload.room_id);
            call.answer();
            this.setActiveCallRoomId(payload.room_id);

            _CountlyAnalytics.default.instance.trackJoinCall(payload.room_id, call.type === _call.CallType.Video, false);

            _dispatcher.default.dispatch({
              action: _actions.Action.ViewRoom,
              room_id: payload.room_id
            });

            break;
          }

        case _actions.Action.DialNumber:
          this.dialNumber(payload.number);
          break;

        case _actions.Action.TransferCallToMatrixID:
          this.startTransferToMatrixID(payload.call, payload.destination, payload.consultFirst);
          break;

        case _actions.Action.TransferCallToPhoneNumber:
          this.startTransferToPhoneNumber(payload.call, payload.destination, payload.consultFirst);
          break;
      }
    });
  }

  // callIds
  static sharedInstance() {
    if (!window.mxCallHandler) {
      window.mxCallHandler = new CallHandler();
    }

    return window.mxCallHandler;
  }
  /*
   * Gets the user-facing room associated with a call (call.roomId may be the call "virtual room"
   * if a voip_mxid_translate_pattern is set in the config)
   */


  roomIdForCall(call) {
    if (!call) return null;

    const voipConfig = _SdkConfig.default.get()['voip'];

    if (voipConfig && voipConfig.obeyAssertedIdentity) {
      const nativeUser = this.assertedIdentityNativeUsers[call.callId];

      if (nativeUser) {
        const room = (0, _createRoom.findDMForUser)(_MatrixClientPeg.MatrixClientPeg.get(), nativeUser);
        if (room) return room.roomId;
      }
    }

    return _VoipUserMapper.default.sharedInstance().nativeRoomForVirtualRoom(call.roomId) || call.roomId;
  }

  start() {
    this.dispatcherRef = _dispatcher.default.register(this.onAction); // add empty handlers for media actions, otherwise the media keys
    // end up causing the audio elements with our ring/ringback etc
    // audio clips in to play.

    if (navigator.mediaSession) {
      navigator.mediaSession.setActionHandler('play', function () {});
      navigator.mediaSession.setActionHandler('pause', function () {});
      navigator.mediaSession.setActionHandler('seekbackward', function () {});
      navigator.mediaSession.setActionHandler('seekforward', function () {});
      navigator.mediaSession.setActionHandler('previoustrack', function () {});
      navigator.mediaSession.setActionHandler('nexttrack', function () {});
    }

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.Voip)) {
      _MatrixClientPeg.MatrixClientPeg.get().on('Call.incoming', this.onCallIncoming);
    }

    this.checkProtocols(CHECK_PROTOCOLS_ATTEMPTS);
  }

  stop() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    if (cli) {
      cli.removeListener('Call.incoming', this.onCallIncoming);
    }

    if (this.dispatcherRef !== null) {
      _dispatcher.default.unregister(this.dispatcherRef);

      this.dispatcherRef = null;
    }
  }

  silenceCall(callId) {
    this.silencedCalls.add(callId);
    this.emit(CallHandlerEvent.SilencedCallsChanged, this.silencedCalls); // Don't pause audio if we have calls which are still ringing

    if (this.areAnyCallsUnsilenced()) return;
    this.pause(AudioID.Ring);
  }

  unSilenceCall(callId) {
    this.silencedCalls.delete(callId);
    this.emit(CallHandlerEvent.SilencedCallsChanged, this.silencedCalls);
    this.play(AudioID.Ring);
  }

  isCallSilenced(callId) {
    return this.silencedCalls.has(callId);
  }
  /**
   * Returns true if there is at least one unsilenced call
   * @returns {boolean}
   */


  areAnyCallsUnsilenced() {
    for (const call of this.calls.values()) {
      if (call.state === _call.CallState.Ringing && !this.isCallSilenced(call.callId)) {
        return true;
      }
    }

    return false;
  }

  async checkProtocols(maxTries) {
    try {
      const protocols = await _MatrixClientPeg.MatrixClientPeg.get().getThirdpartyProtocols();

      if (protocols[PROTOCOL_PSTN] !== undefined) {
        this.supportsPstnProtocol = Boolean(protocols[PROTOCOL_PSTN]);
        if (this.supportsPstnProtocol) this.pstnSupportPrefixed = false;
      } else if (protocols[PROTOCOL_PSTN_PREFIXED] !== undefined) {
        this.supportsPstnProtocol = Boolean(protocols[PROTOCOL_PSTN_PREFIXED]);
        if (this.supportsPstnProtocol) this.pstnSupportPrefixed = true;
      } else {
        this.supportsPstnProtocol = null;
      }

      _dispatcher.default.dispatch({
        action: _actions.Action.PstnSupportUpdated
      });

      if (protocols[PROTOCOL_SIP_NATIVE] !== undefined && protocols[PROTOCOL_SIP_VIRTUAL] !== undefined) {
        this.supportsSipNativeVirtual = Boolean(protocols[PROTOCOL_SIP_NATIVE] && protocols[PROTOCOL_SIP_VIRTUAL]);
      }

      _dispatcher.default.dispatch({
        action: _actions.Action.VirtualRoomSupportUpdated
      });
    } catch (e) {
      if (maxTries === 1) {
        _logger.logger.log("Failed to check for protocol support and no retries remain: assuming no support", e);
      } else {
        _logger.logger.log("Failed to check for protocol support: will retry", e);

        this.pstnSupportCheckTimer = setTimeout(() => {
          this.checkProtocols(maxTries - 1);
        }, 10000);
      }
    }
  }

  getSupportsPstnProtocol() {
    return this.supportsPstnProtocol;
  }

  getSupportsVirtualRooms() {
    return this.supportsSipNativeVirtual;
  }

  pstnLookup(phoneNumber) {
    return _MatrixClientPeg.MatrixClientPeg.get().getThirdpartyUser(this.pstnSupportPrefixed ? PROTOCOL_PSTN_PREFIXED : PROTOCOL_PSTN, {
      'm.id.phone': phoneNumber
    });
  }

  sipVirtualLookup(nativeMxid) {
    return _MatrixClientPeg.MatrixClientPeg.get().getThirdpartyUser(PROTOCOL_SIP_VIRTUAL, {
      'native_mxid': nativeMxid
    });
  }

  sipNativeLookup(virtualMxid) {
    return _MatrixClientPeg.MatrixClientPeg.get().getThirdpartyUser(PROTOCOL_SIP_NATIVE, {
      'virtual_mxid': virtualMxid
    });
  }

  getCallById(callId) {
    for (const call of this.calls.values()) {
      if (call.callId === callId) return call;
    }

    return null;
  }

  getCallForRoom(roomId) {
    return this.calls.get(roomId) || null;
  }

  getAnyActiveCall() {
    for (const call of this.calls.values()) {
      if (call.state !== _call.CallState.Ended) {
        return call;
      }
    }

    return null;
  }

  getAllActiveCalls() {
    const activeCalls = [];

    for (const call of this.calls.values()) {
      if (call.state !== _call.CallState.Ended && call.state !== _call.CallState.Ringing) {
        activeCalls.push(call);
      }
    }

    return activeCalls;
  }

  getAllActiveCallsNotInRoom(notInThisRoomId) {
    const callsNotInThatRoom = [];

    for (const [roomId, call] of this.calls.entries()) {
      if (roomId !== notInThisRoomId && call.state !== _call.CallState.Ended) {
        callsNotInThatRoom.push(call);
      }
    }

    return callsNotInThatRoom;
  }

  getAllActiveCallsForPip(roomId) {
    const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(roomId);

    if (_WidgetLayoutStore.WidgetLayoutStore.instance.hasMaximisedWidget(room)) {
      // This checks if there is space for the call view in the aux panel
      // If there is no space any call should be displayed in PiP
      return this.getAllActiveCalls();
    }

    return this.getAllActiveCallsNotInRoom(roomId);
  }

  getTransfereeForCallId(callId) {
    return this.transferees[callId];
  }

  play(audioId) {
    // TODO: Attach an invisible element for this instead
    // which listens?
    const audio = document.getElementById(audioId);

    if (audio) {
      const playAudio = async () => {
        try {
          // This still causes the chrome debugger to break on promise rejection if
          // the promise is rejected, even though we're catching the exception.
          await audio.play();
        } catch (e) {
          // This is usually because the user hasn't interacted with the document,
          // or chrome doesn't think so and is denying the request. Not sure what
          // we can really do here...
          // https://github.com/vector-im/element-web/issues/7657
          _logger.logger.log("Unable to play audio clip", e);
        }
      };

      if (this.audioPromises.has(audioId)) {
        this.audioPromises.set(audioId, this.audioPromises.get(audioId).then(() => {
          audio.load();
          return playAudio();
        }));
      } else {
        this.audioPromises.set(audioId, playAudio());
      }
    }
  }

  pause(audioId) {
    // TODO: Attach an invisible element for this instead
    // which listens?
    const audio = document.getElementById(audioId);

    if (audio) {
      if (this.audioPromises.has(audioId)) {
        this.audioPromises.set(audioId, this.audioPromises.get(audioId).then(() => audio.pause()));
      } else {
        // pause doesn't return a promise, so just do it
        audio.pause();
      }
    }
  }

  matchesCallForThisRoom(call) {
    // We don't allow placing more than one call per room, but that doesn't mean there
    // can't be more than one, eg. in a glare situation. This checks that the given call
    // is the call we consider 'the' call for its room.
    const mappedRoomId = this.roomIdForCall(call);
    const callForThisRoom = this.getCallForRoom(mappedRoomId);
    return callForThisRoom && call.callId === callForThisRoom.callId;
  }

  setCallListeners(call) {
    let mappedRoomId = this.roomIdForCall(call);
    call.on(_call.CallEvent.Error, err => {
      if (!this.matchesCallForThisRoom(call)) return;

      _Analytics.default.trackEvent('voip', 'callError', 'error', err.toString());

      _logger.logger.error("Call error:", err);

      if (err.code === _call.CallErrorCode.NoUserMedia) {
        this.showMediaCaptureError(call);
        return;
      }

      if (_MatrixClientPeg.MatrixClientPeg.get().getTurnServers().length === 0 && _SettingsStore.default.getValue("fallbackICEServerAllowed") === null) {
        this.showICEFallbackPrompt();
        return;
      }

      _Modal.default.createTrackedDialog('Call Failed', '', _ErrorDialog.default, {
        title: (0, _languageHandler._t)('Call Failed'),
        description: err.message
      });
    });
    call.on(_call.CallEvent.Hangup, () => {
      if (!this.matchesCallForThisRoom(call)) return;

      _Analytics.default.trackEvent('voip', 'callHangup');

      this.removeCallForRoom(mappedRoomId);
    });
    call.on(_call.CallEvent.State, (newState, oldState) => {
      this.onCallStateChanged(newState, oldState, call);
    });
    call.on(_call.CallEvent.Replaced, newCall => {
      if (!this.matchesCallForThisRoom(call)) return;

      _logger.logger.log(`Call ID ${call.callId} is being replaced by call ID ${newCall.callId}`);

      if (call.state === _call.CallState.Ringing) {
        this.pause(AudioID.Ring);
      } else if (call.state === _call.CallState.InviteSent) {
        this.pause(AudioID.Ringback);
      }

      this.removeCallForRoom(mappedRoomId);
      this.addCallForRoom(mappedRoomId, newCall);
      this.setCallListeners(newCall);
      this.setCallState(newCall, newCall.state);
    });
    call.on(_call.CallEvent.AssertedIdentityChanged, async () => {
      if (!this.matchesCallForThisRoom(call)) return;

      _logger.logger.log(`Call ID ${call.callId} got new asserted identity:`, call.getRemoteAssertedIdentity());

      const newAssertedIdentity = call.getRemoteAssertedIdentity().id;
      let newNativeAssertedIdentity = newAssertedIdentity;

      if (newAssertedIdentity) {
        const response = await this.sipNativeLookup(newAssertedIdentity);

        if (response.length && response[0].fields.lookup_success) {
          newNativeAssertedIdentity = response[0].userid;
        }
      }

      _logger.logger.log(`Asserted identity ${newAssertedIdentity} mapped to ${newNativeAssertedIdentity}`);

      if (newNativeAssertedIdentity) {
        this.assertedIdentityNativeUsers[call.callId] = newNativeAssertedIdentity; // If we don't already have a room with this user, make one. This will be slightly odd
        // if they called us because we'll be inviting them, but there's not much we can do about
        // this if we want the actual, native room to exist (which we do). This is why it's
        // important to only obey asserted identity in trusted environments, since anyone you're
        // on a call with can cause you to send a room invite to someone.

        await (0, _createRoom.ensureDMExists)(_MatrixClientPeg.MatrixClientPeg.get(), newNativeAssertedIdentity);
        const newMappedRoomId = this.roomIdForCall(call);

        _logger.logger.log(`Old room ID: ${mappedRoomId}, new room ID: ${newMappedRoomId}`);

        if (newMappedRoomId !== mappedRoomId) {
          this.removeCallForRoom(mappedRoomId);
          mappedRoomId = newMappedRoomId;

          _logger.logger.log("Moving call to room " + mappedRoomId);

          this.addCallForRoom(mappedRoomId, call, true);
        }
      }
    });
  }

  async logCallStats(call, mappedRoomId) {
    const stats = await call.getCurrentCallStats();

    _logger.logger.debug(`Call completed. Call ID: ${call.callId}, virtual room ID: ${call.roomId}, ` + `user-facing room ID: ${mappedRoomId}, direction: ${call.direction}, ` + `our Party ID: ${call.ourPartyId}, hangup party: ${call.hangupParty}, ` + `hangup reason: ${call.hangupReason}`);

    if (!stats) {
      _logger.logger.debug("Call statistics are undefined. The call has " + "probably failed before a peerConn was established");

      return;
    }

    _logger.logger.debug("Local candidates:");

    for (const cand of stats.filter(item => item.type === 'local-candidate')) {
      const address = cand.address || cand.ip; // firefox uses 'address', chrome uses 'ip'

      _logger.logger.debug(`${cand.id} - type: ${cand.candidateType}, address: ${address}, port: ${cand.port}, ` + `protocol: ${cand.protocol}, relay protocol: ${cand.relayProtocol}, network type: ${cand.networkType}`);
    }

    _logger.logger.debug("Remote candidates:");

    for (const cand of stats.filter(item => item.type === 'remote-candidate')) {
      const address = cand.address || cand.ip; // firefox uses 'address', chrome uses 'ip'

      _logger.logger.debug(`${cand.id} - type: ${cand.candidateType}, address: ${address}, port: ${cand.port}, ` + `protocol: ${cand.protocol}`);
    }

    _logger.logger.debug("Candidate pairs:");

    for (const pair of stats.filter(item => item.type === 'candidate-pair')) {
      _logger.logger.debug(`${pair.localCandidateId} / ${pair.remoteCandidateId} - state: ${pair.state}, ` + `nominated: ${pair.nominated}, ` + `requests sent ${pair.requestsSent}, requests received  ${pair.requestsReceived},  ` + `responses received: ${pair.responsesReceived}, responses sent: ${pair.responsesSent}, ` + `bytes received: ${pair.bytesReceived}, bytes sent: ${pair.bytesSent}, `);
    }
  }

  setCallState(call, status) {
    const mappedRoomId = CallHandler.sharedInstance().roomIdForCall(call);

    _logger.logger.log(`Call state in ${mappedRoomId} changed to ${status}`);

    const toastKey = (0, _IncomingCallToast.getIncomingCallToastKey)(call.callId);

    if (status === _call.CallState.Ringing) {
      _ToastStore.default.sharedInstance().addOrReplaceToast({
        key: toastKey,
        priority: 100,
        component: _IncomingCallToast.default,
        bodyClassName: "mx_IncomingCallToast",
        props: {
          call
        }
      });
    } else {
      _ToastStore.default.sharedInstance().dismissToast(toastKey);
    }

    _dispatcher.default.dispatch({
      action: 'call_state',
      room_id: mappedRoomId,
      state: status
    });
  }

  removeCallForRoom(roomId) {
    _logger.logger.log("Removing call for room ", roomId);

    this.calls.delete(roomId);
    this.emit(CallHandlerEvent.CallsChanged, this.calls);
  }

  showICEFallbackPrompt() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const code = sub => /*#__PURE__*/_react.default.createElement("code", null, sub);

    _Modal.default.createTrackedDialog('No TURN servers', '', _QuestionDialog.default, {
      title: (0, _languageHandler._t)("Call failed due to misconfigured server"),
      description: /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Please ask the administrator of your homeserver " + "(<code>%(homeserverDomain)s</code>) to configure a TURN server in " + "order for calls to work reliably.", {
        homeserverDomain: cli.getDomain()
      }, {
        code
      })), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Alternatively, you can try to use the public server at " + "<code>turn.matrix.org</code>, but this will not be as reliable, and " + "it will share your IP address with that server. You can also manage " + "this in Settings.", null, {
        code
      }))),
      button: (0, _languageHandler._t)('Try using turn.matrix.org'),
      cancelButton: (0, _languageHandler._t)('OK'),
      onFinished: allow => {
        _SettingsStore.default.setValue("fallbackICEServerAllowed", null, _SettingLevel.SettingLevel.DEVICE, allow);

        cli.setFallbackICEServerAllowed(allow);
      }
    }, null, true);
  }

  showMediaCaptureError(call) {
    let title;
    let description;

    if (call.type === _call.CallType.Voice) {
      title = (0, _languageHandler._t)("Unable to access microphone");
      description = /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Call failed because microphone could not be accessed. " + "Check that a microphone is plugged in and set up correctly."));
    } else if (call.type === _call.CallType.Video) {
      title = (0, _languageHandler._t)("Unable to access webcam / microphone");
      description = /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Call failed because webcam or microphone could not be accessed. Check that:"), /*#__PURE__*/_react.default.createElement("ul", null, /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("A microphone and webcam are plugged in and set up correctly")), /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("Permission is granted to use the webcam")), /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("No other application is using the webcam"))));
    }

    _Modal.default.createTrackedDialog('Media capture failed', '', _ErrorDialog.default, {
      title,
      description
    }, null, true);
  }

  async placeCall(roomId, type, transferee) {
    _Analytics.default.trackEvent('voip', 'placeCall', 'type', type);

    _CountlyAnalytics.default.instance.trackStartCall(roomId, type === PlaceCallType.Video, false);

    const mappedRoomId = (await _VoipUserMapper.default.sharedInstance().getOrCreateVirtualRoomForRoom(roomId)) || roomId;

    _logger.logger.debug("Mapped real room " + roomId + " to room ID " + mappedRoomId);

    const timeUntilTurnCresExpire = _MatrixClientPeg.MatrixClientPeg.get().getTurnServersExpiry() - Date.now();

    _logger.logger.log("Current turn creds expire in " + timeUntilTurnCresExpire + " ms");

    const call = _MatrixClientPeg.MatrixClientPeg.get().createCall(mappedRoomId);

    try {
      this.addCallForRoom(roomId, call);
    } catch (e) {
      _Modal.default.createTrackedDialog('Call Handler', 'Existing Call with user', _ErrorDialog.default, {
        title: (0, _languageHandler._t)('Already in call'),
        description: (0, _languageHandler._t)("You're already in a call with this person.")
      });

      return;
    }

    if (transferee) {
      this.transferees[call.callId] = transferee;
    }

    this.setCallListeners(call);
    this.setActiveCallRoomId(roomId);

    if (type === PlaceCallType.Voice) {
      call.placeVoiceCall();
    } else if (type === 'video') {
      call.placeVideoCall();
    } else {
      _logger.logger.error("Unknown conf call type: " + type);
    }
  }

  stopRingingIfPossible(callId) {
    this.silencedCalls.delete(callId);
    if (this.areAnyCallsUnsilenced()) return;
    this.pause(AudioID.Ring);
  }

  async dialNumber(number) {
    const results = await this.pstnLookup(number);

    if (!results || results.length === 0 || !results[0].userid) {
      _Modal.default.createTrackedDialog('', '', _ErrorDialog.default, {
        title: (0, _languageHandler._t)("Unable to look up phone number"),
        description: (0, _languageHandler._t)("There was an error looking up the phone number")
      });

      return;
    }

    const userId = results[0].userid; // Now check to see if this is a virtual user, in which case we should find the
    // native user

    let nativeUserId;

    if (this.getSupportsVirtualRooms()) {
      const nativeLookupResults = await this.sipNativeLookup(userId);
      const lookupSuccess = nativeLookupResults.length > 0 && nativeLookupResults[0].fields.lookup_success;
      nativeUserId = lookupSuccess ? nativeLookupResults[0].userid : userId;

      _logger.logger.log("Looked up " + number + " to " + userId + " and mapped to native user " + nativeUserId);
    } else {
      nativeUserId = userId;
    }

    const roomId = await (0, _createRoom.ensureDMExists)(_MatrixClientPeg.MatrixClientPeg.get(), nativeUserId);

    _dispatcher.default.dispatch({
      action: _actions.Action.ViewRoom,
      room_id: roomId
    });

    await this.placeCall(roomId, PlaceCallType.Voice, null);
  }

  async startTransferToPhoneNumber(call, destination, consultFirst) {
    const results = await this.pstnLookup(destination);

    if (!results || results.length === 0 || !results[0].userid) {
      _Modal.default.createTrackedDialog('', '', _ErrorDialog.default, {
        title: (0, _languageHandler._t)("Unable to transfer call"),
        description: (0, _languageHandler._t)("There was an error looking up the phone number")
      });

      return;
    }

    await this.startTransferToMatrixID(call, results[0].userid, consultFirst);
  }

  async startTransferToMatrixID(call, destination, consultFirst) {
    if (consultFirst) {
      const dmRoomId = await (0, _createRoom.ensureDMExists)(_MatrixClientPeg.MatrixClientPeg.get(), destination);

      _dispatcher.default.dispatch({
        action: 'place_call',
        type: call.type,
        room_id: dmRoomId,
        transferee: call
      });

      _dispatcher.default.dispatch({
        action: _actions.Action.ViewRoom,
        room_id: dmRoomId,
        should_peek: false,
        joining: false
      });
    } else {
      try {
        await call.transfer(destination);
      } catch (e) {
        _logger.logger.log("Failed to transfer call", e);

        _Modal.default.createTrackedDialog('Failed to transfer call', '', _ErrorDialog.default, {
          title: (0, _languageHandler._t)('Transfer Failed'),
          description: (0, _languageHandler._t)('Failed to transfer call')
        });
      }
    }
  }

  setActiveCallRoomId(activeCallRoomId) {
    _logger.logger.info("Setting call in room " + activeCallRoomId + " active");

    for (const [roomId, call] of this.calls.entries()) {
      if (call.state === _call.CallState.Ended) continue;

      if (roomId === activeCallRoomId) {
        call.setRemoteOnHold(false);
      } else {
        _logger.logger.info("Holding call in room " + roomId + " because another call is being set active");

        call.setRemoteOnHold(true);
      }
    }
  }
  /**
   * @returns true if we are currently in any call where we haven't put the remote party on hold
   */


  hasAnyUnheldCall() {
    for (const call of this.calls.values()) {
      if (call.state === _call.CallState.Ended) continue;
      if (!call.isRemoteOnHold()) return true;
    }

    return false;
  }

  async startCallApp(roomId, type) {
    _dispatcher.default.dispatch({
      action: 'appsDrawer',
      show: true
    }); // prevent double clicking the call button


    const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(roomId);

    const jitsiWidget = _WidgetStore.default.instance.getApps(roomId).find(app => _WidgetType.WidgetType.JITSI.matches(app.type));

    if (jitsiWidget) {
      // If there already is a Jitsi widget pin it
      _WidgetLayoutStore.WidgetLayoutStore.instance.moveToContainer(room, jitsiWidget, _WidgetLayoutStore.Container.Top);

      return;
    }

    const jitsiDomain = _Jitsi.Jitsi.getInstance().preferredDomain;

    const jitsiAuth = await _Jitsi.Jitsi.getInstance().getJitsiAuth();
    let confId;

    if (jitsiAuth === 'openidtoken-jwt') {
      // Create conference ID from room ID
      // For compatibility with Jitsi, use base32 without padding.
      // More details here:
      // https://github.com/matrix-org/prosody-mod-auth-matrix-user-verification
      confId = _rfc.base32.stringify(Buffer.from(roomId), {
        pad: false
      });
    } else {
      // Create a random conference ID
      const random = (0, _randomstring.randomUppercaseString)(1) + (0, _randomstring.randomLowercaseString)(23);
      confId = 'Jitsi' + random;
    }

    let widgetUrl = _WidgetUtils.default.getLocalJitsiWrapperUrl({
      auth: jitsiAuth
    }); // TODO: Remove URL hacks when the mobile clients eventually support v2 widgets


    const parsedUrl = new URL(widgetUrl);
    parsedUrl.search = ''; // set to empty string to make the URL class use searchParams instead

    parsedUrl.searchParams.set('confId', confId);
    widgetUrl = parsedUrl.toString();
    const widgetData = {
      conferenceId: confId,
      isAudioOnly: type === 'voice',
      domain: jitsiDomain,
      auth: jitsiAuth,
      roomName: room.name
    };
    const widgetId = 'jitsi_' + _MatrixClientPeg.MatrixClientPeg.get().credentials.userId + '_' + Date.now();

    _WidgetUtils.default.setRoomWidget(roomId, widgetId, _WidgetType.WidgetType.JITSI, widgetUrl, 'Jitsi', widgetData).then(() => {
      _logger.logger.log('Jitsi widget added');
    }).catch(e => {
      if (e.errcode === 'M_FORBIDDEN') {
        _Modal.default.createTrackedDialog('Call Failed', '', _ErrorDialog.default, {
          title: (0, _languageHandler._t)('Permission Required'),
          description: (0, _languageHandler._t)("You do not have permission to start a conference call in this room")
        });
      }

      _logger.logger.error(e);
    });
  }

  terminateCallApp(roomId) {
    _Modal.default.createTrackedDialog('Confirm Jitsi Terminate', '', _QuestionDialog.default, {
      hasCancelButton: true,
      title: (0, _languageHandler._t)("End conference"),
      description: (0, _languageHandler._t)("This will end the conference for everyone. Continue?"),
      button: (0, _languageHandler._t)("End conference"),
      onFinished: proceed => {
        if (!proceed) return; // We'll just obliterate them all. There should only ever be one, but might as well
        // be safe.

        const roomInfo = _WidgetStore.default.instance.getRoom(roomId);

        const jitsiWidgets = roomInfo.widgets.filter(w => _WidgetType.WidgetType.JITSI.matches(w.type));
        jitsiWidgets.forEach(w => {
          // setting invalid content removes it
          _WidgetUtils.default.setRoomWidget(roomId, w.id);
        });
      }
    });
  }

  hangupCallApp(roomId) {
    const roomInfo = _WidgetStore.default.instance.getRoom(roomId);

    if (!roomInfo) return; // "should never happen" clauses go here

    const jitsiWidgets = roomInfo.widgets.filter(w => _WidgetType.WidgetType.JITSI.matches(w.type));
    jitsiWidgets.forEach(w => {
      const messaging = _WidgetMessagingStore.WidgetMessagingStore.instance.getMessagingForId(w.id);

      if (!messaging) return; // more "should never happen" words

      messaging.transport.send(_ElementWidgetActions.ElementWidgetActions.HangupCall, {});
    });
  }

  addCallForRoom(roomId, call, changedRooms = false) {
    if (this.calls.has(roomId)) {
      _logger.logger.log(`Couldn't add call to room ${roomId}: already have a call for this room`);

      throw new Error("Already have a call for room " + roomId);
    }

    _logger.logger.log("setting call for room " + roomId);

    this.calls.set(roomId, call); // Should we always emit CallsChanged too?

    if (changedRooms) {
      this.emit(CallHandlerEvent.CallChangeRoom, call);
    } else {
      this.emit(CallHandlerEvent.CallsChanged, this.calls);
    }
  }

}

exports.default = CallHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9DYWxsSGFuZGxlci50c3giXSwibmFtZXMiOlsiUFJPVE9DT0xfUFNUTiIsIlBST1RPQ09MX1BTVE5fUFJFRklYRUQiLCJQUk9UT0NPTF9TSVBfTkFUSVZFIiwiUFJPVE9DT0xfU0lQX1ZJUlRVQUwiLCJDSEVDS19QUk9UT0NPTFNfQVRURU1QVFMiLCJWSVJUVUFMX1JPT01fRVZFTlRfVFlQRSIsIkF1ZGlvSUQiLCJQbGFjZUNhbGxUeXBlIiwiQ2FsbEhhbmRsZXJFdmVudCIsIkNhbGxIYW5kbGVyIiwiRXZlbnRFbWl0dGVyIiwiTWFwIiwiU2V0IiwiY2FsbCIsImRpcyIsImRpc3BhdGNoIiwiYWN0aW9uIiwibmV3U3RhdGUiLCJvbGRTdGF0ZSIsIm1hdGNoZXNDYWxsRm9yVGhpc1Jvb20iLCJtYXBwZWRSb29tSWQiLCJyb29tSWRGb3JDYWxsIiwic2V0Q2FsbFN0YXRlIiwiQ2FsbFN0YXRlIiwiUmluZ2luZyIsInBhdXNlIiwiUmluZyIsIkludml0ZVNlbnQiLCJSaW5nYmFjayIsInNpbGVuY2VkQ2FsbHMiLCJkZWxldGUiLCJjYWxsSWQiLCJpbmNvbWluZ0NhbGxQdXNoUnVsZSIsIlB1c2hQcm9jZXNzb3IiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJnZXRQdXNoUnVsZUJ5SWQiLCJSdWxlSWQiLCJJbmNvbWluZ0NhbGwiLCJwdXNoUnVsZUVuYWJsZWQiLCJlbmFibGVkIiwidHdlYWtTZXRUb1JpbmciLCJhY3Rpb25zIiwic29tZSIsInNldF90d2VhayIsIlR3ZWFrTmFtZSIsIlNvdW5kIiwidmFsdWUiLCJwbGF5Iiwic2lsZW5jZUNhbGwiLCJFbmRlZCIsImhhbmd1cFJlYXNvbiIsIkFuYWx5dGljcyIsInRyYWNrRXZlbnQiLCJyZW1vdmVDYWxsRm9yUm9vbSIsImhhbmd1cFBhcnR5IiwiQ2FsbFBhcnR5IiwiUmVtb3RlIiwiQnVzeSIsIkNhbGxFcnJvckNvZGUiLCJVc2VySGFuZ3VwIiwiaW5jbHVkZXMiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiVXNlckJ1c3kiLCJNb2RhbCIsImNyZWF0ZVRyYWNrZWREaWFsb2ciLCJFcnJvckRpYWxvZyIsIkFuc3dlcmVkRWxzZXdoZXJlIiwiQ29ubmVjdGluZyIsIkZsZWRnbGluZyIsIkNhbGxFbmQiLCJsb2dDYWxsU3RhdHMiLCJwYXlsb2FkIiwicm9vbV9pZCIsInN1cHBvcnRzVm9pcCIsImdldEFsbEFjdGl2ZUNhbGxzIiwibGVuZ3RoIiwicm9vbSIsImdldFJvb20iLCJsb2dnZXIiLCJlcnJvciIsIm1lbWJlcnMiLCJnZXRKb2luZWRNZW1iZXJzIiwiaW5mbyIsInR5cGUiLCJwbGFjZUNhbGwiLCJ0cmFuc2ZlcmVlIiwiQ291bnRseUFuYWx5dGljcyIsImluc3RhbmNlIiwidHJhY2tTdGFydENhbGwiLCJWaWRlbyIsInN0YXJ0Q2FsbEFwcCIsInRlcm1pbmF0ZUNhbGxBcHAiLCJoYW5ndXBDYWxsQXBwIiwic2hhcmVkSW5zdGFuY2UiLCJnZXRDYWxsRm9yUm9vbSIsImxvZyIsImFkZENhbGxGb3JSb29tIiwic2V0Q2FsbExpc3RlbmVycyIsIm9uQ2FsbFN0YXRlQ2hhbmdlZCIsInN0YXRlIiwiY2xpIiwicHJlcGFyZVRvRW5jcnlwdCIsInJvb21JZCIsInN0b3BSaW5naW5nSWZQb3NzaWJsZSIsImNhbGxzIiwicmVqZWN0IiwiaGFuZ3VwIiwidmFsdWVzIiwiaGFzIiwiYW5zd2VyIiwic2V0QWN0aXZlQ2FsbFJvb21JZCIsInRyYWNrSm9pbkNhbGwiLCJDYWxsVHlwZSIsIkFjdGlvbiIsIlZpZXdSb29tIiwiRGlhbE51bWJlciIsImRpYWxOdW1iZXIiLCJudW1iZXIiLCJUcmFuc2ZlckNhbGxUb01hdHJpeElEIiwic3RhcnRUcmFuc2ZlclRvTWF0cml4SUQiLCJkZXN0aW5hdGlvbiIsImNvbnN1bHRGaXJzdCIsIlRyYW5zZmVyQ2FsbFRvUGhvbmVOdW1iZXIiLCJzdGFydFRyYW5zZmVyVG9QaG9uZU51bWJlciIsIndpbmRvdyIsIm14Q2FsbEhhbmRsZXIiLCJ2b2lwQ29uZmlnIiwiU2RrQ29uZmlnIiwib2JleUFzc2VydGVkSWRlbnRpdHkiLCJuYXRpdmVVc2VyIiwiYXNzZXJ0ZWRJZGVudGl0eU5hdGl2ZVVzZXJzIiwiVm9pcFVzZXJNYXBwZXIiLCJuYXRpdmVSb29tRm9yVmlydHVhbFJvb20iLCJzdGFydCIsImRpc3BhdGNoZXJSZWYiLCJyZWdpc3RlciIsIm9uQWN0aW9uIiwibmF2aWdhdG9yIiwibWVkaWFTZXNzaW9uIiwic2V0QWN0aW9uSGFuZGxlciIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsIlVJRmVhdHVyZSIsIlZvaXAiLCJvbiIsIm9uQ2FsbEluY29taW5nIiwiY2hlY2tQcm90b2NvbHMiLCJzdG9wIiwicmVtb3ZlTGlzdGVuZXIiLCJ1bnJlZ2lzdGVyIiwiYWRkIiwiZW1pdCIsIlNpbGVuY2VkQ2FsbHNDaGFuZ2VkIiwiYXJlQW55Q2FsbHNVbnNpbGVuY2VkIiwidW5TaWxlbmNlQ2FsbCIsImlzQ2FsbFNpbGVuY2VkIiwibWF4VHJpZXMiLCJwcm90b2NvbHMiLCJnZXRUaGlyZHBhcnR5UHJvdG9jb2xzIiwidW5kZWZpbmVkIiwic3VwcG9ydHNQc3RuUHJvdG9jb2wiLCJCb29sZWFuIiwicHN0blN1cHBvcnRQcmVmaXhlZCIsIlBzdG5TdXBwb3J0VXBkYXRlZCIsInN1cHBvcnRzU2lwTmF0aXZlVmlydHVhbCIsIlZpcnR1YWxSb29tU3VwcG9ydFVwZGF0ZWQiLCJlIiwicHN0blN1cHBvcnRDaGVja1RpbWVyIiwic2V0VGltZW91dCIsImdldFN1cHBvcnRzUHN0blByb3RvY29sIiwiZ2V0U3VwcG9ydHNWaXJ0dWFsUm9vbXMiLCJwc3RuTG9va3VwIiwicGhvbmVOdW1iZXIiLCJnZXRUaGlyZHBhcnR5VXNlciIsInNpcFZpcnR1YWxMb29rdXAiLCJuYXRpdmVNeGlkIiwic2lwTmF0aXZlTG9va3VwIiwidmlydHVhbE14aWQiLCJnZXRDYWxsQnlJZCIsImdldEFueUFjdGl2ZUNhbGwiLCJhY3RpdmVDYWxscyIsInB1c2giLCJnZXRBbGxBY3RpdmVDYWxsc05vdEluUm9vbSIsIm5vdEluVGhpc1Jvb21JZCIsImNhbGxzTm90SW5UaGF0Um9vbSIsImVudHJpZXMiLCJnZXRBbGxBY3RpdmVDYWxsc0ZvclBpcCIsIldpZGdldExheW91dFN0b3JlIiwiaGFzTWF4aW1pc2VkV2lkZ2V0IiwiZ2V0VHJhbnNmZXJlZUZvckNhbGxJZCIsInRyYW5zZmVyZWVzIiwiYXVkaW9JZCIsImF1ZGlvIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInBsYXlBdWRpbyIsImF1ZGlvUHJvbWlzZXMiLCJzZXQiLCJ0aGVuIiwibG9hZCIsImNhbGxGb3JUaGlzUm9vbSIsIkNhbGxFdmVudCIsIkVycm9yIiwiZXJyIiwidG9TdHJpbmciLCJjb2RlIiwiTm9Vc2VyTWVkaWEiLCJzaG93TWVkaWFDYXB0dXJlRXJyb3IiLCJnZXRUdXJuU2VydmVycyIsInNob3dJQ0VGYWxsYmFja1Byb21wdCIsIm1lc3NhZ2UiLCJIYW5ndXAiLCJTdGF0ZSIsIlJlcGxhY2VkIiwibmV3Q2FsbCIsIkFzc2VydGVkSWRlbnRpdHlDaGFuZ2VkIiwiZ2V0UmVtb3RlQXNzZXJ0ZWRJZGVudGl0eSIsIm5ld0Fzc2VydGVkSWRlbnRpdHkiLCJpZCIsIm5ld05hdGl2ZUFzc2VydGVkSWRlbnRpdHkiLCJyZXNwb25zZSIsImZpZWxkcyIsImxvb2t1cF9zdWNjZXNzIiwidXNlcmlkIiwibmV3TWFwcGVkUm9vbUlkIiwic3RhdHMiLCJnZXRDdXJyZW50Q2FsbFN0YXRzIiwiZGVidWciLCJkaXJlY3Rpb24iLCJvdXJQYXJ0eUlkIiwiY2FuZCIsImZpbHRlciIsIml0ZW0iLCJhZGRyZXNzIiwiaXAiLCJjYW5kaWRhdGVUeXBlIiwicG9ydCIsInByb3RvY29sIiwicmVsYXlQcm90b2NvbCIsIm5ldHdvcmtUeXBlIiwicGFpciIsImxvY2FsQ2FuZGlkYXRlSWQiLCJyZW1vdGVDYW5kaWRhdGVJZCIsIm5vbWluYXRlZCIsInJlcXVlc3RzU2VudCIsInJlcXVlc3RzUmVjZWl2ZWQiLCJyZXNwb25zZXNSZWNlaXZlZCIsInJlc3BvbnNlc1NlbnQiLCJieXRlc1JlY2VpdmVkIiwiYnl0ZXNTZW50Iiwic3RhdHVzIiwidG9hc3RLZXkiLCJUb2FzdFN0b3JlIiwiYWRkT3JSZXBsYWNlVG9hc3QiLCJrZXkiLCJwcmlvcml0eSIsImNvbXBvbmVudCIsIkluY29taW5nQ2FsbFRvYXN0IiwiYm9keUNsYXNzTmFtZSIsInByb3BzIiwiZGlzbWlzc1RvYXN0IiwiQ2FsbHNDaGFuZ2VkIiwic3ViIiwiUXVlc3Rpb25EaWFsb2ciLCJob21lc2VydmVyRG9tYWluIiwiZ2V0RG9tYWluIiwiYnV0dG9uIiwiY2FuY2VsQnV0dG9uIiwib25GaW5pc2hlZCIsImFsbG93Iiwic2V0VmFsdWUiLCJTZXR0aW5nTGV2ZWwiLCJERVZJQ0UiLCJzZXRGYWxsYmFja0lDRVNlcnZlckFsbG93ZWQiLCJWb2ljZSIsImdldE9yQ3JlYXRlVmlydHVhbFJvb21Gb3JSb29tIiwidGltZVVudGlsVHVybkNyZXNFeHBpcmUiLCJnZXRUdXJuU2VydmVyc0V4cGlyeSIsIkRhdGUiLCJub3ciLCJjcmVhdGVDYWxsIiwicGxhY2VWb2ljZUNhbGwiLCJwbGFjZVZpZGVvQ2FsbCIsInJlc3VsdHMiLCJ1c2VySWQiLCJuYXRpdmVVc2VySWQiLCJuYXRpdmVMb29rdXBSZXN1bHRzIiwibG9va3VwU3VjY2VzcyIsImRtUm9vbUlkIiwic2hvdWxkX3BlZWsiLCJqb2luaW5nIiwidHJhbnNmZXIiLCJhY3RpdmVDYWxsUm9vbUlkIiwic2V0UmVtb3RlT25Ib2xkIiwiaGFzQW55VW5oZWxkQ2FsbCIsImlzUmVtb3RlT25Ib2xkIiwic2hvdyIsImppdHNpV2lkZ2V0IiwiV2lkZ2V0U3RvcmUiLCJnZXRBcHBzIiwiZmluZCIsImFwcCIsIldpZGdldFR5cGUiLCJKSVRTSSIsIm1hdGNoZXMiLCJtb3ZlVG9Db250YWluZXIiLCJDb250YWluZXIiLCJUb3AiLCJqaXRzaURvbWFpbiIsIkppdHNpIiwiZ2V0SW5zdGFuY2UiLCJwcmVmZXJyZWREb21haW4iLCJqaXRzaUF1dGgiLCJnZXRKaXRzaUF1dGgiLCJjb25mSWQiLCJiYXNlMzIiLCJzdHJpbmdpZnkiLCJCdWZmZXIiLCJmcm9tIiwicGFkIiwicmFuZG9tIiwid2lkZ2V0VXJsIiwiV2lkZ2V0VXRpbHMiLCJnZXRMb2NhbEppdHNpV3JhcHBlclVybCIsImF1dGgiLCJwYXJzZWRVcmwiLCJVUkwiLCJzZWFyY2giLCJzZWFyY2hQYXJhbXMiLCJ3aWRnZXREYXRhIiwiY29uZmVyZW5jZUlkIiwiaXNBdWRpb09ubHkiLCJkb21haW4iLCJyb29tTmFtZSIsIm5hbWUiLCJ3aWRnZXRJZCIsImNyZWRlbnRpYWxzIiwic2V0Um9vbVdpZGdldCIsImNhdGNoIiwiZXJyY29kZSIsImhhc0NhbmNlbEJ1dHRvbiIsInByb2NlZWQiLCJyb29tSW5mbyIsImppdHNpV2lkZ2V0cyIsIndpZGdldHMiLCJ3IiwiZm9yRWFjaCIsIm1lc3NhZ2luZyIsIldpZGdldE1lc3NhZ2luZ1N0b3JlIiwiZ2V0TWVzc2FnaW5nRm9ySWQiLCJ0cmFuc3BvcnQiLCJzZW5kIiwiRWxlbWVudFdpZGdldEFjdGlvbnMiLCJIYW5ndXBDYWxsIiwiY2hhbmdlZFJvb21zIiwiQ2FsbENoYW5nZVJvb20iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBd0RBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUE1RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QztBQUNILEtBRkQsTUFFTztBQUNILFdBQUs0SSxJQUFMLENBQVVqSixnQkFBZ0IsQ0FBQytQLFlBQTNCLEVBQXlDLEtBQUs3SixLQUE5QztBQUNIO0FBQ0o7O0FBdmdDaUQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUsIDIwMTYgT3Blbk1hcmtldCBMdGRcbkNvcHlyaWdodCAyMDE3LCAyMDE4IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSAtIDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cbkNvcHlyaWdodCAyMDIxIMWgaW1vbiBCcmFuZG5lciA8c2ltb24uYnJhLmFnQGdtYWlsLmNvbT5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG4vKlxuICogTWFuYWdlcyBhIGxpc3Qgb2YgYWxsIHRoZSBjdXJyZW50bHkgYWN0aXZlIGNhbGxzLlxuICpcbiAqIFRoaXMgaGFuZGxlciBkaXNwYXRjaGVzIHdoZW4gdm9pcCBjYWxscyBhcmUgYWRkZWQvdXBkYXRlZC9yZW1vdmVkIGZyb20gdGhpcyBsaXN0OlxuICoge1xuICogICBhY3Rpb246ICdjYWxsX3N0YXRlJ1xuICogICByb29tX2lkOiA8cm9vbSBJRCBvZiB0aGUgY2FsbD5cbiAqIH1cbiAqXG4gKiBUbyBrbm93IHRoZSBzdGF0ZSBvZiB0aGUgY2FsbCwgdGhpcyBoYW5kbGVyIGV4cG9zZXMgYSBnZXR0ZXIgdG9cbiAqIG9idGFpbiB0aGUgY2FsbCBmb3IgYSByb29tOlxuICogICB2YXIgY2FsbCA9IENhbGxIYW5kbGVyLmdldENhbGwocm9vbUlkKVxuICogICB2YXIgc3RhdGUgPSBjYWxsLmNhbGxfc3RhdGU7IC8vIHJpbmdpbmd8cmluZ2JhY2t8Y29ubmVjdGVkfGVuZGVkfGJ1c3l8c3RvcF9yaW5nYmFja3xzdG9wX3JpbmdpbmdcbiAqXG4gKiBUaGlzIGhhbmRsZXIgbGlzdGVucyBmb3IgYW5kIGhhbmRsZXMgdGhlIGZvbGxvd2luZyBhY3Rpb25zOlxuICoge1xuICogICBhY3Rpb246ICdwbGFjZV9jYWxsJyxcbiAqICAgdHlwZTogJ3ZvaWNlfHZpZGVvJyxcbiAqICAgcm9vbV9pZDogPHJvb20gdGhhdCB0aGUgcGxhY2UgY2FsbCBidXR0b24gd2FzIHByZXNzZWQgaW4+XG4gKiB9XG4gKlxuICoge1xuICogICBhY3Rpb246ICdpbmNvbWluZ19jYWxsJ1xuICogICBjYWxsOiBNYXRyaXhDYWxsXG4gKiB9XG4gKlxuICoge1xuICogICBhY3Rpb246ICdoYW5ndXAnXG4gKiAgIHJvb21faWQ6IDxyb29tIHRoYXQgdGhlIGhhbmd1cCBidXR0b24gd2FzIHByZXNzZWQgaW4+XG4gKiB9XG4gKlxuICoge1xuICogICBhY3Rpb246ICdhbnN3ZXInXG4gKiAgIHJvb21faWQ6IDxyb29tIHRoYXQgdGhlIGFuc3dlciBidXR0b24gd2FzIHByZXNzZWQgaW4+XG4gKiB9XG4gKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSAnLi9NYXRyaXhDbGllbnRQZWcnO1xuaW1wb3J0IE1vZGFsIGZyb20gJy4vTW9kYWwnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgZGlzIGZyb20gJy4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyJztcbmltcG9ydCBXaWRnZXRVdGlscyBmcm9tICcuL3V0aWxzL1dpZGdldFV0aWxzJztcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gJy4vc2V0dGluZ3MvU2V0dGluZ3NTdG9yZSc7XG5pbXBvcnQgeyBKaXRzaSB9IGZyb20gXCIuL3dpZGdldHMvSml0c2lcIjtcbmltcG9ydCB7IFdpZGdldFR5cGUgfSBmcm9tIFwiLi93aWRnZXRzL1dpZGdldFR5cGVcIjtcbmltcG9ydCB7IFNldHRpbmdMZXZlbCB9IGZyb20gXCIuL3NldHRpbmdzL1NldHRpbmdMZXZlbFwiO1xuaW1wb3J0IHsgQWN0aW9uUGF5bG9hZCB9IGZyb20gXCIuL2Rpc3BhdGNoZXIvcGF5bG9hZHNcIjtcbmltcG9ydCB7IGJhc2UzMiB9IGZyb20gXCJyZmM0NjQ4XCI7XG5cbmltcG9ydCBRdWVzdGlvbkRpYWxvZyBmcm9tIFwiLi9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvUXVlc3Rpb25EaWFsb2dcIjtcbmltcG9ydCBFcnJvckRpYWxvZyBmcm9tIFwiLi9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvRXJyb3JEaWFsb2dcIjtcbmltcG9ydCBXaWRnZXRTdG9yZSBmcm9tIFwiLi9zdG9yZXMvV2lkZ2V0U3RvcmVcIjtcbmltcG9ydCB7IFdpZGdldE1lc3NhZ2luZ1N0b3JlIH0gZnJvbSBcIi4vc3RvcmVzL3dpZGdldHMvV2lkZ2V0TWVzc2FnaW5nU3RvcmVcIjtcbmltcG9ydCB7IEVsZW1lbnRXaWRnZXRBY3Rpb25zIH0gZnJvbSBcIi4vc3RvcmVzL3dpZGdldHMvRWxlbWVudFdpZGdldEFjdGlvbnNcIjtcbmltcG9ydCB7IE1hdHJpeENhbGwsIENhbGxFcnJvckNvZGUsIENhbGxTdGF0ZSwgQ2FsbEV2ZW50LCBDYWxsUGFydHksIENhbGxUeXBlIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL3dlYnJ0Yy9jYWxsXCI7XG5pbXBvcnQgQW5hbHl0aWNzIGZyb20gJy4vQW5hbHl0aWNzJztcbmltcG9ydCBDb3VudGx5QW5hbHl0aWNzIGZyb20gXCIuL0NvdW50bHlBbmFseXRpY3NcIjtcbmltcG9ydCB7IFVJRmVhdHVyZSB9IGZyb20gXCIuL3NldHRpbmdzL1VJRmVhdHVyZVwiO1xuaW1wb3J0IHsgQ2FsbEVycm9yIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL3dlYnJ0Yy9jYWxsXCI7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXInO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi9kaXNwYXRjaGVyL2FjdGlvbnMnO1xuaW1wb3J0IFZvaXBVc2VyTWFwcGVyIGZyb20gJy4vVm9pcFVzZXJNYXBwZXInO1xuaW1wb3J0IHsgYWRkTWFuYWdlZEh5YnJpZFdpZGdldCwgaXNNYW5hZ2VkSHlicmlkV2lkZ2V0RW5hYmxlZCB9IGZyb20gJy4vd2lkZ2V0cy9NYW5hZ2VkSHlicmlkJztcbmltcG9ydCB7IHJhbmRvbVVwcGVyY2FzZVN0cmluZywgcmFuZG9tTG93ZXJjYXNlU3RyaW5nIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL3JhbmRvbXN0cmluZ1wiO1xuaW1wb3J0IEV2ZW50RW1pdHRlciBmcm9tICdldmVudHMnO1xuaW1wb3J0IFNka0NvbmZpZyBmcm9tICcuL1Nka0NvbmZpZyc7XG5pbXBvcnQgeyBlbnN1cmVETUV4aXN0cywgZmluZERNRm9yVXNlciB9IGZyb20gJy4vY3JlYXRlUm9vbSc7XG5pbXBvcnQgeyBSdWxlSWQsIFR3ZWFrTmFtZSwgVHdlYWtzIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL0B0eXBlcy9QdXNoUnVsZXNcIjtcbmltcG9ydCB7IFB1c2hQcm9jZXNzb3IgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9wdXNocHJvY2Vzc29yJztcbmltcG9ydCB7IFdpZGdldExheW91dFN0b3JlLCBDb250YWluZXIgfSBmcm9tICcuL3N0b3Jlcy93aWRnZXRzL1dpZGdldExheW91dFN0b3JlJztcbmltcG9ydCB7IGdldEluY29taW5nQ2FsbFRvYXN0S2V5IH0gZnJvbSAnLi90b2FzdHMvSW5jb21pbmdDYWxsVG9hc3QnO1xuaW1wb3J0IFRvYXN0U3RvcmUgZnJvbSAnLi9zdG9yZXMvVG9hc3RTdG9yZSc7XG5pbXBvcnQgSW5jb21pbmdDYWxsVG9hc3QgZnJvbSBcIi4vdG9hc3RzL0luY29taW5nQ2FsbFRvYXN0XCI7XG5cbmV4cG9ydCBjb25zdCBQUk9UT0NPTF9QU1ROID0gJ20ucHJvdG9jb2wucHN0bic7XG5leHBvcnQgY29uc3QgUFJPVE9DT0xfUFNUTl9QUkVGSVhFRCA9ICdpbS52ZWN0b3IucHJvdG9jb2wucHN0bic7XG5leHBvcnQgY29uc3QgUFJPVE9DT0xfU0lQX05BVElWRSA9ICdpbS52ZWN0b3IucHJvdG9jb2wuc2lwX25hdGl2ZSc7XG5leHBvcnQgY29uc3QgUFJPVE9DT0xfU0lQX1ZJUlRVQUwgPSAnaW0udmVjdG9yLnByb3RvY29sLnNpcF92aXJ0dWFsJztcblxuY29uc3QgQ0hFQ0tfUFJPVE9DT0xTX0FUVEVNUFRTID0gMztcbi8vIEV2ZW50IHR5cGUgZm9yIHJvb20gYWNjb3VudCBkYXRhIGFuZCByb29tIGNyZWF0aW9uIGNvbnRlbnQgdXNlZCB0byBtYXJrIHJvb21zIGFzIHZpcnR1YWwgcm9vbXNcbi8vIChhbmQgc3RvcmUgdGhlIElEIG9mIHRoZWlyIG5hdGl2ZSByb29tKVxuZXhwb3J0IGNvbnN0IFZJUlRVQUxfUk9PTV9FVkVOVF9UWVBFID0gJ2ltLnZlY3Rvci5pc192aXJ0dWFsX3Jvb20nO1xuXG5lbnVtIEF1ZGlvSUQge1xuICAgIFJpbmcgPSAncmluZ0F1ZGlvJyxcbiAgICBSaW5nYmFjayA9ICdyaW5nYmFja0F1ZGlvJyxcbiAgICBDYWxsRW5kID0gJ2NhbGxlbmRBdWRpbycsXG4gICAgQnVzeSA9ICdidXN5QXVkaW8nLFxufVxuXG5pbnRlcmZhY2UgVGhpcmRwYXJ0eUxvb2t1cFJlc3BvbnNlRmllbGRzIHtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBjYW1lbGNhc2UgKi9cblxuICAgIC8vIGltLnZlY3Rvci5zaXBfbmF0aXZlXG4gICAgdmlydHVhbF9teGlkPzogc3RyaW5nO1xuICAgIGlzX3ZpcnR1YWw/OiBib29sZWFuO1xuXG4gICAgLy8gaW0udmVjdG9yLnNpcF92aXJ0dWFsXG4gICAgbmF0aXZlX214aWQ/OiBzdHJpbmc7XG4gICAgaXNfbmF0aXZlPzogYm9vbGVhbjtcblxuICAgIC8vIGNvbW1vblxuICAgIGxvb2t1cF9zdWNjZXNzPzogYm9vbGVhbjtcblxuICAgIC8qIGVzbGludC1lbmFibGUgY2FtZWxjYXNlICovXG59XG5cbmludGVyZmFjZSBUaGlyZHBhcnR5TG9va3VwUmVzcG9uc2Uge1xuICAgIHVzZXJpZDogc3RyaW5nO1xuICAgIHByb3RvY29sOiBzdHJpbmc7XG4gICAgZmllbGRzOiBUaGlyZHBhcnR5TG9va3VwUmVzcG9uc2VGaWVsZHM7XG59XG5cbmV4cG9ydCBlbnVtIFBsYWNlQ2FsbFR5cGUge1xuICAgIFZvaWNlID0gJ3ZvaWNlJyxcbiAgICBWaWRlbyA9ICd2aWRlbycsXG59XG5cbmV4cG9ydCBlbnVtIENhbGxIYW5kbGVyRXZlbnQge1xuICAgIENhbGxzQ2hhbmdlZCA9IFwiY2FsbHNfY2hhbmdlZFwiLFxuICAgIENhbGxDaGFuZ2VSb29tID0gXCJjYWxsX2NoYW5nZV9yb29tXCIsXG4gICAgU2lsZW5jZWRDYWxsc0NoYW5nZWQgPSBcInNpbGVuY2VkX2NhbGxzX2NoYW5nZWRcIixcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FsbEhhbmRsZXIgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICAgIHByaXZhdGUgY2FsbHMgPSBuZXcgTWFwPHN0cmluZywgTWF0cml4Q2FsbD4oKTsgLy8gcm9vbUlkIC0+IGNhbGxcbiAgICAvLyBDYWxscyBzdGFydGVkIGFzIGFuIGF0dGVuZGVkIHRyYW5zZmVyLCBpZS4gd2l0aCB0aGUgaW50ZW50aW9uIG9mIHRyYW5zZmVycmluZyBhbm90aGVyXG4gICAgLy8gY2FsbCB3aXRoIGEgZGlmZmVyZW50IHBhcnR5IHRvIHRoaXMgb25lLlxuICAgIHByaXZhdGUgdHJhbnNmZXJlZXMgPSBuZXcgTWFwPHN0cmluZywgTWF0cml4Q2FsbD4oKTsgLy8gY2FsbElkICh0YXJnZXQpIC0+IGNhbGwgKHRyYW5zZmVyZWUpXG4gICAgcHJpdmF0ZSBhdWRpb1Byb21pc2VzID0gbmV3IE1hcDxBdWRpb0lELCBQcm9taXNlPHZvaWQ+PigpO1xuICAgIHByaXZhdGUgZGlzcGF0Y2hlclJlZjogc3RyaW5nID0gbnVsbDtcbiAgICBwcml2YXRlIHN1cHBvcnRzUHN0blByb3RvY29sID0gbnVsbDtcbiAgICBwcml2YXRlIHBzdG5TdXBwb3J0UHJlZml4ZWQgPSBudWxsOyAvLyBUcnVlIGlmIHRoZSBzZXJ2ZXIgb25seSBzdXBwb3J0IHRoZSBwcmVmaXhlZCBwc3RuIHByb3RvY29sXG4gICAgcHJpdmF0ZSBzdXBwb3J0c1NpcE5hdGl2ZVZpcnR1YWwgPSBudWxsOyAvLyBpbS52ZWN0b3IucHJvdG9jb2wuc2lwX3ZpcnR1YWwgYW5kIGltLnZlY3Rvci5wcm90b2NvbC5zaXBfbmF0aXZlXG4gICAgcHJpdmF0ZSBwc3RuU3VwcG9ydENoZWNrVGltZXI6IG51bWJlcjtcbiAgICAvLyBGb3Igcm9vbXMgd2UndmUgYmVlbiBpbnZpdGVkIHRvLCB0cnVlIGlmIHRoZXkncmUgZnJvbSB2aXJ0dWFsIHVzZXIsIGZhbHNlIGlmIHdlJ3ZlIGNoZWNrZWQgYW5kIHRoZXkgYXJlbid0LlxuICAgIHByaXZhdGUgaW52aXRlZFJvb21zQXJlVmlydHVhbCA9IG5ldyBNYXA8c3RyaW5nLCBib29sZWFuPigpO1xuICAgIHByaXZhdGUgaW52aXRlZFJvb21DaGVja0luUHJvZ3Jlc3MgPSBmYWxzZTtcblxuICAgIC8vIE1hcCBvZiB0aGUgYXNzZXJ0ZWQgaWRlbnRpdHkgdXNlcnMgYWZ0ZXIgd2UndmUgbG9va2VkIHRoZW0gdXAgdXNpbmcgdGhlIEFQSS5cbiAgICAvLyBXZSBuZWVkIHRvIGJlIGJlIGFibGUgdG8gZGV0ZXJtaW5lIHRoZSBtYXBwZWQgcm9vbSBzeW5jaHJvbm91c2x5LCBzbyB3ZVxuICAgIC8vIGRvIHRoZSBhc3luYyBsb29rdXAgd2hlbiB3ZSBnZXQgbmV3IGluZm9ybWF0aW9uIGFuZCB0aGVuIHN0b3JlIHRoZXNlIG1hcHBpbmdzIGhlcmVcbiAgICBwcml2YXRlIGFzc2VydGVkSWRlbnRpdHlOYXRpdmVVc2VycyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG5cbiAgICBwcml2YXRlIHNpbGVuY2VkQ2FsbHMgPSBuZXcgU2V0PHN0cmluZz4oKTsgLy8gY2FsbElkc1xuXG4gICAgc3RhdGljIHNoYXJlZEluc3RhbmNlKCkge1xuICAgICAgICBpZiAoIXdpbmRvdy5teENhbGxIYW5kbGVyKSB7XG4gICAgICAgICAgICB3aW5kb3cubXhDYWxsSGFuZGxlciA9IG5ldyBDYWxsSGFuZGxlcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHdpbmRvdy5teENhbGxIYW5kbGVyO1xuICAgIH1cblxuICAgIC8qXG4gICAgICogR2V0cyB0aGUgdXNlci1mYWNpbmcgcm9vbSBhc3NvY2lhdGVkIHdpdGggYSBjYWxsIChjYWxsLnJvb21JZCBtYXkgYmUgdGhlIGNhbGwgXCJ2aXJ0dWFsIHJvb21cIlxuICAgICAqIGlmIGEgdm9pcF9teGlkX3RyYW5zbGF0ZV9wYXR0ZXJuIGlzIHNldCBpbiB0aGUgY29uZmlnKVxuICAgICAqL1xuICAgIHB1YmxpYyByb29tSWRGb3JDYWxsKGNhbGw6IE1hdHJpeENhbGwpOiBzdHJpbmcge1xuICAgICAgICBpZiAoIWNhbGwpIHJldHVybiBudWxsO1xuXG4gICAgICAgIGNvbnN0IHZvaXBDb25maWcgPSBTZGtDb25maWcuZ2V0KClbJ3ZvaXAnXTtcblxuICAgICAgICBpZiAodm9pcENvbmZpZyAmJiB2b2lwQ29uZmlnLm9iZXlBc3NlcnRlZElkZW50aXR5KSB7XG4gICAgICAgICAgICBjb25zdCBuYXRpdmVVc2VyID0gdGhpcy5hc3NlcnRlZElkZW50aXR5TmF0aXZlVXNlcnNbY2FsbC5jYWxsSWRdO1xuICAgICAgICAgICAgaWYgKG5hdGl2ZVVzZXIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByb29tID0gZmluZERNRm9yVXNlcihNYXRyaXhDbGllbnRQZWcuZ2V0KCksIG5hdGl2ZVVzZXIpO1xuICAgICAgICAgICAgICAgIGlmIChyb29tKSByZXR1cm4gcm9vbS5yb29tSWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gVm9pcFVzZXJNYXBwZXIuc2hhcmVkSW5zdGFuY2UoKS5uYXRpdmVSb29tRm9yVmlydHVhbFJvb20oY2FsbC5yb29tSWQpIHx8IGNhbGwucm9vbUlkO1xuICAgIH1cblxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLmRpc3BhdGNoZXJSZWYgPSBkaXMucmVnaXN0ZXIodGhpcy5vbkFjdGlvbik7XG4gICAgICAgIC8vIGFkZCBlbXB0eSBoYW5kbGVycyBmb3IgbWVkaWEgYWN0aW9ucywgb3RoZXJ3aXNlIHRoZSBtZWRpYSBrZXlzXG4gICAgICAgIC8vIGVuZCB1cCBjYXVzaW5nIHRoZSBhdWRpbyBlbGVtZW50cyB3aXRoIG91ciByaW5nL3JpbmdiYWNrIGV0Y1xuICAgICAgICAvLyBhdWRpbyBjbGlwcyBpbiB0byBwbGF5LlxuICAgICAgICBpZiAobmF2aWdhdG9yLm1lZGlhU2Vzc2lvbikge1xuICAgICAgICAgICAgbmF2aWdhdG9yLm1lZGlhU2Vzc2lvbi5zZXRBY3Rpb25IYW5kbGVyKCdwbGF5JywgZnVuY3Rpb24oKSB7fSk7XG4gICAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFTZXNzaW9uLnNldEFjdGlvbkhhbmRsZXIoJ3BhdXNlJywgZnVuY3Rpb24oKSB7fSk7XG4gICAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFTZXNzaW9uLnNldEFjdGlvbkhhbmRsZXIoJ3NlZWtiYWNrd2FyZCcsIGZ1bmN0aW9uKCkge30pO1xuICAgICAgICAgICAgbmF2aWdhdG9yLm1lZGlhU2Vzc2lvbi5zZXRBY3Rpb25IYW5kbGVyKCdzZWVrZm9yd2FyZCcsIGZ1bmN0aW9uKCkge30pO1xuICAgICAgICAgICAgbmF2aWdhdG9yLm1lZGlhU2Vzc2lvbi5zZXRBY3Rpb25IYW5kbGVyKCdwcmV2aW91c3RyYWNrJywgZnVuY3Rpb24oKSB7fSk7XG4gICAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFTZXNzaW9uLnNldEFjdGlvbkhhbmRsZXIoJ25leHR0cmFjaycsIGZ1bmN0aW9uKCkge30pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoVUlGZWF0dXJlLlZvaXApKSB7XG4gICAgICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkub24oJ0NhbGwuaW5jb21pbmcnLCB0aGlzLm9uQ2FsbEluY29taW5nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2hlY2tQcm90b2NvbHMoQ0hFQ0tfUFJPVE9DT0xTX0FUVEVNUFRTKTtcbiAgICB9XG5cbiAgICBzdG9wKCkge1xuICAgICAgICBjb25zdCBjbGkgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGlmIChjbGkpIHtcbiAgICAgICAgICAgIGNsaS5yZW1vdmVMaXN0ZW5lcignQ2FsbC5pbmNvbWluZycsIHRoaXMub25DYWxsSW5jb21pbmcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRpc3BhdGNoZXJSZWYgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGRpcy51bnJlZ2lzdGVyKHRoaXMuZGlzcGF0Y2hlclJlZik7XG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoZXJSZWYgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHNpbGVuY2VDYWxsKGNhbGxJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc2lsZW5jZWRDYWxscy5hZGQoY2FsbElkKTtcbiAgICAgICAgdGhpcy5lbWl0KENhbGxIYW5kbGVyRXZlbnQuU2lsZW5jZWRDYWxsc0NoYW5nZWQsIHRoaXMuc2lsZW5jZWRDYWxscyk7XG5cbiAgICAgICAgLy8gRG9uJ3QgcGF1c2UgYXVkaW8gaWYgd2UgaGF2ZSBjYWxscyB3aGljaCBhcmUgc3RpbGwgcmluZ2luZ1xuICAgICAgICBpZiAodGhpcy5hcmVBbnlDYWxsc1Vuc2lsZW5jZWQoKSkgcmV0dXJuO1xuICAgICAgICB0aGlzLnBhdXNlKEF1ZGlvSUQuUmluZyk7XG4gICAgfVxuXG4gICAgcHVibGljIHVuU2lsZW5jZUNhbGwoY2FsbElkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5zaWxlbmNlZENhbGxzLmRlbGV0ZShjYWxsSWQpO1xuICAgICAgICB0aGlzLmVtaXQoQ2FsbEhhbmRsZXJFdmVudC5TaWxlbmNlZENhbGxzQ2hhbmdlZCwgdGhpcy5zaWxlbmNlZENhbGxzKTtcbiAgICAgICAgdGhpcy5wbGF5KEF1ZGlvSUQuUmluZyk7XG4gICAgfVxuXG4gICAgcHVibGljIGlzQ2FsbFNpbGVuY2VkKGNhbGxJZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNpbGVuY2VkQ2FsbHMuaGFzKGNhbGxJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSB1bnNpbGVuY2VkIGNhbGxcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBwcml2YXRlIGFyZUFueUNhbGxzVW5zaWxlbmNlZCgpOiBib29sZWFuIHtcbiAgICAgICAgZm9yIChjb25zdCBjYWxsIG9mIHRoaXMuY2FsbHMudmFsdWVzKCkpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBjYWxsLnN0YXRlID09PSBDYWxsU3RhdGUuUmluZ2luZyAmJlxuICAgICAgICAgICAgICAgICF0aGlzLmlzQ2FsbFNpbGVuY2VkKGNhbGwuY2FsbElkKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgY2hlY2tQcm90b2NvbHMobWF4VHJpZXMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHByb3RvY29scyA9IGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRUaGlyZHBhcnR5UHJvdG9jb2xzKCk7XG5cbiAgICAgICAgICAgIGlmIChwcm90b2NvbHNbUFJPVE9DT0xfUFNUTl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3VwcG9ydHNQc3RuUHJvdG9jb2wgPSBCb29sZWFuKHByb3RvY29sc1tQUk9UT0NPTF9QU1ROXSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3VwcG9ydHNQc3RuUHJvdG9jb2wpIHRoaXMucHN0blN1cHBvcnRQcmVmaXhlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwcm90b2NvbHNbUFJPVE9DT0xfUFNUTl9QUkVGSVhFRF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3VwcG9ydHNQc3RuUHJvdG9jb2wgPSBCb29sZWFuKHByb3RvY29sc1tQUk9UT0NPTF9QU1ROX1BSRUZJWEVEXSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3VwcG9ydHNQc3RuUHJvdG9jb2wpIHRoaXMucHN0blN1cHBvcnRQcmVmaXhlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3VwcG9ydHNQc3RuUHJvdG9jb2wgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkaXMuZGlzcGF0Y2goeyBhY3Rpb246IEFjdGlvbi5Qc3RuU3VwcG9ydFVwZGF0ZWQgfSk7XG5cbiAgICAgICAgICAgIGlmIChwcm90b2NvbHNbUFJPVE9DT0xfU0lQX05BVElWRV0gIT09IHVuZGVmaW5lZCAmJiBwcm90b2NvbHNbUFJPVE9DT0xfU0lQX1ZJUlRVQUxdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN1cHBvcnRzU2lwTmF0aXZlVmlydHVhbCA9IEJvb2xlYW4oXG4gICAgICAgICAgICAgICAgICAgIHByb3RvY29sc1tQUk9UT0NPTF9TSVBfTkFUSVZFXSAmJiBwcm90b2NvbHNbUFJPVE9DT0xfU0lQX1ZJUlRVQUxdLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7IGFjdGlvbjogQWN0aW9uLlZpcnR1YWxSb29tU3VwcG9ydFVwZGF0ZWQgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGlmIChtYXhUcmllcyA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coXCJGYWlsZWQgdG8gY2hlY2sgZm9yIHByb3RvY29sIHN1cHBvcnQgYW5kIG5vIHJldHJpZXMgcmVtYWluOiBhc3N1bWluZyBubyBzdXBwb3J0XCIsIGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIubG9nKFwiRmFpbGVkIHRvIGNoZWNrIGZvciBwcm90b2NvbCBzdXBwb3J0OiB3aWxsIHJldHJ5XCIsIGUpO1xuICAgICAgICAgICAgICAgIHRoaXMucHN0blN1cHBvcnRDaGVja1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tQcm90b2NvbHMobWF4VHJpZXMgLSAxKTtcbiAgICAgICAgICAgICAgICB9LCAxMDAwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U3VwcG9ydHNQc3RuUHJvdG9jb2woKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN1cHBvcnRzUHN0blByb3RvY29sO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRTdXBwb3J0c1ZpcnR1YWxSb29tcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3VwcG9ydHNTaXBOYXRpdmVWaXJ0dWFsO1xuICAgIH1cblxuICAgIHB1YmxpYyBwc3RuTG9va3VwKHBob25lTnVtYmVyOiBzdHJpbmcpOiBQcm9taXNlPFRoaXJkcGFydHlMb29rdXBSZXNwb25zZVtdPiB7XG4gICAgICAgIHJldHVybiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0VGhpcmRwYXJ0eVVzZXIoXG4gICAgICAgICAgICB0aGlzLnBzdG5TdXBwb3J0UHJlZml4ZWQgPyBQUk9UT0NPTF9QU1ROX1BSRUZJWEVEIDogUFJPVE9DT0xfUFNUTiwge1xuICAgICAgICAgICAgICAgICdtLmlkLnBob25lJzogcGhvbmVOdW1iZXIsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBzaXBWaXJ0dWFsTG9va3VwKG5hdGl2ZU14aWQ6IHN0cmluZyk6IFByb21pc2U8VGhpcmRwYXJ0eUxvb2t1cFJlc3BvbnNlW10+IHtcbiAgICAgICAgcmV0dXJuIE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRUaGlyZHBhcnR5VXNlcihcbiAgICAgICAgICAgIFBST1RPQ09MX1NJUF9WSVJUVUFMLCB7XG4gICAgICAgICAgICAgICAgJ25hdGl2ZV9teGlkJzogbmF0aXZlTXhpZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHNpcE5hdGl2ZUxvb2t1cCh2aXJ0dWFsTXhpZDogc3RyaW5nKTogUHJvbWlzZTxUaGlyZHBhcnR5TG9va3VwUmVzcG9uc2VbXT4ge1xuICAgICAgICByZXR1cm4gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFRoaXJkcGFydHlVc2VyKFxuICAgICAgICAgICAgUFJPVE9DT0xfU0lQX05BVElWRSwge1xuICAgICAgICAgICAgICAgICd2aXJ0dWFsX214aWQnOiB2aXJ0dWFsTXhpZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkNhbGxJbmNvbWluZyA9IChjYWxsKSA9PiB7XG4gICAgICAgIC8vIHdlIGRpc3BhdGNoIHRoaXMgc3luY2hyb25vdXNseSB0byBtYWtlIHN1cmUgdGhhdCB0aGUgZXZlbnRcbiAgICAgICAgLy8gaGFuZGxlcnMgb24gdGhlIGNhbGwgYXJlIHNldCB1cCBpbW1lZGlhdGVseSAoc28gdGhhdCBpZlxuICAgICAgICAvLyB3ZSBnZXQgYW4gaW1tZWRpYXRlIGhhbmd1cCwgd2UgZG9uJ3QgZ2V0IGEgc3R1Y2sgY2FsbClcbiAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2luY29taW5nX2NhbGwnLFxuICAgICAgICAgICAgY2FsbDogY2FsbCxcbiAgICAgICAgfSwgdHJ1ZSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBnZXRDYWxsQnlJZChjYWxsSWQ6IHN0cmluZyk6IE1hdHJpeENhbGwge1xuICAgICAgICBmb3IgKGNvbnN0IGNhbGwgb2YgdGhpcy5jYWxscy52YWx1ZXMoKSkge1xuICAgICAgICAgICAgaWYgKGNhbGwuY2FsbElkID09PSBjYWxsSWQpIHJldHVybiBjYWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGdldENhbGxGb3JSb29tKHJvb21JZDogc3RyaW5nKTogTWF0cml4Q2FsbCB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGxzLmdldChyb29tSWQpIHx8IG51bGw7XG4gICAgfVxuXG4gICAgZ2V0QW55QWN0aXZlQ2FsbCgpIHtcbiAgICAgICAgZm9yIChjb25zdCBjYWxsIG9mIHRoaXMuY2FsbHMudmFsdWVzKCkpIHtcbiAgICAgICAgICAgIGlmIChjYWxsLnN0YXRlICE9PSBDYWxsU3RhdGUuRW5kZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBnZXRBbGxBY3RpdmVDYWxscygpIHtcbiAgICAgICAgY29uc3QgYWN0aXZlQ2FsbHMgPSBbXTtcblxuICAgICAgICBmb3IgKGNvbnN0IGNhbGwgb2YgdGhpcy5jYWxscy52YWx1ZXMoKSkge1xuICAgICAgICAgICAgaWYgKGNhbGwuc3RhdGUgIT09IENhbGxTdGF0ZS5FbmRlZCAmJiBjYWxsLnN0YXRlICE9PSBDYWxsU3RhdGUuUmluZ2luZykge1xuICAgICAgICAgICAgICAgIGFjdGl2ZUNhbGxzLnB1c2goY2FsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjdGl2ZUNhbGxzO1xuICAgIH1cblxuICAgIGdldEFsbEFjdGl2ZUNhbGxzTm90SW5Sb29tKG5vdEluVGhpc1Jvb21JZCkge1xuICAgICAgICBjb25zdCBjYWxsc05vdEluVGhhdFJvb20gPSBbXTtcblxuICAgICAgICBmb3IgKGNvbnN0IFtyb29tSWQsIGNhbGxdIG9mIHRoaXMuY2FsbHMuZW50cmllcygpKSB7XG4gICAgICAgICAgICBpZiAocm9vbUlkICE9PSBub3RJblRoaXNSb29tSWQgJiYgY2FsbC5zdGF0ZSAhPT0gQ2FsbFN0YXRlLkVuZGVkKSB7XG4gICAgICAgICAgICAgICAgY2FsbHNOb3RJblRoYXRSb29tLnB1c2goY2FsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNhbGxzTm90SW5UaGF0Um9vbTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0QWxsQWN0aXZlQ2FsbHNGb3JQaXAocm9vbUlkOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgcm9vbSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRSb29tKHJvb21JZCk7XG4gICAgICAgIGlmIChXaWRnZXRMYXlvdXRTdG9yZS5pbnN0YW5jZS5oYXNNYXhpbWlzZWRXaWRnZXQocm9vbSkpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgY2hlY2tzIGlmIHRoZXJlIGlzIHNwYWNlIGZvciB0aGUgY2FsbCB2aWV3IGluIHRoZSBhdXggcGFuZWxcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIHNwYWNlIGFueSBjYWxsIHNob3VsZCBiZSBkaXNwbGF5ZWQgaW4gUGlQXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxBY3RpdmVDYWxscygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFsbEFjdGl2ZUNhbGxzTm90SW5Sb29tKHJvb21JZCk7XG4gICAgfVxuXG4gICAgZ2V0VHJhbnNmZXJlZUZvckNhbGxJZChjYWxsSWQ6IHN0cmluZyk6IE1hdHJpeENhbGwge1xuICAgICAgICByZXR1cm4gdGhpcy50cmFuc2ZlcmVlc1tjYWxsSWRdO1xuICAgIH1cblxuICAgIHBsYXkoYXVkaW9JZDogQXVkaW9JRCkge1xuICAgICAgICAvLyBUT0RPOiBBdHRhY2ggYW4gaW52aXNpYmxlIGVsZW1lbnQgZm9yIHRoaXMgaW5zdGVhZFxuICAgICAgICAvLyB3aGljaCBsaXN0ZW5zP1xuICAgICAgICBjb25zdCBhdWRpbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGF1ZGlvSWQpIGFzIEhUTUxNZWRpYUVsZW1lbnQ7XG4gICAgICAgIGlmIChhdWRpbykge1xuICAgICAgICAgICAgY29uc3QgcGxheUF1ZGlvID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgc3RpbGwgY2F1c2VzIHRoZSBjaHJvbWUgZGVidWdnZXIgdG8gYnJlYWsgb24gcHJvbWlzZSByZWplY3Rpb24gaWZcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHByb21pc2UgaXMgcmVqZWN0ZWQsIGV2ZW4gdGhvdWdoIHdlJ3JlIGNhdGNoaW5nIHRoZSBleGNlcHRpb24uXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGF1ZGlvLnBsYXkoKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdXN1YWxseSBiZWNhdXNlIHRoZSB1c2VyIGhhc24ndCBpbnRlcmFjdGVkIHdpdGggdGhlIGRvY3VtZW50LFxuICAgICAgICAgICAgICAgICAgICAvLyBvciBjaHJvbWUgZG9lc24ndCB0aGluayBzbyBhbmQgaXMgZGVueWluZyB0aGUgcmVxdWVzdC4gTm90IHN1cmUgd2hhdFxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBjYW4gcmVhbGx5IGRvIGhlcmUuLi5cbiAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3ZlY3Rvci1pbS9lbGVtZW50LXdlYi9pc3N1ZXMvNzY1N1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKFwiVW5hYmxlIHRvIHBsYXkgYXVkaW8gY2xpcFwiLCBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHRoaXMuYXVkaW9Qcm9taXNlcy5oYXMoYXVkaW9JZCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvUHJvbWlzZXMuc2V0KGF1ZGlvSWQsIHRoaXMuYXVkaW9Qcm9taXNlcy5nZXQoYXVkaW9JZCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGF1ZGlvLmxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsYXlBdWRpbygpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdWRpb1Byb21pc2VzLnNldChhdWRpb0lkLCBwbGF5QXVkaW8oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwYXVzZShhdWRpb0lkOiBBdWRpb0lEKSB7XG4gICAgICAgIC8vIFRPRE86IEF0dGFjaCBhbiBpbnZpc2libGUgZWxlbWVudCBmb3IgdGhpcyBpbnN0ZWFkXG4gICAgICAgIC8vIHdoaWNoIGxpc3RlbnM/XG4gICAgICAgIGNvbnN0IGF1ZGlvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYXVkaW9JZCkgYXMgSFRNTE1lZGlhRWxlbWVudDtcbiAgICAgICAgaWYgKGF1ZGlvKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hdWRpb1Byb21pc2VzLmhhcyhhdWRpb0lkKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXVkaW9Qcm9taXNlcy5zZXQoYXVkaW9JZCwgdGhpcy5hdWRpb1Byb21pc2VzLmdldChhdWRpb0lkKS50aGVuKCgpID0+IGF1ZGlvLnBhdXNlKCkpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gcGF1c2UgZG9lc24ndCByZXR1cm4gYSBwcm9taXNlLCBzbyBqdXN0IGRvIGl0XG4gICAgICAgICAgICAgICAgYXVkaW8ucGF1c2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgbWF0Y2hlc0NhbGxGb3JUaGlzUm9vbShjYWxsOiBNYXRyaXhDYWxsKSB7XG4gICAgICAgIC8vIFdlIGRvbid0IGFsbG93IHBsYWNpbmcgbW9yZSB0aGFuIG9uZSBjYWxsIHBlciByb29tLCBidXQgdGhhdCBkb2Vzbid0IG1lYW4gdGhlcmVcbiAgICAgICAgLy8gY2FuJ3QgYmUgbW9yZSB0aGFuIG9uZSwgZWcuIGluIGEgZ2xhcmUgc2l0dWF0aW9uLiBUaGlzIGNoZWNrcyB0aGF0IHRoZSBnaXZlbiBjYWxsXG4gICAgICAgIC8vIGlzIHRoZSBjYWxsIHdlIGNvbnNpZGVyICd0aGUnIGNhbGwgZm9yIGl0cyByb29tLlxuICAgICAgICBjb25zdCBtYXBwZWRSb29tSWQgPSB0aGlzLnJvb21JZEZvckNhbGwoY2FsbCk7XG5cbiAgICAgICAgY29uc3QgY2FsbEZvclRoaXNSb29tID0gdGhpcy5nZXRDYWxsRm9yUm9vbShtYXBwZWRSb29tSWQpO1xuICAgICAgICByZXR1cm4gY2FsbEZvclRoaXNSb29tICYmIGNhbGwuY2FsbElkID09PSBjYWxsRm9yVGhpc1Jvb20uY2FsbElkO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0Q2FsbExpc3RlbmVycyhjYWxsOiBNYXRyaXhDYWxsKSB7XG4gICAgICAgIGxldCBtYXBwZWRSb29tSWQgPSB0aGlzLnJvb21JZEZvckNhbGwoY2FsbCk7XG5cbiAgICAgICAgY2FsbC5vbihDYWxsRXZlbnQuRXJyb3IsIChlcnI6IENhbGxFcnJvcikgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLm1hdGNoZXNDYWxsRm9yVGhpc1Jvb20oY2FsbCkpIHJldHVybjtcblxuICAgICAgICAgICAgQW5hbHl0aWNzLnRyYWNrRXZlbnQoJ3ZvaXAnLCAnY2FsbEVycm9yJywgJ2Vycm9yJywgZXJyLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiQ2FsbCBlcnJvcjpcIiwgZXJyKTtcblxuICAgICAgICAgICAgaWYgKGVyci5jb2RlID09PSBDYWxsRXJyb3JDb2RlLk5vVXNlck1lZGlhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TWVkaWFDYXB0dXJlRXJyb3IoY2FsbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFR1cm5TZXJ2ZXJzKCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgICAgU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImZhbGxiYWNrSUNFU2VydmVyQWxsb3dlZFwiKSA9PT0gbnVsbFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93SUNFRmFsbGJhY2tQcm9tcHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0NhbGwgRmFpbGVkJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IF90KCdDYWxsIEZhaWxlZCcpLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBlcnIubWVzc2FnZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgY2FsbC5vbihDYWxsRXZlbnQuSGFuZ3VwLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMubWF0Y2hlc0NhbGxGb3JUaGlzUm9vbShjYWxsKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICBBbmFseXRpY3MudHJhY2tFdmVudCgndm9pcCcsICdjYWxsSGFuZ3VwJyk7XG5cbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2FsbEZvclJvb20obWFwcGVkUm9vbUlkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNhbGwub24oQ2FsbEV2ZW50LlN0YXRlLCAobmV3U3RhdGU6IENhbGxTdGF0ZSwgb2xkU3RhdGU6IENhbGxTdGF0ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbkNhbGxTdGF0ZUNoYW5nZWQobmV3U3RhdGUsIG9sZFN0YXRlLCBjYWxsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNhbGwub24oQ2FsbEV2ZW50LlJlcGxhY2VkLCAobmV3Q2FsbDogTWF0cml4Q2FsbCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLm1hdGNoZXNDYWxsRm9yVGhpc1Jvb20oY2FsbCkpIHJldHVybjtcblxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhgQ2FsbCBJRCAke2NhbGwuY2FsbElkfSBpcyBiZWluZyByZXBsYWNlZCBieSBjYWxsIElEICR7bmV3Q2FsbC5jYWxsSWR9YCk7XG5cbiAgICAgICAgICAgIGlmIChjYWxsLnN0YXRlID09PSBDYWxsU3RhdGUuUmluZ2luZykge1xuICAgICAgICAgICAgICAgIHRoaXMucGF1c2UoQXVkaW9JRC5SaW5nKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2FsbC5zdGF0ZSA9PT0gQ2FsbFN0YXRlLkludml0ZVNlbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlKEF1ZGlvSUQuUmluZ2JhY2spO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUNhbGxGb3JSb29tKG1hcHBlZFJvb21JZCk7XG4gICAgICAgICAgICB0aGlzLmFkZENhbGxGb3JSb29tKG1hcHBlZFJvb21JZCwgbmV3Q2FsbCk7XG4gICAgICAgICAgICB0aGlzLnNldENhbGxMaXN0ZW5lcnMobmV3Q2FsbCk7XG4gICAgICAgICAgICB0aGlzLnNldENhbGxTdGF0ZShuZXdDYWxsLCBuZXdDYWxsLnN0YXRlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNhbGwub24oQ2FsbEV2ZW50LkFzc2VydGVkSWRlbnRpdHlDaGFuZ2VkLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMubWF0Y2hlc0NhbGxGb3JUaGlzUm9vbShjYWxsKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICBsb2dnZXIubG9nKGBDYWxsIElEICR7Y2FsbC5jYWxsSWR9IGdvdCBuZXcgYXNzZXJ0ZWQgaWRlbnRpdHk6YCwgY2FsbC5nZXRSZW1vdGVBc3NlcnRlZElkZW50aXR5KCkpO1xuXG4gICAgICAgICAgICBjb25zdCBuZXdBc3NlcnRlZElkZW50aXR5ID0gY2FsbC5nZXRSZW1vdGVBc3NlcnRlZElkZW50aXR5KCkuaWQ7XG4gICAgICAgICAgICBsZXQgbmV3TmF0aXZlQXNzZXJ0ZWRJZGVudGl0eSA9IG5ld0Fzc2VydGVkSWRlbnRpdHk7XG4gICAgICAgICAgICBpZiAobmV3QXNzZXJ0ZWRJZGVudGl0eSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5zaXBOYXRpdmVMb29rdXAobmV3QXNzZXJ0ZWRJZGVudGl0eSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxlbmd0aCAmJiByZXNwb25zZVswXS5maWVsZHMubG9va3VwX3N1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3TmF0aXZlQXNzZXJ0ZWRJZGVudGl0eSA9IHJlc3BvbnNlWzBdLnVzZXJpZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2dnZXIubG9nKGBBc3NlcnRlZCBpZGVudGl0eSAke25ld0Fzc2VydGVkSWRlbnRpdHl9IG1hcHBlZCB0byAke25ld05hdGl2ZUFzc2VydGVkSWRlbnRpdHl9YCk7XG5cbiAgICAgICAgICAgIGlmIChuZXdOYXRpdmVBc3NlcnRlZElkZW50aXR5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRlZElkZW50aXR5TmF0aXZlVXNlcnNbY2FsbC5jYWxsSWRdID0gbmV3TmF0aXZlQXNzZXJ0ZWRJZGVudGl0eTtcblxuICAgICAgICAgICAgICAgIC8vIElmIHdlIGRvbid0IGFscmVhZHkgaGF2ZSBhIHJvb20gd2l0aCB0aGlzIHVzZXIsIG1ha2Ugb25lLiBUaGlzIHdpbGwgYmUgc2xpZ2h0bHkgb2RkXG4gICAgICAgICAgICAgICAgLy8gaWYgdGhleSBjYWxsZWQgdXMgYmVjYXVzZSB3ZSdsbCBiZSBpbnZpdGluZyB0aGVtLCBidXQgdGhlcmUncyBub3QgbXVjaCB3ZSBjYW4gZG8gYWJvdXRcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlmIHdlIHdhbnQgdGhlIGFjdHVhbCwgbmF0aXZlIHJvb20gdG8gZXhpc3QgKHdoaWNoIHdlIGRvKS4gVGhpcyBpcyB3aHkgaXQnc1xuICAgICAgICAgICAgICAgIC8vIGltcG9ydGFudCB0byBvbmx5IG9iZXkgYXNzZXJ0ZWQgaWRlbnRpdHkgaW4gdHJ1c3RlZCBlbnZpcm9ubWVudHMsIHNpbmNlIGFueW9uZSB5b3UncmVcbiAgICAgICAgICAgICAgICAvLyBvbiBhIGNhbGwgd2l0aCBjYW4gY2F1c2UgeW91IHRvIHNlbmQgYSByb29tIGludml0ZSB0byBzb21lb25lLlxuICAgICAgICAgICAgICAgIGF3YWl0IGVuc3VyZURNRXhpc3RzKE1hdHJpeENsaWVudFBlZy5nZXQoKSwgbmV3TmF0aXZlQXNzZXJ0ZWRJZGVudGl0eSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdNYXBwZWRSb29tSWQgPSB0aGlzLnJvb21JZEZvckNhbGwoY2FsbCk7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhgT2xkIHJvb20gSUQ6ICR7bWFwcGVkUm9vbUlkfSwgbmV3IHJvb20gSUQ6ICR7bmV3TWFwcGVkUm9vbUlkfWApO1xuICAgICAgICAgICAgICAgIGlmIChuZXdNYXBwZWRSb29tSWQgIT09IG1hcHBlZFJvb21JZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNhbGxGb3JSb29tKG1hcHBlZFJvb21JZCk7XG4gICAgICAgICAgICAgICAgICAgIG1hcHBlZFJvb21JZCA9IG5ld01hcHBlZFJvb21JZDtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIk1vdmluZyBjYWxsIHRvIHJvb20gXCIgKyBtYXBwZWRSb29tSWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENhbGxGb3JSb29tKG1hcHBlZFJvb21JZCwgY2FsbCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uQ2FsbFN0YXRlQ2hhbmdlZCA9IChuZXdTdGF0ZTogQ2FsbFN0YXRlLCBvbGRTdGF0ZTogQ2FsbFN0YXRlLCBjYWxsOiBNYXRyaXhDYWxsKTogdm9pZCA9PiB7XG4gICAgICAgIGlmICghdGhpcy5tYXRjaGVzQ2FsbEZvclRoaXNSb29tKGNhbGwpKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgbWFwcGVkUm9vbUlkID0gdGhpcy5yb29tSWRGb3JDYWxsKGNhbGwpO1xuICAgICAgICB0aGlzLnNldENhbGxTdGF0ZShjYWxsLCBuZXdTdGF0ZSk7XG5cbiAgICAgICAgc3dpdGNoIChvbGRTdGF0ZSkge1xuICAgICAgICAgICAgY2FzZSBDYWxsU3RhdGUuUmluZ2luZzpcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlKEF1ZGlvSUQuUmluZyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIENhbGxTdGF0ZS5JbnZpdGVTZW50OlxuICAgICAgICAgICAgICAgIHRoaXMucGF1c2UoQXVkaW9JRC5SaW5nYmFjayk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV3U3RhdGUgIT09IENhbGxTdGF0ZS5SaW5naW5nKSB7XG4gICAgICAgICAgICB0aGlzLnNpbGVuY2VkQ2FsbHMuZGVsZXRlKGNhbGwuY2FsbElkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN3aXRjaCAobmV3U3RhdGUpIHtcbiAgICAgICAgICAgIGNhc2UgQ2FsbFN0YXRlLlJpbmdpbmc6IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmNvbWluZ0NhbGxQdXNoUnVsZSA9IChcbiAgICAgICAgICAgICAgICAgICAgbmV3IFB1c2hQcm9jZXNzb3IoTWF0cml4Q2xpZW50UGVnLmdldCgpKS5nZXRQdXNoUnVsZUJ5SWQoUnVsZUlkLkluY29taW5nQ2FsbClcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGNvbnN0IHB1c2hSdWxlRW5hYmxlZCA9IGluY29taW5nQ2FsbFB1c2hSdWxlPy5lbmFibGVkO1xuICAgICAgICAgICAgICAgIGNvbnN0IHR3ZWFrU2V0VG9SaW5nID0gaW5jb21pbmdDYWxsUHVzaFJ1bGU/LmFjdGlvbnMuc29tZSgoYWN0aW9uOiBUd2Vha3MpID0+IChcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uLnNldF90d2VhayA9PT0gVHdlYWtOYW1lLlNvdW5kICYmXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbi52YWx1ZSA9PT0gXCJyaW5nXCJcbiAgICAgICAgICAgICAgICApKTtcblxuICAgICAgICAgICAgICAgIGlmIChwdXNoUnVsZUVuYWJsZWQgJiYgdHdlYWtTZXRUb1JpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KEF1ZGlvSUQuUmluZyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaWxlbmNlQ2FsbChjYWxsLmNhbGxJZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBDYWxsU3RhdGUuSW52aXRlU2VudDoge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheShBdWRpb0lELlJpbmdiYWNrKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgQ2FsbFN0YXRlLkVuZGVkOiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaGFuZ3VwUmVhc29uID0gY2FsbC5oYW5ndXBSZWFzb247XG4gICAgICAgICAgICAgICAgQW5hbHl0aWNzLnRyYWNrRXZlbnQoJ3ZvaXAnLCAnY2FsbEVuZGVkJywgJ2hhbmd1cFJlYXNvbicsIGhhbmd1cFJlYXNvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDYWxsRm9yUm9vbShtYXBwZWRSb29tSWQpO1xuICAgICAgICAgICAgICAgIGlmIChvbGRTdGF0ZSA9PT0gQ2FsbFN0YXRlLkludml0ZVNlbnQgJiYgY2FsbC5oYW5ndXBQYXJ0eSA9PT0gQ2FsbFBhcnR5LlJlbW90ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXkoQXVkaW9JRC5CdXN5KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBEb24ndCBzaG93IGEgbW9kYWwgd2hlbiB3ZSBnb3QgcmVqZWN0ZWQvdGhlIGNhbGwgd2FzIGh1bmcgdXBcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYW5ndXBSZWFzb24gfHwgW0NhbGxFcnJvckNvZGUuVXNlckhhbmd1cCwgXCJ1c2VyIGhhbmd1cFwiXS5pbmNsdWRlcyhoYW5ndXBSZWFzb24pKSBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBsZXQgdGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIGxldCBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogV2Ugc2hvdWxkIGVpdGhlciBkbyBhd2F5IHdpdGggdGhlc2Ugb3IgZmlndXJlIG91dCBhIGNvcHkgZm9yIGVhY2ggY29kZSAoZXhwZWN0IHVzZXJfaGFuZ3VwLi4uKVxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbC5oYW5ndXBSZWFzb24gPT09IENhbGxFcnJvckNvZGUuVXNlckJ1c3kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gX3QoXCJVc2VyIEJ1c3lcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IF90KFwiVGhlIHVzZXIgeW91IGNhbGxlZCBpcyBidXN5LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gX3QoXCJDYWxsIEZhaWxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gX3QoXCJUaGUgY2FsbCBjb3VsZCBub3QgYmUgZXN0YWJsaXNoZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdDYWxsIEhhbmRsZXInLCAnQ2FsbCBGYWlsZWQnLCBFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGUsIGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgICAgICBoYW5ndXBSZWFzb24gPT09IENhbGxFcnJvckNvZGUuQW5zd2VyZWRFbHNld2hlcmUgJiYgb2xkU3RhdGUgPT09IENhbGxTdGF0ZS5Db25uZWN0aW5nXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0NhbGwgSGFuZGxlcicsICdDYWxsIEZhaWxlZCcsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogX3QoXCJBbnN3ZXJlZCBFbHNld2hlcmVcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXCJUaGUgY2FsbCB3YXMgYW5zd2VyZWQgb24gYW5vdGhlciBkZXZpY2UuXCIpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9sZFN0YXRlICE9PSBDYWxsU3RhdGUuRmxlZGdsaW5nICYmIG9sZFN0YXRlICE9PSBDYWxsU3RhdGUuUmluZ2luZykge1xuICAgICAgICAgICAgICAgICAgICAvLyBkb24ndCBwbGF5IHRoZSBlbmQtY2FsbCBzb3VuZCBmb3IgY2FsbHMgdGhhdCBuZXZlciBnb3Qgb2ZmIHRoZSBncm91bmRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KEF1ZGlvSUQuQ2FsbEVuZCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dDYWxsU3RhdHMoY2FsbCwgbWFwcGVkUm9vbUlkKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGFzeW5jIGxvZ0NhbGxTdGF0cyhjYWxsOiBNYXRyaXhDYWxsLCBtYXBwZWRSb29tSWQ6IHN0cmluZykge1xuICAgICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IGNhbGwuZ2V0Q3VycmVudENhbGxTdGF0cygpO1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgICBgQ2FsbCBjb21wbGV0ZWQuIENhbGwgSUQ6ICR7Y2FsbC5jYWxsSWR9LCB2aXJ0dWFsIHJvb20gSUQ6ICR7Y2FsbC5yb29tSWR9LCBgICtcbiAgICAgICAgICAgIGB1c2VyLWZhY2luZyByb29tIElEOiAke21hcHBlZFJvb21JZH0sIGRpcmVjdGlvbjogJHtjYWxsLmRpcmVjdGlvbn0sIGAgK1xuICAgICAgICAgICAgYG91ciBQYXJ0eSBJRDogJHtjYWxsLm91clBhcnR5SWR9LCBoYW5ndXAgcGFydHk6ICR7Y2FsbC5oYW5ndXBQYXJ0eX0sIGAgK1xuICAgICAgICAgICAgYGhhbmd1cCByZWFzb246ICR7Y2FsbC5oYW5ndXBSZWFzb259YCxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFzdGF0cykge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgICAgICAgIFwiQ2FsbCBzdGF0aXN0aWNzIGFyZSB1bmRlZmluZWQuIFRoZSBjYWxsIGhhcyBcIiArXG4gICAgICAgICAgICAgICAgXCJwcm9iYWJseSBmYWlsZWQgYmVmb3JlIGEgcGVlckNvbm4gd2FzIGVzdGFibGlzaGVkXCIsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcIkxvY2FsIGNhbmRpZGF0ZXM6XCIpO1xuICAgICAgICBmb3IgKGNvbnN0IGNhbmQgb2Ygc3RhdHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS50eXBlID09PSAnbG9jYWwtY2FuZGlkYXRlJykpIHtcbiAgICAgICAgICAgIGNvbnN0IGFkZHJlc3MgPSBjYW5kLmFkZHJlc3MgfHwgY2FuZC5pcDsgLy8gZmlyZWZveCB1c2VzICdhZGRyZXNzJywgY2hyb21lIHVzZXMgJ2lwJ1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgICAgICAgIGAke2NhbmQuaWR9IC0gdHlwZTogJHtjYW5kLmNhbmRpZGF0ZVR5cGV9LCBhZGRyZXNzOiAke2FkZHJlc3N9LCBwb3J0OiAke2NhbmQucG9ydH0sIGAgK1xuICAgICAgICAgICAgICAgIGBwcm90b2NvbDogJHtjYW5kLnByb3RvY29sfSwgcmVsYXkgcHJvdG9jb2w6ICR7Y2FuZC5yZWxheVByb3RvY29sfSwgbmV0d29yayB0eXBlOiAke2NhbmQubmV0d29ya1R5cGV9YCxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgbG9nZ2VyLmRlYnVnKFwiUmVtb3RlIGNhbmRpZGF0ZXM6XCIpO1xuICAgICAgICBmb3IgKGNvbnN0IGNhbmQgb2Ygc3RhdHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS50eXBlID09PSAncmVtb3RlLWNhbmRpZGF0ZScpKSB7XG4gICAgICAgICAgICBjb25zdCBhZGRyZXNzID0gY2FuZC5hZGRyZXNzIHx8IGNhbmQuaXA7IC8vIGZpcmVmb3ggdXNlcyAnYWRkcmVzcycsIGNocm9tZSB1c2VzICdpcCdcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICAgICAgICBgJHtjYW5kLmlkfSAtIHR5cGU6ICR7Y2FuZC5jYW5kaWRhdGVUeXBlfSwgYWRkcmVzczogJHthZGRyZXNzfSwgcG9ydDogJHtjYW5kLnBvcnR9LCBgICtcbiAgICAgICAgICAgICAgICBgcHJvdG9jb2w6ICR7Y2FuZC5wcm90b2NvbH1gLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBsb2dnZXIuZGVidWcoXCJDYW5kaWRhdGUgcGFpcnM6XCIpO1xuICAgICAgICBmb3IgKGNvbnN0IHBhaXIgb2Ygc3RhdHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS50eXBlID09PSAnY2FuZGlkYXRlLXBhaXInKSkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgICAgICAgIGAke3BhaXIubG9jYWxDYW5kaWRhdGVJZH0gLyAke3BhaXIucmVtb3RlQ2FuZGlkYXRlSWR9IC0gc3RhdGU6ICR7cGFpci5zdGF0ZX0sIGAgK1xuICAgICAgICAgICAgICAgIGBub21pbmF0ZWQ6ICR7cGFpci5ub21pbmF0ZWR9LCBgICtcbiAgICAgICAgICAgICAgICBgcmVxdWVzdHMgc2VudCAke3BhaXIucmVxdWVzdHNTZW50fSwgcmVxdWVzdHMgcmVjZWl2ZWQgICR7cGFpci5yZXF1ZXN0c1JlY2VpdmVkfSwgIGAgK1xuICAgICAgICAgICAgICAgIGByZXNwb25zZXMgcmVjZWl2ZWQ6ICR7cGFpci5yZXNwb25zZXNSZWNlaXZlZH0sIHJlc3BvbnNlcyBzZW50OiAke3BhaXIucmVzcG9uc2VzU2VudH0sIGAgK1xuICAgICAgICAgICAgICAgIGBieXRlcyByZWNlaXZlZDogJHtwYWlyLmJ5dGVzUmVjZWl2ZWR9LCBieXRlcyBzZW50OiAke3BhaXIuYnl0ZXNTZW50fSwgYCxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldENhbGxTdGF0ZShjYWxsOiBNYXRyaXhDYWxsLCBzdGF0dXM6IENhbGxTdGF0ZSkge1xuICAgICAgICBjb25zdCBtYXBwZWRSb29tSWQgPSBDYWxsSGFuZGxlci5zaGFyZWRJbnN0YW5jZSgpLnJvb21JZEZvckNhbGwoY2FsbCk7XG5cbiAgICAgICAgbG9nZ2VyLmxvZyhcbiAgICAgICAgICAgIGBDYWxsIHN0YXRlIGluICR7bWFwcGVkUm9vbUlkfSBjaGFuZ2VkIHRvICR7c3RhdHVzfWAsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgdG9hc3RLZXkgPSBnZXRJbmNvbWluZ0NhbGxUb2FzdEtleShjYWxsLmNhbGxJZCk7XG4gICAgICAgIGlmIChzdGF0dXMgPT09IENhbGxTdGF0ZS5SaW5naW5nKSB7XG4gICAgICAgICAgICBUb2FzdFN0b3JlLnNoYXJlZEluc3RhbmNlKCkuYWRkT3JSZXBsYWNlVG9hc3Qoe1xuICAgICAgICAgICAgICAgIGtleTogdG9hc3RLZXksXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IDEwMCxcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6IEluY29taW5nQ2FsbFRvYXN0LFxuICAgICAgICAgICAgICAgIGJvZHlDbGFzc05hbWU6IFwibXhfSW5jb21pbmdDYWxsVG9hc3RcIixcbiAgICAgICAgICAgICAgICBwcm9wczogeyBjYWxsIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIFRvYXN0U3RvcmUuc2hhcmVkSW5zdGFuY2UoKS5kaXNtaXNzVG9hc3QodG9hc3RLZXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2NhbGxfc3RhdGUnLFxuICAgICAgICAgICAgcm9vbV9pZDogbWFwcGVkUm9vbUlkLFxuICAgICAgICAgICAgc3RhdGU6IHN0YXR1cyxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW1vdmVDYWxsRm9yUm9vbShyb29tSWQ6IHN0cmluZykge1xuICAgICAgICBsb2dnZXIubG9nKFwiUmVtb3ZpbmcgY2FsbCBmb3Igcm9vbSBcIiwgcm9vbUlkKTtcbiAgICAgICAgdGhpcy5jYWxscy5kZWxldGUocm9vbUlkKTtcbiAgICAgICAgdGhpcy5lbWl0KENhbGxIYW5kbGVyRXZlbnQuQ2FsbHNDaGFuZ2VkLCB0aGlzLmNhbGxzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNob3dJQ0VGYWxsYmFja1Byb21wdCgpIHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCBjb2RlID0gc3ViID0+IDxjb2RlPnsgc3ViIH08L2NvZGU+O1xuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdObyBUVVJOIHNlcnZlcnMnLCAnJywgUXVlc3Rpb25EaWFsb2csIHtcbiAgICAgICAgICAgIHRpdGxlOiBfdChcIkNhbGwgZmFpbGVkIGR1ZSB0byBtaXNjb25maWd1cmVkIHNlcnZlclwiKSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiA8ZGl2PlxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiUGxlYXNlIGFzayB0aGUgYWRtaW5pc3RyYXRvciBvZiB5b3VyIGhvbWVzZXJ2ZXIgXCIgK1xuICAgICAgICAgICAgICAgICAgICBcIig8Y29kZT4lKGhvbWVzZXJ2ZXJEb21haW4pczwvY29kZT4pIHRvIGNvbmZpZ3VyZSBhIFRVUk4gc2VydmVyIGluIFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJvcmRlciBmb3IgY2FsbHMgdG8gd29yayByZWxpYWJseS5cIixcbiAgICAgICAgICAgICAgICAgICAgeyBob21lc2VydmVyRG9tYWluOiBjbGkuZ2V0RG9tYWluKCkgfSwgeyBjb2RlIH0sXG4gICAgICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiQWx0ZXJuYXRpdmVseSwgeW91IGNhbiB0cnkgdG8gdXNlIHRoZSBwdWJsaWMgc2VydmVyIGF0IFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCI8Y29kZT50dXJuLm1hdHJpeC5vcmc8L2NvZGU+LCBidXQgdGhpcyB3aWxsIG5vdCBiZSBhcyByZWxpYWJsZSwgYW5kIFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJpdCB3aWxsIHNoYXJlIHlvdXIgSVAgYWRkcmVzcyB3aXRoIHRoYXQgc2VydmVyLiBZb3UgY2FuIGFsc28gbWFuYWdlIFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJ0aGlzIGluIFNldHRpbmdzLlwiLFxuICAgICAgICAgICAgICAgICAgICBudWxsLCB7IGNvZGUgfSxcbiAgICAgICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICA8L2Rpdj4sXG4gICAgICAgICAgICBidXR0b246IF90KCdUcnkgdXNpbmcgdHVybi5tYXRyaXgub3JnJyksXG4gICAgICAgICAgICBjYW5jZWxCdXR0b246IF90KCdPSycpLFxuICAgICAgICAgICAgb25GaW5pc2hlZDogKGFsbG93KSA9PiB7XG4gICAgICAgICAgICAgICAgU2V0dGluZ3NTdG9yZS5zZXRWYWx1ZShcImZhbGxiYWNrSUNFU2VydmVyQWxsb3dlZFwiLCBudWxsLCBTZXR0aW5nTGV2ZWwuREVWSUNFLCBhbGxvdyk7XG4gICAgICAgICAgICAgICAgY2xpLnNldEZhbGxiYWNrSUNFU2VydmVyQWxsb3dlZChhbGxvdyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LCBudWxsLCB0cnVlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNob3dNZWRpYUNhcHR1cmVFcnJvcihjYWxsOiBNYXRyaXhDYWxsKSB7XG4gICAgICAgIGxldCB0aXRsZTtcbiAgICAgICAgbGV0IGRlc2NyaXB0aW9uO1xuXG4gICAgICAgIGlmIChjYWxsLnR5cGUgPT09IENhbGxUeXBlLlZvaWNlKSB7XG4gICAgICAgICAgICB0aXRsZSA9IF90KFwiVW5hYmxlIHRvIGFjY2VzcyBtaWNyb3Bob25lXCIpO1xuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSA8ZGl2PlxuICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiQ2FsbCBmYWlsZWQgYmVjYXVzZSBtaWNyb3Bob25lIGNvdWxkIG5vdCBiZSBhY2Nlc3NlZC4gXCIgK1xuICAgICAgICAgICAgICAgICAgICBcIkNoZWNrIHRoYXQgYSBtaWNyb3Bob25lIGlzIHBsdWdnZWQgaW4gYW5kIHNldCB1cCBjb3JyZWN0bHkuXCIsXG4gICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH0gZWxzZSBpZiAoY2FsbC50eXBlID09PSBDYWxsVHlwZS5WaWRlbykge1xuICAgICAgICAgICAgdGl0bGUgPSBfdChcIlVuYWJsZSB0byBhY2Nlc3Mgd2ViY2FtIC8gbWljcm9waG9uZVwiKTtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gPGRpdj5cbiAgICAgICAgICAgICAgICB7IF90KFwiQ2FsbCBmYWlsZWQgYmVjYXVzZSB3ZWJjYW0gb3IgbWljcm9waG9uZSBjb3VsZCBub3QgYmUgYWNjZXNzZWQuIENoZWNrIHRoYXQ6XCIpIH1cbiAgICAgICAgICAgICAgICA8dWw+XG4gICAgICAgICAgICAgICAgICAgIDxsaT57IF90KFwiQSBtaWNyb3Bob25lIGFuZCB3ZWJjYW0gYXJlIHBsdWdnZWQgaW4gYW5kIHNldCB1cCBjb3JyZWN0bHlcIikgfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgIDxsaT57IF90KFwiUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIHVzZSB0aGUgd2ViY2FtXCIpIH08L2xpPlxuICAgICAgICAgICAgICAgICAgICA8bGk+eyBfdChcIk5vIG90aGVyIGFwcGxpY2F0aW9uIGlzIHVzaW5nIHRoZSB3ZWJjYW1cIikgfTwvbGk+XG4gICAgICAgICAgICAgICAgPC91bD5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfVxuXG4gICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ01lZGlhIGNhcHR1cmUgZmFpbGVkJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICB0aXRsZSwgZGVzY3JpcHRpb24sXG4gICAgICAgIH0sIG51bGwsIHRydWUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgcGxhY2VDYWxsKHJvb21JZDogc3RyaW5nLCB0eXBlOiBQbGFjZUNhbGxUeXBlLCB0cmFuc2ZlcmVlOiBNYXRyaXhDYWxsKSB7XG4gICAgICAgIEFuYWx5dGljcy50cmFja0V2ZW50KCd2b2lwJywgJ3BsYWNlQ2FsbCcsICd0eXBlJywgdHlwZSk7XG4gICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2tTdGFydENhbGwocm9vbUlkLCB0eXBlID09PSBQbGFjZUNhbGxUeXBlLlZpZGVvLCBmYWxzZSk7XG5cbiAgICAgICAgY29uc3QgbWFwcGVkUm9vbUlkID0gKGF3YWl0IFZvaXBVc2VyTWFwcGVyLnNoYXJlZEluc3RhbmNlKCkuZ2V0T3JDcmVhdGVWaXJ0dWFsUm9vbUZvclJvb20ocm9vbUlkKSkgfHwgcm9vbUlkO1xuICAgICAgICBsb2dnZXIuZGVidWcoXCJNYXBwZWQgcmVhbCByb29tIFwiICsgcm9vbUlkICsgXCIgdG8gcm9vbSBJRCBcIiArIG1hcHBlZFJvb21JZCk7XG5cbiAgICAgICAgY29uc3QgdGltZVVudGlsVHVybkNyZXNFeHBpcmUgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0VHVyblNlcnZlcnNFeHBpcnkoKSAtIERhdGUubm93KCk7XG4gICAgICAgIGxvZ2dlci5sb2coXCJDdXJyZW50IHR1cm4gY3JlZHMgZXhwaXJlIGluIFwiICsgdGltZVVudGlsVHVybkNyZXNFeHBpcmUgKyBcIiBtc1wiKTtcbiAgICAgICAgY29uc3QgY2FsbCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKS5jcmVhdGVDYWxsKG1hcHBlZFJvb21JZCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuYWRkQ2FsbEZvclJvb20ocm9vbUlkLCBjYWxsKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnQ2FsbCBIYW5kbGVyJywgJ0V4aXN0aW5nIENhbGwgd2l0aCB1c2VyJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogX3QoJ0FscmVhZHkgaW4gY2FsbCcpLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBfdChcIllvdSdyZSBhbHJlYWR5IGluIGEgY2FsbCB3aXRoIHRoaXMgcGVyc29uLlwiKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0cmFuc2ZlcmVlKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zZmVyZWVzW2NhbGwuY2FsbElkXSA9IHRyYW5zZmVyZWU7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldENhbGxMaXN0ZW5lcnMoY2FsbCk7XG5cbiAgICAgICAgdGhpcy5zZXRBY3RpdmVDYWxsUm9vbUlkKHJvb21JZCk7XG5cbiAgICAgICAgaWYgKHR5cGUgPT09IFBsYWNlQ2FsbFR5cGUuVm9pY2UpIHtcbiAgICAgICAgICAgIGNhbGwucGxhY2VWb2ljZUNhbGwoKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAndmlkZW8nKSB7XG4gICAgICAgICAgICBjYWxsLnBsYWNlVmlkZW9DYWxsKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJVbmtub3duIGNvbmYgY2FsbCB0eXBlOiBcIiArIHR5cGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkFjdGlvbiA9IChwYXlsb2FkOiBBY3Rpb25QYXlsb2FkKSA9PiB7XG4gICAgICAgIHN3aXRjaCAocGF5bG9hZC5hY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgJ3BsYWNlX2NhbGwnOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbWlnaHQgYmUgdXNpbmcgbWFuYWdlZCBoeWJyaWQgd2lkZ2V0c1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYW5hZ2VkSHlicmlkV2lkZ2V0RW5hYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRNYW5hZ2VkSHlicmlkV2lkZ2V0KHBheWxvYWQucm9vbV9pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgcnVudGltZSBlbnYgZG9lc24ndCBkbyBWb0lQLCB3aGluZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFNYXRyaXhDbGllbnRQZWcuZ2V0KCkuc3VwcG9ydHNWb2lwKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0NhbGwgSGFuZGxlcicsICdWb0lQIGlzIHVuc3VwcG9ydGVkJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogX3QoJ1ZvSVAgaXMgdW5zdXBwb3J0ZWQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoJ1lvdSBjYW5ub3QgcGxhY2UgVm9JUCBjYWxscyBpbiB0aGlzIGJyb3dzZXIuJyksXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvbid0IGFsbG93ID4gMiBjYWxscyB0byBiZSBwbGFjZWQuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldEFsbEFjdGl2ZUNhbGxzKCkubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnQ2FsbCBIYW5kbGVyJywgJ0V4aXN0aW5nIENhbGwnLCBFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBfdCgnVG9vIE1hbnkgQ2FsbHMnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXCJZb3UndmUgcmVhY2hlZCB0aGUgbWF4aW11bSBudW1iZXIgb2Ygc2ltdWx0YW5lb3VzIGNhbGxzLlwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9vbSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRSb29tKHBheWxvYWQucm9vbV9pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcm9vbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBSb29tICR7cGF5bG9hZC5yb29tX2lkfSBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGxlYXZlIHRoZSBjaGVjayBmb3Igd2hldGhlciB0aGVyZSdzIGFscmVhZHkgYSBjYWxsIGluIHRoaXMgcm9vbSB1bnRpbCBsYXRlcixcbiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGl0IGNhbiByYWNlLlxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lbWJlcnMgPSByb29tLmdldEpvaW5lZE1lbWJlcnMoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lbWJlcnMubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0NhbGwgSGFuZGxlcicsICdDYW5ub3QgcGxhY2UgY2FsbCB3aXRoIHNlbGYnLCBFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBfdCgnWW91IGNhbm5vdCBwbGFjZSBhIGNhbGwgd2l0aCB5b3Vyc2VsZi4nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lbWJlcnMubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhgUGxhY2UgJHtwYXlsb2FkLnR5cGV9IGNhbGwgaW4gJHtwYXlsb2FkLnJvb21faWR9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2VDYWxsKHBheWxvYWQucm9vbV9pZCwgcGF5bG9hZC50eXBlLCBwYXlsb2FkLnRyYW5zZmVyZWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyA+IDJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBcInBsYWNlX2NvbmZlcmVuY2VfY2FsbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb21faWQ6IHBheWxvYWQucm9vbV9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBwYXlsb2FkLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3BsYWNlX2NvbmZlcmVuY2VfY2FsbCc6XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oXCJQbGFjZSBjb25mZXJlbmNlIGNhbGwgaW4gXCIgKyBwYXlsb2FkLnJvb21faWQpO1xuICAgICAgICAgICAgICAgIEFuYWx5dGljcy50cmFja0V2ZW50KCd2b2lwJywgJ3BsYWNlQ29uZmVyZW5jZUNhbGwnKTtcbiAgICAgICAgICAgICAgICBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnRyYWNrU3RhcnRDYWxsKHBheWxvYWQucm9vbV9pZCwgcGF5bG9hZC50eXBlID09PSBQbGFjZUNhbGxUeXBlLlZpZGVvLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0Q2FsbEFwcChwYXlsb2FkLnJvb21faWQsIHBheWxvYWQudHlwZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdlbmRfY29uZmVyZW5jZSc6XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oXCJUZXJtaW5hdGluZyBjb25mZXJlbmNlIGNhbGwgaW4gXCIgKyBwYXlsb2FkLnJvb21faWQpO1xuICAgICAgICAgICAgICAgIHRoaXMudGVybWluYXRlQ2FsbEFwcChwYXlsb2FkLnJvb21faWQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaGFuZ3VwX2NvbmZlcmVuY2UnOlxuICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKFwiTGVhdmluZyBjb25mZXJlbmNlIGNhbGwgaW4gXCIrIHBheWxvYWQucm9vbV9pZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5ndXBDYWxsQXBwKHBheWxvYWQucm9vbV9pZCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdpbmNvbWluZ19jYWxsJzpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBydW50aW1lIGVudiBkb2Vzbid0IGRvIFZvSVAsIHN0b3AgaGVyZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFNYXRyaXhDbGllbnRQZWcuZ2V0KCkuc3VwcG9ydHNWb2lwKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGwgPSBwYXlsb2FkLmNhbGwgYXMgTWF0cml4Q2FsbDtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXBwZWRSb29tSWQgPSBDYWxsSGFuZGxlci5zaGFyZWRJbnN0YW5jZSgpLnJvb21JZEZvckNhbGwoY2FsbCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldENhbGxGb3JSb29tKG1hcHBlZFJvb21JZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJHb3QgaW5jb21pbmcgY2FsbCBmb3Igcm9vbSBcIiArIG1hcHBlZFJvb21JZCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIgYnV0IHRoZXJlJ3MgYWxyZWFkeSBhIGNhbGwgZm9yIHRoaXMgcm9vbTogaWdub3JpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBBbmFseXRpY3MudHJhY2tFdmVudCgndm9pcCcsICdyZWNlaXZlQ2FsbCcsICd0eXBlJywgY2FsbC50eXBlKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENhbGxGb3JSb29tKG1hcHBlZFJvb21JZCwgY2FsbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2FsbExpc3RlbmVycyhjYWxsKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRXhwbGljaXRseSBoYW5kbGUgZmlyc3Qgc3RhdGUgY2hhbmdlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25DYWxsU3RhdGVDaGFuZ2VkKGNhbGwuc3RhdGUsIG51bGwsIGNhbGwpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCByZWFkeSB0byBzZW5kIGVuY3J5cHRlZCBldmVudHMgaW4gdGhlIHJvb20sIHNvIGlmIHRoZSB1c2VyIGRvZXMgYW5zd2VyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSBjYWxsLCB3ZSdsbCBiZSByZWFkeSB0byBzZW5kLiBOQi4gVGhpcyBpcyB0aGUgcHJvdG9jb2wtbGV2ZWwgcm9vbSBJRCBub3RcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG1hcHBlZCBvbmU6IHRoYXQncyB3aGVyZSB3ZSdsbCBzZW5kIHRoZSBldmVudHMuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgY2xpLnByZXBhcmVUb0VuY3J5cHQoY2xpLmdldFJvb20oY2FsbC5yb29tSWQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdoYW5ndXAnOlxuICAgICAgICAgICAgY2FzZSAncmVqZWN0JzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BSaW5naW5nSWZQb3NzaWJsZSh0aGlzLmNhbGxzLmdldChwYXlsb2FkLnJvb21faWQpLmNhbGxJZCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY2FsbHMuZ2V0KHBheWxvYWQucm9vbV9pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBubyBjYWxsIHRvIGhhbmd1cFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5hY3Rpb24gPT09ICdyZWplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbHMuZ2V0KHBheWxvYWQucm9vbV9pZCkucmVqZWN0KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxscy5nZXQocGF5bG9hZC5yb29tX2lkKS5oYW5ndXAoQ2FsbEVycm9yQ29kZS5Vc2VySGFuZ3VwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGRvbid0IHJlbW92ZSB0aGUgY2FsbCB5ZXQ6IGxldCB0aGUgaGFuZ3VwIGV2ZW50IGhhbmRsZXIgZG8gaXQgKG90aGVyd2lzZSBpdCB3aWxsIHRocm93XG4gICAgICAgICAgICAgICAgLy8gdGhlIGhhbmd1cCBldmVudCBhd2F5KVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaGFuZ3VwX2FsbCc6XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wUmluZ2luZ0lmUG9zc2libGUodGhpcy5jYWxscy5nZXQocGF5bG9hZC5yb29tX2lkKS5jYWxsSWQpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjYWxsIG9mIHRoaXMuY2FsbHMudmFsdWVzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbC5oYW5ndXAoQ2FsbEVycm9yQ29kZS5Vc2VySGFuZ3VwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYW5zd2VyJzoge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFJpbmdpbmdJZlBvc3NpYmxlKHRoaXMuY2FsbHMuZ2V0KHBheWxvYWQucm9vbV9pZCkuY2FsbElkKTtcblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jYWxscy5oYXMocGF5bG9hZC5yb29tX2lkKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIG5vIGNhbGwgdG8gYW5zd2VyXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0QWxsQWN0aXZlQ2FsbHMoKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0NhbGwgSGFuZGxlcicsICdFeGlzdGluZyBDYWxsJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBfdCgnVG9vIE1hbnkgQ2FsbHMnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBfdChcIllvdSd2ZSByZWFjaGVkIHRoZSBtYXhpbXVtIG51bWJlciBvZiBzaW11bHRhbmVvdXMgY2FsbHMuXCIpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGNhbGwgPSB0aGlzLmNhbGxzLmdldChwYXlsb2FkLnJvb21faWQpO1xuICAgICAgICAgICAgICAgIGNhbGwuYW5zd2VyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVDYWxsUm9vbUlkKHBheWxvYWQucm9vbV9pZCk7XG4gICAgICAgICAgICAgICAgQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFja0pvaW5DYWxsKHBheWxvYWQucm9vbV9pZCwgY2FsbC50eXBlID09PSBDYWxsVHlwZS5WaWRlbywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdSb29tLFxuICAgICAgICAgICAgICAgICAgICByb29tX2lkOiBwYXlsb2FkLnJvb21faWQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIEFjdGlvbi5EaWFsTnVtYmVyOlxuICAgICAgICAgICAgICAgIHRoaXMuZGlhbE51bWJlcihwYXlsb2FkLm51bWJlcik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEFjdGlvbi5UcmFuc2ZlckNhbGxUb01hdHJpeElEOlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUcmFuc2ZlclRvTWF0cml4SUQocGF5bG9hZC5jYWxsLCBwYXlsb2FkLmRlc3RpbmF0aW9uLCBwYXlsb2FkLmNvbnN1bHRGaXJzdCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEFjdGlvbi5UcmFuc2ZlckNhbGxUb1Bob25lTnVtYmVyOlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUcmFuc2ZlclRvUGhvbmVOdW1iZXIocGF5bG9hZC5jYWxsLCBwYXlsb2FkLmRlc3RpbmF0aW9uLCBwYXlsb2FkLmNvbnN1bHRGaXJzdCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBzdG9wUmluZ2luZ0lmUG9zc2libGUoY2FsbElkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zaWxlbmNlZENhbGxzLmRlbGV0ZShjYWxsSWQpO1xuICAgICAgICBpZiAodGhpcy5hcmVBbnlDYWxsc1Vuc2lsZW5jZWQoKSkgcmV0dXJuO1xuICAgICAgICB0aGlzLnBhdXNlKEF1ZGlvSUQuUmluZyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBkaWFsTnVtYmVyKG51bWJlcjogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLnBzdG5Mb29rdXAobnVtYmVyKTtcbiAgICAgICAgaWYgKCFyZXN1bHRzIHx8IHJlc3VsdHMubGVuZ3RoID09PSAwIHx8ICFyZXN1bHRzWzBdLnVzZXJpZCkge1xuICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IF90KFwiVW5hYmxlIHRvIGxvb2sgdXAgcGhvbmUgbnVtYmVyXCIpLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBfdChcIlRoZXJlIHdhcyBhbiBlcnJvciBsb29raW5nIHVwIHRoZSBwaG9uZSBudW1iZXJcIiksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1c2VySWQgPSByZXN1bHRzWzBdLnVzZXJpZDtcblxuICAgICAgICAvLyBOb3cgY2hlY2sgdG8gc2VlIGlmIHRoaXMgaXMgYSB2aXJ0dWFsIHVzZXIsIGluIHdoaWNoIGNhc2Ugd2Ugc2hvdWxkIGZpbmQgdGhlXG4gICAgICAgIC8vIG5hdGl2ZSB1c2VyXG4gICAgICAgIGxldCBuYXRpdmVVc2VySWQ7XG4gICAgICAgIGlmICh0aGlzLmdldFN1cHBvcnRzVmlydHVhbFJvb21zKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG5hdGl2ZUxvb2t1cFJlc3VsdHMgPSBhd2FpdCB0aGlzLnNpcE5hdGl2ZUxvb2t1cCh1c2VySWQpO1xuICAgICAgICAgICAgY29uc3QgbG9va3VwU3VjY2VzcyA9IG5hdGl2ZUxvb2t1cFJlc3VsdHMubGVuZ3RoID4gMCAmJiBuYXRpdmVMb29rdXBSZXN1bHRzWzBdLmZpZWxkcy5sb29rdXBfc3VjY2VzcztcbiAgICAgICAgICAgIG5hdGl2ZVVzZXJJZCA9IGxvb2t1cFN1Y2Nlc3MgPyBuYXRpdmVMb29rdXBSZXN1bHRzWzBdLnVzZXJpZCA6IHVzZXJJZDtcbiAgICAgICAgICAgIGxvZ2dlci5sb2coXCJMb29rZWQgdXAgXCIgKyBudW1iZXIgKyBcIiB0byBcIiArIHVzZXJJZCArIFwiIGFuZCBtYXBwZWQgdG8gbmF0aXZlIHVzZXIgXCIgKyBuYXRpdmVVc2VySWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmF0aXZlVXNlcklkID0gdXNlcklkO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgcm9vbUlkID0gYXdhaXQgZW5zdXJlRE1FeGlzdHMoTWF0cml4Q2xpZW50UGVnLmdldCgpLCBuYXRpdmVVc2VySWQpO1xuXG4gICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3Um9vbSxcbiAgICAgICAgICAgIHJvb21faWQ6IHJvb21JZCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5wbGFjZUNhbGwocm9vbUlkLCBQbGFjZUNhbGxUeXBlLlZvaWNlLCBudWxsKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHN0YXJ0VHJhbnNmZXJUb1Bob25lTnVtYmVyKGNhbGw6IE1hdHJpeENhbGwsIGRlc3RpbmF0aW9uOiBzdHJpbmcsIGNvbnN1bHRGaXJzdDogYm9vbGVhbikge1xuICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5wc3RuTG9va3VwKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgaWYgKCFyZXN1bHRzIHx8IHJlc3VsdHMubGVuZ3RoID09PSAwIHx8ICFyZXN1bHRzWzBdLnVzZXJpZCkge1xuICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IF90KFwiVW5hYmxlIHRvIHRyYW5zZmVyIGNhbGxcIiksXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KFwiVGhlcmUgd2FzIGFuIGVycm9yIGxvb2tpbmcgdXAgdGhlIHBob25lIG51bWJlclwiKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgdGhpcy5zdGFydFRyYW5zZmVyVG9NYXRyaXhJRChjYWxsLCByZXN1bHRzWzBdLnVzZXJpZCwgY29uc3VsdEZpcnN0KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHN0YXJ0VHJhbnNmZXJUb01hdHJpeElEKGNhbGw6IE1hdHJpeENhbGwsIGRlc3RpbmF0aW9uOiBzdHJpbmcsIGNvbnN1bHRGaXJzdDogYm9vbGVhbikge1xuICAgICAgICBpZiAoY29uc3VsdEZpcnN0KSB7XG4gICAgICAgICAgICBjb25zdCBkbVJvb21JZCA9IGF3YWl0IGVuc3VyZURNRXhpc3RzKE1hdHJpeENsaWVudFBlZy5nZXQoKSwgZGVzdGluYXRpb24pO1xuXG4gICAgICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgIGFjdGlvbjogJ3BsYWNlX2NhbGwnLFxuICAgICAgICAgICAgICAgIHR5cGU6IGNhbGwudHlwZSxcbiAgICAgICAgICAgICAgICByb29tX2lkOiBkbVJvb21JZCxcbiAgICAgICAgICAgICAgICB0cmFuc2ZlcmVlOiBjYWxsLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdSb29tLFxuICAgICAgICAgICAgICAgIHJvb21faWQ6IGRtUm9vbUlkLFxuICAgICAgICAgICAgICAgIHNob3VsZF9wZWVrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBqb2luaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBjYWxsLnRyYW5zZmVyKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIubG9nKFwiRmFpbGVkIHRvIHRyYW5zZmVyIGNhbGxcIiwgZSk7XG4gICAgICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRmFpbGVkIHRvIHRyYW5zZmVyIGNhbGwnLCAnJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IF90KCdUcmFuc2ZlciBGYWlsZWQnKSxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KCdGYWlsZWQgdG8gdHJhbnNmZXIgY2FsbCcpLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0QWN0aXZlQ2FsbFJvb21JZChhY3RpdmVDYWxsUm9vbUlkOiBzdHJpbmcpIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oXCJTZXR0aW5nIGNhbGwgaW4gcm9vbSBcIiArIGFjdGl2ZUNhbGxSb29tSWQgKyBcIiBhY3RpdmVcIik7XG5cbiAgICAgICAgZm9yIChjb25zdCBbcm9vbUlkLCBjYWxsXSBvZiB0aGlzLmNhbGxzLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgaWYgKGNhbGwuc3RhdGUgPT09IENhbGxTdGF0ZS5FbmRlZCkgY29udGludWU7XG5cbiAgICAgICAgICAgIGlmIChyb29tSWQgPT09IGFjdGl2ZUNhbGxSb29tSWQpIHtcbiAgICAgICAgICAgICAgICBjYWxsLnNldFJlbW90ZU9uSG9sZChmYWxzZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKFwiSG9sZGluZyBjYWxsIGluIHJvb20gXCIgKyByb29tSWQgKyBcIiBiZWNhdXNlIGFub3RoZXIgY2FsbCBpcyBiZWluZyBzZXQgYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgIGNhbGwuc2V0UmVtb3RlT25Ib2xkKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB3ZSBhcmUgY3VycmVudGx5IGluIGFueSBjYWxsIHdoZXJlIHdlIGhhdmVuJ3QgcHV0IHRoZSByZW1vdGUgcGFydHkgb24gaG9sZFxuICAgICAqL1xuICAgIGhhc0FueVVuaGVsZENhbGwoKSB7XG4gICAgICAgIGZvciAoY29uc3QgY2FsbCBvZiB0aGlzLmNhbGxzLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBpZiAoY2FsbC5zdGF0ZSA9PT0gQ2FsbFN0YXRlLkVuZGVkKSBjb250aW51ZTtcbiAgICAgICAgICAgIGlmICghY2FsbC5pc1JlbW90ZU9uSG9sZCgpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHN0YXJ0Q2FsbEFwcChyb29tSWQ6IHN0cmluZywgdHlwZTogc3RyaW5nKSB7XG4gICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICBhY3Rpb246ICdhcHBzRHJhd2VyJyxcbiAgICAgICAgICAgIHNob3c6IHRydWUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHByZXZlbnQgZG91YmxlIGNsaWNraW5nIHRoZSBjYWxsIGJ1dHRvblxuICAgICAgICBjb25zdCByb29tID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFJvb20ocm9vbUlkKTtcbiAgICAgICAgY29uc3Qgaml0c2lXaWRnZXQgPSBXaWRnZXRTdG9yZS5pbnN0YW5jZS5nZXRBcHBzKHJvb21JZCkuZmluZCgoYXBwKSA9PiBXaWRnZXRUeXBlLkpJVFNJLm1hdGNoZXMoYXBwLnR5cGUpKTtcbiAgICAgICAgaWYgKGppdHNpV2lkZ2V0KSB7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBhbHJlYWR5IGlzIGEgSml0c2kgd2lkZ2V0IHBpbiBpdFxuICAgICAgICAgICAgV2lkZ2V0TGF5b3V0U3RvcmUuaW5zdGFuY2UubW92ZVRvQ29udGFpbmVyKHJvb20sIGppdHNpV2lkZ2V0LCBDb250YWluZXIuVG9wKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGppdHNpRG9tYWluID0gSml0c2kuZ2V0SW5zdGFuY2UoKS5wcmVmZXJyZWREb21haW47XG4gICAgICAgIGNvbnN0IGppdHNpQXV0aCA9IGF3YWl0IEppdHNpLmdldEluc3RhbmNlKCkuZ2V0Sml0c2lBdXRoKCk7XG4gICAgICAgIGxldCBjb25mSWQ7XG4gICAgICAgIGlmIChqaXRzaUF1dGggPT09ICdvcGVuaWR0b2tlbi1qd3QnKSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgY29uZmVyZW5jZSBJRCBmcm9tIHJvb20gSURcbiAgICAgICAgICAgIC8vIEZvciBjb21wYXRpYmlsaXR5IHdpdGggSml0c2ksIHVzZSBiYXNlMzIgd2l0aG91dCBwYWRkaW5nLlxuICAgICAgICAgICAgLy8gTW9yZSBkZXRhaWxzIGhlcmU6XG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbWF0cml4LW9yZy9wcm9zb2R5LW1vZC1hdXRoLW1hdHJpeC11c2VyLXZlcmlmaWNhdGlvblxuICAgICAgICAgICAgY29uZklkID0gYmFzZTMyLnN0cmluZ2lmeShCdWZmZXIuZnJvbShyb29tSWQpLCB7IHBhZDogZmFsc2UgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgYSByYW5kb20gY29uZmVyZW5jZSBJRFxuICAgICAgICAgICAgY29uc3QgcmFuZG9tID0gcmFuZG9tVXBwZXJjYXNlU3RyaW5nKDEpICsgcmFuZG9tTG93ZXJjYXNlU3RyaW5nKDIzKTtcbiAgICAgICAgICAgIGNvbmZJZCA9ICdKaXRzaScgKyByYW5kb207XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgd2lkZ2V0VXJsID0gV2lkZ2V0VXRpbHMuZ2V0TG9jYWxKaXRzaVdyYXBwZXJVcmwoeyBhdXRoOiBqaXRzaUF1dGggfSk7XG5cbiAgICAgICAgLy8gVE9ETzogUmVtb3ZlIFVSTCBoYWNrcyB3aGVuIHRoZSBtb2JpbGUgY2xpZW50cyBldmVudHVhbGx5IHN1cHBvcnQgdjIgd2lkZ2V0c1xuICAgICAgICBjb25zdCBwYXJzZWRVcmwgPSBuZXcgVVJMKHdpZGdldFVybCk7XG4gICAgICAgIHBhcnNlZFVybC5zZWFyY2ggPSAnJzsgLy8gc2V0IHRvIGVtcHR5IHN0cmluZyB0byBtYWtlIHRoZSBVUkwgY2xhc3MgdXNlIHNlYXJjaFBhcmFtcyBpbnN0ZWFkXG4gICAgICAgIHBhcnNlZFVybC5zZWFyY2hQYXJhbXMuc2V0KCdjb25mSWQnLCBjb25mSWQpO1xuICAgICAgICB3aWRnZXRVcmwgPSBwYXJzZWRVcmwudG9TdHJpbmcoKTtcblxuICAgICAgICBjb25zdCB3aWRnZXREYXRhID0ge1xuICAgICAgICAgICAgY29uZmVyZW5jZUlkOiBjb25mSWQsXG4gICAgICAgICAgICBpc0F1ZGlvT25seTogdHlwZSA9PT0gJ3ZvaWNlJyxcbiAgICAgICAgICAgIGRvbWFpbjogaml0c2lEb21haW4sXG4gICAgICAgICAgICBhdXRoOiBqaXRzaUF1dGgsXG4gICAgICAgICAgICByb29tTmFtZTogcm9vbS5uYW1lLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHdpZGdldElkID0gKFxuICAgICAgICAgICAgJ2ppdHNpXycgK1xuICAgICAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLmNyZWRlbnRpYWxzLnVzZXJJZCArXG4gICAgICAgICAgICAnXycgK1xuICAgICAgICAgICAgRGF0ZS5ub3coKVxuICAgICAgICApO1xuXG4gICAgICAgIFdpZGdldFV0aWxzLnNldFJvb21XaWRnZXQocm9vbUlkLCB3aWRnZXRJZCwgV2lkZ2V0VHlwZS5KSVRTSSwgd2lkZ2V0VXJsLCAnSml0c2knLCB3aWRnZXREYXRhKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGxvZ2dlci5sb2coJ0ppdHNpIHdpZGdldCBhZGRlZCcpO1xuICAgICAgICB9KS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZXJyY29kZSA9PT0gJ01fRk9SQklEREVOJykge1xuICAgICAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0NhbGwgRmFpbGVkJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBfdCgnUGVybWlzc2lvbiBSZXF1aXJlZCcpLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXCJZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBzdGFydCBhIGNvbmZlcmVuY2UgY2FsbCBpbiB0aGlzIHJvb21cIiksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgdGVybWluYXRlQ2FsbEFwcChyb29tSWQ6IHN0cmluZykge1xuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdDb25maXJtIEppdHNpIFRlcm1pbmF0ZScsICcnLCBRdWVzdGlvbkRpYWxvZywge1xuICAgICAgICAgICAgaGFzQ2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgdGl0bGU6IF90KFwiRW5kIGNvbmZlcmVuY2VcIiksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXCJUaGlzIHdpbGwgZW5kIHRoZSBjb25mZXJlbmNlIGZvciBldmVyeW9uZS4gQ29udGludWU/XCIpLFxuICAgICAgICAgICAgYnV0dG9uOiBfdChcIkVuZCBjb25mZXJlbmNlXCIpLFxuICAgICAgICAgICAgb25GaW5pc2hlZDogKHByb2NlZWQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXByb2NlZWQpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIC8vIFdlJ2xsIGp1c3Qgb2JsaXRlcmF0ZSB0aGVtIGFsbC4gVGhlcmUgc2hvdWxkIG9ubHkgZXZlciBiZSBvbmUsIGJ1dCBtaWdodCBhcyB3ZWxsXG4gICAgICAgICAgICAgICAgLy8gYmUgc2FmZS5cbiAgICAgICAgICAgICAgICBjb25zdCByb29tSW5mbyA9IFdpZGdldFN0b3JlLmluc3RhbmNlLmdldFJvb20ocm9vbUlkKTtcbiAgICAgICAgICAgICAgICBjb25zdCBqaXRzaVdpZGdldHMgPSByb29tSW5mby53aWRnZXRzLmZpbHRlcih3ID0+IFdpZGdldFR5cGUuSklUU0kubWF0Y2hlcyh3LnR5cGUpKTtcbiAgICAgICAgICAgICAgICBqaXRzaVdpZGdldHMuZm9yRWFjaCh3ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0dGluZyBpbnZhbGlkIGNvbnRlbnQgcmVtb3ZlcyBpdFxuICAgICAgICAgICAgICAgICAgICBXaWRnZXRVdGlscy5zZXRSb29tV2lkZ2V0KHJvb21JZCwgdy5pZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmd1cENhbGxBcHAocm9vbUlkOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgcm9vbUluZm8gPSBXaWRnZXRTdG9yZS5pbnN0YW5jZS5nZXRSb29tKHJvb21JZCk7XG4gICAgICAgIGlmICghcm9vbUluZm8pIHJldHVybjsgLy8gXCJzaG91bGQgbmV2ZXIgaGFwcGVuXCIgY2xhdXNlcyBnbyBoZXJlXG5cbiAgICAgICAgY29uc3Qgaml0c2lXaWRnZXRzID0gcm9vbUluZm8ud2lkZ2V0cy5maWx0ZXIodyA9PiBXaWRnZXRUeXBlLkpJVFNJLm1hdGNoZXMody50eXBlKSk7XG4gICAgICAgIGppdHNpV2lkZ2V0cy5mb3JFYWNoKHcgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnaW5nID0gV2lkZ2V0TWVzc2FnaW5nU3RvcmUuaW5zdGFuY2UuZ2V0TWVzc2FnaW5nRm9ySWQody5pZCk7XG4gICAgICAgICAgICBpZiAoIW1lc3NhZ2luZykgcmV0dXJuOyAvLyBtb3JlIFwic2hvdWxkIG5ldmVyIGhhcHBlblwiIHdvcmRzXG5cbiAgICAgICAgICAgIG1lc3NhZ2luZy50cmFuc3BvcnQuc2VuZChFbGVtZW50V2lkZ2V0QWN0aW9ucy5IYW5ndXBDYWxsLCB7fSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgYWRkQ2FsbEZvclJvb20ocm9vbUlkOiBzdHJpbmcsIGNhbGw6IE1hdHJpeENhbGwsIGNoYW5nZWRSb29tcyA9IGZhbHNlKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmNhbGxzLmhhcyhyb29tSWQpKSB7XG4gICAgICAgICAgICBsb2dnZXIubG9nKGBDb3VsZG4ndCBhZGQgY2FsbCB0byByb29tICR7cm9vbUlkfTogYWxyZWFkeSBoYXZlIGEgY2FsbCBmb3IgdGhpcyByb29tYCk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBbHJlYWR5IGhhdmUgYSBjYWxsIGZvciByb29tIFwiICsgcm9vbUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlci5sb2coXCJzZXR0aW5nIGNhbGwgZm9yIHJvb20gXCIgKyByb29tSWQpO1xuICAgICAgICB0aGlzLmNhbGxzLnNldChyb29tSWQsIGNhbGwpO1xuXG4gICAgICAgIC8vIFNob3VsZCB3ZSBhbHdheXMgZW1pdCBDYWxsc0NoYW5nZWQgdG9vP1xuICAgICAgICBpZiAoY2hhbmdlZFJvb21zKSB7XG4gICAgICAgICAgICB0aGlzLmVtaXQoQ2FsbEhhbmRsZXJFdmVudC5DYWxsQ2hhbmdlUm9vbSwgY2FsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVtaXQoQ2FsbEhhbmRsZXJFdmVudC5DYWxsc0NoYW5nZWQsIHRoaXMuY2FsbHMpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19