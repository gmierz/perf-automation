"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RoomListAction = exports.RoomAction = exports.NavigationAction = exports.MessageComposerAction = exports.KeyBindingsManager = exports.AutocompleteAction = void 0;
exports.getKeyBindingsManager = getKeyBindingsManager;
exports.isKeyComboMatch = isKeyComboMatch;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _KeyBindingsDefaults = require("./KeyBindingsDefaults");

var _Keyboard = require("./Keyboard");

/*
Copyright 2021 Clemens Zeidler

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

/** Actions for the chat message composer component */
let MessageComposerAction;
/** Actions for text editing autocompletion */

exports.MessageComposerAction = MessageComposerAction;

(function (MessageComposerAction) {
  MessageComposerAction["Send"] = "Send";
  MessageComposerAction["SelectPrevSendHistory"] = "SelectPrevSendHistory";
  MessageComposerAction["SelectNextSendHistory"] = "SelectNextSendHistory";
  MessageComposerAction["EditPrevMessage"] = "EditPrevMessage";
  MessageComposerAction["EditNextMessage"] = "EditNextMessage";
  MessageComposerAction["CancelEditing"] = "CancelEditing";
  MessageComposerAction["FormatBold"] = "FormatBold";
  MessageComposerAction["FormatItalics"] = "FormatItalics";
  MessageComposerAction["FormatQuote"] = "FormatQuote";
  MessageComposerAction["EditUndo"] = "EditUndo";
  MessageComposerAction["EditRedo"] = "EditRedo";
  MessageComposerAction["NewLine"] = "NewLine";
  MessageComposerAction["MoveCursorToStart"] = "MoveCursorToStart";
  MessageComposerAction["MoveCursorToEnd"] = "MoveCursorToEnd";
})(MessageComposerAction || (exports.MessageComposerAction = MessageComposerAction = {}));

let AutocompleteAction;
/** Actions for the room list sidebar */

exports.AutocompleteAction = AutocompleteAction;

(function (AutocompleteAction) {
  AutocompleteAction["Complete"] = "Complete";
  AutocompleteAction["ForceComplete"] = "ForceComplete";
  AutocompleteAction["PrevSelection"] = "PrevSelection";
  AutocompleteAction["NextSelection"] = "NextSelection";
  AutocompleteAction["Cancel"] = "Cancel";
})(AutocompleteAction || (exports.AutocompleteAction = AutocompleteAction = {}));

let RoomListAction;
/** Actions for the current room view */

exports.RoomListAction = RoomListAction;

(function (RoomListAction) {
  RoomListAction["ClearSearch"] = "ClearSearch";
  RoomListAction["PrevRoom"] = "PrevRoom";
  RoomListAction["NextRoom"] = "NextRoom";
  RoomListAction["SelectRoom"] = "SelectRoom";
  RoomListAction["CollapseSection"] = "CollapseSection";
  RoomListAction["ExpandSection"] = "ExpandSection";
})(RoomListAction || (exports.RoomListAction = RoomListAction = {}));

let RoomAction;
/** Actions for navigating do various menus, dialogs or screens */

exports.RoomAction = RoomAction;

(function (RoomAction) {
  RoomAction["ScrollUp"] = "ScrollUp";
  RoomAction["RoomScrollDown"] = "RoomScrollDown";
  RoomAction["DismissReadMarker"] = "DismissReadMarker";
  RoomAction["JumpToOldestUnread"] = "JumpToOldestUnread";
  RoomAction["UploadFile"] = "UploadFile";
  RoomAction["FocusSearch"] = "FocusSearch";
  RoomAction["JumpToFirstMessage"] = "JumpToFirstMessage";
  RoomAction["JumpToLatestMessage"] = "JumpToLatestMessage";
})(RoomAction || (exports.RoomAction = RoomAction = {}));

let NavigationAction;
/**
 * Represent a key combination.
 *
 * The combo is evaluated strictly, i.e. the KeyboardEvent must match exactly what is specified in the KeyCombo.
 */

exports.NavigationAction = NavigationAction;

(function (NavigationAction) {
  NavigationAction["FocusRoomSearch"] = "FocusRoomSearch";
  NavigationAction["ToggleRoomSidePanel"] = "ToggleRoomSidePanel";
  NavigationAction["ToggleUserMenu"] = "ToggleUserMenu";
  NavigationAction["ToggleShortCutDialog"] = "ToggleShortCutDialog";
  NavigationAction["GoToHome"] = "GoToHome";
  NavigationAction["SelectPrevRoom"] = "SelectPrevRoom";
  NavigationAction["SelectNextRoom"] = "SelectNextRoom";
  NavigationAction["SelectPrevUnreadRoom"] = "SelectPrevUnreadRoom";
  NavigationAction["SelectNextUnreadRoom"] = "SelectNextUnreadRoom";
})(NavigationAction || (exports.NavigationAction = NavigationAction = {}));

/**
 * Helper method to check if a KeyboardEvent matches a KeyCombo
 *
 * Note, this method is only exported for testing.
 */
function isKeyComboMatch(ev, combo, onMac) {
  if (combo.key !== undefined) {
    // When shift is pressed, letters are returned as upper case chars. In this case do a lower case comparison.
    // This works for letter combos such as shift + U as well for none letter combos such as shift + Escape.
    // If shift is not pressed, the toLowerCase conversion can be avoided.
    if (ev.shiftKey) {
      if (ev.key.toLowerCase() !== combo.key.toLowerCase()) {
        return false;
      }
    } else if (ev.key !== combo.key) {
      return false;
    }
  }

  const comboCtrl = combo.ctrlKey ?? false;
  const comboAlt = combo.altKey ?? false;
  const comboShift = combo.shiftKey ?? false;
  const comboMeta = combo.metaKey ?? false; // Tests mock events may keep the modifiers undefined; convert them to booleans

  const evCtrl = ev.ctrlKey ?? false;
  const evAlt = ev.altKey ?? false;
  const evShift = ev.shiftKey ?? false;
  const evMeta = ev.metaKey ?? false; // When ctrlOrCmd is set, the keys need do evaluated differently on PC and Mac

  if (combo.ctrlOrCmd) {
    if (onMac) {
      if (!evMeta || evCtrl !== comboCtrl || evAlt !== comboAlt || evShift !== comboShift) {
        return false;
      }
    } else {
      if (!evCtrl || evMeta !== comboMeta || evAlt !== comboAlt || evShift !== comboShift) {
        return false;
      }
    }

    return true;
  }

  if (evMeta !== comboMeta || evCtrl !== comboCtrl || evAlt !== comboAlt || evShift !== comboShift) {
    return false;
  }

  return true;
}

class KeyBindingsManager {
  constructor() {
    (0, _defineProperty2.default)(this, "bindingsProviders", [_KeyBindingsDefaults.defaultBindingsProvider]);
  }

  /**
   * Finds a matching KeyAction for a given KeyboardEvent
   */
  getAction(getters, ev) {
    for (const getter of getters) {
      const bindings = getter();
      const binding = bindings.find(it => isKeyComboMatch(ev, it.keyCombo, _Keyboard.isMac));

      if (binding) {
        return binding.action;
      }
    }

    return undefined;
  }

  getMessageComposerAction(ev) {
    return this.getAction(this.bindingsProviders.map(it => it.getMessageComposerBindings), ev);
  }

  getAutocompleteAction(ev) {
    return this.getAction(this.bindingsProviders.map(it => it.getAutocompleteBindings), ev);
  }

  getRoomListAction(ev) {
    return this.getAction(this.bindingsProviders.map(it => it.getRoomListBindings), ev);
  }

  getRoomAction(ev) {
    return this.getAction(this.bindingsProviders.map(it => it.getRoomBindings), ev);
  }

  getNavigationAction(ev) {
    return this.getAction(this.bindingsProviders.map(it => it.getNavigationBindings), ev);
  }

}

exports.KeyBindingsManager = KeyBindingsManager;
const manager = new KeyBindingsManager();

function getKeyBindingsManager() {
  return manager;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9LZXlCaW5kaW5nc01hbmFnZXIudHMiXSwibmFtZXMiOlsiTWVzc2FnZUNvbXBvc2VyQWN0aW9uIiwiQXV0b2NvbXBsZXRlQWN0aW9uIiwiUm9vbUxpc3RBY3Rpb24iLCJSb29tQWN0aW9uIiwiTmF2aWdhdGlvbkFjdGlvbiIsImlzS2V5Q29tYm9NYXRjaCIsImV2IiwiY29tYm8iLCJvbk1hYyIsImtleSIsInVuZGVmaW5lZCIsInNoaWZ0S2V5IiwidG9Mb3dlckNhc2UiLCJjb21ib0N0cmwiLCJjdHJsS2V5IiwiY29tYm9BbHQiLCJhbHRLZXkiLCJjb21ib1NoaWZ0IiwiY29tYm9NZXRhIiwibWV0YUtleSIsImV2Q3RybCIsImV2QWx0IiwiZXZTaGlmdCIsImV2TWV0YSIsImN0cmxPckNtZCIsIktleUJpbmRpbmdzTWFuYWdlciIsImRlZmF1bHRCaW5kaW5nc1Byb3ZpZGVyIiwiZ2V0QWN0aW9uIiwiZ2V0dGVycyIsImdldHRlciIsImJpbmRpbmdzIiwiYmluZGluZyIsImZpbmQiLCJpdCIsImtleUNvbWJvIiwiaXNNYWMiLCJhY3Rpb24iLCJnZXRNZXNzYWdlQ29tcG9zZXJBY3Rpb24iLCJiaW5kaW5nc1Byb3ZpZGVycyIsIm1hcCIsImdldE1lc3NhZ2VDb21wb3NlckJpbmRpbmdzIiwiZ2V0QXV0b2NvbXBsZXRlQWN0aW9uIiwiZ2V0QXV0b2NvbXBsZXRlQmluZGluZ3MiLCJnZXRSb29tTGlzdEFjdGlvbiIsImdldFJvb21MaXN0QmluZGluZ3MiLCJnZXRSb29tQWN0aW9uIiwiZ2V0Um9vbUJpbmRpbmdzIiwiZ2V0TmF2aWdhdGlvbkFjdGlvbiIsImdldE5hdmlnYXRpb25CaW5kaW5ncyIsIm1hbmFnZXIiLCJnZXRLZXlCaW5kaW5nc01hbmFnZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QWdGbEMsRUFBaEYsQ0FBUDtBQUNIOztBQUVEbUMsRUFBQUEscUJBQXFCLENBQUNuQyxFQUFELEVBQTBFO0FBQzNGLFdBQU8sS0FBS3FCLFNBQUwsQ0FBZSxLQUFLVyxpQkFBTCxDQUF1QkMsR0FBdkIsQ0FBMkJOLEVBQUUsSUFBSUEsRUFBRSxDQUFDUyx1QkFBcEMsQ0FBZixFQUE2RXBDLEVBQTdFLENBQVA7QUFDSDs7QUFFRHFDLEVBQUFBLGlCQUFpQixDQUFDckMsRUFBRCxFQUFzRTtBQUNuRixXQUFPLEtBQUtxQixTQUFMLENBQWUsS0FBS1csaUJBQUwsQ0FBdUJDLEdBQXZCLENBQTJCTixFQUFFLElBQUlBLEVBQUUsQ0FBQ1csbUJBQXBDLENBQWYsRUFBeUV0QyxFQUF6RSxDQUFQO0FBQ0g7O0FBRUR1QyxFQUFBQSxhQUFhLENBQUN2QyxFQUFELEVBQWtFO0FBQzNFLFdBQU8sS0FBS3FCLFNBQUwsQ0FBZSxLQUFLVyxpQkFBTCxDQUF1QkMsR0FBdkIsQ0FBMkJOLEVBQUUsSUFBSUEsRUFBRSxDQUFDYSxlQUFwQyxDQUFmLEVBQXFFeEMsRUFBckUsQ0FBUDtBQUNIOztBQUVEeUMsRUFBQUEsbUJBQW1CLENBQUN6QyxFQUFELEVBQXdFO0FBQ3ZGLFdBQU8sS0FBS3FCLFNBQUwsQ0FBZSxLQUFLVyxpQkFBTCxDQUF1QkMsR0FBdkIsQ0FBMkJOLEVBQUUsSUFBSUEsRUFBRSxDQUFDZSxxQkFBcEMsQ0FBZixFQUEyRTFDLEVBQTNFLENBQVA7QUFDSDs7QUFoRDJCOzs7QUFtRGhDLE1BQU0yQyxPQUFPLEdBQUcsSUFBSXhCLGtCQUFKLEVBQWhCOztBQUVPLFNBQVN5QixxQkFBVCxHQUFxRDtBQUN4RCxTQUFPRCxPQUFQO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjEgQ2xlbWVucyBaZWlkbGVyXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHsgZGVmYXVsdEJpbmRpbmdzUHJvdmlkZXIgfSBmcm9tICcuL0tleUJpbmRpbmdzRGVmYXVsdHMnO1xuaW1wb3J0IHsgaXNNYWMgfSBmcm9tICcuL0tleWJvYXJkJztcblxuLyoqIEFjdGlvbnMgZm9yIHRoZSBjaGF0IG1lc3NhZ2UgY29tcG9zZXIgY29tcG9uZW50ICovXG5leHBvcnQgZW51bSBNZXNzYWdlQ29tcG9zZXJBY3Rpb24ge1xuICAgIC8qKiBTZW5kIGEgbWVzc2FnZSAqL1xuICAgIFNlbmQgPSAnU2VuZCcsXG4gICAgLyoqIEdvIGJhY2t3YXJkcyB0aHJvdWdoIHRoZSBzZW5kIGhpc3RvcnkgYW5kIHVzZSB0aGUgbWVzc2FnZSBpbiBjb21wb3NlciB2aWV3ICovXG4gICAgU2VsZWN0UHJldlNlbmRIaXN0b3J5ID0gJ1NlbGVjdFByZXZTZW5kSGlzdG9yeScsXG4gICAgLyoqIEdvIGZvcndhcmRzIHRocm91Z2ggdGhlIHNlbmQgaGlzdG9yeSAqL1xuICAgIFNlbGVjdE5leHRTZW5kSGlzdG9yeSA9ICdTZWxlY3ROZXh0U2VuZEhpc3RvcnknLFxuICAgIC8qKiBTdGFydCBlZGl0aW5nIHRoZSB1c2VyJ3MgbGFzdCBzZW50IG1lc3NhZ2UgKi9cbiAgICBFZGl0UHJldk1lc3NhZ2UgPSAnRWRpdFByZXZNZXNzYWdlJyxcbiAgICAvKiogU3RhcnQgZWRpdGluZyB0aGUgdXNlcidzIG5leHQgc2VudCBtZXNzYWdlICovXG4gICAgRWRpdE5leHRNZXNzYWdlID0gJ0VkaXROZXh0TWVzc2FnZScsXG4gICAgLyoqIENhbmNlbCBlZGl0aW5nIGEgbWVzc2FnZSBvciBjYW5jZWwgcmVwbHlpbmcgdG8gYSBtZXNzYWdlICovXG4gICAgQ2FuY2VsRWRpdGluZyA9ICdDYW5jZWxFZGl0aW5nJyxcblxuICAgIC8qKiBTZXQgYm9sZCBmb3JtYXQgdGhlIGN1cnJlbnQgc2VsZWN0aW9uICovXG4gICAgRm9ybWF0Qm9sZCA9ICdGb3JtYXRCb2xkJyxcbiAgICAvKiogU2V0IGl0YWxpY3MgZm9ybWF0IHRoZSBjdXJyZW50IHNlbGVjdGlvbiAqL1xuICAgIEZvcm1hdEl0YWxpY3MgPSAnRm9ybWF0SXRhbGljcycsXG4gICAgLyoqIEZvcm1hdCB0aGUgY3VycmVudCBzZWxlY3Rpb24gYXMgcXVvdGUgKi9cbiAgICBGb3JtYXRRdW90ZSA9ICdGb3JtYXRRdW90ZScsXG4gICAgLyoqIFVuZG8gdGhlIGxhc3QgZWRpdGluZyAqL1xuICAgIEVkaXRVbmRvID0gJ0VkaXRVbmRvJyxcbiAgICAvKiogUmVkbyBlZGl0aW5nICovXG4gICAgRWRpdFJlZG8gPSAnRWRpdFJlZG8nLFxuICAgIC8qKiBJbnNlcnQgbmV3IGxpbmUgKi9cbiAgICBOZXdMaW5lID0gJ05ld0xpbmUnLFxuICAgIC8qKiBNb3ZlIHRoZSBjdXJzb3IgdG8gdGhlIHN0YXJ0IG9mIHRoZSBtZXNzYWdlICovXG4gICAgTW92ZUN1cnNvclRvU3RhcnQgPSAnTW92ZUN1cnNvclRvU3RhcnQnLFxuICAgIC8qKiBNb3ZlIHRoZSBjdXJzb3IgdG8gdGhlIGVuZCBvZiB0aGUgbWVzc2FnZSAqL1xuICAgIE1vdmVDdXJzb3JUb0VuZCA9ICdNb3ZlQ3Vyc29yVG9FbmQnLFxufVxuXG4vKiogQWN0aW9ucyBmb3IgdGV4dCBlZGl0aW5nIGF1dG9jb21wbGV0aW9uICovXG5leHBvcnQgZW51bSBBdXRvY29tcGxldGVBY3Rpb24ge1xuICAgIC8qKiBBY2NlcHRzIGNob3NlbiBhdXRvY29tcGxldGUgc2VsZWN0aW9uICovXG4gICAgQ29tcGxldGUgPSAnQ29tcGxldGUnLFxuICAgIC8qKiBBY2NlcHRzIGNob3NlbiBhdXRvY29tcGxldGUgc2VsZWN0aW9uIG9yLFxuICAgICAqIGlmIHRoZSBhdXRvY29tcGxldGlvbiB3aW5kb3cgaXMgbm90IHNob3duLCBvcGVuIHRoZSB3aW5kb3cgYW5kIHNlbGVjdCB0aGUgZmlyc3Qgc2VsZWN0aW9uICovXG4gICAgRm9yY2VDb21wbGV0ZSA9ICdGb3JjZUNvbXBsZXRlJyxcbiAgICAvKiogTW92ZSB0byB0aGUgcHJldmlvdXMgYXV0b2NvbXBsZXRlIHNlbGVjdGlvbiAqL1xuICAgIFByZXZTZWxlY3Rpb24gPSAnUHJldlNlbGVjdGlvbicsXG4gICAgLyoqIE1vdmUgdG8gdGhlIG5leHQgYXV0b2NvbXBsZXRlIHNlbGVjdGlvbiAqL1xuICAgIE5leHRTZWxlY3Rpb24gPSAnTmV4dFNlbGVjdGlvbicsXG4gICAgLyoqIENsb3NlIHRoZSBhdXRvY29tcGxldGlvbiB3aW5kb3cgKi9cbiAgICBDYW5jZWwgPSAnQ2FuY2VsJyxcbn1cblxuLyoqIEFjdGlvbnMgZm9yIHRoZSByb29tIGxpc3Qgc2lkZWJhciAqL1xuZXhwb3J0IGVudW0gUm9vbUxpc3RBY3Rpb24ge1xuICAgIC8qKiBDbGVhciByb29tIGxpc3QgZmlsdGVyIGZpZWxkICovXG4gICAgQ2xlYXJTZWFyY2ggPSAnQ2xlYXJTZWFyY2gnLFxuICAgIC8qKiBOYXZpZ2F0ZSB1cC9kb3duIGluIHRoZSByb29tIGxpc3QgKi9cbiAgICBQcmV2Um9vbSA9ICdQcmV2Um9vbScsXG4gICAgLyoqIE5hdmlnYXRlIGRvd24gaW4gdGhlIHJvb20gbGlzdCAqL1xuICAgIE5leHRSb29tID0gJ05leHRSb29tJyxcbiAgICAvKiogU2VsZWN0IHJvb20gZnJvbSB0aGUgcm9vbSBsaXN0ICovXG4gICAgU2VsZWN0Um9vbSA9ICdTZWxlY3RSb29tJyxcbiAgICAvKiogQ29sbGFwc2Ugcm9vbSBsaXN0IHNlY3Rpb24gKi9cbiAgICBDb2xsYXBzZVNlY3Rpb24gPSAnQ29sbGFwc2VTZWN0aW9uJyxcbiAgICAvKiogRXhwYW5kIHJvb20gbGlzdCBzZWN0aW9uLCBpZiBhbHJlYWR5IGV4cGFuZGVkLCBqdW1wIHRvIGZpcnN0IHJvb20gaW4gdGhlIHNlbGVjdGlvbiAqL1xuICAgIEV4cGFuZFNlY3Rpb24gPSAnRXhwYW5kU2VjdGlvbicsXG59XG5cbi8qKiBBY3Rpb25zIGZvciB0aGUgY3VycmVudCByb29tIHZpZXcgKi9cbmV4cG9ydCBlbnVtIFJvb21BY3Rpb24ge1xuICAgIC8qKiBTY3JvbGwgdXAgaW4gdGhlIHRpbWVsaW5lICovXG4gICAgU2Nyb2xsVXAgPSAnU2Nyb2xsVXAnLFxuICAgIC8qKiBTY3JvbGwgZG93biBpbiB0aGUgdGltZWxpbmUgKi9cbiAgICBSb29tU2Nyb2xsRG93biA9ICdSb29tU2Nyb2xsRG93bicsXG4gICAgLyoqIERpc21pc3MgcmVhZCBtYXJrZXIgYW5kIGp1bXAgdG8gYm90dG9tICovXG4gICAgRGlzbWlzc1JlYWRNYXJrZXIgPSAnRGlzbWlzc1JlYWRNYXJrZXInLFxuICAgIC8qKiBKdW1wIHRvIG9sZGVzdCB1bnJlYWQgbWVzc2FnZSAqL1xuICAgIEp1bXBUb09sZGVzdFVucmVhZCA9ICdKdW1wVG9PbGRlc3RVbnJlYWQnLFxuICAgIC8qKiBVcGxvYWQgYSBmaWxlICovXG4gICAgVXBsb2FkRmlsZSA9ICdVcGxvYWRGaWxlJyxcbiAgICAvKiogRm9jdXMgc2VhcmNoIG1lc3NhZ2UgaW4gYSByb29tIChtdXN0IGJlIGVuYWJsZWQpICovXG4gICAgRm9jdXNTZWFyY2ggPSAnRm9jdXNTZWFyY2gnLFxuICAgIC8qKiBKdW1wIHRvIHRoZSBmaXJzdCAoZG93bmxvYWRlZCkgbWVzc2FnZSBpbiB0aGUgcm9vbSAqL1xuICAgIEp1bXBUb0ZpcnN0TWVzc2FnZSA9ICdKdW1wVG9GaXJzdE1lc3NhZ2UnLFxuICAgIC8qKiBKdW1wIHRvIHRoZSBsYXRlc3QgbWVzc2FnZSBpbiB0aGUgcm9vbSAqL1xuICAgIEp1bXBUb0xhdGVzdE1lc3NhZ2UgPSAnSnVtcFRvTGF0ZXN0TWVzc2FnZScsXG59XG5cbi8qKiBBY3Rpb25zIGZvciBuYXZpZ2F0aW5nIGRvIHZhcmlvdXMgbWVudXMsIGRpYWxvZ3Mgb3Igc2NyZWVucyAqL1xuZXhwb3J0IGVudW0gTmF2aWdhdGlvbkFjdGlvbiB7XG4gICAgLyoqIEp1bXAgdG8gcm9vbSBzZWFyY2ggKHNlYXJjaCBmb3IgYSByb29tKSAqL1xuICAgIEZvY3VzUm9vbVNlYXJjaCA9ICdGb2N1c1Jvb21TZWFyY2gnLFxuICAgIC8qKiBUb2dnbGUgdGhlIHJvb20gc2lkZSBwYW5lbCAqL1xuICAgIFRvZ2dsZVJvb21TaWRlUGFuZWwgPSAnVG9nZ2xlUm9vbVNpZGVQYW5lbCcsXG4gICAgLyoqIFRvZ2dsZSB0aGUgdXNlciBtZW51ICovXG4gICAgVG9nZ2xlVXNlck1lbnUgPSAnVG9nZ2xlVXNlck1lbnUnLFxuICAgIC8qKiBUb2dnbGUgdGhlIHNob3J0IGN1dCBoZWxwIGRpYWxvZyAqL1xuICAgIFRvZ2dsZVNob3J0Q3V0RGlhbG9nID0gJ1RvZ2dsZVNob3J0Q3V0RGlhbG9nJyxcbiAgICAvKiogR290IHRvIHRoZSBFbGVtZW50IGhvbWUgc2NyZWVuICovXG4gICAgR29Ub0hvbWUgPSAnR29Ub0hvbWUnLFxuICAgIC8qKiBTZWxlY3QgcHJldiByb29tICovXG4gICAgU2VsZWN0UHJldlJvb20gPSAnU2VsZWN0UHJldlJvb20nLFxuICAgIC8qKiBTZWxlY3QgbmV4dCByb29tICovXG4gICAgU2VsZWN0TmV4dFJvb20gPSAnU2VsZWN0TmV4dFJvb20nLFxuICAgIC8qKiBTZWxlY3QgcHJldiByb29tIHdpdGggdW5yZWFkIG1lc3NhZ2VzICovXG4gICAgU2VsZWN0UHJldlVucmVhZFJvb20gPSAnU2VsZWN0UHJldlVucmVhZFJvb20nLFxuICAgIC8qKiBTZWxlY3QgbmV4dCByb29tIHdpdGggdW5yZWFkIG1lc3NhZ2VzICovXG4gICAgU2VsZWN0TmV4dFVucmVhZFJvb20gPSAnU2VsZWN0TmV4dFVucmVhZFJvb20nLFxufVxuXG4vKipcbiAqIFJlcHJlc2VudCBhIGtleSBjb21iaW5hdGlvbi5cbiAqXG4gKiBUaGUgY29tYm8gaXMgZXZhbHVhdGVkIHN0cmljdGx5LCBpLmUuIHRoZSBLZXlib2FyZEV2ZW50IG11c3QgbWF0Y2ggZXhhY3RseSB3aGF0IGlzIHNwZWNpZmllZCBpbiB0aGUgS2V5Q29tYm8uXG4gKi9cbmV4cG9ydCB0eXBlIEtleUNvbWJvID0ge1xuICAgIGtleT86IHN0cmluZztcblxuICAgIC8qKiBPbiBQQzogY3RybCBpcyBwcmVzc2VkOyBvbiBNYWM6IG1ldGEgaXMgcHJlc3NlZCAqL1xuICAgIGN0cmxPckNtZD86IGJvb2xlYW47XG5cbiAgICBhbHRLZXk/OiBib29sZWFuO1xuICAgIGN0cmxLZXk/OiBib29sZWFuO1xuICAgIG1ldGFLZXk/OiBib29sZWFuO1xuICAgIHNoaWZ0S2V5PzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCB0eXBlIEtleUJpbmRpbmc8VCBleHRlbmRzIHN0cmluZz4gPSB7XG4gICAgYWN0aW9uOiBUO1xuICAgIGtleUNvbWJvOiBLZXlDb21ibztcbn07XG5cbi8qKlxuICogSGVscGVyIG1ldGhvZCB0byBjaGVjayBpZiBhIEtleWJvYXJkRXZlbnQgbWF0Y2hlcyBhIEtleUNvbWJvXG4gKlxuICogTm90ZSwgdGhpcyBtZXRob2QgaXMgb25seSBleHBvcnRlZCBmb3IgdGVzdGluZy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzS2V5Q29tYm9NYXRjaChldjogS2V5Ym9hcmRFdmVudCB8IFJlYWN0LktleWJvYXJkRXZlbnQsIGNvbWJvOiBLZXlDb21ibywgb25NYWM6IGJvb2xlYW4pOiBib29sZWFuIHtcbiAgICBpZiAoY29tYm8ua2V5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgLy8gV2hlbiBzaGlmdCBpcyBwcmVzc2VkLCBsZXR0ZXJzIGFyZSByZXR1cm5lZCBhcyB1cHBlciBjYXNlIGNoYXJzLiBJbiB0aGlzIGNhc2UgZG8gYSBsb3dlciBjYXNlIGNvbXBhcmlzb24uXG4gICAgICAgIC8vIFRoaXMgd29ya3MgZm9yIGxldHRlciBjb21ib3Mgc3VjaCBhcyBzaGlmdCArIFUgYXMgd2VsbCBmb3Igbm9uZSBsZXR0ZXIgY29tYm9zIHN1Y2ggYXMgc2hpZnQgKyBFc2NhcGUuXG4gICAgICAgIC8vIElmIHNoaWZ0IGlzIG5vdCBwcmVzc2VkLCB0aGUgdG9Mb3dlckNhc2UgY29udmVyc2lvbiBjYW4gYmUgYXZvaWRlZC5cbiAgICAgICAgaWYgKGV2LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICBpZiAoZXYua2V5LnRvTG93ZXJDYXNlKCkgIT09IGNvbWJvLmtleS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGV2LmtleSAhPT0gY29tYm8ua2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBjb21ib0N0cmwgPSBjb21iby5jdHJsS2V5ID8/IGZhbHNlO1xuICAgIGNvbnN0IGNvbWJvQWx0ID0gY29tYm8uYWx0S2V5ID8/IGZhbHNlO1xuICAgIGNvbnN0IGNvbWJvU2hpZnQgPSBjb21iby5zaGlmdEtleSA/PyBmYWxzZTtcbiAgICBjb25zdCBjb21ib01ldGEgPSBjb21iby5tZXRhS2V5ID8/IGZhbHNlO1xuICAgIC8vIFRlc3RzIG1vY2sgZXZlbnRzIG1heSBrZWVwIHRoZSBtb2RpZmllcnMgdW5kZWZpbmVkOyBjb252ZXJ0IHRoZW0gdG8gYm9vbGVhbnNcbiAgICBjb25zdCBldkN0cmwgPSBldi5jdHJsS2V5ID8/IGZhbHNlO1xuICAgIGNvbnN0IGV2QWx0ID0gZXYuYWx0S2V5ID8/IGZhbHNlO1xuICAgIGNvbnN0IGV2U2hpZnQgPSBldi5zaGlmdEtleSA/PyBmYWxzZTtcbiAgICBjb25zdCBldk1ldGEgPSBldi5tZXRhS2V5ID8/IGZhbHNlO1xuICAgIC8vIFdoZW4gY3RybE9yQ21kIGlzIHNldCwgdGhlIGtleXMgbmVlZCBkbyBldmFsdWF0ZWQgZGlmZmVyZW50bHkgb24gUEMgYW5kIE1hY1xuICAgIGlmIChjb21iby5jdHJsT3JDbWQpIHtcbiAgICAgICAgaWYgKG9uTWFjKSB7XG4gICAgICAgICAgICBpZiAoIWV2TWV0YVxuICAgICAgICAgICAgICAgIHx8IGV2Q3RybCAhPT0gY29tYm9DdHJsXG4gICAgICAgICAgICAgICAgfHwgZXZBbHQgIT09IGNvbWJvQWx0XG4gICAgICAgICAgICAgICAgfHwgZXZTaGlmdCAhPT0gY29tYm9TaGlmdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICghZXZDdHJsXG4gICAgICAgICAgICAgICAgfHwgZXZNZXRhICE9PSBjb21ib01ldGFcbiAgICAgICAgICAgICAgICB8fCBldkFsdCAhPT0gY29tYm9BbHRcbiAgICAgICAgICAgICAgICB8fCBldlNoaWZ0ICE9PSBjb21ib1NoaWZ0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmIChldk1ldGEgIT09IGNvbWJvTWV0YVxuICAgICAgICB8fCBldkN0cmwgIT09IGNvbWJvQ3RybFxuICAgICAgICB8fCBldkFsdCAhPT0gY29tYm9BbHRcbiAgICAgICAgfHwgZXZTaGlmdCAhPT0gY29tYm9TaGlmdCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCB0eXBlIEtleUJpbmRpbmdHZXR0ZXI8VCBleHRlbmRzIHN0cmluZz4gPSAoKSA9PiBLZXlCaW5kaW5nPFQ+W107XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUtleUJpbmRpbmdzUHJvdmlkZXIge1xuICAgIGdldE1lc3NhZ2VDb21wb3NlckJpbmRpbmdzOiBLZXlCaW5kaW5nR2V0dGVyPE1lc3NhZ2VDb21wb3NlckFjdGlvbj47XG4gICAgZ2V0QXV0b2NvbXBsZXRlQmluZGluZ3M6IEtleUJpbmRpbmdHZXR0ZXI8QXV0b2NvbXBsZXRlQWN0aW9uPjtcbiAgICBnZXRSb29tTGlzdEJpbmRpbmdzOiBLZXlCaW5kaW5nR2V0dGVyPFJvb21MaXN0QWN0aW9uPjtcbiAgICBnZXRSb29tQmluZGluZ3M6IEtleUJpbmRpbmdHZXR0ZXI8Um9vbUFjdGlvbj47XG4gICAgZ2V0TmF2aWdhdGlvbkJpbmRpbmdzOiBLZXlCaW5kaW5nR2V0dGVyPE5hdmlnYXRpb25BY3Rpb24+O1xufVxuXG5leHBvcnQgY2xhc3MgS2V5QmluZGluZ3NNYW5hZ2VyIHtcbiAgICAvKipcbiAgICAgKiBMaXN0IG9mIGtleSBiaW5kaW5ncyBwcm92aWRlcnMuXG4gICAgICpcbiAgICAgKiBLZXkgYmluZGluZ3MgZnJvbSB0aGUgZmlyc3QgcHJvdmlkZXIocykgaW4gdGhlIGxpc3Qgd2lsbCBoYXZlIHByZWNlZGVuY2Ugb3ZlciBrZXkgYmluZGluZ3MgZnJvbSBsYXRlciBwcm92aWRlcnMuXG4gICAgICpcbiAgICAgKiBUbyBvdmVyd3JpdGUgdGhlIGRlZmF1bHQga2V5IGJpbmRpbmdzIGFkZCBhIG5ldyBwcm92aWRlcnMgYmVmb3JlIHRoZSBkZWZhdWx0IHByb3ZpZGVyLCBlLmcuIGEgcHJvdmlkZXIgZm9yXG4gICAgICogY3VzdG9taXplZCBrZXkgYmluZGluZ3MuXG4gICAgICovXG4gICAgYmluZGluZ3NQcm92aWRlcnM6IElLZXlCaW5kaW5nc1Byb3ZpZGVyW10gPSBbXG4gICAgICAgIGRlZmF1bHRCaW5kaW5nc1Byb3ZpZGVyLFxuICAgIF07XG5cbiAgICAvKipcbiAgICAgKiBGaW5kcyBhIG1hdGNoaW5nIEtleUFjdGlvbiBmb3IgYSBnaXZlbiBLZXlib2FyZEV2ZW50XG4gICAgICovXG4gICAgcHJpdmF0ZSBnZXRBY3Rpb248VCBleHRlbmRzIHN0cmluZz4oXG4gICAgICAgIGdldHRlcnM6IEtleUJpbmRpbmdHZXR0ZXI8VD5bXSxcbiAgICAgICAgZXY6IEtleWJvYXJkRXZlbnQgfCBSZWFjdC5LZXlib2FyZEV2ZW50LFxuICAgICk6IFQgfCB1bmRlZmluZWQge1xuICAgICAgICBmb3IgKGNvbnN0IGdldHRlciBvZiBnZXR0ZXJzKSB7XG4gICAgICAgICAgICBjb25zdCBiaW5kaW5ncyA9IGdldHRlcigpO1xuICAgICAgICAgICAgY29uc3QgYmluZGluZyA9IGJpbmRpbmdzLmZpbmQoaXQgPT4gaXNLZXlDb21ib01hdGNoKGV2LCBpdC5rZXlDb21ibywgaXNNYWMpKTtcbiAgICAgICAgICAgIGlmIChiaW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJpbmRpbmcuYWN0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgZ2V0TWVzc2FnZUNvbXBvc2VyQWN0aW9uKGV2OiBLZXlib2FyZEV2ZW50IHwgUmVhY3QuS2V5Ym9hcmRFdmVudCk6IE1lc3NhZ2VDb21wb3NlckFjdGlvbiB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEFjdGlvbih0aGlzLmJpbmRpbmdzUHJvdmlkZXJzLm1hcChpdCA9PiBpdC5nZXRNZXNzYWdlQ29tcG9zZXJCaW5kaW5ncyksIGV2KTtcbiAgICB9XG5cbiAgICBnZXRBdXRvY29tcGxldGVBY3Rpb24oZXY6IEtleWJvYXJkRXZlbnQgfCBSZWFjdC5LZXlib2FyZEV2ZW50KTogQXV0b2NvbXBsZXRlQWN0aW9uIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWN0aW9uKHRoaXMuYmluZGluZ3NQcm92aWRlcnMubWFwKGl0ID0+IGl0LmdldEF1dG9jb21wbGV0ZUJpbmRpbmdzKSwgZXYpO1xuICAgIH1cblxuICAgIGdldFJvb21MaXN0QWN0aW9uKGV2OiBLZXlib2FyZEV2ZW50IHwgUmVhY3QuS2V5Ym9hcmRFdmVudCk6IFJvb21MaXN0QWN0aW9uIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWN0aW9uKHRoaXMuYmluZGluZ3NQcm92aWRlcnMubWFwKGl0ID0+IGl0LmdldFJvb21MaXN0QmluZGluZ3MpLCBldik7XG4gICAgfVxuXG4gICAgZ2V0Um9vbUFjdGlvbihldjogS2V5Ym9hcmRFdmVudCB8IFJlYWN0LktleWJvYXJkRXZlbnQpOiBSb29tQWN0aW9uIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWN0aW9uKHRoaXMuYmluZGluZ3NQcm92aWRlcnMubWFwKGl0ID0+IGl0LmdldFJvb21CaW5kaW5ncyksIGV2KTtcbiAgICB9XG5cbiAgICBnZXROYXZpZ2F0aW9uQWN0aW9uKGV2OiBLZXlib2FyZEV2ZW50IHwgUmVhY3QuS2V5Ym9hcmRFdmVudCk6IE5hdmlnYXRpb25BY3Rpb24gfCB1bmRlZmluZWQge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBY3Rpb24odGhpcy5iaW5kaW5nc1Byb3ZpZGVycy5tYXAoaXQgPT4gaXQuZ2V0TmF2aWdhdGlvbkJpbmRpbmdzKSwgZXYpO1xuICAgIH1cbn1cblxuY29uc3QgbWFuYWdlciA9IG5ldyBLZXlCaW5kaW5nc01hbmFnZXIoKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldEtleUJpbmRpbmdzTWFuYWdlcigpOiBLZXlCaW5kaW5nc01hbmFnZXIge1xuICAgIHJldHVybiBtYW5hZ2VyO1xufVxuIl19