"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Formatting = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _languageHandler = require("../../../languageHandler");

var _AccessibleTooltipButton = _interopRequireDefault(require("../elements/AccessibleTooltipButton"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let Formatting;
exports.Formatting = Formatting;

(function (Formatting) {
  Formatting["Bold"] = "bold";
  Formatting["Italics"] = "italics";
  Formatting["Strikethrough"] = "strikethrough";
  Formatting["Code"] = "code";
  Formatting["Quote"] = "quote";
  Formatting["InsertLink"] = "insert_link";
})(Formatting || (exports.Formatting = Formatting = {}));

let MessageComposerFormatBar = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.MessageComposerFormatBar"), _dec(_class = class MessageComposerFormatBar extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "formatBarRef", /*#__PURE__*/(0, _react.createRef)());
    this.state = {
      visible: false
    };
  }

  render() {
    const classes = (0, _classnames.default)("mx_MessageComposerFormatBar", {
      "mx_MessageComposerFormatBar_shown": this.state.visible
    });
    return /*#__PURE__*/_react.default.createElement("div", {
      className: classes,
      ref: this.formatBarRef
    }, /*#__PURE__*/_react.default.createElement(FormatButton, {
      label: (0, _languageHandler._t)("Bold"),
      onClick: () => this.props.onAction(Formatting.Bold),
      icon: "Bold",
      shortcut: this.props.shortcuts.bold,
      visible: this.state.visible
    }), /*#__PURE__*/_react.default.createElement(FormatButton, {
      label: (0, _languageHandler._t)("Italics"),
      onClick: () => this.props.onAction(Formatting.Italics),
      icon: "Italic",
      shortcut: this.props.shortcuts.italics,
      visible: this.state.visible
    }), /*#__PURE__*/_react.default.createElement(FormatButton, {
      label: (0, _languageHandler._t)("Strikethrough"),
      onClick: () => this.props.onAction(Formatting.Strikethrough),
      icon: "Strikethrough",
      visible: this.state.visible
    }), /*#__PURE__*/_react.default.createElement(FormatButton, {
      label: (0, _languageHandler._t)("Code block"),
      onClick: () => this.props.onAction(Formatting.Code),
      icon: "Code",
      visible: this.state.visible
    }), /*#__PURE__*/_react.default.createElement(FormatButton, {
      label: (0, _languageHandler._t)("Quote"),
      onClick: () => this.props.onAction(Formatting.Quote),
      icon: "Quote",
      shortcut: this.props.shortcuts.quote,
      visible: this.state.visible
    }), /*#__PURE__*/_react.default.createElement(FormatButton, {
      label: (0, _languageHandler._t)("Insert link"),
      onClick: () => this.props.onAction(Formatting.InsertLink),
      icon: "InsertLink",
      visible: this.state.visible
    }));
  }

  showAt(selectionRect) {
    if (!this.formatBarRef.current) return;
    this.setState({
      visible: true
    });
    const parentRect = this.formatBarRef.current.parentElement.getBoundingClientRect();
    this.formatBarRef.current.style.left = `${selectionRect.left - parentRect.left}px`; // 16 is half the height of the bar (e.g. to center it) and 18 is an offset that felt ok.

    this.formatBarRef.current.style.top = `${selectionRect.top - parentRect.top - 16 - 18}px`;
  }

  hide() {
    this.setState({
      visible: false
    });
  }

}) || _class);
exports.default = MessageComposerFormatBar;

class FormatButton extends _react.default.PureComponent {
  render() {
    const className = `mx_MessageComposerFormatBar_button mx_MessageComposerFormatBar_buttonIcon${this.props.icon}`;
    let shortcut;

    if (this.props.shortcut) {
      shortcut = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MessageComposerFormatBar_tooltipShortcut"
      }, this.props.shortcut);
    }

    const tooltip = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Tooltip_title"
    }, this.props.label), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Tooltip_sub"
    }, shortcut));

    return /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
      onClick: this.props.onClick,
      title: this.props.label,
      tooltip: tooltip,
      className: className
    });
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL01lc3NhZ2VDb21wb3NlckZvcm1hdEJhci50c3giXSwibmFtZXMiOlsiRm9ybWF0dGluZyIsIk1lc3NhZ2VDb21wb3NlckZvcm1hdEJhciIsIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzdGF0ZSIsInZpc2libGUiLCJyZW5kZXIiLCJjbGFzc2VzIiwiZm9ybWF0QmFyUmVmIiwib25BY3Rpb24iLCJCb2xkIiwic2hvcnRjdXRzIiwiYm9sZCIsIkl0YWxpY3MiLCJpdGFsaWNzIiwiU3RyaWtldGhyb3VnaCIsIkNvZGUiLCJRdW90ZSIsInF1b3RlIiwiSW5zZXJ0TGluayIsInNob3dBdCIsInNlbGVjdGlvblJlY3QiLCJjdXJyZW50Iiwic2V0U3RhdGUiLCJwYXJlbnRSZWN0IiwicGFyZW50RWxlbWVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInN0eWxlIiwibGVmdCIsInRvcCIsImhpZGUiLCJGb3JtYXRCdXR0b24iLCJjbGFzc05hbWUiLCJpY29uIiwic2hvcnRjdXQiLCJ0b29sdGlwIiwibGFiZWwiLCJvbkNsaWNrIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7SUFFWUEsVTs7O1dBQUFBLFU7QUFBQUEsRUFBQUEsVTtBQUFBQSxFQUFBQSxVO0FBQUFBLEVBQUFBLFU7QUFBQUEsRUFBQUEsVTtBQUFBQSxFQUFBQSxVO0FBQUFBLEVBQUFBLFU7R0FBQUEsVSwwQkFBQUEsVTs7SUFtQlNDLHdCLFdBRHBCLGdEQUFxQixzQ0FBckIsQyxnQkFBRCxNQUNxQkEsd0JBRHJCLFNBQ3NEQyxlQUFNQyxhQUQ1RCxDQUMwRjtBQUd0RkMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0FBQ3ZCLFVBQU1BLEtBQU47QUFEdUIscUVBRkssdUJBRUw7QUFFdkIsU0FBS0MsS0FBTCxHQUFh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RHhCO0FBRUksTUFBQSxLQUFLLEVBQUUsS0FBS2xDLEtBQUwsQ0FBV2lDLEtBRnRCO0FBR0ksTUFBQSxPQUFPLEVBQUVELE9BSGI7QUFJSSxNQUFBLFNBQVMsRUFBRUg7QUFKZixNQURKO0FBT0g7O0FBekI4RCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOSAtIDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgY3JlYXRlUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5cbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvbiBmcm9tIFwiLi4vZWxlbWVudHMvQWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5cbmV4cG9ydCBlbnVtIEZvcm1hdHRpbmcge1xuICAgIEJvbGQgPSBcImJvbGRcIixcbiAgICBJdGFsaWNzID0gXCJpdGFsaWNzXCIsXG4gICAgU3RyaWtldGhyb3VnaCA9IFwic3RyaWtldGhyb3VnaFwiLFxuICAgIENvZGUgPSBcImNvZGVcIixcbiAgICBRdW90ZSA9IFwicXVvdGVcIixcbiAgICBJbnNlcnRMaW5rID0gXCJpbnNlcnRfbGlua1wiLFxufVxuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBzaG9ydGN1dHM6IFBhcnRpYWw8UmVjb3JkPEZvcm1hdHRpbmcsIHN0cmluZz4+O1xuICAgIG9uQWN0aW9uKGFjdGlvbjogRm9ybWF0dGluZyk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHZpc2libGU6IGJvb2xlYW47XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLnJvb21zLk1lc3NhZ2VDb21wb3NlckZvcm1hdEJhclwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVzc2FnZUNvbXBvc2VyRm9ybWF0QmFyIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgZm9ybWF0QmFyUmVmID0gY3JlYXRlUmVmPEhUTUxEaXZFbGVtZW50PigpO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7IHZpc2libGU6IGZhbHNlIH07XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBjbGFzc2VzID0gY2xhc3NOYW1lcyhcIm14X01lc3NhZ2VDb21wb3NlckZvcm1hdEJhclwiLCB7XG4gICAgICAgICAgICBcIm14X01lc3NhZ2VDb21wb3NlckZvcm1hdEJhcl9zaG93blwiOiB0aGlzLnN0YXRlLnZpc2libGUsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzfSByZWY9e3RoaXMuZm9ybWF0QmFyUmVmfT5cbiAgICAgICAgICAgIDxGb3JtYXRCdXR0b24gbGFiZWw9e190KFwiQm9sZFwiKX0gb25DbGljaz17KCkgPT4gdGhpcy5wcm9wcy5vbkFjdGlvbihGb3JtYXR0aW5nLkJvbGQpfSBpY29uPVwiQm9sZFwiIHNob3J0Y3V0PXt0aGlzLnByb3BzLnNob3J0Y3V0cy5ib2xkfSB2aXNpYmxlPXt0aGlzLnN0YXRlLnZpc2libGV9IC8+XG4gICAgICAgICAgICA8Rm9ybWF0QnV0dG9uIGxhYmVsPXtfdChcIkl0YWxpY3NcIil9IG9uQ2xpY2s9eygpID0+IHRoaXMucHJvcHMub25BY3Rpb24oRm9ybWF0dGluZy5JdGFsaWNzKX0gaWNvbj1cIkl0YWxpY1wiIHNob3J0Y3V0PXt0aGlzLnByb3BzLnNob3J0Y3V0cy5pdGFsaWNzfSB2aXNpYmxlPXt0aGlzLnN0YXRlLnZpc2libGV9IC8+XG4gICAgICAgICAgICA8Rm9ybWF0QnV0dG9uIGxhYmVsPXtfdChcIlN0cmlrZXRocm91Z2hcIil9IG9uQ2xpY2s9eygpID0+IHRoaXMucHJvcHMub25BY3Rpb24oRm9ybWF0dGluZy5TdHJpa2V0aHJvdWdoKX0gaWNvbj1cIlN0cmlrZXRocm91Z2hcIiB2aXNpYmxlPXt0aGlzLnN0YXRlLnZpc2libGV9IC8+XG4gICAgICAgICAgICA8Rm9ybWF0QnV0dG9uIGxhYmVsPXtfdChcIkNvZGUgYmxvY2tcIil9IG9uQ2xpY2s9eygpID0+IHRoaXMucHJvcHMub25BY3Rpb24oRm9ybWF0dGluZy5Db2RlKX0gaWNvbj1cIkNvZGVcIiB2aXNpYmxlPXt0aGlzLnN0YXRlLnZpc2libGV9IC8+XG4gICAgICAgICAgICA8Rm9ybWF0QnV0dG9uIGxhYmVsPXtfdChcIlF1b3RlXCIpfSBvbkNsaWNrPXsoKSA9PiB0aGlzLnByb3BzLm9uQWN0aW9uKEZvcm1hdHRpbmcuUXVvdGUpfSBpY29uPVwiUXVvdGVcIiBzaG9ydGN1dD17dGhpcy5wcm9wcy5zaG9ydGN1dHMucXVvdGV9IHZpc2libGU9e3RoaXMuc3RhdGUudmlzaWJsZX0gLz5cbiAgICAgICAgICAgIDxGb3JtYXRCdXR0b24gbGFiZWw9e190KFwiSW5zZXJ0IGxpbmtcIil9IG9uQ2xpY2s9eygpID0+IHRoaXMucHJvcHMub25BY3Rpb24oRm9ybWF0dGluZy5JbnNlcnRMaW5rKX0gaWNvbj1cIkluc2VydExpbmtcIiB2aXNpYmxlPXt0aGlzLnN0YXRlLnZpc2libGV9IC8+XG4gICAgICAgIDwvZGl2Pik7XG4gICAgfVxuXG4gICAgcHVibGljIHNob3dBdChzZWxlY3Rpb25SZWN0OiBET01SZWN0KTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5mb3JtYXRCYXJSZWYuY3VycmVudCkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2aXNpYmxlOiB0cnVlIH0pO1xuICAgICAgICBjb25zdCBwYXJlbnRSZWN0ID0gdGhpcy5mb3JtYXRCYXJSZWYuY3VycmVudC5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICB0aGlzLmZvcm1hdEJhclJlZi5jdXJyZW50LnN0eWxlLmxlZnQgPSBgJHtzZWxlY3Rpb25SZWN0LmxlZnQgLSBwYXJlbnRSZWN0LmxlZnR9cHhgO1xuICAgICAgICAvLyAxNiBpcyBoYWxmIHRoZSBoZWlnaHQgb2YgdGhlIGJhciAoZS5nLiB0byBjZW50ZXIgaXQpIGFuZCAxOCBpcyBhbiBvZmZzZXQgdGhhdCBmZWx0IG9rLlxuICAgICAgICB0aGlzLmZvcm1hdEJhclJlZi5jdXJyZW50LnN0eWxlLnRvcCA9IGAke3NlbGVjdGlvblJlY3QudG9wIC0gcGFyZW50UmVjdC50b3AgLSAxNiAtIDE4fXB4YDtcbiAgICB9XG5cbiAgICBwdWJsaWMgaGlkZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZpc2libGU6IGZhbHNlIH0pO1xuICAgIH1cbn1cblxuaW50ZXJmYWNlIElGb3JtYXRCdXR0b25Qcm9wcyB7XG4gICAgbGFiZWw6IHN0cmluZztcbiAgICBpY29uOiBzdHJpbmc7XG4gICAgc2hvcnRjdXQ/OiBzdHJpbmc7XG4gICAgdmlzaWJsZT86IGJvb2xlYW47XG4gICAgb25DbGljaygpOiB2b2lkO1xufVxuXG5jbGFzcyBGb3JtYXRCdXR0b24gZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElGb3JtYXRCdXR0b25Qcm9wcz4ge1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gYG14X01lc3NhZ2VDb21wb3NlckZvcm1hdEJhcl9idXR0b24gbXhfTWVzc2FnZUNvbXBvc2VyRm9ybWF0QmFyX2J1dHRvbkljb24ke3RoaXMucHJvcHMuaWNvbn1gO1xuICAgICAgICBsZXQgc2hvcnRjdXQ7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnNob3J0Y3V0KSB7XG4gICAgICAgICAgICBzaG9ydGN1dCA9IDxkaXYgY2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbXBvc2VyRm9ybWF0QmFyX3Rvb2x0aXBTaG9ydGN1dFwiPlxuICAgICAgICAgICAgICAgIHsgdGhpcy5wcm9wcy5zaG9ydGN1dCB9XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdG9vbHRpcCA9IDxkaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Rvb2x0aXBfdGl0bGVcIj5cbiAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMubGFiZWwgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Rvb2x0aXBfc3ViXCI+XG4gICAgICAgICAgICAgICAgeyBzaG9ydGN1dCB9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+O1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnByb3BzLm9uQ2xpY2t9XG4gICAgICAgICAgICAgICAgdGl0bGU9e3RoaXMucHJvcHMubGFiZWx9XG4gICAgICAgICAgICAgICAgdG9vbHRpcD17dG9vbHRpcH1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX0gLz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=