"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
exports.getDisplayAliasForRoom = getDisplayAliasForRoom;
exports.roomShape = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var sdk = _interopRequireWildcard(require("../../../index"));

var _react = _interopRequireWildcard(require("react"));

var _languageHandler = require("../../../languageHandler");

var _HtmlUtils = require("../../../HtmlUtils");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Media = require("../../../customisations/Media");

var _Rooms = require("../../../Rooms");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function getDisplayAliasForRoom(room) {
  return (0, _Rooms.getDisplayAliasForAliasSet)(room.canonicalAlias, room.aliases);
}

const roomShape = _propTypes.default.shape({
  name: _propTypes.default.string,
  topic: _propTypes.default.string,
  roomId: _propTypes.default.string,
  avatarUrl: _propTypes.default.string,
  numJoinedMembers: _propTypes.default.number,
  canonicalAlias: _propTypes.default.string,
  aliases: _propTypes.default.arrayOf(_propTypes.default.string),
  worldReadable: _propTypes.default.bool,
  guestCanJoin: _propTypes.default.bool
});

exports.roomShape = roomShape;
let RoomDetailRow = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.RoomDetailRow"), _dec(_class = (_temp = _class2 = class RoomDetailRow extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onClick", ev => {
      ev.preventDefault();

      if (this.props.onClick) {
        this.props.onClick(ev, this.props.room);
      }
    });
    (0, _defineProperty2.default)(this, "onTopicClick", ev => {
      // When clicking a link in the topic, prevent the event being propagated
      // to `onClick`.
      ev.stopPropagation();
    });
    this._topic = /*#__PURE__*/(0, _react.createRef)();
  }

  componentDidMount() {
    this._linkifyTopic();
  }

  componentDidUpdate() {
    this._linkifyTopic();
  }

  _linkifyTopic() {
    if (this._topic.current) {
      (0, _HtmlUtils.linkifyElement)(this._topic.current);
    }
  }

  render() {
    const BaseAvatar = sdk.getComponent('avatars.BaseAvatar');
    const room = this.props.room;
    const name = room.name || getDisplayAliasForRoom(room) || (0, _languageHandler._t)('Unnamed room');
    const guestRead = room.worldReadable ? /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomDirectory_perm"
    }, (0, _languageHandler._t)('World readable')) : /*#__PURE__*/_react.default.createElement("div", null);
    const guestJoin = room.guestCanJoin ? /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomDirectory_perm"
    }, (0, _languageHandler._t)('Guests can join')) : /*#__PURE__*/_react.default.createElement("div", null);
    const perms = guestRead || guestJoin ? /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomDirectory_perms"
    }, guestRead, "\xA0", guestJoin) : /*#__PURE__*/_react.default.createElement("div", null);
    let avatarUrl = null;
    if (room.avatarUrl) avatarUrl = (0, _Media.mediaFromMxc)(room.avatarUrl).getSquareThumbnailHttp(24);
    return /*#__PURE__*/_react.default.createElement("tr", {
      key: room.roomId,
      onClick: this.onClick,
      onMouseDown: this.props.onMouseDown
    }, /*#__PURE__*/_react.default.createElement("td", {
      className: "mx_RoomDirectory_roomAvatar"
    }, /*#__PURE__*/_react.default.createElement(BaseAvatar, {
      width: 24,
      height: 24,
      resizeMethod: "crop",
      name: name,
      idName: name,
      url: avatarUrl
    })), /*#__PURE__*/_react.default.createElement("td", {
      className: "mx_RoomDirectory_roomDescription"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomDirectory_name"
    }, name), "\xA0", perms, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomDirectory_topic",
      ref: this._topic,
      onClick: this.onTopicClick
    }, room.topic), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomDirectory_alias"
    }, getDisplayAliasForRoom(room))), /*#__PURE__*/_react.default.createElement("td", {
      className: "mx_RoomDirectory_roomMemberCount"
    }, room.numJoinedMembers));
  }

}, (0, _defineProperty2.default)(_class2, "propTypes", {
  room: roomShape,
  // passes ev, room as args
  onClick: _propTypes.default.func,
  onMouseDown: _propTypes.default.func
}), _temp)) || _class);
exports.default = RoomDetailRow;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL1Jvb21EZXRhaWxSb3cuanMiXSwibmFtZXMiOlsiZ2V0RGlzcGxheUFsaWFzRm9yUm9vbSIsInJvb20iLCJjYW5vbmljYWxBbGlhcyIsImFsaWFzZXMiLCJyb29tU2hhcGUiLCJQcm9wVHlwZXMiLCJzaGFwZSIsIm5hbWUiLCJzdHJpbmciLCJ0b3BpYyIsInJvb21JZCIsImF2YXRhclVybCIsIm51bUpvaW5lZE1lbWJlcnMiLCJudW1iZXIiLCJhcnJheU9mIiwid29ybGRSZWFkYWJsZSIsImJvb2wiLCJndWVzdENhbkpvaW4iLCJSb29tRGV0YWlsUm93IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiZXYiLCJwcmV2ZW50RGVmYXVsdCIsIm9uQ2xpY2siLCJzdG9wUHJvcGFnYXRpb24iLCJfdG9waWMiLCJjb21wb25lbnREaWRNb3VudCIsIl9saW5raWZ5VG9waWMiLCJjb21wb25lbnREaWRVcGRhdGUiLCJjdXJyZW50IiwicmVuZGVyIiwiQmFzZUF2YXRhciIsInNkayIsImdldENvbXBvbmVudCIsImd1ZXN0UmVhZCIsImd1ZXN0Sm9pbiIsInBlcm1zIiwiZ2V0U3F1YXJlVGh1bWJuYWlsSHR0cCIsIm9uTW91c2VEb3duIiwib25Ub3BpY0NsaWNrIiwiZnVuYyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFFTyxTQUFTQSxzQkFBVCxDQUFnQ0MsSUFBaEMsRUFBc0M7QUFDekMsU0FBTyx1Q0FBMkJBLElBQUksQ0FBQ0MsY0FBaEMsRUFBZ0RELElBQUksQ0FBQ0UsT0FBckQsQ0FBUDtBQUNIOztBQUVNLE1BQU1DLFNBQVMsR0FBR0MsbUJBQVVDLEtBQVYsQ0FBZ0I7QUFDckNDLEVBQUFBLElBQUksRUFBRUYsbUJBQVVHLE1BRHFCO0FBRXJDQyxFQUFB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TUFBQSxLQUFLLEVBQUUsRUFEWDtBQUVJLE1BQUEsTUFBTSxFQUFFLEVBRlo7QUFHSSxNQUFBLFlBQVksRUFBQyxNQUhqQjtBQUlJLE1BQUEsSUFBSSxFQUFFakMsSUFKVjtBQUtJLE1BQUEsTUFBTSxFQUFFQSxJQUxaO0FBTUksTUFBQSxHQUFHLEVBQUVJO0FBTlQsTUFESixDQURHLGVBVUg7QUFBSSxNQUFBLFNBQVMsRUFBQztBQUFkLG9CQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUF5Q0osSUFBekMsQ0FESixVQUVNK0IsS0FGTixlQUdJO0FBQUssTUFBQSxTQUFTLEVBQUMsd0JBQWY7QUFBd0MsTUFBQSxHQUFHLEVBQUUsS0FBS1gsTUFBbEQ7QUFBMEQsTUFBQSxPQUFPLEVBQUUsS0FBS2M7QUFBeEUsT0FDTXhDLElBQUksQ0FBQ1EsS0FEWCxDQUhKLGVBTUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQTBDVCxzQkFBc0IsQ0FBQ0MsSUFBRCxDQUFoRSxDQU5KLENBVkcsZUFrQkg7QUFBSSxNQUFBLFNBQVMsRUFBQztBQUFkLE9BQ01BLElBQUksQ0FBQ1csZ0JBRFgsQ0FsQkcsQ0FBUDtBQXNCSDs7QUFwRnNELEMsc0RBQ3BDO0FBQ2ZYLEVBQUFBLElBQUksRUFBRUcsU0FEUztBQUVmO0FBQ0FxQixFQUFBQSxPQUFPLEVBQUVwQixtQkFBVXFDLElBSEo7QUFJZkYsRUFBQUEsV0FBVyxFQUFFbkMsbUJBQVVxQztBQUpSLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTctMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCAqIGFzIHNkayBmcm9tICcuLi8uLi8uLi9pbmRleCc7XG5pbXBvcnQgUmVhY3QsIHsgY3JlYXRlUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IHsgbGlua2lmeUVsZW1lbnQgfSBmcm9tICcuLi8uLi8uLi9IdG1sVXRpbHMnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBtZWRpYUZyb21NeGMgfSBmcm9tIFwiLi4vLi4vLi4vY3VzdG9taXNhdGlvbnMvTWVkaWFcIjtcbmltcG9ydCB7IGdldERpc3BsYXlBbGlhc0ZvckFsaWFzU2V0IH0gZnJvbSAnLi4vLi4vLi4vUm9vbXMnO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGlzcGxheUFsaWFzRm9yUm9vbShyb29tKSB7XG4gICAgcmV0dXJuIGdldERpc3BsYXlBbGlhc0ZvckFsaWFzU2V0KHJvb20uY2Fub25pY2FsQWxpYXMsIHJvb20uYWxpYXNlcyk7XG59XG5cbmV4cG9ydCBjb25zdCByb29tU2hhcGUgPSBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdG9waWM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgcm9vbUlkOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGF2YXRhclVybDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBudW1Kb2luZWRNZW1iZXJzOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIGNhbm9uaWNhbEFsaWFzOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGFsaWFzZXM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zdHJpbmcpLFxuXG4gICAgd29ybGRSZWFkYWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgZ3Vlc3RDYW5Kb2luOiBQcm9wVHlwZXMuYm9vbCxcbn0pO1xuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5yb29tcy5Sb29tRGV0YWlsUm93XCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSb29tRGV0YWlsUm93IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgICAgICByb29tOiByb29tU2hhcGUsXG4gICAgICAgIC8vIHBhc3NlcyBldiwgcm9vbSBhcyBhcmdzXG4gICAgICAgIG9uQ2xpY2s6IFByb3BUeXBlcy5mdW5jLFxuICAgICAgICBvbk1vdXNlRG93bjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLl90b3BpYyA9IGNyZWF0ZVJlZigpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB0aGlzLl9saW5raWZ5VG9waWMoKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgICAgIHRoaXMuX2xpbmtpZnlUb3BpYygpO1xuICAgIH1cblxuICAgIF9saW5raWZ5VG9waWMoKSB7XG4gICAgICAgIGlmICh0aGlzLl90b3BpYy5jdXJyZW50KSB7XG4gICAgICAgICAgICBsaW5raWZ5RWxlbWVudCh0aGlzLl90b3BpYy5jdXJyZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uQ2xpY2sgPSAoZXYpID0+IHtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25DbGljaykge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkNsaWNrKGV2LCB0aGlzLnByb3BzLnJvb20pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIG9uVG9waWNDbGljayA9IChldikgPT4ge1xuICAgICAgICAvLyBXaGVuIGNsaWNraW5nIGEgbGluayBpbiB0aGUgdG9waWMsIHByZXZlbnQgdGhlIGV2ZW50IGJlaW5nIHByb3BhZ2F0ZWRcbiAgICAgICAgLy8gdG8gYG9uQ2xpY2tgLlxuICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9O1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBCYXNlQXZhdGFyID0gc2RrLmdldENvbXBvbmVudCgnYXZhdGFycy5CYXNlQXZhdGFyJyk7XG5cbiAgICAgICAgY29uc3Qgcm9vbSA9IHRoaXMucHJvcHMucm9vbTtcbiAgICAgICAgY29uc3QgbmFtZSA9IHJvb20ubmFtZSB8fCBnZXREaXNwbGF5QWxpYXNGb3JSb29tKHJvb20pIHx8IF90KCdVbm5hbWVkIHJvb20nKTtcblxuICAgICAgICBjb25zdCBndWVzdFJlYWQgPSByb29tLndvcmxkUmVhZGFibGUgPyAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Jvb21EaXJlY3RvcnlfcGVybVwiPnsgX3QoJ1dvcmxkIHJlYWRhYmxlJykgfTwvZGl2PlxuICAgICAgICApIDogPGRpdiAvPjtcbiAgICAgICAgY29uc3QgZ3Vlc3RKb2luID0gcm9vbS5ndWVzdENhbkpvaW4gPyAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Jvb21EaXJlY3RvcnlfcGVybVwiPnsgX3QoJ0d1ZXN0cyBjYW4gam9pbicpIH08L2Rpdj5cbiAgICAgICAgKSA6IDxkaXYgLz47XG5cbiAgICAgICAgY29uc3QgcGVybXMgPSAoZ3Vlc3RSZWFkIHx8IGd1ZXN0Sm9pbikgPyAoPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tRGlyZWN0b3J5X3Blcm1zXCI+XG4gICAgICAgICAgICB7IGd1ZXN0UmVhZCB9Jm5ic3A7XG4gICAgICAgICAgICB7IGd1ZXN0Sm9pbiB9XG4gICAgICAgIDwvZGl2PikgOiA8ZGl2IC8+O1xuXG4gICAgICAgIGxldCBhdmF0YXJVcmwgPSBudWxsO1xuICAgICAgICBpZiAocm9vbS5hdmF0YXJVcmwpIGF2YXRhclVybCA9IG1lZGlhRnJvbU14Yyhyb29tLmF2YXRhclVybCkuZ2V0U3F1YXJlVGh1bWJuYWlsSHR0cCgyNCk7XG5cbiAgICAgICAgcmV0dXJuIDx0ciBrZXk9e3Jvb20ucm9vbUlkfSBvbkNsaWNrPXt0aGlzLm9uQ2xpY2t9IG9uTW91c2VEb3duPXt0aGlzLnByb3BzLm9uTW91c2VEb3dufT5cbiAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9XCJteF9Sb29tRGlyZWN0b3J5X3Jvb21BdmF0YXJcIj5cbiAgICAgICAgICAgICAgICA8QmFzZUF2YXRhclxuICAgICAgICAgICAgICAgICAgICB3aWR0aD17MjR9XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodD17MjR9XG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZU1ldGhvZD0nY3JvcCdcbiAgICAgICAgICAgICAgICAgICAgbmFtZT17bmFtZX1cbiAgICAgICAgICAgICAgICAgICAgaWROYW1lPXtuYW1lfVxuICAgICAgICAgICAgICAgICAgICB1cmw9e2F2YXRhclVybH0gLz5cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICA8dGQgY2xhc3NOYW1lPVwibXhfUm9vbURpcmVjdG9yeV9yb29tRGVzY3JpcHRpb25cIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Jvb21EaXJlY3RvcnlfbmFtZVwiPnsgbmFtZSB9PC9kaXY+Jm5ic3A7XG4gICAgICAgICAgICAgICAgeyBwZXJtcyB9XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tRGlyZWN0b3J5X3RvcGljXCIgcmVmPXt0aGlzLl90b3BpY30gb25DbGljaz17dGhpcy5vblRvcGljQ2xpY2t9PlxuICAgICAgICAgICAgICAgICAgICB7IHJvb20udG9waWMgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbURpcmVjdG9yeV9hbGlhc1wiPnsgZ2V0RGlzcGxheUFsaWFzRm9yUm9vbShyb29tKSB9PC9kaXY+XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT1cIm14X1Jvb21EaXJlY3Rvcnlfcm9vbU1lbWJlckNvdW50XCI+XG4gICAgICAgICAgICAgICAgeyByb29tLm51bUpvaW5lZE1lbWJlcnMgfVxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgPC90cj47XG4gICAgfVxufVxuIl19