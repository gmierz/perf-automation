"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _languageHandler = require("../../../languageHandler");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _RoomUpgradeDialog = _interopRequireDefault(require("../dialogs/RoomUpgradeDialog"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _dec, _class, _class2, _temp;

let RoomUpgradeWarningBar = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.RoomUpgradeWarningBar"), _dec(_class = (_temp = _class2 = class RoomUpgradeWarningBar extends _react.default.PureComponent {
  constructor(props, context) {
    super(props, context);
    (0, _defineProperty2.default)(this, "context", void 0);
    (0, _defineProperty2.default)(this, "onStateEvents", (event, state) => {
      if (!this.props.room || event.getRoomId() !== this.props.room.roomId) {
        return;
      }

      if (event.getType() !== "m.room.tombstone") return;
      const tombstone = this.props.room.currentState.getStateEvents("m.room.tombstone", "");
      this.setState({
        upgraded: tombstone && tombstone.getContent().replacement_room
      });
    });
    (0, _defineProperty2.default)(this, "onUpgradeClick", () => {
      _Modal.default.createTrackedDialog('Upgrade Room Version', '', _RoomUpgradeDialog.default, {
        room: this.props.room
      });
    });

    const _tombstone = this.props.room.currentState.getStateEvents("m.room.tombstone", "");

    this.state = {
      upgraded: _tombstone === null || _tombstone === void 0 ? void 0 : _tombstone.getContent().replacement_room
    };
  }

  componentDidMount() {
    this.context.on("RoomState.events", this.onStateEvents);
  }

  componentWillUnmount() {
    this.context.removeListener("RoomState.events", this.onStateEvents);
  }

  render() {
    let doUpgradeWarnings = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomUpgradeWarningBar_body"
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Upgrading this room will shut down the current instance of the room and create " + "an upgraded room with the same name.")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("<b>Warning</b>: Upgrading a room will <i>not automatically migrate room members " + "to the new version of the room.</i> We'll post a link to the new room in the old " + "version of the room - room members will have to click this link to join the new room.", {}, {
      "b": sub => /*#__PURE__*/_react.default.createElement("b", null, sub),
      "i": sub => /*#__PURE__*/_react.default.createElement("i", null, sub)
    }))), /*#__PURE__*/_react.default.createElement("p", {
      className: "mx_RoomUpgradeWarningBar_upgradelink"
    }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onUpgradeClick
    }, (0, _languageHandler._t)("Upgrade this room to the recommended room version"))));

    if (this.state.upgraded) {
      doUpgradeWarnings = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RoomUpgradeWarningBar_body"
      }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This room has already been upgraded.")));
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomUpgradeWarningBar"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomUpgradeWarningBar_wrapped"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomUpgradeWarningBar_header"
    }, (0, _languageHandler._t)("This room is running room version <roomVersion />, which this homeserver has " + "marked as <i>unstable</i>.", {}, {
      "roomVersion": () => /*#__PURE__*/_react.default.createElement("code", null, this.props.room.getVersion()),
      "i": sub => /*#__PURE__*/_react.default.createElement("i", null, sub)
    })), doUpgradeWarnings, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomUpgradeWarningBar_small"
    }, (0, _languageHandler._t)("Only room administrators will see this warning"))));
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _MatrixClientContext.default), _temp)) || _class);
exports.default = RoomUpgradeWarningBar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL1Jvb21VcGdyYWRlV2FybmluZ0Jhci50c3giXSwibmFtZXMiOlsiUm9vbVVwZ3JhZGVXYXJuaW5nQmFyIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImNvbnRleHQiLCJldmVudCIsInN0YXRlIiwicm9vbSIsImdldFJvb21JZCIsInJvb21JZCIsImdldFR5cGUiLCJ0b21ic3RvbmUiLCJjdXJyZW50U3RhdGUiLCJnZXRTdGF0ZUV2ZW50cyIsInNldFN0YXRlIiwidXBncmFkZWQiLCJnZXRDb250ZW50IiwicmVwbGFjZW1lbnRfcm9vbSIsIk1vZGFsIiwiY3JlYXRlVHJhY2tlZERpYWxvZyIsIlJvb21VcGdyYWRlRGlhbG9nIiwiY29tcG9uZW50RGlkTW91bnQiLCJvbiIsIm9uU3RhdGVFdmVudHMiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZUxpc3RlbmVyIiwicmVuZGVyIiwiZG9VcGdyYWRlV2FybmluZ3MiLCJzdWIiLCJvblVwZ3JhZGVDbGljayIsImdldFZlcnNpb24iLCJNYXRyaXhDbGllbnRDb250ZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFLQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztJQVdxQkEscUIsV0FEcEIsZ0RBQXFCLG1DQUFyQixDLG1DQUFELE1BQ3FCQSxxQkFEckIsU0FDbURDLGVBQU1DLGFBRHpELENBQ3VGO0FBSW5GQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBUUMsT0FBUixFQUFpQjtBQUN4QixVQUFNRCxLQUFOLEVBQWFDLE9BQWI7QUFEd0I7QUFBQSx5REFpQkosQ0FBQ0MsS0FBRCxFQUFxQkMsS0FBckIsS0FBZ0Q7QUFDcEUsVUFBSSxDQUFDLEtBQUtILEtBQUwsQ0FBV0ksSUFBWixJQUFvQkYsS0FBSyxDQUFDRyxTQUFOLE9BQXNCLEtBQUtMLEtBQUwsQ0FBV0ksSUFBWCxDQUFnQkUsTUFBOUQsRUFBc0U7QUFDbEU7QUFDSDs7QUFFRCxVQUFJSixLQUFLLENBQUNLLE9BQU4sT0FBb0Isa0JBQXhCLEVBQTRDO0FBRTVDLFlBQU1DLFNBQVMsR0FBRyxLQUFLUixLQUFMLENBQVdJLElBQVgsQ0FBZ0JLLFlBQWhCLENBQTZCQyxjQUE3QixDQUE0QyxrQkFBNUMsRUFBZ0UsRUFBaEUsQ0FBbEI7QUFDQSxXQUFLQyxRQUFMLENBQWM7QUFBRUMsUUFBQUEsUUFBUSxFQUFFSixTQUFTLElBQUlBLFNBQVMsQ0FBQ0ssVUFBVixHQUF1QkM7QUFBaEQsT0FBZDtBQUNILEtBMUIyQjtBQUFBLDBEQTRCSCxNQUFZO0FBQ2pDQyxxQkFBTUMsbUJBQU4sQ0FBMEIsc0JBQTFCLEVBQWtELEVBQWxELEVBQXNEQywwQkFBdEQsRUFBeUU7QUFBRWIsUUFBQUEsSUFBSSxFQUFFLEtBQUtKLEtBQUwsQ0FBV0k7QUFBbkIsT0FBekU7QUFDSCxLQTlCMkI7O0FBR3hCLFVBQU1JLFVBQVMsR0FBRyxLQUFLUixLQUFMLENBQVdJLElBQVgsQ0FBZ0JLLFlBQWhCLENBQTZCQyxjQUE3QixDQUE0QyxrQkFBNUMsRUFBZ0UsRUFBaEUsQ0FBbEI7O0FBQ0EsU0FBS1AsS0FBTCxHQUFhO0FBQ1RTLE1BQUFBLFFBQVEsRUFBRUosVUFBRixhQUFFQSxVQUFGLHVCQUFFQSxVQUFTLENBQUVLLFVBQVgsR0FBd0JDO0FBRHpCLEtBQWI7QUFHSDs7QUFFTUksRUFBQUEsaUJBQWlCLEdBQVM7QUFDN0IsU0FBS2pCLE9BQUwsQ0FBYWtCLEVBQWIsQ0FBZ0Isa0JBQWhCLEVBQW9DLEtBQUtDLGFBQXpDO0FBQ0g7O0FBRU1DLEVBQUFBLG9CQUFvQixHQUFTO0FBQ2hDLFNBQUtwQixPQUFMLENBQWFxQixjQUFiLENBQTRCLGtCQUE1QixFQUFnRCxLQUFLRixhQUFyRDtBQUNIOztBQWlCTUcsRUFBQUEsTUFBTSxHQUFnQjtBQUN6QixRQUFJQyxpQkFBaUIsZ0JBQ2pCLHVEQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSSx3Q0FDTSx5QkFDRSxvRkFDQSxzQ0FGRixDQUROLENBREosZUFPSSx3Q0FDTSx5QkFDRSxxRkFDQSxtRkFEQSxHQUVBLHVGQUhGLEVBSUUsRUFKRixFQUlNO0FBQ0EsV0FBTUMsR0FBRCxpQkFBUyx3Q0FBS0EsR0FBTCxDQURkO0FBRUEsV0FBTUEsR0FBRCxpQkFBUyx3Q0FBS0EsR0FBTDtBQUZkLEtBSk4sQ0FETixDQVBKLENBREosZUFvQkk7QUFBRyxNQUFBLFNBQVMsRUFBQztBQUFiLG9CQUNJLDZCQUFDLHlCQUFEO0FBQWtCLE1BQUEsT0FBTyxFQUFFLEtBQUtDO0FBQWhDLE9BQ00seUJBQUcsbURBQUgsQ0FETixDQURKLENBcEJKLENBREo7O0FBNkJBLFFBQUksS0FBS3ZCLEtBQUwsQ0FBV1MsUUFBZixFQUF5QjtBQUNyQlksTUFBQUEsaUJBQWlCLGdCQUNiO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixzQkFDSSx3Q0FDTSx5QkFBRyxzQ0FBSCxDQUROLENBREosQ0FESjtBQU9IOztBQUVELHdCQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsb0JBQ0k7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQ00seUJBQ0Usa0ZBQ0EsNEJBRkYsRUFHRSxFQUhGLEVBSUU7QUFDSSxxQkFBZSxtQkFBTSwyQ0FBUSxLQUFLeEIsS0FBTCxDQUFXSSxJQUFYLENBQWdCdUIsVUFBaEIsRUFBUixDQUR6QjtBQUVJLFdBQU1GLEdBQUQsaUJBQVMsd0NBQUtBLEdBQUw7QUFGbEIsS0FKRixDQUROLENBREosRUFZTUQsaUJBWk4sZUFhSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FDTSx5QkFBRyxnREFBSCxDQUROLENBYkosQ0FESixDQURKO0FBcUJIOztBQWpHa0YsQyx3REFDOURJLDRCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE4LTIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgTWF0cml4RXZlbnQgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvZXZlbnQnO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tJztcbmltcG9ydCB7IFJvb21TdGF0ZSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tLXN0YXRlJztcblxuaW1wb3J0IE1vZGFsIGZyb20gJy4uLy4uLy4uL01vZGFsJztcblxuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCBSb29tVXBncmFkZURpYWxvZyBmcm9tICcuLi9kaWFsb2dzL1Jvb21VcGdyYWRlRGlhbG9nJztcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gJy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b24nO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgcm9vbTogUm9vbTtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgdXBncmFkZWQ/OiBib29sZWFuO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5yb29tcy5Sb29tVXBncmFkZVdhcm5pbmdCYXJcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJvb21VcGdyYWRlV2FybmluZ0JhciBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBzdGF0aWMgY29udGV4dFR5cGUgPSBNYXRyaXhDbGllbnRDb250ZXh0O1xuICAgIHB1YmxpYyBjb250ZXh0ITogUmVhY3QuQ29udGV4dFR5cGU8dHlwZW9mIE1hdHJpeENsaWVudENvbnRleHQ+O1xuXG4gICAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgICAgIGNvbnN0IHRvbWJzdG9uZSA9IHRoaXMucHJvcHMucm9vbS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoXCJtLnJvb20udG9tYnN0b25lXCIsIFwiXCIpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgdXBncmFkZWQ6IHRvbWJzdG9uZT8uZ2V0Q29udGVudCgpLnJlcGxhY2VtZW50X3Jvb20sXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmNvbnRleHQub24oXCJSb29tU3RhdGUuZXZlbnRzXCIsIHRoaXMub25TdGF0ZUV2ZW50cyk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmNvbnRleHQucmVtb3ZlTGlzdGVuZXIoXCJSb29tU3RhdGUuZXZlbnRzXCIsIHRoaXMub25TdGF0ZUV2ZW50cyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblN0YXRlRXZlbnRzID0gKGV2ZW50OiBNYXRyaXhFdmVudCwgc3RhdGU6IFJvb21TdGF0ZSk6IHZvaWQgPT4ge1xuICAgICAgICBpZiAoIXRoaXMucHJvcHMucm9vbSB8fCBldmVudC5nZXRSb29tSWQoKSAhPT0gdGhpcy5wcm9wcy5yb29tLnJvb21JZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKSAhPT0gXCJtLnJvb20udG9tYnN0b25lXCIpIHJldHVybjtcblxuICAgICAgICBjb25zdCB0b21ic3RvbmUgPSB0aGlzLnByb3BzLnJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKFwibS5yb29tLnRvbWJzdG9uZVwiLCBcIlwiKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHVwZ3JhZGVkOiB0b21ic3RvbmUgJiYgdG9tYnN0b25lLmdldENvbnRlbnQoKS5yZXBsYWNlbWVudF9yb29tIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uVXBncmFkZUNsaWNrID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdVcGdyYWRlIFJvb20gVmVyc2lvbicsICcnLCBSb29tVXBncmFkZURpYWxvZywgeyByb29tOiB0aGlzLnByb3BzLnJvb20gfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBsZXQgZG9VcGdyYWRlV2FybmluZ3MgPSAoXG4gICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbVVwZ3JhZGVXYXJuaW5nQmFyX2JvZHlcIj5cbiAgICAgICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVXBncmFkaW5nIHRoaXMgcm9vbSB3aWxsIHNodXQgZG93biB0aGUgY3VycmVudCBpbnN0YW5jZSBvZiB0aGUgcm9vbSBhbmQgY3JlYXRlIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFuIHVwZ3JhZGVkIHJvb20gd2l0aCB0aGUgc2FtZSBuYW1lLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiPGI+V2FybmluZzwvYj46IFVwZ3JhZGluZyBhIHJvb20gd2lsbCA8aT5ub3QgYXV0b21hdGljYWxseSBtaWdyYXRlIHJvb20gbWVtYmVycyBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0byB0aGUgbmV3IHZlcnNpb24gb2YgdGhlIHJvb20uPC9pPiBXZSdsbCBwb3N0IGEgbGluayB0byB0aGUgbmV3IHJvb20gaW4gdGhlIG9sZCBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2ZXJzaW9uIG9mIHRoZSByb29tIC0gcm9vbSBtZW1iZXJzIHdpbGwgaGF2ZSB0byBjbGljayB0aGlzIGxpbmsgdG8gam9pbiB0aGUgbmV3IHJvb20uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge30sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiXCI6IChzdWIpID0+IDxiPnsgc3ViIH08L2I+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlcIjogKHN1YikgPT4gPGk+eyBzdWIgfTwvaT4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwibXhfUm9vbVVwZ3JhZGVXYXJuaW5nQmFyX3VwZ3JhZGVsaW5rXCI+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIG9uQ2xpY2s9e3RoaXMub25VcGdyYWRlQ2xpY2t9PlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIlVwZ3JhZGUgdGhpcyByb29tIHRvIHRoZSByZWNvbW1lbmRlZCByb29tIHZlcnNpb25cIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUudXBncmFkZWQpIHtcbiAgICAgICAgICAgIGRvVXBncmFkZVdhcm5pbmdzID0gKFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbVVwZ3JhZGVXYXJuaW5nQmFyX2JvZHlcIj5cbiAgICAgICAgICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiVGhpcyByb29tIGhhcyBhbHJlYWR5IGJlZW4gdXBncmFkZWQuXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Jvb21VcGdyYWRlV2FybmluZ0JhclwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbVVwZ3JhZGVXYXJuaW5nQmFyX3dyYXBwZWRcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tVXBncmFkZVdhcm5pbmdCYXJfaGVhZGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVGhpcyByb29tIGlzIHJ1bm5pbmcgcm9vbSB2ZXJzaW9uIDxyb29tVmVyc2lvbiAvPiwgd2hpY2ggdGhpcyBob21lc2VydmVyIGhhcyBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtYXJrZWQgYXMgPGk+dW5zdGFibGU8L2k+LlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyb29tVmVyc2lvblwiOiAoKSA9PiA8Y29kZT57IHRoaXMucHJvcHMucm9vbS5nZXRWZXJzaW9uKCkgfTwvY29kZT4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaVwiOiAoc3ViKSA9PiA8aT57IHN1YiB9PC9pPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICB7IGRvVXBncmFkZVdhcm5pbmdzIH1cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tVXBncmFkZVdhcm5pbmdCYXJfc21hbGxcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJPbmx5IHJvb20gYWRtaW5pc3RyYXRvcnMgd2lsbCBzZWUgdGhpcyB3YXJuaW5nXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=