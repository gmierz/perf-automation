"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../languageHandler");

var _AppTile = _interopRequireDefault(require("../elements/AppTile"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _WidgetUtils = _interopRequireDefault(require("../../../utils/WidgetUtils"));

var _PersistedElement = _interopRequireDefault(require("../elements/PersistedElement"));

var _IntegrationManagers = require("../../../integrations/IntegrationManagers");

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _ContextMenu = _interopRequireWildcard(require("../../structures/ContextMenu"));

var _WidgetType = require("../../../widgets/WidgetType");

var _actions = require("../../../dispatcher/actions");

var _WidgetMessagingStore = require("../../../stores/widgets/WidgetMessagingStore");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _GenericElementContextMenu = _interopRequireDefault(require("../context_menus/GenericElementContextMenu"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

// This should be below the dialog level (4000), but above the rest of the UI (1000-2000).
// We sit in a context menu, so this should be given to the context menu.
const STICKERPICKER_Z_INDEX = 3500; // Key to store the widget's AppTile under in PersistedElement

const PERSISTED_ELEMENT_KEY = "stickerPicker";
let Stickerpicker = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.Stickerpicker"), _dec(_class = (_temp = _class2 = class Stickerpicker extends _react.default.PureComponent {
  // This is loaded by _acquireScalarClient on an as-needed basis.
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "prevSentVisibility", void 0);
    (0, _defineProperty2.default)(this, "popoverWidth", 300);
    (0, _defineProperty2.default)(this, "popoverHeight", 300);
    (0, _defineProperty2.default)(this, "scalarClient", null);
    (0, _defineProperty2.default)(this, "removeStickerpickerWidgets", async () => {
      const scalarClient = await this.acquireScalarClient();

      _logger.logger.log('Removing Stickerpicker widgets');

      if (this.state.widgetId) {
        if (scalarClient) {
          scalarClient.disableWidgetAssets(_WidgetType.WidgetType.STICKERPICKER, this.state.widgetId).then(() => {
            _logger.logger.log('Assets disabled');
          }).catch(err => {
            _logger.logger.error('Failed to disable assets');
          });
        } else {
          _logger.logger.error("Cannot disable assets: no scalar client");
        }
      } else {
        _logger.logger.warn('No widget ID specified, not disabling assets');
      }

      this.props.setShowStickers(false);

      _WidgetUtils.default.removeStickerpickerWidgets().then(() => {
        this.forceUpdate();
      }).catch(e => {
        _logger.logger.error('Failed to remove sticker picker widget', e);
      });
    });
    (0, _defineProperty2.default)(this, "updateWidget", () => {
      const stickerpickerWidget = _WidgetUtils.default.getStickerpickerWidgets()[0];

      if (!stickerpickerWidget) {
        Stickerpicker.currentWidget = null;
        this.setState({
          stickerpickerWidget: null,
          widgetId: null
        });
        return;
      }

      const currentWidget = Stickerpicker.currentWidget;
      let currentUrl = null;

      if (currentWidget && currentWidget.content && currentWidget.content.url) {
        currentUrl = currentWidget.content.url;
      }

      let newUrl = null;

      if (stickerpickerWidget && stickerpickerWidget.content && stickerpickerWidget.content.url) {
        newUrl = stickerpickerWidget.content.url;
      }

      if (newUrl !== currentUrl) {
        // Destroy the existing frame so a new one can be created
        _PersistedElement.default.destroyElement(PERSISTED_ELEMENT_KEY);
      }

      Stickerpicker.currentWidget = stickerpickerWidget;
      this.setState({
        stickerpickerWidget,
        widgetId: stickerpickerWidget ? stickerpickerWidget.id : null
      });
    });
    (0, _defineProperty2.default)(this, "onWidgetAction", payload => {
      switch (payload.action) {
        case "user_widget_updated":
          this.forceUpdate();
          break;

        case "stickerpicker_close":
          this.props.setShowStickers(false);
          break;

        case _actions.Action.AfterRightPanelPhaseChange:
        case "show_left_panel":
        case "hide_left_panel":
          this.props.setShowStickers(false);
          break;
      }
    });
    (0, _defineProperty2.default)(this, "onShowStickersClick", e => {
      if (!_SettingsStore.default.getValue("integrationProvisioning")) {
        // Intercept this case and spawn a warning.
        return _IntegrationManagers.IntegrationManagers.sharedInstance().showDisabledDialog();
      } // XXX: Simplify by using a context menu that is positioned relative to the sticker picker button


      const buttonRect = e.currentTarget.getBoundingClientRect(); // The window X and Y offsets are to adjust position when zoomed in to page

      let x = buttonRect.right + window.pageXOffset - 41; // Amount of horizontal space between the right of menu and the right of the viewport
      //  (10 = amount needed to make chevron centrally aligned)

      const rightPad = 10; // When the sticker picker would be displayed off of the viewport, adjust x
      //  (302 = width of context menu, including borders)

      x = Math.min(x, document.body.clientWidth - (302 + rightPad)); // Offset the chevron location, which is relative to the left of the context menu
      //  (10 = offset when context menu would not be displayed off viewport)
      //  (2 = context menu borders)

      const stickerpickerChevronOffset = Math.max(10, 2 + window.pageXOffset + buttonRect.left - x);
      const y = buttonRect.top + buttonRect.height / 2 + window.pageYOffset - 19;
      this.props.setShowStickers(true);
      this.setState({
        stickerpickerX: x,
        stickerpickerY: y,
        stickerpickerChevronOffset
      });
    });
    (0, _defineProperty2.default)(this, "onResize", () => {
      if (this.props.showStickers) {
        this.props.setShowStickers(false);
      }
    });
    (0, _defineProperty2.default)(this, "onFinished", () => {
      if (this.props.showStickers) {
        this.props.setShowStickers(false);
      }
    });
    (0, _defineProperty2.default)(this, "launchManageIntegrations", () => {
      // TODO: Open the right integration manager for the widget
      if (_SettingsStore.default.getValue("feature_many_integration_managers")) {
        _IntegrationManagers.IntegrationManagers.sharedInstance().openAll(this.props.room, `type_${_WidgetType.WidgetType.STICKERPICKER.preferred}`, this.state.widgetId);
      } else {
        _IntegrationManagers.IntegrationManagers.sharedInstance().getPrimaryManager().open(this.props.room, `type_${_WidgetType.WidgetType.STICKERPICKER.preferred}`, this.state.widgetId);
      }
    });
    this.state = {
      imError: null,
      stickerpickerX: null,
      stickerpickerY: null,
      stickerpickerWidget: null,
      widgetId: null
    };
  }

  acquireScalarClient() {
    if (this.scalarClient) return Promise.resolve(this.scalarClient); // TODO: Pick the right manager for the widget

    if (_IntegrationManagers.IntegrationManagers.sharedInstance().hasManager()) {
      this.scalarClient = _IntegrationManagers.IntegrationManagers.sharedInstance().getPrimaryManager().getScalarClient();
      return this.scalarClient.connect().then(() => {
        this.forceUpdate();
        return this.scalarClient;
      }).catch(e => {
        this.imError((0, _languageHandler._td)("Failed to connect to integration manager"), e);
      });
    } else {
      _IntegrationManagers.IntegrationManagers.sharedInstance().openNoManagerDialog();
    }
  }

  componentDidMount() {
    // Close the sticker picker when the window resizes
    window.addEventListener('resize', this.onResize);
    this.dispatcherRef = _dispatcher.default.register(this.onWidgetAction); // Track updates to widget state in account data

    _MatrixClientPeg.MatrixClientPeg.get().on('accountData', this.updateWidget); // Initialise widget state from current account data


    this.updateWidget();
  }

  componentWillUnmount() {
    const client = _MatrixClientPeg.MatrixClientPeg.get();

    if (client) client.removeListener('accountData', this.updateWidget);
    window.removeEventListener('resize', this.onResize);

    if (this.dispatcherRef) {
      _dispatcher.default.unregister(this.dispatcherRef);
    }
  }

  componentDidUpdate(prevProps, prevState) {
    this.sendVisibilityToWidget(this.props.showStickers);
  }

  imError(errorMsg, e) {
    _logger.logger.error(errorMsg, e);

    this.setState({
      imError: (0, _languageHandler._t)(errorMsg)
    });
    this.props.setShowStickers(false);
  }

  defaultStickerpickerContent() {
    return /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.launchManageIntegrations,
      className: "mx_Stickers_contentPlaceholder"
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You don't currently have any stickerpacks enabled")), /*#__PURE__*/_react.default.createElement("p", {
      className: "mx_Stickers_addLink"
    }, (0, _languageHandler._t)("Add some now")), /*#__PURE__*/_react.default.createElement("img", {
      src: require("../../../../res/img/stickerpack-placeholder.png"),
      alt: ""
    }));
  }

  errorStickerpickerContent() {
    return /*#__PURE__*/_react.default.createElement("div", {
      style: {
        textAlign: "center"
      },
      className: "error"
    }, /*#__PURE__*/_react.default.createElement("p", null, " ", this.state.imError, " "));
  }

  sendVisibilityToWidget(visible) {
    if (!this.state.stickerpickerWidget) return;

    const messaging = _WidgetMessagingStore.WidgetMessagingStore.instance.getMessagingForId(this.state.stickerpickerWidget.id);

    if (messaging && visible !== this.prevSentVisibility) {
      messaging.updateVisibility(visible).catch(err => {
        _logger.logger.error("Error updating widget visibility: ", err);
      });
      this.prevSentVisibility = visible;
    }
  }

  getStickerpickerContent() {
    // Handle integration manager errors
    if (this.state.imError) {
      return this.errorStickerpickerContent();
    } // Stickers
    // TODO - Add support for Stickerpickers from multiple app stores.
    // Render content from multiple stickerpack sources, each within their
    // own iframe, within the stickerpicker UI element.


    const stickerpickerWidget = this.state.stickerpickerWidget;
    let stickersContent; // Use a separate ReactDOM tree to render the AppTile separately so that it persists and does
    // not unmount when we (a) close the sticker picker (b) switch rooms. It's properties are still
    // updated.
    // Load stickerpack content

    if (stickerpickerWidget && stickerpickerWidget.content && stickerpickerWidget.content.url) {
      // Set default name
      stickerpickerWidget.content.name = stickerpickerWidget.content.name || (0, _languageHandler._t)("Stickerpack"); // FIXME: could this use the same code as other apps?

      const stickerApp = {
        id: stickerpickerWidget.id,
        url: stickerpickerWidget.content.url,
        name: stickerpickerWidget.content.name,
        type: stickerpickerWidget.content.type,
        data: stickerpickerWidget.content.data,
        roomId: stickerpickerWidget.content.roomId,
        eventId: stickerpickerWidget.content.eventId,
        avatar_url: stickerpickerWidget.content.avatar_url,
        creatorUserId: stickerpickerWidget.content.creatorUserId
      };
      stickersContent = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_Stickers_content_container"
      }, /*#__PURE__*/_react.default.createElement("div", {
        id: "stickersContent",
        className: "mx_Stickers_content",
        style: {
          border: 'none',
          height: this.popoverHeight,
          width: this.popoverWidth
        }
      }, /*#__PURE__*/_react.default.createElement(_PersistedElement.default, {
        persistKey: PERSISTED_ELEMENT_KEY,
        zIndex: STICKERPICKER_Z_INDEX
      }, /*#__PURE__*/_react.default.createElement(_AppTile.default, {
        app: stickerApp,
        room: this.props.room,
        fullWidth: true,
        userId: _MatrixClientPeg.MatrixClientPeg.get().credentials.userId,
        creatorUserId: stickerpickerWidget.sender || _MatrixClientPeg.MatrixClientPeg.get().credentials.userId,
        waitForIframeLoad: true,
        showMenubar: true,
        onEditClick: this.launchManageIntegrations,
        onDeleteClick: this.removeStickerpickerWidgets,
        showTitle: false,
        showPopout: false,
        handleMinimisePointerEvents: true,
        userWidget: true
      }))));
    } else {
      // Default content to show if stickerpicker widget not added
      stickersContent = this.defaultStickerpickerContent();
    }

    return stickersContent;
  } // Dev note: this isn't jsdoc because it's angry.

  /*
   * Show the sticker picker overlay
   * If no stickerpacks have been added, show a link to the integration manager add sticker packs page.
   */


  render() {
    if (!this.props.showStickers) return null;
    return /*#__PURE__*/_react.default.createElement(_ContextMenu.default, (0, _extends2.default)({
      chevronOffset: this.state.stickerpickerChevronOffset,
      chevronFace: _ContextMenu.ChevronFace.Bottom,
      left: this.state.stickerpickerX,
      top: this.state.stickerpickerY,
      menuWidth: this.popoverWidth,
      menuHeight: this.popoverHeight,
      onFinished: this.onFinished,
      menuPaddingTop: 0,
      menuPaddingLeft: 0,
      menuPaddingRight: 0,
      zIndex: STICKERPICKER_Z_INDEX
    }, this.props.menuPosition), /*#__PURE__*/_react.default.createElement(_GenericElementContextMenu.default, {
      element: this.getStickerpickerContent(),
      onResize: this.onFinished
    }));
  }

}, (0, _defineProperty2.default)(_class2, "currentWidget", void 0), _temp)) || _class);
exports.default = Stickerpicker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL1N0aWNrZXJwaWNrZXIudHN4Il0sIm5hbWVzIjpbIlNUSUNLRVJQSUNLRVJfWl9JTkRFWCIsIlBFUlNJU1RFRF9FTEVNRU5UX0tFWSIsIlN0aWNrZXJwaWNrZXIiLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwic2NhbGFyQ2xpZW50IiwiYWNxdWlyZVNjYWxhckNsaWVudCIsImxvZ2dlciIsImxvZyIsInN0YXRlIiwid2lkZ2V0SWQiLCJkaXNhYmxlV2lkZ2V0QXNzZXRzIiwiV2lkZ2V0VHlwZSIsIlNUSUNLRVJQSUNLRVIiLCJ0aGVuIiwiY2F0Y2giLCJlcnIiLCJlcnJvciIsIndhcm4iLCJzZXRTaG93U3RpY2tlcnMiLCJXaWRnZXRVdGlscyIsInJlbW92ZVN0aWNrZXJwaWNrZXJXaWRnZXRzIiwiZm9yY2VVcGRhdGUiLCJlIiwic3RpY2tlcnBpY2tlcldpZGdldCIsImdldFN0aWNrZXJwaWNrZXJXaWRnZXRzIiwiY3VycmVudFdpZGdldCIsInNldFN0YXRlIiwiY3VycmVudFVybCIsImNvbnRlbnQiLCJ1cmwiLCJuZXdVcmwiLCJQZXJzaXN0ZWRFbGVtZW50IiwiZGVzdHJveUVsZW1lbnQiLCJpZCIsInBheWxvYWQiLCJhY3Rpb24iLCJBY3Rpb24iLCJBZnRlclJpZ2h0UGFuZWxQaGFzZUNoYW5nZSIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsIkludGVncmF0aW9uTWFuYWdlcnMiLCJzaGFyZWRJbnN0YW5jZSIsInNob3dEaXNhYmxlZERpYWxvZyIsImJ1dHRvblJlY3QiLCJjdXJyZW50VGFyZ2V0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwieCIsInJpZ2h0Iiwid2luZG93IiwicGFnZVhPZmZzZXQiLCJyaWdodFBhZCIsIk1hdGgiLCJtaW4iLCJkb2N1bWVudCIsImJvZHkiLCJjbGllbnRXaWR0aCIsInN0aWNrZXJwaWNrZXJDaGV2cm9uT2Zmc2V0IiwibWF4IiwibGVmdCIsInkiLCJ0b3AiLCJoZWlnaHQiLCJwYWdlWU9mZnNldCIsInN0aWNrZXJwaWNrZXJYIiwic3RpY2tlcnBpY2tlclkiLCJzaG93U3RpY2tlcnMiLCJvcGVuQWxsIiwicm9vbSIsInByZWZlcnJlZCIsImdldFByaW1hcnlNYW5hZ2VyIiwib3BlbiIsImltRXJyb3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsImhhc01hbmFnZXIiLCJnZXRTY2FsYXJDbGllbnQiLCJjb25uZWN0Iiwib3Blbk5vTWFuYWdlckRpYWxvZyIsImNvbXBvbmVudERpZE1vdW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uUmVzaXplIiwiZGlzcGF0Y2hlclJlZiIsImRpcyIsInJlZ2lzdGVyIiwib25XaWRnZXRBY3Rpb24iLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJvbiIsInVwZGF0ZVdpZGdldCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiY2xpZW50IiwicmVtb3ZlTGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwidW5yZWdpc3RlciIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInByZXZTdGF0ZSIsInNlbmRWaXNpYmlsaXR5VG9XaWRnZXQiLCJlcnJvck1zZyIsImRlZmF1bHRTdGlja2VycGlja2VyQ29udGVudCIsImxhdW5jaE1hbmFnZUludGVncmF0aW9ucyIsInJlcXVpcmUiLCJlcnJvclN0aWNrZXJwaWNrZXJDb250ZW50IiwidGV4dEFsaWduIiwidmlzaWJsZSIsIm1lc3NhZ2luZyIsIldpZGdldE1lc3NhZ2luZ1N0b3JlIiwiaW5zdGFuY2UiLCJnZXRNZXNzYWdpbmdGb3JJZCIsInByZXZTZW50VmlzaWJpbGl0eSIsInVwZGF0ZVZpc2liaWxpdHkiLCJnZXRTdGlja2VycGlja2VyQ29udGVudCIsInN0aWNrZXJzQ29udGVudCIsIm5hbWUiLCJzdGlja2VyQXBwIiwidHlwZSIsImRhdGEiLCJyb29tSWQiLCJldmVudElkIiwiYXZhdGFyX3VybCIsImNyZWF0b3JVc2VySWQiLCJib3JkZXIiLCJwb3BvdmVySGVpZ2h0Iiwid2lkdGgiLCJwb3BvdmVyV2lkdGgiLCJjcmVkZW50aWFscyIsInVzZXJJZCIsInNlbmRlciIsInJlbmRlciIsIkNoZXZyb25GYWNlIiwiQm90dG9tIiwib25GaW5pc2hlZCIsIm1lbnVQb3NpdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQWdCQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFHQTs7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0EsTUFBTUEscUJBQXFCLEdBQUcsSUFBOUIsQyxDQUVBOztBQUNBLE1BQU1DLHFCQUFxQixHQUFHLGVBQTlCO0lBbUJxQkMsYSxXQURwQixnREFBcUIsMkJBQXJCLEMsbUNBQUQsTUFDcUJBLGFBRHJCLFNBQzJDQyxlQUFNQyxhQURqRCxDQUMrRTtBQVMzRTtBQUdBQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBZ0I7QUFDdkIsVUFBTUEsS0FBTjtBQUR1QjtBQUFBO0FBQUEsd0RBTEosR0FLSTtBQUFBLHlEQUpILEdBSUc7QUFBQSx3REFGYyxJQUVkO0FBQUEsc0VBMkJVLFlBQTJCO0FBQzVELFlBQU1DLFlBQVksR0FBRyxNQUFNLEtBQUtDLG1CQUFMLEVBQTNCOztBQUNBQyxxQkFBT0MsR0FBUCxDQUFXLGdDQUFYOztBQUNBLFVBQUksS0FBS0MsS0FBTCxDQUFXQyxRQUFmLEVBQXlCO0FBQ3JCLFlBQUlMLFlBQUosRUFBa0I7QUFDZEEsVUFBQUEsWUFBWSxDQUFDTSxtQkFBYixDQUFpQ0MsdUJBQVdDLGFBQTVDLEVBQTJELEtBQUtKLEtBQUwsQ0FBV0MsUUFBdEUsRUFBZ0ZJLElBQWhGLENBQXFGLE1BQU07QUFDdkZQLDJCQUFPQyxHQUFQLENBQVcsaUJBQVg7QUFDSCxXQUZELEVBRUdPLEtBRkgsQ0FFVUMsR0FBRCxJQUFTO0FBQ2RULDJCQUFPVSxLQUFQLENB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LDJCQUFMLEVBQWxCO0FBQ0g7O0FBQ0QsV0FBT2EsZUFBUDtBQUNILEdBdlAwRSxDQXlQM0U7O0FBQ0E7QUFDSjtBQUNBO0FBQ0E7OztBQTJFV2dCLEVBQUFBLE1BQU0sR0FBZ0I7QUFDekIsUUFBSSxDQUFDLEtBQUs3SCxLQUFMLENBQVc4RCxZQUFoQixFQUE4QixPQUFPLElBQVA7QUFFOUIsd0JBQU8sNkJBQUMsb0JBQUQ7QUFDSCxNQUFBLGFBQWEsRUFBRSxLQUFLekQsS0FBTCxDQUFXZ0QsMEJBRHZCO0FBRUgsTUFBQSxXQUFXLEVBQUV5RSx5QkFBWUMsTUFGdEI7QUFHSCxNQUFBLElBQUksRUFBRSxLQUFLMUgsS0FBTCxDQUFXdUQsY0FIZDtBQUlILE1BQUEsR0FBRyxFQUFFLEtBQUt2RCxLQUFMLENBQVd3RCxjQUpiO0FBS0gsTUFBQSxTQUFTLEVBQUUsS0FBSzRELFlBTGI7QUFNSCxNQUFBLFVBQVUsRUFBRSxLQUFLRixhQU5kO0FBT0gsTUFBQSxVQUFVLEVBQUUsS0FBS1MsVUFQZDtBQVFILE1BQUEsY0FBYyxFQUFFLENBUmI7QUFTSCxNQUFBLGVBQWUsRUFBRSxDQVRkO0FBVUgsTUFBQSxnQkFBZ0IsRUFBRSxDQVZmO0FBV0gsTUFBQSxNQUFNLEVBQUV0STtBQVhMLE9BWUMsS0FBS00sS0FBTCxDQUFXaUksWUFaWixnQkFjSCw2QkFBQyxrQ0FBRDtBQUEyQixNQUFBLE9BQU8sRUFBRSxLQUFLckIsdUJBQUwsRUFBcEM7QUFBb0UsTUFBQSxRQUFRLEVBQUUsS0FBS29CO0FBQW5GLE1BZEcsQ0FBUDtBQWdCSDs7QUEzVjBFLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTggTmV3IFZlY3RvciBMdGRcblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tJztcbmltcG9ydCB7IF90LCBfdGQgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IEFwcFRpbGUgZnJvbSAnLi4vZWxlbWVudHMvQXBwVGlsZSc7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tICcuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWcnO1xuaW1wb3J0IGRpcyBmcm9tICcuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXInO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSAnLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvbic7XG5pbXBvcnQgV2lkZ2V0VXRpbHMsIHsgSVdpZGdldEV2ZW50IH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvV2lkZ2V0VXRpbHMnO1xuaW1wb3J0IFBlcnNpc3RlZEVsZW1lbnQgZnJvbSBcIi4uL2VsZW1lbnRzL1BlcnNpc3RlZEVsZW1lbnRcIjtcbmltcG9ydCB7IEludGVncmF0aW9uTWFuYWdlcnMgfSBmcm9tIFwiLi4vLi4vLi4vaW50ZWdyYXRpb25zL0ludGVncmF0aW9uTWFuYWdlcnNcIjtcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgQ29udGV4dE1lbnUsIHsgQ2hldnJvbkZhY2UgfSBmcm9tIFwiLi4vLi4vc3RydWN0dXJlcy9Db250ZXh0TWVudVwiO1xuaW1wb3J0IHsgV2lkZ2V0VHlwZSB9IGZyb20gXCIuLi8uLi8uLi93aWRnZXRzL1dpZGdldFR5cGVcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCB7IFdpZGdldE1lc3NhZ2luZ1N0b3JlIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy93aWRnZXRzL1dpZGdldE1lc3NhZ2luZ1N0b3JlXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IHsgQWN0aW9uUGF5bG9hZCB9IGZyb20gJy4uLy4uLy4uL2Rpc3BhdGNoZXIvcGF5bG9hZHMnO1xuaW1wb3J0IFNjYWxhckF1dGhDbGllbnQgZnJvbSAnLi4vLi4vLi4vU2NhbGFyQXV0aENsaWVudCc7XG5pbXBvcnQgR2VuZXJpY0VsZW1lbnRDb250ZXh0TWVudSBmcm9tIFwiLi4vY29udGV4dF9tZW51cy9HZW5lcmljRWxlbWVudENvbnRleHRNZW51XCI7XG5pbXBvcnQgeyBJQXBwIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9XaWRnZXRTdG9yZVwiO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbi8vIFRoaXMgc2hvdWxkIGJlIGJlbG93IHRoZSBkaWFsb2cgbGV2ZWwgKDQwMDApLCBidXQgYWJvdmUgdGhlIHJlc3Qgb2YgdGhlIFVJICgxMDAwLTIwMDApLlxuLy8gV2Ugc2l0IGluIGEgY29udGV4dCBtZW51LCBzbyB0aGlzIHNob3VsZCBiZSBnaXZlbiB0byB0aGUgY29udGV4dCBtZW51LlxuY29uc3QgU1RJQ0tFUlBJQ0tFUl9aX0lOREVYID0gMzUwMDtcblxuLy8gS2V5IHRvIHN0b3JlIHRoZSB3aWRnZXQncyBBcHBUaWxlIHVuZGVyIGluIFBlcnNpc3RlZEVsZW1lbnRcbmNvbnN0IFBFUlNJU1RFRF9FTEVNRU5UX0tFWSA9IFwic3RpY2tlclBpY2tlclwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICByb29tOiBSb29tO1xuICAgIHNob3dTdGlja2VyczogYm9vbGVhbjtcbiAgICBtZW51UG9zaXRpb24/OiBhbnk7XG4gICAgc2V0U2hvd1N0aWNrZXJzOiAoc2hvd1N0aWNrZXJzOiBib29sZWFuKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBpbUVycm9yOiBzdHJpbmc7XG4gICAgc3RpY2tlcnBpY2tlclg6IG51bWJlcjtcbiAgICBzdGlja2VycGlja2VyWTogbnVtYmVyO1xuICAgIHN0aWNrZXJwaWNrZXJDaGV2cm9uT2Zmc2V0PzogbnVtYmVyO1xuICAgIHN0aWNrZXJwaWNrZXJXaWRnZXQ6IElXaWRnZXRFdmVudDtcbiAgICB3aWRnZXRJZDogc3RyaW5nO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5yb29tcy5TdGlja2VycGlja2VyXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdGlja2VycGlja2VyIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHN0YXRpYyBjdXJyZW50V2lkZ2V0O1xuXG4gICAgcHJpdmF0ZSBkaXNwYXRjaGVyUmVmOiBzdHJpbmc7XG5cbiAgICBwcml2YXRlIHByZXZTZW50VmlzaWJpbGl0eTogYm9vbGVhbjtcblxuICAgIHByaXZhdGUgcG9wb3ZlcldpZHRoID0gMzAwO1xuICAgIHByaXZhdGUgcG9wb3ZlckhlaWdodCA9IDMwMDtcbiAgICAvLyBUaGlzIGlzIGxvYWRlZCBieSBfYWNxdWlyZVNjYWxhckNsaWVudCBvbiBhbiBhcy1uZWVkZWQgYmFzaXMuXG4gICAgcHJpdmF0ZSBzY2FsYXJDbGllbnQ6IFNjYWxhckF1dGhDbGllbnQgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBpbUVycm9yOiBudWxsLFxuICAgICAgICAgICAgc3RpY2tlcnBpY2tlclg6IG51bGwsXG4gICAgICAgICAgICBzdGlja2VycGlja2VyWTogbnVsbCxcbiAgICAgICAgICAgIHN0aWNrZXJwaWNrZXJXaWRnZXQ6IG51bGwsXG4gICAgICAgICAgICB3aWRnZXRJZDogbnVsbCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFjcXVpcmVTY2FsYXJDbGllbnQoKTogUHJvbWlzZTx2b2lkIHwgU2NhbGFyQXV0aENsaWVudD4ge1xuICAgICAgICBpZiAodGhpcy5zY2FsYXJDbGllbnQpIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5zY2FsYXJDbGllbnQpO1xuICAgICAgICAvLyBUT0RPOiBQaWNrIHRoZSByaWdodCBtYW5hZ2VyIGZvciB0aGUgd2lkZ2V0XG4gICAgICAgIGlmIChJbnRlZ3JhdGlvbk1hbmFnZXJzLnNoYXJlZEluc3RhbmNlKCkuaGFzTWFuYWdlcigpKSB7XG4gICAgICAgICAgICB0aGlzLnNjYWxhckNsaWVudCA9IEludGVncmF0aW9uTWFuYWdlcnMuc2hhcmVkSW5zdGFuY2UoKS5nZXRQcmltYXJ5TWFuYWdlcigpLmdldFNjYWxhckNsaWVudCgpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NhbGFyQ2xpZW50LmNvbm5lY3QoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NhbGFyQ2xpZW50O1xuICAgICAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmltRXJyb3IoX3RkKFwiRmFpbGVkIHRvIGNvbm5lY3QgdG8gaW50ZWdyYXRpb24gbWFuYWdlclwiKSwgZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIEludGVncmF0aW9uTWFuYWdlcnMuc2hhcmVkSW5zdGFuY2UoKS5vcGVuTm9NYW5hZ2VyRGlhbG9nKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbW92ZVN0aWNrZXJwaWNrZXJXaWRnZXRzID0gYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICBjb25zdCBzY2FsYXJDbGllbnQgPSBhd2FpdCB0aGlzLmFjcXVpcmVTY2FsYXJDbGllbnQoKTtcbiAgICAgICAgbG9nZ2VyLmxvZygnUmVtb3ZpbmcgU3RpY2tlcnBpY2tlciB3aWRnZXRzJyk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLndpZGdldElkKSB7XG4gICAgICAgICAgICBpZiAoc2NhbGFyQ2xpZW50KSB7XG4gICAgICAgICAgICAgICAgc2NhbGFyQ2xpZW50LmRpc2FibGVXaWRnZXRBc3NldHMoV2lkZ2V0VHlwZS5TVElDS0VSUElDS0VSLCB0aGlzLnN0YXRlLndpZGdldElkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnQXNzZXRzIGRpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBkaXNhYmxlIGFzc2V0cycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJDYW5ub3QgZGlzYWJsZSBhc3NldHM6IG5vIHNjYWxhciBjbGllbnRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2dnZXIud2FybignTm8gd2lkZ2V0IElEIHNwZWNpZmllZCwgbm90IGRpc2FibGluZyBhc3NldHMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucHJvcHMuc2V0U2hvd1N0aWNrZXJzKGZhbHNlKTtcbiAgICAgICAgV2lkZ2V0VXRpbHMucmVtb3ZlU3RpY2tlcnBpY2tlcldpZGdldHMoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcbiAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJlbW92ZSBzdGlja2VyIHBpY2tlciB3aWRnZXQnLCBlKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcbiAgICAgICAgLy8gQ2xvc2UgdGhlIHN0aWNrZXIgcGlja2VyIHdoZW4gdGhlIHdpbmRvdyByZXNpemVzXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplKTtcblxuICAgICAgICB0aGlzLmRpc3BhdGNoZXJSZWYgPSBkaXMucmVnaXN0ZXIodGhpcy5vbldpZGdldEFjdGlvbik7XG5cbiAgICAgICAgLy8gVHJhY2sgdXBkYXRlcyB0byB3aWRnZXQgc3RhdGUgaW4gYWNjb3VudCBkYXRhXG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5vbignYWNjb3VudERhdGEnLCB0aGlzLnVwZGF0ZVdpZGdldCk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGlzZSB3aWRnZXQgc3RhdGUgZnJvbSBjdXJyZW50IGFjY291bnQgZGF0YVxuICAgICAgICB0aGlzLnVwZGF0ZVdpZGdldCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnRXaWxsVW5tb3VudCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY2xpZW50ID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBpZiAoY2xpZW50KSBjbGllbnQucmVtb3ZlTGlzdGVuZXIoJ2FjY291bnREYXRhJywgdGhpcy51cGRhdGVXaWRnZXQpO1xuXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplKTtcbiAgICAgICAgaWYgKHRoaXMuZGlzcGF0Y2hlclJlZikge1xuICAgICAgICAgICAgZGlzLnVucmVnaXN0ZXIodGhpcy5kaXNwYXRjaGVyUmVmKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBJUHJvcHMsIHByZXZTdGF0ZTogSVN0YXRlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2VuZFZpc2liaWxpdHlUb1dpZGdldCh0aGlzLnByb3BzLnNob3dTdGlja2Vycyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbUVycm9yKGVycm9yTXNnOiBzdHJpbmcsIGU6IEVycm9yKTogdm9pZCB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihlcnJvck1zZywgZSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgaW1FcnJvcjogX3QoZXJyb3JNc2cpLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wcm9wcy5zZXRTaG93U3RpY2tlcnMoZmFsc2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlV2lkZ2V0ID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICBjb25zdCBzdGlja2VycGlja2VyV2lkZ2V0ID0gV2lkZ2V0VXRpbHMuZ2V0U3RpY2tlcnBpY2tlcldpZGdldHMoKVswXTtcbiAgICAgICAgaWYgKCFzdGlja2VycGlja2VyV2lkZ2V0KSB7XG4gICAgICAgICAgICBTdGlja2VycGlja2VyLmN1cnJlbnRXaWRnZXQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHN0aWNrZXJwaWNrZXJXaWRnZXQ6IG51bGwsIHdpZGdldElkOiBudWxsIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFdpZGdldCA9IFN0aWNrZXJwaWNrZXIuY3VycmVudFdpZGdldDtcbiAgICAgICAgbGV0IGN1cnJlbnRVcmwgPSBudWxsO1xuICAgICAgICBpZiAoY3VycmVudFdpZGdldCAmJiBjdXJyZW50V2lkZ2V0LmNvbnRlbnQgJiYgY3VycmVudFdpZGdldC5jb250ZW50LnVybCkge1xuICAgICAgICAgICAgY3VycmVudFVybCA9IGN1cnJlbnRXaWRnZXQuY29udGVudC51cmw7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbmV3VXJsID0gbnVsbDtcbiAgICAgICAgaWYgKHN0aWNrZXJwaWNrZXJXaWRnZXQgJiYgc3RpY2tlcnBpY2tlcldpZGdldC5jb250ZW50ICYmIHN0aWNrZXJwaWNrZXJXaWRnZXQuY29udGVudC51cmwpIHtcbiAgICAgICAgICAgIG5ld1VybCA9IHN0aWNrZXJwaWNrZXJXaWRnZXQuY29udGVudC51cmw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV3VXJsICE9PSBjdXJyZW50VXJsKSB7XG4gICAgICAgICAgICAvLyBEZXN0cm95IHRoZSBleGlzdGluZyBmcmFtZSBzbyBhIG5ldyBvbmUgY2FuIGJlIGNyZWF0ZWRcbiAgICAgICAgICAgIFBlcnNpc3RlZEVsZW1lbnQuZGVzdHJveUVsZW1lbnQoUEVSU0lTVEVEX0VMRU1FTlRfS0VZKTtcbiAgICAgICAgfVxuXG4gICAgICAgIFN0aWNrZXJwaWNrZXIuY3VycmVudFdpZGdldCA9IHN0aWNrZXJwaWNrZXJXaWRnZXQ7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc3RpY2tlcnBpY2tlcldpZGdldCxcbiAgICAgICAgICAgIHdpZGdldElkOiBzdGlja2VycGlja2VyV2lkZ2V0ID8gc3RpY2tlcnBpY2tlcldpZGdldC5pZCA6IG51bGwsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uV2lkZ2V0QWN0aW9uID0gKHBheWxvYWQ6IEFjdGlvblBheWxvYWQpOiB2b2lkID0+IHtcbiAgICAgICAgc3dpdGNoIChwYXlsb2FkLmFjdGlvbikge1xuICAgICAgICAgICAgY2FzZSBcInVzZXJfd2lkZ2V0X3VwZGF0ZWRcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3RpY2tlcnBpY2tlcl9jbG9zZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuc2V0U2hvd1N0aWNrZXJzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQWN0aW9uLkFmdGVyUmlnaHRQYW5lbFBoYXNlQ2hhbmdlOlxuICAgICAgICAgICAgY2FzZSBcInNob3dfbGVmdF9wYW5lbFwiOlxuICAgICAgICAgICAgY2FzZSBcImhpZGVfbGVmdF9wYW5lbFwiOlxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuc2V0U2hvd1N0aWNrZXJzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGRlZmF1bHRTdGlja2VycGlja2VyQ29udGVudCgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBvbkNsaWNrPXt0aGlzLmxhdW5jaE1hbmFnZUludGVncmF0aW9uc31cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9J214X1N0aWNrZXJzX2NvbnRlbnRQbGFjZWhvbGRlcic+XG4gICAgICAgICAgICAgICAgPHA+eyBfdChcIllvdSBkb24ndCBjdXJyZW50bHkgaGF2ZSBhbnkgc3RpY2tlcnBhY2tzIGVuYWJsZWRcIikgfTwvcD5cbiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J214X1N0aWNrZXJzX2FkZExpbmsnPnsgX3QoXCJBZGQgc29tZSBub3dcIikgfTwvcD5cbiAgICAgICAgICAgICAgICA8aW1nIHNyYz17cmVxdWlyZShcIi4uLy4uLy4uLy4uL3Jlcy9pbWcvc3RpY2tlcnBhY2stcGxhY2Vob2xkZXIucG5nXCIpfSBhbHQ9XCJcIiAvPlxuICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZXJyb3JTdGlja2VycGlja2VyQ29udGVudCgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IHN0eWxlPXt7IHRleHRBbGlnbjogXCJjZW50ZXJcIiB9fSBjbGFzc05hbWU9XCJlcnJvclwiPlxuICAgICAgICAgICAgICAgIDxwPiB7IHRoaXMuc3RhdGUuaW1FcnJvciB9IDwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2VuZFZpc2liaWxpdHlUb1dpZGdldCh2aXNpYmxlOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5zdGlja2VycGlja2VyV2lkZ2V0KSByZXR1cm47XG4gICAgICAgIGNvbnN0IG1lc3NhZ2luZyA9IFdpZGdldE1lc3NhZ2luZ1N0b3JlLmluc3RhbmNlLmdldE1lc3NhZ2luZ0ZvcklkKHRoaXMuc3RhdGUuc3RpY2tlcnBpY2tlcldpZGdldC5pZCk7XG4gICAgICAgIGlmIChtZXNzYWdpbmcgJiYgdmlzaWJsZSAhPT0gdGhpcy5wcmV2U2VudFZpc2liaWxpdHkpIHtcbiAgICAgICAgICAgIG1lc3NhZ2luZy51cGRhdGVWaXNpYmlsaXR5KHZpc2libGUpLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgd2lkZ2V0IHZpc2liaWxpdHk6IFwiLCBlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnByZXZTZW50VmlzaWJpbGl0eSA9IHZpc2libGU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U3RpY2tlcnBpY2tlckNvbnRlbnQoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICAvLyBIYW5kbGUgaW50ZWdyYXRpb24gbWFuYWdlciBlcnJvcnNcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaW1FcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JTdGlja2VycGlja2VyQ29udGVudCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3RpY2tlcnNcbiAgICAgICAgLy8gVE9ETyAtIEFkZCBzdXBwb3J0IGZvciBTdGlja2VycGlja2VycyBmcm9tIG11bHRpcGxlIGFwcCBzdG9yZXMuXG4gICAgICAgIC8vIFJlbmRlciBjb250ZW50IGZyb20gbXVsdGlwbGUgc3RpY2tlcnBhY2sgc291cmNlcywgZWFjaCB3aXRoaW4gdGhlaXJcbiAgICAgICAgLy8gb3duIGlmcmFtZSwgd2l0aGluIHRoZSBzdGlja2VycGlja2VyIFVJIGVsZW1lbnQuXG4gICAgICAgIGNvbnN0IHN0aWNrZXJwaWNrZXJXaWRnZXQgPSB0aGlzLnN0YXRlLnN0aWNrZXJwaWNrZXJXaWRnZXQ7XG4gICAgICAgIGxldCBzdGlja2Vyc0NvbnRlbnQ7XG5cbiAgICAgICAgLy8gVXNlIGEgc2VwYXJhdGUgUmVhY3RET00gdHJlZSB0byByZW5kZXIgdGhlIEFwcFRpbGUgc2VwYXJhdGVseSBzbyB0aGF0IGl0IHBlcnNpc3RzIGFuZCBkb2VzXG4gICAgICAgIC8vIG5vdCB1bm1vdW50IHdoZW4gd2UgKGEpIGNsb3NlIHRoZSBzdGlja2VyIHBpY2tlciAoYikgc3dpdGNoIHJvb21zLiBJdCdzIHByb3BlcnRpZXMgYXJlIHN0aWxsXG4gICAgICAgIC8vIHVwZGF0ZWQuXG5cbiAgICAgICAgLy8gTG9hZCBzdGlja2VycGFjayBjb250ZW50XG4gICAgICAgIGlmIChzdGlja2VycGlja2VyV2lkZ2V0ICYmIHN0aWNrZXJwaWNrZXJXaWRnZXQuY29udGVudCAmJiBzdGlja2VycGlja2VyV2lkZ2V0LmNvbnRlbnQudXJsKSB7XG4gICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCBuYW1lXG4gICAgICAgICAgICBzdGlja2VycGlja2VyV2lkZ2V0LmNvbnRlbnQubmFtZSA9IHN0aWNrZXJwaWNrZXJXaWRnZXQuY29udGVudC5uYW1lIHx8IF90KFwiU3RpY2tlcnBhY2tcIik7XG5cbiAgICAgICAgICAgIC8vIEZJWE1FOiBjb3VsZCB0aGlzIHVzZSB0aGUgc2FtZSBjb2RlIGFzIG90aGVyIGFwcHM/XG4gICAgICAgICAgICBjb25zdCBzdGlja2VyQXBwOiBJQXBwID0ge1xuICAgICAgICAgICAgICAgIGlkOiBzdGlja2VycGlja2VyV2lkZ2V0LmlkLFxuICAgICAgICAgICAgICAgIHVybDogc3RpY2tlcnBpY2tlcldpZGdldC5jb250ZW50LnVybCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzdGlja2VycGlja2VyV2lkZ2V0LmNvbnRlbnQubmFtZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBzdGlja2VycGlja2VyV2lkZ2V0LmNvbnRlbnQudHlwZSxcbiAgICAgICAgICAgICAgICBkYXRhOiBzdGlja2VycGlja2VyV2lkZ2V0LmNvbnRlbnQuZGF0YSxcbiAgICAgICAgICAgICAgICByb29tSWQ6IHN0aWNrZXJwaWNrZXJXaWRnZXQuY29udGVudC5yb29tSWQsXG4gICAgICAgICAgICAgICAgZXZlbnRJZDogc3RpY2tlcnBpY2tlcldpZGdldC5jb250ZW50LmV2ZW50SWQsXG4gICAgICAgICAgICAgICAgYXZhdGFyX3VybDogc3RpY2tlcnBpY2tlcldpZGdldC5jb250ZW50LmF2YXRhcl91cmwsXG4gICAgICAgICAgICAgICAgY3JlYXRvclVzZXJJZDogc3RpY2tlcnBpY2tlcldpZGdldC5jb250ZW50LmNyZWF0b3JVc2VySWQsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzdGlja2Vyc0NvbnRlbnQgPSAoXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1N0aWNrZXJzX2NvbnRlbnRfY29udGFpbmVyJz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ9J3N0aWNrZXJzQ29udGVudCdcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0nbXhfU3RpY2tlcnNfY29udGVudCdcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiAnbm9uZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLnBvcG92ZXJIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMucG9wb3ZlcldpZHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgPFBlcnNpc3RlZEVsZW1lbnQgcGVyc2lzdEtleT17UEVSU0lTVEVEX0VMRU1FTlRfS0VZfSB6SW5kZXg9e1NUSUNLRVJQSUNLRVJfWl9JTkRFWH0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEFwcFRpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwPXtzdGlja2VyQXBwfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tPXt0aGlzLnByb3BzLnJvb219XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxXaWR0aD17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkPXtNYXRyaXhDbGllbnRQZWcuZ2V0KCkuY3JlZGVudGlhbHMudXNlcklkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdG9yVXNlcklkPXtzdGlja2VycGlja2VyV2lkZ2V0LnNlbmRlciB8fCBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuY3JlZGVudGlhbHMudXNlcklkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0Rm9ySWZyYW1lTG9hZD17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd01lbnViYXI9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRWRpdENsaWNrPXt0aGlzLmxhdW5jaE1hbmFnZUludGVncmF0aW9uc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25EZWxldGVDbGljaz17dGhpcy5yZW1vdmVTdGlja2VycGlja2VyV2lkZ2V0c31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1RpdGxlPXtmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1BvcG91dD17ZmFsc2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU1pbmltaXNlUG9pbnRlckV2ZW50cz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcldpZGdldD17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9QZXJzaXN0ZWRFbGVtZW50PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBEZWZhdWx0IGNvbnRlbnQgdG8gc2hvdyBpZiBzdGlja2VycGlja2VyIHdpZGdldCBub3QgYWRkZWRcbiAgICAgICAgICAgIHN0aWNrZXJzQ29udGVudCA9IHRoaXMuZGVmYXVsdFN0aWNrZXJwaWNrZXJDb250ZW50KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0aWNrZXJzQ29udGVudDtcbiAgICB9XG5cbiAgICAvLyBEZXYgbm90ZTogdGhpcyBpc24ndCBqc2RvYyBiZWNhdXNlIGl0J3MgYW5ncnkuXG4gICAgLypcbiAgICAgKiBTaG93IHRoZSBzdGlja2VyIHBpY2tlciBvdmVybGF5XG4gICAgICogSWYgbm8gc3RpY2tlcnBhY2tzIGhhdmUgYmVlbiBhZGRlZCwgc2hvdyBhIGxpbmsgdG8gdGhlIGludGVncmF0aW9uIG1hbmFnZXIgYWRkIHN0aWNrZXIgcGFja3MgcGFnZS5cbiAgICAgKi9cbiAgICBwcml2YXRlIG9uU2hvd1N0aWNrZXJzQ2xpY2sgPSAoZTogUmVhY3QuTW91c2VFdmVudDxIVE1MRWxlbWVudD4pOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKCFTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwiaW50ZWdyYXRpb25Qcm92aXNpb25pbmdcIikpIHtcbiAgICAgICAgICAgIC8vIEludGVyY2VwdCB0aGlzIGNhc2UgYW5kIHNwYXduIGEgd2FybmluZy5cbiAgICAgICAgICAgIHJldHVybiBJbnRlZ3JhdGlvbk1hbmFnZXJzLnNoYXJlZEluc3RhbmNlKCkuc2hvd0Rpc2FibGVkRGlhbG9nKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBYWFg6IFNpbXBsaWZ5IGJ5IHVzaW5nIGEgY29udGV4dCBtZW51IHRoYXQgaXMgcG9zaXRpb25lZCByZWxhdGl2ZSB0byB0aGUgc3RpY2tlciBwaWNrZXIgYnV0dG9uXG5cbiAgICAgICAgY29uc3QgYnV0dG9uUmVjdCA9IGUuY3VycmVudFRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICAvLyBUaGUgd2luZG93IFggYW5kIFkgb2Zmc2V0cyBhcmUgdG8gYWRqdXN0IHBvc2l0aW9uIHdoZW4gem9vbWVkIGluIHRvIHBhZ2VcbiAgICAgICAgbGV0IHggPSBidXR0b25SZWN0LnJpZ2h0ICsgd2luZG93LnBhZ2VYT2Zmc2V0IC0gNDE7XG5cbiAgICAgICAgLy8gQW1vdW50IG9mIGhvcml6b250YWwgc3BhY2UgYmV0d2VlbiB0aGUgcmlnaHQgb2YgbWVudSBhbmQgdGhlIHJpZ2h0IG9mIHRoZSB2aWV3cG9ydFxuICAgICAgICAvLyAgKDEwID0gYW1vdW50IG5lZWRlZCB0byBtYWtlIGNoZXZyb24gY2VudHJhbGx5IGFsaWduZWQpXG4gICAgICAgIGNvbnN0IHJpZ2h0UGFkID0gMTA7XG5cbiAgICAgICAgLy8gV2hlbiB0aGUgc3RpY2tlciBwaWNrZXIgd291bGQgYmUgZGlzcGxheWVkIG9mZiBvZiB0aGUgdmlld3BvcnQsIGFkanVzdCB4XG4gICAgICAgIC8vICAoMzAyID0gd2lkdGggb2YgY29udGV4dCBtZW51LCBpbmNsdWRpbmcgYm9yZGVycylcbiAgICAgICAgeCA9IE1hdGgubWluKHgsIGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggLSAoMzAyICsgcmlnaHRQYWQpKTtcblxuICAgICAgICAvLyBPZmZzZXQgdGhlIGNoZXZyb24gbG9jYXRpb24sIHdoaWNoIGlzIHJlbGF0aXZlIHRvIHRoZSBsZWZ0IG9mIHRoZSBjb250ZXh0IG1lbnVcbiAgICAgICAgLy8gICgxMCA9IG9mZnNldCB3aGVuIGNvbnRleHQgbWVudSB3b3VsZCBub3QgYmUgZGlzcGxheWVkIG9mZiB2aWV3cG9ydClcbiAgICAgICAgLy8gICgyID0gY29udGV4dCBtZW51IGJvcmRlcnMpXG4gICAgICAgIGNvbnN0IHN0aWNrZXJwaWNrZXJDaGV2cm9uT2Zmc2V0ID0gTWF0aC5tYXgoMTAsIDIgKyB3aW5kb3cucGFnZVhPZmZzZXQgKyBidXR0b25SZWN0LmxlZnQgLSB4KTtcblxuICAgICAgICBjb25zdCB5ID0gKGJ1dHRvblJlY3QudG9wICsgKGJ1dHRvblJlY3QuaGVpZ2h0IC8gMikgKyB3aW5kb3cucGFnZVlPZmZzZXQpIC0gMTk7XG5cbiAgICAgICAgdGhpcy5wcm9wcy5zZXRTaG93U3RpY2tlcnModHJ1ZSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc3RpY2tlcnBpY2tlclg6IHgsXG4gICAgICAgICAgICBzdGlja2VycGlja2VyWTogeSxcbiAgICAgICAgICAgIHN0aWNrZXJwaWNrZXJDaGV2cm9uT2Zmc2V0LFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gdGhlIHdpbmRvdyBpcyByZXNpemVkXG4gICAgICovXG4gICAgcHJpdmF0ZSBvblJlc2l6ZSA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuc2hvd1N0aWNrZXJzKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLnNldFNob3dTdGlja2VycyhmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIHN0aWNrZXJzIHBpY2tlciB3YXMgaGlkZGVuXG4gICAgICovXG4gICAgcHJpdmF0ZSBvbkZpbmlzaGVkID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5zaG93U3RpY2tlcnMpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuc2V0U2hvd1N0aWNrZXJzKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBMYXVuY2ggdGhlIGludGVncmF0aW9uIG1hbmFnZXIgb24gdGhlIHN0aWNrZXJzIGludGVncmF0aW9uIHBhZ2VcbiAgICAgKi9cbiAgICBwcml2YXRlIGxhdW5jaE1hbmFnZUludGVncmF0aW9ucyA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgLy8gVE9ETzogT3BlbiB0aGUgcmlnaHQgaW50ZWdyYXRpb24gbWFuYWdlciBmb3IgdGhlIHdpZGdldFxuICAgICAgICBpZiAoU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImZlYXR1cmVfbWFueV9pbnRlZ3JhdGlvbl9tYW5hZ2Vyc1wiKSkge1xuICAgICAgICAgICAgSW50ZWdyYXRpb25NYW5hZ2Vycy5zaGFyZWRJbnN0YW5jZSgpLm9wZW5BbGwoXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5yb29tLFxuICAgICAgICAgICAgICAgIGB0eXBlXyR7V2lkZ2V0VHlwZS5TVElDS0VSUElDS0VSLnByZWZlcnJlZH1gLFxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUud2lkZ2V0SWQsXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgSW50ZWdyYXRpb25NYW5hZ2Vycy5zaGFyZWRJbnN0YW5jZSgpLmdldFByaW1hcnlNYW5hZ2VyKCkub3BlbihcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLnJvb20sXG4gICAgICAgICAgICAgICAgYHR5cGVfJHtXaWRnZXRUeXBlLlNUSUNLRVJQSUNLRVIucHJlZmVycmVkfWAsXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS53aWRnZXRJZCxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGlmICghdGhpcy5wcm9wcy5zaG93U3RpY2tlcnMpIHJldHVybiBudWxsO1xuXG4gICAgICAgIHJldHVybiA8Q29udGV4dE1lbnVcbiAgICAgICAgICAgIGNoZXZyb25PZmZzZXQ9e3RoaXMuc3RhdGUuc3RpY2tlcnBpY2tlckNoZXZyb25PZmZzZXR9XG4gICAgICAgICAgICBjaGV2cm9uRmFjZT17Q2hldnJvbkZhY2UuQm90dG9tfVxuICAgICAgICAgICAgbGVmdD17dGhpcy5zdGF0ZS5zdGlja2VycGlja2VyWH1cbiAgICAgICAgICAgIHRvcD17dGhpcy5zdGF0ZS5zdGlja2VycGlja2VyWX1cbiAgICAgICAgICAgIG1lbnVXaWR0aD17dGhpcy5wb3BvdmVyV2lkdGh9XG4gICAgICAgICAgICBtZW51SGVpZ2h0PXt0aGlzLnBvcG92ZXJIZWlnaHR9XG4gICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLm9uRmluaXNoZWR9XG4gICAgICAgICAgICBtZW51UGFkZGluZ1RvcD17MH1cbiAgICAgICAgICAgIG1lbnVQYWRkaW5nTGVmdD17MH1cbiAgICAgICAgICAgIG1lbnVQYWRkaW5nUmlnaHQ9ezB9XG4gICAgICAgICAgICB6SW5kZXg9e1NUSUNLRVJQSUNLRVJfWl9JTkRFWH1cbiAgICAgICAgICAgIHsuLi50aGlzLnByb3BzLm1lbnVQb3NpdGlvbn1cbiAgICAgICAgPlxuICAgICAgICAgICAgPEdlbmVyaWNFbGVtZW50Q29udGV4dE1lbnUgZWxlbWVudD17dGhpcy5nZXRTdGlja2VycGlja2VyQ29udGVudCgpfSBvblJlc2l6ZT17dGhpcy5vbkZpbmlzaGVkfSAvPlxuICAgICAgICA8L0NvbnRleHRNZW51PjtcbiAgICB9XG59XG4iXX0=