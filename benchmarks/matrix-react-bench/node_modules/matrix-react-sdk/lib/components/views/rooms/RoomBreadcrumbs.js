"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _BreadcrumbsStore = require("../../../stores/BreadcrumbsStore");

var _DecoratedRoomAvatar = _interopRequireDefault(require("../avatars/DecoratedRoomAvatar"));

var _languageHandler = require("../../../languageHandler");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _Analytics = _interopRequireDefault(require("../../../Analytics"));

var _AsyncStore = require("../../../stores/AsyncStore");

var _reactTransitionGroup = require("react-transition-group");

var _RovingTabIndex = require("../../../accessibility/RovingTabIndex");

var _Toolbar = _interopRequireDefault(require("../../../accessibility/Toolbar"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _dec, _class;

let RoomBreadcrumbs = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.RoomBreadcrumbs"), _dec(_class = class RoomBreadcrumbs extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "isMounted", true);
    (0, _defineProperty2.default)(this, "onBreadcrumbsUpdate", () => {
      if (!this.isMounted) return; // We need to trick the CSSTransition component into updating, which means we need to
      // tell it to not animate, then to animate a moment later. This causes two updates
      // which means two renders. The skipFirst change is so that our don't-animate state
      // doesn't show the breadcrumb we're about to reveal as it causes a visual jump/jerk.
      // The second update, on the next available tick, causes the "enter" animation to start
      // again and this time we want to show the newest breadcrumb because it'll be hidden
      // off screen for the animation.

      this.setState({
        doAnimation: false,
        skipFirst: true
      });
      setTimeout(() => this.setState({
        doAnimation: true,
        skipFirst: false
      }), 0);
    });
    (0, _defineProperty2.default)(this, "viewRoom", (room, index) => {
      _Analytics.default.trackEvent("Breadcrumbs", "click_node", String(index));

      _dispatcher.default.dispatch({
        action: "view_room",
        room_id: room.roomId
      });
    });
    this.state = {
      doAnimation: true,
      // technically we want animation on mount, but it won't be perfect
      skipFirst: false // render the thing, as boring as it is

    };

    _BreadcrumbsStore.BreadcrumbsStore.instance.on(_AsyncStore.UPDATE_EVENT, this.onBreadcrumbsUpdate);
  }

  componentWillUnmount() {
    this.isMounted = false;

    _BreadcrumbsStore.BreadcrumbsStore.instance.off(_AsyncStore.UPDATE_EVENT, this.onBreadcrumbsUpdate);
  }

  render() {
    const tiles = _BreadcrumbsStore.BreadcrumbsStore.instance.rooms.map((r, i) => {
      return /*#__PURE__*/_react.default.createElement(_RovingTabIndex.RovingAccessibleTooltipButton, {
        className: "mx_RoomBreadcrumbs_crumb",
        key: r.roomId,
        onClick: () => this.viewRoom(r, i),
        "aria-label": (0, _languageHandler._t)("Room %(name)s", {
          name: r.name
        }),
        title: r.name,
        tooltipClassName: "mx_RoomBreadcrumbs_Tooltip"
      }, /*#__PURE__*/_react.default.createElement(_DecoratedRoomAvatar.default, {
        room: r,
        avatarSize: 32,
        displayBadge: true,
        forceCount: true
      }));
    });

    if (tiles.length > 0) {
      // NOTE: The CSSTransition timeout MUST match the timeout in our CSS!
      return /*#__PURE__*/_react.default.createElement(_reactTransitionGroup.CSSTransition, {
        appear: true,
        in: this.state.doAnimation,
        timeout: 640,
        classNames: "mx_RoomBreadcrumbs"
      }, /*#__PURE__*/_react.default.createElement(_Toolbar.default, {
        className: "mx_RoomBreadcrumbs",
        "aria-label": (0, _languageHandler._t)("Recently visited rooms")
      }, tiles.slice(this.state.skipFirst ? 1 : 0)));
    } else {
      return /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RoomBreadcrumbs"
      }, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_RoomBreadcrumbs_placeholder"
      }, (0, _languageHandler._t)("No recently visited rooms")));
    }
  }

}) || _class);
exports.default = RoomBreadcrumbs;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL1Jvb21CcmVhZGNydW1icy50c3giXSwibmFtZXMiOlsiUm9vbUJyZWFkY3J1bWJzIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImlzTW91bnRlZCIsInNldFN0YXRlIiwiZG9BbmltYXRpb24iLCJza2lwRmlyc3QiLCJzZXRUaW1lb3V0Iiwicm9vbSIsImluZGV4IiwiQW5hbHl0aWNzIiwidHJhY2tFdmVudCIsIlN0cmluZyIsImRlZmF1bHREaXNwYXRjaGVyIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJyb29tX2lkIiwicm9vbUlkIiwic3RhdGUiLCJCcmVhZGNydW1ic1N0b3JlIiwiaW5zdGFuY2UiLCJvbiIsIlVQREFURV9FVkVOVCIsIm9uQnJlYWRjcnVtYnNVcGRhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsIm9mZiIsInJlbmRlciIsInRpbGVzIiwicm9vbXMiLCJtYXAiLCJyIiwiaSIsInZpZXdSb29tIiwibmFtZSIsImxlbmd0aCIsInNsaWNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztJQWlCcUJBLGUsV0FEcEIsZ0RBQXFCLDZCQUFyQixDLGdCQUFELE1BQ3FCQSxlQURyQixTQUM2Q0MsZUFBTUMsYUFEbkQsQ0FDaUY7QUFHN0VDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFnQjtBQUN2QixVQUFNQSxLQUFOO0FBRHVCLHFEQUZQLElBRU87QUFBQSwrREFnQkcsTUFBTTtBQUNoQyxVQUFJLENBQUMsS0FBS0MsU0FBVixFQUFxQixPQURXLENBR2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFdBQUtDLFFBQUwsQ0FBYztBQUFFQyxRQUFBQSxXQUFXLEVBQUUsS0FBZjtBQUFzQkMsUUFB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b3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IEJyZWFkY3J1bWJzU3RvcmUgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL0JyZWFkY3J1bWJzU3RvcmVcIjtcbmltcG9ydCBEZWNvcmF0ZWRSb29tQXZhdGFyIGZyb20gXCIuLi9hdmF0YXJzL0RlY29yYXRlZFJvb21BdmF0YXJcIjtcbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuaW1wb3J0IGRlZmF1bHREaXNwYXRjaGVyIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCBBbmFseXRpY3MgZnJvbSBcIi4uLy4uLy4uL0FuYWx5dGljc1wiO1xuaW1wb3J0IHsgVVBEQVRFX0VWRU5UIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9Bc3luY1N0b3JlXCI7XG5pbXBvcnQgeyBDU1NUcmFuc2l0aW9uIH0gZnJvbSBcInJlYWN0LXRyYW5zaXRpb24tZ3JvdXBcIjtcbmltcG9ydCB7IFJvdmluZ0FjY2Vzc2libGVUb29sdGlwQnV0dG9uIH0gZnJvbSBcIi4uLy4uLy4uL2FjY2Vzc2liaWxpdHkvUm92aW5nVGFiSW5kZXhcIjtcbmltcG9ydCBUb29sYmFyIGZyb20gXCIuLi8uLi8uLi9hY2Nlc3NpYmlsaXR5L1Rvb2xiYXJcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICAvLyBCb3RoIG9mIHRoZXNlIGNvbnRyb2wgdGhlIGFuaW1hdGlvbiBmb3IgdGhlIGJyZWFkY3J1bWJzLiBGb3IgZGV0YWlscyBvbiB0aGVcbiAgICAvLyBhY3R1YWwgYW5pbWF0aW9uLCBzZWUgdGhlIENTUy5cbiAgICAvL1xuICAgIC8vIGRvQW5pbWF0aW9uIGlzIHRvIGxpZSB0byB0aGUgQ1NTVHJhbnNpdGlvbiBjb21wb25lbnQgKHNlZSBvbkJyZWFkY3J1bWJzVXBkYXRlXG4gICAgLy8gZm9yIGluZm8pLiBza2lwRmlyc3QgaXMgdXNlZCB0byB0cnkgYW5kIHJlZHVjZSBqZXJreSBhbmltYXRpb24gLSBhbHNvIHNlZSB0aGVcbiAgICAvLyBicmVhZGNydW1iIHVwZGF0ZSBmdW5jdGlvbiBmb3IgaW5mbyBvbiB0aGF0LlxuICAgIGRvQW5pbWF0aW9uOiBib29sZWFuO1xuICAgIHNraXBGaXJzdDogYm9vbGVhbjtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3Mucm9vbXMuUm9vbUJyZWFkY3J1bWJzXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSb29tQnJlYWRjcnVtYnMgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBpc01vdW50ZWQgPSB0cnVlO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGRvQW5pbWF0aW9uOiB0cnVlLCAvLyB0ZWNobmljYWxseSB3ZSB3YW50IGFuaW1hdGlvbiBvbiBtb3VudCwgYnV0IGl0IHdvbid0IGJlIHBlcmZlY3RcbiAgICAgICAgICAgIHNraXBGaXJzdDogZmFsc2UsIC8vIHJlbmRlciB0aGUgdGhpbmcsIGFzIGJvcmluZyBhcyBpdCBpc1xuICAgICAgICB9O1xuXG4gICAgICAgIEJyZWFkY3J1bWJzU3RvcmUuaW5zdGFuY2Uub24oVVBEQVRFX0VWRU5ULCB0aGlzLm9uQnJlYWRjcnVtYnNVcGRhdGUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy5pc01vdW50ZWQgPSBmYWxzZTtcbiAgICAgICAgQnJlYWRjcnVtYnNTdG9yZS5pbnN0YW5jZS5vZmYoVVBEQVRFX0VWRU5ULCB0aGlzLm9uQnJlYWRjcnVtYnNVcGRhdGUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25CcmVhZGNydW1ic1VwZGF0ZSA9ICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmlzTW91bnRlZCkgcmV0dXJuO1xuXG4gICAgICAgIC8vIFdlIG5lZWQgdG8gdHJpY2sgdGhlIENTU1RyYW5zaXRpb24gY29tcG9uZW50IGludG8gdXBkYXRpbmcsIHdoaWNoIG1lYW5zIHdlIG5lZWQgdG9cbiAgICAgICAgLy8gdGVsbCBpdCB0byBub3QgYW5pbWF0ZSwgdGhlbiB0byBhbmltYXRlIGEgbW9tZW50IGxhdGVyLiBUaGlzIGNhdXNlcyB0d28gdXBkYXRlc1xuICAgICAgICAvLyB3aGljaCBtZWFucyB0d28gcmVuZGVycy4gVGhlIHNraXBGaXJzdCBjaGFuZ2UgaXMgc28gdGhhdCBvdXIgZG9uJ3QtYW5pbWF0ZSBzdGF0ZVxuICAgICAgICAvLyBkb2Vzbid0IHNob3cgdGhlIGJyZWFkY3J1bWIgd2UncmUgYWJvdXQgdG8gcmV2ZWFsIGFzIGl0IGNhdXNlcyBhIHZpc3VhbCBqdW1wL2plcmsuXG4gICAgICAgIC8vIFRoZSBzZWNvbmQgdXBkYXRlLCBvbiB0aGUgbmV4dCBhdmFpbGFibGUgdGljaywgY2F1c2VzIHRoZSBcImVudGVyXCIgYW5pbWF0aW9uIHRvIHN0YXJ0XG4gICAgICAgIC8vIGFnYWluIGFuZCB0aGlzIHRpbWUgd2Ugd2FudCB0byBzaG93IHRoZSBuZXdlc3QgYnJlYWRjcnVtYiBiZWNhdXNlIGl0J2xsIGJlIGhpZGRlblxuICAgICAgICAvLyBvZmYgc2NyZWVuIGZvciB0aGUgYW5pbWF0aW9uLlxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZG9BbmltYXRpb246IGZhbHNlLCBza2lwRmlyc3Q6IHRydWUgfSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZXRTdGF0ZSh7IGRvQW5pbWF0aW9uOiB0cnVlLCBza2lwRmlyc3Q6IGZhbHNlIH0pLCAwKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSB2aWV3Um9vbSA9IChyb29tOiBSb29tLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgIEFuYWx5dGljcy50cmFja0V2ZW50KFwiQnJlYWRjcnVtYnNcIiwgXCJjbGlja19ub2RlXCIsIFN0cmluZyhpbmRleCkpO1xuICAgICAgICBkZWZhdWx0RGlzcGF0Y2hlci5kaXNwYXRjaCh7IGFjdGlvbjogXCJ2aWV3X3Jvb21cIiwgcm9vbV9pZDogcm9vbS5yb29tSWQgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKTogUmVhY3QuUmVhY3RFbGVtZW50IHtcbiAgICAgICAgY29uc3QgdGlsZXMgPSBCcmVhZGNydW1ic1N0b3JlLmluc3RhbmNlLnJvb21zLm1hcCgociwgaSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8Um92aW5nQWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUm9vbUJyZWFkY3J1bWJzX2NydW1iXCJcbiAgICAgICAgICAgICAgICAgICAga2V5PXtyLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy52aWV3Um9vbShyLCBpKX1cbiAgICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD17X3QoXCJSb29tICUobmFtZSlzXCIsIHsgbmFtZTogci5uYW1lIH0pfVxuICAgICAgICAgICAgICAgICAgICB0aXRsZT17ci5uYW1lfVxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwQ2xhc3NOYW1lPVwibXhfUm9vbUJyZWFkY3J1bWJzX1Rvb2x0aXBcIlxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPERlY29yYXRlZFJvb21BdmF0YXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb209e3J9XG4gICAgICAgICAgICAgICAgICAgICAgICBhdmF0YXJTaXplPXszMn1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlCYWRnZT17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlQ291bnQ9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Sb3ZpbmdBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvbj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAvLyBOT1RFOiBUaGUgQ1NTVHJhbnNpdGlvbiB0aW1lb3V0IE1VU1QgbWF0Y2ggdGhlIHRpbWVvdXQgaW4gb3VyIENTUyFcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPENTU1RyYW5zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgYXBwZWFyPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICBpbj17dGhpcy5zdGF0ZS5kb0FuaW1hdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgdGltZW91dD17NjQwfVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWVzPSdteF9Sb29tQnJlYWRjcnVtYnMnXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8VG9vbGJhciBjbGFzc05hbWU9J214X1Jvb21CcmVhZGNydW1icycgYXJpYS1sYWJlbD17X3QoXCJSZWNlbnRseSB2aXNpdGVkIHJvb21zXCIpfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGlsZXMuc2xpY2UodGhpcy5zdGF0ZS5za2lwRmlyc3QgPyAxIDogMCkgfVxuICAgICAgICAgICAgICAgICAgICA8L1Rvb2xiYXI+XG4gICAgICAgICAgICAgICAgPC9DU1NUcmFuc2l0aW9uPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1Jvb21CcmVhZGNydW1icyc+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbUJyZWFkY3J1bWJzX3BsYWNlaG9sZGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiTm8gcmVjZW50bHkgdmlzaXRlZCByb29tc1wiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==