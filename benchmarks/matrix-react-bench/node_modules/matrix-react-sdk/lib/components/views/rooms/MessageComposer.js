"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _Stickerpicker = _interopRequireDefault(require("./Stickerpicker"));

var _Permalinks = require("../../../utils/permalinks/Permalinks");

var _ContentMessages = _interopRequireDefault(require("../../../ContentMessages"));

var _E2EIcon = _interopRequireDefault(require("./E2EIcon"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _ContextMenu = _interopRequireWildcard(require("../../structures/ContextMenu"));

var _AccessibleTooltipButton = _interopRequireDefault(require("../elements/AccessibleTooltipButton"));

var _ReplyPreview = _interopRequireDefault(require("./ReplyPreview"));

var _UIFeature = require("../../../settings/UIFeature");

var _AsyncStore = require("../../../stores/AsyncStore");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _VoiceRecordComposerTile = _interopRequireDefault(require("./VoiceRecordComposerTile"));

var _VoiceRecordingStore = require("../../../stores/VoiceRecordingStore");

var _VoiceRecording = require("../../../audio/VoiceRecording");

var _Tooltip = _interopRequireWildcard(require("../elements/Tooltip"));

var _SendMessageComposer = _interopRequireDefault(require("./SendMessageComposer"));

var _actions = require("../../../dispatcher/actions");

var _EmojiPicker = _interopRequireDefault(require("../emojipicker/EmojiPicker"));

var _MemberStatusMessageAvatar = _interopRequireDefault(require("../avatars/MemberStatusMessageAvatar"));

var _UIStore = _interopRequireWildcard(require("../../../stores/UIStore"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _event = require("matrix-js-sdk/src/@types/event");

var _RoomContext = _interopRequireDefault(require("../../../contexts/RoomContext"));

var _consts = require("../../../polls/consts");

var _ErrorDialog = _interopRequireDefault(require("../dialogs/ErrorDialog"));

var _PollCreateDialog = _interopRequireDefault(require("../elements/PollCreateDialog"));

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let instanceCount = 0;
const NARROW_MODE_BREAKPOINT = 500;

function ComposerAvatar(props) {
  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_MessageComposer_avatar"
  }, /*#__PURE__*/_react.default.createElement(_MemberStatusMessageAvatar.default, {
    member: props.me,
    width: 24,
    height: 24
  }));
}

function SendButton(props) {
  return /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
    className: "mx_MessageComposer_sendMessage",
    onClick: props.onClick,
    title: props.title ?? (0, _languageHandler._t)('Send message')
  });
}

const EmojiButton = ({
  addEmoji,
  menuPosition,
  narrowMode
}) => {
  const [menuDisplayed, button, openMenu, closeMenu] = (0, _ContextMenu.useContextMenu)();
  let contextMenu;

  if (menuDisplayed) {
    const position = menuPosition ?? (0, _ContextMenu.aboveLeftOf)(button.current.getBoundingClientRect());
    contextMenu = /*#__PURE__*/_react.default.createElement(_ContextMenu.default, (0, _extends2.default)({}, position, {
      onFinished: closeMenu,
      managed: false
    }), /*#__PURE__*/_react.default.createElement(_EmojiPicker.default, {
      onChoose: addEmoji,
      showQuickReactions: true
    }));
  }

  const className = (0, _classnames.default)("mx_MessageComposer_button", "mx_MessageComposer_emoji", {
    "mx_MessageComposer_button_highlight": menuDisplayed
  }); // TODO: replace ContextMenuTooltipButton with a unified representation of
  // the header buttons and the right panel buttons

  return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
    className: className,
    onClick: openMenu,
    title: !narrowMode && (0, _languageHandler._t)('Emoji picker'),
    label: narrowMode ? (0, _languageHandler._t)("Add emoji") : null
  }), contextMenu);
};

class UploadButton extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "uploadInput", /*#__PURE__*/_react.default.createRef());
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "onAction", payload => {
      if (payload.action === "upload_file") {
        this.onUploadClick();
      }
    });
    (0, _defineProperty2.default)(this, "onUploadClick", () => {
      if (_MatrixClientPeg.MatrixClientPeg.get().isGuest()) {
        _dispatcher.default.dispatch({
          action: 'require_registration'
        });

        return;
      }

      this.uploadInput.current.click();
    });
    (0, _defineProperty2.default)(this, "onUploadFileInputChange", ev => {
      if (ev.target.files.length === 0) return; // take a copy so we can safely reset the value of the form control
      // (Note it is a FileList: we can't use slice or sensible iteration).

      const tfiles = [];

      for (let i = 0; i < ev.target.files.length; ++i) {
        tfiles.push(ev.target.files[i]);
      }

      _ContentMessages.default.sharedInstance().sendContentListToRoom(tfiles, this.props.roomId, this.props.relation, _MatrixClientPeg.MatrixClientPeg.get()); // This is the onChange handler for a file form control, but we're
      // not keeping any state, so reset the value of the form control
      // to empty.
      // NB. we need to set 'value': the 'files' property is immutable.


      ev.target.value = '';
    });
    this.dispatcherRef = _dispatcher.default.register(this.onAction);
  }

  componentWillUnmount() {
    _dispatcher.default.unregister(this.dispatcherRef);
  }

  render() {
    const uploadInputStyle = {
      display: 'none'
    };
    return /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
      className: "mx_MessageComposer_button mx_MessageComposer_upload",
      onClick: this.onUploadClick,
      title: (0, _languageHandler._t)('Upload file')
    }, /*#__PURE__*/_react.default.createElement("input", {
      ref: this.uploadInput,
      type: "file",
      style: uploadInputStyle,
      multiple: true,
      onChange: this.onUploadFileInputChange
    }));
  }

}

class PollButton extends _react.default.PureComponent {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "onCreateClick", () => {
      const canSend = this.props.room.currentState.maySendEvent(_consts.POLL_START_EVENT_TYPE.name, _MatrixClientPeg.MatrixClientPeg.get().getUserId());

      if (!canSend) {
        _Modal.default.createTrackedDialog('Polls', 'permissions error: cannot start', _ErrorDialog.default, {
          title: (0, _languageHandler._t)("Permission Required"),
          description: (0, _languageHandler._t)("You do not have permission to start polls in this room.")
        });
      } else {
        _Modal.default.createTrackedDialog('Polls', 'create', _PollCreateDialog.default, {
          room: this.props.room
        }, 'mx_CompoundDialog', false, // isPriorityModal
        true // isStaticModal
        );
      }
    });
  }

  render() {
    return /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
      className: "mx_MessageComposer_button mx_MessageComposer_poll",
      onClick: this.onCreateClick,
      title: (0, _languageHandler._t)('Create poll')
    });
  }

}

let MessageComposer = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.MessageComposer"), _dec(_class = (_temp = _class2 = class MessageComposer extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "messageComposerInput", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "voiceRecordingButton", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "ref", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "instanceId", void 0);
    (0, _defineProperty2.default)(this, "context", void 0);
    (0, _defineProperty2.default)(this, "onResize", (type, entry) => {
      if (type === _UIStore.UI_EVENTS.Resize) {
        const narrowMode = entry.contentRect.width <= NARROW_MODE_BREAKPOINT;
        this.setState({
          narrowMode,
          isMenuOpen: !narrowMode ? false : this.state.isMenuOpen,
          showStickers: false
        });
      }
    });
    (0, _defineProperty2.default)(this, "onAction", payload => {
      if (payload.action === 'reply_to_event' && payload.context === this.context.timelineRenderingType) {
        // add a timeout for the reply preview to be rendered, so
        // that the ScrollPanel listening to the resizeNotifier can
        // correctly measure it's new height and scroll down to keep
        // at the bottom if it already is
        setTimeout(() => {
          this.props.resizeNotifier.notifyTimelineHeightChanged();
        }, 100);
      }
    });
    (0, _defineProperty2.default)(this, "onRoomStateEvents", (ev, state) => {
      if (ev.getRoomId() !== this.props.room.roomId) return;

      if (ev.getType() === 'm.room.tombstone') {
        this.setState({
          tombstone: this.getRoomTombstone()
        });
      }

      if (ev.getType() === 'm.room.power_levels') {
        this.setState({
          canSendMessages: this.props.room.maySendMessage()
        });
      }
    });
    (0, _defineProperty2.default)(this, "onTombstoneClick", ev => {
      ev.preventDefault();
      const replacementRoomId = this.state.tombstone.getContent()['replacement_room'];

      const replacementRoom = _MatrixClientPeg.MatrixClientPeg.get().getRoom(replacementRoomId);

      let createEventId = null;

      if (replacementRoom) {
        const createEvent = replacementRoom.currentState.getStateEvents('m.room.create', '');
        if (createEvent && createEvent.getId()) createEventId = createEvent.getId();
      }

      const viaServers = [this.state.tombstone.getSender().split(':').slice(1).join(':')];

      _dispatcher.default.dispatch({
        action: _actions.Action.ViewRoom,
        highlighted: true,
        event_id: createEventId,
        room_id: replacementRoomId,
        auto_join: true,
        _type: "tombstone",
        // instrumentation
        // Try to join via the server that sent the event. This converts @something:example.org
        // into a server domain by splitting on colons and ignoring the first entry ("@something").
        via_servers: viaServers,
        opts: {
          // These are passed down to the js-sdk's /join call
          viaServers: viaServers
        }
      });
    });
    (0, _defineProperty2.default)(this, "renderPlaceholderText", () => {
      if (this.props.replyToEvent) {
        var _this$props$relation;

        const replyingToThread = ((_this$props$relation = this.props.relation) === null || _this$props$relation === void 0 ? void 0 : _this$props$relation.rel_type) === _event.RelationType.Thread;

        if (replyingToThread && this.props.e2eStatus) {
          return (0, _languageHandler._t)('Reply to encrypted thread…');
        } else if (replyingToThread) {
          return (0, _languageHandler._t)('Reply to thread…');
        } else if (this.props.e2eStatus) {
          return (0, _languageHandler._t)('Send an encrypted reply…');
        } else {
          return (0, _languageHandler._t)('Send a reply…');
        }
      } else {
        if (this.props.e2eStatus) {
          return (0, _languageHandler._t)('Send an encrypted message…');
        } else {
          return (0, _languageHandler._t)('Send a message…');
        }
      }
    });
    (0, _defineProperty2.default)(this, "addEmoji", emoji => {
      _dispatcher.default.dispatch({
        action: _actions.Action.ComposerInsert,
        text: emoji,
        timelineRenderingType: this.context.timelineRenderingType
      });

      return true;
    });
    (0, _defineProperty2.default)(this, "sendMessage", async () => {
      var _this$messageComposer;

      if (this.state.haveRecording && this.voiceRecordingButton.current) {
        var _this$voiceRecordingB;

        // There shouldn't be any text message to send when a voice recording is active, so
        // just send out the voice recording.
        await ((_this$voiceRecordingB = this.voiceRecordingButton.current) === null || _this$voiceRecordingB === void 0 ? void 0 : _this$voiceRecordingB.send());
        return;
      }

      (_this$messageComposer = this.messageComposerInput.current) === null || _this$messageComposer === void 0 ? void 0 : _this$messageComposer.sendMessage();
    });
    (0, _defineProperty2.default)(this, "onChange", model => {
      this.setState({
        isComposerEmpty: model.isEmpty
      });
    });
    (0, _defineProperty2.default)(this, "onVoiceStoreUpdate", () => {
      const recording = _VoiceRecordingStore.VoiceRecordingStore.instance.activeRecording;

      if (recording) {
        // Delay saying we have a recording until it is started, as we might not yet have A/V permissions
        recording.on(_VoiceRecording.RecordingState.Started, () => {
          this.setState({
            haveRecording: !!_VoiceRecordingStore.VoiceRecordingStore.instance.activeRecording
          });
        }); // We show a little heads up that the recording is about to automatically end soon. The 3s
        // display time is completely arbitrary. Note that we don't need to deregister the listener
        // because the recording instance will clean that up for us.

        recording.on(_VoiceRecording.RecordingState.EndingSoon, ({
          secondsLeft
        }) => {
          this.setState({
            recordingTimeLeftSeconds: secondsLeft
          });
          setTimeout(() => this.setState({
            recordingTimeLeftSeconds: null
          }), 3000);
        });
      } else {
        this.setState({
          haveRecording: false
        });
      }
    });
    (0, _defineProperty2.default)(this, "shouldShowStickerPicker", () => {
      return _SettingsStore.default.getValue(_UIFeature.UIFeature.Widgets) && _SettingsStore.default.getValue("MessageComposerInput.showStickersButton") && !this.state.haveRecording;
    });
    (0, _defineProperty2.default)(this, "showStickers", showStickers => {
      this.setState({
        showStickers
      });
    });
    (0, _defineProperty2.default)(this, "toggleButtonMenu", () => {
      this.setState({
        isMenuOpen: !this.state.isMenuOpen
      });
    });

    _VoiceRecordingStore.VoiceRecordingStore.instance.on(_AsyncStore.UPDATE_EVENT, this.onVoiceStoreUpdate);

    this.state = {
      tombstone: this.getRoomTombstone(),
      canSendMessages: this.props.room.maySendMessage(),
      isComposerEmpty: true,
      haveRecording: false,
      recordingTimeLeftSeconds: null,
      // when set to a number, shows a toast
      isMenuOpen: false,
      showStickers: false
    };
    this.instanceId = instanceCount++;
  }

  componentDidMount() {
    this.dispatcherRef = _dispatcher.default.register(this.onAction);

    _MatrixClientPeg.MatrixClientPeg.get().on("RoomState.events", this.onRoomStateEvents);

    this.waitForOwnMember();

    _UIStore.default.instance.trackElementDimensions(`MessageComposer${this.instanceId}`, this.ref.current);

    _UIStore.default.instance.on(`MessageComposer${this.instanceId}`, this.onResize);
  }

  waitForOwnMember() {
    // if we have the member already, do that
    const me = this.props.room.getMember(_MatrixClientPeg.MatrixClientPeg.get().getUserId());

    if (me) {
      this.setState({
        me
      });
      return;
    } // Otherwise, wait for member loading to finish and then update the member for the avatar.
    // The members should already be loading, and loadMembersIfNeeded
    // will return the promise for the existing operation


    this.props.room.loadMembersIfNeeded().then(() => {
      const me = this.props.room.getMember(_MatrixClientPeg.MatrixClientPeg.get().getUserId());
      this.setState({
        me
      });
    });
  }

  componentWillUnmount() {
    if (_MatrixClientPeg.MatrixClientPeg.get()) {
      _MatrixClientPeg.MatrixClientPeg.get().removeListener("RoomState.events", this.onRoomStateEvents);
    }

    _VoiceRecordingStore.VoiceRecordingStore.instance.off(_AsyncStore.UPDATE_EVENT, this.onVoiceStoreUpdate);

    _dispatcher.default.unregister(this.dispatcherRef);

    _UIStore.default.instance.stopTrackingElementDimensions(`MessageComposer${this.instanceId}`);

    _UIStore.default.instance.removeListener(`MessageComposer${this.instanceId}`, this.onResize);
  }

  getRoomTombstone() {
    return this.props.room.currentState.getStateEvents('m.room.tombstone', '');
  }

  renderButtons(menuPosition) {
    let uploadButtonIndex = 0;
    const buttons = [];

    if (!this.state.haveRecording) {
      if (_SettingsStore.default.getValue("feature_polls")) {
        buttons.push( /*#__PURE__*/_react.default.createElement(PollButton, {
          key: "polls",
          room: this.props.room
        }));
      }

      uploadButtonIndex = buttons.length;
      buttons.push( /*#__PURE__*/_react.default.createElement(UploadButton, {
        key: "controls_upload",
        roomId: this.props.room.roomId,
        relation: this.props.relation
      }));
      buttons.push( /*#__PURE__*/_react.default.createElement(EmojiButton, {
        key: "emoji_button",
        addEmoji: this.addEmoji,
        menuPosition: menuPosition,
        narrowMode: this.state.narrowMode
      }));
    }

    if (this.shouldShowStickerPicker()) {
      let title;

      if (!this.state.narrowMode) {
        title = this.state.showStickers ? (0, _languageHandler._t)("Hide Stickers") : (0, _languageHandler._t)("Show Stickers");
      }

      buttons.push( /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
        id: "stickersButton",
        key: "controls_stickers",
        className: "mx_MessageComposer_button mx_MessageComposer_stickers",
        onClick: () => this.showStickers(!this.state.showStickers),
        title: title,
        label: this.state.narrowMode ? (0, _languageHandler._t)("Send a sticker") : null
      }));
    }

    if (!this.state.haveRecording && !this.state.narrowMode) {
      buttons.push( /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
        key: "voice_message_send",
        className: "mx_MessageComposer_button mx_MessageComposer_voiceMessage",
        onClick: () => {
          var _this$voiceRecordingB2;

          return (_this$voiceRecordingB2 = this.voiceRecordingButton.current) === null || _this$voiceRecordingB2 === void 0 ? void 0 : _this$voiceRecordingB2.onRecordStartEndClick();
        },
        title: (0, _languageHandler._t)("Send voice message")
      }));
    }

    if (!this.state.narrowMode) {
      return buttons;
    } else {
      const classnames = (0, _classnames.default)({
        mx_MessageComposer_button: true,
        mx_MessageComposer_buttonMenu: true,
        mx_MessageComposer_closeButtonMenu: this.state.isMenuOpen
      });
      return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, buttons[uploadButtonIndex], /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
        className: classnames,
        onClick: this.toggleButtonMenu,
        title: (0, _languageHandler._t)("More options"),
        tooltip: false
      }), this.state.isMenuOpen && /*#__PURE__*/_react.default.createElement(_ContextMenu.default, (0, _extends2.default)({
        onFinished: this.toggleButtonMenu
      }, menuPosition, {
        menuPaddingRight: 10,
        menuPaddingTop: 5,
        menuPaddingBottom: 5,
        menuWidth: 150,
        wrapperClassName: "mx_MessageComposer_Menu"
      }), buttons.slice(1).map((button, index) => /*#__PURE__*/_react.default.createElement(_ContextMenu.MenuItem, {
        className: "mx_CallContextMenu_item",
        key: index,
        onClick: this.toggleButtonMenu
      }, button))));
    }
  }

  render() {
    const controls = [this.state.me && !this.props.compact ? /*#__PURE__*/_react.default.createElement(ComposerAvatar, {
      key: "controls_avatar",
      me: this.state.me
    }) : null, this.props.e2eStatus ? /*#__PURE__*/_react.default.createElement(_E2EIcon.default, {
      key: "e2eIcon",
      status: this.props.e2eStatus,
      className: "mx_MessageComposer_e2eIcon"
    }) : null];
    let menuPosition;

    if (this.ref.current) {
      const contentRect = this.ref.current.getBoundingClientRect();
      menuPosition = (0, _ContextMenu.aboveLeftOf)(contentRect);
    }

    if (!this.state.tombstone && this.state.canSendMessages) {
      controls.push( /*#__PURE__*/_react.default.createElement(_SendMessageComposer.default, {
        ref: this.messageComposerInput,
        key: "controls_input",
        room: this.props.room,
        placeholder: this.renderPlaceholderText(),
        permalinkCreator: this.props.permalinkCreator,
        relation: this.props.relation,
        replyToEvent: this.props.replyToEvent,
        onChange: this.onChange,
        disabled: this.state.haveRecording
      }));
      controls.push( /*#__PURE__*/_react.default.createElement(_VoiceRecordComposerTile.default, {
        key: "controls_voice_record",
        ref: this.voiceRecordingButton,
        room: this.props.room
      }));
    } else if (this.state.tombstone) {
      const replacementRoomId = this.state.tombstone.getContent()['replacement_room'];
      const continuesLink = replacementRoomId ? /*#__PURE__*/_react.default.createElement("a", {
        href: (0, _Permalinks.makeRoomPermalink)(replacementRoomId),
        className: "mx_MessageComposer_roomReplaced_link",
        onClick: this.onTombstoneClick
      }, (0, _languageHandler._t)("The conversation continues here.")) : '';
      controls.push( /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MessageComposer_replaced_wrapper",
        key: "room_replaced"
      }, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MessageComposer_replaced_valign"
      }, /*#__PURE__*/_react.default.createElement("img", {
        className: "mx_MessageComposer_roomReplaced_icon",
        src: require("../../../../res/img/room_replaced.svg")
      }), /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_MessageComposer_roomReplaced_header"
      }, (0, _languageHandler._t)("This room has been replaced and is no longer active.")), /*#__PURE__*/_react.default.createElement("br", null), continuesLink)));
    } else {
      controls.push( /*#__PURE__*/_react.default.createElement("div", {
        key: "controls_error",
        className: "mx_MessageComposer_noperm_error"
      }, (0, _languageHandler._t)('You do not have permission to post to this room')));
    }

    let recordingTooltip;
    const secondsLeft = Math.round(this.state.recordingTimeLeftSeconds);

    if (secondsLeft) {
      recordingTooltip = /*#__PURE__*/_react.default.createElement(_Tooltip.default, {
        label: (0, _languageHandler._t)("%(seconds)ss left", {
          seconds: secondsLeft
        }),
        alignment: _Tooltip.Alignment.Top,
        yOffset: -50
      });
    }

    controls.push( /*#__PURE__*/_react.default.createElement(_Stickerpicker.default, {
      room: this.props.room,
      showStickers: this.state.showStickers,
      setShowStickers: this.showStickers,
      menuPosition: menuPosition,
      key: "stickers"
    }));
    const showSendButton = !this.state.isComposerEmpty || this.state.haveRecording;
    const classes = (0, _classnames.default)({
      "mx_MessageComposer": true,
      "mx_GroupLayout": true,
      "mx_MessageComposer--compact": this.props.compact,
      "mx_MessageComposer_e2eStatus": this.props.e2eStatus != undefined
    });
    return /*#__PURE__*/_react.default.createElement("div", {
      className: classes,
      ref: this.ref
    }, recordingTooltip, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MessageComposer_wrapper"
    }, /*#__PURE__*/_react.default.createElement(_ReplyPreview.default, {
      replyToEvent: this.props.replyToEvent,
      permalinkCreator: this.props.permalinkCreator
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MessageComposer_row"
    }, controls, this.renderButtons(menuPosition), showSendButton && /*#__PURE__*/_react.default.createElement(SendButton, {
      key: "controls_send",
      onClick: this.sendMessage,
      title: this.state.haveRecording ? (0, _languageHandler._t)("Send voice message") : undefined
    }))));
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _RoomContext.default), (0, _defineProperty2.default)(_class2, "defaultProps", {
  compact: false
}), _temp)) || _class);
exports.default = MessageComposer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL01lc3NhZ2VDb21wb3Nlci50c3giXSwibmFtZXMiOlsiaW5zdGFuY2VDb3VudCIsIk5BUlJPV19NT0RFX0JSRUFLUE9JTlQiLCJDb21wb3NlckF2YXRhciIsInByb3BzIiwibWUiLCJTZW5kQnV0dG9uIiwib25DbGljayIsInRpdGxlIiwiRW1vamlCdXR0b24iLCJhZGRFbW9qaSIsIm1lbnVQb3NpdGlvbiIsIm5hcnJvd01vZGUiLCJtZW51RGlzcGxheWVkIiwiYnV0dG9uIiwib3Blbk1lbnUiLCJjbG9zZU1lbnUiLCJjb250ZXh0TWVudSIsInBvc2l0aW9uIiwiY3VycmVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImNsYXNzTmFtZSIsIlVwbG9hZEJ1dHRvbiIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJjcmVhdGVSZWYiLCJwYXlsb2FkIiwiYWN0aW9uIiwib25VcGxvYWRDbGljayIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsImlzR3Vlc3QiLCJkaXMiLCJkaXNwYXRjaCIsInVwbG9hZElucHV0IiwiY2xpY2siLCJldiIsInRhcmdldCIsImZpbGVzIiwibGVuZ3RoIiwidGZpbGVzIiwiaSIsInB1c2giLCJDb250ZW50TWVzc2FnZXMiLCJzaGFyZWRJbnN0YW5jZSIsInNlbmRDb250ZW50TGlzdFRvUm9vbSIsInJvb21JZCIsInJlbGF0aW9uIiwidmFsdWUiLCJkaXNwYXRjaGVyUmVmIiwicmVnaXN0ZXIiLCJvbkFjdGlvbiIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwidW5yZWdpc3RlciIsInJlbmRlciIsInVwbG9hZElucHV0U3R5bGUiLCJkaXNwbGF5Iiwib25VcGxvYWRGaWxlSW5wdXRDaGFuZ2UiLCJQb2xsQnV0dG9uIiwiUHVyZUNvbXBvbmVudCIsImNhblNlbmQiLCJyb29tIiwiY3VycmVudFN0YXRlIiwibWF5U2VuZEV2ZW50IiwiUE9MTF9TVEFSVF9FVkVOVF9UWVBFIiwibmFtZSIsImdldFVzZXJJZCIsIk1vZGFsIiwiY3JlYXRlVHJhY2tlZERpYWxvZyIsIkVycm9yRGlhbG9nIiwiZGVzY3JpcHRpb24iLCJQb2xsQ3JlYXRlRGlhbG9nIiwib25DcmVhdGVDbGljayIsIk1lc3NhZ2VDb21wb3NlciIsInR5cGUiLCJlbnRyeSIsIlVJX0VWRU5UUyIsIlJlc2l6ZSIsImNvbnRlbnRSZWN0Iiwid2lkdGgiLCJzZXRTdGF0ZSIsImlzTWVudU9wZW4iLCJzdGF0ZSIsInNob3dTdGlja2VycyIsImNvbnRleHQiLCJ0aW1lbGluZVJlbmRlcmluZ1R5cGUiLCJzZXRUaW1lb3V0IiwicmVzaXplTm90aWZpZXIiLCJub3RpZnlUaW1lbGluZUhlaWdodENoYW5nZWQiLCJnZXRSb29tSWQiLCJnZXRUeXBlIiwidG9tYnN0b25lIiwiZ2V0Um9vbVRvbWJzdG9uZSIsImNhblNlbmRNZXNzYWdlcyIsIm1heVNlbmRNZXNzYWdlIiwicHJldmVudERlZmF1bHQiLCJyZXBsYWNlbWVudFJvb21JZCIsImdldENvbnRlbnQiLCJyZXBsYWNlbWVudFJvb20iLCJnZXRSb29tIiwiY3JlYXRlRXZlbnRJZCIsImNyZWF0ZUV2ZW50IiwiZ2V0U3RhdGVFdmVudHMiLCJnZXRJZCIsInZpYVNlcnZlcnMiLCJnZXRTZW5kZXIiLCJzcGxpdCIsInNsaWNlIiwiam9pbiIsIkFjdGlvbiIsIlZpZXdSb29tIiwiaGlnaGxpZ2h0ZWQiLCJldmVudF9pZCIsInJvb21faWQiLCJhdXRvX2pvaW4iLCJfdHlwZSIsInZpYV9zZXJ2ZXJzIiwib3B0cyIsInJlcGx5VG9FdmVudCIsInJlcGx5aW5nVG9UaHJlYWQiLCJyZWxfdHlwZSIsIlJlbGF0aW9uVHlwZSIsIlRocmVhZCIsImUyZVN0YXR1cyIsImVtb2ppIiwiQ29tcG9zZXJJbnNlcnQiLCJ0ZXh0IiwiaGF2ZVJlY29yZGluZyIsInZvaWNlUmVjb3JkaW5nQnV0dG9uIiwic2VuZCIsIm1lc3NhZ2VDb21wb3NlcklucHV0Iiwic2VuZE1lc3NhZ2UiLCJtb2RlbCIsImlzQ29tcG9zZXJFbXB0eSIsImlzRW1wdHkiLCJyZWNvcmRpbmciLCJWb2ljZVJlY29yZGluZ1N0b3JlIiwiaW5zdGFuY2UiLCJhY3RpdmVSZWNvcmRpbmciLCJvbiIsIlJlY29yZGluZ1N0YXRlIiwiU3RhcnRlZCIsIkVuZGluZ1Nvb24iLCJzZWNvbmRzTGVmdCIsInJlY29yZGluZ1RpbWVMZWZ0U2Vjb25kcyIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsIlVJRmVhdHVyZSIsIldpZGdldHMiLCJVUERBVEVfRVZFTlQiLCJvblZvaWNlU3RvcmVVcGRhdGUiLCJpbnN0YW5jZUlkIiwiY29tcG9uZW50RGlkTW91bnQiLCJvblJvb21TdGF0ZUV2ZW50cyIsIndhaXRGb3JPd25NZW1iZXIiLCJVSVN0b3JlIiwidHJhY2tFbGVtZW50RGltZW5zaW9ucyIsInJlZiIsIm9uUmVzaXplIiwiZ2V0TWVtYmVyIiwibG9hZE1lbWJlcnNJZk5lZWRlZCIsInRoZW4iLCJyZW1vdmVMaXN0ZW5lciIsIm9mZiIsInN0b3BUcmFja2luZ0VsZW1lbnREaW1lbnNpb25zIiwicmVuZGVyQnV0dG9ucyIsInVwbG9hZEJ1dHRvbkluZGV4IiwiYnV0dG9ucyIsInNob3VsZFNob3dTdGlja2VyUGlja2VyIiwib25SZWNvcmRTdGFydEVuZENsaWNrIiwiY2xhc3NuYW1lcyIsIm14X01lc3NhZ2VDb21wb3Nlcl9idXR0b24iLCJteF9NZXNzYWdlQ29tcG9zZXJfYnV0dG9uTWVudSIsIm14X01lc3NhZ2VDb21wb3Nlcl9jbG9zZUJ1dHRvbk1lbnUiLCJ0b2dnbGVCdXR0b25NZW51IiwibWFwIiwiaW5kZXgiLCJjb250cm9scyIsImNvbXBhY3QiLCJyZW5kZXJQbGFjZWhvbGRlclRleHQiLCJwZXJtYWxpbmtDcmVhdG9yIiwib25DaGFuZ2UiLCJjb250aW51ZXNMaW5rIiwib25Ub21ic3RvbmVDbGljayIsInJlcXVpcmUiLCJyZWNvcmRpbmdUb29sdGlwIiwiTWF0aCIsInJvdW5kIiwic2Vjb25kcyIsIkFsaWdubWVudCIsIlRvcCIsInNob3dTZW5kQnV0dG9uIiwiY2xhc3NlcyIsInVuZGVmaW5lZCIsIlJvb21Db250ZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBZUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBSUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBTUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBRUEsSUFBSUEsYUFBYSxHQUFHLENBQXBCO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsR0FBL0I7O0FBTUEsU0FBU0MsY0FBVCxDQUF3QkMsS0FBeEIsRUFBcUQ7QUFDakQsc0JBQU87QUFBSyxJQUFBLFNBQVMsRUFBQztBQUFmLGtCQUNILDZCQUFDLGtDQUFEO0FBQTJCLElBQUEsTUFBTSxFQUFFQSxLQUFLLENBQUNDLEVBQXpDO0FBQTZDLElBQUEsS0FBSyxFQUFFLEVBQXBEO0FBQXdELElBQUEsTUFBTSxFQUFFO0FBQWhFLElBREcsQ0FBUDtBQUdIOztBQU9ELFNBQVNDLFVBQVQsQ0FBb0JGLEtBQXBCLEVBQTZDO0FBQ3pDLHNCQUNJLDZCQUFDLGdDQUFEO0FBQ0ksSUFBQSxTQUFTLEVBQUMsZ0NBRGQ7QUFFSSxJQUFBLE9BQU8sRUFBRUEsS0FBSyxDQUFDRyxPQUZuQjtBQUdJLElBQUEsS0FBSyxFQUFFSCxLQUFLLENBQUNJLEtBQU4sSUFBZSx5QkFBRyxjQUFIO0FBSDFCLElBREo7QUFPSDs7QUFRRCxNQUFNQyxXQUF3QyxHQUFHLENBQUM7QUFBRUMsRUFBQUEsUUFBRjtBQUFZQyxFQUFBQSxZQUFaO0FBQTBCQyxFQUFBQTtBQUExQixDQUFELEtBQTRDO0FBQ3pGLFFBQU0sQ0FBQ0MsYUFBRCxFQUFnQkMsTUFBaEIsRUFBd0JDLFFBQXhCLEVBQWtDQyxTQUFsQyxJQUErQyxrQ0FBckQ7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SixDQURKO0FBcUJIOztBQS9ad0UsQyx3REFPcERDLG9CLDBEQUdDO0FBQ2xCaEIsRUFBQUEsT0FBTyxFQUFFO0FBRFMsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxNS0yMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cbmltcG9ydCBSZWFjdCwgeyBjcmVhdGVSZWYgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gJy4uLy4uLy4uL01hdHJpeENsaWVudFBlZyc7XG5pbXBvcnQgeyBNYXRyaXhFdmVudCwgSUV2ZW50UmVsYXRpb24gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50XCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5pbXBvcnQgeyBSb29tTWVtYmVyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tLW1lbWJlclwiO1xuaW1wb3J0IGRpcyBmcm9tICcuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXInO1xuaW1wb3J0IHsgQWN0aW9uUGF5bG9hZCB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL3BheWxvYWRzXCI7XG5pbXBvcnQgU3RpY2tlcnBpY2tlciBmcm9tICcuL1N0aWNrZXJwaWNrZXInO1xuaW1wb3J0IHsgbWFrZVJvb21QZXJtYWxpbmssIFJvb21QZXJtYWxpbmtDcmVhdG9yIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvcGVybWFsaW5rcy9QZXJtYWxpbmtzJztcbmltcG9ydCBDb250ZW50TWVzc2FnZXMgZnJvbSAnLi4vLi4vLi4vQ29udGVudE1lc3NhZ2VzJztcbmltcG9ydCBFMkVJY29uIGZyb20gJy4vRTJFSWNvbic7XG5pbXBvcnQgU2V0dGluZ3NTdG9yZSBmcm9tIFwiLi4vLi4vLi4vc2V0dGluZ3MvU2V0dGluZ3NTdG9yZVwiO1xuaW1wb3J0IENvbnRleHRNZW51LCB7XG4gICAgYWJvdmVMZWZ0T2YsXG4gICAgdXNlQ29udGV4dE1lbnUsXG4gICAgTWVudUl0ZW0sXG4gICAgQWJvdmVMZWZ0T2YsXG59IGZyb20gXCIuLi8uLi9zdHJ1Y3R1cmVzL0NvbnRleHRNZW51XCI7XG5pbXBvcnQgQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVUb29sdGlwQnV0dG9uXCI7XG5pbXBvcnQgUmVwbHlQcmV2aWV3IGZyb20gXCIuL1JlcGx5UHJldmlld1wiO1xuaW1wb3J0IHsgVUlGZWF0dXJlIH0gZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL1VJRmVhdHVyZVwiO1xuaW1wb3J0IHsgVVBEQVRFX0VWRU5UIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9Bc3luY1N0b3JlXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IFZvaWNlUmVjb3JkQ29tcG9zZXJUaWxlIGZyb20gXCIuL1ZvaWNlUmVjb3JkQ29tcG9zZXJUaWxlXCI7XG5pbXBvcnQgeyBWb2ljZVJlY29yZGluZ1N0b3JlIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9Wb2ljZVJlY29yZGluZ1N0b3JlXCI7XG5pbXBvcnQgeyBSZWNvcmRpbmdTdGF0ZSB9IGZyb20gXCIuLi8uLi8uLi9hdWRpby9Wb2ljZVJlY29yZGluZ1wiO1xuaW1wb3J0IFRvb2x0aXAsIHsgQWxpZ25tZW50IH0gZnJvbSBcIi4uL2VsZW1lbnRzL1Rvb2x0aXBcIjtcbmltcG9ydCBSZXNpemVOb3RpZmllciBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvUmVzaXplTm90aWZpZXJcIjtcbmltcG9ydCB7IEUyRVN0YXR1cyB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL1NoaWVsZFV0aWxzJztcbmltcG9ydCBTZW5kTWVzc2FnZUNvbXBvc2VyLCB7IFNlbmRNZXNzYWdlQ29tcG9zZXIgYXMgU2VuZE1lc3NhZ2VDb21wb3NlckNsYXNzIH0gZnJvbSBcIi4vU2VuZE1lc3NhZ2VDb21wb3NlclwiO1xuaW1wb3J0IHsgQ29tcG9zZXJJbnNlcnRQYXlsb2FkIH0gZnJvbSBcIi4uLy4uLy4uL2Rpc3BhdGNoZXIvcGF5bG9hZHMvQ29tcG9zZXJJbnNlcnRQYXlsb2FkXCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zXCI7XG5pbXBvcnQgRWRpdG9yTW9kZWwgZnJvbSBcIi4uLy4uLy4uL2VkaXRvci9tb2RlbFwiO1xuaW1wb3J0IEVtb2ppUGlja2VyIGZyb20gJy4uL2Vtb2ppcGlja2VyL0Vtb2ppUGlja2VyJztcbmltcG9ydCBNZW1iZXJTdGF0dXNNZXNzYWdlQXZhdGFyIGZyb20gXCIuLi9hdmF0YXJzL01lbWJlclN0YXR1c01lc3NhZ2VBdmF0YXJcIjtcbmltcG9ydCBVSVN0b3JlLCB7IFVJX0VWRU5UUyB9IGZyb20gJy4uLy4uLy4uL3N0b3Jlcy9VSVN0b3JlJztcbmltcG9ydCBNb2RhbCBmcm9tIFwiLi4vLi4vLi4vTW9kYWxcIjtcbmltcG9ydCB7IFJlbGF0aW9uVHlwZSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL0B0eXBlcy9ldmVudCc7XG5pbXBvcnQgUm9vbUNvbnRleHQgZnJvbSAnLi4vLi4vLi4vY29udGV4dHMvUm9vbUNvbnRleHQnO1xuaW1wb3J0IHsgUE9MTF9TVEFSVF9FVkVOVF9UWVBFIH0gZnJvbSBcIi4uLy4uLy4uL3BvbGxzL2NvbnN0c1wiO1xuaW1wb3J0IEVycm9yRGlhbG9nIGZyb20gXCIuLi9kaWFsb2dzL0Vycm9yRGlhbG9nXCI7XG5pbXBvcnQgUG9sbENyZWF0ZURpYWxvZyBmcm9tIFwiLi4vZWxlbWVudHMvUG9sbENyZWF0ZURpYWxvZ1wiO1xuXG5sZXQgaW5zdGFuY2VDb3VudCA9IDA7XG5jb25zdCBOQVJST1dfTU9ERV9CUkVBS1BPSU5UID0gNTAwO1xuXG5pbnRlcmZhY2UgSUNvbXBvc2VyQXZhdGFyUHJvcHMge1xuICAgIG1lOiBSb29tTWVtYmVyO1xufVxuXG5mdW5jdGlvbiBDb21wb3NlckF2YXRhcihwcm9wczogSUNvbXBvc2VyQXZhdGFyUHJvcHMpIHtcbiAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJteF9NZXNzYWdlQ29tcG9zZXJfYXZhdGFyXCI+XG4gICAgICAgIDxNZW1iZXJTdGF0dXNNZXNzYWdlQXZhdGFyIG1lbWJlcj17cHJvcHMubWV9IHdpZHRoPXsyNH0gaGVpZ2h0PXsyNH0gLz5cbiAgICA8L2Rpdj47XG59XG5cbmludGVyZmFjZSBJU2VuZEJ1dHRvblByb3BzIHtcbiAgICBvbkNsaWNrOiAoKSA9PiB2b2lkO1xuICAgIHRpdGxlPzogc3RyaW5nOyAvLyBkZWZhdWx0cyB0byBzb21ldGhpbmcgZ2VuZXJpY1xufVxuXG5mdW5jdGlvbiBTZW5kQnV0dG9uKHByb3BzOiBJU2VuZEJ1dHRvblByb3BzKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgPEFjY2Vzc2libGVUb29sdGlwQnV0dG9uXG4gICAgICAgICAgICBjbGFzc05hbWU9XCJteF9NZXNzYWdlQ29tcG9zZXJfc2VuZE1lc3NhZ2VcIlxuICAgICAgICAgICAgb25DbGljaz17cHJvcHMub25DbGlja31cbiAgICAgICAgICAgIHRpdGxlPXtwcm9wcy50aXRsZSA/PyBfdCgnU2VuZCBtZXNzYWdlJyl9XG4gICAgICAgIC8+XG4gICAgKTtcbn1cblxuaW50ZXJmYWNlIElFbW9qaUJ1dHRvblByb3BzIHtcbiAgICBhZGRFbW9qaTogKHVuaWNvZGU6IHN0cmluZykgPT4gYm9vbGVhbjtcbiAgICBtZW51UG9zaXRpb246IGFueTsgLy8gVE9ETzogVHlwZXNcbiAgICBuYXJyb3dNb2RlOiBib29sZWFuO1xufVxuXG5jb25zdCBFbW9qaUJ1dHRvbjogUmVhY3QuRkM8SUVtb2ppQnV0dG9uUHJvcHM+ID0gKHsgYWRkRW1vamksIG1lbnVQb3NpdGlvbiwgbmFycm93TW9kZSB9KSA9PiB7XG4gICAgY29uc3QgW21lbnVEaXNwbGF5ZWQsIGJ1dHRvbiwgb3Blbk1lbnUsIGNsb3NlTWVudV0gPSB1c2VDb250ZXh0TWVudSgpO1xuXG4gICAgbGV0IGNvbnRleHRNZW51O1xuICAgIGlmIChtZW51RGlzcGxheWVkKSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbWVudVBvc2l0aW9uID8/IGFib3ZlTGVmdE9mKGJ1dHRvbi5jdXJyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKTtcbiAgICAgICAgY29udGV4dE1lbnUgPSA8Q29udGV4dE1lbnUgey4uLnBvc2l0aW9ufSBvbkZpbmlzaGVkPXtjbG9zZU1lbnV9IG1hbmFnZWQ9e2ZhbHNlfT5cbiAgICAgICAgICAgIDxFbW9qaVBpY2tlciBvbkNob29zZT17YWRkRW1vaml9IHNob3dRdWlja1JlYWN0aW9ucz17dHJ1ZX0gLz5cbiAgICAgICAgPC9Db250ZXh0TWVudT47XG4gICAgfVxuXG4gICAgY29uc3QgY2xhc3NOYW1lID0gY2xhc3NOYW1lcyhcbiAgICAgICAgXCJteF9NZXNzYWdlQ29tcG9zZXJfYnV0dG9uXCIsXG4gICAgICAgIFwibXhfTWVzc2FnZUNvbXBvc2VyX2Vtb2ppXCIsXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwibXhfTWVzc2FnZUNvbXBvc2VyX2J1dHRvbl9oaWdobGlnaHRcIjogbWVudURpc3BsYXllZCxcbiAgICAgICAgfSxcbiAgICApO1xuXG4gICAgLy8gVE9ETzogcmVwbGFjZSBDb250ZXh0TWVudVRvb2x0aXBCdXR0b24gd2l0aCBhIHVuaWZpZWQgcmVwcmVzZW50YXRpb24gb2ZcbiAgICAvLyB0aGUgaGVhZGVyIGJ1dHRvbnMgYW5kIHRoZSByaWdodCBwYW5lbCBidXR0b25zXG4gICAgcmV0dXJuIDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgPEFjY2Vzc2libGVUb29sdGlwQnV0dG9uXG4gICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cbiAgICAgICAgICAgIG9uQ2xpY2s9e29wZW5NZW51fVxuICAgICAgICAgICAgdGl0bGU9eyFuYXJyb3dNb2RlICYmIF90KCdFbW9qaSBwaWNrZXInKX1cbiAgICAgICAgICAgIGxhYmVsPXtuYXJyb3dNb2RlID8gX3QoXCJBZGQgZW1vamlcIikgOiBudWxsfVxuICAgICAgICAvPlxuXG4gICAgICAgIHsgY29udGV4dE1lbnUgfVxuICAgIDwvUmVhY3QuRnJhZ21lbnQ+O1xufTtcblxuaW50ZXJmYWNlIElVcGxvYWRCdXR0b25Qcm9wcyB7XG4gICAgcm9vbUlkOiBzdHJpbmc7XG4gICAgcmVsYXRpb24/OiBJRXZlbnRSZWxhdGlvbiB8IG51bGw7XG59XG5cbmNsYXNzIFVwbG9hZEJ1dHRvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJVXBsb2FkQnV0dG9uUHJvcHM+IHtcbiAgICBwcml2YXRlIHVwbG9hZElucHV0ID0gUmVhY3QuY3JlYXRlUmVmPEhUTUxJbnB1dEVsZW1lbnQ+KCk7XG4gICAgcHJpdmF0ZSBkaXNwYXRjaGVyUmVmOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5kaXNwYXRjaGVyUmVmID0gZGlzLnJlZ2lzdGVyKHRoaXMub25BY3Rpb24pO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBkaXMudW5yZWdpc3Rlcih0aGlzLmRpc3BhdGNoZXJSZWYpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25BY3Rpb24gPSAocGF5bG9hZDogQWN0aW9uUGF5bG9hZCkgPT4ge1xuICAgICAgICBpZiAocGF5bG9hZC5hY3Rpb24gPT09IFwidXBsb2FkX2ZpbGVcIikge1xuICAgICAgICAgICAgdGhpcy5vblVwbG9hZENsaWNrKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblVwbG9hZENsaWNrID0gKCkgPT4ge1xuICAgICAgICBpZiAoTWF0cml4Q2xpZW50UGVnLmdldCgpLmlzR3Vlc3QoKSkge1xuICAgICAgICAgICAgZGlzLmRpc3BhdGNoKHsgYWN0aW9uOiAncmVxdWlyZV9yZWdpc3RyYXRpb24nIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBsb2FkSW5wdXQuY3VycmVudC5jbGljaygpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uVXBsb2FkRmlsZUlucHV0Q2hhbmdlID0gKGV2OiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgICAgICBpZiAoZXYudGFyZ2V0LmZpbGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgICAgIC8vIHRha2UgYSBjb3B5IHNvIHdlIGNhbiBzYWZlbHkgcmVzZXQgdGhlIHZhbHVlIG9mIHRoZSBmb3JtIGNvbnRyb2xcbiAgICAgICAgLy8gKE5vdGUgaXQgaXMgYSBGaWxlTGlzdDogd2UgY2FuJ3QgdXNlIHNsaWNlIG9yIHNlbnNpYmxlIGl0ZXJhdGlvbikuXG4gICAgICAgIGNvbnN0IHRmaWxlcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2LnRhcmdldC5maWxlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdGZpbGVzLnB1c2goZXYudGFyZ2V0LmZpbGVzW2ldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIENvbnRlbnRNZXNzYWdlcy5zaGFyZWRJbnN0YW5jZSgpLnNlbmRDb250ZW50TGlzdFRvUm9vbShcbiAgICAgICAgICAgIHRmaWxlcywgdGhpcy5wcm9wcy5yb29tSWQsIHRoaXMucHJvcHMucmVsYXRpb24sIE1hdHJpeENsaWVudFBlZy5nZXQoKSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBUaGlzIGlzIHRoZSBvbkNoYW5nZSBoYW5kbGVyIGZvciBhIGZpbGUgZm9ybSBjb250cm9sLCBidXQgd2UncmVcbiAgICAgICAgLy8gbm90IGtlZXBpbmcgYW55IHN0YXRlLCBzbyByZXNldCB0aGUgdmFsdWUgb2YgdGhlIGZvcm0gY29udHJvbFxuICAgICAgICAvLyB0byBlbXB0eS5cbiAgICAgICAgLy8gTkIuIHdlIG5lZWQgdG8gc2V0ICd2YWx1ZSc6IHRoZSAnZmlsZXMnIHByb3BlcnR5IGlzIGltbXV0YWJsZS5cbiAgICAgICAgZXYudGFyZ2V0LnZhbHVlID0gJyc7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgdXBsb2FkSW5wdXRTdHlsZSA9IHsgZGlzcGxheTogJ25vbmUnIH07XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9NZXNzYWdlQ29tcG9zZXJfYnV0dG9uIG14X01lc3NhZ2VDb21wb3Nlcl91cGxvYWRcIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25VcGxvYWRDbGlja31cbiAgICAgICAgICAgICAgICB0aXRsZT17X3QoJ1VwbG9hZCBmaWxlJyl9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgICAgIHJlZj17dGhpcy51cGxvYWRJbnB1dH1cbiAgICAgICAgICAgICAgICAgICAgdHlwZT1cImZpbGVcIlxuICAgICAgICAgICAgICAgICAgICBzdHlsZT17dXBsb2FkSW5wdXRTdHlsZX1cbiAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGVcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25VcGxvYWRGaWxlSW5wdXRDaGFuZ2V9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24+XG4gICAgICAgICk7XG4gICAgfVxufVxuXG5pbnRlcmZhY2UgSVBvbGxCdXR0b25Qcm9wcyB7XG4gICAgcm9vbTogUm9vbTtcbn1cblxuY2xhc3MgUG9sbEJ1dHRvbiBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SVBvbGxCdXR0b25Qcm9wcz4ge1xuICAgIHByaXZhdGUgb25DcmVhdGVDbGljayA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgY2FuU2VuZCA9IHRoaXMucHJvcHMucm9vbS5jdXJyZW50U3RhdGUubWF5U2VuZEV2ZW50KFxuICAgICAgICAgICAgUE9MTF9TVEFSVF9FVkVOVF9UWVBFLm5hbWUsXG4gICAgICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0VXNlcklkKCksXG4gICAgICAgICk7XG4gICAgICAgIGlmICghY2FuU2VuZCkge1xuICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnUG9sbHMnLCAncGVybWlzc2lvbnMgZXJyb3I6IGNhbm5vdCBzdGFydCcsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IF90KFwiUGVybWlzc2lvbiBSZXF1aXJlZFwiKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXCJZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBzdGFydCBwb2xscyBpbiB0aGlzIHJvb20uXCIpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKFxuICAgICAgICAgICAgICAgICdQb2xscycsXG4gICAgICAgICAgICAgICAgJ2NyZWF0ZScsXG4gICAgICAgICAgICAgICAgUG9sbENyZWF0ZURpYWxvZyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJvb206IHRoaXMucHJvcHMucm9vbSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICdteF9Db21wb3VuZERpYWxvZycsXG4gICAgICAgICAgICAgICAgZmFsc2UsIC8vIGlzUHJpb3JpdHlNb2RhbFxuICAgICAgICAgICAgICAgIHRydWUsICAvLyBpc1N0YXRpY01vZGFsXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb21wb3Nlcl9idXR0b24gbXhfTWVzc2FnZUNvbXBvc2VyX3BvbGxcIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25DcmVhdGVDbGlja31cbiAgICAgICAgICAgICAgICB0aXRsZT17X3QoJ0NyZWF0ZSBwb2xsJyl9XG4gICAgICAgICAgICAvPlxuICAgICAgICApO1xuICAgIH1cbn1cblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgcm9vbTogUm9vbTtcbiAgICByZXNpemVOb3RpZmllcjogUmVzaXplTm90aWZpZXI7XG4gICAgcGVybWFsaW5rQ3JlYXRvcjogUm9vbVBlcm1hbGlua0NyZWF0b3I7XG4gICAgcmVwbHlUb0V2ZW50PzogTWF0cml4RXZlbnQ7XG4gICAgcmVsYXRpb24/OiBJRXZlbnRSZWxhdGlvbjtcbiAgICBlMmVTdGF0dXM/OiBFMkVTdGF0dXM7XG4gICAgY29tcGFjdD86IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHRvbWJzdG9uZTogTWF0cml4RXZlbnQ7XG4gICAgY2FuU2VuZE1lc3NhZ2VzOiBib29sZWFuO1xuICAgIGlzQ29tcG9zZXJFbXB0eTogYm9vbGVhbjtcbiAgICBoYXZlUmVjb3JkaW5nOiBib29sZWFuO1xuICAgIHJlY29yZGluZ1RpbWVMZWZ0U2Vjb25kcz86IG51bWJlcjtcbiAgICBtZT86IFJvb21NZW1iZXI7XG4gICAgbmFycm93TW9kZT86IGJvb2xlYW47XG4gICAgaXNNZW51T3BlbjogYm9vbGVhbjtcbiAgICBzaG93U3RpY2tlcnM6IGJvb2xlYW47XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLnJvb21zLk1lc3NhZ2VDb21wb3NlclwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVzc2FnZUNvbXBvc2VyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBkaXNwYXRjaGVyUmVmOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBtZXNzYWdlQ29tcG9zZXJJbnB1dCA9IGNyZWF0ZVJlZjxTZW5kTWVzc2FnZUNvbXBvc2VyQ2xhc3M+KCk7XG4gICAgcHJpdmF0ZSB2b2ljZVJlY29yZGluZ0J1dHRvbiA9IGNyZWF0ZVJlZjxWb2ljZVJlY29yZENvbXBvc2VyVGlsZT4oKTtcbiAgICBwcml2YXRlIHJlZjogUmVhY3QuUmVmT2JqZWN0PEhUTUxEaXZFbGVtZW50PiA9IGNyZWF0ZVJlZigpO1xuICAgIHByaXZhdGUgaW5zdGFuY2VJZDogbnVtYmVyO1xuXG4gICAgc3RhdGljIGNvbnRleHRUeXBlID0gUm9vbUNvbnRleHQ7XG4gICAgcHVibGljIGNvbnRleHQhOiBSZWFjdC5Db250ZXh0VHlwZTx0eXBlb2YgUm9vbUNvbnRleHQ+O1xuXG4gICAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICAgICAgY29tcGFjdDogZmFsc2UsXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgVm9pY2VSZWNvcmRpbmdTdG9yZS5pbnN0YW5jZS5vbihVUERBVEVfRVZFTlQsIHRoaXMub25Wb2ljZVN0b3JlVXBkYXRlKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgdG9tYnN0b25lOiB0aGlzLmdldFJvb21Ub21ic3RvbmUoKSxcbiAgICAgICAgICAgIGNhblNlbmRNZXNzYWdlczogdGhpcy5wcm9wcy5yb29tLm1heVNlbmRNZXNzYWdlKCksXG4gICAgICAgICAgICBpc0NvbXBvc2VyRW1wdHk6IHRydWUsXG4gICAgICAgICAgICBoYXZlUmVjb3JkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIHJlY29yZGluZ1RpbWVMZWZ0U2Vjb25kczogbnVsbCwgLy8gd2hlbiBzZXQgdG8gYSBudW1iZXIsIHNob3dzIGEgdG9hc3RcbiAgICAgICAgICAgIGlzTWVudU9wZW46IGZhbHNlLFxuICAgICAgICAgICAgc2hvd1N0aWNrZXJzOiBmYWxzZSxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmluc3RhbmNlSWQgPSBpbnN0YW5jZUNvdW50Kys7XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hlclJlZiA9IGRpcy5yZWdpc3Rlcih0aGlzLm9uQWN0aW9uKTtcbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLm9uKFwiUm9vbVN0YXRlLmV2ZW50c1wiLCB0aGlzLm9uUm9vbVN0YXRlRXZlbnRzKTtcbiAgICAgICAgdGhpcy53YWl0Rm9yT3duTWVtYmVyKCk7XG4gICAgICAgIFVJU3RvcmUuaW5zdGFuY2UudHJhY2tFbGVtZW50RGltZW5zaW9ucyhgTWVzc2FnZUNvbXBvc2VyJHt0aGlzLmluc3RhbmNlSWR9YCwgdGhpcy5yZWYuY3VycmVudCk7XG4gICAgICAgIFVJU3RvcmUuaW5zdGFuY2Uub24oYE1lc3NhZ2VDb21wb3NlciR7dGhpcy5pbnN0YW5jZUlkfWAsIHRoaXMub25SZXNpemUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25SZXNpemUgPSAodHlwZTogVUlfRVZFTlRTLCBlbnRyeTogUmVzaXplT2JzZXJ2ZXJFbnRyeSkgPT4ge1xuICAgICAgICBpZiAodHlwZSA9PT0gVUlfRVZFTlRTLlJlc2l6ZSkge1xuICAgICAgICAgICAgY29uc3QgbmFycm93TW9kZSA9IGVudHJ5LmNvbnRlbnRSZWN0LndpZHRoIDw9IE5BUlJPV19NT0RFX0JSRUFLUE9JTlQ7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBuYXJyb3dNb2RlLFxuICAgICAgICAgICAgICAgIGlzTWVudU9wZW46ICFuYXJyb3dNb2RlID8gZmFsc2UgOiB0aGlzLnN0YXRlLmlzTWVudU9wZW4sXG4gICAgICAgICAgICAgICAgc2hvd1N0aWNrZXJzOiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25BY3Rpb24gPSAocGF5bG9hZDogQWN0aW9uUGF5bG9hZCkgPT4ge1xuICAgICAgICBpZiAocGF5bG9hZC5hY3Rpb24gPT09ICdyZXBseV90b19ldmVudCcgJiYgcGF5bG9hZC5jb250ZXh0ID09PSB0aGlzLmNvbnRleHQudGltZWxpbmVSZW5kZXJpbmdUeXBlKSB7XG4gICAgICAgICAgICAvLyBhZGQgYSB0aW1lb3V0IGZvciB0aGUgcmVwbHkgcHJldmlldyB0byBiZSByZW5kZXJlZCwgc29cbiAgICAgICAgICAgIC8vIHRoYXQgdGhlIFNjcm9sbFBhbmVsIGxpc3RlbmluZyB0byB0aGUgcmVzaXplTm90aWZpZXIgY2FuXG4gICAgICAgICAgICAvLyBjb3JyZWN0bHkgbWVhc3VyZSBpdCdzIG5ldyBoZWlnaHQgYW5kIHNjcm9sbCBkb3duIHRvIGtlZXBcbiAgICAgICAgICAgIC8vIGF0IHRoZSBib3R0b20gaWYgaXQgYWxyZWFkeSBpc1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5yZXNpemVOb3RpZmllci5ub3RpZnlUaW1lbGluZUhlaWdodENoYW5nZWQoKTtcbiAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSB3YWl0Rm9yT3duTWVtYmVyKCkge1xuICAgICAgICAvLyBpZiB3ZSBoYXZlIHRoZSBtZW1iZXIgYWxyZWFkeSwgZG8gdGhhdFxuICAgICAgICBjb25zdCBtZSA9IHRoaXMucHJvcHMucm9vbS5nZXRNZW1iZXIoTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFVzZXJJZCgpKTtcbiAgICAgICAgaWYgKG1lKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgbWUgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gT3RoZXJ3aXNlLCB3YWl0IGZvciBtZW1iZXIgbG9hZGluZyB0byBmaW5pc2ggYW5kIHRoZW4gdXBkYXRlIHRoZSBtZW1iZXIgZm9yIHRoZSBhdmF0YXIuXG4gICAgICAgIC8vIFRoZSBtZW1iZXJzIHNob3VsZCBhbHJlYWR5IGJlIGxvYWRpbmcsIGFuZCBsb2FkTWVtYmVyc0lmTmVlZGVkXG4gICAgICAgIC8vIHdpbGwgcmV0dXJuIHRoZSBwcm9taXNlIGZvciB0aGUgZXhpc3Rpbmcgb3BlcmF0aW9uXG4gICAgICAgIHRoaXMucHJvcHMucm9vbS5sb2FkTWVtYmVyc0lmTmVlZGVkKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtZSA9IHRoaXMucHJvcHMucm9vbS5nZXRNZW1iZXIoTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFVzZXJJZCgpKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBtZSB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGlmIChNYXRyaXhDbGllbnRQZWcuZ2V0KCkpIHtcbiAgICAgICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5yZW1vdmVMaXN0ZW5lcihcIlJvb21TdGF0ZS5ldmVudHNcIiwgdGhpcy5vblJvb21TdGF0ZUV2ZW50cyk7XG4gICAgICAgIH1cbiAgICAgICAgVm9pY2VSZWNvcmRpbmdTdG9yZS5pbnN0YW5jZS5vZmYoVVBEQVRFX0VWRU5ULCB0aGlzLm9uVm9pY2VTdG9yZVVwZGF0ZSk7XG4gICAgICAgIGRpcy51bnJlZ2lzdGVyKHRoaXMuZGlzcGF0Y2hlclJlZik7XG4gICAgICAgIFVJU3RvcmUuaW5zdGFuY2Uuc3RvcFRyYWNraW5nRWxlbWVudERpbWVuc2lvbnMoYE1lc3NhZ2VDb21wb3NlciR7dGhpcy5pbnN0YW5jZUlkfWApO1xuICAgICAgICBVSVN0b3JlLmluc3RhbmNlLnJlbW92ZUxpc3RlbmVyKGBNZXNzYWdlQ29tcG9zZXIke3RoaXMuaW5zdGFuY2VJZH1gLCB0aGlzLm9uUmVzaXplKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uUm9vbVN0YXRlRXZlbnRzID0gKGV2LCBzdGF0ZSkgPT4ge1xuICAgICAgICBpZiAoZXYuZ2V0Um9vbUlkKCkgIT09IHRoaXMucHJvcHMucm9vbS5yb29tSWQpIHJldHVybjtcblxuICAgICAgICBpZiAoZXYuZ2V0VHlwZSgpID09PSAnbS5yb29tLnRvbWJzdG9uZScpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyB0b21ic3RvbmU6IHRoaXMuZ2V0Um9vbVRvbWJzdG9uZSgpIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChldi5nZXRUeXBlKCkgPT09ICdtLnJvb20ucG93ZXJfbGV2ZWxzJykge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGNhblNlbmRNZXNzYWdlczogdGhpcy5wcm9wcy5yb29tLm1heVNlbmRNZXNzYWdlKCkgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBnZXRSb29tVG9tYnN0b25lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5yb29tLmN1cnJlbnRTdGF0ZS5nZXRTdGF0ZUV2ZW50cygnbS5yb29tLnRvbWJzdG9uZScsICcnKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uVG9tYnN0b25lQ2xpY2sgPSAoZXYpID0+IHtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBjb25zdCByZXBsYWNlbWVudFJvb21JZCA9IHRoaXMuc3RhdGUudG9tYnN0b25lLmdldENvbnRlbnQoKVsncmVwbGFjZW1lbnRfcm9vbSddO1xuICAgICAgICBjb25zdCByZXBsYWNlbWVudFJvb20gPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0Um9vbShyZXBsYWNlbWVudFJvb21JZCk7XG4gICAgICAgIGxldCBjcmVhdGVFdmVudElkID0gbnVsbDtcbiAgICAgICAgaWYgKHJlcGxhY2VtZW50Um9vbSkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlRXZlbnQgPSByZXBsYWNlbWVudFJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKCdtLnJvb20uY3JlYXRlJywgJycpO1xuICAgICAgICAgICAgaWYgKGNyZWF0ZUV2ZW50ICYmIGNyZWF0ZUV2ZW50LmdldElkKCkpIGNyZWF0ZUV2ZW50SWQgPSBjcmVhdGVFdmVudC5nZXRJZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdmlhU2VydmVycyA9IFt0aGlzLnN0YXRlLnRvbWJzdG9uZS5nZXRTZW5kZXIoKS5zcGxpdCgnOicpLnNsaWNlKDEpLmpvaW4oJzonKV07XG4gICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3Um9vbSxcbiAgICAgICAgICAgIGhpZ2hsaWdodGVkOiB0cnVlLFxuICAgICAgICAgICAgZXZlbnRfaWQ6IGNyZWF0ZUV2ZW50SWQsXG4gICAgICAgICAgICByb29tX2lkOiByZXBsYWNlbWVudFJvb21JZCxcbiAgICAgICAgICAgIGF1dG9fam9pbjogdHJ1ZSxcbiAgICAgICAgICAgIF90eXBlOiBcInRvbWJzdG9uZVwiLCAvLyBpbnN0cnVtZW50YXRpb25cblxuICAgICAgICAgICAgLy8gVHJ5IHRvIGpvaW4gdmlhIHRoZSBzZXJ2ZXIgdGhhdCBzZW50IHRoZSBldmVudC4gVGhpcyBjb252ZXJ0cyBAc29tZXRoaW5nOmV4YW1wbGUub3JnXG4gICAgICAgICAgICAvLyBpbnRvIGEgc2VydmVyIGRvbWFpbiBieSBzcGxpdHRpbmcgb24gY29sb25zIGFuZCBpZ25vcmluZyB0aGUgZmlyc3QgZW50cnkgKFwiQHNvbWV0aGluZ1wiKS5cbiAgICAgICAgICAgIHZpYV9zZXJ2ZXJzOiB2aWFTZXJ2ZXJzLFxuICAgICAgICAgICAgb3B0czoge1xuICAgICAgICAgICAgICAgIC8vIFRoZXNlIGFyZSBwYXNzZWQgZG93biB0byB0aGUganMtc2RrJ3MgL2pvaW4gY2FsbFxuICAgICAgICAgICAgICAgIHZpYVNlcnZlcnM6IHZpYVNlcnZlcnMsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZW5kZXJQbGFjZWhvbGRlclRleHQgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlcGx5VG9FdmVudCkge1xuICAgICAgICAgICAgY29uc3QgcmVwbHlpbmdUb1RocmVhZCA9IHRoaXMucHJvcHMucmVsYXRpb24/LnJlbF90eXBlID09PSBSZWxhdGlvblR5cGUuVGhyZWFkO1xuICAgICAgICAgICAgaWYgKHJlcGx5aW5nVG9UaHJlYWQgJiYgdGhpcy5wcm9wcy5lMmVTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3QoJ1JlcGx5IHRvIGVuY3J5cHRlZCB0aHJlYWTigKYnKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVwbHlpbmdUb1RocmVhZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdCgnUmVwbHkgdG8gdGhyZWFk4oCmJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMuZTJlU3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90KCdTZW5kIGFuIGVuY3J5cHRlZCByZXBseeKApicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3QoJ1NlbmQgYSByZXBseeKApicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuZTJlU3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90KCdTZW5kIGFuIGVuY3J5cHRlZCBtZXNzYWdl4oCmJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdCgnU2VuZCBhIG1lc3NhZ2XigKYnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGFkZEVtb2ppID0gKGVtb2ppOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICAgICAgZGlzLmRpc3BhdGNoPENvbXBvc2VySW5zZXJ0UGF5bG9hZD4oe1xuICAgICAgICAgICAgYWN0aW9uOiBBY3Rpb24uQ29tcG9zZXJJbnNlcnQsXG4gICAgICAgICAgICB0ZXh0OiBlbW9qaSxcbiAgICAgICAgICAgIHRpbWVsaW5lUmVuZGVyaW5nVHlwZTogdGhpcy5jb250ZXh0LnRpbWVsaW5lUmVuZGVyaW5nVHlwZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHNlbmRNZXNzYWdlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5oYXZlUmVjb3JkaW5nICYmIHRoaXMudm9pY2VSZWNvcmRpbmdCdXR0b24uY3VycmVudCkge1xuICAgICAgICAgICAgLy8gVGhlcmUgc2hvdWxkbid0IGJlIGFueSB0ZXh0IG1lc3NhZ2UgdG8gc2VuZCB3aGVuIGEgdm9pY2UgcmVjb3JkaW5nIGlzIGFjdGl2ZSwgc29cbiAgICAgICAgICAgIC8vIGp1c3Qgc2VuZCBvdXQgdGhlIHZvaWNlIHJlY29yZGluZy5cbiAgICAgICAgICAgIGF3YWl0IHRoaXMudm9pY2VSZWNvcmRpbmdCdXR0b24uY3VycmVudD8uc2VuZCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tZXNzYWdlQ29tcG9zZXJJbnB1dC5jdXJyZW50Py5zZW5kTWVzc2FnZSgpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQ2hhbmdlID0gKG1vZGVsOiBFZGl0b3JNb2RlbCkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGlzQ29tcG9zZXJFbXB0eTogbW9kZWwuaXNFbXB0eSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Wb2ljZVN0b3JlVXBkYXRlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCByZWNvcmRpbmcgPSBWb2ljZVJlY29yZGluZ1N0b3JlLmluc3RhbmNlLmFjdGl2ZVJlY29yZGluZztcbiAgICAgICAgaWYgKHJlY29yZGluZykge1xuICAgICAgICAgICAgLy8gRGVsYXkgc2F5aW5nIHdlIGhhdmUgYSByZWNvcmRpbmcgdW50aWwgaXQgaXMgc3RhcnRlZCwgYXMgd2UgbWlnaHQgbm90IHlldCBoYXZlIEEvViBwZXJtaXNzaW9uc1xuICAgICAgICAgICAgcmVjb3JkaW5nLm9uKFJlY29yZGluZ1N0YXRlLlN0YXJ0ZWQsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaGF2ZVJlY29yZGluZzogISFWb2ljZVJlY29yZGluZ1N0b3JlLmluc3RhbmNlLmFjdGl2ZVJlY29yZGluZyB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gV2Ugc2hvdyBhIGxpdHRsZSBoZWFkcyB1cCB0aGF0IHRoZSByZWNvcmRpbmcgaXMgYWJvdXQgdG8gYXV0b21hdGljYWxseSBlbmQgc29vbi4gVGhlIDNzXG4gICAgICAgICAgICAvLyBkaXNwbGF5IHRpbWUgaXMgY29tcGxldGVseSBhcmJpdHJhcnkuIE5vdGUgdGhhdCB3ZSBkb24ndCBuZWVkIHRvIGRlcmVnaXN0ZXIgdGhlIGxpc3RlbmVyXG4gICAgICAgICAgICAvLyBiZWNhdXNlIHRoZSByZWNvcmRpbmcgaW5zdGFuY2Ugd2lsbCBjbGVhbiB0aGF0IHVwIGZvciB1cy5cbiAgICAgICAgICAgIHJlY29yZGluZy5vbihSZWNvcmRpbmdTdGF0ZS5FbmRpbmdTb29uLCAoeyBzZWNvbmRzTGVmdCB9KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHJlY29yZGluZ1RpbWVMZWZ0U2Vjb25kczogc2Vjb25kc0xlZnQgfSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNldFN0YXRlKHsgcmVjb3JkaW5nVGltZUxlZnRTZWNvbmRzOiBudWxsIH0pLCAzMDAwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGhhdmVSZWNvcmRpbmc6IGZhbHNlIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgc2hvdWxkU2hvd1N0aWNrZXJQaWNrZXIgPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgICAgIHJldHVybiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFVJRmVhdHVyZS5XaWRnZXRzKVxuICAgICAgICAmJiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwiTWVzc2FnZUNvbXBvc2VySW5wdXQuc2hvd1N0aWNrZXJzQnV0dG9uXCIpXG4gICAgICAgICYmICF0aGlzLnN0YXRlLmhhdmVSZWNvcmRpbmc7XG4gICAgfTtcblxuICAgIHByaXZhdGUgc2hvd1N0aWNrZXJzID0gKHNob3dTdGlja2VyczogYm9vbGVhbikgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd1N0aWNrZXJzIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHRvZ2dsZUJ1dHRvbk1lbnUgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgaXNNZW51T3BlbjogIXRoaXMuc3RhdGUuaXNNZW51T3BlbixcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVuZGVyQnV0dG9ucyhtZW51UG9zaXRpb24pOiBKU1guRWxlbWVudCB8IEpTWC5FbGVtZW50W10ge1xuICAgICAgICBsZXQgdXBsb2FkQnV0dG9uSW5kZXggPSAwO1xuICAgICAgICBjb25zdCBidXR0b25zOiBKU1guRWxlbWVudFtdID0gW107XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5oYXZlUmVjb3JkaW5nKSB7XG4gICAgICAgICAgICBpZiAoU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImZlYXR1cmVfcG9sbHNcIikpIHtcbiAgICAgICAgICAgICAgICBidXR0b25zLnB1c2goXG4gICAgICAgICAgICAgICAgICAgIDxQb2xsQnV0dG9uIGtleT1cInBvbGxzXCIgcm9vbT17dGhpcy5wcm9wcy5yb29tfSAvPixcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXBsb2FkQnV0dG9uSW5kZXggPSBidXR0b25zLmxlbmd0aDtcbiAgICAgICAgICAgIGJ1dHRvbnMucHVzaChcbiAgICAgICAgICAgICAgICA8VXBsb2FkQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGtleT1cImNvbnRyb2xzX3VwbG9hZFwiXG4gICAgICAgICAgICAgICAgICAgIHJvb21JZD17dGhpcy5wcm9wcy5yb29tLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb249e3RoaXMucHJvcHMucmVsYXRpb259XG4gICAgICAgICAgICAgICAgLz4sXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgYnV0dG9ucy5wdXNoKFxuICAgICAgICAgICAgICAgIDxFbW9qaUJ1dHRvbiBrZXk9XCJlbW9qaV9idXR0b25cIiBhZGRFbW9qaT17dGhpcy5hZGRFbW9qaX0gbWVudVBvc2l0aW9uPXttZW51UG9zaXRpb259IG5hcnJvd01vZGU9e3RoaXMuc3RhdGUubmFycm93TW9kZX0gLz4sXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNob3VsZFNob3dTdGlja2VyUGlja2VyKCkpIHtcbiAgICAgICAgICAgIGxldCB0aXRsZTtcbiAgICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5uYXJyb3dNb2RlKSB7XG4gICAgICAgICAgICAgICAgdGl0bGUgPSB0aGlzLnN0YXRlLnNob3dTdGlja2VycyA/IF90KFwiSGlkZSBTdGlja2Vyc1wiKSA6IF90KFwiU2hvdyBTdGlja2Vyc1wiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnV0dG9ucy5wdXNoKFxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBpZD0nc3RpY2tlcnNCdXR0b24nXG4gICAgICAgICAgICAgICAgICAgIGtleT1cImNvbnRyb2xzX3N0aWNrZXJzXCJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbXBvc2VyX2J1dHRvbiBteF9NZXNzYWdlQ29tcG9zZXJfc3RpY2tlcnNcIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnNob3dTdGlja2VycyghdGhpcy5zdGF0ZS5zaG93U3RpY2tlcnMpfVxuICAgICAgICAgICAgICAgICAgICB0aXRsZT17dGl0bGV9XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPXt0aGlzLnN0YXRlLm5hcnJvd01vZGUgPyBfdChcIlNlbmQgYSBzdGlja2VyXCIpIDogbnVsbH1cbiAgICAgICAgICAgICAgICAvPixcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmhhdmVSZWNvcmRpbmcgJiYgIXRoaXMuc3RhdGUubmFycm93TW9kZSkge1xuICAgICAgICAgICAgYnV0dG9ucy5wdXNoKFxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBrZXk9XCJ2b2ljZV9tZXNzYWdlX3NlbmRcIlxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9NZXNzYWdlQ29tcG9zZXJfYnV0dG9uIG14X01lc3NhZ2VDb21wb3Nlcl92b2ljZU1lc3NhZ2VcIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnZvaWNlUmVjb3JkaW5nQnV0dG9uLmN1cnJlbnQ/Lm9uUmVjb3JkU3RhcnRFbmRDbGljaygpfVxuICAgICAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJTZW5kIHZvaWNlIG1lc3NhZ2VcIil9XG4gICAgICAgICAgICAgICAgLz4sXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLm5hcnJvd01vZGUpIHtcbiAgICAgICAgICAgIHJldHVybiBidXR0b25zO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY2xhc3NuYW1lcyA9IGNsYXNzTmFtZXMoe1xuICAgICAgICAgICAgICAgIG14X01lc3NhZ2VDb21wb3Nlcl9idXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgbXhfTWVzc2FnZUNvbXBvc2VyX2J1dHRvbk1lbnU6IHRydWUsXG4gICAgICAgICAgICAgICAgbXhfTWVzc2FnZUNvbXBvc2VyX2Nsb3NlQnV0dG9uTWVudTogdGhpcy5zdGF0ZS5pc01lbnVPcGVuLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiA8PlxuICAgICAgICAgICAgICAgIHsgYnV0dG9uc1t1cGxvYWRCdXR0b25JbmRleF0gfVxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzbmFtZXN9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMudG9nZ2xlQnV0dG9uTWVudX1cbiAgICAgICAgICAgICAgICAgICAgdGl0bGU9e190KFwiTW9yZSBvcHRpb25zXCIpfVxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwPXtmYWxzZX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS5pc01lbnVPcGVuICYmIChcbiAgICAgICAgICAgICAgICAgICAgPENvbnRleHRNZW51XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLnRvZ2dsZUJ1dHRvbk1lbnV9XG4gICAgICAgICAgICAgICAgICAgICAgICB7Li4ubWVudVBvc2l0aW9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVudVBhZGRpbmdSaWdodD17MTB9XG4gICAgICAgICAgICAgICAgICAgICAgICBtZW51UGFkZGluZ1RvcD17NX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVQYWRkaW5nQm90dG9tPXs1fVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVudVdpZHRoPXsxNTB9XG4gICAgICAgICAgICAgICAgICAgICAgICB3cmFwcGVyQ2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbXBvc2VyX01lbnVcIlxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IGJ1dHRvbnMuc2xpY2UoMSkubWFwKChidXR0b24sIGluZGV4KSA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPE1lbnVJdGVtIGNsYXNzTmFtZT1cIm14X0NhbGxDb250ZXh0TWVudV9pdGVtXCIga2V5PXtpbmRleH0gb25DbGljaz17dGhpcy50b2dnbGVCdXR0b25NZW51fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBidXR0b24gfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvTWVudUl0ZW0+XG4gICAgICAgICAgICAgICAgICAgICAgICApKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvQ29udGV4dE1lbnU+XG4gICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICA8Lz47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xzID0gW1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5tZSAmJiAhdGhpcy5wcm9wcy5jb21wYWN0ID8gPENvbXBvc2VyQXZhdGFyIGtleT1cImNvbnRyb2xzX2F2YXRhclwiIG1lPXt0aGlzLnN0YXRlLm1lfSAvPiA6IG51bGwsXG4gICAgICAgICAgICB0aGlzLnByb3BzLmUyZVN0YXR1cyA/XG4gICAgICAgICAgICAgICAgPEUyRUljb24ga2V5PVwiZTJlSWNvblwiIHN0YXR1cz17dGhpcy5wcm9wcy5lMmVTdGF0dXN9IGNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb21wb3Nlcl9lMmVJY29uXCIgLz4gOlxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgIF07XG5cbiAgICAgICAgbGV0IG1lbnVQb3NpdGlvbjogQWJvdmVMZWZ0T2YgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmICh0aGlzLnJlZi5jdXJyZW50KSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50UmVjdCA9IHRoaXMucmVmLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICBtZW51UG9zaXRpb24gPSBhYm92ZUxlZnRPZihjb250ZW50UmVjdCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuc3RhdGUudG9tYnN0b25lICYmIHRoaXMuc3RhdGUuY2FuU2VuZE1lc3NhZ2VzKSB7XG4gICAgICAgICAgICBjb250cm9scy5wdXNoKFxuICAgICAgICAgICAgICAgIDxTZW5kTWVzc2FnZUNvbXBvc2VyXG4gICAgICAgICAgICAgICAgICAgIHJlZj17dGhpcy5tZXNzYWdlQ29tcG9zZXJJbnB1dH1cbiAgICAgICAgICAgICAgICAgICAga2V5PVwiY29udHJvbHNfaW5wdXRcIlxuICAgICAgICAgICAgICAgICAgICByb29tPXt0aGlzLnByb3BzLnJvb219XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXt0aGlzLnJlbmRlclBsYWNlaG9sZGVyVGV4dCgpfVxuICAgICAgICAgICAgICAgICAgICBwZXJtYWxpbmtDcmVhdG9yPXt0aGlzLnByb3BzLnBlcm1hbGlua0NyZWF0b3J9XG4gICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uPXt0aGlzLnByb3BzLnJlbGF0aW9ufVxuICAgICAgICAgICAgICAgICAgICByZXBseVRvRXZlbnQ9e3RoaXMucHJvcHMucmVwbHlUb0V2ZW50fVxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbkNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMuc3RhdGUuaGF2ZVJlY29yZGluZ31cbiAgICAgICAgICAgICAgICAvPixcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnRyb2xzLnB1c2goPFZvaWNlUmVjb3JkQ29tcG9zZXJUaWxlXG4gICAgICAgICAgICAgICAga2V5PVwiY29udHJvbHNfdm9pY2VfcmVjb3JkXCJcbiAgICAgICAgICAgICAgICByZWY9e3RoaXMudm9pY2VSZWNvcmRpbmdCdXR0b259XG4gICAgICAgICAgICAgICAgcm9vbT17dGhpcy5wcm9wcy5yb29tfSAvPik7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS50b21ic3RvbmUpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlcGxhY2VtZW50Um9vbUlkID0gdGhpcy5zdGF0ZS50b21ic3RvbmUuZ2V0Q29udGVudCgpWydyZXBsYWNlbWVudF9yb29tJ107XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbnRpbnVlc0xpbmsgPSByZXBsYWNlbWVudFJvb21JZCA/IChcbiAgICAgICAgICAgICAgICA8YSBocmVmPXttYWtlUm9vbVBlcm1hbGluayhyZXBsYWNlbWVudFJvb21JZCl9XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb21wb3Nlcl9yb29tUmVwbGFjZWRfbGlua1wiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25Ub21ic3RvbmVDbGlja31cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJUaGUgY29udmVyc2F0aW9uIGNvbnRpbnVlcyBoZXJlLlwiKSB9XG4gICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgKSA6ICcnO1xuXG4gICAgICAgICAgICBjb250cm9scy5wdXNoKDxkaXYgY2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbXBvc2VyX3JlcGxhY2VkX3dyYXBwZXJcIiBrZXk9XCJyb29tX3JlcGxhY2VkXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZXNzYWdlQ29tcG9zZXJfcmVwbGFjZWRfdmFsaWduXCI+XG4gICAgICAgICAgICAgICAgICAgIDxpbWcgY2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbXBvc2VyX3Jvb21SZXBsYWNlZF9pY29uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNyYz17cmVxdWlyZShcIi4uLy4uLy4uLy4uL3Jlcy9pbWcvcm9vbV9yZXBsYWNlZC5zdmdcIil9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb21wb3Nlcl9yb29tUmVwbGFjZWRfaGVhZGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiVGhpcyByb29tIGhhcyBiZWVuIHJlcGxhY2VkIGFuZCBpcyBubyBsb25nZXIgYWN0aXZlLlwiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj48YnIgLz5cbiAgICAgICAgICAgICAgICAgICAgeyBjb250aW51ZXNMaW5rIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2Pik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250cm9scy5wdXNoKFxuICAgICAgICAgICAgICAgIDxkaXYga2V5PVwiY29udHJvbHNfZXJyb3JcIiBjbGFzc05hbWU9XCJteF9NZXNzYWdlQ29tcG9zZXJfbm9wZXJtX2Vycm9yXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoJ1lvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIHBvc3QgdG8gdGhpcyByb29tJykgfVxuICAgICAgICAgICAgICAgIDwvZGl2PixcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVjb3JkaW5nVG9vbHRpcDtcbiAgICAgICAgY29uc3Qgc2Vjb25kc0xlZnQgPSBNYXRoLnJvdW5kKHRoaXMuc3RhdGUucmVjb3JkaW5nVGltZUxlZnRTZWNvbmRzKTtcbiAgICAgICAgaWYgKHNlY29uZHNMZWZ0KSB7XG4gICAgICAgICAgICByZWNvcmRpbmdUb29sdGlwID0gPFRvb2x0aXBcbiAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCIlKHNlY29uZHMpc3MgbGVmdFwiLCB7IHNlY29uZHM6IHNlY29uZHNMZWZ0IH0pfVxuICAgICAgICAgICAgICAgIGFsaWdubWVudD17QWxpZ25tZW50LlRvcH1cbiAgICAgICAgICAgICAgICB5T2Zmc2V0PXstNTB9XG4gICAgICAgICAgICAvPjtcbiAgICAgICAgfVxuICAgICAgICBjb250cm9scy5wdXNoKFxuICAgICAgICAgICAgPFN0aWNrZXJwaWNrZXJcbiAgICAgICAgICAgICAgICByb29tPXt0aGlzLnByb3BzLnJvb219XG4gICAgICAgICAgICAgICAgc2hvd1N0aWNrZXJzPXt0aGlzLnN0YXRlLnNob3dTdGlja2Vyc31cbiAgICAgICAgICAgICAgICBzZXRTaG93U3RpY2tlcnM9e3RoaXMuc2hvd1N0aWNrZXJzfVxuICAgICAgICAgICAgICAgIG1lbnVQb3NpdGlvbj17bWVudVBvc2l0aW9ufVxuICAgICAgICAgICAgICAgIGtleT1cInN0aWNrZXJzXCJcbiAgICAgICAgICAgIC8+LFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHNob3dTZW5kQnV0dG9uID0gIXRoaXMuc3RhdGUuaXNDb21wb3NlckVtcHR5IHx8IHRoaXMuc3RhdGUuaGF2ZVJlY29yZGluZztcblxuICAgICAgICBjb25zdCBjbGFzc2VzID0gY2xhc3NOYW1lcyh7XG4gICAgICAgICAgICBcIm14X01lc3NhZ2VDb21wb3NlclwiOiB0cnVlLFxuICAgICAgICAgICAgXCJteF9Hcm91cExheW91dFwiOiB0cnVlLFxuICAgICAgICAgICAgXCJteF9NZXNzYWdlQ29tcG9zZXItLWNvbXBhY3RcIjogdGhpcy5wcm9wcy5jb21wYWN0LFxuICAgICAgICAgICAgXCJteF9NZXNzYWdlQ29tcG9zZXJfZTJlU3RhdHVzXCI6IHRoaXMucHJvcHMuZTJlU3RhdHVzICE9IHVuZGVmaW5lZCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzfSByZWY9e3RoaXMucmVmfT5cbiAgICAgICAgICAgICAgICB7IHJlY29yZGluZ1Rvb2x0aXAgfVxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbXBvc2VyX3dyYXBwZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPFJlcGx5UHJldmlld1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlUb0V2ZW50PXt0aGlzLnByb3BzLnJlcGx5VG9FdmVudH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1hbGlua0NyZWF0b3I9e3RoaXMucHJvcHMucGVybWFsaW5rQ3JlYXRvcn0gLz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZXNzYWdlQ29tcG9zZXJfcm93XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IGNvbnRyb2xzIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5yZW5kZXJCdXR0b25zKG1lbnVQb3NpdGlvbikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgeyBzaG93U2VuZEJ1dHRvbiAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFNlbmRCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PVwiY29udHJvbHNfc2VuZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuc2VuZE1lc3NhZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPXt0aGlzLnN0YXRlLmhhdmVSZWNvcmRpbmcgPyBfdChcIlNlbmQgdm9pY2UgbWVzc2FnZVwiKSA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19