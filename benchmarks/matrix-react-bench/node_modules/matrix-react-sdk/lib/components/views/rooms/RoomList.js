"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.TAG_ORDER = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _event = require("matrix-js-sdk/src/@types/event");

var _languageHandler = require("../../../languageHandler");

var _RovingTabIndex = require("../../../accessibility/RovingTabIndex");

var _RoomListStore = _interopRequireWildcard(require("../../../stores/room-list/RoomListStore"));

var _RoomViewStore = _interopRequireDefault(require("../../../stores/RoomViewStore"));

var _models = require("../../../stores/room-list/models");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _RoomSublist = _interopRequireDefault(require("./RoomSublist"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _GroupAvatar = _interopRequireDefault(require("../avatars/GroupAvatar"));

var _ExtraTile = _interopRequireDefault(require("./ExtraTile"));

var _StaticNotificationState = require("../../../stores/notifications/StaticNotificationState");

var _actions = require("../../../dispatcher/actions");

var _RoomNotificationStateStore = require("../../../stores/notifications/RoomNotificationStateStore");

var _CustomRoomTagStore = _interopRequireDefault(require("../../../stores/CustomRoomTagStore"));

var _arrays = require("../../../utils/arrays");

var _objects = require("../../../utils/objects");

var _IconizedContextMenu = require("../context_menus/IconizedContextMenu");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _CommunityPrototypeStore = require("../../../stores/CommunityPrototypeStore");

var _SpaceStore = _interopRequireDefault(require("../../../stores/spaces/SpaceStore"));

var _spaces = require("../../../stores/spaces");

var _space = require("../../../utils/space");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _RoomAvatar = _interopRequireDefault(require("../avatars/RoomAvatar"));

var _AccessibleTooltipButton = _interopRequireDefault(require("../elements/AccessibleTooltipButton"));

var _UIComponents = require("../../../customisations/helpers/UIComponents");

var _UIFeature = require("../../../settings/UIFeature");

var _partials = require("matrix-js-sdk/src/@types/partials");

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const TAG_ORDER = [_models.DefaultTagID.Invite, _models.DefaultTagID.Favourite, _models.DefaultTagID.DM, _models.DefaultTagID.Untagged, // -- Custom Tags Placeholder --
_models.DefaultTagID.LowPriority, _models.DefaultTagID.ServerNotice, _models.DefaultTagID.Suggested, _models.DefaultTagID.Archived];
exports.TAG_ORDER = TAG_ORDER;
const CUSTOM_TAGS_BEFORE_TAG = _models.DefaultTagID.LowPriority;
const ALWAYS_VISIBLE_TAGS = [_models.DefaultTagID.DM, _models.DefaultTagID.Untagged];
const TAG_AESTHETICS = {
  [_models.DefaultTagID.Invite]: {
    sectionLabel: (0, _languageHandler._td)("Invites"),
    isInvite: true,
    defaultHidden: false
  },
  [_models.DefaultTagID.Favourite]: {
    sectionLabel: (0, _languageHandler._td)("Favourites"),
    isInvite: false,
    defaultHidden: false
  },
  [_models.DefaultTagID.DM]: {
    sectionLabel: (0, _languageHandler._td)("People"),
    isInvite: false,
    defaultHidden: false,
    addRoomLabel: (0, _languageHandler._td)("Start chat"),
    onAddRoom: dispatcher => {
      (dispatcher || _dispatcher.default).dispatch({
        action: 'view_create_chat'
      });
    }
  },
  [_models.DefaultTagID.Untagged]: {
    sectionLabel: (0, _languageHandler._td)("Rooms"),
    isInvite: false,
    defaultHidden: false,
    addRoomLabel: (0, _languageHandler._td)("Add room"),
    addRoomContextMenu: onFinished => {
      if (_SpaceStore.default.instance.activeSpaceRoom) {
        const userId = _MatrixClientPeg.MatrixClientPeg.get().getUserId();

        const space = _SpaceStore.default.instance.activeSpaceRoom;
        const canAddRooms = space.currentState.maySendStateEvent(_event.EventType.SpaceChild, userId);
        return /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOptionList, {
          first: true
        }, (0, _UIComponents.shouldShowComponent)(_UIFeature.UIComponent.CreateRooms) ? /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
          label: (0, _languageHandler._t)("Create new room"),
          iconClassName: "mx_RoomList_iconPlus",
          onClick: e => {
            e.preventDefault();
            e.stopPropagation();
            onFinished();
            (0, _space.showCreateNewRoom)(space);
          },
          disabled: !canAddRooms,
          tooltip: canAddRooms ? undefined : (0, _languageHandler._t)("You do not have permissions to create new rooms in this space")
        }), /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
          label: (0, _languageHandler._t)("Add existing room"),
          iconClassName: "mx_RoomList_iconHash",
          onClick: e => {
            e.preventDefault();
            e.stopPropagation();
            onFinished();
            (0, _space.showAddExistingRooms)(space);
          },
          disabled: !canAddRooms,
          tooltip: canAddRooms ? undefined : (0, _languageHandler._t)("You do not have permissions to add rooms to this space")
        })) : null, /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
          label: (0, _languageHandler._t)("Explore rooms"),
          iconClassName: "mx_RoomList_iconBrowse",
          onClick: e => {
            e.preventDefault();
            e.stopPropagation();
            onFinished();

            _dispatcher.default.fire(_actions.Action.ViewRoomDirectory);
          }
        }));
      }

      return /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOptionList, {
        first: true
      }, /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
        label: (0, _languageHandler._t)("Create new room"),
        iconClassName: "mx_RoomList_iconPlus",
        onClick: e => {
          e.preventDefault();
          e.stopPropagation();
          onFinished();

          _dispatcher.default.dispatch({
            action: "view_create_room"
          });
        }
      }), /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
        label: _CommunityPrototypeStore.CommunityPrototypeStore.instance.getSelectedCommunityId() ? (0, _languageHandler._t)("Explore community rooms") : (0, _languageHandler._t)("Explore public rooms"),
        iconClassName: "mx_RoomList_iconExplore",
        onClick: e => {
          e.preventDefault();
          e.stopPropagation();
          onFinished();

          _dispatcher.default.fire(_actions.Action.ViewRoomDirectory);
        }
      }));
    }
  },
  [_models.DefaultTagID.LowPriority]: {
    sectionLabel: (0, _languageHandler._td)("Low priority"),
    isInvite: false,
    defaultHidden: false
  },
  [_models.DefaultTagID.ServerNotice]: {
    sectionLabel: (0, _languageHandler._td)("System Alerts"),
    isInvite: false,
    defaultHidden: false
  },
  // TODO: Replace with archived view: https://github.com/vector-im/element-web/issues/14038
  [_models.DefaultTagID.Archived]: {
    sectionLabel: (0, _languageHandler._td)("Historical"),
    isInvite: false,
    defaultHidden: true
  },
  [_models.DefaultTagID.Suggested]: {
    sectionLabel: (0, _languageHandler._td)("Suggested Rooms"),
    isInvite: false,
    defaultHidden: false
  }
};

function customTagAesthetics(tagId) {
  if (tagId.startsWith("u.")) {
    tagId = tagId.substring(2);
  }

  return {
    sectionLabel: (0, _languageHandler._td)("Custom Tag"),
    sectionLabelRaw: tagId,
    isInvite: false,
    defaultHidden: false
  };
}

let RoomList = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.RoomList"), _dec(_class = (_temp = _class2 = class RoomList extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "customTagStoreRef", void 0);
    (0, _defineProperty2.default)(this, "roomStoreToken", void 0);
    (0, _defineProperty2.default)(this, "treeRef", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "context", void 0);
    (0, _defineProperty2.default)(this, "onRoomViewStoreUpdate", () => {
      this.setState({
        currentRoomId: _RoomViewStore.default.getRoomId()
      });
    });
    (0, _defineProperty2.default)(this, "onAction", payload => {
      if (payload.action === _actions.Action.ViewRoomDelta) {
        const viewRoomDeltaPayload = payload;

        const currentRoomId = _RoomViewStore.default.getRoomId();

        const room = this.getRoomDelta(currentRoomId, viewRoomDeltaPayload.delta, viewRoomDeltaPayload.unread);

        if (room) {
          _dispatcher.default.dispatch({
            action: _actions.Action.ViewRoom,
            room_id: room.roomId,
            show_room_tile: true // to make sure the room gets scrolled into view

          });
        }
      } else if (payload.action === _actions.Action.PstnSupportUpdated) {
        this.updateLists();
      }
    });
    (0, _defineProperty2.default)(this, "getRoomDelta", (roomId, delta, unread = false) => {
      const lists = _RoomListStore.default.instance.orderedLists;
      const rooms = [];
      TAG_ORDER.forEach(t => {
        let listRooms = lists[t];

        if (unread) {
          // filter to only notification rooms (and our current active room so we can index properly)
          listRooms = listRooms.filter(r => {
            const state = _RoomNotificationStateStore.RoomNotificationStateStore.instance.getRoomState(r);

            return state.room.roomId === roomId || state.isUnread;
          });
        }

        rooms.push(...listRooms);
      });
      const currentIndex = rooms.findIndex(r => r.roomId === roomId); // use slice to account for looping around the start

      const [room] = rooms.slice((currentIndex + delta) % rooms.length);
      return room;
    });
    (0, _defineProperty2.default)(this, "updateSuggestedRooms", suggestedRooms => {
      this.setState({
        suggestedRooms
      });
    });
    (0, _defineProperty2.default)(this, "updateLists", () => {
      const newLists = _RoomListStore.default.instance.orderedLists;
      const previousListIds = Object.keys(this.state.sublists);
      const newListIds = Object.keys(newLists).filter(t => {
        if (!(0, _models.isCustomTag)(t)) return true; // always include non-custom tags
        // if the tag is custom though, only include it if it is enabled

        return _CustomRoomTagStore.default.getTags()[t];
      });
      const isNameFiltering = !!_RoomListStore.default.instance.getFirstNameFilterCondition();
      let doUpdate = this.state.isNameFiltering !== isNameFiltering || (0, _arrays.arrayHasDiff)(previousListIds, newListIds);

      if (!doUpdate) {
        // so we didn't have the visible sublists change, but did the contents of those
        // sublists change significantly enough to break the sticky headers? Probably, so
        // let's check the length of each.
        for (const tagId of newListIds) {
          const oldRooms = this.state.sublists[tagId];
          const newRooms = newLists[tagId];

          if (oldRooms.length !== newRooms.length) {
            doUpdate = true;
            break;
          }
        }
      }

      if (doUpdate) {
        // We have to break our reference to the room list store if we want to be able to
        // diff the object for changes, so do that.
        // @ts-ignore - ITagMap is ts-ignored so this will have to be too
        const newSublists = (0, _objects.objectWithOnly)(newLists, newListIds);
        const sublists = (0, _objects.objectShallowClone)(newSublists, (k, v) => (0, _arrays.arrayFastClone)(v));
        this.setState({
          sublists,
          isNameFiltering
        }, () => {
          this.props.onResize();
        });
      }
    });
    (0, _defineProperty2.default)(this, "onStartChat", () => {
      var _RoomListStore$instan;

      const initialText = (_RoomListStore$instan = _RoomListStore.default.instance.getFirstNameFilterCondition()) === null || _RoomListStore$instan === void 0 ? void 0 : _RoomListStore$instan.search;

      _dispatcher.default.dispatch({
        action: "view_create_chat",
        initialText
      });
    });
    (0, _defineProperty2.default)(this, "onExplore", () => {
      var _RoomListStore$instan2;

      const initialText = (_RoomListStore$instan2 = _RoomListStore.default.instance.getFirstNameFilterCondition()) === null || _RoomListStore$instan2 === void 0 ? void 0 : _RoomListStore$instan2.search;

      _dispatcher.default.dispatch({
        action: _actions.Action.ViewRoomDirectory,
        initialText
      });
    });
    (0, _defineProperty2.default)(this, "onSpaceInviteClick", () => {
      var _RoomListStore$instan3;

      const initialText = (_RoomListStore$instan3 = _RoomListStore.default.instance.getFirstNameFilterCondition()) === null || _RoomListStore$instan3 === void 0 ? void 0 : _RoomListStore$instan3.search;
      (0, _space.showSpaceInvite)(this.context.getRoom(this.props.activeSpace), initialText);
    });
    this.state = {
      sublists: {},
      isNameFiltering: !!_RoomListStore.default.instance.getFirstNameFilterCondition(),
      suggestedRooms: _SpaceStore.default.instance.suggestedRooms
    };
  }

  componentDidMount() {
    this.dispatcherRef = _dispatcher.default.register(this.onAction);
    this.roomStoreToken = _RoomViewStore.default.addListener(this.onRoomViewStoreUpdate);

    _SpaceStore.default.instance.on(_spaces.UPDATE_SUGGESTED_ROOMS, this.updateSuggestedRooms);

    _RoomListStore.default.instance.on(_RoomListStore.LISTS_UPDATE_EVENT, this.updateLists);

    this.customTagStoreRef = _CustomRoomTagStore.default.addListener(this.updateLists);
    this.updateLists(); // trigger the first update
  }

  componentWillUnmount() {
    _SpaceStore.default.instance.off(_spaces.UPDATE_SUGGESTED_ROOMS, this.updateSuggestedRooms);

    _RoomListStore.default.instance.off(_RoomListStore.LISTS_UPDATE_EVENT, this.updateLists);

    _dispatcher.default.unregister(this.dispatcherRef);

    if (this.customTagStoreRef) this.customTagStoreRef.remove();
    if (this.roomStoreToken) this.roomStoreToken.remove();
  }

  renderSuggestedRooms() {
    return this.state.suggestedRooms.map(room => {
      var _room$aliases;

      const name = room.name || room.canonical_alias || ((_room$aliases = room.aliases) === null || _room$aliases === void 0 ? void 0 : _room$aliases[0]) || (0, _languageHandler._t)("Empty room");

      const avatar = /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
        oobData: {
          name,
          avatarUrl: room.avatar_url
        },
        width: 32,
        height: 32,
        resizeMethod: "crop"
      });

      const viewRoom = () => {
        var _room$aliases2;

        _dispatcher.default.dispatch({
          action: "view_room",
          room_alias: room.canonical_alias || ((_room$aliases2 = room.aliases) === null || _room$aliases2 === void 0 ? void 0 : _room$aliases2[0]),
          room_id: room.room_id,
          via_servers: room.viaServers,
          oobData: {
            avatarUrl: room.avatar_url,
            name
          }
        });
      };

      return /*#__PURE__*/_react.default.createElement(_ExtraTile.default, {
        isMinimized: this.props.isMinimized,
        isSelected: this.state.currentRoomId === room.room_id,
        displayName: name,
        avatar: avatar,
        onClick: viewRoom,
        key: `suggestedRoomTile_${room.room_id}`
      });
    });
  }

  renderCommunityInvites() {
    if (_SpaceStore.default.spacesEnabled) return []; // TODO: Put community invites in a more sensible place (not in the room list)
    // See https://github.com/vector-im/element-web/issues/14456

    return _MatrixClientPeg.MatrixClientPeg.get().getGroups().filter(g => {
      return g.myMembership === 'invite';
    }).map(g => {
      const avatar = /*#__PURE__*/_react.default.createElement(_GroupAvatar.default, {
        groupId: g.groupId,
        groupName: g.name,
        groupAvatarUrl: g.avatarUrl,
        width: 32,
        height: 32,
        resizeMethod: "crop"
      });

      const openGroup = () => {
        _dispatcher.default.dispatch({
          action: 'view_group',
          group_id: g.groupId
        });
      };

      return /*#__PURE__*/_react.default.createElement(_ExtraTile.default, {
        isMinimized: this.props.isMinimized,
        isSelected: false,
        displayName: g.name,
        avatar: avatar,
        notificationState: _StaticNotificationState.StaticNotificationState.RED_EXCLAMATION,
        onClick: openGroup,
        key: `temporaryGroupTile_${g.groupId}`
      });
    });
  }

  renderSublists() {
    var _this$state$suggested;

    // show a skeleton UI if the user is in no rooms and they are not filtering and have no suggested rooms
    const showSkeleton = !this.state.isNameFiltering && !((_this$state$suggested = this.state.suggestedRooms) !== null && _this$state$suggested !== void 0 && _this$state$suggested.length) && Object.values(_RoomListStore.default.instance.unfilteredLists).every(list => !(list !== null && list !== void 0 && list.length));
    return TAG_ORDER.reduce((tags, tagId) => {
      if (tagId === CUSTOM_TAGS_BEFORE_TAG) {
        const customTags = Object.keys(this.state.sublists).filter(tagId => (0, _models.isCustomTag)(tagId));
        tags.push(...customTags);
      }

      tags.push(tagId);
      return tags;
    }, []).map(orderedTagId => {
      let extraTiles = null;

      if (orderedTagId === _models.DefaultTagID.Invite) {
        extraTiles = this.renderCommunityInvites();
      } else if (orderedTagId === _models.DefaultTagID.Suggested) {
        extraTiles = this.renderSuggestedRooms();
      }

      const aesthetics = (0, _models.isCustomTag)(orderedTagId) ? customTagAesthetics(orderedTagId) : TAG_AESTHETICS[orderedTagId];
      if (!aesthetics) throw new Error(`Tag ${orderedTagId} does not have aesthetics`);
      let alwaysVisible = ALWAYS_VISIBLE_TAGS.includes(orderedTagId);

      if (this.props.activeSpace === _spaces.MetaSpace.Favourites && orderedTagId !== _models.DefaultTagID.Favourite || this.props.activeSpace === _spaces.MetaSpace.People && orderedTagId !== _models.DefaultTagID.DM || this.props.activeSpace === _spaces.MetaSpace.Orphans && orderedTagId === _models.DefaultTagID.DM) {
        alwaysVisible = false;
      } // The cost of mounting/unmounting this component offsets the cost
      // of keeping it in the DOM and hiding it when it is not required


      return /*#__PURE__*/_react.default.createElement(_RoomSublist.default, {
        key: `sublist-${orderedTagId}`,
        tagId: orderedTagId,
        forRooms: true,
        startAsHidden: aesthetics.defaultHidden,
        label: aesthetics.sectionLabelRaw ? aesthetics.sectionLabelRaw : (0, _languageHandler._t)(aesthetics.sectionLabel),
        onAddRoom: aesthetics.onAddRoom,
        addRoomLabel: aesthetics.addRoomLabel ? (0, _languageHandler._t)(aesthetics.addRoomLabel) : aesthetics.addRoomLabel,
        addRoomContextMenu: aesthetics.addRoomContextMenu,
        isMinimized: this.props.isMinimized,
        showSkeleton: showSkeleton,
        extraTiles: extraTiles,
        resizeNotifier: this.props.resizeNotifier,
        alwaysVisible: alwaysVisible,
        onListCollapse: this.props.onListCollapse
      });
    });
  }

  focus() {
    var _find, _this$treeRef$current;

    // focus the first focusable element in this aria treeview widget
    (_find = [...((_this$treeRef$current = this.treeRef.current) === null || _this$treeRef$current === void 0 ? void 0 : _this$treeRef$current.querySelectorAll('[role="treeitem"]'))].find(e => e.offsetParent !== null)) === null || _find === void 0 ? void 0 : _find.focus();
  }

  render() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const userId = cli.getUserId();
    const activeSpace = this.props.activeSpace[0] === "!" ? cli.getRoom(this.props.activeSpace) : null;
    let explorePrompt;

    if (!this.props.isMinimized) {
      if (this.state.isNameFiltering) {
        explorePrompt = /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_RoomList_explorePrompt"
        }, /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Can't see what you're looking for?")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
          className: "mx_RoomList_explorePrompt_startChat",
          kind: "link",
          onClick: this.onStartChat
        }, (0, _languageHandler._t)("Start a new chat")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
          className: "mx_RoomList_explorePrompt_explore",
          kind: "link",
          onClick: this.onExplore
        }, activeSpace ? (0, _languageHandler._t)("Explore rooms") : (0, _languageHandler._t)("Explore all public rooms")));
      } else if (activeSpace !== null && activeSpace !== void 0 && activeSpace.canInvite(userId) || (activeSpace === null || activeSpace === void 0 ? void 0 : activeSpace.getMyMembership()) === "join" || (activeSpace === null || activeSpace === void 0 ? void 0 : activeSpace.getJoinRule()) === _partials.JoinRule.Public) {
        const spaceName = activeSpace.name;
        const canInvite = (activeSpace === null || activeSpace === void 0 ? void 0 : activeSpace.canInvite(userId)) || (activeSpace === null || activeSpace === void 0 ? void 0 : activeSpace.getJoinRule()) === _partials.JoinRule.Public;
        explorePrompt = /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_RoomList_explorePrompt"
        }, /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Quick actions")), canInvite && /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
          className: "mx_RoomList_explorePrompt_spaceInvite",
          onClick: this.onSpaceInviteClick,
          title: (0, _languageHandler._t)("Invite to %(spaceName)s", {
            spaceName
          })
        }, (0, _languageHandler._t)("Invite people")), (activeSpace === null || activeSpace === void 0 ? void 0 : activeSpace.getMyMembership()) === "join" && /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
          className: "mx_RoomList_explorePrompt_spaceExplore",
          onClick: this.onExplore,
          title: (0, _languageHandler._t)("Explore %(spaceName)s", {
            spaceName
          })
        }, (0, _languageHandler._t)("Explore rooms")));
      } else if (Object.values(this.state.sublists).some(list => list.length > 0)) {
        const unfilteredLists = _RoomListStore.default.instance.unfilteredLists;
        const unfilteredRooms = unfilteredLists[_models.DefaultTagID.Untagged] || [];
        const unfilteredHistorical = unfilteredLists[_models.DefaultTagID.Archived] || [];
        const unfilteredFavourite = unfilteredLists[_models.DefaultTagID.Favourite] || []; // show a prompt to join/create rooms if the user is in 0 rooms and no historical

        if (unfilteredRooms.length < 1 && unfilteredHistorical.length < 1 && unfilteredFavourite.length < 1) {
          explorePrompt = /*#__PURE__*/_react.default.createElement("div", {
            className: "mx_RoomList_explorePrompt"
          }, /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Use the + to make a new room or explore existing ones below")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
            className: "mx_RoomList_explorePrompt_startChat",
            kind: "link",
            onClick: this.onStartChat
          }, (0, _languageHandler._t)("Start a new chat")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
            className: "mx_RoomList_explorePrompt_explore",
            kind: "link",
            onClick: this.onExplore
          }, (0, _languageHandler._t)("Explore all public rooms")));
        }
      }
    }

    const sublists = this.renderSublists();
    return /*#__PURE__*/_react.default.createElement(_RovingTabIndex.RovingTabIndexProvider, {
      handleHomeEnd: true,
      handleUpDown: true,
      onKeyDown: this.props.onKeyDown
    }, ({
      onKeyDownHandler
    }) => /*#__PURE__*/_react.default.createElement("div", {
      onFocus: this.props.onFocus,
      onBlur: this.props.onBlur,
      onKeyDown: onKeyDownHandler,
      className: "mx_RoomList",
      role: "tree",
      "aria-label": (0, _languageHandler._t)("Rooms"),
      ref: this.treeRef
    }, sublists, explorePrompt));
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _MatrixClientContext.default), _temp)) || _class);
exports.default = RoomList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL1Jvb21MaXN0LnRzeCJdLCJuYW1lcyI6WyJUQUdfT1JERVIiLCJEZWZhdWx0VGFnSUQiLCJJbnZpdGUiLCJGYXZvdXJpdGUiLCJETSIsIlVudGFnZ2VkIiwiTG93UHJpb3JpdHkiLCJTZXJ2ZXJOb3RpY2UiLCJTdWdnZXN0ZWQiLCJBcmNoaXZlZCIsIkNVU1RPTV9UQUdTX0JFRk9SRV9UQUciLCJBTFdBWVNfVklTSUJMRV9UQUdTIiwiVEFHX0FFU1RIRVRJQ1MiLCJzZWN0aW9uTGFiZWwiLCJpc0ludml0ZSIsImRlZmF1bHRIaWRkZW4iLCJhZGRSb29tTGFiZWwiLCJvbkFkZFJvb20iLCJkaXNwYXRjaGVyIiwiZGVmYXVsdERpc3BhdGNoZXIiLCJkaXNwYXRjaCIsImFjdGlvbiIsImFkZFJvb21Db250ZXh0TWVudSIsIm9uRmluaXNoZWQiLCJTcGFjZVN0b3JlIiwiaW5zdGFuY2UiLCJhY3RpdmVTcGFjZVJvb20iLCJ1c2VySWQiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJnZXRVc2VySWQiLCJzcGFjZSIsImNhbkFkZFJvb21zIiwiY3VycmVudFN0YXRlIiwibWF5U2VuZFN0YXRlRXZlbnQiLCJFdmVudFR5cGUiLCJTcGFjZUNoaWxkIiwiVUlDb21wb25lbnQiLCJDcmVhdGVSb29tcyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsInVuZGVmaW5lZCIsImZpcmUiLCJBY3Rpb24iLCJWaWV3Um9vbURpcmVjdG9yeSIsIkNvbW11bml0eVByb3RvdHlwZVN0b3JlIiwiZ2V0U2VsZWN0ZWRDb21tdW5pdHlJZCIsImN1c3RvbVRhZ0Flc3RoZXRpY3MiLCJ0YWdJZCIsInN0YXJ0c1dpdGgiLCJzdWJzdHJpbmciLCJzZWN0aW9uTGFiZWxSYXciLCJSb29tTGlzdCIsIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzZXRTdGF0ZSIsImN1cnJlbnRSb29tSWQiLCJSb29tVmlld1N0b3JlIiwiZ2V0Um9vbUlkIiwicGF5bG9hZCIsIlZpZXdSb29tRGVsdGEiLCJ2aWV3Um9vbURlbHRhUGF5bG9hZCIsInJvb20iLCJnZXRSb29tRGVsdGEiLCJkZWx0YSIsInVucmVhZCIsImRpcyIsIlZpZXdSb29tIiwicm9vbV9pZCIsInJvb21JZCIsInNob3dfcm9vbV90aWxlIiwiUHN0blN1cHBvcnRVcGRhdGVkIiwidXBkYXRlTGlzdHMiLCJsaXN0cyIsIlJvb21MaXN0U3RvcmUiLCJvcmRlcmVkTGlzdHMiLCJyb29tcyIsImZvckVhY2giLCJ0IiwibGlzdFJvb21zIiwiZmlsdGVyIiwiciIsInN0YXRlIiwiUm9vbU5vdGlmaWNhdGlvblN0YXRlU3RvcmUiLCJnZXRSb29tU3RhdGUiLCJpc1VucmVhZCIsInB1c2giLCJjdXJyZW50SW5kZXgiLCJmaW5kSW5kZXgiLCJzbGljZSIsImxlbmd0aCIsInN1Z2dlc3RlZFJvb21zIiwibmV3TGlzdHMiLCJwcmV2aW91c0xpc3RJZHMiLCJPYmplY3QiLCJrZXlzIiwic3VibGlzdHMiLCJuZXdMaXN0SWRzIiwiQ3VzdG9tUm9vbVRhZ1N0b3JlIiwiZ2V0VGFncyIsImlzTmFtZUZpbHRlcmluZyIsImdldEZpcnN0TmFtZUZpbHRlckNvbmRpdGlvbiIsImRvVXBkYXRlIiwib2xkUm9vbXMiLCJuZXdSb29tcyIsIm5ld1N1Ymxpc3RzIiwiayIsInYiLCJvblJlc2l6ZSIsImluaXRpYWxUZXh0Iiwic2VhcmNoIiwiY29udGV4dCIsImdldFJvb20iLCJhY3RpdmVTcGFjZSIsImNvbXBvbmVudERpZE1vdW50IiwiZGlzcGF0Y2hlclJlZiIsInJlZ2lzdGVyIiwib25BY3Rpb24iLCJyb29tU3RvcmVUb2tlbiIsImFkZExpc3RlbmVyIiwib25Sb29tVmlld1N0b3JlVXBkYXRlIiwib24iLCJVUERBVEVfU1VHR0VTVEVEX1JPT01TIiwidXBkYXRlU3VnZ2VzdGVkUm9vbXMiLCJMSVNUU19VUERBVEVfRVZFTlQiLCJjdXN0b21UYWdTdG9yZVJlZiIsImNvbXBvbmVudFdpbGxVbm1vdW50Iiwib2ZmIiwidW5yZWdpc3RlciIsInJlbW92ZSIsInJlbmRlclN1Z2dlc3RlZFJvb21zIiwibWFwIiwibmFtZSIsImNhbm9uaWNhbF9hbGlhcyIsImFsaWFzZXMiLCJhdmF0YXIiLCJhdmF0YXJVcmwiLCJhdmF0YXJfdXJsIiwidmlld1Jvb20iLCJyb29tX2FsaWFzIiwidmlhX3NlcnZlcnMiLCJ2aWFTZXJ2ZXJzIiwib29iRGF0YSIsImlzTWluaW1pemVkIiwicmVuZGVyQ29tbXVuaXR5SW52aXRlcyIsInNwYWNlc0VuYWJsZWQiLCJnZXRHcm91cHMiLCJnIiwibXlNZW1iZXJzaGlwIiwiZ3JvdXBJZCIsIm9wZW5Hcm91cCIsImdyb3VwX2lkIiwiU3RhdGljTm90aWZpY2F0aW9uU3RhdGUiLCJSRURfRVhDTEFNQVRJT04iLCJyZW5kZXJTdWJsaXN0cyIsInNob3dTa2VsZXRvbiIsInZhbHVlcyIsInVuZmlsdGVyZWRMaXN0cyIsImV2ZXJ5IiwibGlzdCIsInJlZHVjZSIsInRhZ3MiLCJjdXN0b21UYWdzIiwib3JkZXJlZFRhZ0lkIiwiZXh0cmFUaWxlcyIsImFlc3RoZXRpY3MiLCJFcnJvciIsImFsd2F5c1Zpc2libGUiLCJpbmNsdWRlcyIsIk1ldGFTcGFjZSIsIkZhdm91cml0ZXMiLCJQZW9wbGUiLCJPcnBoYW5zIiwicmVzaXplTm90aWZpZXIiLCJvbkxpc3RDb2xsYXBzZSIsImZvY3VzIiwidHJlZVJlZiIsImN1cnJlbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZmluZCIsIm9mZnNldFBhcmVudCIsInJlbmRlciIsImNsaSIsImV4cGxvcmVQcm9tcHQiLCJvblN0YXJ0Q2hhdCIsIm9uRXhwbG9yZSIsImNhbkludml0ZSIsImdldE15TWVtYmVyc2hpcCIsImdldEpvaW5SdWxlIiwiSm9pblJ1bGUiLCJQdWJsaWMiLCJzcGFjZU5hbWUiLCJvblNwYWNlSW52aXRlQ2xpY2siLCJzb21lIiwidW5maWx0ZXJlZFJvb21zIiwidW5maWx0ZXJlZEhpc3RvcmljYWwiLCJ1bmZpbHRlcmVkRmF2b3VyaXRlIiwib25LZXlEb3duIiwib25LZXlEb3duSGFuZGxlciIsIm9uRm9jdXMiLCJvbkJsdXIiLCJNYXRyaXhDbGllbnRDb250ZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFJQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFvQk8sTUFBTUEsU0FBa0IsR0FBRyxDQUM5QkMscUJBQWFDLE1BRGlCLEVBRTlCRCxxQkFBYUUsU0FGaUIsRUFHOUJGLHFCQUFhRyxFQUhpQixFQUk5QkgscUJBQWFJLFFBSmlCLEVBTTlCO0FBRUFKLHFCQUFhSyxXQVJpQixFQVM5QkwscUJBQWFNLFlBVGlCLEVBVTlCTixxQkFBYU8sU0FWaUIsRUFXOUJQLHFCQUFhUSxRQVhpQixDQUEzQjs7QUFhUCxNQUFNQyxzQkFBc0IsR0FBR1QscUJBQWFLLFdBQTVDO0FBQ0EsTUFBTUssbUJBQTRCLEdBQUcsQ0FDakNWLHFCQUFhRyxFQURvQixFQUVqQ0gscUJBQWFJLFFBRm9CLENBQXJDO0FBb0JBLE1BQU1PLGNBQWlDLEdBQUc7QUFDdEMsR0FBQ1gscUJBQWFDLE1BQWQsR0FBdUI7QUFDbkJXLElBQUFBLFlBQVksRUFBRSwwQkFBSSxTQUFKLENBREs7QUFFbkJDLElBQUFBLFFBQVEsRUFBRSxJQUZTO0FBR25CQyxJQUFBQSxhQUFhLEVBQUU7QUFISSxHQURlO0FBTXRDLEdBQUNkLHFCQUFhRSxTQUFkLEdBQTBCO0FBQ3RCVSxJQUFBQSxZQUFZLEVBQUUsMEJBQUksWUFBSixDQURRO0FBRXRCQyxJQUFBQSxRQUFRLEVBQUUsS0FGWTtBQUd0QkMsSUFBQUEsYUFBYSxFQUFF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LHdCQUNJLDZCQUFDLHNDQUFEO0FBQXdCLE1BQUEsYUFBYSxNQUFyQztBQUFzQyxNQUFBLFlBQVksTUFBbEQ7QUFBbUQsTUFBQSxTQUFTLEVBQUUsS0FBS3BHLEtBQUwsQ0FBVytJO0FBQXpFLE9BQ00sQ0FBQztBQUFFQyxNQUFBQTtBQUFGLEtBQUQsa0JBQ0U7QUFDSSxNQUFBLE9BQU8sRUFBRSxLQUFLaEosS0FBTCxDQUFXaUosT0FEeEI7QUFFSSxNQUFBLE1BQU0sRUFBRSxLQUFLakosS0FBTCxDQUFXa0osTUFGdkI7QUFHSSxNQUFBLFNBQVMsRUFBRUYsZ0JBSGY7QUFJSSxNQUFBLFNBQVMsRUFBQyxhQUpkO0FBS0ksTUFBQSxJQUFJLEVBQUMsTUFMVDtBQU1JLG9CQUFZLHlCQUFHLE9BQUgsQ0FOaEI7QUFPSSxNQUFBLEdBQUcsRUFBRSxLQUFLdEI7QUFQZCxPQVNNaEYsUUFUTixFQVVNdUYsYUFWTixDQUZSLENBREo7QUFrQkg7O0FBdlhxRSxDLHdEQU1qRGtCLDRCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE1LTIwMTgsIDIwMjAsIDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgY3JlYXRlUmVmLCBSZWFjdENvbXBvbmVudEVsZW1lbnQgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IERpc3BhdGNoZXIgfSBmcm9tIFwiZmx1eFwiO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuaW1wb3J0ICogYXMgZmJFbWl0dGVyIGZyb20gXCJmYmVtaXR0ZXJcIjtcbmltcG9ydCB7IEV2ZW50VHlwZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvZXZlbnRcIjtcblxuaW1wb3J0IHsgX3QsIF90ZCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCB7IElTdGF0ZSBhcyBJUm92aW5nVGFiSW5kZXhTdGF0ZSwgUm92aW5nVGFiSW5kZXhQcm92aWRlciB9IGZyb20gXCIuLi8uLi8uLi9hY2Nlc3NpYmlsaXR5L1JvdmluZ1RhYkluZGV4XCI7XG5pbXBvcnQgUmVzaXplTm90aWZpZXIgZnJvbSBcIi4uLy4uLy4uL3V0aWxzL1Jlc2l6ZU5vdGlmaWVyXCI7XG5pbXBvcnQgUm9vbUxpc3RTdG9yZSwgeyBMSVNUU19VUERBVEVfRVZFTlQgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL3Jvb20tbGlzdC9Sb29tTGlzdFN0b3JlXCI7XG5pbXBvcnQgUm9vbVZpZXdTdG9yZSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL1Jvb21WaWV3U3RvcmVcIjtcbmltcG9ydCB7IElUYWdNYXAgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL3Jvb20tbGlzdC9hbGdvcml0aG1zL21vZGVsc1wiO1xuaW1wb3J0IHsgRGVmYXVsdFRhZ0lELCBpc0N1c3RvbVRhZywgVGFnSUQgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL3Jvb20tbGlzdC9tb2RlbHNcIjtcbmltcG9ydCBkaXMgZnJvbSBcIi4uLy4uLy4uL2Rpc3BhdGNoZXIvZGlzcGF0Y2hlclwiO1xuaW1wb3J0IGRlZmF1bHREaXNwYXRjaGVyIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCBSb29tU3VibGlzdCBmcm9tIFwiLi9Sb29tU3VibGlzdFwiO1xuaW1wb3J0IHsgQWN0aW9uUGF5bG9hZCB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL3BheWxvYWRzXCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tIFwiLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnXCI7XG5pbXBvcnQgR3JvdXBBdmF0YXIgZnJvbSBcIi4uL2F2YXRhcnMvR3JvdXBBdmF0YXJcIjtcbmltcG9ydCBFeHRyYVRpbGUgZnJvbSBcIi4vRXh0cmFUaWxlXCI7XG5pbXBvcnQgeyBTdGF0aWNOb3RpZmljYXRpb25TdGF0ZSB9IGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvbm90aWZpY2F0aW9ucy9TdGF0aWNOb3RpZmljYXRpb25TdGF0ZVwiO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSBcIi4uLy4uLy4uL2Rpc3BhdGNoZXIvYWN0aW9uc1wiO1xuaW1wb3J0IHsgVmlld1Jvb21EZWx0YVBheWxvYWQgfSBmcm9tIFwiLi4vLi4vLi4vZGlzcGF0Y2hlci9wYXlsb2Fkcy9WaWV3Um9vbURlbHRhUGF5bG9hZFwiO1xuaW1wb3J0IHsgUm9vbU5vdGlmaWNhdGlvblN0YXRlU3RvcmUgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL25vdGlmaWNhdGlvbnMvUm9vbU5vdGlmaWNhdGlvblN0YXRlU3RvcmVcIjtcbmltcG9ydCBDdXN0b21Sb29tVGFnU3RvcmUgZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9DdXN0b21Sb29tVGFnU3RvcmVcIjtcbmltcG9ydCB7IGFycmF5RmFzdENsb25lLCBhcnJheUhhc0RpZmYgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvYXJyYXlzXCI7XG5pbXBvcnQgeyBvYmplY3RTaGFsbG93Q2xvbmUsIG9iamVjdFdpdGhPbmx5IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL29iamVjdHNcIjtcbmltcG9ydCB7IEljb25pemVkQ29udGV4dE1lbnVPcHRpb24sIEljb25pemVkQ29udGV4dE1lbnVPcHRpb25MaXN0IH0gZnJvbSBcIi4uL2NvbnRleHRfbWVudXMvSWNvbml6ZWRDb250ZXh0TWVudVwiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCB7IENvbW11bml0eVByb3RvdHlwZVN0b3JlIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9Db21tdW5pdHlQcm90b3R5cGVTdG9yZVwiO1xuaW1wb3J0IFNwYWNlU3RvcmUgZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9zcGFjZXMvU3BhY2VTdG9yZVwiO1xuaW1wb3J0IHsgSVN1Z2dlc3RlZFJvb20sIE1ldGFTcGFjZSwgU3BhY2VLZXksIFVQREFURV9TVUdHRVNURURfUk9PTVMgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL3NwYWNlc1wiO1xuaW1wb3J0IHsgc2hvd0FkZEV4aXN0aW5nUm9vbXMsIHNob3dDcmVhdGVOZXdSb29tLCBzaG93U3BhY2VJbnZpdGUgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvc3BhY2VcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgUm9vbUF2YXRhciBmcm9tIFwiLi4vYXZhdGFycy9Sb29tQXZhdGFyXCI7XG5pbXBvcnQgQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVUb29sdGlwQnV0dG9uXCI7XG5pbXBvcnQgeyBzaG91bGRTaG93Q29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL2N1c3RvbWlzYXRpb25zL2hlbHBlcnMvVUlDb21wb25lbnRzXCI7XG5pbXBvcnQgeyBVSUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9VSUZlYXR1cmVcIjtcbmltcG9ydCB7IEpvaW5SdWxlIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL0B0eXBlcy9wYXJ0aWFsc1wiO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgb25LZXlEb3duOiAoZXY6IFJlYWN0LktleWJvYXJkRXZlbnQsIHN0YXRlOiBJUm92aW5nVGFiSW5kZXhTdGF0ZSkgPT4gdm9pZDtcbiAgICBvbkZvY3VzOiAoZXY6IFJlYWN0LkZvY3VzRXZlbnQpID0+IHZvaWQ7XG4gICAgb25CbHVyOiAoZXY6IFJlYWN0LkZvY3VzRXZlbnQpID0+IHZvaWQ7XG4gICAgb25SZXNpemU6ICgpID0+IHZvaWQ7XG4gICAgb25MaXN0Q29sbGFwc2U/OiAoaXNFeHBhbmRlZDogYm9vbGVhbikgPT4gdm9pZDtcbiAgICByZXNpemVOb3RpZmllcjogUmVzaXplTm90aWZpZXI7XG4gICAgaXNNaW5pbWl6ZWQ6IGJvb2xlYW47XG4gICAgYWN0aXZlU3BhY2U6IFNwYWNlS2V5O1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBzdWJsaXN0czogSVRhZ01hcDtcbiAgICBpc05hbWVGaWx0ZXJpbmc6IGJvb2xlYW47XG4gICAgY3VycmVudFJvb21JZD86IHN0cmluZztcbiAgICBzdWdnZXN0ZWRSb29tczogSVN1Z2dlc3RlZFJvb21bXTtcbn1cblxuZXhwb3J0IGNvbnN0IFRBR19PUkRFUjogVGFnSURbXSA9IFtcbiAgICBEZWZhdWx0VGFnSUQuSW52aXRlLFxuICAgIERlZmF1bHRUYWdJRC5GYXZvdXJpdGUsXG4gICAgRGVmYXVsdFRhZ0lELkRNLFxuICAgIERlZmF1bHRUYWdJRC5VbnRhZ2dlZCxcblxuICAgIC8vIC0tIEN1c3RvbSBUYWdzIFBsYWNlaG9sZGVyIC0tXG5cbiAgICBEZWZhdWx0VGFnSUQuTG93UHJpb3JpdHksXG4gICAgRGVmYXVsdFRhZ0lELlNlcnZlck5vdGljZSxcbiAgICBEZWZhdWx0VGFnSUQuU3VnZ2VzdGVkLFxuICAgIERlZmF1bHRUYWdJRC5BcmNoaXZlZCxcbl07XG5jb25zdCBDVVNUT01fVEFHU19CRUZPUkVfVEFHID0gRGVmYXVsdFRhZ0lELkxvd1ByaW9yaXR5O1xuY29uc3QgQUxXQVlTX1ZJU0lCTEVfVEFHUzogVGFnSURbXSA9IFtcbiAgICBEZWZhdWx0VGFnSUQuRE0sXG4gICAgRGVmYXVsdFRhZ0lELlVudGFnZ2VkLFxuXTtcblxuaW50ZXJmYWNlIElUYWdBZXN0aGV0aWNzIHtcbiAgICBzZWN0aW9uTGFiZWw6IHN0cmluZztcbiAgICBzZWN0aW9uTGFiZWxSYXc/OiBzdHJpbmc7XG4gICAgYWRkUm9vbUxhYmVsPzogc3RyaW5nO1xuICAgIG9uQWRkUm9vbT86IChkaXNwYXRjaGVyPzogRGlzcGF0Y2hlcjxBY3Rpb25QYXlsb2FkPikgPT4gdm9pZDtcbiAgICBhZGRSb29tQ29udGV4dE1lbnU/OiAob25GaW5pc2hlZDogKCkgPT4gdm9pZCkgPT4gUmVhY3QuUmVhY3ROb2RlO1xuICAgIGlzSW52aXRlOiBib29sZWFuO1xuICAgIGRlZmF1bHRIaWRkZW46IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBJVGFnQWVzdGhldGljc01hcCB7XG4gICAgLy8gQHRzLWlnbm9yZSAtIFRTIHdhbnRzIHRoaXMgdG8gYmUgYSBzdHJpbmcgYnV0IHdlIGtub3cgYmV0dGVyXG4gICAgW3RhZ0lkOiBUYWdJRF06IElUYWdBZXN0aGV0aWNzO1xufVxuXG5jb25zdCBUQUdfQUVTVEhFVElDUzogSVRhZ0Flc3RoZXRpY3NNYXAgPSB7XG4gICAgW0RlZmF1bHRUYWdJRC5JbnZpdGVdOiB7XG4gICAgICAgIHNlY3Rpb25MYWJlbDogX3RkKFwiSW52aXRlc1wiKSxcbiAgICAgICAgaXNJbnZpdGU6IHRydWUsXG4gICAgICAgIGRlZmF1bHRIaWRkZW46IGZhbHNlLFxuICAgIH0sXG4gICAgW0RlZmF1bHRUYWdJRC5GYXZvdXJpdGVdOiB7XG4gICAgICAgIHNlY3Rpb25MYWJlbDogX3RkKFwiRmF2b3VyaXRlc1wiKSxcbiAgICAgICAgaXNJbnZpdGU6IGZhbHNlLFxuICAgICAgICBkZWZhdWx0SGlkZGVuOiBmYWxzZSxcbiAgICB9LFxuICAgIFtEZWZhdWx0VGFnSUQuRE1dOiB7XG4gICAgICAgIHNlY3Rpb25MYWJlbDogX3RkKFwiUGVvcGxlXCIpLFxuICAgICAgICBpc0ludml0ZTogZmFsc2UsXG4gICAgICAgIGRlZmF1bHRIaWRkZW46IGZhbHNlLFxuICAgICAgICBhZGRSb29tTGFiZWw6IF90ZChcIlN0YXJ0IGNoYXRcIiksXG4gICAgICAgIG9uQWRkUm9vbTogKGRpc3BhdGNoZXI/OiBEaXNwYXRjaGVyPEFjdGlvblBheWxvYWQ+KSA9PiB7XG4gICAgICAgICAgICAoZGlzcGF0Y2hlciB8fCBkZWZhdWx0RGlzcGF0Y2hlcikuZGlzcGF0Y2goeyBhY3Rpb246ICd2aWV3X2NyZWF0ZV9jaGF0JyB9KTtcbiAgICAgICAgfSxcbiAgICB9LFxuICAgIFtEZWZhdWx0VGFnSUQuVW50YWdnZWRdOiB7XG4gICAgICAgIHNlY3Rpb25MYWJlbDogX3RkKFwiUm9vbXNcIiksXG4gICAgICAgIGlzSW52aXRlOiBmYWxzZSxcbiAgICAgICAgZGVmYXVsdEhpZGRlbjogZmFsc2UsXG4gICAgICAgIGFkZFJvb21MYWJlbDogX3RkKFwiQWRkIHJvb21cIiksXG4gICAgICAgIGFkZFJvb21Db250ZXh0TWVudTogKG9uRmluaXNoZWQ6ICgpID0+IHZvaWQpID0+IHtcbiAgICAgICAgICAgIGlmIChTcGFjZVN0b3JlLmluc3RhbmNlLmFjdGl2ZVNwYWNlUm9vbSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRVc2VySWQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzcGFjZSA9IFNwYWNlU3RvcmUuaW5zdGFuY2UuYWN0aXZlU3BhY2VSb29tO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhbkFkZFJvb21zID0gc3BhY2UuY3VycmVudFN0YXRlLm1heVNlbmRTdGF0ZUV2ZW50KEV2ZW50VHlwZS5TcGFjZUNoaWxkLCB1c2VySWQpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIDxJY29uaXplZENvbnRleHRNZW51T3B0aW9uTGlzdCBmaXJzdD5cbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkU2hvd0NvbXBvbmVudChVSUNvbXBvbmVudC5DcmVhdGVSb29tcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICg8PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiQ3JlYXRlIG5ldyByb29tXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cIm14X1Jvb21MaXN0X2ljb25QbHVzXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GaW5pc2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDcmVhdGVOZXdSb29tKHNwYWNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17IWNhbkFkZFJvb21zfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcD17Y2FuQWRkUm9vbXMgPyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IF90KFwiWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb25zIHRvIGNyZWF0ZSBuZXcgcm9vbXMgaW4gdGhpcyBzcGFjZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVPcHRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdChcIkFkZCBleGlzdGluZyByb29tXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cIm14X1Jvb21MaXN0X2ljb25IYXNoXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GaW5pc2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBZGRFeGlzdGluZ1Jvb21zKHNwYWNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17IWNhbkFkZFJvb21zfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcD17Y2FuQWRkUm9vbXMgPyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IF90KFwiWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb25zIHRvIGFkZCByb29tcyB0byB0aGlzIHNwYWNlXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvPilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiRXhwbG9yZSByb29tc1wiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU9XCJteF9Sb29tTGlzdF9pY29uQnJvd3NlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GaW5pc2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHREaXNwYXRjaGVyLmZpcmUoQWN0aW9uLlZpZXdSb29tRGlyZWN0b3J5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9JY29uaXplZENvbnRleHRNZW51T3B0aW9uTGlzdD47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvbkxpc3QgZmlyc3Q+XG4gICAgICAgICAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVPcHRpb25cbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiQ3JlYXRlIG5ldyByb29tXCIpfVxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwibXhfUm9vbUxpc3RfaWNvblBsdXNcIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRmluaXNoZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHREaXNwYXRjaGVyLmRpc3BhdGNoKHsgYWN0aW9uOiBcInZpZXdfY3JlYXRlX3Jvb21cIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxJY29uaXplZENvbnRleHRNZW51T3B0aW9uXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPXtDb21tdW5pdHlQcm90b3R5cGVTdG9yZS5pbnN0YW5jZS5nZXRTZWxlY3RlZENvbW11bml0eUlkKClcbiAgICAgICAgICAgICAgICAgICAgICAgID8gX3QoXCJFeHBsb3JlIGNvbW11bml0eSByb29tc1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBfdChcIkV4cGxvcmUgcHVibGljIHJvb21zXCIpfVxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwibXhfUm9vbUxpc3RfaWNvbkV4cGxvcmVcIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRmluaXNoZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHREaXNwYXRjaGVyLmZpcmUoQWN0aW9uLlZpZXdSb29tRGlyZWN0b3J5KTtcbiAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9JY29uaXplZENvbnRleHRNZW51T3B0aW9uTGlzdD47XG4gICAgICAgIH0sXG4gICAgfSxcbiAgICBbRGVmYXVsdFRhZ0lELkxvd1ByaW9yaXR5XToge1xuICAgICAgICBzZWN0aW9uTGFiZWw6IF90ZChcIkxvdyBwcmlvcml0eVwiKSxcbiAgICAgICAgaXNJbnZpdGU6IGZhbHNlLFxuICAgICAgICBkZWZhdWx0SGlkZGVuOiBmYWxzZSxcbiAgICB9LFxuICAgIFtEZWZhdWx0VGFnSUQuU2VydmVyTm90aWNlXToge1xuICAgICAgICBzZWN0aW9uTGFiZWw6IF90ZChcIlN5c3RlbSBBbGVydHNcIiksXG4gICAgICAgIGlzSW52aXRlOiBmYWxzZSxcbiAgICAgICAgZGVmYXVsdEhpZGRlbjogZmFsc2UsXG4gICAgfSxcblxuICAgIC8vIFRPRE86IFJlcGxhY2Ugd2l0aCBhcmNoaXZlZCB2aWV3OiBodHRwczovL2dpdGh1Yi5jb20vdmVjdG9yLWltL2VsZW1lbnQtd2ViL2lzc3Vlcy8xNDAzOFxuICAgIFtEZWZhdWx0VGFnSUQuQXJjaGl2ZWRdOiB7XG4gICAgICAgIHNlY3Rpb25MYWJlbDogX3RkKFwiSGlzdG9yaWNhbFwiKSxcbiAgICAgICAgaXNJbnZpdGU6IGZhbHNlLFxuICAgICAgICBkZWZhdWx0SGlkZGVuOiB0cnVlLFxuICAgIH0sXG5cbiAgICBbRGVmYXVsdFRhZ0lELlN1Z2dlc3RlZF06IHtcbiAgICAgICAgc2VjdGlvbkxhYmVsOiBfdGQoXCJTdWdnZXN0ZWQgUm9vbXNcIiksXG4gICAgICAgIGlzSW52aXRlOiBmYWxzZSxcbiAgICAgICAgZGVmYXVsdEhpZGRlbjogZmFsc2UsXG4gICAgfSxcbn07XG5cbmZ1bmN0aW9uIGN1c3RvbVRhZ0Flc3RoZXRpY3ModGFnSWQ6IFRhZ0lEKTogSVRhZ0Flc3RoZXRpY3Mge1xuICAgIGlmICh0YWdJZC5zdGFydHNXaXRoKFwidS5cIikpIHtcbiAgICAgICAgdGFnSWQgPSB0YWdJZC5zdWJzdHJpbmcoMik7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHNlY3Rpb25MYWJlbDogX3RkKFwiQ3VzdG9tIFRhZ1wiKSxcbiAgICAgICAgc2VjdGlvbkxhYmVsUmF3OiB0YWdJZCxcbiAgICAgICAgaXNJbnZpdGU6IGZhbHNlLFxuICAgICAgICBkZWZhdWx0SGlkZGVuOiBmYWxzZSxcbiAgICB9O1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5yb29tcy5Sb29tTGlzdFwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUm9vbUxpc3QgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBkaXNwYXRjaGVyUmVmO1xuICAgIHByaXZhdGUgY3VzdG9tVGFnU3RvcmVSZWY7XG4gICAgcHJpdmF0ZSByb29tU3RvcmVUb2tlbjogZmJFbWl0dGVyLkV2ZW50U3Vic2NyaXB0aW9uO1xuICAgIHByaXZhdGUgdHJlZVJlZiA9IGNyZWF0ZVJlZjxIVE1MRGl2RWxlbWVudD4oKTtcblxuICAgIHN0YXRpYyBjb250ZXh0VHlwZSA9IE1hdHJpeENsaWVudENvbnRleHQ7XG4gICAgcHVibGljIGNvbnRleHQhOiBSZWFjdC5Db250ZXh0VHlwZTx0eXBlb2YgTWF0cml4Q2xpZW50Q29udGV4dD47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc3VibGlzdHM6IHt9LFxuICAgICAgICAgICAgaXNOYW1lRmlsdGVyaW5nOiAhIVJvb21MaXN0U3RvcmUuaW5zdGFuY2UuZ2V0Rmlyc3ROYW1lRmlsdGVyQ29uZGl0aW9uKCksXG4gICAgICAgICAgICBzdWdnZXN0ZWRSb29tczogU3BhY2VTdG9yZS5pbnN0YW5jZS5zdWdnZXN0ZWRSb29tcyxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkTW91bnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hlclJlZiA9IGRlZmF1bHREaXNwYXRjaGVyLnJlZ2lzdGVyKHRoaXMub25BY3Rpb24pO1xuICAgICAgICB0aGlzLnJvb21TdG9yZVRva2VuID0gUm9vbVZpZXdTdG9yZS5hZGRMaXN0ZW5lcih0aGlzLm9uUm9vbVZpZXdTdG9yZVVwZGF0ZSk7XG4gICAgICAgIFNwYWNlU3RvcmUuaW5zdGFuY2Uub24oVVBEQVRFX1NVR0dFU1RFRF9ST09NUywgdGhpcy51cGRhdGVTdWdnZXN0ZWRSb29tcyk7XG4gICAgICAgIFJvb21MaXN0U3RvcmUuaW5zdGFuY2Uub24oTElTVFNfVVBEQVRFX0VWRU5ULCB0aGlzLnVwZGF0ZUxpc3RzKTtcbiAgICAgICAgdGhpcy5jdXN0b21UYWdTdG9yZVJlZiA9IEN1c3RvbVJvb21UYWdTdG9yZS5hZGRMaXN0ZW5lcih0aGlzLnVwZGF0ZUxpc3RzKTtcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0cygpOyAvLyB0cmlnZ2VyIHRoZSBmaXJzdCB1cGRhdGVcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIFNwYWNlU3RvcmUuaW5zdGFuY2Uub2ZmKFVQREFURV9TVUdHRVNURURfUk9PTVMsIHRoaXMudXBkYXRlU3VnZ2VzdGVkUm9vbXMpO1xuICAgICAgICBSb29tTGlzdFN0b3JlLmluc3RhbmNlLm9mZihMSVNUU19VUERBVEVfRVZFTlQsIHRoaXMudXBkYXRlTGlzdHMpO1xuICAgICAgICBkZWZhdWx0RGlzcGF0Y2hlci51bnJlZ2lzdGVyKHRoaXMuZGlzcGF0Y2hlclJlZik7XG4gICAgICAgIGlmICh0aGlzLmN1c3RvbVRhZ1N0b3JlUmVmKSB0aGlzLmN1c3RvbVRhZ1N0b3JlUmVmLnJlbW92ZSgpO1xuICAgICAgICBpZiAodGhpcy5yb29tU3RvcmVUb2tlbikgdGhpcy5yb29tU3RvcmVUb2tlbi5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uUm9vbVZpZXdTdG9yZVVwZGF0ZSA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBjdXJyZW50Um9vbUlkOiBSb29tVmlld1N0b3JlLmdldFJvb21JZCgpLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkFjdGlvbiA9IChwYXlsb2FkOiBBY3Rpb25QYXlsb2FkKSA9PiB7XG4gICAgICAgIGlmIChwYXlsb2FkLmFjdGlvbiA9PT0gQWN0aW9uLlZpZXdSb29tRGVsdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IHZpZXdSb29tRGVsdGFQYXlsb2FkID0gcGF5bG9hZCBhcyBWaWV3Um9vbURlbHRhUGF5bG9hZDtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb29tSWQgPSBSb29tVmlld1N0b3JlLmdldFJvb21JZCgpO1xuICAgICAgICAgICAgY29uc3Qgcm9vbSA9IHRoaXMuZ2V0Um9vbURlbHRhKGN1cnJlbnRSb29tSWQsIHZpZXdSb29tRGVsdGFQYXlsb2FkLmRlbHRhLCB2aWV3Um9vbURlbHRhUGF5bG9hZC51bnJlYWQpO1xuICAgICAgICAgICAgaWYgKHJvb20pIHtcbiAgICAgICAgICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3Um9vbSxcbiAgICAgICAgICAgICAgICAgICAgcm9vbV9pZDogcm9vbS5yb29tSWQsXG4gICAgICAgICAgICAgICAgICAgIHNob3dfcm9vbV90aWxlOiB0cnVlLCAvLyB0byBtYWtlIHN1cmUgdGhlIHJvb20gZ2V0cyBzY3JvbGxlZCBpbnRvIHZpZXdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChwYXlsb2FkLmFjdGlvbiA9PT0gQWN0aW9uLlBzdG5TdXBwb3J0VXBkYXRlZCkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVMaXN0cygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgZ2V0Um9vbURlbHRhID0gKHJvb21JZDogc3RyaW5nLCBkZWx0YTogbnVtYmVyLCB1bnJlYWQgPSBmYWxzZSkgPT4ge1xuICAgICAgICBjb25zdCBsaXN0cyA9IFJvb21MaXN0U3RvcmUuaW5zdGFuY2Uub3JkZXJlZExpc3RzO1xuICAgICAgICBjb25zdCByb29tczogUm9vbVtdID0gW107XG4gICAgICAgIFRBR19PUkRFUi5mb3JFYWNoKHQgPT4ge1xuICAgICAgICAgICAgbGV0IGxpc3RSb29tcyA9IGxpc3RzW3RdO1xuXG4gICAgICAgICAgICBpZiAodW5yZWFkKSB7XG4gICAgICAgICAgICAgICAgLy8gZmlsdGVyIHRvIG9ubHkgbm90aWZpY2F0aW9uIHJvb21zIChhbmQgb3VyIGN1cnJlbnQgYWN0aXZlIHJvb20gc28gd2UgY2FuIGluZGV4IHByb3Blcmx5KVxuICAgICAgICAgICAgICAgIGxpc3RSb29tcyA9IGxpc3RSb29tcy5maWx0ZXIociA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gUm9vbU5vdGlmaWNhdGlvblN0YXRlU3RvcmUuaW5zdGFuY2UuZ2V0Um9vbVN0YXRlKHIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUucm9vbS5yb29tSWQgPT09IHJvb21JZCB8fCBzdGF0ZS5pc1VucmVhZDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcm9vbXMucHVzaCguLi5saXN0Um9vbXMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjdXJyZW50SW5kZXggPSByb29tcy5maW5kSW5kZXgociA9PiByLnJvb21JZCA9PT0gcm9vbUlkKTtcbiAgICAgICAgLy8gdXNlIHNsaWNlIHRvIGFjY291bnQgZm9yIGxvb3BpbmcgYXJvdW5kIHRoZSBzdGFydFxuICAgICAgICBjb25zdCBbcm9vbV0gPSByb29tcy5zbGljZSgoY3VycmVudEluZGV4ICsgZGVsdGEpICUgcm9vbXMubGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIHJvb207XG4gICAgfTtcblxuICAgIHByaXZhdGUgdXBkYXRlU3VnZ2VzdGVkUm9vbXMgPSAoc3VnZ2VzdGVkUm9vbXM6IElTdWdnZXN0ZWRSb29tW10pID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHN1Z2dlc3RlZFJvb21zIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHVwZGF0ZUxpc3RzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBuZXdMaXN0cyA9IFJvb21MaXN0U3RvcmUuaW5zdGFuY2Uub3JkZXJlZExpc3RzO1xuICAgICAgICBjb25zdCBwcmV2aW91c0xpc3RJZHMgPSBPYmplY3Qua2V5cyh0aGlzLnN0YXRlLnN1Ymxpc3RzKTtcbiAgICAgICAgY29uc3QgbmV3TGlzdElkcyA9IE9iamVjdC5rZXlzKG5ld0xpc3RzKS5maWx0ZXIodCA9PiB7XG4gICAgICAgICAgICBpZiAoIWlzQ3VzdG9tVGFnKHQpKSByZXR1cm4gdHJ1ZTsgLy8gYWx3YXlzIGluY2x1ZGUgbm9uLWN1c3RvbSB0YWdzXG5cbiAgICAgICAgICAgIC8vIGlmIHRoZSB0YWcgaXMgY3VzdG9tIHRob3VnaCwgb25seSBpbmNsdWRlIGl0IGlmIGl0IGlzIGVuYWJsZWRcbiAgICAgICAgICAgIHJldHVybiBDdXN0b21Sb29tVGFnU3RvcmUuZ2V0VGFncygpW3RdO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBpc05hbWVGaWx0ZXJpbmcgPSAhIVJvb21MaXN0U3RvcmUuaW5zdGFuY2UuZ2V0Rmlyc3ROYW1lRmlsdGVyQ29uZGl0aW9uKCk7XG4gICAgICAgIGxldCBkb1VwZGF0ZSA9IHRoaXMuc3RhdGUuaXNOYW1lRmlsdGVyaW5nICE9PSBpc05hbWVGaWx0ZXJpbmcgfHwgYXJyYXlIYXNEaWZmKHByZXZpb3VzTGlzdElkcywgbmV3TGlzdElkcyk7XG4gICAgICAgIGlmICghZG9VcGRhdGUpIHtcbiAgICAgICAgICAgIC8vIHNvIHdlIGRpZG4ndCBoYXZlIHRoZSB2aXNpYmxlIHN1Ymxpc3RzIGNoYW5nZSwgYnV0IGRpZCB0aGUgY29udGVudHMgb2YgdGhvc2VcbiAgICAgICAgICAgIC8vIHN1Ymxpc3RzIGNoYW5nZSBzaWduaWZpY2FudGx5IGVub3VnaCB0byBicmVhayB0aGUgc3RpY2t5IGhlYWRlcnM/IFByb2JhYmx5LCBzb1xuICAgICAgICAgICAgLy8gbGV0J3MgY2hlY2sgdGhlIGxlbmd0aCBvZiBlYWNoLlxuICAgICAgICAgICAgZm9yIChjb25zdCB0YWdJZCBvZiBuZXdMaXN0SWRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2xkUm9vbXMgPSB0aGlzLnN0YXRlLnN1Ymxpc3RzW3RhZ0lkXTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdSb29tcyA9IG5ld0xpc3RzW3RhZ0lkXTtcbiAgICAgICAgICAgICAgICBpZiAob2xkUm9vbXMubGVuZ3RoICE9PSBuZXdSb29tcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9VcGRhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZG9VcGRhdGUpIHtcbiAgICAgICAgICAgIC8vIFdlIGhhdmUgdG8gYnJlYWsgb3VyIHJlZmVyZW5jZSB0byB0aGUgcm9vbSBsaXN0IHN0b3JlIGlmIHdlIHdhbnQgdG8gYmUgYWJsZSB0b1xuICAgICAgICAgICAgLy8gZGlmZiB0aGUgb2JqZWN0IGZvciBjaGFuZ2VzLCBzbyBkbyB0aGF0LlxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZSAtIElUYWdNYXAgaXMgdHMtaWdub3JlZCBzbyB0aGlzIHdpbGwgaGF2ZSB0byBiZSB0b29cbiAgICAgICAgICAgIGNvbnN0IG5ld1N1Ymxpc3RzID0gb2JqZWN0V2l0aE9ubHkobmV3TGlzdHMsIG5ld0xpc3RJZHMpO1xuICAgICAgICAgICAgY29uc3Qgc3VibGlzdHMgPSBvYmplY3RTaGFsbG93Q2xvbmUobmV3U3VibGlzdHMsIChrLCB2KSA9PiBhcnJheUZhc3RDbG9uZSh2KSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzdWJsaXN0cywgaXNOYW1lRmlsdGVyaW5nIH0sICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLm9uUmVzaXplKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU3RhcnRDaGF0ID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBpbml0aWFsVGV4dCA9IFJvb21MaXN0U3RvcmUuaW5zdGFuY2UuZ2V0Rmlyc3ROYW1lRmlsdGVyQ29uZGl0aW9uKCk/LnNlYXJjaDtcbiAgICAgICAgZGlzLmRpc3BhdGNoKHsgYWN0aW9uOiBcInZpZXdfY3JlYXRlX2NoYXRcIiwgaW5pdGlhbFRleHQgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25FeHBsb3JlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBpbml0aWFsVGV4dCA9IFJvb21MaXN0U3RvcmUuaW5zdGFuY2UuZ2V0Rmlyc3ROYW1lRmlsdGVyQ29uZGl0aW9uKCk/LnNlYXJjaDtcbiAgICAgICAgZGlzLmRpc3BhdGNoKHsgYWN0aW9uOiBBY3Rpb24uVmlld1Jvb21EaXJlY3RvcnksIGluaXRpYWxUZXh0IH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU3BhY2VJbnZpdGVDbGljayA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgaW5pdGlhbFRleHQgPSBSb29tTGlzdFN0b3JlLmluc3RhbmNlLmdldEZpcnN0TmFtZUZpbHRlckNvbmRpdGlvbigpPy5zZWFyY2g7XG4gICAgICAgIHNob3dTcGFjZUludml0ZSh0aGlzLmNvbnRleHQuZ2V0Um9vbSh0aGlzLnByb3BzLmFjdGl2ZVNwYWNlKSwgaW5pdGlhbFRleHQpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHJlbmRlclN1Z2dlc3RlZFJvb21zKCk6IFJlYWN0Q29tcG9uZW50RWxlbWVudDx0eXBlb2YgRXh0cmFUaWxlPltdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuc3VnZ2VzdGVkUm9vbXMubWFwKHJvb20gPT4ge1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IHJvb20ubmFtZSB8fCByb29tLmNhbm9uaWNhbF9hbGlhcyB8fCByb29tLmFsaWFzZXM/LlswXSB8fCBfdChcIkVtcHR5IHJvb21cIik7XG4gICAgICAgICAgICBjb25zdCBhdmF0YXIgPSAoXG4gICAgICAgICAgICAgICAgPFJvb21BdmF0YXJcbiAgICAgICAgICAgICAgICAgICAgb29iRGF0YT17e1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhclVybDogcm9vbS5hdmF0YXJfdXJsLFxuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICB3aWR0aD17MzJ9XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodD17MzJ9XG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZU1ldGhvZD1cImNyb3BcIlxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3Qgdmlld1Jvb20gPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVmYXVsdERpc3BhdGNoZXIuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IFwidmlld19yb29tXCIsXG4gICAgICAgICAgICAgICAgICAgIHJvb21fYWxpYXM6IHJvb20uY2Fub25pY2FsX2FsaWFzIHx8IHJvb20uYWxpYXNlcz8uWzBdLFxuICAgICAgICAgICAgICAgICAgICByb29tX2lkOiByb29tLnJvb21faWQsXG4gICAgICAgICAgICAgICAgICAgIHZpYV9zZXJ2ZXJzOiByb29tLnZpYVNlcnZlcnMsXG4gICAgICAgICAgICAgICAgICAgIG9vYkRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhclVybDogcm9vbS5hdmF0YXJfdXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxFeHRyYVRpbGVcbiAgICAgICAgICAgICAgICAgICAgaXNNaW5pbWl6ZWQ9e3RoaXMucHJvcHMuaXNNaW5pbWl6ZWR9XG4gICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ9e3RoaXMuc3RhdGUuY3VycmVudFJvb21JZCA9PT0gcm9vbS5yb29tX2lkfVxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZT17bmFtZX1cbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyPXthdmF0YXJ9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3ZpZXdSb29tfVxuICAgICAgICAgICAgICAgICAgICBrZXk9e2BzdWdnZXN0ZWRSb29tVGlsZV8ke3Jvb20ucm9vbV9pZH1gfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlckNvbW11bml0eUludml0ZXMoKTogUmVhY3RDb21wb25lbnRFbGVtZW50PHR5cGVvZiBFeHRyYVRpbGU+W10ge1xuICAgICAgICBpZiAoU3BhY2VTdG9yZS5zcGFjZXNFbmFibGVkKSByZXR1cm4gW107XG4gICAgICAgIC8vIFRPRE86IFB1dCBjb21tdW5pdHkgaW52aXRlcyBpbiBhIG1vcmUgc2Vuc2libGUgcGxhY2UgKG5vdCBpbiB0aGUgcm9vbSBsaXN0KVxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3ZlY3Rvci1pbS9lbGVtZW50LXdlYi9pc3N1ZXMvMTQ0NTZcbiAgICAgICAgcmV0dXJuIE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRHcm91cHMoKS5maWx0ZXIoZyA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZy5teU1lbWJlcnNoaXAgPT09ICdpbnZpdGUnO1xuICAgICAgICB9KS5tYXAoZyA9PiB7XG4gICAgICAgICAgICBjb25zdCBhdmF0YXIgPSAoXG4gICAgICAgICAgICAgICAgPEdyb3VwQXZhdGFyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwSWQ9e2cuZ3JvdXBJZH1cbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBOYW1lPXtnLm5hbWV9XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwQXZhdGFyVXJsPXtnLmF2YXRhclVybH1cbiAgICAgICAgICAgICAgICAgICAgd2lkdGg9ezMyfVxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ9ezMyfVxuICAgICAgICAgICAgICAgICAgICByZXNpemVNZXRob2Q9J2Nyb3AnXG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCBvcGVuR3JvdXAgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVmYXVsdERpc3BhdGNoZXIuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICd2aWV3X2dyb3VwJyxcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBfaWQ6IGcuZ3JvdXBJZCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxFeHRyYVRpbGVcbiAgICAgICAgICAgICAgICAgICAgaXNNaW5pbWl6ZWQ9e3RoaXMucHJvcHMuaXNNaW5pbWl6ZWR9XG4gICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ9e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZT17Zy5uYW1lfVxuICAgICAgICAgICAgICAgICAgICBhdmF0YXI9e2F2YXRhcn1cbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU3RhdGU9e1N0YXRpY05vdGlmaWNhdGlvblN0YXRlLlJFRF9FWENMQU1BVElPTn1cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17b3Blbkdyb3VwfVxuICAgICAgICAgICAgICAgICAgICBrZXk9e2B0ZW1wb3JhcnlHcm91cFRpbGVfJHtnLmdyb3VwSWR9YH1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJTdWJsaXN0cygpOiBSZWFjdC5SZWFjdEVsZW1lbnRbXSB7XG4gICAgICAgIC8vIHNob3cgYSBza2VsZXRvbiBVSSBpZiB0aGUgdXNlciBpcyBpbiBubyByb29tcyBhbmQgdGhleSBhcmUgbm90IGZpbHRlcmluZyBhbmQgaGF2ZSBubyBzdWdnZXN0ZWQgcm9vbXNcbiAgICAgICAgY29uc3Qgc2hvd1NrZWxldG9uID0gIXRoaXMuc3RhdGUuaXNOYW1lRmlsdGVyaW5nICYmICF0aGlzLnN0YXRlLnN1Z2dlc3RlZFJvb21zPy5sZW5ndGggJiZcbiAgICAgICAgICAgIE9iamVjdC52YWx1ZXMoUm9vbUxpc3RTdG9yZS5pbnN0YW5jZS51bmZpbHRlcmVkTGlzdHMpLmV2ZXJ5KGxpc3QgPT4gIWxpc3Q/Lmxlbmd0aCk7XG5cbiAgICAgICAgcmV0dXJuIFRBR19PUkRFUi5yZWR1Y2UoKHRhZ3MsIHRhZ0lkKSA9PiB7XG4gICAgICAgICAgICBpZiAodGFnSWQgPT09IENVU1RPTV9UQUdTX0JFRk9SRV9UQUcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXN0b21UYWdzID0gT2JqZWN0LmtleXModGhpcy5zdGF0ZS5zdWJsaXN0cylcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcih0YWdJZCA9PiBpc0N1c3RvbVRhZyh0YWdJZCkpO1xuICAgICAgICAgICAgICAgIHRhZ3MucHVzaCguLi5jdXN0b21UYWdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhZ3MucHVzaCh0YWdJZCk7XG4gICAgICAgICAgICByZXR1cm4gdGFncztcbiAgICAgICAgfSwgW10gYXMgVGFnSURbXSlcbiAgICAgICAgICAgIC5tYXAob3JkZXJlZFRhZ0lkID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZXh0cmFUaWxlcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKG9yZGVyZWRUYWdJZCA9PT0gRGVmYXVsdFRhZ0lELkludml0ZSkge1xuICAgICAgICAgICAgICAgICAgICBleHRyYVRpbGVzID0gdGhpcy5yZW5kZXJDb21tdW5pdHlJbnZpdGVzKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcmRlcmVkVGFnSWQgPT09IERlZmF1bHRUYWdJRC5TdWdnZXN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXh0cmFUaWxlcyA9IHRoaXMucmVuZGVyU3VnZ2VzdGVkUm9vbXMoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBhZXN0aGV0aWNzOiBJVGFnQWVzdGhldGljcyA9IGlzQ3VzdG9tVGFnKG9yZGVyZWRUYWdJZClcbiAgICAgICAgICAgICAgICAgICAgPyBjdXN0b21UYWdBZXN0aGV0aWNzKG9yZGVyZWRUYWdJZClcbiAgICAgICAgICAgICAgICAgICAgOiBUQUdfQUVTVEhFVElDU1tvcmRlcmVkVGFnSWRdO1xuICAgICAgICAgICAgICAgIGlmICghYWVzdGhldGljcykgdGhyb3cgbmV3IEVycm9yKGBUYWcgJHtvcmRlcmVkVGFnSWR9IGRvZXMgbm90IGhhdmUgYWVzdGhldGljc2ApO1xuXG4gICAgICAgICAgICAgICAgbGV0IGFsd2F5c1Zpc2libGUgPSBBTFdBWVNfVklTSUJMRV9UQUdTLmluY2x1ZGVzKG9yZGVyZWRUYWdJZCk7XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAodGhpcy5wcm9wcy5hY3RpdmVTcGFjZSA9PT0gTWV0YVNwYWNlLkZhdm91cml0ZXMgJiYgb3JkZXJlZFRhZ0lkICE9PSBEZWZhdWx0VGFnSUQuRmF2b3VyaXRlKSB8fFxuICAgICAgICAgICAgICAgICAgICAodGhpcy5wcm9wcy5hY3RpdmVTcGFjZSA9PT0gTWV0YVNwYWNlLlBlb3BsZSAmJiBvcmRlcmVkVGFnSWQgIT09IERlZmF1bHRUYWdJRC5ETSkgfHxcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMucHJvcHMuYWN0aXZlU3BhY2UgPT09IE1ldGFTcGFjZS5PcnBoYW5zICYmIG9yZGVyZWRUYWdJZCA9PT0gRGVmYXVsdFRhZ0lELkRNKVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBhbHdheXNWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVGhlIGNvc3Qgb2YgbW91bnRpbmcvdW5tb3VudGluZyB0aGlzIGNvbXBvbmVudCBvZmZzZXRzIHRoZSBjb3N0XG4gICAgICAgICAgICAgICAgLy8gb2Yga2VlcGluZyBpdCBpbiB0aGUgRE9NIGFuZCBoaWRpbmcgaXQgd2hlbiBpdCBpcyBub3QgcmVxdWlyZWRcbiAgICAgICAgICAgICAgICByZXR1cm4gPFJvb21TdWJsaXN0XG4gICAgICAgICAgICAgICAgICAgIGtleT17YHN1Ymxpc3QtJHtvcmRlcmVkVGFnSWR9YH1cbiAgICAgICAgICAgICAgICAgICAgdGFnSWQ9e29yZGVyZWRUYWdJZH1cbiAgICAgICAgICAgICAgICAgICAgZm9yUm9vbXM9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0QXNIaWRkZW49e2Flc3RoZXRpY3MuZGVmYXVsdEhpZGRlbn1cbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e2Flc3RoZXRpY3Muc2VjdGlvbkxhYmVsUmF3ID8gYWVzdGhldGljcy5zZWN0aW9uTGFiZWxSYXcgOiBfdChhZXN0aGV0aWNzLnNlY3Rpb25MYWJlbCl9XG4gICAgICAgICAgICAgICAgICAgIG9uQWRkUm9vbT17YWVzdGhldGljcy5vbkFkZFJvb219XG4gICAgICAgICAgICAgICAgICAgIGFkZFJvb21MYWJlbD17YWVzdGhldGljcy5hZGRSb29tTGFiZWwgPyBfdChhZXN0aGV0aWNzLmFkZFJvb21MYWJlbCkgOiBhZXN0aGV0aWNzLmFkZFJvb21MYWJlbH1cbiAgICAgICAgICAgICAgICAgICAgYWRkUm9vbUNvbnRleHRNZW51PXthZXN0aGV0aWNzLmFkZFJvb21Db250ZXh0TWVudX1cbiAgICAgICAgICAgICAgICAgICAgaXNNaW5pbWl6ZWQ9e3RoaXMucHJvcHMuaXNNaW5pbWl6ZWR9XG4gICAgICAgICAgICAgICAgICAgIHNob3dTa2VsZXRvbj17c2hvd1NrZWxldG9ufVxuICAgICAgICAgICAgICAgICAgICBleHRyYVRpbGVzPXtleHRyYVRpbGVzfVxuICAgICAgICAgICAgICAgICAgICByZXNpemVOb3RpZmllcj17dGhpcy5wcm9wcy5yZXNpemVOb3RpZmllcn1cbiAgICAgICAgICAgICAgICAgICAgYWx3YXlzVmlzaWJsZT17YWx3YXlzVmlzaWJsZX1cbiAgICAgICAgICAgICAgICAgICAgb25MaXN0Q29sbGFwc2U9e3RoaXMucHJvcHMub25MaXN0Q29sbGFwc2V9XG4gICAgICAgICAgICAgICAgLz47XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZm9jdXMoKTogdm9pZCB7XG4gICAgICAgIC8vIGZvY3VzIHRoZSBmaXJzdCBmb2N1c2FibGUgZWxlbWVudCBpbiB0aGlzIGFyaWEgdHJlZXZpZXcgd2lkZ2V0XG4gICAgICAgIFsuLi50aGlzLnRyZWVSZWYuY3VycmVudD8ucXVlcnlTZWxlY3RvckFsbDxIVE1MRWxlbWVudD4oJ1tyb2xlPVwidHJlZWl0ZW1cIl0nKV1cbiAgICAgICAgICAgIC5maW5kKGUgPT4gZS5vZmZzZXRQYXJlbnQgIT09IG51bGwpPy5mb2N1cygpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgY29uc3QgdXNlcklkID0gY2xpLmdldFVzZXJJZCgpO1xuICAgICAgICBjb25zdCBhY3RpdmVTcGFjZSA9IHRoaXMucHJvcHMuYWN0aXZlU3BhY2VbMF0gPT09IFwiIVwiID8gY2xpLmdldFJvb20odGhpcy5wcm9wcy5hY3RpdmVTcGFjZSkgOiBudWxsO1xuXG4gICAgICAgIGxldCBleHBsb3JlUHJvbXB0OiBKU1guRWxlbWVudDtcbiAgICAgICAgaWYgKCF0aGlzLnByb3BzLmlzTWluaW1pemVkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc05hbWVGaWx0ZXJpbmcpIHtcbiAgICAgICAgICAgICAgICBleHBsb3JlUHJvbXB0ID0gPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tTGlzdF9leHBsb3JlUHJvbXB0XCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXY+eyBfdChcIkNhbid0IHNlZSB3aGF0IHlvdSdyZSBsb29raW5nIGZvcj9cIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUm9vbUxpc3RfZXhwbG9yZVByb21wdF9zdGFydENoYXRcIlxuICAgICAgICAgICAgICAgICAgICAgICAga2luZD1cImxpbmtcIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vblN0YXJ0Q2hhdH1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIlN0YXJ0IGEgbmV3IGNoYXRcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Sb29tTGlzdF9leHBsb3JlUHJvbXB0X2V4cGxvcmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAga2luZD1cImxpbmtcIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkV4cGxvcmV9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgYWN0aXZlU3BhY2UgPyBfdChcIkV4cGxvcmUgcm9vbXNcIikgOiBfdChcIkV4cGxvcmUgYWxsIHB1YmxpYyByb29tc1wiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgIGFjdGl2ZVNwYWNlPy5jYW5JbnZpdGUodXNlcklkKSB8fFxuICAgICAgICAgICAgICAgIGFjdGl2ZVNwYWNlPy5nZXRNeU1lbWJlcnNoaXAoKSA9PT0gXCJqb2luXCIgfHxcbiAgICAgICAgICAgICAgICBhY3RpdmVTcGFjZT8uZ2V0Sm9pblJ1bGUoKSA9PT0gSm9pblJ1bGUuUHVibGljXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzcGFjZU5hbWUgPSBhY3RpdmVTcGFjZS5uYW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhbkludml0ZSA9IGFjdGl2ZVNwYWNlPy5jYW5JbnZpdGUodXNlcklkKSB8fCBhY3RpdmVTcGFjZT8uZ2V0Sm9pblJ1bGUoKSA9PT0gSm9pblJ1bGUuUHVibGljO1xuICAgICAgICAgICAgICAgIGV4cGxvcmVQcm9tcHQgPSA8ZGl2IGNsYXNzTmFtZT1cIm14X1Jvb21MaXN0X2V4cGxvcmVQcm9tcHRcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj57IF90KFwiUXVpY2sgYWN0aW9uc1wiKSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIHsgY2FuSW52aXRlICYmIDxBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUm9vbUxpc3RfZXhwbG9yZVByb21wdF9zcGFjZUludml0ZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uU3BhY2VJbnZpdGVDbGlja31cbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcIkludml0ZSB0byAlKHNwYWNlTmFtZSlzXCIsIHsgc3BhY2VOYW1lIH0pfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiSW52aXRlIHBlb3BsZVwiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24+IH1cbiAgICAgICAgICAgICAgICAgICAgeyBhY3RpdmVTcGFjZT8uZ2V0TXlNZW1iZXJzaGlwKCkgPT09IFwiam9pblwiICYmIDxBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUm9vbUxpc3RfZXhwbG9yZVByb21wdF9zcGFjZUV4cGxvcmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkV4cGxvcmV9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJFeHBsb3JlICUoc3BhY2VOYW1lKXNcIiwgeyBzcGFjZU5hbWUgfSl9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJFeHBsb3JlIHJvb21zXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvbj4gfVxuICAgICAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LnZhbHVlcyh0aGlzLnN0YXRlLnN1Ymxpc3RzKS5zb21lKGxpc3QgPT4gbGlzdC5sZW5ndGggPiAwKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVuZmlsdGVyZWRMaXN0cyA9IFJvb21MaXN0U3RvcmUuaW5zdGFuY2UudW5maWx0ZXJlZExpc3RzO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVuZmlsdGVyZWRSb29tcyA9IHVuZmlsdGVyZWRMaXN0c1tEZWZhdWx0VGFnSUQuVW50YWdnZWRdIHx8IFtdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVuZmlsdGVyZWRIaXN0b3JpY2FsID0gdW5maWx0ZXJlZExpc3RzW0RlZmF1bHRUYWdJRC5BcmNoaXZlZF0gfHwgW107XG4gICAgICAgICAgICAgICAgY29uc3QgdW5maWx0ZXJlZEZhdm91cml0ZSA9IHVuZmlsdGVyZWRMaXN0c1tEZWZhdWx0VGFnSUQuRmF2b3VyaXRlXSB8fCBbXTtcbiAgICAgICAgICAgICAgICAvLyBzaG93IGEgcHJvbXB0IHRvIGpvaW4vY3JlYXRlIHJvb21zIGlmIHRoZSB1c2VyIGlzIGluIDAgcm9vbXMgYW5kIG5vIGhpc3RvcmljYWxcbiAgICAgICAgICAgICAgICBpZiAodW5maWx0ZXJlZFJvb21zLmxlbmd0aCA8IDEgJiYgdW5maWx0ZXJlZEhpc3RvcmljYWwubGVuZ3RoIDwgMSAmJiB1bmZpbHRlcmVkRmF2b3VyaXRlLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwbG9yZVByb21wdCA9IDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbUxpc3RfZXhwbG9yZVByb21wdFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj57IF90KFwiVXNlIHRoZSArIHRvIG1ha2UgYSBuZXcgcm9vbSBvciBleHBsb3JlIGV4aXN0aW5nIG9uZXMgYmVsb3dcIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Sb29tTGlzdF9leHBsb3JlUHJvbXB0X3N0YXJ0Q2hhdFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2luZD1cImxpbmtcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25TdGFydENoYXR9XG4gICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIlN0YXJ0IGEgbmV3IGNoYXRcIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Sb29tTGlzdF9leHBsb3JlUHJvbXB0X2V4cGxvcmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ9XCJsaW5rXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uRXhwbG9yZX1cbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiRXhwbG9yZSBhbGwgcHVibGljIHJvb21zXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN1Ymxpc3RzID0gdGhpcy5yZW5kZXJTdWJsaXN0cygpO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPFJvdmluZ1RhYkluZGV4UHJvdmlkZXIgaGFuZGxlSG9tZUVuZCBoYW5kbGVVcERvd24gb25LZXlEb3duPXt0aGlzLnByb3BzLm9uS2V5RG93bn0+XG4gICAgICAgICAgICAgICAgeyAoeyBvbktleURvd25IYW5kbGVyIH0pID0+IChcbiAgICAgICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgICAgICAgb25Gb2N1cz17dGhpcy5wcm9wcy5vbkZvY3VzfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25CbHVyPXt0aGlzLnByb3BzLm9uQmx1cn1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uS2V5RG93bj17b25LZXlEb3duSGFuZGxlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1Jvb21MaXN0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU9XCJ0cmVlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e190KFwiUm9vbXNcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICByZWY9e3RoaXMudHJlZVJlZn1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBzdWJsaXN0cyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB7IGV4cGxvcmVQcm9tcHQgfVxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgIDwvUm92aW5nVGFiSW5kZXhQcm92aWRlcj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=