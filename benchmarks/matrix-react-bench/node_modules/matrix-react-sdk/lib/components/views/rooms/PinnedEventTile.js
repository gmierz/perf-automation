"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _actions = require("../../../dispatcher/actions");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _MessageEvent = _interopRequireDefault(require("../messages/MessageEvent"));

var _MemberAvatar = _interopRequireDefault(require("../avatars/MemberAvatar"));

var _languageHandler = require("../../../languageHandler");

var _DateUtils = require("../../../DateUtils");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _FormattingUtils = require("../../../utils/FormattingUtils");

var _AccessibleTooltipButton = _interopRequireDefault(require("../elements/AccessibleTooltipButton"));

var _EventTile = require("./EventTile");

var _dec, _class, _class2, _temp;

const AVATAR_SIZE = 24;
let PinnedEventTile = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.PinnedEventTile"), _dec(_class = (_temp = _class2 = class PinnedEventTile extends _react.default.Component {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "onTileClicked", () => {
      _dispatcher.default.dispatch({
        action: _actions.Action.ViewRoom,
        event_id: this.props.event.getId(),
        highlighted: true,
        room_id: this.props.event.getRoomId()
      });
    });
  }

  render() {
    const sender = this.props.event.getSender();
    const senderProfile = this.props.room.getMember(sender);
    let unpinButton = null;

    if (this.props.onUnpinClicked) {
      unpinButton = /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
        onClick: this.props.onUnpinClicked,
        className: "mx_PinnedEventTile_unpinButton",
        title: (0, _languageHandler._t)("Unpin")
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_PinnedEventTile"
    }, /*#__PURE__*/_react.default.createElement(_MemberAvatar.default, {
      className: "mx_PinnedEventTile_senderAvatar",
      member: senderProfile,
      width: AVATAR_SIZE,
      height: AVATAR_SIZE,
      fallbackUserId: sender
    }), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_PinnedEventTile_sender " + (0, _FormattingUtils.getUserNameColorClass)(sender)
    }, (senderProfile === null || senderProfile === void 0 ? void 0 : senderProfile.name) || sender), unpinButton, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_PinnedEventTile_message"
    }, /*#__PURE__*/_react.default.createElement(_MessageEvent.default, {
      mxEvent: this.props.event // @ts-ignore - complaining that className is invalid when it's not
      ,
      className: "mx_PinnedEventTile_body",
      maxImageHeight: 150,
      onHeightChanged: () => {} // we need to give this, apparently
      ,
      tileShape: _EventTile.TileShape.Pinned
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_PinnedEventTile_footer"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_PinnedEventTile_timestamp"
    }, (0, _DateUtils.formatDate)(new Date(this.props.event.getTs()))), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onTileClicked,
      kind: "link"
    }, (0, _languageHandler._t)("View message"))));
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _MatrixClientContext.default), _temp)) || _class);
exports.default = PinnedEventTile;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL1Bpbm5lZEV2ZW50VGlsZS50c3giXSwibmFtZXMiOlsiQVZBVEFSX1NJWkUiLCJQaW5uZWRFdmVudFRpbGUiLCJSZWFjdCIsIkNvbXBvbmVudCIsImRpcyIsImRpc3BhdGNoIiwiYWN0aW9uIiwiQWN0aW9uIiwiVmlld1Jvb20iLCJldmVudF9pZCIsInByb3BzIiwiZXZlbnQiLCJnZXRJZCIsImhpZ2hsaWdodGVkIiwicm9vbV9pZCIsImdldFJvb21JZCIsInJlbmRlciIsInNlbmRlciIsImdldFNlbmRlciIsInNlbmRlclByb2ZpbGUiLCJyb29tIiwiZ2V0TWVtYmVyIiwidW5waW5CdXR0b24iLCJvblVucGluQ2xpY2tlZCIsIm5hbWUiLCJUaWxlU2hhcGUiLCJQaW5uZWQiLCJEYXRlIiwiZ2V0VHMiLCJvblRpbGVDbGlja2VkIiwiTWF0cml4Q2xpZW50Q29udGV4dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBSUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFRQSxNQUFNQSxXQUFXLEdBQUcsRUFBcEI7SUFHcUJDLGUsV0FEcEIsZ0RBQXFCLDZCQUFyQixDLG1DQUFELE1BQ3FCQSxlQURyQixTQUM2Q0MsZUFBTUMsU0FEbkQsQ0FDcUU7QUFBQTtBQUFBO0FBQUEseURBR3pDLE1BQU07QUFDMUJDLDBCQUFJQyxRQUFKLENBQWE7QUFDVEMsUUFBQUEsTUFBTSxFQUFFQyxnQkFBT0MsUUFETjtBQUVUQyxRQUFBQSxRQUFRLEVBQUUsS0FBS0MsS0FBTCxDQUFXQyxLQUFYLENBQWlCQyxLQUFqQixFQUZEO0FBR1RDLFFBQUFBLFdBQVcsRUFBRSxJQUhKO0FBSVRDLFFBQUFBLE9BQU8sRUFBRSxLQUFLSixLQUFMLENBQVdDLEtBQVgsQ0FBaUJJLFNBQWpCO0FBSkEsT0FBYjtBQU1ILEtBVmdFO0FBQUE7O0FBWWpFQyxFQUFBQSxNQUFNLEdBQUc7QUFDTCxVQUFNQyxNQUFNLEdBQUcsS0FBS1AsS0FBTCxDQUFXQyxLQUFYLENBQWlCTyxTQUFqQixFQUFmO0FBQ0EsVUFBTUMsYUFBYSxHQUFHLEtBQUtULEtBQUwsQ0FBV1UsSUFBWCxDQUFnQkMsU0FBaEIsQ0FBMEJKLE1BQTFCLENBQXRCO0FBRUEsUUFBSUssV0FBVyxHQUFHLElBQWxCOztBQUNBLFFBQUksS0FBS1osS0FBTCxDQUFXYSxjQUFmLEVBQStCO0FBQzNCRCxNQUFBQSxXQUFXLGdCQUNQLDZCQUFDLGdDQUFEO0FBQ0ksUUFBQSxPQUFPLEVBQUUsS0FBS1osS0FBTCxDQUFXYSxjQUR4QjtBQUVJLFFBQUEsU0FBUyxFQUFDLGdDQUZkO0FBR0ksUUFBQSxLQUFLLEVBQUUseUJBQUcsT0FBSDtBQUhYLFFBREo7QUFPSDs7QUFFRCx3QkFBTztBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsb0JBQ0gsNkJBQUMscUJBQUQ7QUFDSSxNQUFBLFNBQVMsRUFBQyxpQ0FEZDtBQUVJLE1BQUEsTUFBTSxFQUFFSixhQUZaO0FBR0ksTUFBQSxLQUFLLEVBQUVuQixXQUhYO0FBSUksTUFBQSxNQUFNLEVBQUVBLFdBSlo7QUFLSSxNQUFBLGNBQWMsRUFBRWlCO0FBTHBCLE1BREcsZUFTSDtBQUFNLE1BQUEsU0FBUyxFQUFFLCtCQUErQiw0Q0FBc0JBLE1BQXRCO0FBQWhELE9BQ00sQ0FBQUUsYUFBYSxTQUFiLElBQUFBLGFBQWEsV0FBYixZQUFBQSxhQUFhLENBQUVLLElBQWYsS0FBdUJQLE1BRDdCLENBVEcsRUFhREssV0FiQyxlQWVIO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSSw2QkFBQyxxQkFBRDtBQUNJLE1BQUEsT0FBTyxFQUFFLEtBQUtaLEtBQUwsQ0FBV0MsS0FEeEIsQ0FFSTtBQUZKO0FBR0ksTUFBQSxTQUFTLEVBQUMseUJBSGQ7QUFJSSxNQUFBLGNBQWMsRUFBRSxHQUpwQjtBQUtJLE1BQUEsZUFBZSxFQUFFLE1BQU0sQ0FBRSxDQUw3QixDQUsrQjtBQUwvQjtBQU1JLE1BQUEsU0FBUyxFQUFFYyxxQkFBVUM7QUFOekIsTUFESixDQWZHLGVBMEJIO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSTtBQUFNLE1BQUEsU0FBUyxFQUFDO0FBQWhCLE9BQ00sMkJBQVcsSUFBSUMsSUFBSixDQUFTLEtBQUtqQixLQUFMLENBQVdDLEtBQVgsQ0FBaUJpQixLQUFqQixFQUFULENBQVgsQ0FETixDQURKLGVBS0ksNkJBQUMseUJBQUQ7QUFBa0IsTUFBQSxPQUFPLEVBQUUsS0FBS0MsYUFBaEM7QUFBK0MsTUFBQSxJQUFJLEVBQUM7QUFBcEQsT0FDTSx5QkFBRyxjQUFILENBRE4sQ0FMSixDQTFCRyxDQUFQO0FBb0NIOztBQS9EZ0UsQyx3REFDckNDLDRCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE3IFRyYXZpcyBSYWxzdG9uXG5Db3B5cmlnaHQgMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IFJvb20gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb21cIjtcbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudFwiO1xuXG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgTWVzc2FnZUV2ZW50IGZyb20gXCIuLi9tZXNzYWdlcy9NZXNzYWdlRXZlbnRcIjtcbmltcG9ydCBNZW1iZXJBdmF0YXIgZnJvbSBcIi4uL2F2YXRhcnMvTWVtYmVyQXZhdGFyXCI7XG5pbXBvcnQgeyBfdCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgeyBmb3JtYXREYXRlIH0gZnJvbSAnLi4vLi4vLi4vRGF0ZVV0aWxzJztcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgTWF0cml4Q2xpZW50Q29udGV4dCBmcm9tIFwiLi4vLi4vLi4vY29udGV4dHMvTWF0cml4Q2xpZW50Q29udGV4dFwiO1xuaW1wb3J0IHsgZ2V0VXNlck5hbWVDb2xvckNsYXNzIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL0Zvcm1hdHRpbmdVdGlsc1wiO1xuaW1wb3J0IEFjY2Vzc2libGVUb29sdGlwQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblwiO1xuaW1wb3J0IHsgVGlsZVNoYXBlIH0gZnJvbSBcIi4vRXZlbnRUaWxlXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHJvb206IFJvb207XG4gICAgZXZlbnQ6IE1hdHJpeEV2ZW50O1xuICAgIG9uVW5waW5DbGlja2VkPygpOiB2b2lkO1xufVxuXG5jb25zdCBBVkFUQVJfU0laRSA9IDI0O1xuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5yb29tcy5QaW5uZWRFdmVudFRpbGVcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBpbm5lZEV2ZW50VGlsZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHM+IHtcbiAgICBwdWJsaWMgc3RhdGljIGNvbnRleHRUeXBlID0gTWF0cml4Q2xpZW50Q29udGV4dDtcblxuICAgIHByaXZhdGUgb25UaWxlQ2xpY2tlZCA9ICgpID0+IHtcbiAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdSb29tLFxuICAgICAgICAgICAgZXZlbnRfaWQ6IHRoaXMucHJvcHMuZXZlbnQuZ2V0SWQoKSxcbiAgICAgICAgICAgIGhpZ2hsaWdodGVkOiB0cnVlLFxuICAgICAgICAgICAgcm9vbV9pZDogdGhpcy5wcm9wcy5ldmVudC5nZXRSb29tSWQoKSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3Qgc2VuZGVyID0gdGhpcy5wcm9wcy5ldmVudC5nZXRTZW5kZXIoKTtcbiAgICAgICAgY29uc3Qgc2VuZGVyUHJvZmlsZSA9IHRoaXMucHJvcHMucm9vbS5nZXRNZW1iZXIoc2VuZGVyKTtcblxuICAgICAgICBsZXQgdW5waW5CdXR0b24gPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5vblVucGluQ2xpY2tlZCkge1xuICAgICAgICAgICAgdW5waW5CdXR0b24gPSAoXG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVUb29sdGlwQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMucHJvcHMub25VbnBpbkNsaWNrZWR9XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1Bpbm5lZEV2ZW50VGlsZV91bnBpbkJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcIlVucGluXCIpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfUGlubmVkRXZlbnRUaWxlXCI+XG4gICAgICAgICAgICA8TWVtYmVyQXZhdGFyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUGlubmVkRXZlbnRUaWxlX3NlbmRlckF2YXRhclwiXG4gICAgICAgICAgICAgICAgbWVtYmVyPXtzZW5kZXJQcm9maWxlfVxuICAgICAgICAgICAgICAgIHdpZHRoPXtBVkFUQVJfU0laRX1cbiAgICAgICAgICAgICAgICBoZWlnaHQ9e0FWQVRBUl9TSVpFfVxuICAgICAgICAgICAgICAgIGZhbGxiYWNrVXNlcklkPXtzZW5kZXJ9XG4gICAgICAgICAgICAvPlxuXG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9e1wibXhfUGlubmVkRXZlbnRUaWxlX3NlbmRlciBcIiArIGdldFVzZXJOYW1lQ29sb3JDbGFzcyhzZW5kZXIpfT5cbiAgICAgICAgICAgICAgICB7IHNlbmRlclByb2ZpbGU/Lm5hbWUgfHwgc2VuZGVyIH1cbiAgICAgICAgICAgIDwvc3Bhbj5cblxuICAgICAgICAgICAgeyB1bnBpbkJ1dHRvbiB9XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUGlubmVkRXZlbnRUaWxlX21lc3NhZ2VcIj5cbiAgICAgICAgICAgICAgICA8TWVzc2FnZUV2ZW50XG4gICAgICAgICAgICAgICAgICAgIG14RXZlbnQ9e3RoaXMucHJvcHMuZXZlbnR9XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgLSBjb21wbGFpbmluZyB0aGF0IGNsYXNzTmFtZSBpcyBpbnZhbGlkIHdoZW4gaXQncyBub3RcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUGlubmVkRXZlbnRUaWxlX2JvZHlcIlxuICAgICAgICAgICAgICAgICAgICBtYXhJbWFnZUhlaWdodD17MTUwfVxuICAgICAgICAgICAgICAgICAgICBvbkhlaWdodENoYW5nZWQ9eygpID0+IHt9fSAvLyB3ZSBuZWVkIHRvIGdpdmUgdGhpcywgYXBwYXJlbnRseVxuICAgICAgICAgICAgICAgICAgICB0aWxlU2hhcGU9e1RpbGVTaGFwZS5QaW5uZWR9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Bpbm5lZEV2ZW50VGlsZV9mb290ZXJcIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9QaW5uZWRFdmVudFRpbGVfdGltZXN0YW1wXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgZm9ybWF0RGF0ZShuZXcgRGF0ZSh0aGlzLnByb3BzLmV2ZW50LmdldFRzKCkpKSB9XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuXG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17dGhpcy5vblRpbGVDbGlja2VkfSBraW5kPVwibGlua1wiPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiVmlldyBtZXNzYWdlXCIpIH1cbiAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+O1xuICAgIH1cbn1cbiJdfQ==