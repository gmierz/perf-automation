"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.PowerStatus = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _languageHandler = require("../../../languageHandler");

var _classnames = _interopRequireDefault(require("classnames"));

var _E2EIcon = _interopRequireDefault(require("./E2EIcon"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _BaseAvatar = _interopRequireDefault(require("../avatars/BaseAvatar"));

var _PresenceLabel = _interopRequireDefault(require("./PresenceLabel"));

var _dec, _class, _class2, _temp;

let PowerStatus;
exports.PowerStatus = PowerStatus;

(function (PowerStatus) {
  PowerStatus["Admin"] = "admin";
  PowerStatus["Moderator"] = "moderator";
})(PowerStatus || (exports.PowerStatus = PowerStatus = {}));

const PowerLabel = {
  [PowerStatus.Admin]: (0, _languageHandler._td)("Admin"),
  [PowerStatus.Moderator]: (0, _languageHandler._td)("Mod")
};
const PRESENCE_CLASS = {
  "offline": "mx_EntityTile_offline",
  "online": "mx_EntityTile_online",
  "unavailable": "mx_EntityTile_unavailable"
};

function presenceClassForMember(presenceState, lastActiveAgo, showPresence) {
  if (showPresence === false) {
    return 'mx_EntityTile_online_beenactive';
  } // offline is split into two categories depending on whether we have
  // a last_active_ago for them.


  if (presenceState === 'offline') {
    if (lastActiveAgo) {
      return PRESENCE_CLASS['offline'] + '_beenactive';
    } else {
      return PRESENCE_CLASS['offline'] + '_neveractive';
    }
  } else if (presenceState) {
    return PRESENCE_CLASS[presenceState];
  } else {
    return PRESENCE_CLASS['offline'] + '_neveractive';
  }
}

let EntityTile = (_dec = (0, _replaceableComponent.replaceableComponent)("views.rooms.EntityTile"), _dec(_class = (_temp = _class2 = class EntityTile extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    this.state = {
      hover: false
    };
  }

  render() {
    const mainClassNames = {
      "mx_EntityTile": true,
      "mx_EntityTile_noHover": this.props.suppressOnHover
    };
    if (this.props.className) mainClassNames[this.props.className] = true;
    const presenceClass = presenceClassForMember(this.props.presenceState, this.props.presenceLastActiveAgo, this.props.showPresence);
    mainClassNames[presenceClass] = true;
    let nameEl;
    const {
      name
    } = this.props;

    if (!this.props.suppressOnHover) {
      const activeAgo = this.props.presenceLastActiveAgo ? Date.now() - (this.props.presenceLastTs - this.props.presenceLastActiveAgo) : -1;
      let presenceLabel = null;

      if (this.props.showPresence) {
        presenceLabel = /*#__PURE__*/_react.default.createElement(_PresenceLabel.default, {
          activeAgo: activeAgo,
          currentlyActive: this.props.presenceCurrentlyActive,
          presenceState: this.props.presenceState
        });
      }

      if (this.props.subtextLabel) {
        presenceLabel = /*#__PURE__*/_react.default.createElement("span", {
          className: "mx_EntityTile_subtext"
        }, this.props.subtextLabel);
      }

      nameEl = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_EntityTile_details"
      }, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_EntityTile_name",
        dir: "auto"
      }, name), presenceLabel);
    } else if (this.props.subtextLabel) {
      nameEl = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_EntityTile_details"
      }, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_EntityTile_name",
        dir: "auto"
      }, name), /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_EntityTile_subtext"
      }, this.props.subtextLabel));
    } else {
      nameEl = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_EntityTile_name",
        dir: "auto"
      }, name);
    }

    let inviteButton;

    if (this.props.showInviteButton) {
      inviteButton = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_EntityTile_invite"
      }, /*#__PURE__*/_react.default.createElement("img", {
        src: require("../../../../res/img/plus.svg"),
        width: "16",
        height: "16"
      }));
    }

    let powerLabel;
    const powerStatus = this.props.powerStatus;

    if (powerStatus) {
      const powerText = PowerLabel[powerStatus];
      powerLabel = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_EntityTile_power"
      }, powerText);
    }

    let e2eIcon;
    const {
      e2eStatus
    } = this.props;

    if (e2eStatus) {
      e2eIcon = /*#__PURE__*/_react.default.createElement(_E2EIcon.default, {
        status: e2eStatus,
        isUser: true,
        bordered: true
      });
    }

    const av = this.props.avatarJsx || /*#__PURE__*/_react.default.createElement(_BaseAvatar.default, {
      name: this.props.name,
      width: 36,
      height: 36,
      "aria-hidden": "true"
    }); // The wrapping div is required to make the magic mouse listener work, for some reason.


    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: (0, _classnames.default)(mainClassNames),
      title: this.props.title,
      onClick: this.props.onClick
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_EntityTile_avatar"
    }, av, e2eIcon), nameEl, powerLabel, inviteButton));
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  onClick: () => {},
  presenceState: "offline",
  presenceLastActiveAgo: 0,
  presenceLastTs: 0,
  showInviteButton: false,
  suppressOnHover: false,
  showPresence: true
}), _temp)) || _class);
exports.default = EntityTile;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL0VudGl0eVRpbGUudHN4Il0sIm5hbWVzIjpbIlBvd2VyU3RhdHVzIiwiUG93ZXJMYWJlbCIsIkFkbWluIiwiTW9kZXJhdG9yIiwiUFJFU0VOQ0VfQ0xBU1MiLCJwcmVzZW5jZUNsYXNzRm9yTWVtYmVyIiwicHJlc2VuY2VTdGF0ZSIsImxhc3RBY3RpdmVBZ28iLCJzaG93UHJlc2VuY2UiLCJFbnRpdHlUaWxlIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInN0YXRlIiwiaG92ZXIiLCJyZW5kZXIiLCJtYWluQ2xhc3NOYW1lcyIsInN1cHByZXNzT25Ib3ZlciIsImNsYXNzTmFtZSIsInByZXNlbmNlQ2xhc3MiLCJwcmVzZW5jZUxhc3RBY3RpdmVBZ28iLCJuYW1lRWwiLCJuYW1lIiwiYWN0aXZlQWdvIiwiRGF0ZSIsIm5vdyIsInByZXNlbmNlTGFzdFRzIiwicHJlc2VuY2VMYWJlbCIsInByZXNlbmNlQ3VycmVudGx5QWN0aXZlIiwic3VidGV4dExhYmVsIiwiaW52aXRlQnV0dG9uIiwic2hvd0ludml0ZUJ1dHRvbiIsInJlcXVpcmUiLCJwb3dlckxhYmVsIiwicG93ZXJTdGF0dXMiLCJwb3dlclRleHQiLCJlMmVJY29uIiwiZTJlU3RhdHVzIiwiYXYiLCJhdmF0YXJKc3giLCJ0aXRsZSIsIm9uQ2xpY2siXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBa0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0lBRVlBLFc7OztXQUFBQSxXO0FBQUFBLEVBQUFBLFc7QUFBQUEsRUFBQUEsVztHQUFBQSxXLDJCQUFBQSxXOztBQUtaLE1BQU1DLFVBQXVDLEdBQUc7QUFDNUMsR0FBQ0QsV0FBVyxDQUFDRSxLQUFiLEdBQXFCLDBCQUFJLE9BQUosQ0FEdUI7QUFFNUMsR0FBQ0YsV0FBVyxDQUFDRyxTQUFiLEdBQXlCLDBC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RUFBZTtBQUNYRCxNQUFBQSxPQUFPLGdCQUFHLDZCQUFDLGdCQUFEO0FBQVMsUUFBQSxNQUFNLEVBQUVDLFNBQWpCO0FBQTRCLFFBQUEsTUFBTSxFQUFFLElBQXBDO0FBQTBDLFFBQUEsUUFBUSxFQUFFO0FBQXBELFFBQVY7QUFDSDs7QUFFRCxVQUFNQyxFQUFFLEdBQUcsS0FBSzFCLEtBQUwsQ0FBVzJCLFNBQVgsaUJBQ1AsNkJBQUMsbUJBQUQ7QUFBWSxNQUFBLElBQUksRUFBRSxLQUFLM0IsS0FBTCxDQUFXVSxJQUE3QjtBQUFtQyxNQUFBLEtBQUssRUFBRSxFQUExQztBQUE4QyxNQUFBLE1BQU0sRUFBRSxFQUF0RDtBQUEwRCxxQkFBWTtBQUF0RSxNQURKLENBekVLLENBNEVMOzs7QUFDQSx3QkFDSSx1REFDSSw2QkFBQyx5QkFBRDtBQUNJLE1BQUEsU0FBUyxFQUFFLHlCQUFXTixjQUFYLENBRGY7QUFFSSxNQUFBLEtBQUssRUFBRSxLQUFLSixLQUFMLENBQVc0QixLQUZ0QjtBQUdJLE1BQUEsT0FBTyxFQUFFLEtBQUs1QixLQUFMLENBQVc2QjtBQUh4QixvQkFLSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FDTUgsRUFETixFQUVNRixPQUZOLENBTEosRUFTTWYsTUFUTixFQVVNWSxVQVZOLEVBV01ILFlBWE4sQ0FESixDQURKO0FBaUJIOztBQWpIdUUsQyx5REFDbEQ7QUFDbEJXLEVBQUFBLE9BQU8sRUFBRSxNQUFNLENBQUUsQ0FEQztBQUVsQnBDLEVBQUFBLGFBQWEsRUFBRSxTQUZHO0FBR2xCZSxFQUFBQSxxQkFBcUIsRUFBRSxDQUhMO0FBSWxCTSxFQUFBQSxjQUFjLEVBQUUsQ0FKRTtBQUtsQkssRUFBQUEsZ0JBQWdCLEVBQUUsS0FMQTtBQU1sQmQsRUFBQUEsZUFBZSxFQUFFLEtBTkM7QUFPbEJWLEVBQUFBLFlBQVksRUFBRTtBQVBJLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUsIDIwMTYgT3Blbk1hcmtldCBMdGRcbkNvcHlyaWdodCAyMDE4IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tICcuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uJztcbmltcG9ydCB7IF90ZCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiO1xuaW1wb3J0IEUyRUljb24sIHsgRTJFU3RhdGUgfSBmcm9tICcuL0UyRUljb24nO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCBCYXNlQXZhdGFyIGZyb20gJy4uL2F2YXRhcnMvQmFzZUF2YXRhcic7XG5pbXBvcnQgUHJlc2VuY2VMYWJlbCBmcm9tIFwiLi9QcmVzZW5jZUxhYmVsXCI7XG5cbmV4cG9ydCBlbnVtIFBvd2VyU3RhdHVzIHtcbiAgICBBZG1pbiA9IFwiYWRtaW5cIixcbiAgICBNb2RlcmF0b3IgPSBcIm1vZGVyYXRvclwiLFxufVxuXG5jb25zdCBQb3dlckxhYmVsOiBSZWNvcmQ8UG93ZXJTdGF0dXMsIHN0cmluZz4gPSB7XG4gICAgW1Bvd2VyU3RhdHVzLkFkbWluXTogX3RkKFwiQWRtaW5cIiksXG4gICAgW1Bvd2VyU3RhdHVzLk1vZGVyYXRvcl06IF90ZChcIk1vZFwiKSxcbn07XG5cbmNvbnN0IFBSRVNFTkNFX0NMQVNTID0ge1xuICAgIFwib2ZmbGluZVwiOiBcIm14X0VudGl0eVRpbGVfb2ZmbGluZVwiLFxuICAgIFwib25saW5lXCI6IFwibXhfRW50aXR5VGlsZV9vbmxpbmVcIixcbiAgICBcInVuYXZhaWxhYmxlXCI6IFwibXhfRW50aXR5VGlsZV91bmF2YWlsYWJsZVwiLFxufTtcblxuZnVuY3Rpb24gcHJlc2VuY2VDbGFzc0Zvck1lbWJlcihwcmVzZW5jZVN0YXRlOiBzdHJpbmcsIGxhc3RBY3RpdmVBZ286IG51bWJlciwgc2hvd1ByZXNlbmNlOiBib29sZWFuKTogc3RyaW5nIHtcbiAgICBpZiAoc2hvd1ByZXNlbmNlID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gJ214X0VudGl0eVRpbGVfb25saW5lX2JlZW5hY3RpdmUnO1xuICAgIH1cblxuICAgIC8vIG9mZmxpbmUgaXMgc3BsaXQgaW50byB0d28gY2F0ZWdvcmllcyBkZXBlbmRpbmcgb24gd2hldGhlciB3ZSBoYXZlXG4gICAgLy8gYSBsYXN0X2FjdGl2ZV9hZ28gZm9yIHRoZW0uXG4gICAgaWYgKHByZXNlbmNlU3RhdGUgPT09ICdvZmZsaW5lJykge1xuICAgICAgICBpZiAobGFzdEFjdGl2ZUFnbykge1xuICAgICAgICAgICAgcmV0dXJuIFBSRVNFTkNFX0NMQVNTWydvZmZsaW5lJ10gKyAnX2JlZW5hY3RpdmUnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFBSRVNFTkNFX0NMQVNTWydvZmZsaW5lJ10gKyAnX25ldmVyYWN0aXZlJztcbiAgICAgICAgfVxuICAgIH0gZWxzZSBpZiAocHJlc2VuY2VTdGF0ZSkge1xuICAgICAgICByZXR1cm4gUFJFU0VOQ0VfQ0xBU1NbcHJlc2VuY2VTdGF0ZV07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFBSRVNFTkNFX0NMQVNTWydvZmZsaW5lJ10gKyAnX25ldmVyYWN0aXZlJztcbiAgICB9XG59XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgdGl0bGU/OiBzdHJpbmc7XG4gICAgYXZhdGFySnN4PzogSlNYLkVsZW1lbnQ7IC8vIDxCYXNlQXZhdGFyIC8+XG4gICAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICAgIHByZXNlbmNlU3RhdGU/OiBzdHJpbmc7XG4gICAgcHJlc2VuY2VMYXN0QWN0aXZlQWdvPzogbnVtYmVyO1xuICAgIHByZXNlbmNlTGFzdFRzPzogbnVtYmVyO1xuICAgIHByZXNlbmNlQ3VycmVudGx5QWN0aXZlPzogYm9vbGVhbjtcbiAgICBzaG93SW52aXRlQnV0dG9uPzogYm9vbGVhbjtcbiAgICBvbkNsaWNrPygpOiB2b2lkO1xuICAgIHN1cHByZXNzT25Ib3Zlcj86IGJvb2xlYW47XG4gICAgc2hvd1ByZXNlbmNlPzogYm9vbGVhbjtcbiAgICBzdWJ0ZXh0TGFiZWw/OiBzdHJpbmc7XG4gICAgZTJlU3RhdHVzPzogRTJFU3RhdGU7XG4gICAgcG93ZXJTdGF0dXM/OiBQb3dlclN0YXR1cztcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgaG92ZXI6IGJvb2xlYW47XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLnJvb21zLkVudGl0eVRpbGVcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVudGl0eVRpbGUgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICAgICAgb25DbGljazogKCkgPT4ge30sXG4gICAgICAgIHByZXNlbmNlU3RhdGU6IFwib2ZmbGluZVwiLFxuICAgICAgICBwcmVzZW5jZUxhc3RBY3RpdmVBZ286IDAsXG4gICAgICAgIHByZXNlbmNlTGFzdFRzOiAwLFxuICAgICAgICBzaG93SW52aXRlQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgc3VwcHJlc3NPbkhvdmVyOiBmYWxzZSxcbiAgICAgICAgc2hvd1ByZXNlbmNlOiB0cnVlLFxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgaG92ZXI6IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgbWFpbkNsYXNzTmFtZXMgPSB7XG4gICAgICAgICAgICBcIm14X0VudGl0eVRpbGVcIjogdHJ1ZSxcbiAgICAgICAgICAgIFwibXhfRW50aXR5VGlsZV9ub0hvdmVyXCI6IHRoaXMucHJvcHMuc3VwcHJlc3NPbkhvdmVyLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5jbGFzc05hbWUpIG1haW5DbGFzc05hbWVzW3RoaXMucHJvcHMuY2xhc3NOYW1lXSA9IHRydWU7XG5cbiAgICAgICAgY29uc3QgcHJlc2VuY2VDbGFzcyA9IHByZXNlbmNlQ2xhc3NGb3JNZW1iZXIoXG4gICAgICAgICAgICB0aGlzLnByb3BzLnByZXNlbmNlU3RhdGUsIHRoaXMucHJvcHMucHJlc2VuY2VMYXN0QWN0aXZlQWdvLCB0aGlzLnByb3BzLnNob3dQcmVzZW5jZSxcbiAgICAgICAgKTtcbiAgICAgICAgbWFpbkNsYXNzTmFtZXNbcHJlc2VuY2VDbGFzc10gPSB0cnVlO1xuXG4gICAgICAgIGxldCBuYW1lRWw7XG4gICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gdGhpcy5wcm9wcztcblxuICAgICAgICBpZiAoIXRoaXMucHJvcHMuc3VwcHJlc3NPbkhvdmVyKSB7XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVBZ28gPSB0aGlzLnByb3BzLnByZXNlbmNlTGFzdEFjdGl2ZUFnbyA/XG4gICAgICAgICAgICAgICAgKERhdGUubm93KCkgLSAodGhpcy5wcm9wcy5wcmVzZW5jZUxhc3RUcyAtIHRoaXMucHJvcHMucHJlc2VuY2VMYXN0QWN0aXZlQWdvKSkgOiAtMTtcblxuICAgICAgICAgICAgbGV0IHByZXNlbmNlTGFiZWwgPSBudWxsO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuc2hvd1ByZXNlbmNlKSB7XG4gICAgICAgICAgICAgICAgcHJlc2VuY2VMYWJlbCA9IDxQcmVzZW5jZUxhYmVsIGFjdGl2ZUFnbz17YWN0aXZlQWdvfVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50bHlBY3RpdmU9e3RoaXMucHJvcHMucHJlc2VuY2VDdXJyZW50bHlBY3RpdmV9XG4gICAgICAgICAgICAgICAgICAgIHByZXNlbmNlU3RhdGU9e3RoaXMucHJvcHMucHJlc2VuY2VTdGF0ZX0gLz47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5zdWJ0ZXh0TGFiZWwpIHtcbiAgICAgICAgICAgICAgICBwcmVzZW5jZUxhYmVsID0gPHNwYW4gY2xhc3NOYW1lPVwibXhfRW50aXR5VGlsZV9zdWJ0ZXh0XCI+eyB0aGlzLnByb3BzLnN1YnRleHRMYWJlbCB9PC9zcGFuPjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5hbWVFbCA9IChcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0VudGl0eVRpbGVfZGV0YWlsc1wiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0VudGl0eVRpbGVfbmFtZVwiIGRpcj1cImF1dG9cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbmFtZSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICB7IHByZXNlbmNlTGFiZWwgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnN1YnRleHRMYWJlbCkge1xuICAgICAgICAgICAgbmFtZUVsID0gKFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRW50aXR5VGlsZV9kZXRhaWxzXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRW50aXR5VGlsZV9uYW1lXCIgZGlyPVwiYXV0b1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBuYW1lIH1cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X0VudGl0eVRpbGVfc3VidGV4dFwiPnsgdGhpcy5wcm9wcy5zdWJ0ZXh0TGFiZWwgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuYW1lRWwgPSAoXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9FbnRpdHlUaWxlX25hbWVcIiBkaXI9XCJhdXRvXCI+eyBuYW1lIH08L2Rpdj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaW52aXRlQnV0dG9uO1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5zaG93SW52aXRlQnV0dG9uKSB7XG4gICAgICAgICAgICBpbnZpdGVCdXR0b24gPSAoXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9FbnRpdHlUaWxlX2ludml0ZVwiPlxuICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz17cmVxdWlyZShcIi4uLy4uLy4uLy4uL3Jlcy9pbWcvcGx1cy5zdmdcIil9IHdpZHRoPVwiMTZcIiBoZWlnaHQ9XCIxNlwiIC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHBvd2VyTGFiZWw7XG4gICAgICAgIGNvbnN0IHBvd2VyU3RhdHVzID0gdGhpcy5wcm9wcy5wb3dlclN0YXR1cztcbiAgICAgICAgaWYgKHBvd2VyU3RhdHVzKSB7XG4gICAgICAgICAgICBjb25zdCBwb3dlclRleHQgPSBQb3dlckxhYmVsW3Bvd2VyU3RhdHVzXTtcbiAgICAgICAgICAgIHBvd2VyTGFiZWwgPSA8ZGl2IGNsYXNzTmFtZT1cIm14X0VudGl0eVRpbGVfcG93ZXJcIj57IHBvd2VyVGV4dCB9PC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGUyZUljb247XG4gICAgICAgIGNvbnN0IHsgZTJlU3RhdHVzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoZTJlU3RhdHVzKSB7XG4gICAgICAgICAgICBlMmVJY29uID0gPEUyRUljb24gc3RhdHVzPXtlMmVTdGF0dXN9IGlzVXNlcj17dHJ1ZX0gYm9yZGVyZWQ9e3RydWV9IC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXYgPSB0aGlzLnByb3BzLmF2YXRhckpzeCB8fFxuICAgICAgICAgICAgPEJhc2VBdmF0YXIgbmFtZT17dGhpcy5wcm9wcy5uYW1lfSB3aWR0aD17MzZ9IGhlaWdodD17MzZ9IGFyaWEtaGlkZGVuPVwidHJ1ZVwiIC8+O1xuXG4gICAgICAgIC8vIFRoZSB3cmFwcGluZyBkaXYgaXMgcmVxdWlyZWQgdG8gbWFrZSB0aGUgbWFnaWMgbW91c2UgbGlzdGVuZXIgd29yaywgZm9yIHNvbWUgcmVhc29uLlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMobWFpbkNsYXNzTmFtZXMpfVxuICAgICAgICAgICAgICAgICAgICB0aXRsZT17dGhpcy5wcm9wcy50aXRsZX1cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5wcm9wcy5vbkNsaWNrfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9FbnRpdHlUaWxlX2F2YXRhclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBhdiB9XG4gICAgICAgICAgICAgICAgICAgICAgICB7IGUyZUljb24gfVxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgeyBuYW1lRWwgfVxuICAgICAgICAgICAgICAgICAgICB7IHBvd2VyTGFiZWwgfVxuICAgICAgICAgICAgICAgICAgICB7IGludml0ZUJ1dHRvbiB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19