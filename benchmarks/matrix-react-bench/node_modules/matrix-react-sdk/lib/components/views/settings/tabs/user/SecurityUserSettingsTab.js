"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.IgnoredUser = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _utils = require("matrix-js-sdk/src/utils");

var _languageHandler = require("../../../../../languageHandler");

var _SdkConfig = _interopRequireDefault(require("../../../../../SdkConfig"));

var _MatrixClientPeg = require("../../../../../MatrixClientPeg");

var _AccessibleButton = _interopRequireDefault(require("../../../elements/AccessibleButton"));

var _Analytics = _interopRequireDefault(require("../../../../../Analytics"));

var _dispatcher = _interopRequireDefault(require("../../../../../dispatcher/dispatcher"));

var _createRoom = require("../../../../../createRoom");

var _SettingLevel = require("../../../../../settings/SettingLevel");

var _SecureBackupPanel = _interopRequireDefault(require("../../SecureBackupPanel"));

var _SettingsStore = _interopRequireDefault(require("../../../../../settings/SettingsStore"));

var _UIFeature = require("../../../../../settings/UIFeature");

var _E2eAdvancedPanel = _interopRequireWildcard(require("../../E2eAdvancedPanel"));

var _CountlyAnalytics = _interopRequireDefault(require("../../../../../CountlyAnalytics"));

var _replaceableComponent = require("../../../../../utils/replaceableComponent");

var _PosthogAnalytics = require("../../../../../PosthogAnalytics");

var _CryptographyPanel = _interopRequireDefault(require("../../CryptographyPanel"));

var _DevicesPanel = _interopRequireDefault(require("../../DevicesPanel"));

var _SettingsFlag = _interopRequireDefault(require("../../../elements/SettingsFlag"));

var _CrossSigningPanel = _interopRequireDefault(require("../../CrossSigningPanel"));

var _EventIndexPanel = _interopRequireDefault(require("../../EventIndexPanel"));

var _InlineSpinner = _interopRequireDefault(require("../../../elements/InlineSpinner"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

class IgnoredUser extends _react.default.Component {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "onUnignoreClicked", () => {
      this.props.onUnignored(this.props.userId);
    });
  }

  render() {
    const id = `mx_SecurityUserSettingsTab_ignoredUser_${this.props.userId}`;
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SecurityUserSettingsTab_ignoredUser"
    }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onUnignoreClicked,
      kind: "primary_sm",
      "aria-describedby": id,
      disabled: this.props.inProgress
    }, (0, _languageHandler._t)('Unignore')), /*#__PURE__*/_react.default.createElement("span", {
      id: id
    }, this.props.userId));
  }

}

exports.IgnoredUser = IgnoredUser;
let SecurityUserSettingsTab = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.tabs.user.SecurityUserSettingsTab"), _dec(_class = class SecurityUserSettingsTab extends _react.default.Component {
  constructor(props) {
    super(props); // Get rooms we're invited to

    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "onAction", ({
      action
    }) => {
      if (action === "ignore_state_changed") {
        const ignoredUserIds = _MatrixClientPeg.MatrixClientPeg.get().getIgnoredUsers();

        const newWaitingUnignored = this.state.waitingUnignored.filter(e => ignoredUserIds.includes(e));
        this.setState({
          ignoredUserIds,
          waitingUnignored: newWaitingUnignored
        });
      }
    });
    (0, _defineProperty2.default)(this, "updateAnalytics", checked => {
      checked ? _Analytics.default.enable() : _Analytics.default.disable();

      _CountlyAnalytics.default.instance.enable(
      /* anonymous = */
      !checked);

      _PosthogAnalytics.PosthogAnalytics.instance.updateAnonymityFromSettings(_MatrixClientPeg.MatrixClientPeg.get().getUserId());
    });
    (0, _defineProperty2.default)(this, "onMyMembership", (room, membership) => {
      if (room.isSpaceRoom()) {
        return;
      }

      if (membership === "invite") {
        this.addInvitedRoom(room);
      } else if (this.state.invitedRoomIds.has(room.roomId)) {
        // The user isn't invited anymore
        this.removeInvitedRoom(room.roomId);
      }
    });
    (0, _defineProperty2.default)(this, "addInvitedRoom", room => {
      this.setState(({
        invitedRoomIds
      }) => ({
        invitedRoomIds: new Set(invitedRoomIds).add(room.roomId)
      }));
    });
    (0, _defineProperty2.default)(this, "removeInvitedRoom", roomId => {
      this.setState(({
        invitedRoomIds
      }) => {
        const newInvitedRoomIds = new Set(invitedRoomIds);
        newInvitedRoomIds.delete(roomId);
        return {
          invitedRoomIds: newInvitedRoomIds
        };
      });
    });
    (0, _defineProperty2.default)(this, "onGoToUserProfileClick", () => {
      _dispatcher.default.dispatch({
        action: 'view_user_info',
        userId: _MatrixClientPeg.MatrixClientPeg.get().getUserId()
      });

      this.props.closeSettingsFn();
    });
    (0, _defineProperty2.default)(this, "onUserUnignored", async userId => {
      const {
        ignoredUserIds,
        waitingUnignored
      } = this.state;
      const currentlyIgnoredUserIds = ignoredUserIds.filter(e => !waitingUnignored.includes(e));
      const index = currentlyIgnoredUserIds.indexOf(userId);

      if (index !== -1) {
        currentlyIgnoredUserIds.splice(index, 1);
        this.setState(({
          waitingUnignored
        }) => ({
          waitingUnignored: [...waitingUnignored, userId]
        }));

        _MatrixClientPeg.MatrixClientPeg.get().setIgnoredUsers(currentlyIgnoredUserIds);
      }
    });
    (0, _defineProperty2.default)(this, "getInvitedRooms", () => {
      return _MatrixClientPeg.MatrixClientPeg.get().getRooms().filter(r => {
        return r.hasMembershipState(_MatrixClientPeg.MatrixClientPeg.get().getUserId(), "invite");
      });
    });
    (0, _defineProperty2.default)(this, "manageInvites", async accept => {
      this.setState({
        managingInvites: true
      }); // iterate with a normal for loop in order to retry on action failure

      const invitedRoomIdsValues = Array.from(this.state.invitedRoomIds); // Execute all acceptances/rejections sequentially

      const cli = _MatrixClientPeg.MatrixClientPeg.get();

      const action = accept ? cli.joinRoom.bind(cli) : cli.leave.bind(cli);

      for (let i = 0; i < invitedRoomIdsValues.length; i++) {
        const roomId = invitedRoomIdsValues[i]; // Accept/reject invite

        await action(roomId).then(() => {
          // No error, update invited rooms button
          this.removeInvitedRoom(roomId);
        }, async e => {
          // Action failure
          if (e.errcode === "M_LIMIT_EXCEEDED") {
            // Add a delay between each invite change in order to avoid rate
            // limiting by the server.
            await (0, _utils.sleep)(e.retry_after_ms || 2500); // Redo last action

            i--;
          } else {
            // Print out error with joining/leaving room
            _logger.logger.warn(e);
          }
        });
      }

      this.setState({
        managingInvites: false
      });
    });
    (0, _defineProperty2.default)(this, "onAcceptAllInvitesClicked", () => {
      this.manageInvites(true);
    });
    (0, _defineProperty2.default)(this, "onRejectAllInvitesClicked", () => {
      this.manageInvites(false);
    });

    const _invitedRoomIds = new Set(this.getInvitedRooms().map(room => room.roomId));

    this.state = {
      ignoredUserIds: _MatrixClientPeg.MatrixClientPeg.get().getIgnoredUsers(),
      waitingUnignored: [],
      managingInvites: false,
      invitedRoomIds: _invitedRoomIds
    };
  }

  componentDidMount() {
    this.dispatcherRef = _dispatcher.default.register(this.onAction);

    _MatrixClientPeg.MatrixClientPeg.get().on("Room.myMembership", this.onMyMembership);
  }

  componentWillUnmount() {
    _dispatcher.default.unregister(this.dispatcherRef);

    _MatrixClientPeg.MatrixClientPeg.get().removeListener("Room.myMembership", this.onMyMembership);
  }

  renderIgnoredUsers() {
    const {
      waitingUnignored,
      ignoredUserIds
    } = this.state;
    const userIds = !(ignoredUserIds !== null && ignoredUserIds !== void 0 && ignoredUserIds.length) ? (0, _languageHandler._t)('You have no ignored users.') : ignoredUserIds.map(u => {
      return /*#__PURE__*/_react.default.createElement(IgnoredUser, {
        userId: u,
        onUnignored: this.onUserUnignored,
        key: u,
        inProgress: waitingUnignored.includes(u)
      });
    });
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)('Ignored users')), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_subsectionText"
    }, userIds));
  }

  renderManageInvites() {
    const {
      invitedRoomIds
    } = this.state;

    if (invitedRoomIds.size === 0) {
      return null;
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_SecurityUserSettingsTab_bulkOptions"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)('Bulk options')), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onAcceptAllInvitesClicked,
      kind: "primary",
      disabled: this.state.managingInvites
    }, (0, _languageHandler._t)("Accept all %(invitedRooms)s invites", {
      invitedRooms: invitedRoomIds.size
    })), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onRejectAllInvitesClicked,
      kind: "danger",
      disabled: this.state.managingInvites
    }, (0, _languageHandler._t)("Reject all %(invitedRooms)s invites", {
      invitedRooms: invitedRoomIds.size
    })), this.state.managingInvites ? /*#__PURE__*/_react.default.createElement(_InlineSpinner.default, null) : /*#__PURE__*/_react.default.createElement("div", null));
  }

  render() {
    const brand = _SdkConfig.default.get().brand;

    const secureBackup = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Secure Backup")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement(_SecureBackupPanel.default, null)));

    const eventIndex = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Message search")), /*#__PURE__*/_react.default.createElement(_EventIndexPanel.default, null)); // XXX: There's no such panel in the current cross-signing designs, but
    // it's useful to have for testing the feature. If there's no interest
    // in having advanced details here once all flows are implemented, we
    // can remove this.


    const crossSigning = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Cross-signing")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement(_CrossSigningPanel.default, null)));

    let warning;

    if (!(0, _createRoom.privateShouldBeEncrypted)()) {
      warning = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SecurityUserSettingsTab_warning"
      }, (0, _languageHandler._t)("Your server admin has disabled end-to-end encryption by default " + "in private rooms & Direct Messages."));
    }

    let privacySection;

    if (_Analytics.default.canEnable() || _CountlyAnalytics.default.instance.canEnable()) {
      privacySection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsTab_heading"
      }, (0, _languageHandler._t)("Privacy")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsTab_section"
      }, /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_SettingsTab_subheading"
      }, (0, _languageHandler._t)("Analytics")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsTab_subsectionText"
      }, (0, _languageHandler._t)("%(brand)s collects anonymous analytics to allow us to improve the application.", {
        brand
      }), "\xA0", (0, _languageHandler._t)("Privacy is important to us, so we don't collect any personal or " + "identifiable data for our analytics."), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        className: "mx_SettingsTab_linkBtn",
        onClick: _Analytics.default.showDetailsModal
      }, (0, _languageHandler._t)("Learn more about how we use analytics."))), /*#__PURE__*/_react.default.createElement(_SettingsFlag.default, {
        name: "analyticsOptIn",
        level: _SettingLevel.SettingLevel.DEVICE,
        onChange: this.updateAnalytics
      })));
    }

    let advancedSection;

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.AdvancedSettings)) {
      const ignoreUsersPanel = this.renderIgnoredUsers();
      const invitesPanel = this.renderManageInvites();
      const e2ePanel = (0, _E2eAdvancedPanel.isE2eAdvancedPanelPossible)() ? /*#__PURE__*/_react.default.createElement(_E2eAdvancedPanel.default, null) : null; // only show the section if there's something to show

      if (ignoreUsersPanel || invitesPanel || e2ePanel) {
        advancedSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_SettingsTab_heading"
        }, (0, _languageHandler._t)("Advanced")), /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_SettingsTab_section"
        }, ignoreUsersPanel, invitesPanel, e2ePanel));
      }
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab mx_SecurityUserSettingsTab"
    }, warning, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Where you're signed in")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Manage your signed-in devices below. " + "A device's name is visible to people you communicate with.")), /*#__PURE__*/_react.default.createElement(_DevicesPanel.default, null)), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Encryption")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, secureBackup, eventIndex, crossSigning, /*#__PURE__*/_react.default.createElement(_CryptographyPanel.default, null)), privacySection, advancedSection);
  }

}) || _class);
exports.default = SecurityUserSettingsTab;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL3RhYnMvdXNlci9TZWN1cml0eVVzZXJTZXR0aW5nc1RhYi50c3giXSwibmFtZXMiOlsiSWdub3JlZFVzZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsInByb3BzIiwib25Vbmlnbm9yZWQiLCJ1c2VySWQiLCJyZW5kZXIiLCJpZCIsIm9uVW5pZ25vcmVDbGlja2VkIiwiaW5Qcm9ncmVzcyIsIlNlY3VyaXR5VXNlclNldHRpbmdzVGFiIiwiY29uc3RydWN0b3IiLCJhY3Rpb24iLCJpZ25vcmVkVXNlcklkcyIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsImdldElnbm9yZWRVc2VycyIsIm5ld1dhaXRpbmdVbmlnbm9yZWQiLCJzdGF0ZSIsIndhaXRpbmdVbmlnbm9yZWQiLCJmaWx0ZXIiLCJlIiwiaW5jbHVkZXMiLCJzZXRTdGF0ZSIsImNoZWNrZWQiLCJBbmFseXRpY3MiLCJlbmFibGUiLCJkaXNhYmxlIiwiQ291bnRseUFuYWx5dGljcyIsImluc3RhbmNlIiwiUG9zdGhvZ0FuYWx5dGljcyIsInVwZGF0ZUFub255bWl0eUZyb21TZXR0aW5ncyIsImdldFVzZXJJZCIsInJvb20iLCJtZW1iZXJzaGlwIiwiaXNTcGFjZVJvb20iLCJhZGRJbnZpdGVkUm9vbSIsImludml0ZWRSb29tSWRzIiwiaGFzIiwicm9vbUlkIiwicmVtb3ZlSW52aXRlZFJvb20iLCJTZXQiLCJhZGQiLCJuZXdJbnZpdGVkUm9vbUlkcyIsImRlbGV0ZSIsImRpcyIsImRpc3BhdGNoIiwiY2xvc2VTZXR0aW5nc0ZuIiwiY3VycmVudGx5SWdub3JlZFVzZXJJZHMiLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJzZXRJZ25vcmVkVXNlcnMiLCJnZXRSb29tcyIsInIiLCJoYXNNZW1iZXJzaGlwU3RhdGUiLCJhY2NlcHQiLCJtYW5hZ2luZ0ludml0ZXMiLCJpbnZpdGVkUm9vbUlkc1ZhbHVlcyIsIkFycmF5IiwiZnJvbSIsImNsaSIsImpvaW5Sb29tIiwiYmluZCIsImxlYXZlIiwiaSIsImxlbmd0aCIsInRoZW4iLCJlcnJjb2RlIiwicmV0cnlfYWZ0ZXJfbXMiLCJsb2dnZXIiLCJ3YXJuIiwibWFuYWdlSW52aXRlcyIsImdldEludml0ZWRSb29tcyIsIm1hcCIsImNvbXBvbmVudERpZE1vdW50IiwiZGlzcGF0Y2hlclJlZiIsInJlZ2lzdGVyIiwib25BY3Rpb24iLCJvbiIsIm9uTXlNZW1iZXJzaGlwIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJ1bnJlZ2lzdGVyIiwicmVtb3ZlTGlzdGVuZXIiLCJyZW5kZXJJZ25vcmVkVXNlcnMiLCJ1c2VySWRzIiwidSIsIm9uVXNlclVuaWdub3JlZCIsInJlbmRlck1hbmFnZUludml0ZXMiLCJzaXplIiwib25BY2NlcHRBbGxJbnZpdGVzQ2xpY2tlZCIsImludml0ZWRSb29tcyIsIm9uUmVqZWN0QWxsSW52aXRlc0NsaWNrZWQiLCJicmFuZCIsIlNka0NvbmZpZyIsInNlY3VyZUJhY2t1cCIsImV2ZW50SW5kZXgiLCJjcm9zc1NpZ25pbmciLCJ3YXJuaW5nIiwicHJpdmFjeVNlY3Rpb24iLCJjYW5FbmFibGUiLCJzaG93RGV0YWlsc01vZGFsIiwiU2V0dGluZ0xldmVsIiwiREVWSUNFIiwidXBkYXRlQW5hbHl0aWNzIiwiYWR2YW5jZWRTZWN0aW9uIiwiU2V0dGluZ3NTdG9yZSIsImdldFZhbHVlIiwiVUlGZWF0dXJlIiwiQWR2YW5jZWRTZXR0aW5ncyIsImlnbm9yZVVzZXJzUGFuZWwiLCJpbnZpdGVzUGFuZWwiLCJlMmVQYW5lbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7Ozs7O0FBUU8sTUFBTUEs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QUNBLFFBQUlDLHVCQUFjQyxRQUFkLENBQXVCQyxxQkFBVUMsZ0JBQWpDLENBQUosRUFBd0Q7QUFDcEQsWUFBTUMsZ0JBQWdCLEdBQUcsS0FBSzFCLGtCQUFMLEVBQXpCO0FBQ0EsWUFBTTJCLFlBQVksR0FBRyxLQUFLdkIsbUJBQUwsRUFBckI7QUFDQSxZQUFNd0IsUUFBUSxHQUFHLG1FQUErQiw2QkFBQyx5QkFBRCxPQUEvQixHQUFzRCxJQUF2RSxDQUhvRCxDQUlwRDs7QUFDQSxVQUFJRixnQkFBZ0IsSUFBSUMsWUFBcEIsSUFBb0NDLFFBQXhDLEVBQWtEO0FBQzlDUCxRQUFBQSxlQUFlLGdCQUFHLHlFQUNkO0FBQUssVUFBQSxTQUFTLEVBQUM7QUFBZixXQUEwQyx5QkFBRyxVQUFILENBQTFDLENBRGMsZUFFZDtBQUFLLFVBQUEsU0FBUyxFQUFDO0FBQWYsV0FDTUssZ0JBRE4sRUFFTUMsWUFGTixFQUdNQyxRQUhOLENBRmMsQ0FBbEI7QUFRSDtBQUNKOztBQUVELHdCQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNNZCxPQUROLGVBRUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQTBDLHlCQUFHLHdCQUFILENBQTFDLENBRkosZUFHSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsb0JBQ0ksMkNBQ00seUJBQ0UsMENBQ0EsNERBRkYsQ0FETixDQURKLGVBT0ksNkJBQUMscUJBQUQsT0FQSixDQUhKLGVBWUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQTBDLHlCQUFHLFlBQUgsQ0FBMUMsQ0FaSixlQWFJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNNSCxZQUROLEVBRU1DLFVBRk4sRUFHTUMsWUFITixlQUlJLDZCQUFDLDBCQUFELE9BSkosQ0FiSixFQW1CTUUsY0FuQk4sRUFvQk1NLGVBcEJOLENBREo7QUF3Qkg7O0FBeFNnRixDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBzbGVlcCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy91dGlsc1wiO1xuXG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBTZGtDb25maWcgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL1Nka0NvbmZpZ1wiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uLy4uLy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCBBbmFseXRpY3MgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL0FuYWx5dGljc1wiO1xuaW1wb3J0IGRpcyBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyXCI7XG5pbXBvcnQgeyBwcml2YXRlU2hvdWxkQmVFbmNyeXB0ZWQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vY3JlYXRlUm9vbVwiO1xuaW1wb3J0IHsgU2V0dGluZ0xldmVsIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdMZXZlbFwiO1xuaW1wb3J0IFNlY3VyZUJhY2t1cFBhbmVsIGZyb20gXCIuLi8uLi9TZWN1cmVCYWNrdXBQYW5lbFwiO1xuaW1wb3J0IFNldHRpbmdzU3RvcmUgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdzU3RvcmVcIjtcbmltcG9ydCB7IFVJRmVhdHVyZSB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9VSUZlYXR1cmVcIjtcbmltcG9ydCBFMmVBZHZhbmNlZFBhbmVsLCB7IGlzRTJlQWR2YW5jZWRQYW5lbFBvc3NpYmxlIH0gZnJvbSBcIi4uLy4uL0UyZUFkdmFuY2VkUGFuZWxcIjtcbmltcG9ydCBDb3VudGx5QW5hbHl0aWNzIGZyb20gXCIuLi8uLi8uLi8uLi8uLi9Db3VudGx5QW5hbHl0aWNzXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IHsgUG9zdGhvZ0FuYWx5dGljcyB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9Qb3N0aG9nQW5hbHl0aWNzXCI7XG5pbXBvcnQgeyBBY3Rpb25QYXlsb2FkIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL2Rpc3BhdGNoZXIvcGF5bG9hZHNcIjtcbmltcG9ydCB7IFJvb20gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb21cIjtcbmltcG9ydCBDcnlwdG9ncmFwaHlQYW5lbCBmcm9tIFwiLi4vLi4vQ3J5cHRvZ3JhcGh5UGFuZWxcIjtcbmltcG9ydCBEZXZpY2VzUGFuZWwgZnJvbSBcIi4uLy4uL0RldmljZXNQYW5lbFwiO1xuaW1wb3J0IFNldHRpbmdzRmxhZyBmcm9tIFwiLi4vLi4vLi4vZWxlbWVudHMvU2V0dGluZ3NGbGFnXCI7XG5pbXBvcnQgQ3Jvc3NTaWduaW5nUGFuZWwgZnJvbSBcIi4uLy4uL0Nyb3NzU2lnbmluZ1BhbmVsXCI7XG5pbXBvcnQgRXZlbnRJbmRleFBhbmVsIGZyb20gXCIuLi8uLi9FdmVudEluZGV4UGFuZWxcIjtcbmltcG9ydCBJbmxpbmVTcGlubmVyIGZyb20gXCIuLi8uLi8uLi9lbGVtZW50cy9JbmxpbmVTcGlubmVyXCI7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcblxuaW50ZXJmYWNlIElJZ25vcmVkVXNlclByb3BzIHtcbiAgICB1c2VySWQ6IHN0cmluZztcbiAgICBvblVuaWdub3JlZDogKHVzZXJJZDogc3RyaW5nKSA9PiB2b2lkO1xuICAgIGluUHJvZ3Jlc3M6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBJZ25vcmVkVXNlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJSWdub3JlZFVzZXJQcm9wcz4ge1xuICAgIHByaXZhdGUgb25Vbmlnbm9yZUNsaWNrZWQgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMucHJvcHMub25Vbmlnbm9yZWQodGhpcy5wcm9wcy51c2VySWQpO1xuICAgIH07XG5cbiAgICBwdWJsaWMgcmVuZGVyKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgY29uc3QgaWQgPSBgbXhfU2VjdXJpdHlVc2VyU2V0dGluZ3NUYWJfaWdub3JlZFVzZXJfJHt0aGlzLnByb3BzLnVzZXJJZH1gO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NlY3VyaXR5VXNlclNldHRpbmdzVGFiX2lnbm9yZWRVc2VyJz5cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBvbkNsaWNrPXt0aGlzLm9uVW5pZ25vcmVDbGlja2VkfSBraW5kPSdwcmltYXJ5X3NtJyBhcmlhLWRlc2NyaWJlZGJ5PXtpZH0gZGlzYWJsZWQ9e3RoaXMucHJvcHMuaW5Qcm9ncmVzc30+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoJ1VuaWdub3JlJykgfVxuICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBpZD17aWR9PnsgdGhpcy5wcm9wcy51c2VySWQgfTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgY2xvc2VTZXR0aW5nc0ZuOiAoKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBpZ25vcmVkVXNlcklkczogc3RyaW5nW107XG4gICAgd2FpdGluZ1VuaWdub3JlZDogc3RyaW5nW107XG4gICAgbWFuYWdpbmdJbnZpdGVzOiBib29sZWFuO1xuICAgIGludml0ZWRSb29tSWRzOiBTZXQ8c3RyaW5nPjtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3Muc2V0dGluZ3MudGFicy51c2VyLlNlY3VyaXR5VXNlclNldHRpbmdzVGFiXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN1cml0eVVzZXJTZXR0aW5nc1RhYiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgZGlzcGF0Y2hlclJlZjogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgLy8gR2V0IHJvb21zIHdlJ3JlIGludml0ZWQgdG9cbiAgICAgICAgY29uc3QgaW52aXRlZFJvb21JZHMgPSBuZXcgU2V0KHRoaXMuZ2V0SW52aXRlZFJvb21zKCkubWFwKHJvb20gPT4gcm9vbS5yb29tSWQpKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgaWdub3JlZFVzZXJJZHM6IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRJZ25vcmVkVXNlcnMoKSxcbiAgICAgICAgICAgIHdhaXRpbmdVbmlnbm9yZWQ6IFtdLFxuICAgICAgICAgICAgbWFuYWdpbmdJbnZpdGVzOiBmYWxzZSxcbiAgICAgICAgICAgIGludml0ZWRSb29tSWRzLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgb25BY3Rpb24gPSAoeyBhY3Rpb24gfTogQWN0aW9uUGF5bG9hZCk9PiB7XG4gICAgICAgIGlmIChhY3Rpb24gPT09IFwiaWdub3JlX3N0YXRlX2NoYW5nZWRcIikge1xuICAgICAgICAgICAgY29uc3QgaWdub3JlZFVzZXJJZHMgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0SWdub3JlZFVzZXJzKCk7XG4gICAgICAgICAgICBjb25zdCBuZXdXYWl0aW5nVW5pZ25vcmVkID0gdGhpcy5zdGF0ZS53YWl0aW5nVW5pZ25vcmVkLmZpbHRlcihlPT4gaWdub3JlZFVzZXJJZHMuaW5jbHVkZXMoZSkpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlnbm9yZWRVc2VySWRzLCB3YWl0aW5nVW5pZ25vcmVkOiBuZXdXYWl0aW5nVW5pZ25vcmVkIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHB1YmxpYyBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXNwYXRjaGVyUmVmID0gZGlzLnJlZ2lzdGVyKHRoaXMub25BY3Rpb24pO1xuICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkub24oXCJSb29tLm15TWVtYmVyc2hpcFwiLCB0aGlzLm9uTXlNZW1iZXJzaGlwKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XG4gICAgICAgIGRpcy51bnJlZ2lzdGVyKHRoaXMuZGlzcGF0Y2hlclJlZik7XG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5yZW1vdmVMaXN0ZW5lcihcIlJvb20ubXlNZW1iZXJzaGlwXCIsIHRoaXMub25NeU1lbWJlcnNoaXApO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlQW5hbHl0aWNzID0gKGNoZWNrZWQ6IGJvb2xlYW4pOiB2b2lkID0+IHtcbiAgICAgICAgY2hlY2tlZCA/IEFuYWx5dGljcy5lbmFibGUoKSA6IEFuYWx5dGljcy5kaXNhYmxlKCk7XG4gICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UuZW5hYmxlKC8qIGFub255bW91cyA9ICovICFjaGVja2VkKTtcbiAgICAgICAgUG9zdGhvZ0FuYWx5dGljcy5pbnN0YW5jZS51cGRhdGVBbm9ueW1pdHlGcm9tU2V0dGluZ3MoTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFVzZXJJZCgpKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbk15TWVtYmVyc2hpcCA9IChyb29tOiBSb29tLCBtZW1iZXJzaGlwOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKHJvb20uaXNTcGFjZVJvb20oKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1lbWJlcnNoaXAgPT09IFwiaW52aXRlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkSW52aXRlZFJvb20ocm9vbSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5pbnZpdGVkUm9vbUlkcy5oYXMocm9vbS5yb29tSWQpKSB7XG4gICAgICAgICAgICAvLyBUaGUgdXNlciBpc24ndCBpbnZpdGVkIGFueW1vcmVcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSW52aXRlZFJvb20ocm9vbS5yb29tSWQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgYWRkSW52aXRlZFJvb20gPSAocm9vbTogUm9vbSk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKCh7IGludml0ZWRSb29tSWRzIH0pID0+ICh7XG4gICAgICAgICAgICBpbnZpdGVkUm9vbUlkczogbmV3IFNldChpbnZpdGVkUm9vbUlkcykuYWRkKHJvb20ucm9vbUlkKSxcbiAgICAgICAgfSkpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHJlbW92ZUludml0ZWRSb29tID0gKHJvb21JZDogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoKHsgaW52aXRlZFJvb21JZHMgfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmV3SW52aXRlZFJvb21JZHMgPSBuZXcgU2V0KGludml0ZWRSb29tSWRzKTtcbiAgICAgICAgICAgIG5ld0ludml0ZWRSb29tSWRzLmRlbGV0ZShyb29tSWQpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGludml0ZWRSb29tSWRzOiBuZXdJbnZpdGVkUm9vbUlkcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uR29Ub1VzZXJQcm9maWxlQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICBhY3Rpb246ICd2aWV3X3VzZXJfaW5mbycsXG4gICAgICAgICAgICB1c2VySWQ6IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRVc2VySWQoKSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucHJvcHMuY2xvc2VTZXR0aW5nc0ZuKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Vc2VyVW5pZ25vcmVkID0gYXN5bmMgKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIGNvbnN0IHsgaWdub3JlZFVzZXJJZHMsIHdhaXRpbmdVbmlnbm9yZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRseUlnbm9yZWRVc2VySWRzID0gaWdub3JlZFVzZXJJZHMuZmlsdGVyKGUgPT4gIXdhaXRpbmdVbmlnbm9yZWQuaW5jbHVkZXMoZSkpO1xuXG4gICAgICAgIGNvbnN0IGluZGV4ID0gY3VycmVudGx5SWdub3JlZFVzZXJJZHMuaW5kZXhPZih1c2VySWQpO1xuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBjdXJyZW50bHlJZ25vcmVkVXNlcklkcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSgoeyB3YWl0aW5nVW5pZ25vcmVkIH0pID0+ICh7IHdhaXRpbmdVbmlnbm9yZWQ6IFsuLi53YWl0aW5nVW5pZ25vcmVkLCB1c2VySWRdIH0pKTtcbiAgICAgICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5zZXRJZ25vcmVkVXNlcnMoY3VycmVudGx5SWdub3JlZFVzZXJJZHMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgZ2V0SW52aXRlZFJvb21zID0gKCk6IFJvb21bXSA9PiB7XG4gICAgICAgIHJldHVybiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0Um9vbXMoKS5maWx0ZXIoKHIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiByLmhhc01lbWJlcnNoaXBTdGF0ZShNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0VXNlcklkKCksIFwiaW52aXRlXCIpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBtYW5hZ2VJbnZpdGVzID0gYXN5bmMgKGFjY2VwdDogYm9vbGVhbik6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIG1hbmFnaW5nSW52aXRlczogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gaXRlcmF0ZSB3aXRoIGEgbm9ybWFsIGZvciBsb29wIGluIG9yZGVyIHRvIHJldHJ5IG9uIGFjdGlvbiBmYWlsdXJlXG4gICAgICAgIGNvbnN0IGludml0ZWRSb29tSWRzVmFsdWVzID0gQXJyYXkuZnJvbSh0aGlzLnN0YXRlLmludml0ZWRSb29tSWRzKTtcblxuICAgICAgICAvLyBFeGVjdXRlIGFsbCBhY2NlcHRhbmNlcy9yZWplY3Rpb25zIHNlcXVlbnRpYWxseVxuICAgICAgICBjb25zdCBjbGkgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IGFjY2VwdCA/IGNsaS5qb2luUm9vbS5iaW5kKGNsaSkgOiBjbGkubGVhdmUuYmluZChjbGkpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGludml0ZWRSb29tSWRzVmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCByb29tSWQgPSBpbnZpdGVkUm9vbUlkc1ZhbHVlc1tpXTtcblxuICAgICAgICAgICAgLy8gQWNjZXB0L3JlamVjdCBpbnZpdGVcbiAgICAgICAgICAgIGF3YWl0IGFjdGlvbihyb29tSWQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIE5vIGVycm9yLCB1cGRhdGUgaW52aXRlZCByb29tcyBidXR0b25cbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUludml0ZWRSb29tKHJvb21JZCk7XG4gICAgICAgICAgICB9LCBhc3luYyAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEFjdGlvbiBmYWlsdXJlXG4gICAgICAgICAgICAgICAgaWYgKGUuZXJyY29kZSA9PT0gXCJNX0xJTUlUX0VYQ0VFREVEXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGEgZGVsYXkgYmV0d2VlbiBlYWNoIGludml0ZSBjaGFuZ2UgaW4gb3JkZXIgdG8gYXZvaWQgcmF0ZVxuICAgICAgICAgICAgICAgICAgICAvLyBsaW1pdGluZyBieSB0aGUgc2VydmVyLlxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzbGVlcChlLnJldHJ5X2FmdGVyX21zIHx8IDI1MDApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlZG8gbGFzdCBhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgaS0tO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFByaW50IG91dCBlcnJvciB3aXRoIGpvaW5pbmcvbGVhdmluZyByb29tXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBtYW5hZ2luZ0ludml0ZXM6IGZhbHNlLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkFjY2VwdEFsbEludml0ZXNDbGlja2VkID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLm1hbmFnZUludml0ZXModHJ1ZSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25SZWplY3RBbGxJbnZpdGVzQ2xpY2tlZCA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5tYW5hZ2VJbnZpdGVzKGZhbHNlKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZW5kZXJJZ25vcmVkVXNlcnMoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBjb25zdCB7IHdhaXRpbmdVbmlnbm9yZWQsIGlnbm9yZWRVc2VySWRzIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgICAgIGNvbnN0IHVzZXJJZHMgPSAhaWdub3JlZFVzZXJJZHM/Lmxlbmd0aFxuICAgICAgICAgICAgPyBfdCgnWW91IGhhdmUgbm8gaWdub3JlZCB1c2Vycy4nKVxuICAgICAgICAgICAgOiBpZ25vcmVkVXNlcklkcy5tYXAoKHUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICA8SWdub3JlZFVzZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZD17dX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uVW5pZ25vcmVkPXt0aGlzLm9uVXNlclVuaWdub3JlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGtleT17dX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGluUHJvZ3Jlc3M9e3dhaXRpbmdVbmlnbm9yZWQuaW5jbHVkZXModSl9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbXhfU2V0dGluZ3NUYWJfc2VjdGlvbic+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSdteF9TZXR0aW5nc1RhYl9zdWJoZWFkaW5nJz57IF90KCdJZ25vcmVkIHVzZXJzJykgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbXhfU2V0dGluZ3NUYWJfc3Vic2VjdGlvblRleHQnPlxuICAgICAgICAgICAgICAgICAgICB7IHVzZXJJZHMgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJNYW5hZ2VJbnZpdGVzKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgY29uc3QgeyBpbnZpdGVkUm9vbUlkcyB9ID0gdGhpcy5zdGF0ZTtcblxuICAgICAgICBpZiAoaW52aXRlZFJvb21JZHMuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3NlY3Rpb24gbXhfU2VjdXJpdHlVc2VyU2V0dGluZ3NUYWJfYnVsa09wdGlvbnMnPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0nbXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZyc+eyBfdCgnQnVsayBvcHRpb25zJykgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBvbkNsaWNrPXt0aGlzLm9uQWNjZXB0QWxsSW52aXRlc0NsaWNrZWR9IGtpbmQ9J3ByaW1hcnknIGRpc2FibGVkPXt0aGlzLnN0YXRlLm1hbmFnaW5nSW52aXRlc30+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJBY2NlcHQgYWxsICUoaW52aXRlZFJvb21zKXMgaW52aXRlc1wiLCB7IGludml0ZWRSb29tczogaW52aXRlZFJvb21JZHMuc2l6ZSB9KSB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIG9uQ2xpY2s9e3RoaXMub25SZWplY3RBbGxJbnZpdGVzQ2xpY2tlZH0ga2luZD0nZGFuZ2VyJyBkaXNhYmxlZD17dGhpcy5zdGF0ZS5tYW5hZ2luZ0ludml0ZXN9PlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiUmVqZWN0IGFsbCAlKGludml0ZWRSb29tcylzIGludml0ZXNcIiwgeyBpbnZpdGVkUm9vbXM6IGludml0ZWRSb29tSWRzLnNpemUgfSkgfVxuICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICB7IHRoaXMuc3RhdGUubWFuYWdpbmdJbnZpdGVzID8gPElubGluZVNwaW5uZXIgLz4gOiA8ZGl2IC8+IH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBjb25zdCBicmFuZCA9IFNka0NvbmZpZy5nZXQoKS5icmFuZDtcblxuICAgICAgICBjb25zdCBzZWN1cmVCYWNrdXAgPSAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbXhfU2V0dGluZ3NUYWJfc2VjdGlvbic+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZ1wiPnsgX3QoXCJTZWN1cmUgQmFja3VwXCIpIH08L3NwYW4+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3N1YnNlY3Rpb25UZXh0Jz5cbiAgICAgICAgICAgICAgICAgICAgPFNlY3VyZUJhY2t1cFBhbmVsIC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBldmVudEluZGV4ID0gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZ1wiPnsgX3QoXCJNZXNzYWdlIHNlYXJjaFwiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxFdmVudEluZGV4UGFuZWwgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFhYWDogVGhlcmUncyBubyBzdWNoIHBhbmVsIGluIHRoZSBjdXJyZW50IGNyb3NzLXNpZ25pbmcgZGVzaWducywgYnV0XG4gICAgICAgIC8vIGl0J3MgdXNlZnVsIHRvIGhhdmUgZm9yIHRlc3RpbmcgdGhlIGZlYXR1cmUuIElmIHRoZXJlJ3Mgbm8gaW50ZXJlc3RcbiAgICAgICAgLy8gaW4gaGF2aW5nIGFkdmFuY2VkIGRldGFpbHMgaGVyZSBvbmNlIGFsbCBmbG93cyBhcmUgaW1wbGVtZW50ZWQsIHdlXG4gICAgICAgIC8vIGNhbiByZW1vdmUgdGhpcy5cbiAgICAgICAgY29uc3QgY3Jvc3NTaWduaW5nID0gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3NlY3Rpb24nPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YmhlYWRpbmdcIj57IF90KFwiQ3Jvc3Mtc2lnbmluZ1wiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9TZXR0aW5nc1RhYl9zdWJzZWN0aW9uVGV4dCc+XG4gICAgICAgICAgICAgICAgICAgIDxDcm9zc1NpZ25pbmdQYW5lbCAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG5cbiAgICAgICAgbGV0IHdhcm5pbmc7XG4gICAgICAgIGlmICghcHJpdmF0ZVNob3VsZEJlRW5jcnlwdGVkKCkpIHtcbiAgICAgICAgICAgIHdhcm5pbmcgPSA8ZGl2IGNsYXNzTmFtZT1cIm14X1NlY3VyaXR5VXNlclNldHRpbmdzVGFiX3dhcm5pbmdcIj5cbiAgICAgICAgICAgICAgICB7IF90KFwiWW91ciBzZXJ2ZXIgYWRtaW4gaGFzIGRpc2FibGVkIGVuZC10by1lbmQgZW5jcnlwdGlvbiBieSBkZWZhdWx0IFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJpbiBwcml2YXRlIHJvb21zICYgRGlyZWN0IE1lc3NhZ2VzLlwiKSB9XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcHJpdmFjeVNlY3Rpb247XG4gICAgICAgIGlmIChBbmFseXRpY3MuY2FuRW5hYmxlKCkgfHwgQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS5jYW5FbmFibGUoKSkge1xuICAgICAgICAgICAgcHJpdmFjeVNlY3Rpb24gPSA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9oZWFkaW5nXCI+eyBfdChcIlByaXZhY3lcIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc2VjdGlvblwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zdWJoZWFkaW5nXCI+eyBfdChcIkFuYWx5dGljc1wiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YnNlY3Rpb25UZXh0XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiJShicmFuZClzIGNvbGxlY3RzIGFub255bW91cyBhbmFseXRpY3MgdG8gYWxsb3cgdXMgdG8gaW1wcm92ZSB0aGUgYXBwbGljYXRpb24uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBicmFuZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJQcml2YWN5IGlzIGltcG9ydGFudCB0byB1cywgc28gd2UgZG9uJ3QgY29sbGVjdCBhbnkgcGVyc29uYWwgb3IgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRlbnRpZmlhYmxlIGRhdGEgZm9yIG91ciBhbmFseXRpY3MuXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX2xpbmtCdG5cIiBvbkNsaWNrPXtBbmFseXRpY3Muc2hvd0RldGFpbHNNb2RhbH0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkxlYXJuIG1vcmUgYWJvdXQgaG93IHdlIHVzZSBhbmFseXRpY3MuXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxTZXR0aW5nc0ZsYWcgbmFtZT1cImFuYWx5dGljc09wdEluXCIgbGV2ZWw9e1NldHRpbmdMZXZlbC5ERVZJQ0V9IG9uQ2hhbmdlPXt0aGlzLnVwZGF0ZUFuYWx5dGljc30gLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGFkdmFuY2VkU2VjdGlvbjtcbiAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoVUlGZWF0dXJlLkFkdmFuY2VkU2V0dGluZ3MpKSB7XG4gICAgICAgICAgICBjb25zdCBpZ25vcmVVc2Vyc1BhbmVsID0gdGhpcy5yZW5kZXJJZ25vcmVkVXNlcnMoKTtcbiAgICAgICAgICAgIGNvbnN0IGludml0ZXNQYW5lbCA9IHRoaXMucmVuZGVyTWFuYWdlSW52aXRlcygpO1xuICAgICAgICAgICAgY29uc3QgZTJlUGFuZWwgPSBpc0UyZUFkdmFuY2VkUGFuZWxQb3NzaWJsZSgpID8gPEUyZUFkdmFuY2VkUGFuZWwgLz4gOiBudWxsO1xuICAgICAgICAgICAgLy8gb25seSBzaG93IHRoZSBzZWN0aW9uIGlmIHRoZXJlJ3Mgc29tZXRoaW5nIHRvIHNob3dcbiAgICAgICAgICAgIGlmIChpZ25vcmVVc2Vyc1BhbmVsIHx8IGludml0ZXNQYW5lbCB8fCBlMmVQYW5lbCkge1xuICAgICAgICAgICAgICAgIGFkdmFuY2VkU2VjdGlvbiA9IDw+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJBZHZhbmNlZFwiKSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc2VjdGlvblwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBpZ25vcmVVc2Vyc1BhbmVsIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgaW52aXRlc1BhbmVsIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgZTJlUGFuZWwgfVxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8Lz47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYiBteF9TZWN1cml0eVVzZXJTZXR0aW5nc1RhYlwiPlxuICAgICAgICAgICAgICAgIHsgd2FybmluZyB9XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9oZWFkaW5nXCI+eyBfdChcIldoZXJlIHlvdSdyZSBzaWduZWQgaW5cIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc2VjdGlvblwiPlxuICAgICAgICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJNYW5hZ2UgeW91ciBzaWduZWQtaW4gZGV2aWNlcyBiZWxvdy4gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQSBkZXZpY2UncyBuYW1lIGlzIHZpc2libGUgdG8gcGVvcGxlIHlvdSBjb21tdW5pY2F0ZSB3aXRoLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPERldmljZXNQYW5lbCAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJFbmNyeXB0aW9uXCIpIH08L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3NlY3Rpb25cIj5cbiAgICAgICAgICAgICAgICAgICAgeyBzZWN1cmVCYWNrdXAgfVxuICAgICAgICAgICAgICAgICAgICB7IGV2ZW50SW5kZXggfVxuICAgICAgICAgICAgICAgICAgICB7IGNyb3NzU2lnbmluZyB9XG4gICAgICAgICAgICAgICAgICAgIDxDcnlwdG9ncmFwaHlQYW5lbCAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIHsgcHJpdmFjeVNlY3Rpb24gfVxuICAgICAgICAgICAgICAgIHsgYWR2YW5jZWRTZWN0aW9uIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==