"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _languageHandler = require("../../../../../languageHandler");

var _MatrixClientPeg = require("../../../../../MatrixClientPeg");

var _AccessibleButton = _interopRequireDefault(require("../../../elements/AccessibleButton"));

var _Notifier = _interopRequireDefault(require("../../../../../Notifier"));

var _SettingsStore = _interopRequireDefault(require("../../../../../settings/SettingsStore"));

var _SettingLevel = require("../../../../../settings/SettingLevel");

var _replaceableComponent = require("../../../../../utils/replaceableComponent");

var _logger = require("matrix-js-sdk/src/logger");

var _EchoChamber = require("../../../../../stores/local-echo/EchoChamber");

var _MatrixClientContext = _interopRequireDefault(require("../../../../../contexts/MatrixClientContext"));

var _StyledRadioGroup = _interopRequireDefault(require("../../../elements/StyledRadioGroup"));

var _RoomNotifs = require("../../../../../RoomNotifs");

var _dispatcher = _interopRequireDefault(require("../../../../../dispatcher/dispatcher"));

var _actions = require("../../../../../dispatcher/actions");

var _UserSettingsDialog = require("../../../dialogs/UserSettingsDialog");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let NotificationsSettingsTab = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.tabs.room.NotificationsSettingsTab"), _dec(_class = (_temp = _class2 = class NotificationsSettingsTab extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    (0, _defineProperty2.default)(this, "roomProps", void 0);
    (0, _defineProperty2.default)(this, "soundUpload", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "context", void 0);
    (0, _defineProperty2.default)(this, "triggerUploader", async e => {
      e.stopPropagation();
      e.preventDefault();
      this.soundUpload.current.click();
    });
    (0, _defineProperty2.default)(this, "onSoundUploadChanged", e => {
      if (!e.target.files || !e.target.files.length) {
        this.setState({
          uploadedFile: null
        });
        return;
      }

      const file = e.target.files[0];
      this.setState({
        uploadedFile: file
      });
    });
    (0, _defineProperty2.default)(this, "onClickSaveSound", async e => {
      e.stopPropagation();
      e.preventDefault();

      try {
        await this.saveSound();
      } catch (ex) {
        _logger.logger.error(`Unable to save notification sound for ${this.props.roomId}`);

        _logger.logger.error(ex);
      }
    });
    (0, _defineProperty2.default)(this, "clearSound", e => {
      e.stopPropagation();
      e.preventDefault();

      _SettingsStore.default.setValue("notificationSound", this.props.roomId, _SettingLevel.SettingLevel.ROOM_ACCOUNT, null);

      this.setState({
        currentSound: "default"
      });
    });
    (0, _defineProperty2.default)(this, "onRoomNotificationChange", value => {
      this.roomProps.notificationVolume = value;
      this.forceUpdate();
    });
    (0, _defineProperty2.default)(this, "onOpenSettingsClick", () => {
      this.props.closeSettingsFn();

      _dispatcher.default.dispatch({
        action: _actions.Action.ViewUserSettings,
        initialTabId: _UserSettingsDialog.UserTab.Notifications
      });
    });
    this.roomProps = _EchoChamber.EchoChamber.forRoom(context.getRoom(this.props.roomId));
    this.state = {
      currentSound: "default",
      uploadedFile: null
    };
  } // TODO: [REACT-WARNING] Replace component with real class, use constructor for refs
  // eslint-disable-next-line @typescript-eslint/naming-convention, camelcase


  UNSAFE_componentWillMount() {
    const soundData = _Notifier.default.getSoundForRoom(this.props.roomId);

    if (!soundData) {
      return;
    }

    this.setState({
      currentSound: soundData.name || soundData.url
    });
  }

  async saveSound() {
    if (!this.state.uploadedFile) {
      return;
    }

    let type = this.state.uploadedFile.type;

    if (type === "video/ogg") {
      // XXX: I've observed browsers allowing users to pick a audio/ogg files,
      // and then calling it a video/ogg. This is a lame hack, but man browsers
      // suck at detecting mimetypes.
      type = "audio/ogg";
    }

    const url = await _MatrixClientPeg.MatrixClientPeg.get().uploadContent(this.state.uploadedFile, {
      type
    });
    await _SettingsStore.default.setValue("notificationSound", this.props.roomId, _SettingLevel.SettingLevel.ROOM_ACCOUNT, {
      name: this.state.uploadedFile.name,
      type: type,
      size: this.state.uploadedFile.size,
      url
    });
    this.setState({
      uploadedFile: null,
      currentSound: this.state.uploadedFile.name
    });
  }

  render() {
    let currentUploadedFile = null;

    if (this.state.uploadedFile) {
      currentUploadedFile = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Uploaded sound"), ": ", /*#__PURE__*/_react.default.createElement("code", null, this.state.uploadedFile.name)));
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Notifications")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_NotificationSettingsTab_notificationsSection"
    }, /*#__PURE__*/_react.default.createElement(_StyledRadioGroup.default, {
      name: "roomNotificationSetting",
      definitions: [{
        value: _RoomNotifs.RoomNotifState.AllMessages,
        className: "mx_NotificationSettingsTab_defaultEntry",
        label: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, (0, _languageHandler._t)("Default"), /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_NotificationSettingsTab_microCopy"
        }, (0, _languageHandler._t)("Get notifications as set up in your <a>settings</a>", {}, {
          a: sub => /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
            kind: "link",
            onClick: this.onOpenSettingsClick
          }, sub)
        })))
      }, {
        value: _RoomNotifs.RoomNotifState.AllMessagesLoud,
        className: "mx_NotificationSettingsTab_allMessagesEntry",
        label: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, (0, _languageHandler._t)("All messages"), /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_NotificationSettingsTab_microCopy"
        }, (0, _languageHandler._t)("Get notified for every message")))
      }, {
        value: _RoomNotifs.RoomNotifState.MentionsOnly,
        className: "mx_NotificationSettingsTab_mentionsKeywordsEntry",
        label: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, (0, _languageHandler._t)("@mentions & keywords"), /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_NotificationSettingsTab_microCopy"
        }, (0, _languageHandler._t)("Get notified only with mentions and keywords " + "as set up in your <a>settings</a>", {}, {
          a: sub => /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
            kind: "link",
            onClick: this.onOpenSettingsClick
          }, sub)
        })))
      }, {
        value: _RoomNotifs.RoomNotifState.Mute,
        className: "mx_NotificationSettingsTab_noneEntry",
        label: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, (0, _languageHandler._t)("Off"), /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_NotificationSettingsTab_microCopy"
        }, (0, _languageHandler._t)("You won't get any notifications")))
      }],
      onChange: this.onRoomNotificationChange,
      value: this.roomProps.notificationVolume
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Sounds")), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Notification sound"), ": ", /*#__PURE__*/_react.default.createElement("code", null, this.state.currentSound))), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_NotificationSound_resetSound",
      disabled: this.state.currentSound == "default",
      onClick: this.clearSound,
      kind: "primary"
    }, (0, _languageHandler._t)("Reset"))), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Set a new custom sound")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsFlag"
    }, /*#__PURE__*/_react.default.createElement("form", {
      autoComplete: "off",
      noValidate: true
    }, /*#__PURE__*/_react.default.createElement("input", {
      ref: this.soundUpload,
      className: "mx_NotificationSound_soundUpload",
      type: "file",
      onChange: this.onSoundUploadChanged,
      accept: "audio/*"
    })), currentUploadedFile), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_NotificationSound_browse",
      onClick: this.triggerUploader,
      kind: "primary"
    }, (0, _languageHandler._t)("Browse")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_NotificationSound_save",
      disabled: this.state.uploadedFile == null,
      onClick: this.onClickSaveSound,
      kind: "primary"
    }, (0, _languageHandler._t)("Save")), /*#__PURE__*/_react.default.createElement("br", null))));
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _MatrixClientContext.default), _temp)) || _class);
exports.default = NotificationsSettingsTab;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL3RhYnMvcm9vbS9Ob3RpZmljYXRpb25TZXR0aW5nc1RhYi50c3giXSwibmFtZXMiOlsiTm90aWZpY2F0aW9uc1NldHRpbmdzVGFiIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29udGV4dCIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsInNvdW5kVXBsb2FkIiwiY3VycmVudCIsImNsaWNrIiwidGFyZ2V0IiwiZmlsZXMiLCJsZW5ndGgiLCJzZXRTdGF0ZSIsInVwbG9hZGVkRmlsZSIsImZpbGUiLCJzYXZlU291bmQiLCJleCIsImxvZ2dlciIsImVycm9yIiwicm9vbUlkIiwiU2V0dGluZ3NTdG9yZSIsInNldFZhbHVlIiwiU2V0dGluZ0xldmVsIiwiUk9PTV9BQ0NPVU5UIiwiY3VycmVudFNvdW5kIiwidmFsdWUiLCJyb29tUHJvcHMiLCJub3RpZmljYXRpb25Wb2x1bWUiLCJmb3JjZVVwZGF0ZSIsImNsb3NlU2V0dGluZ3NGbiIsImRlZmF1bHREaXNwYXRjaGVyIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJBY3Rpb24iLCJWaWV3VXNlclNldHRpbmdzIiwiaW5pdGlhbFRhYklkIiwiVXNlclRhYiIsIk5vdGlmaWNhdGlvbnMiLCJFY2hvQ2hhbWJlciIsImZvclJvb20iLCJnZXRSb29tIiwic3RhdGUiLCJVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50Iiwic291bmREYXRhIiwiTm90aWZpZXIiLCJnZXRTb3VuZEZvclJvb20iLCJuYW1lIiwidXJsIiwidHlwZSIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsInVwbG9hZENvbnRlbnQiLCJzaXplIiwicmVuZGVyIiwiY3VycmVudFVwbG9hZGVkRmlsZSIsIlJvb21Ob3RpZlN0YXRlIiwiQWxsTWVzc2FnZXMiLCJjbGFzc05hbWUiLCJsYWJlbCIsImEiLCJzdWIiLCJvbk9wZW5TZXR0aW5nc0NsaWNrIiwiQWxsTWVzc2FnZXNMb3VkIiwiTWVudGlvbnNPbmx5IiwiTXV0ZSIsIm9uUm9vbU5vdGlmaWNhdGlvbkNoYW5nZSIsImNsZWFyU291bmQiLCJvblNvdW5kVXBsb2FkQ2hhbmdlZCIsInRyaWdnZXJVcGxvYWRlciIsIm9uQ2xpY2tTYXZlU291bmQiLCJNYXRyaXhDbGllbnRDb250ZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7SUFhcUJBLHdCLFdBRHBCLGdEQUFxQixtREFBckIsQyxtQ0FBRCxNQUNxQkEsd0JBRHJCLFNBQ3NEQyxlQUFNQyxTQUQ1RCxDQUNzRjtBQU9sRkMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCQyxPQUFoQixFQUF3RTtBQUMvRSxVQUFNRCxLQUFOLEVBQWFDLE9BQWI7QUFEK0U7QUFBQSxvRUFMN0QsdUJBSzZEO0FBQUE7QUFBQSwyREFxQnpELE1BQU9DLENBQVAsSUFBOEM7QUFDcEVBLE1BQUFBLENBQUMsQ0FBQ0MsZUFBRjtBQUNBRCxNQUFBQSxDQUFDLENBQUNFLGNBQUY7QUFFQSxXQUFLQyxXQUFMLENBQWlCQyxPQUFqQixDQUF5QkMsS0FBekI7QUFDSCxLQTFCa0Y7QUFBQSxnRUE0Qm5ETCxDQUFELElBQTJEO0FBQ3RGLFVBQUksQ0FBQ0EsQ0FBQyxDQUFDTSxNQUFGLENBQVNDLEtBQVYsSUFBbUIsQ0FBQ1AsQ0FBQyxDQUFDTSxNQUFGLENBQVNDLEtBQVQsQ0FBZUMsTUFBdkMsRUFBK0M7QUFDM0MsYUFBS0MsUUFBTCxDQUFjO0FBQ1ZDLFVBQUFBLFlBQVksRUFBRTtBQURKLFNBQWQ7QUFHQTtBQUNIOztBQUVELFlBQU1DLElBQUksR0FBR1gsQ0FBQyxDQUFDTSxNQUFGLENBQVNDLEtBQVQsQ0FBZSxDQUFmLENBQWI7QUFDQSxXQUFLRSxR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LGdCQUFqSDtBQUFtSSxNQUFBLElBQUksRUFBQztBQUF4SSxPQUNNLHlCQUFHLE1BQUgsQ0FETixDQWRKLGVBaUJJLHdDQWpCSixDQVZKLENBM0RKLENBREo7QUE0Rkg7O0FBdE9pRixDLHdEQUk3REMsNEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTkgLSAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IGNyZWF0ZVJlZiB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uLy4uLy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCBOb3RpZmllciBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vTm90aWZpZXJcIjtcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gJy4uLy4uLy4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdzU3RvcmUnO1xuaW1wb3J0IHsgU2V0dGluZ0xldmVsIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdMZXZlbFwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuaW1wb3J0IHsgUm9vbUVjaG9DaGFtYmVyIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL3N0b3Jlcy9sb2NhbC1lY2hvL1Jvb21FY2hvQ2hhbWJlclwiO1xuaW1wb3J0IHsgRWNob0NoYW1iZXIgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zdG9yZXMvbG9jYWwtZWNoby9FY2hvQ2hhbWJlcic7XG5pbXBvcnQgTWF0cml4Q2xpZW50Q29udGV4dCBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vY29udGV4dHMvTWF0cml4Q2xpZW50Q29udGV4dFwiO1xuaW1wb3J0IFN0eWxlZFJhZGlvR3JvdXAgZnJvbSBcIi4uLy4uLy4uL2VsZW1lbnRzL1N0eWxlZFJhZGlvR3JvdXBcIjtcbmltcG9ydCB7IFJvb21Ob3RpZlN0YXRlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vUm9vbU5vdGlmcyc7XG5pbXBvcnQgZGVmYXVsdERpc3BhdGNoZXIgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL2Rpc3BhdGNoZXIvZGlzcGF0Y2hlclwiO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL2Rpc3BhdGNoZXIvYWN0aW9uc1wiO1xuaW1wb3J0IHsgVXNlclRhYiB9IGZyb20gXCIuLi8uLi8uLi9kaWFsb2dzL1VzZXJTZXR0aW5nc0RpYWxvZ1wiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICByb29tSWQ6IHN0cmluZztcbiAgICBjbG9zZVNldHRpbmdzRm4oKTogdm9pZDtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgY3VycmVudFNvdW5kOiBzdHJpbmc7XG4gICAgdXBsb2FkZWRGaWxlOiBGaWxlO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5zZXR0aW5ncy50YWJzLnJvb20uTm90aWZpY2F0aW9uc1NldHRpbmdzVGFiXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOb3RpZmljYXRpb25zU2V0dGluZ3NUYWIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJvb21Qcm9wczogUm9vbUVjaG9DaGFtYmVyO1xuICAgIHByaXZhdGUgc291bmRVcGxvYWQgPSBjcmVhdGVSZWY8SFRNTElucHV0RWxlbWVudD4oKTtcblxuICAgIHN0YXRpYyBjb250ZXh0VHlwZSA9IE1hdHJpeENsaWVudENvbnRleHQ7XG4gICAgcHVibGljIGNvbnRleHQhOiBSZWFjdC5Db250ZXh0VHlwZTx0eXBlb2YgTWF0cml4Q2xpZW50Q29udGV4dD47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzLCBjb250ZXh0OiBSZWFjdC5Db250ZXh0VHlwZTx0eXBlb2YgTWF0cml4Q2xpZW50Q29udGV4dD4pIHtcbiAgICAgICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgICAgIHRoaXMucm9vbVByb3BzID0gRWNob0NoYW1iZXIuZm9yUm9vbShjb250ZXh0LmdldFJvb20odGhpcy5wcm9wcy5yb29tSWQpKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgY3VycmVudFNvdW5kOiBcImRlZmF1bHRcIixcbiAgICAgICAgICAgIHVwbG9hZGVkRmlsZTogbnVsbCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBUT0RPOiBbUkVBQ1QtV0FSTklOR10gUmVwbGFjZSBjb21wb25lbnQgd2l0aCByZWFsIGNsYXNzLCB1c2UgY29uc3RydWN0b3IgZm9yIHJlZnNcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uLCBjYW1lbGNhc2VcbiAgICBwdWJsaWMgVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgc291bmREYXRhID0gTm90aWZpZXIuZ2V0U291bmRGb3JSb29tKHRoaXMucHJvcHMucm9vbUlkKTtcbiAgICAgICAgaWYgKCFzb3VuZERhdGEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgY3VycmVudFNvdW5kOiBzb3VuZERhdGEubmFtZSB8fCBzb3VuZERhdGEudXJsIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgdHJpZ2dlclVwbG9hZGVyID0gYXN5bmMgKGU6IFJlYWN0Lk1vdXNlRXZlbnQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHRoaXMuc291bmRVcGxvYWQuY3VycmVudC5jbGljaygpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU291bmRVcGxvYWRDaGFuZ2VkID0gKGU6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIGlmICghZS50YXJnZXQuZmlsZXMgfHwgIWUudGFyZ2V0LmZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgdXBsb2FkZWRGaWxlOiBudWxsLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdXBsb2FkZWRGaWxlOiBmaWxlLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkNsaWNrU2F2ZVNvdW5kID0gYXN5bmMgKGU6IFJlYWN0Lk1vdXNlRXZlbnQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNhdmVTb3VuZCgpO1xuICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgICAgIGBVbmFibGUgdG8gc2F2ZSBub3RpZmljYXRpb24gc291bmQgZm9yICR7dGhpcy5wcm9wcy5yb29tSWR9YCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXgpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgYXN5bmMgc2F2ZVNvdW5kKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUudXBsb2FkZWRGaWxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdHlwZSA9IHRoaXMuc3RhdGUudXBsb2FkZWRGaWxlLnR5cGU7XG4gICAgICAgIGlmICh0eXBlID09PSBcInZpZGVvL29nZ1wiKSB7XG4gICAgICAgICAgICAvLyBYWFg6IEkndmUgb2JzZXJ2ZWQgYnJvd3NlcnMgYWxsb3dpbmcgdXNlcnMgdG8gcGljayBhIGF1ZGlvL29nZyBmaWxlcyxcbiAgICAgICAgICAgIC8vIGFuZCB0aGVuIGNhbGxpbmcgaXQgYSB2aWRlby9vZ2cuIFRoaXMgaXMgYSBsYW1lIGhhY2ssIGJ1dCBtYW4gYnJvd3NlcnNcbiAgICAgICAgICAgIC8vIHN1Y2sgYXQgZGV0ZWN0aW5nIG1pbWV0eXBlcy5cbiAgICAgICAgICAgIHR5cGUgPSBcImF1ZGlvL29nZ1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdXJsID0gYXdhaXQgTWF0cml4Q2xpZW50UGVnLmdldCgpLnVwbG9hZENvbnRlbnQoXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnVwbG9hZGVkRmlsZSwge1xuICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuXG4gICAgICAgIGF3YWl0IFNldHRpbmdzU3RvcmUuc2V0VmFsdWUoXG4gICAgICAgICAgICBcIm5vdGlmaWNhdGlvblNvdW5kXCIsXG4gICAgICAgICAgICB0aGlzLnByb3BzLnJvb21JZCxcbiAgICAgICAgICAgIFNldHRpbmdMZXZlbC5ST09NX0FDQ09VTlQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5zdGF0ZS51cGxvYWRlZEZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgIHNpemU6IHRoaXMuc3RhdGUudXBsb2FkZWRGaWxlLnNpemUsXG4gICAgICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHVwbG9hZGVkRmlsZTogbnVsbCxcbiAgICAgICAgICAgIGN1cnJlbnRTb3VuZDogdGhpcy5zdGF0ZS51cGxvYWRlZEZpbGUubmFtZSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGVhclNvdW5kID0gKGU6IFJlYWN0Lk1vdXNlRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBTZXR0aW5nc1N0b3JlLnNldFZhbHVlKFxuICAgICAgICAgICAgXCJub3RpZmljYXRpb25Tb3VuZFwiLFxuICAgICAgICAgICAgdGhpcy5wcm9wcy5yb29tSWQsXG4gICAgICAgICAgICBTZXR0aW5nTGV2ZWwuUk9PTV9BQ0NPVU5ULFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGN1cnJlbnRTb3VuZDogXCJkZWZhdWx0XCIsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUm9vbU5vdGlmaWNhdGlvbkNoYW5nZSA9ICh2YWx1ZTogUm9vbU5vdGlmU3RhdGUpID0+IHtcbiAgICAgICAgdGhpcy5yb29tUHJvcHMubm90aWZpY2F0aW9uVm9sdW1lID0gdmFsdWU7XG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbk9wZW5TZXR0aW5nc0NsaWNrID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLmNsb3NlU2V0dGluZ3NGbigpO1xuICAgICAgICBkZWZhdWx0RGlzcGF0Y2hlci5kaXNwYXRjaCh7XG4gICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3VXNlclNldHRpbmdzLFxuICAgICAgICAgICAgaW5pdGlhbFRhYklkOiBVc2VyVGFiLk5vdGlmaWNhdGlvbnMsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgcmVuZGVyKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgbGV0IGN1cnJlbnRVcGxvYWRlZEZpbGUgPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS51cGxvYWRlZEZpbGUpIHtcbiAgICAgICAgICAgIGN1cnJlbnRVcGxvYWRlZEZpbGUgPSAoXG4gICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4+eyBfdChcIlVwbG9hZGVkIHNvdW5kXCIpIH06IDxjb2RlPnsgdGhpcy5zdGF0ZS51cGxvYWRlZEZpbGUubmFtZSB9PC9jb2RlPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYlwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJOb3RpZmljYXRpb25zXCIpIH08L2Rpdj5cblxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc2VjdGlvbiBteF9Ob3RpZmljYXRpb25TZXR0aW5nc1RhYl9ub3RpZmljYXRpb25zU2VjdGlvblwiPlxuICAgICAgICAgICAgICAgICAgICA8U3R5bGVkUmFkaW9Hcm91cFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1cInJvb21Ob3RpZmljYXRpb25TZXR0aW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluaXRpb25zPXtbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogUm9vbU5vdGlmU3RhdGUuQWxsTWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJteF9Ob3RpZmljYXRpb25TZXR0aW5nc1RhYl9kZWZhdWx0RW50cnlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IDw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiRGVmYXVsdFwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X05vdGlmaWNhdGlvblNldHRpbmdzVGFiX21pY3JvQ29weVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJHZXQgbm90aWZpY2F0aW9ucyBhcyBzZXQgdXAgaW4geW91ciA8YT5zZXR0aW5nczwvYT5cIiwge30sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYTogc3ViID0+IDxBY2Nlc3NpYmxlQnV0dG9uIGtpbmQ9XCJsaW5rXCIgb25DbGljaz17dGhpcy5vbk9wZW5TZXR0aW5nc0NsaWNrfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgc3ViIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC8+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFJvb21Ob3RpZlN0YXRlLkFsbE1lc3NhZ2VzTG91ZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcIm14X05vdGlmaWNhdGlvblNldHRpbmdzVGFiX2FsbE1lc3NhZ2VzRW50cnlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IDw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiQWxsIG1lc3NhZ2VzXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTm90aWZpY2F0aW9uU2V0dGluZ3NUYWJfbWljcm9Db3B5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkdldCBub3RpZmllZCBmb3IgZXZlcnkgbWVzc2FnZVwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC8+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFJvb21Ob3RpZlN0YXRlLk1lbnRpb25zT25seSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcIm14X05vdGlmaWNhdGlvblNldHRpbmdzVGFiX21lbnRpb25zS2V5d29yZHNFbnRyeVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogPD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJAbWVudGlvbnMgJiBrZXl3b3Jkc1wiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X05vdGlmaWNhdGlvblNldHRpbmdzVGFiX21pY3JvQ29weVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJHZXQgbm90aWZpZWQgb25seSB3aXRoIG1lbnRpb25zIGFuZCBrZXl3b3JkcyBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXMgc2V0IHVwIGluIHlvdXIgPGE+c2V0dGluZ3M8L2E+XCIsIHt9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGE6IHN1YiA9PiA8QWNjZXNzaWJsZUJ1dHRvbiBraW5kPVwibGlua1wiIG9uQ2xpY2s9e3RoaXMub25PcGVuU2V0dGluZ3NDbGlja30+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHN1YiB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBSb29tTm90aWZTdGF0ZS5NdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwibXhfTm90aWZpY2F0aW9uU2V0dGluZ3NUYWJfbm9uZUVudHJ5XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiA8PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIk9mZlwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X05vdGlmaWNhdGlvblNldHRpbmdzVGFiX21pY3JvQ29weVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJZb3Ugd29uJ3QgZ2V0IGFueSBub3RpZmljYXRpb25zXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Lz4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF19XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vblJvb21Ob3RpZmljYXRpb25DaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5yb29tUHJvcHMubm90aWZpY2F0aW9uVm9sdW1lfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3NlY3Rpb24gbXhfU2V0dGluZ3NUYWJfc3Vic2VjdGlvblRleHQnPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3N1YmhlYWRpbmcnPnsgX3QoXCJTb3VuZHNcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3Vic2VjdGlvblRleHRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57IF90KFwiTm90aWZpY2F0aW9uIHNvdW5kXCIpIH06IDxjb2RlPnsgdGhpcy5zdGF0ZS5jdXJyZW50U291bmQgfTwvY29kZT48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGNsYXNzTmFtZT1cIm14X05vdGlmaWNhdGlvblNvdW5kX3Jlc2V0U291bmRcIiBkaXNhYmxlZD17dGhpcy5zdGF0ZS5jdXJyZW50U291bmQgPT0gXCJkZWZhdWx0XCJ9IG9uQ2xpY2s9e3RoaXMuY2xlYXJTb3VuZH0ga2luZD1cInByaW1hcnlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiUmVzZXRcIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxoMz57IF90KFwiU2V0IGEgbmV3IGN1c3RvbSBzb3VuZFwiKSB9PC9oMz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NGbGFnXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGZvcm0gYXV0b0NvbXBsZXRlPVwib2ZmXCIgbm9WYWxpZGF0ZT17dHJ1ZX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCByZWY9e3RoaXMuc291bmRVcGxvYWR9IGNsYXNzTmFtZT1cIm14X05vdGlmaWNhdGlvblNvdW5kX3NvdW5kVXBsb2FkXCIgdHlwZT1cImZpbGVcIiBvbkNoYW5nZT17dGhpcy5vblNvdW5kVXBsb2FkQ2hhbmdlZH0gYWNjZXB0PVwiYXVkaW8vKlwiIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9mb3JtPlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjdXJyZW50VXBsb2FkZWRGaWxlIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9XCJteF9Ob3RpZmljYXRpb25Tb3VuZF9icm93c2VcIiBvbkNsaWNrPXt0aGlzLnRyaWdnZXJVcGxvYWRlcn0ga2luZD1cInByaW1hcnlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiQnJvd3NlXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gY2xhc3NOYW1lPVwibXhfTm90aWZpY2F0aW9uU291bmRfc2F2ZVwiIGRpc2FibGVkPXt0aGlzLnN0YXRlLnVwbG9hZGVkRmlsZSA9PSBudWxsfSBvbkNsaWNrPXt0aGlzLm9uQ2xpY2tTYXZlU291bmR9IGtpbmQ9XCJwcmltYXJ5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIlNhdmVcIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19