"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../../../languageHandler");

var _RoomProfileSettings = _interopRequireDefault(require("../../../room_settings/RoomProfileSettings"));

var _AccessibleButton = _interopRequireDefault(require("../../../elements/AccessibleButton"));

var _dispatcher = _interopRequireDefault(require("../../../../../dispatcher/dispatcher"));

var _MatrixClientContext = _interopRequireDefault(require("../../../../../contexts/MatrixClientContext"));

var _SettingsStore = _interopRequireDefault(require("../../../../../settings/SettingsStore"));

var _UIFeature = require("../../../../../settings/UIFeature");

var _replaceableComponent = require("../../../../../utils/replaceableComponent");

var _UrlPreviewSettings = _interopRequireDefault(require("../../../room_settings/UrlPreviewSettings"));

var _RelatedGroupSettings = _interopRequireDefault(require("../../../room_settings/RelatedGroupSettings"));

var _AliasSettings = _interopRequireDefault(require("../../../room_settings/AliasSettings"));

var _dec, _class, _class2, _temp;

let GeneralRoomSettingsTab = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.tabs.room.GeneralRoomSettingsTab"), _dec(_class = (_temp = _class2 = class GeneralRoomSettingsTab extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    (0, _defineProperty2.default)(this, "context", void 0);
    (0, _defineProperty2.default)(this, "onLeaveClick", () => {
      _dispatcher.default.dispatch({
        action: 'leave_room',
        room_id: this.props.roomId
      });
    });
    this.state = {
      isRoomPublished: false // loaded async

    };
  }

  render() {
    const client = this.context;
    const room = client.getRoom(this.props.roomId);
    const canSetAliases = true; // Previously, we arbitrarily only allowed admins to do this

    const canSetCanonical = room.currentState.mayClientSendStateEvent("m.room.canonical_alias", client);
    const canonicalAliasEv = room.currentState.getStateEvents("m.room.canonical_alias", '');
    const canChangeGroups = room.currentState.mayClientSendStateEvent("m.room.related_groups", client);
    const groupsEvent = room.currentState.getStateEvents("m.room.related_groups", "");

    let urlPreviewSettings = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("URL Previews")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement(_UrlPreviewSettings.default, {
      room: room
    })));

    if (!_SettingsStore.default.getValue(_UIFeature.UIFeature.URLPreviews)) {
      urlPreviewSettings = null;
    }

    let flairSection;

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.Flair)) {
      flairSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_SettingsTab_subheading"
      }, (0, _languageHandler._t)("Flair")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsTab_section mx_SettingsTab_subsectionText"
      }, /*#__PURE__*/_react.default.createElement(_RelatedGroupSettings.default, {
        roomId: room.roomId,
        canSetRelatedGroups: canChangeGroups,
        relatedGroupsEvent: groupsEvent
      })));
    }

    let leaveSection;

    if (room.getMyMembership() === "join") {
      leaveSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_SettingsTab_subheading"
      }, (0, _languageHandler._t)("Leave room")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsTab_section"
      }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        kind: "danger",
        onClick: this.onLeaveClick
      }, (0, _languageHandler._t)('Leave room'))));
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab mx_GeneralRoomSettingsTab"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("General")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_GeneralRoomSettingsTab_profileSection"
    }, /*#__PURE__*/_react.default.createElement(_RoomProfileSettings.default, {
      roomId: this.props.roomId
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Room Addresses")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement(_AliasSettings.default, {
      roomId: this.props.roomId,
      canSetCanonicalAlias: canSetCanonical,
      canSetAliases: canSetAliases,
      canonicalAliasEvent: canonicalAliasEv
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Other")), flairSection, urlPreviewSettings, leaveSection);
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _MatrixClientContext.default), _temp)) || _class);
exports.default = GeneralRoomSettingsTab;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL3RhYnMvcm9vbS9HZW5lcmFsUm9vbVNldHRpbmdzVGFiLnRzeCJdLCJuYW1lcyI6WyJHZW5lcmFsUm9vbVNldHRpbmdzVGFiIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29udGV4dCIsImRpcyIsImRpc3BhdGNoIiwiYWN0aW9uIiwicm9vbV9pZCIsInJvb21JZCIsInN0YXRlIiwiaXNSb29tUHVibGlzaGVkIiwicmVuZGVyIiwiY2xpZW50Iiwicm9vbSIsImdldFJvb20iLCJjYW5TZXRBbGlhc2VzIiwiY2FuU2V0Q2Fub25pY2FsIiwiY3VycmVudFN0YXRlIiwibWF5Q2xpZW50U2VuZFN0YXRlRXZlbnQiLCJjYW5vbmljYWxBbGlhc0V2IiwiZ2V0U3RhdGVFdmVudHMiLCJjYW5DaGFuZ2VHcm91cHMiLCJncm91cHNFdmVudCIsInVybFByZXZpZXdTZXR0aW5ncyIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsIlVJRmVhdHVyZSIsIlVSTFByZXZpZXdzIiwiZmxhaXJTZWN0aW9uIiwiRmxhaXIiLCJsZWF2ZVNlY3Rpb24iLCJnZXRNeU1lbWJlcnNoaXAiLCJvbkxlYXZlQ2xpY2siLCJNYXRyaXhDbGllbnRDb250ZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztJQVdxQkEsc0IsV0FEcEIsZ0RBQXFCLGlEQUFyQixDLG1DQUFELE1BQ3FCQSxzQkFEckIsU0FDb0RDLGVBQU1DLFNBRDFELENBQ29GO0FBSWhGQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBZ0JDLE9BQWhCLEVBQWtFO0FBQ3pFLFVBQU1ELEtBQU4sRUFBYUMsT0FBYjtBQUR5RTtBQUFBLHdEQVF0RCxNQUFZO0FBQy9CQywwQkFB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MEMseUJBQUcsZ0JBQUgsQ0FBMUMsQ0FOSixlQU9JO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSSw2QkFBQyxzQkFBRDtBQUNJLE1BQUEsTUFBTSxFQUFFLEtBQUtOLEtBQUwsQ0FBV00sTUFEdkI7QUFFSSxNQUFBLG9CQUFvQixFQUFFUSxlQUYxQjtBQUdJLE1BQUEsYUFBYSxFQUFFRCxhQUhuQjtBQUlJLE1BQUEsbUJBQW1CLEVBQUVJO0FBSnpCLE1BREosQ0FQSixlQWVJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUEwQyx5QkFBRyxPQUFILENBQTFDLENBZkosRUFnQk1TLFlBaEJOLEVBaUJNTCxrQkFqQk4sRUFrQk1PLFlBbEJOLENBREo7QUFzQkg7O0FBeEYrRSxDLHdEQUNwREcsNEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTkgTmV3IFZlY3RvciBMdGRcblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgQ29udGV4dFR5cGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBSb29tUHJvZmlsZVNldHRpbmdzIGZyb20gXCIuLi8uLi8uLi9yb29tX3NldHRpbmdzL1Jvb21Qcm9maWxlU2V0dGluZ3NcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi8uLi8uLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCBNYXRyaXhDbGllbnRDb250ZXh0IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9jb250ZXh0cy9NYXRyaXhDbGllbnRDb250ZXh0XCI7XG5pbXBvcnQgU2V0dGluZ3NTdG9yZSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vc2V0dGluZ3MvU2V0dGluZ3NTdG9yZVwiO1xuaW1wb3J0IHsgVUlGZWF0dXJlIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL3NldHRpbmdzL1VJRmVhdHVyZVwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCBVcmxQcmV2aWV3U2V0dGluZ3MgZnJvbSBcIi4uLy4uLy4uL3Jvb21fc2V0dGluZ3MvVXJsUHJldmlld1NldHRpbmdzXCI7XG5pbXBvcnQgUmVsYXRlZEdyb3VwU2V0dGluZ3MgZnJvbSBcIi4uLy4uLy4uL3Jvb21fc2V0dGluZ3MvUmVsYXRlZEdyb3VwU2V0dGluZ3NcIjtcbmltcG9ydCBBbGlhc1NldHRpbmdzIGZyb20gXCIuLi8uLi8uLi9yb29tX3NldHRpbmdzL0FsaWFzU2V0dGluZ3NcIjtcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgcm9vbUlkOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIGlzUm9vbVB1Ymxpc2hlZDogYm9vbGVhbjtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3Muc2V0dGluZ3MudGFicy5yb29tLkdlbmVyYWxSb29tU2V0dGluZ3NUYWJcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdlbmVyYWxSb29tU2V0dGluZ3NUYWIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwdWJsaWMgc3RhdGljIGNvbnRleHRUeXBlID0gTWF0cml4Q2xpZW50Q29udGV4dDtcbiAgICBjb250ZXh0OiBDb250ZXh0VHlwZTx0eXBlb2YgTWF0cml4Q2xpZW50Q29udGV4dD47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzLCBjb250ZXh0OiBDb250ZXh0VHlwZTx0eXBlb2YgTWF0cml4Q2xpZW50Q29udGV4dD4pIHtcbiAgICAgICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBpc1Jvb21QdWJsaXNoZWQ6IGZhbHNlLCAvLyBsb2FkZWQgYXN5bmNcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uTGVhdmVDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2xlYXZlX3Jvb20nLFxuICAgICAgICAgICAgcm9vbV9pZDogdGhpcy5wcm9wcy5yb29tSWQsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgcmVuZGVyKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgY29uc3QgY2xpZW50ID0gdGhpcy5jb250ZXh0O1xuICAgICAgICBjb25zdCByb29tID0gY2xpZW50LmdldFJvb20odGhpcy5wcm9wcy5yb29tSWQpO1xuXG4gICAgICAgIGNvbnN0IGNhblNldEFsaWFzZXMgPSB0cnVlOyAvLyBQcmV2aW91c2x5LCB3ZSBhcmJpdHJhcmlseSBvbmx5IGFsbG93ZWQgYWRtaW5zIHRvIGRvIHRoaXNcbiAgICAgICAgY29uc3QgY2FuU2V0Q2Fub25pY2FsID0gcm9vbS5jdXJyZW50U3RhdGUubWF5Q2xpZW50U2VuZFN0YXRlRXZlbnQoXCJtLnJvb20uY2Fub25pY2FsX2FsaWFzXCIsIGNsaWVudCk7XG4gICAgICAgIGNvbnN0IGNhbm9uaWNhbEFsaWFzRXYgPSByb29tLmN1cnJlbnRTdGF0ZS5nZXRTdGF0ZUV2ZW50cyhcIm0ucm9vbS5jYW5vbmljYWxfYWxpYXNcIiwgJycpO1xuXG4gICAgICAgIGNvbnN0IGNhbkNoYW5nZUdyb3VwcyA9IHJvb20uY3VycmVudFN0YXRlLm1heUNsaWVudFNlbmRTdGF0ZUV2ZW50KFwibS5yb29tLnJlbGF0ZWRfZ3JvdXBzXCIsIGNsaWVudCk7XG4gICAgICAgIGNvbnN0IGdyb3Vwc0V2ZW50ID0gcm9vbS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoXCJtLnJvb20ucmVsYXRlZF9ncm91cHNcIiwgXCJcIik7XG5cbiAgICAgICAgbGV0IHVybFByZXZpZXdTZXR0aW5ncyA9IDw+XG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3N1YmhlYWRpbmcnPnsgX3QoXCJVUkwgUHJldmlld3NcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9TZXR0aW5nc1RhYl9zZWN0aW9uJz5cbiAgICAgICAgICAgICAgICA8VXJsUHJldmlld1NldHRpbmdzIHJvb209e3Jvb219IC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC8+O1xuICAgICAgICBpZiAoIVNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoVUlGZWF0dXJlLlVSTFByZXZpZXdzKSkge1xuICAgICAgICAgICAgdXJsUHJldmlld1NldHRpbmdzID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmbGFpclNlY3Rpb247XG4gICAgICAgIGlmIChTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFVJRmVhdHVyZS5GbGFpcikpIHtcbiAgICAgICAgICAgIGZsYWlyU2VjdGlvbiA9IDw+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSdteF9TZXR0aW5nc1RhYl9zdWJoZWFkaW5nJz57IF90KFwiRmxhaXJcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbXhfU2V0dGluZ3NUYWJfc2VjdGlvbiBteF9TZXR0aW5nc1RhYl9zdWJzZWN0aW9uVGV4dCc+XG4gICAgICAgICAgICAgICAgICAgIDxSZWxhdGVkR3JvdXBTZXR0aW5nc1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbUlkPXtyb29tLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhblNldFJlbGF0ZWRHcm91cHM9e2NhbkNoYW5nZUdyb3Vwc31cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0ZWRHcm91cHNFdmVudD17Z3JvdXBzRXZlbnR9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8Lz47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbGVhdmVTZWN0aW9uO1xuICAgICAgICBpZiAocm9vbS5nZXRNeU1lbWJlcnNoaXAoKSA9PT0gXCJqb2luXCIpIHtcbiAgICAgICAgICAgIGxlYXZlU2VjdGlvbiA9IDw+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSdteF9TZXR0aW5nc1RhYl9zdWJoZWFkaW5nJz57IF90KFwiTGVhdmUgcm9vbVwiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9TZXR0aW5nc1RhYl9zZWN0aW9uJz5cbiAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24ga2luZD0nZGFuZ2VyJyBvbkNsaWNrPXt0aGlzLm9uTGVhdmVDbGlja30+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KCdMZWF2ZSByb29tJykgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8Lz47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYiBteF9HZW5lcmFsUm9vbVNldHRpbmdzVGFiXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9oZWFkaW5nXCI+eyBfdChcIkdlbmVyYWxcIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9TZXR0aW5nc1RhYl9zZWN0aW9uIG14X0dlbmVyYWxSb29tU2V0dGluZ3NUYWJfcHJvZmlsZVNlY3Rpb24nPlxuICAgICAgICAgICAgICAgICAgICA8Um9vbVByb2ZpbGVTZXR0aW5ncyByb29tSWQ9e3RoaXMucHJvcHMucm9vbUlkfSAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9oZWFkaW5nXCI+eyBfdChcIlJvb20gQWRkcmVzc2VzXCIpIH08L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbXhfU2V0dGluZ3NUYWJfc2VjdGlvbiBteF9TZXR0aW5nc1RhYl9zdWJzZWN0aW9uVGV4dCc+XG4gICAgICAgICAgICAgICAgICAgIDxBbGlhc1NldHRpbmdzXG4gICAgICAgICAgICAgICAgICAgICAgICByb29tSWQ9e3RoaXMucHJvcHMucm9vbUlkfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FuU2V0Q2Fub25pY2FsQWxpYXM9e2NhblNldENhbm9uaWNhbH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhblNldEFsaWFzZXM9e2NhblNldEFsaWFzZXN9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5vbmljYWxBbGlhc0V2ZW50PXtjYW5vbmljYWxBbGlhc0V2fVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJPdGhlclwiKSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgeyBmbGFpclNlY3Rpb24gfVxuICAgICAgICAgICAgICAgIHsgdXJsUHJldmlld1NldHRpbmdzIH1cbiAgICAgICAgICAgICAgICB7IGxlYXZlU2VjdGlvbiB9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=