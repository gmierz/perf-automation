"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../../../languageHandler");

var _MatrixClientPeg = require("../../../../../MatrixClientPeg");

var _BridgeTile = _interopRequireDefault(require("../../BridgeTile"));

var _replaceableComponent = require("../../../../../utils/replaceableComponent");

var _dec, _class;

const BRIDGE_EVENT_TYPES = ["uk.half-shot.bridge" // m.bridge
];
const BRIDGES_LINK = "https://matrix.org/bridges/";
let BridgeSettingsTab = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.tabs.room.BridgeSettingsTab"), _dec(_class = class BridgeSettingsTab extends _react.default.Component {
  renderBridgeCard(event, room) {
    const content = event.getContent();

    if (!content || !content.channel || !content.protocol) {
      return null;
    }

    return /*#__PURE__*/_react.default.createElement(_BridgeTile.default, {
      key: event.getId(),
      room: room,
      ev: event
    });
  }

  static getBridgeStateEvents(roomId) {
    const client = _MatrixClientPeg.MatrixClientPeg.get();

    const roomState = client.getRoom(roomId).currentState;
    return BRIDGE_EVENT_TYPES.map(typeName => roomState.getStateEvents(typeName)).flat(1);
  }

  render() {
    // This settings tab will only be invoked if the following function returns more
    // than 0 events, so no validation is needed at this stage.
    const bridgeEvents = BridgeSettingsTab.getBridgeStateEvents(this.props.roomId);

    const client = _MatrixClientPeg.MatrixClientPeg.get();

    const room = client.getRoom(this.props.roomId);
    let content;

    if (bridgeEvents.length > 0) {
      content = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This room is bridging messages to the following platforms. " + "<a>Learn more.</a>", {}, {
        // TODO: We don't have this link yet: this will prevent the translators
        // having to re-translate the string when we do.
        a: sub => /*#__PURE__*/_react.default.createElement("a", {
          href: BRIDGES_LINK,
          target: "_blank",
          rel: "noreferrer noopener"
        }, sub)
      })), /*#__PURE__*/_react.default.createElement("ul", {
        className: "mx_RoomSettingsDialog_BridgeList"
      }, bridgeEvents.map(event => this.renderBridgeCard(event, room))));
    } else {
      content = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This room isn't bridging messages to any platforms. " + "<a>Learn more.</a>", {}, {
        // TODO: We don't have this link yet: this will prevent the translators
        // having to re-translate the string when we do.
        a: sub => /*#__PURE__*/_react.default.createElement("a", {
          href: BRIDGES_LINK,
          target: "_blank",
          rel: "noreferrer noopener"
        }, sub)
      }));
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Bridges")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_SettingsTab_subsectionText"
    }, content));
  }

}) || _class);
exports.default = BridgeSettingsTab;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL3RhYnMvcm9vbS9CcmlkZ2VTZXR0aW5nc1RhYi50c3giXSwibmFtZXMiOlsiQlJJREdFX0VWRU5UX1RZUEVTIiwiQlJJREdFU19MSU5LIiwiQnJpZGdlU2V0dGluZ3NUYWIiLCJSZWFjdCIsIkNvbXBvbmVudCIsInJlbmRlckJyaWRnZUNhcmQiLCJldmVudCIsInJvb20iLCJjb250ZW50IiwiZ2V0Q29udGVudCIsImNoYW5uZWwiLCJwcm90b2NvbCIsImdldElkIiwiZ2V0QnJpZGdlU3RhdGVFdmVudHMiLCJyb29tSWQiLCJjbGllbnQiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJyb29tU3RhdGUiLCJnZXRSb29tIiwiY3VycmVudFN0YXRlIiwibWFwIiwidHlwZU5hbWUiLCJnZXRTdGF0ZUV2ZW50cyIsImZsYXQiLCJyZW5kZXIiLCJicmlkZ2VFdmVudHMiLCJwcm9wcyIsImxlbmd0aCIsImEiLCJzdWIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQWdCQTs7QUFJQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU1BLGtCQUFrQixHQUFHLENBQ3ZCLHFCQUR1QixDQUV2QjtBQUZ1QixDQUEzQjtBQUtBLE1BQU1DLFlBQVksR0FBRyw2QkFBckI7SUFPcUJDLGlCLFdBRHBCLGdEQUFxQiw0Q0FBckIsQyxnQkFBRCxNQUNxQkEsaUJBRHJCLFNBQytDQyxlQUFNQyxTQURyRCxDQUN1RTtBQUMzREMsRUFBQUEsZ0JBQWdCLENBQUNDLEtBQUQsRUFBcUJDLElBQXJCLEVBQWlDO0FBQ3JELFVBQU1DLE9BQU8sR0FBR0YsS0FBSyxDQUFDRyxVQUFOLEVBQWhCOztBQUNBLFFBQUksQ0FBQ0QsT0FBRCxJQUFZLENBQUNBLE9BQU8sQ0FBQ0UsT0FBckIsSUFBZ0MsQ0FBQ0YsT0FBTyxDQUFDRyxRQUE3QyxFQUF1RDtBQUNuRCxhQUFPLElBQVA7QUFDSDs7QUFDRCx3QkFBTyw2QkFBQyxtQkFBRDtBQUFZLE1BQUEsR0FBRyxFQUFFTCxLQUFLLENBQUNNLEtBQU4sRUFBakI7QUFBZ0MsTUFBQSxJQUFJLEVBQUVMLElBQXRDO0FBQTRDLE1BQUEsRUFBRSxFQUFFRDtBQUFoRCxNQUFQO0FBQ0g7O0FBRTBCLFNBQXBCTyxvQkFBb0IsQ0FBQ0MsTUFBRCxFQUFnQztBQUN2RCxVQUFNQyxNQUFNLEdBQUdDLGlDQUFnQkMsR0FBaEIsRUFBZjs7QUFDQSxVQUFNQyxTQUFTLEdBQUdILE1BQU0sQ0FBQ0ksT0FBUCxDQUFlTCxNQUFmLEVBQXVCTSxZQUF6QztBQUVBLFdBQU9wQixrQkFBa0IsQ0FBQ3FCLEdBQW5CLENBQXVCQyxRQUFRLElBQUlKLFNBQVMsQ0FBQ0ssY0FBVixDQUF5QkQsUUFBekIsQ0FBbkMsRUFBdUVFLElBQXZFLENBQTRFLENBQTVFLENBQVA7QUFDSDs7QUFFREMsRUFBQUEsTUFBTSxHQUFHO0FBQ0w7QUFDQTtBQUNBLFVBQU1DLFlBQVksR0FBR3hCLGlCQUFpQixDQUFDVyxvQkFBbEIsQ0FBdUMsS0FBS2MsS0FBTCxDQUFXYixNQUFsRCxDQUFyQjs7QUFDQSxVQUFNQyxNQUFNLEdBQUdDLGlDQUFnQkMsR0FBaEIsRUFBZjs7QUFDQSxVQUFNVixJQUFJLEdBQUdRLE1BQU0sQ0FBQ0ksT0FBUCxDQUFlLEtBQUtRLEtBQUwsQ0FBV2IsTUFBMUIsQ0FBYjtBQUVBLFFBQUlOLE9BQUo7O0FBQ0EsUUFBSWtCLFlBQVksQ0FBQ0UsTUFBYixHQUFzQixDQUExQixFQUE2QjtBQUN6QnBCLE1BQUFBLE9BQU8sZ0JBQUcsdURBQ04sd0NBQUsseUJBQ0QsZ0VBQ0Esb0JBRkMsRUFFcUIsRUFGckIsRUFHRDtBQUNJO0FBQ0E7QUFDQXFCLFFBQUFBLENBQUMsRUFBRUMsR0FBRyxpQkFBSTtBQUFHLFVBQUEsSUFBSSxFQUFFN0IsWUFBVDtBQUF1QixVQUFBLE1BQU0sRUFBQyxRQUE5QjtBQUF1QyxVQUFBLEdBQUcsRUFBQztBQUEzQyxXQUFtRTZCLEdBQW5FO0FBSGQsT0FIQyxDQUFMLENBRE0sZUFVTjtBQUFJLFFBQUEsU0FBUyxFQUFDO0FBQWQsU0FDTUosWUFBWSxDQUFDTCxHQUFiLENBQWtCZixLQUFELElBQVcsS0FBS0QsZ0JBQUwsQ0FBc0JDLEtBQXRCLEVBQTZCQyxJQUE3QixDQUE1QixDQUROLENBVk0sQ0FBVjtBQWNILEtBZkQsTUFlTztBQUNIQyxNQUFBQSxPQUFPLGdCQUFHLHdDQUFLLHlCQUNYLHlEQUNBLG9CQUZXLEVBRVcsRUFGWCxFQUdYO0FBQ0k7QUFDQTtBQUNBcUIsUUFBQUEsQ0FBQyxFQUFFQyxHQUFHLGlCQUFJO0FBQUcsVUFBQSxJQUFJLEVBQUU3QixZQUFUO0FBQXVCLFVBQUEsTUFBTSxFQUFDLFFBQTlCO0FBQXVDLFVBQUEsR0FBRyxFQUFDO0FBQTNDLFdBQW1FNkIsR0FBbkU7QUFIZCxPQUhXLENBQUwsQ0FBVjtBQVNIOztBQUVELHdCQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FBMEMseUJBQUcsU0FBSCxDQUExQyxDQURKLGVBRUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQ010QixPQUROLENBRkosQ0FESjtBQVFIOztBQTNEa0UsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOSwgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IFJvb20gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb21cIjtcbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudFwiO1xuXG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9NYXRyaXhDbGllbnRQZWdcIjtcbmltcG9ydCBCcmlkZ2VUaWxlIGZyb20gXCIuLi8uLi9CcmlkZ2VUaWxlXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuXG5jb25zdCBCUklER0VfRVZFTlRfVFlQRVMgPSBbXG4gICAgXCJ1ay5oYWxmLXNob3QuYnJpZGdlXCIsXG4gICAgLy8gbS5icmlkZ2Vcbl07XG5cbmNvbnN0IEJSSURHRVNfTElOSyA9IFwiaHR0cHM6Ly9tYXRyaXgub3JnL2JyaWRnZXMvXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHJvb21JZDogc3RyaW5nO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5zZXR0aW5ncy50YWJzLnJvb20uQnJpZGdlU2V0dGluZ3NUYWJcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJyaWRnZVNldHRpbmdzVGFiIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcz4ge1xuICAgIHByaXZhdGUgcmVuZGVyQnJpZGdlQ2FyZChldmVudDogTWF0cml4RXZlbnQsIHJvb206IFJvb20pIHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGV2ZW50LmdldENvbnRlbnQoKTtcbiAgICAgICAgaWYgKCFjb250ZW50IHx8ICFjb250ZW50LmNoYW5uZWwgfHwgIWNvbnRlbnQucHJvdG9jb2wpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8QnJpZGdlVGlsZSBrZXk9e2V2ZW50LmdldElkKCl9IHJvb209e3Jvb219IGV2PXtldmVudH0gLz47XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEJyaWRnZVN0YXRlRXZlbnRzKHJvb21JZDogc3RyaW5nKTogTWF0cml4RXZlbnRbXSB7XG4gICAgICAgIGNvbnN0IGNsaWVudCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgY29uc3Qgcm9vbVN0YXRlID0gY2xpZW50LmdldFJvb20ocm9vbUlkKS5jdXJyZW50U3RhdGU7XG5cbiAgICAgICAgcmV0dXJuIEJSSURHRV9FVkVOVF9UWVBFUy5tYXAodHlwZU5hbWUgPT4gcm9vbVN0YXRlLmdldFN0YXRlRXZlbnRzKHR5cGVOYW1lKSkuZmxhdCgxKTtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIC8vIFRoaXMgc2V0dGluZ3MgdGFiIHdpbGwgb25seSBiZSBpbnZva2VkIGlmIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gcmV0dXJucyBtb3JlXG4gICAgICAgIC8vIHRoYW4gMCBldmVudHMsIHNvIG5vIHZhbGlkYXRpb24gaXMgbmVlZGVkIGF0IHRoaXMgc3RhZ2UuXG4gICAgICAgIGNvbnN0IGJyaWRnZUV2ZW50cyA9IEJyaWRnZVNldHRpbmdzVGFiLmdldEJyaWRnZVN0YXRlRXZlbnRzKHRoaXMucHJvcHMucm9vbUlkKTtcbiAgICAgICAgY29uc3QgY2xpZW50ID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCByb29tID0gY2xpZW50LmdldFJvb20odGhpcy5wcm9wcy5yb29tSWQpO1xuXG4gICAgICAgIGxldCBjb250ZW50OiBKU1guRWxlbWVudDtcbiAgICAgICAgaWYgKGJyaWRnZUV2ZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb250ZW50ID0gPGRpdj5cbiAgICAgICAgICAgICAgICA8cD57IF90KFxuICAgICAgICAgICAgICAgICAgICBcIlRoaXMgcm9vbSBpcyBicmlkZ2luZyBtZXNzYWdlcyB0byB0aGUgZm9sbG93aW5nIHBsYXRmb3Jtcy4gXCIgK1xuICAgICAgICAgICAgICAgICAgICBcIjxhPkxlYXJuIG1vcmUuPC9hPlwiLCB7fSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogV2UgZG9uJ3QgaGF2ZSB0aGlzIGxpbmsgeWV0OiB0aGlzIHdpbGwgcHJldmVudCB0aGUgdHJhbnNsYXRvcnNcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhdmluZyB0byByZS10cmFuc2xhdGUgdGhlIHN0cmluZyB3aGVuIHdlIGRvLlxuICAgICAgICAgICAgICAgICAgICAgICAgYTogc3ViID0+IDxhIGhyZWY9e0JSSURHRVNfTElOS30gdGFyZ2V0PVwiX2JsYW5rXCIgcmVsPVwibm9yZWZlcnJlciBub29wZW5lclwiPnsgc3ViIH08L2E+LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICkgfTwvcD5cbiAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPVwibXhfUm9vbVNldHRpbmdzRGlhbG9nX0JyaWRnZUxpc3RcIj5cbiAgICAgICAgICAgICAgICAgICAgeyBicmlkZ2VFdmVudHMubWFwKChldmVudCkgPT4gdGhpcy5yZW5kZXJCcmlkZ2VDYXJkKGV2ZW50LCByb29tKSkgfVxuICAgICAgICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250ZW50ID0gPHA+eyBfdChcbiAgICAgICAgICAgICAgICBcIlRoaXMgcm9vbSBpc24ndCBicmlkZ2luZyBtZXNzYWdlcyB0byBhbnkgcGxhdGZvcm1zLiBcIiArXG4gICAgICAgICAgICAgICAgXCI8YT5MZWFybiBtb3JlLjwvYT5cIiwge30sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBXZSBkb24ndCBoYXZlIHRoaXMgbGluayB5ZXQ6IHRoaXMgd2lsbCBwcmV2ZW50IHRoZSB0cmFuc2xhdG9yc1xuICAgICAgICAgICAgICAgICAgICAvLyBoYXZpbmcgdG8gcmUtdHJhbnNsYXRlIHRoZSBzdHJpbmcgd2hlbiB3ZSBkby5cbiAgICAgICAgICAgICAgICAgICAgYTogc3ViID0+IDxhIGhyZWY9e0JSSURHRVNfTElOS30gdGFyZ2V0PVwiX2JsYW5rXCIgcmVsPVwibm9yZWZlcnJlciBub29wZW5lclwiPnsgc3ViIH08L2E+LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICApIH08L3A+O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX2hlYWRpbmdcIj57IF90KFwiQnJpZGdlc1wiKSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3NlY3Rpb24gbXhfU2V0dGluZ3NUYWJfc3Vic2VjdGlvblRleHQnPlxuICAgICAgICAgICAgICAgICAgICB7IGNvbnRlbnQgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19