"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _languageHandler = require("../../../languageHandler");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _WellKnownUtils = require("../../../utils/WellKnownUtils");

var _Spinner = _interopRequireDefault(require("../elements/Spinner"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _QuestionDialog = _interopRequireDefault(require("../dialogs/QuestionDialog"));

var _RestoreKeyBackupDialog = _interopRequireDefault(require("../dialogs/security/RestoreKeyBackupDialog"));

var _SecurityManager = require("../../../SecurityManager");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let SecureBackupPanel = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.SecureBackupPanel"), _dec(_class = class SecureBackupPanel extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "unmounted", false);
    (0, _defineProperty2.default)(this, "onKeyBackupSessionsRemaining", sessionsRemaining => {
      this.setState({
        sessionsRemaining
      });
    });
    (0, _defineProperty2.default)(this, "onKeyBackupStatus", () => {
      // This just loads the current backup status rather than forcing
      // a re-check otherwise we risk causing infinite loops
      this.loadBackupStatus();
    });
    (0, _defineProperty2.default)(this, "startNewBackup", () => {
      _Modal.default.createTrackedDialogAsync('Key Backup', 'Key Backup', Promise.resolve().then(() => _interopRequireWildcard(require('../../../async-components/views/dialogs/security/CreateKeyBackupDialog'))), {
        onFinished: () => {
          this.loadBackupStatus();
        }
      }, null,
      /* priority = */
      false,
      /* static = */
      true);
    });
    (0, _defineProperty2.default)(this, "deleteBackup", () => {
      _Modal.default.createTrackedDialog('Delete Backup', '', _QuestionDialog.default, {
        title: (0, _languageHandler._t)('Delete Backup'),
        description: (0, _languageHandler._t)("Are you sure? You will lose your encrypted messages if your " + "keys are not backed up properly."),
        button: (0, _languageHandler._t)('Delete Backup'),
        danger: true,
        onFinished: proceed => {
          if (!proceed) return;
          this.setState({
            loading: true
          });

          _MatrixClientPeg.MatrixClientPeg.get().deleteKeyBackupVersion(this.state.backupInfo.version).then(() => {
            this.loadBackupStatus();
          });
        }
      });
    });
    (0, _defineProperty2.default)(this, "restoreBackup", async () => {
      _Modal.default.createTrackedDialog('Restore Backup', '', _RestoreKeyBackupDialog.default, null, null,
      /* priority = */
      false,
      /* static = */
      true);
    });
    (0, _defineProperty2.default)(this, "resetSecretStorage", async () => {
      this.setState({
        error: null
      });

      try {
        await (0, _SecurityManager.accessSecretStorage)(async () => {},
        /* forceReset = */
        true);
      } catch (e) {
        _logger.logger.error("Error resetting secret storage", e);

        if (this.unmounted) return;
        this.setState({
          error: e
        });
      }

      if (this.unmounted) return;
      this.loadBackupStatus();
    });
    this.state = {
      loading: true,
      error: null,
      backupKeyStored: null,
      backupKeyCached: null,
      backupKeyWellFormed: null,
      secretStorageKeyInAccount: null,
      secretStorageReady: null,
      backupInfo: null,
      backupSigStatus: null,
      sessionsRemaining: 0
    };
  }

  componentDidMount() {
    this.checkKeyBackupStatus();

    _MatrixClientPeg.MatrixClientPeg.get().on('crypto.keyBackupStatus', this.onKeyBackupStatus);

    _MatrixClientPeg.MatrixClientPeg.get().on('crypto.keyBackupSessionsRemaining', this.onKeyBackupSessionsRemaining);
  }

  componentWillUnmount() {
    this.unmounted = true;

    if (_MatrixClientPeg.MatrixClientPeg.get()) {
      _MatrixClientPeg.MatrixClientPeg.get().removeListener('crypto.keyBackupStatus', this.onKeyBackupStatus);

      _MatrixClientPeg.MatrixClientPeg.get().removeListener('crypto.keyBackupSessionsRemaining', this.onKeyBackupSessionsRemaining);
    }
  }

  async checkKeyBackupStatus() {
    this.getUpdatedDiagnostics();

    try {
      const {
        backupInfo,
        trustInfo
      } = await _MatrixClientPeg.MatrixClientPeg.get().checkKeyBackup();
      this.setState({
        loading: false,
        error: null,
        backupInfo,
        backupSigStatus: trustInfo
      });
    } catch (e) {
      _logger.logger.log("Unable to fetch check backup status", e);

      if (this.unmounted) return;
      this.setState({
        loading: false,
        error: e,
        backupInfo: null,
        backupSigStatus: null
      });
    }
  }

  async loadBackupStatus() {
    this.setState({
      loading: true
    });
    this.getUpdatedDiagnostics();

    try {
      const backupInfo = await _MatrixClientPeg.MatrixClientPeg.get().getKeyBackupVersion();
      const backupSigStatus = await _MatrixClientPeg.MatrixClientPeg.get().isKeyBackupTrusted(backupInfo);
      if (this.unmounted) return;
      this.setState({
        loading: false,
        error: null,
        backupInfo,
        backupSigStatus
      });
    } catch (e) {
      _logger.logger.log("Unable to fetch key backup status", e);

      if (this.unmounted) return;
      this.setState({
        loading: false,
        error: e,
        backupInfo: null,
        backupSigStatus: null
      });
    }
  }

  async getUpdatedDiagnostics() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const secretStorage = cli.crypto.secretStorage;
    const backupKeyStored = !!(await cli.isKeyBackupKeyStored());
    const backupKeyFromCache = await cli.crypto.getSessionBackupPrivateKey();
    const backupKeyCached = !!backupKeyFromCache;
    const backupKeyWellFormed = backupKeyFromCache instanceof Uint8Array;
    const secretStorageKeyInAccount = await secretStorage.hasKey();
    const secretStorageReady = await cli.isSecretStorageReady();
    if (this.unmounted) return;
    this.setState({
      backupKeyStored,
      backupKeyCached,
      backupKeyWellFormed,
      secretStorageKeyInAccount,
      secretStorageReady
    });
  }

  render() {
    const {
      loading,
      error,
      backupKeyStored,
      backupKeyCached,
      backupKeyWellFormed,
      secretStorageKeyInAccount,
      secretStorageReady,
      backupInfo,
      backupSigStatus,
      sessionsRemaining
    } = this.state;
    let statusDescription;
    let extraDetailsTableRows;
    let extraDetails;
    const actions = [];

    if (error) {
      statusDescription = /*#__PURE__*/_react.default.createElement("div", {
        className: "error"
      }, (0, _languageHandler._t)("Unable to load key backup status"));
    } else if (loading) {
      statusDescription = /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
    } else if (backupInfo) {
      let restoreButtonCaption = (0, _languageHandler._t)("Restore from Backup");

      if (_MatrixClientPeg.MatrixClientPeg.get().getKeyBackupEnabled()) {
        statusDescription = /*#__PURE__*/_react.default.createElement("p", null, "\u2705 ", (0, _languageHandler._t)("This session is backing up your keys. "));
      } else {
        statusDescription = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This session is <b>not backing up your keys</b>, " + "but you do have an existing backup you can restore from " + "and add to going forward.", {}, {
          b: sub => /*#__PURE__*/_react.default.createElement("b", null, sub)
        })), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Connect this session to key backup before signing out to avoid " + "losing any keys that may only be on this session.")));
        restoreButtonCaption = (0, _languageHandler._t)("Connect this session to Key Backup");
      }

      let uploadStatus;

      if (!_MatrixClientPeg.MatrixClientPeg.get().getKeyBackupEnabled()) {
        // No upload status to show when backup disabled.
        uploadStatus = "";
      } else if (sessionsRemaining > 0) {
        uploadStatus = /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Backing up %(sessionsRemaining)s keys...", {
          sessionsRemaining
        }), " ", /*#__PURE__*/_react.default.createElement("br", null));
      } else {
        uploadStatus = /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("All keys backed up"), " ", /*#__PURE__*/_react.default.createElement("br", null));
      }

      let backupSigStatuses = backupSigStatus.sigs.map((sig, i) => {
        const deviceName = sig.device ? sig.device.getDisplayName() || sig.device.deviceId : null;

        const validity = sub => /*#__PURE__*/_react.default.createElement("span", {
          className: sig.valid ? 'mx_SecureBackupPanel_sigValid' : 'mx_SecureBackupPanel_sigInvalid'
        }, sub);

        const verify = sub => /*#__PURE__*/_react.default.createElement("span", {
          className: sig.device && sig.deviceTrust.isVerified() ? 'mx_SecureBackupPanel_deviceVerified' : 'mx_SecureBackupPanel_deviceNotVerified'
        }, sub);

        const device = sub => /*#__PURE__*/_react.default.createElement("span", {
          className: "mx_SecureBackupPanel_deviceName"
        }, deviceName);

        const fromThisDevice = sig.device && sig.device.getFingerprint() === _MatrixClientPeg.MatrixClientPeg.get().getDeviceEd25519Key();

        const fromThisUser = sig.crossSigningId && sig.deviceId === _MatrixClientPeg.MatrixClientPeg.get().getCrossSigningId();

        let sigStatus;

        if (sig.valid && fromThisUser) {
          sigStatus = (0, _languageHandler._t)("Backup has a <validity>valid</validity> signature from this user", {}, {
            validity
          });
        } else if (!sig.valid && fromThisUser) {
          sigStatus = (0, _languageHandler._t)("Backup has a <validity>invalid</validity> signature from this user", {}, {
            validity
          });
        } else if (sig.crossSigningId) {
          sigStatus = (0, _languageHandler._t)("Backup has a signature from <verify>unknown</verify> user with ID %(deviceId)s", {
            deviceId: sig.deviceId
          }, {
            verify
          });
        } else if (!sig.device) {
          sigStatus = (0, _languageHandler._t)("Backup has a signature from <verify>unknown</verify> session with ID %(deviceId)s", {
            deviceId: sig.deviceId
          }, {
            verify
          });
        } else if (sig.valid && fromThisDevice) {
          sigStatus = (0, _languageHandler._t)("Backup has a <validity>valid</validity> signature from this session", {}, {
            validity
          });
        } else if (!sig.valid && fromThisDevice) {
          // it can happen...
          sigStatus = (0, _languageHandler._t)("Backup has an <validity>invalid</validity> signature from this session", {}, {
            validity
          });
        } else if (sig.valid && sig.deviceTrust.isVerified()) {
          sigStatus = (0, _languageHandler._t)("Backup has a <validity>valid</validity> signature from " + "<verify>verified</verify> session <device></device>", {}, {
            validity,
            verify,
            device
          });
        } else if (sig.valid && !sig.deviceTrust.isVerified()) {
          sigStatus = (0, _languageHandler._t)("Backup has a <validity>valid</validity> signature from " + "<verify>unverified</verify> session <device></device>", {}, {
            validity,
            verify,
            device
          });
        } else if (!sig.valid && sig.deviceTrust.isVerified()) {
          sigStatus = (0, _languageHandler._t)("Backup has an <validity>invalid</validity> signature from " + "<verify>verified</verify> session <device></device>", {}, {
            validity,
            verify,
            device
          });
        } else if (!sig.valid && !sig.deviceTrust.isVerified()) {
          sigStatus = (0, _languageHandler._t)("Backup has an <validity>invalid</validity> signature from " + "<verify>unverified</verify> session <device></device>", {}, {
            validity,
            verify,
            device
          });
        }

        return /*#__PURE__*/_react.default.createElement("div", {
          key: i
        }, sigStatus);
      });

      if (backupSigStatus.sigs.length === 0) {
        backupSigStatuses = (0, _languageHandler._t)("Backup is not signed by any of your sessions");
      }

      let trustedLocally;

      if (backupSigStatus.trusted_locally) {
        trustedLocally = (0, _languageHandler._t)("This backup is trusted because it has been restored on this session");
      }

      extraDetailsTableRows = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("tr", null, /*#__PURE__*/_react.default.createElement("td", null, (0, _languageHandler._t)("Backup version:")), /*#__PURE__*/_react.default.createElement("td", null, backupInfo.version)), /*#__PURE__*/_react.default.createElement("tr", null, /*#__PURE__*/_react.default.createElement("td", null, (0, _languageHandler._t)("Algorithm:")), /*#__PURE__*/_react.default.createElement("td", null, backupInfo.algorithm)));
      extraDetails = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, uploadStatus, /*#__PURE__*/_react.default.createElement("div", null, backupSigStatuses), /*#__PURE__*/_react.default.createElement("div", null, trustedLocally));
      actions.push( /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        key: "restore",
        kind: "primary",
        onClick: this.restoreBackup
      }, restoreButtonCaption));

      if (!(0, _WellKnownUtils.isSecureBackupRequired)()) {
        actions.push( /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
          key: "delete",
          kind: "danger",
          onClick: this.deleteBackup
        }, (0, _languageHandler._t)("Delete Backup")));
      }
    } else {
      statusDescription = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Your keys are <b>not being backed up from this session</b>.", {}, {
        b: sub => /*#__PURE__*/_react.default.createElement("b", null, sub)
      })), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Back up your keys before signing out to avoid losing them.")));
      actions.push( /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        key: "setup",
        kind: "primary",
        onClick: this.startNewBackup
      }, (0, _languageHandler._t)("Set up")));
    }

    if (secretStorageKeyInAccount) {
      actions.push( /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        key: "reset",
        kind: "danger",
        onClick: this.resetSecretStorage
      }, (0, _languageHandler._t)("Reset")));
    }

    let backupKeyWellFormedText = "";

    if (backupKeyCached) {
      backupKeyWellFormedText = ", ";

      if (backupKeyWellFormed) {
        backupKeyWellFormedText += (0, _languageHandler._t)("well formed");
      } else {
        backupKeyWellFormedText += (0, _languageHandler._t)("unexpected type");
      }
    }

    let actionRow;

    if (actions.length) {
      actionRow = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SecureBackupPanel_buttonRow"
      }, actions);
    }

    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Back up your encryption keys with your account data in case you " + "lose access to your sessions. Your keys will be secured with a " + "unique Security Key.")), statusDescription, /*#__PURE__*/_react.default.createElement("details", null, /*#__PURE__*/_react.default.createElement("summary", null, (0, _languageHandler._t)("Advanced")), /*#__PURE__*/_react.default.createElement("table", {
      className: "mx_SecureBackupPanel_statusList"
    }, /*#__PURE__*/_react.default.createElement("tbody", null, /*#__PURE__*/_react.default.createElement("tr", null, /*#__PURE__*/_react.default.createElement("td", null, (0, _languageHandler._t)("Backup key stored:")), /*#__PURE__*/_react.default.createElement("td", null, backupKeyStored === true ? (0, _languageHandler._t)("in secret storage") : (0, _languageHandler._t)("not stored"))), /*#__PURE__*/_react.default.createElement("tr", null, /*#__PURE__*/_react.default.createElement("td", null, (0, _languageHandler._t)("Backup key cached:")), /*#__PURE__*/_react.default.createElement("td", null, backupKeyCached ? (0, _languageHandler._t)("cached locally") : (0, _languageHandler._t)("not found locally"), backupKeyWellFormedText)), /*#__PURE__*/_react.default.createElement("tr", null, /*#__PURE__*/_react.default.createElement("td", null, (0, _languageHandler._t)("Secret storage public key:")), /*#__PURE__*/_react.default.createElement("td", null, secretStorageKeyInAccount ? (0, _languageHandler._t)("in account data") : (0, _languageHandler._t)("not found"))), /*#__PURE__*/_react.default.createElement("tr", null, /*#__PURE__*/_react.default.createElement("td", null, (0, _languageHandler._t)("Secret storage:")), /*#__PURE__*/_react.default.createElement("td", null, secretStorageReady ? (0, _languageHandler._t)("ready") : (0, _languageHandler._t)("not ready"))), extraDetailsTableRows)), extraDetails), actionRow);
  }

}) || _class);
exports.default = SecureBackupPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL1NlY3VyZUJhY2t1cFBhbmVsLnRzeCJdLCJuYW1lcyI6WyJTZWN1cmVCYWNrdXBQYW5lbCIsIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzZXNzaW9uc1JlbWFpbmluZyIsInNldFN0YXRlIiwibG9hZEJhY2t1cFN0YXR1cyIsIk1vZGFsIiwiY3JlYXRlVHJhY2tlZERpYWxvZ0FzeW5jIiwib25GaW5pc2hlZCIsImNyZWF0ZVRyYWNrZWREaWFsb2ciLCJRdWVzdGlvbkRpYWxvZyIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJidXR0b24iLCJkYW5nZXIiLCJwcm9jZWVkIiwibG9hZGluZyIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsImRlbGV0ZUtleUJhY2t1cFZlcnNpb24iLCJzdGF0ZSIsImJhY2t1cEluZm8iLCJ2ZXJzaW9uIiwidGhlbiIsIlJlc3RvcmVLZXlCYWNrdXBEaWFsb2ciLCJlcnJvciIsImUiLCJsb2dnZXIiLCJ1bm1vdW50ZWQiLCJiYWNrdXBLZXlTdG9yZWQiLCJiYWNrdXBLZXlDYWNoZWQiLCJiYWNrdXBLZXlXZWxsRm9ybWVkIiwic2VjcmV0U3RvcmFnZUtleUluQWNjb3VudCIsInNlY3JldFN0b3JhZ2VSZWFkeSIsImJhY2t1cFNpZ1N0YXR1cyIsImNvbXBvbmVudERpZE1vdW50IiwiY2hlY2tLZXlCYWNrdXBTdGF0dXMiLCJvbiIsIm9uS2V5QmFja3VwU3RhdHVzIiwib25LZXlCYWNrdXBTZXNzaW9uc1JlbWFpbmluZyIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlTGlzdGVuZXIiLCJnZXRVcGRhdGVkRGlhZ25vc3RpY3MiLCJ0cnVzdEluZm8iLCJjaGVja0tleUJhY2t1cCIsImxvZyIsImdldEtleUJhY2t1cFZlcnNpb24iLCJpc0tleUJhY2t1cFRydXN0ZWQiLCJjbGkiLCJzZWNyZXRTdG9yYWdlIiwiY3J5cHRvIiwiaXNLZXlCYWNrdXBLZXlTdG9yZWQiLCJiYWNrdXBLZXlGcm9tQ2FjaGUiLCJnZXRTZXNzaW9uQmFja3VwUHJpdmF0ZUtleSIsIlVpbnQ4QXJyYXkiLCJoYXNLZXkiLCJpc1NlY3JldFN0b3JhZ2VSZWFkeSIsInJlbmRlciIsInN0YXR1c0Rlc2NyaXB0aW9uIiwiZXh0cmFEZXRhaWxzVGFibGVSb3dzIiwiZXh0cmFEZXRhaWxzIiwiYWN0aW9ucyIsInJlc3RvcmVCdXR0b25DYXB0aW9uIiwiZ2V0S2V5QmFja3VwRW5hYmxlZCIsImIiLCJzdWIiLCJ1cGxvYWRTdGF0dXMiLCJiYWNrdXBTaWdTdGF0dXNlcyIsInNpZ3MiLCJtYXAiLCJzaWciLCJpIiwiZGV2aWNlTmFtZSIsImRldmljZSIsImdldERpc3BsYXlOYW1lIiwiZGV2aWNlSWQiLCJ2YWxpZGl0eSIsInZhbGlkIiwidmVyaWZ5IiwiZGV2aWNlVHJ1c3QiLCJpc1ZlcmlmaWVkIiwiZnJvbVRoaXNEZXZpY2UiLCJnZXRGaW5nZXJwcmludCIsImdldERldmljZUVkMjU1MTlLZXkiLCJmcm9tVGhpc1VzZXIiLCJjcm9zc1NpZ25pbmdJZCIsImdldENyb3NzU2lnbmluZ0lkIiwic2lnU3RhdHVzIiwibGVuZ3RoIiwidHJ1c3RlZExvY2FsbHkiLCJ0cnVzdGVkX2xvY2FsbHkiLCJhbGdvcml0aG0iLCJwdXNoIiwicmVzdG9yZUJhY2t1cCIsImRlbGV0ZUJhY2t1cCIsInN0YXJ0TmV3QmFja3VwIiwicmVzZXRTZWNyZXRTdG9yYWdlIiwiYmFja3VwS2V5V2VsbEZvcm1lZFRleHQiLCJhY3Rpb25Sb3ciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQWlCQTs7Ozs7Ozs7SUFHcUJBLGlCLFdBRHBCLGdEQUFxQixrQ0FBckIsQyxnQkFBRCxNQUNxQkEsaUJBRHJCLFNBQytDQyxlQUFNQyxhQURyRCxDQUMrRTtBQUczRUMsRUFB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Q0FESixlQUVJLHlDQUFNakUseUJBQXlCLEdBQUcseUJBQUcsaUJBQUgsQ0FBSCxHQUEyQix5QkFBRyxXQUFILENBQTFELENBRkosQ0FkK0MsZUFrQi9DLHNEQUNJLHlDQUFNLHlCQUFHLGlCQUFILENBQU4sQ0FESixlQUVJLHlDQUFNQyxrQkFBa0IsR0FBRyx5QkFBRyxPQUFILENBQUgsR0FBaUIseUJBQUcsV0FBSCxDQUF6QyxDQUZKLENBbEIrQyxFQXNCN0MwQixxQkF0QjZDLENBQW5ELENBRkosRUEwQk1DLFlBMUJOLENBUEosRUFtQ01zQyxTQW5DTixDQURKO0FBdUNIOztBQWxiMEUsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOCBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTksIDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50VHlwZSB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSAnLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnJztcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBNb2RhbCBmcm9tICcuLi8uLi8uLi9Nb2RhbCc7XG5pbXBvcnQgeyBpc1NlY3VyZUJhY2t1cFJlcXVpcmVkIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvV2VsbEtub3duVXRpbHMnO1xuaW1wb3J0IFNwaW5uZXIgZnJvbSAnLi4vZWxlbWVudHMvU3Bpbm5lcic7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tICcuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uJztcbmltcG9ydCBRdWVzdGlvbkRpYWxvZyBmcm9tICcuLi9kaWFsb2dzL1F1ZXN0aW9uRGlhbG9nJztcbmltcG9ydCBSZXN0b3JlS2V5QmFja3VwRGlhbG9nIGZyb20gJy4uL2RpYWxvZ3Mvc2VjdXJpdHkvUmVzdG9yZUtleUJhY2t1cERpYWxvZyc7XG5pbXBvcnQgeyBhY2Nlc3NTZWNyZXRTdG9yYWdlIH0gZnJvbSAnLi4vLi4vLi4vU2VjdXJpdHlNYW5hZ2VyJztcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBJS2V5QmFja3VwSW5mbyB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9jcnlwdG8va2V5YmFja3VwXCI7XG5pbXBvcnQgeyBUcnVzdEluZm8gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvY3J5cHRvL2JhY2t1cFwiO1xuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBsb2FkaW5nOiBib29sZWFuO1xuICAgIGVycm9yOiBudWxsO1xuICAgIGJhY2t1cEtleVN0b3JlZDogYm9vbGVhbjtcbiAgICBiYWNrdXBLZXlDYWNoZWQ6IGJvb2xlYW47XG4gICAgYmFja3VwS2V5V2VsbEZvcm1lZDogYm9vbGVhbjtcbiAgICBzZWNyZXRTdG9yYWdlS2V5SW5BY2NvdW50OiBib29sZWFuO1xuICAgIHNlY3JldFN0b3JhZ2VSZWFkeTogYm9vbGVhbjtcbiAgICBiYWNrdXBJbmZvOiBJS2V5QmFja3VwSW5mbztcbiAgICBiYWNrdXBTaWdTdGF0dXM6IFRydXN0SW5mbztcbiAgICBzZXNzaW9uc1JlbWFpbmluZzogbnVtYmVyO1xufVxuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLnNldHRpbmdzLlNlY3VyZUJhY2t1cFBhbmVsXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN1cmVCYWNrdXBQYW5lbCBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8e30sIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgdW5tb3VudGVkID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczoge30pIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBsb2FkaW5nOiB0cnVlLFxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICBiYWNrdXBLZXlTdG9yZWQ6IG51bGwsXG4gICAgICAgICAgICBiYWNrdXBLZXlDYWNoZWQ6IG51bGwsXG4gICAgICAgICAgICBiYWNrdXBLZXlXZWxsRm9ybWVkOiBudWxsLFxuICAgICAgICAgICAgc2VjcmV0U3RvcmFnZUtleUluQWNjb3VudDogbnVsbCxcbiAgICAgICAgICAgIHNlY3JldFN0b3JhZ2VSZWFkeTogbnVsbCxcbiAgICAgICAgICAgIGJhY2t1cEluZm86IG51bGwsXG4gICAgICAgICAgICBiYWNrdXBTaWdTdGF0dXM6IG51bGwsXG4gICAgICAgICAgICBzZXNzaW9uc1JlbWFpbmluZzogMCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkTW91bnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2hlY2tLZXlCYWNrdXBTdGF0dXMoKTtcblxuICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkub24oJ2NyeXB0by5rZXlCYWNrdXBTdGF0dXMnLCB0aGlzLm9uS2V5QmFja3VwU3RhdHVzKTtcbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLm9uKFxuICAgICAgICAgICAgJ2NyeXB0by5rZXlCYWNrdXBTZXNzaW9uc1JlbWFpbmluZycsXG4gICAgICAgICAgICB0aGlzLm9uS2V5QmFja3VwU2Vzc2lvbnNSZW1haW5pbmcsXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnVubW91bnRlZCA9IHRydWU7XG5cbiAgICAgICAgaWYgKE1hdHJpeENsaWVudFBlZy5nZXQoKSkge1xuICAgICAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLnJlbW92ZUxpc3RlbmVyKCdjcnlwdG8ua2V5QmFja3VwU3RhdHVzJywgdGhpcy5vbktleUJhY2t1cFN0YXR1cyk7XG4gICAgICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkucmVtb3ZlTGlzdGVuZXIoXG4gICAgICAgICAgICAgICAgJ2NyeXB0by5rZXlCYWNrdXBTZXNzaW9uc1JlbWFpbmluZycsXG4gICAgICAgICAgICAgICAgdGhpcy5vbktleUJhY2t1cFNlc3Npb25zUmVtYWluaW5nLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgb25LZXlCYWNrdXBTZXNzaW9uc1JlbWFpbmluZyA9IChzZXNzaW9uc1JlbWFpbmluZzogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2Vzc2lvbnNSZW1haW5pbmcsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uS2V5QmFja3VwU3RhdHVzID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICAvLyBUaGlzIGp1c3QgbG9hZHMgdGhlIGN1cnJlbnQgYmFja3VwIHN0YXR1cyByYXRoZXIgdGhhbiBmb3JjaW5nXG4gICAgICAgIC8vIGEgcmUtY2hlY2sgb3RoZXJ3aXNlIHdlIHJpc2sgY2F1c2luZyBpbmZpbml0ZSBsb29wc1xuICAgICAgICB0aGlzLmxvYWRCYWNrdXBTdGF0dXMoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBhc3luYyBjaGVja0tleUJhY2t1cFN0YXR1cygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5nZXRVcGRhdGVkRGlhZ25vc3RpY3MoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHsgYmFja3VwSW5mbywgdHJ1c3RJbmZvIH0gPSBhd2FpdCBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuY2hlY2tLZXlCYWNrdXAoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgICAgICAgIGJhY2t1cEluZm8sXG4gICAgICAgICAgICAgICAgYmFja3VwU2lnU3RhdHVzOiB0cnVzdEluZm8sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIlVuYWJsZSB0byBmZXRjaCBjaGVjayBiYWNrdXAgc3RhdHVzXCIsIGUpO1xuICAgICAgICAgICAgaWYgKHRoaXMudW5tb3VudGVkKSByZXR1cm47XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZSxcbiAgICAgICAgICAgICAgICBiYWNrdXBJbmZvOiBudWxsLFxuICAgICAgICAgICAgICAgIGJhY2t1cFNpZ1N0YXR1czogbnVsbCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBsb2FkQmFja3VwU3RhdHVzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbG9hZGluZzogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5nZXRVcGRhdGVkRGlhZ25vc3RpY3MoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGJhY2t1cEluZm8gPSBhd2FpdCBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0S2V5QmFja3VwVmVyc2lvbigpO1xuICAgICAgICAgICAgY29uc3QgYmFja3VwU2lnU3RhdHVzID0gYXdhaXQgTWF0cml4Q2xpZW50UGVnLmdldCgpLmlzS2V5QmFja3VwVHJ1c3RlZChiYWNrdXBJbmZvKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnVubW91bnRlZCkgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICAgICAgYmFja3VwSW5mbyxcbiAgICAgICAgICAgICAgICBiYWNrdXBTaWdTdGF0dXMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIlVuYWJsZSB0byBmZXRjaCBrZXkgYmFja3VwIHN0YXR1c1wiLCBlKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnVubW91bnRlZCkgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3I6IGUsXG4gICAgICAgICAgICAgICAgYmFja3VwSW5mbzogbnVsbCxcbiAgICAgICAgICAgICAgICBiYWNrdXBTaWdTdGF0dXM6IG51bGwsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgZ2V0VXBkYXRlZERpYWdub3N0aWNzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBjbGkgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGNvbnN0IHNlY3JldFN0b3JhZ2UgPSBjbGkuY3J5cHRvLnNlY3JldFN0b3JhZ2U7XG5cbiAgICAgICAgY29uc3QgYmFja3VwS2V5U3RvcmVkID0gISEoYXdhaXQgY2xpLmlzS2V5QmFja3VwS2V5U3RvcmVkKCkpO1xuICAgICAgICBjb25zdCBiYWNrdXBLZXlGcm9tQ2FjaGUgPSBhd2FpdCBjbGkuY3J5cHRvLmdldFNlc3Npb25CYWNrdXBQcml2YXRlS2V5KCk7XG4gICAgICAgIGNvbnN0IGJhY2t1cEtleUNhY2hlZCA9ICEhKGJhY2t1cEtleUZyb21DYWNoZSk7XG4gICAgICAgIGNvbnN0IGJhY2t1cEtleVdlbGxGb3JtZWQgPSBiYWNrdXBLZXlGcm9tQ2FjaGUgaW5zdGFuY2VvZiBVaW50OEFycmF5O1xuICAgICAgICBjb25zdCBzZWNyZXRTdG9yYWdlS2V5SW5BY2NvdW50ID0gYXdhaXQgc2VjcmV0U3RvcmFnZS5oYXNLZXkoKTtcbiAgICAgICAgY29uc3Qgc2VjcmV0U3RvcmFnZVJlYWR5ID0gYXdhaXQgY2xpLmlzU2VjcmV0U3RvcmFnZVJlYWR5KCk7XG5cbiAgICAgICAgaWYgKHRoaXMudW5tb3VudGVkKSByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgYmFja3VwS2V5U3RvcmVkLFxuICAgICAgICAgICAgYmFja3VwS2V5Q2FjaGVkLFxuICAgICAgICAgICAgYmFja3VwS2V5V2VsbEZvcm1lZCxcbiAgICAgICAgICAgIHNlY3JldFN0b3JhZ2VLZXlJbkFjY291bnQsXG4gICAgICAgICAgICBzZWNyZXRTdG9yYWdlUmVhZHksXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhcnROZXdCYWNrdXAgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2dBc3luYygnS2V5IEJhY2t1cCcsICdLZXkgQmFja3VwJyxcbiAgICAgICAgICAgIGltcG9ydChcbiAgICAgICAgICAgICAgICAnLi4vLi4vLi4vYXN5bmMtY29tcG9uZW50cy92aWV3cy9kaWFsb2dzL3NlY3VyaXR5L0NyZWF0ZUtleUJhY2t1cERpYWxvZydcbiAgICAgICAgICAgICkgYXMgdW5rbm93biBhcyBQcm9taXNlPENvbXBvbmVudFR5cGU8e30+PixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEJhY2t1cFN0YXR1cygpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LCBudWxsLCAvKiBwcmlvcml0eSA9ICovIGZhbHNlLCAvKiBzdGF0aWMgPSAqLyB0cnVlLFxuICAgICAgICApO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGRlbGV0ZUJhY2t1cCA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRGVsZXRlIEJhY2t1cCcsICcnLCBRdWVzdGlvbkRpYWxvZywge1xuICAgICAgICAgICAgdGl0bGU6IF90KCdEZWxldGUgQmFja3VwJyksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXG4gICAgICAgICAgICAgICAgXCJBcmUgeW91IHN1cmU/IFlvdSB3aWxsIGxvc2UgeW91ciBlbmNyeXB0ZWQgbWVzc2FnZXMgaWYgeW91ciBcIiArXG4gICAgICAgICAgICAgICAgXCJrZXlzIGFyZSBub3QgYmFja2VkIHVwIHByb3Blcmx5LlwiLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGJ1dHRvbjogX3QoJ0RlbGV0ZSBCYWNrdXAnKSxcbiAgICAgICAgICAgIGRhbmdlcjogdHJ1ZSxcbiAgICAgICAgICAgIG9uRmluaXNoZWQ6IChwcm9jZWVkKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFwcm9jZWVkKSByZXR1cm47XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLmRlbGV0ZUtleUJhY2t1cFZlcnNpb24odGhpcy5zdGF0ZS5iYWNrdXBJbmZvLnZlcnNpb24pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRCYWNrdXBTdGF0dXMoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHJlc3RvcmVCYWNrdXAgPSBhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coXG4gICAgICAgICAgICAnUmVzdG9yZSBCYWNrdXAnLCAnJywgUmVzdG9yZUtleUJhY2t1cERpYWxvZywgbnVsbCwgbnVsbCxcbiAgICAgICAgICAgIC8qIHByaW9yaXR5ID0gKi8gZmFsc2UsIC8qIHN0YXRpYyA9ICovIHRydWUsXG4gICAgICAgICk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVzZXRTZWNyZXRTdG9yYWdlID0gYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3I6IG51bGwgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBhY2Nlc3NTZWNyZXRTdG9yYWdlKGFzeW5jICgpID0+IHsgfSwgLyogZm9yY2VSZXNldCA9ICovIHRydWUpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJFcnJvciByZXNldHRpbmcgc2VjcmV0IHN0b3JhZ2VcIiwgZSk7XG4gICAgICAgICAgICBpZiAodGhpcy51bm1vdW50ZWQpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvcjogZSB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy51bm1vdW50ZWQpIHJldHVybjtcbiAgICAgICAgdGhpcy5sb2FkQmFja3VwU3RhdHVzKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBsb2FkaW5nLFxuICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICBiYWNrdXBLZXlTdG9yZWQsXG4gICAgICAgICAgICBiYWNrdXBLZXlDYWNoZWQsXG4gICAgICAgICAgICBiYWNrdXBLZXlXZWxsRm9ybWVkLFxuICAgICAgICAgICAgc2VjcmV0U3RvcmFnZUtleUluQWNjb3VudCxcbiAgICAgICAgICAgIHNlY3JldFN0b3JhZ2VSZWFkeSxcbiAgICAgICAgICAgIGJhY2t1cEluZm8sXG4gICAgICAgICAgICBiYWNrdXBTaWdTdGF0dXMsXG4gICAgICAgICAgICBzZXNzaW9uc1JlbWFpbmluZyxcbiAgICAgICAgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAgICAgbGV0IHN0YXR1c0Rlc2NyaXB0aW9uO1xuICAgICAgICBsZXQgZXh0cmFEZXRhaWxzVGFibGVSb3dzO1xuICAgICAgICBsZXQgZXh0cmFEZXRhaWxzO1xuICAgICAgICBjb25zdCBhY3Rpb25zID0gW107XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgc3RhdHVzRGVzY3JpcHRpb24gPSAoXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJlcnJvclwiPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiVW5hYmxlIHRvIGxvYWQga2V5IGJhY2t1cCBzdGF0dXNcIikgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChsb2FkaW5nKSB7XG4gICAgICAgICAgICBzdGF0dXNEZXNjcmlwdGlvbiA9IDxTcGlubmVyIC8+O1xuICAgICAgICB9IGVsc2UgaWYgKGJhY2t1cEluZm8pIHtcbiAgICAgICAgICAgIGxldCByZXN0b3JlQnV0dG9uQ2FwdGlvbiA9IF90KFwiUmVzdG9yZSBmcm9tIEJhY2t1cFwiKTtcblxuICAgICAgICAgICAgaWYgKE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRLZXlCYWNrdXBFbmFibGVkKCkpIHtcbiAgICAgICAgICAgICAgICBzdGF0dXNEZXNjcmlwdGlvbiA9IDxwPuKchSB7IF90KFwiVGhpcyBzZXNzaW9uIGlzIGJhY2tpbmcgdXAgeW91ciBrZXlzLiBcIikgfTwvcD47XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN0YXR1c0Rlc2NyaXB0aW9uID0gPD5cbiAgICAgICAgICAgICAgICAgICAgPHA+eyBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiVGhpcyBzZXNzaW9uIGlzIDxiPm5vdCBiYWNraW5nIHVwIHlvdXIga2V5czwvYj4sIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYnV0IHlvdSBkbyBoYXZlIGFuIGV4aXN0aW5nIGJhY2t1cCB5b3UgY2FuIHJlc3RvcmUgZnJvbSBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFuZCBhZGQgdG8gZ29pbmcgZm9yd2FyZC5cIiwge30sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGI6IHN1YiA9PiA8Yj57IHN1YiB9PC9iPiB9LFxuICAgICAgICAgICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkNvbm5lY3QgdGhpcyBzZXNzaW9uIHRvIGtleSBiYWNrdXAgYmVmb3JlIHNpZ25pbmcgb3V0IHRvIGF2b2lkIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibG9zaW5nIGFueSBrZXlzIHRoYXQgbWF5IG9ubHkgYmUgb24gdGhpcyBzZXNzaW9uLlwiLFxuICAgICAgICAgICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICAgICAgPC8+O1xuICAgICAgICAgICAgICAgIHJlc3RvcmVCdXR0b25DYXB0aW9uID0gX3QoXCJDb25uZWN0IHRoaXMgc2Vzc2lvbiB0byBLZXkgQmFja3VwXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgdXBsb2FkU3RhdHVzO1xuICAgICAgICAgICAgaWYgKCFNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0S2V5QmFja3VwRW5hYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgLy8gTm8gdXBsb2FkIHN0YXR1cyB0byBzaG93IHdoZW4gYmFja3VwIGRpc2FibGVkLlxuICAgICAgICAgICAgICAgIHVwbG9hZFN0YXR1cyA9IFwiXCI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25zUmVtYWluaW5nID4gMCkge1xuICAgICAgICAgICAgICAgIHVwbG9hZFN0YXR1cyA9IDxkaXY+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJCYWNraW5nIHVwICUoc2Vzc2lvbnNSZW1haW5pbmcpcyBrZXlzLi4uXCIsIHsgc2Vzc2lvbnNSZW1haW5pbmcgfSkgfSA8YnIgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHVwbG9hZFN0YXR1cyA9IDxkaXY+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJBbGwga2V5cyBiYWNrZWQgdXBcIikgfSA8YnIgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBiYWNrdXBTaWdTdGF0dXNlczogUmVhY3QuUmVhY3ROb2RlID0gYmFja3VwU2lnU3RhdHVzLnNpZ3MubWFwKChzaWcsIGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBkZXZpY2VOYW1lID0gc2lnLmRldmljZSA/IChzaWcuZGV2aWNlLmdldERpc3BsYXlOYW1lKCkgfHwgc2lnLmRldmljZS5kZXZpY2VJZCkgOiBudWxsO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkaXR5ID0gc3ViID0+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17c2lnLnZhbGlkID8gJ214X1NlY3VyZUJhY2t1cFBhbmVsX3NpZ1ZhbGlkJyA6ICdteF9TZWN1cmVCYWNrdXBQYW5lbF9zaWdJbnZhbGlkJ30+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHN1YiB9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj47XG4gICAgICAgICAgICAgICAgY29uc3QgdmVyaWZ5ID0gc3ViID0+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17c2lnLmRldmljZSAmJiBzaWcuZGV2aWNlVHJ1c3QuaXNWZXJpZmllZCgpID8gJ214X1NlY3VyZUJhY2t1cFBhbmVsX2RldmljZVZlcmlmaWVkJyA6ICdteF9TZWN1cmVCYWNrdXBQYW5lbF9kZXZpY2VOb3RWZXJpZmllZCd9PlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBzdWIgfVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+O1xuICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZSA9IHN1YiA9PiA8c3BhbiBjbGFzc05hbWU9XCJteF9TZWN1cmVCYWNrdXBQYW5lbF9kZXZpY2VOYW1lXCI+eyBkZXZpY2VOYW1lIH08L3NwYW4+O1xuICAgICAgICAgICAgICAgIGNvbnN0IGZyb21UaGlzRGV2aWNlID0gKFxuICAgICAgICAgICAgICAgICAgICBzaWcuZGV2aWNlICYmXG4gICAgICAgICAgICAgICAgICAgIHNpZy5kZXZpY2UuZ2V0RmluZ2VycHJpbnQoKSA9PT0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldERldmljZUVkMjU1MTlLZXkoKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY29uc3QgZnJvbVRoaXNVc2VyID0gKFxuICAgICAgICAgICAgICAgICAgICBzaWcuY3Jvc3NTaWduaW5nSWQgJiZcbiAgICAgICAgICAgICAgICAgICAgc2lnLmRldmljZUlkID09PSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0Q3Jvc3NTaWduaW5nSWQoKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgbGV0IHNpZ1N0YXR1cztcbiAgICAgICAgICAgICAgICBpZiAoc2lnLnZhbGlkICYmIGZyb21UaGlzVXNlcikge1xuICAgICAgICAgICAgICAgICAgICBzaWdTdGF0dXMgPSBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQmFja3VwIGhhcyBhIDx2YWxpZGl0eT52YWxpZDwvdmFsaWRpdHk+IHNpZ25hdHVyZSBmcm9tIHRoaXMgdXNlclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAge30sIHsgdmFsaWRpdHkgfSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFzaWcudmFsaWQgJiYgZnJvbVRoaXNVc2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ1N0YXR1cyA9IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJCYWNrdXAgaGFzIGEgPHZhbGlkaXR5PmludmFsaWQ8L3ZhbGlkaXR5PiBzaWduYXR1cmUgZnJvbSB0aGlzIHVzZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHt9LCB7IHZhbGlkaXR5IH0sXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzaWcuY3Jvc3NTaWduaW5nSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2lnU3RhdHVzID0gX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkJhY2t1cCBoYXMgYSBzaWduYXR1cmUgZnJvbSA8dmVyaWZ5PnVua25vd248L3ZlcmlmeT4gdXNlciB3aXRoIElEICUoZGV2aWNlSWQpc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBkZXZpY2VJZDogc2lnLmRldmljZUlkIH0sIHsgdmVyaWZ5IH0sXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghc2lnLmRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICBzaWdTdGF0dXMgPSBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQmFja3VwIGhhcyBhIHNpZ25hdHVyZSBmcm9tIDx2ZXJpZnk+dW5rbm93bjwvdmVyaWZ5PiBzZXNzaW9uIHdpdGggSUQgJShkZXZpY2VJZClzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGRldmljZUlkOiBzaWcuZGV2aWNlSWQgfSwgeyB2ZXJpZnkgfSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNpZy52YWxpZCAmJiBmcm9tVGhpc0RldmljZSkge1xuICAgICAgICAgICAgICAgICAgICBzaWdTdGF0dXMgPSBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQmFja3VwIGhhcyBhIDx2YWxpZGl0eT52YWxpZDwvdmFsaWRpdHk+IHNpZ25hdHVyZSBmcm9tIHRoaXMgc2Vzc2lvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAge30sIHsgdmFsaWRpdHkgfSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFzaWcudmFsaWQgJiYgZnJvbVRoaXNEZXZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaXQgY2FuIGhhcHBlbi4uLlxuICAgICAgICAgICAgICAgICAgICBzaWdTdGF0dXMgPSBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQmFja3VwIGhhcyBhbiA8dmFsaWRpdHk+aW52YWxpZDwvdmFsaWRpdHk+IHNpZ25hdHVyZSBmcm9tIHRoaXMgc2Vzc2lvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAge30sIHsgdmFsaWRpdHkgfSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNpZy52YWxpZCAmJiBzaWcuZGV2aWNlVHJ1c3QuaXNWZXJpZmllZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ1N0YXR1cyA9IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJCYWNrdXAgaGFzIGEgPHZhbGlkaXR5PnZhbGlkPC92YWxpZGl0eT4gc2lnbmF0dXJlIGZyb20gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCI8dmVyaWZ5PnZlcmlmaWVkPC92ZXJpZnk+IHNlc3Npb24gPGRldmljZT48L2RldmljZT5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHt9LCB7IHZhbGlkaXR5LCB2ZXJpZnksIGRldmljZSB9LFxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2lnLnZhbGlkICYmICFzaWcuZGV2aWNlVHJ1c3QuaXNWZXJpZmllZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ1N0YXR1cyA9IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJCYWNrdXAgaGFzIGEgPHZhbGlkaXR5PnZhbGlkPC92YWxpZGl0eT4gc2lnbmF0dXJlIGZyb20gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCI8dmVyaWZ5PnVudmVyaWZpZWQ8L3ZlcmlmeT4gc2Vzc2lvbiA8ZGV2aWNlPjwvZGV2aWNlPlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAge30sIHsgdmFsaWRpdHksIHZlcmlmeSwgZGV2aWNlIH0sXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghc2lnLnZhbGlkICYmIHNpZy5kZXZpY2VUcnVzdC5pc1ZlcmlmaWVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2lnU3RhdHVzID0gX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkJhY2t1cCBoYXMgYW4gPHZhbGlkaXR5PmludmFsaWQ8L3ZhbGlkaXR5PiBzaWduYXR1cmUgZnJvbSBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIjx2ZXJpZnk+dmVyaWZpZWQ8L3ZlcmlmeT4gc2Vzc2lvbiA8ZGV2aWNlPjwvZGV2aWNlPlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAge30sIHsgdmFsaWRpdHksIHZlcmlmeSwgZGV2aWNlIH0sXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghc2lnLnZhbGlkICYmICFzaWcuZGV2aWNlVHJ1c3QuaXNWZXJpZmllZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ1N0YXR1cyA9IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJCYWNrdXAgaGFzIGFuIDx2YWxpZGl0eT5pbnZhbGlkPC92YWxpZGl0eT4gc2lnbmF0dXJlIGZyb20gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCI8dmVyaWZ5PnVudmVyaWZpZWQ8L3ZlcmlmeT4gc2Vzc2lvbiA8ZGV2aWNlPjwvZGV2aWNlPlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAge30sIHsgdmFsaWRpdHksIHZlcmlmeSwgZGV2aWNlIH0sXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIDxkaXYga2V5PXtpfT5cbiAgICAgICAgICAgICAgICAgICAgeyBzaWdTdGF0dXMgfVxuICAgICAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGJhY2t1cFNpZ1N0YXR1cy5zaWdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGJhY2t1cFNpZ1N0YXR1c2VzID0gX3QoXCJCYWNrdXAgaXMgbm90IHNpZ25lZCBieSBhbnkgb2YgeW91ciBzZXNzaW9uc1wiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHRydXN0ZWRMb2NhbGx5O1xuICAgICAgICAgICAgaWYgKGJhY2t1cFNpZ1N0YXR1cy50cnVzdGVkX2xvY2FsbHkpIHtcbiAgICAgICAgICAgICAgICB0cnVzdGVkTG9jYWxseSA9IF90KFwiVGhpcyBiYWNrdXAgaXMgdHJ1c3RlZCBiZWNhdXNlIGl0IGhhcyBiZWVuIHJlc3RvcmVkIG9uIHRoaXMgc2Vzc2lvblwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZXh0cmFEZXRhaWxzVGFibGVSb3dzID0gPD5cbiAgICAgICAgICAgICAgICA8dHI+XG4gICAgICAgICAgICAgICAgICAgIDx0ZD57IF90KFwiQmFja3VwIHZlcnNpb246XCIpIH08L3RkPlxuICAgICAgICAgICAgICAgICAgICA8dGQ+eyBiYWNrdXBJbmZvLnZlcnNpb24gfTwvdGQ+XG4gICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgICA8dHI+XG4gICAgICAgICAgICAgICAgICAgIDx0ZD57IF90KFwiQWxnb3JpdGhtOlwiKSB9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgPHRkPnsgYmFja3VwSW5mby5hbGdvcml0aG0gfTwvdGQ+XG4gICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgIDwvPjtcblxuICAgICAgICAgICAgZXh0cmFEZXRhaWxzID0gPD5cbiAgICAgICAgICAgICAgICB7IHVwbG9hZFN0YXR1cyB9XG4gICAgICAgICAgICAgICAgPGRpdj57IGJhY2t1cFNpZ1N0YXR1c2VzIH08L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2PnsgdHJ1c3RlZExvY2FsbHkgfTwvZGl2PlxuICAgICAgICAgICAgPC8+O1xuXG4gICAgICAgICAgICBhY3Rpb25zLnB1c2goXG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24ga2V5PVwicmVzdG9yZVwiIGtpbmQ9XCJwcmltYXJ5XCIgb25DbGljaz17dGhpcy5yZXN0b3JlQmFja3VwfT5cbiAgICAgICAgICAgICAgICAgICAgeyByZXN0b3JlQnV0dG9uQ2FwdGlvbiB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPixcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmICghaXNTZWN1cmVCYWNrdXBSZXF1aXJlZCgpKSB7XG4gICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBrZXk9XCJkZWxldGVcIiBraW5kPVwiZGFuZ2VyXCIgb25DbGljaz17dGhpcy5kZWxldGVCYWNrdXB9PlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkRlbGV0ZSBCYWNrdXBcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+LFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGF0dXNEZXNjcmlwdGlvbiA9IDw+XG4gICAgICAgICAgICAgICAgPHA+eyBfdChcbiAgICAgICAgICAgICAgICAgICAgXCJZb3VyIGtleXMgYXJlIDxiPm5vdCBiZWluZyBiYWNrZWQgdXAgZnJvbSB0aGlzIHNlc3Npb248L2I+LlwiLCB7fSxcbiAgICAgICAgICAgICAgICAgICAgeyBiOiBzdWIgPT4gPGI+eyBzdWIgfTwvYj4gfSxcbiAgICAgICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICAgICAgPHA+eyBfdChcIkJhY2sgdXAgeW91ciBrZXlzIGJlZm9yZSBzaWduaW5nIG91dCB0byBhdm9pZCBsb3NpbmcgdGhlbS5cIikgfTwvcD5cbiAgICAgICAgICAgIDwvPjtcbiAgICAgICAgICAgIGFjdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBrZXk9XCJzZXR1cFwiIGtpbmQ9XCJwcmltYXJ5XCIgb25DbGljaz17dGhpcy5zdGFydE5ld0JhY2t1cH0+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJTZXQgdXBcIikgfVxuICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj4sXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNlY3JldFN0b3JhZ2VLZXlJbkFjY291bnQpIHtcbiAgICAgICAgICAgIGFjdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBrZXk9XCJyZXNldFwiIGtpbmQ9XCJkYW5nZXJcIiBvbkNsaWNrPXt0aGlzLnJlc2V0U2VjcmV0U3RvcmFnZX0+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJSZXNldFwiKSB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPixcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYmFja3VwS2V5V2VsbEZvcm1lZFRleHQgPSBcIlwiO1xuICAgICAgICBpZiAoYmFja3VwS2V5Q2FjaGVkKSB7XG4gICAgICAgICAgICBiYWNrdXBLZXlXZWxsRm9ybWVkVGV4dCA9IFwiLCBcIjtcbiAgICAgICAgICAgIGlmIChiYWNrdXBLZXlXZWxsRm9ybWVkKSB7XG4gICAgICAgICAgICAgICAgYmFja3VwS2V5V2VsbEZvcm1lZFRleHQgKz0gX3QoXCJ3ZWxsIGZvcm1lZFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYmFja3VwS2V5V2VsbEZvcm1lZFRleHQgKz0gX3QoXCJ1bmV4cGVjdGVkIHR5cGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYWN0aW9uUm93O1xuICAgICAgICBpZiAoYWN0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGFjdGlvblJvdyA9IDxkaXYgY2xhc3NOYW1lPVwibXhfU2VjdXJlQmFja3VwUGFuZWxfYnV0dG9uUm93XCI+XG4gICAgICAgICAgICAgICAgeyBhY3Rpb25zIH1cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiQmFjayB1cCB5b3VyIGVuY3J5cHRpb24ga2V5cyB3aXRoIHlvdXIgYWNjb3VudCBkYXRhIGluIGNhc2UgeW91IFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJsb3NlIGFjY2VzcyB0byB5b3VyIHNlc3Npb25zLiBZb3VyIGtleXMgd2lsbCBiZSBzZWN1cmVkIHdpdGggYSBcIiArXG4gICAgICAgICAgICAgICAgICAgIFwidW5pcXVlIFNlY3VyaXR5IEtleS5cIixcbiAgICAgICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICAgICAgeyBzdGF0dXNEZXNjcmlwdGlvbiB9XG4gICAgICAgICAgICAgICAgPGRldGFpbHM+XG4gICAgICAgICAgICAgICAgICAgIDxzdW1tYXJ5PnsgX3QoXCJBZHZhbmNlZFwiKSB9PC9zdW1tYXJ5PlxuICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPVwibXhfU2VjdXJlQmFja3VwUGFuZWxfc3RhdHVzTGlzdFwiPjx0Ym9keT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+eyBfdChcIkJhY2t1cCBrZXkgc3RvcmVkOlwiKSB9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrdXBLZXlTdG9yZWQgPT09IHRydWUgPyBfdChcImluIHNlY3JldCBzdG9yYWdlXCIpIDogX3QoXCJub3Qgc3RvcmVkXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IF90KFwiQmFja3VwIGtleSBjYWNoZWQ6XCIpIH08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBiYWNrdXBLZXlDYWNoZWQgPyBfdChcImNhY2hlZCBsb2NhbGx5XCIpIDogX3QoXCJub3QgZm91bmQgbG9jYWxseVwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgYmFja3VwS2V5V2VsbEZvcm1lZFRleHQgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IF90KFwiU2VjcmV0IHN0b3JhZ2UgcHVibGljIGtleTpcIikgfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPnsgc2VjcmV0U3RvcmFnZUtleUluQWNjb3VudCA/IF90KFwiaW4gYWNjb3VudCBkYXRhXCIpIDogX3QoXCJub3QgZm91bmRcIikgfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IF90KFwiU2VjcmV0IHN0b3JhZ2U6XCIpIH08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IHNlY3JldFN0b3JhZ2VSZWFkeSA/IF90KFwicmVhZHlcIikgOiBfdChcIm5vdCByZWFkeVwiKSB9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IGV4dHJhRGV0YWlsc1RhYmxlUm93cyB9XG4gICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+PC90YWJsZT5cbiAgICAgICAgICAgICAgICAgICAgeyBleHRyYURldGFpbHMgfVxuICAgICAgICAgICAgICAgIDwvZGV0YWlscz5cbiAgICAgICAgICAgICAgICB7IGFjdGlvblJvdyB9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=