"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../../../languageHandler");

var _SdkConfig = _interopRequireDefault(require("../../../../../SdkConfig"));

var _MatrixClientPeg = require("../../../../../MatrixClientPeg");

var _SettingsStore = _interopRequireDefault(require("../../../../../settings/SettingsStore"));

var _StyledCheckbox = _interopRequireDefault(require("../../../elements/StyledCheckbox"));

var _SettingsFlag = _interopRequireDefault(require("../../../elements/SettingsFlag"));

var _Field = _interopRequireDefault(require("../../../elements/Field"));

var _SettingLevel = require("../../../../../settings/SettingLevel");

var _UIFeature = require("../../../../../settings/UIFeature");

var _Layout = require("../../../../../settings/enums/Layout");

var _replaceableComponent = require("../../../../../utils/replaceableComponent");

var _LayoutSwitcher = _interopRequireDefault(require("../../LayoutSwitcher"));

var _FontScalingPanel = _interopRequireDefault(require("../../FontScalingPanel"));

var _ThemeChoicePanel = _interopRequireDefault(require("../../ThemeChoicePanel"));

var _ImageSizePanel = _interopRequireDefault(require("../../ImageSizePanel"));

var _dec, _class;

let AppearanceUserSettingsTab = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.tabs.user.AppearanceUserSettingsTab"), _dec(_class = class AppearanceUserSettingsTab extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "MESSAGE_PREVIEW_TEXT", (0, _languageHandler._t)("Hey you. You're the best!"));
    (0, _defineProperty2.default)(this, "unmounted", false);
    (0, _defineProperty2.default)(this, "onLayoutChanged", layout => {
      this.setState({
        layout: layout
      });
    });
    (0, _defineProperty2.default)(this, "onIRCLayoutChange", enabled => {
      if (enabled) {
        this.setState({
          layout: _Layout.Layout.IRC
        });

        _SettingsStore.default.setValue("layout", null, _SettingLevel.SettingLevel.DEVICE, _Layout.Layout.IRC);
      } else {
        this.setState({
          layout: _Layout.Layout.Group
        });

        _SettingsStore.default.setValue("layout", null, _SettingLevel.SettingLevel.DEVICE, _Layout.Layout.Group);
      }
    });
    this.state = {
      useSystemFont: _SettingsStore.default.getValue("useSystemFont"),
      systemFont: _SettingsStore.default.getValue("systemFont"),
      showAdvanced: false,
      layout: _SettingsStore.default.getValue("layout"),
      userId: null,
      displayName: null,
      avatarUrl: null
    };
  }

  async componentDidMount() {
    // Fetch the current user profile for the message preview
    const client = _MatrixClientPeg.MatrixClientPeg.get();

    const userId = client.getUserId();
    const profileInfo = await client.getProfileInfo(userId);
    if (this.unmounted) return;
    this.setState({
      userId,
      displayName: profileInfo.displayname,
      avatarUrl: profileInfo.avatar_url
    });
  }

  componentWillUnmount() {
    this.unmounted = true;
  }

  renderAdvancedSection() {
    if (!_SettingsStore.default.getValue(_UIFeature.UIFeature.AdvancedSettings)) return null;

    const brand = _SdkConfig.default.get().brand;

    const toggle = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AppearanceUserSettingsTab_AdvancedToggle",
      onClick: () => this.setState({
        showAdvanced: !this.state.showAdvanced
      })
    }, this.state.showAdvanced ? (0, _languageHandler._t)("Hide advanced") : (0, _languageHandler._t)("Show advanced"));

    let advanced;

    if (this.state.showAdvanced) {
      const tooltipContent = (0, _languageHandler._t)("Set the name of a font installed on your system & %(brand)s will attempt to use it.", {
        brand
      });
      advanced = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_SettingsFlag.default, {
        name: "useCompactLayout",
        level: _SettingLevel.SettingLevel.DEVICE,
        useCheckbox: true,
        disabled: this.state.layout !== _Layout.Layout.Group
      }), !_SettingsStore.default.getValue("feature_new_layout_switcher") ? /*#__PURE__*/_react.default.createElement(_StyledCheckbox.default, {
        checked: this.state.layout == _Layout.Layout.IRC,
        onChange: ev => this.onIRCLayoutChange(ev.target.checked)
      }, (0, _languageHandler._t)("Enable experimental, compact IRC style layout")) : null, /*#__PURE__*/_react.default.createElement(_SettingsFlag.default, {
        name: "useSystemFont",
        level: _SettingLevel.SettingLevel.DEVICE,
        useCheckbox: true,
        onChange: checked => this.setState({
          useSystemFont: checked
        })
      }), /*#__PURE__*/_react.default.createElement(_Field.default, {
        className: "mx_AppearanceUserSettingsTab_systemFont",
        label: _SettingsStore.default.getDisplayName("systemFont"),
        onChange: value => {
          this.setState({
            systemFont: value.target.value
          });

          _SettingsStore.default.setValue("systemFont", null, _SettingLevel.SettingLevel.DEVICE, value.target.value);
        },
        tooltipContent: tooltipContent,
        forceTooltipVisible: true,
        disabled: !this.state.useSystemFont,
        value: this.state.systemFont
      }));
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_AppearanceUserSettingsTab_Advanced"
    }, toggle, advanced);
  }

  render() {
    const brand = _SdkConfig.default.get().brand;

    let layoutSection;

    if (_SettingsStore.default.getValue("feature_new_layout_switcher")) {
      layoutSection = /*#__PURE__*/_react.default.createElement(_LayoutSwitcher.default, {
        userId: this.state.userId,
        displayName: this.state.displayName,
        avatarUrl: this.state.avatarUrl,
        messagePreviewText: this.MESSAGE_PREVIEW_TEXT,
        onLayoutChanged: this.onLayoutChanged
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab mx_AppearanceUserSettingsTab"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Customise your appearance")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_SubHeading"
    }, (0, _languageHandler._t)("Appearance Settings only affect this %(brand)s session.", {
      brand
    })), /*#__PURE__*/_react.default.createElement(_ThemeChoicePanel.default, null), layoutSection, /*#__PURE__*/_react.default.createElement(_FontScalingPanel.default, null), this.renderAdvancedSection(), /*#__PURE__*/_react.default.createElement(_ImageSizePanel.default, null));
  }

}) || _class);
exports.default = AppearanceUserSettingsTab;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL3RhYnMvdXNlci9BcHBlYXJhbmNlVXNlclNldHRpbmdzVGFiLnRzeCJdLCJuYW1lcyI6WyJBcHBlYXJhbmNlVXNlclNldHRpbmdzVGFiIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwibGF5b3V0Iiwic2V0U3RhdGUiLCJlbmFibGVkIiwiTGF5b3V0IiwiSVJDIiwiU2V0dGluZ3NTdG9yZSIsInNldFZhbHVlIiwiU2V0dGluZ0xldmVsIiwiREVWSUNFIiwiR3JvdXAiLCJzdGF0ZSIsInVzZVN5c3RlbUZvbnQiLCJnZXRWYWx1ZSIsInN5c3RlbUZvbnQiLCJzaG93QWR2YW5jZWQiLCJ1c2VySWQiLCJkaXNwbGF5TmFtZSIsImF2YXRhclVybCIsImNvbXBvbmVudERpZE1vdW50IiwiY2xpZW50IiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0IiwiZ2V0VXNlcklkIiwicHJvZmlsZUluZm8iLCJnZXRQcm9maWxlSW5mbyIsInVubW91bnRlZCIsImRpc3BsYXluYW1lIiwiYXZhdGFyX3VybCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVuZGVyQWR2YW5jZWRTZWN0aW9uIiwiVUlGZWF0dXJlIiwiQWR2YW5jZWRTZXR0aW5ncyIsImJyYW5kIiwiU2RrQ29uZmlnIiwidG9nZ2xlIiwiYWR2YW5jZWQiLCJ0b29sdGlwQ29udGVudCIsImV2Iiwib25JUkNMYXlvdXRDaGFuZ2UiLCJ0YXJnZXQiLCJjaGVja2VkIiwiZ2V0RGlzcGxheU5hbWUiLCJ2YWx1ZSIsInJlbmRlciIsImxheW91dFNlY3Rpb24iLCJNRVNTQUdFX1BSRVZJRVdfVEVYVCIsIm9uTGF5b3V0Q2hhbmdlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FB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LGVBS0ksNkJBQUMseUJBQUQsT0FMSixFQU1NWSxhQU5OLGVBT0ksNkJBQUMseUJBQUQsT0FQSixFQVFNLEtBQUtmLHFCQUFMLEVBUk4sZUFTSSw2QkFBQyx1QkFBRCxPQVRKLENBREo7QUFhSDs7QUFoSmtGLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTkgTmV3IFZlY3RvciBMdGRcbkNvcHlyaWdodCAyMDE5IC0gMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBTZGtDb25maWcgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL1Nka0NvbmZpZ1wiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnJztcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgU3R5bGVkQ2hlY2tib3ggZnJvbSAnLi4vLi4vLi4vZWxlbWVudHMvU3R5bGVkQ2hlY2tib3gnO1xuaW1wb3J0IFNldHRpbmdzRmxhZyBmcm9tICcuLi8uLi8uLi9lbGVtZW50cy9TZXR0aW5nc0ZsYWcnO1xuaW1wb3J0IEZpZWxkIGZyb20gJy4uLy4uLy4uL2VsZW1lbnRzL0ZpZWxkJztcbmltcG9ydCB7IFNldHRpbmdMZXZlbCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nTGV2ZWxcIjtcbmltcG9ydCB7IFVJRmVhdHVyZSB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9VSUZlYXR1cmVcIjtcbmltcG9ydCB7IExheW91dCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9lbnVtcy9MYXlvdXRcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgTGF5b3V0U3dpdGNoZXIgZnJvbSBcIi4uLy4uL0xheW91dFN3aXRjaGVyXCI7XG5cbmltcG9ydCBGb250U2NhbGluZ1BhbmVsIGZyb20gJy4uLy4uL0ZvbnRTY2FsaW5nUGFuZWwnO1xuaW1wb3J0IFRoZW1lQ2hvaWNlUGFuZWwgZnJvbSAnLi4vLi4vVGhlbWVDaG9pY2VQYW5lbCc7XG5pbXBvcnQgSW1hZ2VTaXplUGFuZWwgZnJvbSBcIi4uLy4uL0ltYWdlU2l6ZVBhbmVsXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICB1c2VTeXN0ZW1Gb250OiBib29sZWFuO1xuICAgIHN5c3RlbUZvbnQ6IHN0cmluZztcbiAgICBzaG93QWR2YW5jZWQ6IGJvb2xlYW47XG4gICAgbGF5b3V0OiBMYXlvdXQ7XG4gICAgLy8gVXNlciBwcm9maWxlIGRhdGEgZm9yIHRoZSBtZXNzYWdlIHByZXZpZXdcbiAgICB1c2VySWQ/OiBzdHJpbmc7XG4gICAgZGlzcGxheU5hbWU6IHN0cmluZztcbiAgICBhdmF0YXJVcmw6IHN0cmluZztcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3Muc2V0dGluZ3MudGFicy51c2VyLkFwcGVhcmFuY2VVc2VyU2V0dGluZ3NUYWJcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwcGVhcmFuY2VVc2VyU2V0dGluZ3NUYWIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IE1FU1NBR0VfUFJFVklFV19URVhUID0gX3QoXCJIZXkgeW91LiBZb3UncmUgdGhlIGJlc3QhXCIpO1xuXG4gICAgcHJpdmF0ZSB1bm1vdW50ZWQgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICB1c2VTeXN0ZW1Gb250OiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwidXNlU3lzdGVtRm9udFwiKSxcbiAgICAgICAgICAgIHN5c3RlbUZvbnQ6IFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJzeXN0ZW1Gb250XCIpLFxuICAgICAgICAgICAgc2hvd0FkdmFuY2VkOiBmYWxzZSxcbiAgICAgICAgICAgIGxheW91dDogU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImxheW91dFwiKSxcbiAgICAgICAgICAgIHVzZXJJZDogbnVsbCxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBudWxsLFxuICAgICAgICAgICAgYXZhdGFyVXJsOiBudWxsLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFzeW5jIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICAvLyBGZXRjaCB0aGUgY3VycmVudCB1c2VyIHByb2ZpbGUgZm9yIHRoZSBtZXNzYWdlIHByZXZpZXdcbiAgICAgICAgY29uc3QgY2xpZW50ID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCB1c2VySWQgPSBjbGllbnQuZ2V0VXNlcklkKCk7XG4gICAgICAgIGNvbnN0IHByb2ZpbGVJbmZvID0gYXdhaXQgY2xpZW50LmdldFByb2ZpbGVJbmZvKHVzZXJJZCk7XG4gICAgICAgIGlmICh0aGlzLnVubW91bnRlZCkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6IHByb2ZpbGVJbmZvLmRpc3BsYXluYW1lLFxuICAgICAgICAgICAgYXZhdGFyVXJsOiBwcm9maWxlSW5mby5hdmF0YXJfdXJsLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy51bm1vdW50ZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25MYXlvdXRDaGFuZ2VkID0gKGxheW91dDogTGF5b3V0KTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsYXlvdXQ6IGxheW91dCB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbklSQ0xheW91dENoYW5nZSA9IChlbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGlmIChlbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgbGF5b3V0OiBMYXlvdXQuSVJDIH0pO1xuICAgICAgICAgICAgU2V0dGluZ3NTdG9yZS5zZXRWYWx1ZShcImxheW91dFwiLCBudWxsLCBTZXR0aW5nTGV2ZWwuREVWSUNFLCBMYXlvdXQuSVJDKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsYXlvdXQ6IExheW91dC5Hcm91cCB9KTtcbiAgICAgICAgICAgIFNldHRpbmdzU3RvcmUuc2V0VmFsdWUoXCJsYXlvdXRcIiwgbnVsbCwgU2V0dGluZ0xldmVsLkRFVklDRSwgTGF5b3V0Lkdyb3VwKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIHJlbmRlckFkdmFuY2VkU2VjdGlvbigpIHtcbiAgICAgICAgaWYgKCFTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFVJRmVhdHVyZS5BZHZhbmNlZFNldHRpbmdzKSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgY29uc3QgYnJhbmQgPSBTZGtDb25maWcuZ2V0KCkuYnJhbmQ7XG4gICAgICAgIGNvbnN0IHRvZ2dsZSA9IDxkaXZcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0FwcGVhcmFuY2VVc2VyU2V0dGluZ3NUYWJfQWR2YW5jZWRUb2dnbGVcIlxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy5zZXRTdGF0ZSh7IHNob3dBZHZhbmNlZDogIXRoaXMuc3RhdGUuc2hvd0FkdmFuY2VkIH0pfVxuICAgICAgICA+XG4gICAgICAgICAgICB7IHRoaXMuc3RhdGUuc2hvd0FkdmFuY2VkID8gX3QoXCJIaWRlIGFkdmFuY2VkXCIpIDogX3QoXCJTaG93IGFkdmFuY2VkXCIpIH1cbiAgICAgICAgPC9kaXY+O1xuXG4gICAgICAgIGxldCBhZHZhbmNlZDogUmVhY3QuUmVhY3ROb2RlO1xuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnNob3dBZHZhbmNlZCkge1xuICAgICAgICAgICAgY29uc3QgdG9vbHRpcENvbnRlbnQgPSBfdChcbiAgICAgICAgICAgICAgICBcIlNldCB0aGUgbmFtZSBvZiBhIGZvbnQgaW5zdGFsbGVkIG9uIHlvdXIgc3lzdGVtICYgJShicmFuZClzIHdpbGwgYXR0ZW1wdCB0byB1c2UgaXQuXCIsXG4gICAgICAgICAgICAgICAgeyBicmFuZCB9LFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGFkdmFuY2VkID0gPD5cbiAgICAgICAgICAgICAgICA8U2V0dGluZ3NGbGFnXG4gICAgICAgICAgICAgICAgICAgIG5hbWU9XCJ1c2VDb21wYWN0TGF5b3V0XCJcbiAgICAgICAgICAgICAgICAgICAgbGV2ZWw9e1NldHRpbmdMZXZlbC5ERVZJQ0V9XG4gICAgICAgICAgICAgICAgICAgIHVzZUNoZWNrYm94PXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17dGhpcy5zdGF0ZS5sYXlvdXQgIT09IExheW91dC5Hcm91cH1cbiAgICAgICAgICAgICAgICAvPlxuXG4gICAgICAgICAgICAgICAgeyAhU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImZlYXR1cmVfbmV3X2xheW91dF9zd2l0Y2hlclwiKSA/XG4gICAgICAgICAgICAgICAgICAgIDxTdHlsZWRDaGVja2JveFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17dGhpcy5zdGF0ZS5sYXlvdXQgPT0gTGF5b3V0LklSQ31cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZXYpID0+IHRoaXMub25JUkNMYXlvdXRDaGFuZ2UoZXYudGFyZ2V0LmNoZWNrZWQpfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiRW5hYmxlIGV4cGVyaW1lbnRhbCwgY29tcGFjdCBJUkMgc3R5bGUgbGF5b3V0XCIpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9TdHlsZWRDaGVja2JveD4gOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgPFNldHRpbmdzRmxhZ1xuICAgICAgICAgICAgICAgICAgICBuYW1lPVwidXNlU3lzdGVtRm9udFwiXG4gICAgICAgICAgICAgICAgICAgIGxldmVsPXtTZXR0aW5nTGV2ZWwuREVWSUNFfVxuICAgICAgICAgICAgICAgICAgICB1c2VDaGVja2JveD17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhjaGVja2VkKSA9PiB0aGlzLnNldFN0YXRlKHsgdXNlU3lzdGVtRm9udDogY2hlY2tlZCB9KX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxGaWVsZFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9BcHBlYXJhbmNlVXNlclNldHRpbmdzVGFiX3N5c3RlbUZvbnRcIlxuICAgICAgICAgICAgICAgICAgICBsYWJlbD17U2V0dGluZ3NTdG9yZS5nZXREaXNwbGF5TmFtZShcInN5c3RlbUZvbnRcIil9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5c3RlbUZvbnQ6IHZhbHVlLnRhcmdldC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBTZXR0aW5nc1N0b3JlLnNldFZhbHVlKFwic3lzdGVtRm9udFwiLCBudWxsLCBTZXR0aW5nTGV2ZWwuREVWSUNFLCB2YWx1ZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwQ29udGVudD17dG9vbHRpcENvbnRlbnR9XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVG9vbHRpcFZpc2libGU9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXshdGhpcy5zdGF0ZS51c2VTeXN0ZW1Gb250fVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5zeXN0ZW1Gb250fVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8Lz47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc2VjdGlvbiBteF9BcHBlYXJhbmNlVXNlclNldHRpbmdzVGFiX0FkdmFuY2VkXCI+XG4gICAgICAgICAgICB7IHRvZ2dsZSB9XG4gICAgICAgICAgICB7IGFkdmFuY2VkIH1cbiAgICAgICAgPC9kaXY+O1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgYnJhbmQgPSBTZGtDb25maWcuZ2V0KCkuYnJhbmQ7XG5cbiAgICAgICAgbGV0IGxheW91dFNlY3Rpb247XG4gICAgICAgIGlmIChTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwiZmVhdHVyZV9uZXdfbGF5b3V0X3N3aXRjaGVyXCIpKSB7XG4gICAgICAgICAgICBsYXlvdXRTZWN0aW9uID0gKFxuICAgICAgICAgICAgICAgIDxMYXlvdXRTd2l0Y2hlclxuICAgICAgICAgICAgICAgICAgICB1c2VySWQ9e3RoaXMuc3RhdGUudXNlcklkfVxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZT17dGhpcy5zdGF0ZS5kaXNwbGF5TmFtZX1cbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyVXJsPXt0aGlzLnN0YXRlLmF2YXRhclVybH1cbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVByZXZpZXdUZXh0PXt0aGlzLk1FU1NBR0VfUFJFVklFV19URVhUfVxuICAgICAgICAgICAgICAgICAgICBvbkxheW91dENoYW5nZWQ9e3RoaXMub25MYXlvdXRDaGFuZ2VkfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWIgbXhfQXBwZWFyYW5jZVVzZXJTZXR0aW5nc1RhYlwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJDdXN0b21pc2UgeW91ciBhcHBlYXJhbmNlXCIpIH08L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX1N1YkhlYWRpbmdcIj5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcIkFwcGVhcmFuY2UgU2V0dGluZ3Mgb25seSBhZmZlY3QgdGhpcyAlKGJyYW5kKXMgc2Vzc2lvbi5cIiwgeyBicmFuZCB9KSB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPFRoZW1lQ2hvaWNlUGFuZWwgLz5cbiAgICAgICAgICAgICAgICB7IGxheW91dFNlY3Rpb24gfVxuICAgICAgICAgICAgICAgIDxGb250U2NhbGluZ1BhbmVsIC8+XG4gICAgICAgICAgICAgICAgeyB0aGlzLnJlbmRlckFkdmFuY2VkU2VjdGlvbigpIH1cbiAgICAgICAgICAgICAgICA8SW1hZ2VTaXplUGFuZWwgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==