"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var languageHandler = _interopRequireWildcard(require("../../../../../languageHandler"));

var _ProfileSettings = _interopRequireDefault(require("../../ProfileSettings"));

var _SettingsStore = _interopRequireDefault(require("../../../../../settings/SettingsStore"));

var _LanguageDropdown = _interopRequireDefault(require("../../../elements/LanguageDropdown"));

var _SpellCheckSettings = _interopRequireDefault(require("../../SpellCheckSettings"));

var _AccessibleButton = _interopRequireDefault(require("../../../elements/AccessibleButton"));

var _DeactivateAccountDialog = _interopRequireDefault(require("../../../dialogs/DeactivateAccountDialog"));

var _PlatformPeg = _interopRequireDefault(require("../../../../../PlatformPeg"));

var _MatrixClientPeg = require("../../../../../MatrixClientPeg");

var _Modal = _interopRequireDefault(require("../../../../../Modal"));

var _dispatcher = _interopRequireDefault(require("../../../../../dispatcher/dispatcher"));

var _Terms = require("../../../../../Terms");

var _serviceTypes = require("matrix-js-sdk/src/service-types");

var _IdentityAuthClient = _interopRequireDefault(require("../../../../../IdentityAuthClient"));

var _UrlUtils = require("../../../../../utils/UrlUtils");

var _boundThreepids = require("../../../../../boundThreepids");

var _Spinner = _interopRequireDefault(require("../../../elements/Spinner"));

var _SettingLevel = require("../../../../../settings/SettingLevel");

var _UIFeature = require("../../../../../settings/UIFeature");

var _replaceableComponent = require("../../../../../utils/replaceableComponent");

var _ErrorDialog = _interopRequireDefault(require("../../../dialogs/ErrorDialog"));

var _PhoneNumbers = _interopRequireDefault(require("../../account/PhoneNumbers"));

var _EmailAddresses = _interopRequireDefault(require("../../account/EmailAddresses"));

var _EmailAddresses2 = _interopRequireDefault(require("../../discovery/EmailAddresses"));

var _PhoneNumbers2 = _interopRequireDefault(require("../../discovery/PhoneNumbers"));

var _ChangePassword = _interopRequireDefault(require("../../ChangePassword"));

var _InlineTermsAgreement = _interopRequireDefault(require("../../../terms/InlineTermsAgreement"));

var _SetIdServer = _interopRequireDefault(require("../../SetIdServer"));

var _SetIntegrationManager = _interopRequireDefault(require("../../SetIntegrationManager"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

let GeneralUserSettingsTab = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.tabs.user.GeneralUserSettingsTab"), _dec(_class = class GeneralUserSettingsTab extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "onAction", payload => {
      if (payload.action === 'id_server_changed') {
        this.setState({
          haveIdServer: Boolean(_MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl())
        });
        this.getThreepidState();
      }
    });
    (0, _defineProperty2.default)(this, "onEmailsChange", emails => {
      this.setState({
        emails
      });
    });
    (0, _defineProperty2.default)(this, "onMsisdnsChange", msisdns => {
      this.setState({
        msisdns
      });
    });
    (0, _defineProperty2.default)(this, "onLanguageChange", newLanguage => {
      if (this.state.language === newLanguage) return;

      _SettingsStore.default.setValue("language", null, _SettingLevel.SettingLevel.DEVICE, newLanguage);

      this.setState({
        language: newLanguage
      });

      const platform = _PlatformPeg.default.get();

      if (platform) {
        platform.setLanguage([newLanguage]);
        platform.reload();
      }
    });
    (0, _defineProperty2.default)(this, "onSpellCheckLanguagesChange", languages => {
      this.setState({
        spellCheckLanguages: languages
      });

      const plaf = _PlatformPeg.default.get();

      if (plaf) {
        plaf.setSpellCheckLanguages(languages);
      }
    });
    (0, _defineProperty2.default)(this, "onPasswordChangeError", err => {
      // TODO: Figure out a design that doesn't involve replacing the current dialog
      let errMsg = err.error || err.message || "";

      if (err.httpStatus === 403) {
        errMsg = (0, languageHandler._t)("Failed to change password. Is your password correct?");
      } else if (!errMsg) {
        errMsg += ` (HTTP status ${err.httpStatus})`;
      }

      _logger.logger.error("Failed to change password: " + errMsg);

      _Modal.default.createTrackedDialog('Failed to change password', '', _ErrorDialog.default, {
        title: (0, languageHandler._t)("Error"),
        description: errMsg
      });
    });
    (0, _defineProperty2.default)(this, "onPasswordChanged", () => {
      // TODO: Figure out a design that doesn't involve replacing the current dialog
      _Modal.default.createTrackedDialog('Password changed', '', _ErrorDialog.default, {
        title: (0, languageHandler._t)("Success"),
        description: (0, languageHandler._t)("Your password was successfully changed. You will not receive " + "push notifications on other sessions until you log back in to them") + "."
      });
    });
    (0, _defineProperty2.default)(this, "onDeactivateClicked", () => {
      _Modal.default.createTrackedDialog('Deactivate Account', '', _DeactivateAccountDialog.default, {
        onFinished: success => {
          if (success) this.props.closeSettingsFn();
        }
      });
    });
    this.state = {
      language: languageHandler.getCurrentLanguage(),
      spellCheckLanguages: [],
      haveIdServer: Boolean(_MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl()),
      serverSupportsSeparateAddAndBind: null,
      idServerHasUnsignedTerms: false,
      requiredPolicyInfo: {
        // This object is passed along to a component for handling
        hasTerms: false,
        policiesAndServices: null,
        // From the startTermsFlow callback
        agreedUrls: null,
        // From the startTermsFlow callback
        resolve: null // Promise resolve function for startTermsFlow callback

      },
      emails: [],
      msisdns: [],
      loading3pids: true,
      // whether or not the emails and msisdns have been loaded
      canChangePassword: false,
      idServerName: null
    };
    this.dispatcherRef = _dispatcher.default.register(this.onAction);
  } // TODO: [REACT-WARNING] Move this to constructor
  // eslint-disable-next-line @typescript-eslint/naming-convention, camelcase


  async UNSAFE_componentWillMount() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const serverSupportsSeparateAddAndBind = await cli.doesServerSupportSeparateAddAndBind();
    const capabilities = await cli.getCapabilities(); // this is cached

    const changePasswordCap = capabilities['m.change_password']; // You can change your password so long as the capability isn't explicitly disabled. The implicit
    // behaviour is you can change your password when the capability is missing or has not-false as
    // the enabled flag value.

    const canChangePassword = !changePasswordCap || changePasswordCap['enabled'] !== false;
    this.setState({
      serverSupportsSeparateAddAndBind,
      canChangePassword
    });
    this.getThreepidState();
  }

  async componentDidMount() {
    const plaf = _PlatformPeg.default.get();

    if (plaf) {
      this.setState({
        spellCheckLanguages: await plaf.getSpellCheckLanguages()
      });
    }
  }

  componentWillUnmount() {
    _dispatcher.default.unregister(this.dispatcherRef);
  }

  async getThreepidState() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get(); // Check to see if terms need accepting


    this.checkTerms(); // Need to get 3PIDs generally for Account section and possibly also for
    // Discovery (assuming we have an IS and terms are agreed).

    let threepids = [];

    try {
      threepids = await (0, _boundThreepids.getThreepidsWithBindStatus)(cli);
    } catch (e) {
      const idServerUrl = _MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl();

      _logger.logger.warn(`Unable to reach identity server at ${idServerUrl} to check ` + `for 3PIDs bindings in Settings`);

      _logger.logger.warn(e);
    }

    this.setState({
      emails: threepids.filter(a => a.medium === 'email'),
      msisdns: threepids.filter(a => a.medium === 'msisdn'),
      loading3pids: false
    });
  }

  async checkTerms() {
    if (!this.state.haveIdServer) {
      this.setState({
        idServerHasUnsignedTerms: false
      });
      return;
    } // By starting the terms flow we get the logic for checking which terms the user has signed
    // for free. So we might as well use that for our own purposes.


    const idServerUrl = _MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl();

    const authClient = new _IdentityAuthClient.default();

    try {
      const idAccessToken = await authClient.getAccessToken({
        check: false
      });
      await (0, _Terms.startTermsFlow)([new _Terms.Service(_serviceTypes.SERVICE_TYPES.IS, idServerUrl, idAccessToken)], (policiesAndServices, agreedUrls, extraClassNames) => {
        return new Promise((resolve, reject) => {
          this.setState({
            idServerName: (0, _UrlUtils.abbreviateUrl)(idServerUrl),
            requiredPolicyInfo: {
              hasTerms: true,
              policiesAndServices,
              agreedUrls,
              resolve
            }
          });
        });
      }); // User accepted all terms

      this.setState({
        requiredPolicyInfo: _objectSpread({
          hasTerms: false
        }, this.state.requiredPolicyInfo)
      });
    } catch (e) {
      _logger.logger.warn(`Unable to reach identity server at ${idServerUrl} to check ` + `for terms in Settings`);

      _logger.logger.warn(e);
    }
  }

  renderProfileSection() {
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement(_ProfileSettings.default, null));
  }

  renderAccountSection() {
    let passwordChangeForm = /*#__PURE__*/_react.default.createElement(_ChangePassword.default, {
      className: "mx_GeneralUserSettingsTab_changePassword",
      rowClassName: "",
      buttonKind: "primary",
      onError: this.onPasswordChangeError,
      onFinished: this.onPasswordChanged
    });

    let threepidSection = null; // For older homeservers without separate 3PID add and bind methods (MSC2290),
    // we use a combo add with bind option API which requires an identity server to
    // validate 3PID ownership even if we're just adding to the homeserver only.
    // For newer homeservers with separate 3PID add and bind methods (MSC2290),
    // there is no such concern, so we can always show the HS account 3PIDs.

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.ThirdPartyID) && (this.state.haveIdServer || this.state.serverSupportsSeparateAddAndBind === true)) {
      const emails = this.state.loading3pids ? /*#__PURE__*/_react.default.createElement(_Spinner.default, null) : /*#__PURE__*/_react.default.createElement(_EmailAddresses.default, {
        emails: this.state.emails,
        onEmailsChange: this.onEmailsChange
      });
      const msisdns = this.state.loading3pids ? /*#__PURE__*/_react.default.createElement(_Spinner.default, null) : /*#__PURE__*/_react.default.createElement(_PhoneNumbers.default, {
        msisdns: this.state.msisdns,
        onMsisdnsChange: this.onMsisdnsChange
      });
      threepidSection = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_SettingsTab_subheading"
      }, (0, languageHandler._t)("Email addresses")), emails, /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_SettingsTab_subheading"
      }, (0, languageHandler._t)("Phone numbers")), msisdns);
    } else if (this.state.serverSupportsSeparateAddAndBind === null) {
      threepidSection = /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
    }

    let passwordChangeText = (0, languageHandler._t)("Set a new account password...");

    if (!this.state.canChangePassword) {
      // Just don't show anything if you can't do anything.
      passwordChangeText = null;
      passwordChangeForm = null;
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section mx_GeneralUserSettingsTab_accountSection"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, languageHandler._t)("Account")), /*#__PURE__*/_react.default.createElement("p", {
      className: "mx_SettingsTab_subsectionText"
    }, passwordChangeText), passwordChangeForm, threepidSection);
  }

  renderLanguageSection() {
    // TODO: Convert to new-styled Field
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, languageHandler._t)("Language and region")), /*#__PURE__*/_react.default.createElement(_LanguageDropdown.default, {
      className: "mx_GeneralUserSettingsTab_languageInput",
      onOptionChange: this.onLanguageChange,
      value: this.state.language
    }));
  }

  renderSpellCheckSection() {
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, languageHandler._t)("Spell check dictionaries")), /*#__PURE__*/_react.default.createElement(_SpellCheckSettings.default, {
      languages: this.state.spellCheckLanguages,
      onLanguagesChange: this.onSpellCheckLanguagesChange
    }));
  }

  renderDiscoverySection() {
    if (this.state.requiredPolicyInfo.hasTerms) {
      const intro = /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_SettingsTab_subsectionText"
      }, (0, languageHandler._t)("Agree to the identity server (%(serverName)s) Terms of Service to " + "allow yourself to be discoverable by email address or phone number.", {
        serverName: this.state.idServerName
      }));

      return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_InlineTermsAgreement.default, {
        policiesAndServicePairs: this.state.requiredPolicyInfo.policiesAndServices,
        agreedUrls: this.state.requiredPolicyInfo.agreedUrls,
        onFinished: this.state.requiredPolicyInfo.resolve,
        introElement: intro
      }), /*#__PURE__*/_react.default.createElement(_SetIdServer.default, {
        missingTerms: true
      }));
    }

    const emails = this.state.loading3pids ? /*#__PURE__*/_react.default.createElement(_Spinner.default, null) : /*#__PURE__*/_react.default.createElement(_EmailAddresses2.default, {
      emails: this.state.emails
    });
    const msisdns = this.state.loading3pids ? /*#__PURE__*/_react.default.createElement(_Spinner.default, null) : /*#__PURE__*/_react.default.createElement(_PhoneNumbers2.default, {
      msisdns: this.state.msisdns
    });
    const threepidSection = this.state.haveIdServer ? /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GeneralUserSettingsTab_discovery"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, languageHandler._t)("Email addresses")), emails, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, languageHandler._t)("Phone numbers")), msisdns) : null;
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, threepidSection, /*#__PURE__*/_react.default.createElement(_SetIdServer.default, {
      missingTerms: false
    }));
  }

  renderManagementSection() {
    // TODO: Improve warning text for account deactivation
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, languageHandler._t)("Account management")), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subsectionText"
    }, (0, languageHandler._t)("Deactivating your account is a permanent action - be careful!")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onDeactivateClicked,
      kind: "danger"
    }, (0, languageHandler._t)("Deactivate Account")));
  }

  renderIntegrationManagerSection() {
    if (!_SettingsStore.default.getValue(_UIFeature.UIFeature.Widgets)) return null;
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement(_SetIntegrationManager.default, null));
  }

  render() {
    const plaf = _PlatformPeg.default.get();

    const supportsMultiLanguageSpellCheck = plaf.supportsMultiLanguageSpellCheck();
    const discoWarning = this.state.requiredPolicyInfo.hasTerms ? /*#__PURE__*/_react.default.createElement("img", {
      className: "mx_GeneralUserSettingsTab_warningIcon",
      src: require("../../../../../../res/img/feather-customised/warning-triangle.svg"),
      width: "18",
      height: "18",
      alt: (0, languageHandler._t)("Warning")
    }) : null;
    let accountManagementSection;

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.Deactivate)) {
      accountManagementSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsTab_heading"
      }, (0, languageHandler._t)("Deactivate account")), this.renderManagementSection());
    }

    let discoverySection;

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.IdentityServer)) {
      discoverySection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SettingsTab_heading"
      }, discoWarning, " ", (0, languageHandler._t)("Discovery")), this.renderDiscoverySection());
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, languageHandler._t)("General")), this.renderProfileSection(), this.renderAccountSection(), this.renderLanguageSection(), supportsMultiLanguageSpellCheck ? this.renderSpellCheckSection() : null, discoverySection, this.renderIntegrationManagerSection()
    /* Has its own title */
    , accountManagementSection);
  }

}) || _class);
exports.default = GeneralUserSettingsTab;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL3RhYnMvdXNlci9HZW5lcmFsVXNlclNldHRpbmdzVGFiLnRzeCJdLCJuYW1lcyI6WyJHZW5lcmFsVXNlclNldHRpbmdzVGFiIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwicGF5bG9hZCIsImFjdGlvbiIsInNldFN0YXRlIiwiaGF2ZUlkU2VydmVyIiwiQm9vbGVhbiIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsImdldElkZW50aXR5U2VydmVyVXJsIiwiZ2V0VGhyZWVwaWRTdGF0ZSIsImVtYWlscyIsIm1zaXNkbnMiLCJuZXdMYW5ndWFnZSIsInN0YXRlIiwibGFuZ3VhZ2UiLCJTZXR0aW5nc1N0b3JlIiwic2V0VmFsdWUiLCJTZXR0aW5nTGV2ZWwiLCJERVZJQ0UiLCJwbGF0Zm9ybSIsIlBsYXRmb3JtUGVnIiwic2V0TGFuZ3VhZ2UiLCJyZWxvYWQiLCJsYW5ndWFnZXMiLCJzcGVsbENoZWNrTGFuZ3VhZ2VzIiwicGxhZiIsInNldFNwZWxsQ2hlY2tMYW5ndWFnZXMiLCJlcnIiLCJlcnJNc2ciLCJlcnJvciIsIm1lc3NhZ2UiLCJodHRwU3RhdHVzIiwibG9nZ2VyIiwiTW9kYWwiLCJjcmVhdGVUcmFja2VkRGlhbG9nIiwiRXJyb3JEaWFsb2ciLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiRGVhY3RpdmF0ZUFjY291bnREaWFsb2ciLCJvbkZpbmlzaGVkIiwic3VjY2VzcyIsImNsb3NlU2V0dGluZ3NGbiIsImxhbmd1YWdlSGFuZGxlciIsImdldEN1cnJlbnRMYW5ndWFnZSIsInNlcnZlclN1cHBvcnRzU2VwYXJhdGVBZGRBbmRCaW5kIiwiaWRTZXJ2ZXJIYXNVbnNpZ25lZFRlcm1zIiwicmVxdWlyZWRQb2xpY3lJbmZvIiwiaGFzVGVybXMiLCJwb2xpY2llc0FuZFNlcnZpY2VzIiwiYWdyZWVkVXJscyIsInJlc29sdmUiLCJsb2FkaW5nM3BpZHMiLCJjYW5DaGFuZ2VQYXNzd29yZCIsImlkU2VydmVyTmFtZSIsImRpc3BhdGNoZXJSZWYiLCJkaXMiLCJyZWdpc3RlciIsIm9uQWN0aW9uIiwiVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCIsImNsaSIsImRvZXNTZXJ2ZXJTdXBwb3J0U2VwYXJhdGVBZGRBbmRCaW5kIiwiY2FwYWJpbGl0aWVzIiwiZ2V0Q2FwYWJpbGl0aWVzIiwiY2hhbmdlUGFzc3dvcmRDYXAiLCJjb21wb25lbnREaWRNb3VudCIsImdldFNwZWxsQ2hlY2tMYW5ndWFnZXMiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInVucmVnaXN0ZXIiLCJjaGVja1Rlcm1zIiwidGhyZWVwaWRzIiwiZSIsImlkU2VydmVyVXJsIiwid2FybiIsImZpbHRlciIsImEiLCJtZWRpdW0iLCJhdXRoQ2xpZW50IiwiSWRlbnRpdHlBdXRoQ2xpZW50IiwiaWRBY2Nlc3NUb2tlbiIsImdldEFjY2Vzc1Rva2VuIiwiY2hlY2siLCJTZXJ2aWNlIiwiU0VSVklDRV9UWVBFUyIsIklTIiwiZXh0cmFDbGFzc05hbWVzIiwiUHJvbWlzZSIsInJlamVjdCIsInJlbmRlclByb2ZpbGVTZWN0aW9uIiwicmVuZGVyQWNjb3VudFNlY3Rpb24iLCJwYXNzd29yZENoYW5nZUZvcm0iLCJvblBhc3N3b3JkQ2hhbmdlRXJyb3IiLCJvblBhc3N3b3JkQ2hhbmdlZCIsInRocmVlcGlkU2VjdGlvbiIsImdldFZhbHVlIiwiVUlGZWF0dXJlIiwiVGhpcmRQYXJ0eUlEIiwib25FbWFpbHNDaGFuZ2UiLCJvbk1zaXNkbnNDaGFuZ2UiLCJwYXNzd29yZENoYW5nZVRleHQiLCJyZW5kZXJMYW5ndWFnZVNlY3Rpb24iLCJvbkxhbmd1YWdlQ2hhbmdlIiwicmVuZGVyU3BlbGxDaGVja1NlY3Rpb24iLCJvblNwZWxsQ2hlY2tMYW5ndWFnZXNDaGFuZ2UiLCJyZW5kZXJEaXNjb3ZlcnlTZWN0aW9uIiwiaW50cm8iLCJzZXJ2ZXJOYW1lIiwicmVuZGVyTWFuYWdlbWVudFNlY3Rpb24iLCJvbkRlYWN0aXZhdGVDbGlja2VkIiwicmVuZGVySW50ZWdyYXRpb25NYW5hZ2VyU2VjdGlvbiIsIldpZGdldHMiLCJyZW5kZXIiLCJzdXBwb3J0c011bHRpTGFuZ3VhZ2VTcGVsbENoZWNrIiwiZGlzY29XYXJuaW5nIiwicmVxdWlyZSIsImFjY291bnRNYW5hZ2VtZW50U2VjdGlvbiIsIkRlYWN0aXZhdGUiLCJkaXNjb3ZlcnlTZWN0aW9uIiwiSWRlbnRpdHlTZXJ2ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBa0JBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7Ozs7Ozs7Ozs7SUE2QnFCQSxzQixXQURwQixnREFBcUIsaURBQXJCLEMsZ0JBQUQsTUFDcUJBLHNCQURyQixTQUNvREMsZUFBTUMsU0FEMUQsQ0FDb0Y7QUFHaEZDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFnQjtBQUN2QixVQUFNQSxLQUFOO0FBRHVCO0FBQUEsb0RBMERQQyxPQUFELElBQWtDO0FBQ2pELFVBQUlBLE9BQU8sQ0FBQ0MsTUFBUixLQUFtQixtQkFBdkIsRUFBNEM7QUFDeEMsYUFBS0MsUUFBTCxDQUFjO0FBQUVDLFVBQUFBLFlBQVksRUFBRUMsT0FBTyxDQUFDQyxpQ0FBZ0JDLEdBQWhCLEdBQXNCQyxvQkFBdEIsRUFBRDtBQUF2QixTQUFkO0FBQ0EsYUFBS0MsZ0JBQUw7QUFDSDtBQUNKLEtBL0QwQjtBQUFBLDBEQWlFREMsTUFBRCxJQUErQjtBQUNwRCxXQUFLUCxRQUFMLENBQWM7QUFBRU8sUUFBQUE7QUFBRixPQUFkO0FBQ0gsS0FuRTBCO0FBQUEsMkRBcUVBQyxPQUFELElBQWdDO0FBQ3RELFdBQUtSLFFBQUwsQ0FBYztB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QUFQN0MsTUFRTU0sd0JBUk4sQ0FESjtBQVlIOztBQXpaK0UsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOSBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTkgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cbkNvcHlyaWdodCAyMDE5IE1pY2hhZWwgVGVsYXR5bnNraSA8N3QzY2hndXlAZ21haWwuY29tPlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBQcm9maWxlU2V0dGluZ3MgZnJvbSBcIi4uLy4uL1Byb2ZpbGVTZXR0aW5nc1wiO1xuaW1wb3J0ICogYXMgbGFuZ3VhZ2VIYW5kbGVyIGZyb20gXCIuLi8uLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgTGFuZ3VhZ2VEcm9wZG93biBmcm9tIFwiLi4vLi4vLi4vZWxlbWVudHMvTGFuZ3VhZ2VEcm9wZG93blwiO1xuaW1wb3J0IFNwZWxsQ2hlY2tTZXR0aW5ncyBmcm9tIFwiLi4vLi4vU3BlbGxDaGVja1NldHRpbmdzXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vLi4vLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IERlYWN0aXZhdGVBY2NvdW50RGlhbG9nIGZyb20gXCIuLi8uLi8uLi9kaWFsb2dzL0RlYWN0aXZhdGVBY2NvdW50RGlhbG9nXCI7XG5pbXBvcnQgUGxhdGZvcm1QZWcgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL1BsYXRmb3JtUGVnXCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnXCI7XG5pbXBvcnQgTW9kYWwgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL01vZGFsXCI7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCB7IFBvbGljaWVzLCBTZXJ2aWNlLCBzdGFydFRlcm1zRmxvdyB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9UZXJtc1wiO1xuaW1wb3J0IHsgU0VSVklDRV9UWVBFUyB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9zZXJ2aWNlLXR5cGVzXCI7XG5pbXBvcnQgSWRlbnRpdHlBdXRoQ2xpZW50IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9JZGVudGl0eUF1dGhDbGllbnRcIjtcbmltcG9ydCB7IGFiYnJldmlhdGVVcmwgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vdXRpbHMvVXJsVXRpbHNcIjtcbmltcG9ydCB7IGdldFRocmVlcGlkc1dpdGhCaW5kU3RhdHVzIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vYm91bmRUaHJlZXBpZHMnO1xuaW1wb3J0IFNwaW5uZXIgZnJvbSBcIi4uLy4uLy4uL2VsZW1lbnRzL1NwaW5uZXJcIjtcbmltcG9ydCB7IFNldHRpbmdMZXZlbCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nTGV2ZWxcIjtcbmltcG9ydCB7IFVJRmVhdHVyZSB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9VSUZlYXR1cmVcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBJVGhyZWVwaWQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvQHR5cGVzL3RocmVlcGlkc1wiO1xuaW1wb3J0IHsgQWN0aW9uUGF5bG9hZCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9kaXNwYXRjaGVyL3BheWxvYWRzXCI7XG5pbXBvcnQgRXJyb3JEaWFsb2cgZnJvbSBcIi4uLy4uLy4uL2RpYWxvZ3MvRXJyb3JEaWFsb2dcIjtcbmltcG9ydCBBY2NvdW50UGhvbmVOdW1iZXJzIGZyb20gXCIuLi8uLi9hY2NvdW50L1Bob25lTnVtYmVyc1wiO1xuaW1wb3J0IEFjY291bnRFbWFpbEFkZHJlc3NlcyBmcm9tIFwiLi4vLi4vYWNjb3VudC9FbWFpbEFkZHJlc3Nlc1wiO1xuaW1wb3J0IERpc2NvdmVyeUVtYWlsQWRkcmVzc2VzIGZyb20gXCIuLi8uLi9kaXNjb3ZlcnkvRW1haWxBZGRyZXNzZXNcIjtcbmltcG9ydCBEaXNjb3ZlcnlQaG9uZU51bWJlcnMgZnJvbSBcIi4uLy4uL2Rpc2NvdmVyeS9QaG9uZU51bWJlcnNcIjtcbmltcG9ydCBDaGFuZ2VQYXNzd29yZCBmcm9tIFwiLi4vLi4vQ2hhbmdlUGFzc3dvcmRcIjtcbmltcG9ydCBJbmxpbmVUZXJtc0FncmVlbWVudCBmcm9tIFwiLi4vLi4vLi4vdGVybXMvSW5saW5lVGVybXNBZ3JlZW1lbnRcIjtcbmltcG9ydCBTZXRJZFNlcnZlciBmcm9tIFwiLi4vLi4vU2V0SWRTZXJ2ZXJcIjtcbmltcG9ydCBTZXRJbnRlZ3JhdGlvbk1hbmFnZXIgZnJvbSBcIi4uLy4uL1NldEludGVncmF0aW9uTWFuYWdlclwiO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGNsb3NlU2V0dGluZ3NGbjogKCkgPT4gdm9pZDtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgbGFuZ3VhZ2U6IHN0cmluZztcbiAgICBzcGVsbENoZWNrTGFuZ3VhZ2VzOiBzdHJpbmdbXTtcbiAgICBoYXZlSWRTZXJ2ZXI6IGJvb2xlYW47XG4gICAgc2VydmVyU3VwcG9ydHNTZXBhcmF0ZUFkZEFuZEJpbmQ6IGJvb2xlYW47XG4gICAgaWRTZXJ2ZXJIYXNVbnNpZ25lZFRlcm1zOiBib29sZWFuO1xuICAgIHJlcXVpcmVkUG9saWN5SW5mbzogeyAgICAgICAvLyBUaGlzIG9iamVjdCBpcyBwYXNzZWQgYWxvbmcgdG8gYSBjb21wb25lbnQgZm9yIGhhbmRsaW5nXG4gICAgICAgIGhhc1Rlcm1zOiBib29sZWFuO1xuICAgICAgICBwb2xpY2llc0FuZFNlcnZpY2VzOiB7XG4gICAgICAgICAgICBzZXJ2aWNlOiBTZXJ2aWNlO1xuICAgICAgICAgICAgcG9saWNpZXM6IFBvbGljaWVzO1xuICAgICAgICB9W107IC8vIEZyb20gdGhlIHN0YXJ0VGVybXNGbG93IGNhbGxiYWNrXG4gICAgICAgIGFncmVlZFVybHM6IHN0cmluZ1tdOyAvLyBGcm9tIHRoZSBzdGFydFRlcm1zRmxvdyBjYWxsYmFja1xuICAgICAgICByZXNvbHZlOiAodmFsdWVzOiBzdHJpbmdbXSkgPT4gdm9pZDsgLy8gUHJvbWlzZSByZXNvbHZlIGZ1bmN0aW9uIGZvciBzdGFydFRlcm1zRmxvdyBjYWxsYmFja1xuICAgIH07XG4gICAgZW1haWxzOiBJVGhyZWVwaWRbXTtcbiAgICBtc2lzZG5zOiBJVGhyZWVwaWRbXTtcbiAgICBsb2FkaW5nM3BpZHM6IGJvb2xlYW47IC8vIHdoZXRoZXIgb3Igbm90IHRoZSBlbWFpbHMgYW5kIG1zaXNkbnMgaGF2ZSBiZWVuIGxvYWRlZFxuICAgIGNhbkNoYW5nZVBhc3N3b3JkOiBib29sZWFuO1xuICAgIGlkU2VydmVyTmFtZTogc3RyaW5nO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5zZXR0aW5ncy50YWJzLnVzZXIuR2VuZXJhbFVzZXJTZXR0aW5nc1RhYlwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2VuZXJhbFVzZXJTZXR0aW5nc1RhYiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgZGlzcGF0Y2hlclJlZjogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZUhhbmRsZXIuZ2V0Q3VycmVudExhbmd1YWdlKCksXG4gICAgICAgICAgICBzcGVsbENoZWNrTGFuZ3VhZ2VzOiBbXSxcbiAgICAgICAgICAgIGhhdmVJZFNlcnZlcjogQm9vbGVhbihNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0SWRlbnRpdHlTZXJ2ZXJVcmwoKSksXG4gICAgICAgICAgICBzZXJ2ZXJTdXBwb3J0c1NlcGFyYXRlQWRkQW5kQmluZDogbnVsbCxcbiAgICAgICAgICAgIGlkU2VydmVySGFzVW5zaWduZWRUZXJtczogZmFsc2UsXG4gICAgICAgICAgICByZXF1aXJlZFBvbGljeUluZm86IHsgICAgICAgLy8gVGhpcyBvYmplY3QgaXMgcGFzc2VkIGFsb25nIHRvIGEgY29tcG9uZW50IGZvciBoYW5kbGluZ1xuICAgICAgICAgICAgICAgIGhhc1Rlcm1zOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBwb2xpY2llc0FuZFNlcnZpY2VzOiBudWxsLCAvLyBGcm9tIHRoZSBzdGFydFRlcm1zRmxvdyBjYWxsYmFja1xuICAgICAgICAgICAgICAgIGFncmVlZFVybHM6IG51bGwsICAgICAgICAgIC8vIEZyb20gdGhlIHN0YXJ0VGVybXNGbG93IGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgcmVzb2x2ZTogbnVsbCwgICAgICAgICAgICAgLy8gUHJvbWlzZSByZXNvbHZlIGZ1bmN0aW9uIGZvciBzdGFydFRlcm1zRmxvdyBjYWxsYmFja1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVtYWlsczogW10sXG4gICAgICAgICAgICBtc2lzZG5zOiBbXSxcbiAgICAgICAgICAgIGxvYWRpbmczcGlkczogdHJ1ZSwgLy8gd2hldGhlciBvciBub3QgdGhlIGVtYWlscyBhbmQgbXNpc2RucyBoYXZlIGJlZW4gbG9hZGVkXG4gICAgICAgICAgICBjYW5DaGFuZ2VQYXNzd29yZDogZmFsc2UsXG4gICAgICAgICAgICBpZFNlcnZlck5hbWU6IG51bGwsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5kaXNwYXRjaGVyUmVmID0gZGlzLnJlZ2lzdGVyKHRoaXMub25BY3Rpb24pO1xuICAgIH1cblxuICAgIC8vIFRPRE86IFtSRUFDVC1XQVJOSU5HXSBNb3ZlIHRoaXMgdG8gY29uc3RydWN0b3JcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uLCBjYW1lbGNhc2VcbiAgICBwdWJsaWMgYXN5bmMgVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuXG4gICAgICAgIGNvbnN0IHNlcnZlclN1cHBvcnRzU2VwYXJhdGVBZGRBbmRCaW5kID0gYXdhaXQgY2xpLmRvZXNTZXJ2ZXJTdXBwb3J0U2VwYXJhdGVBZGRBbmRCaW5kKCk7XG5cbiAgICAgICAgY29uc3QgY2FwYWJpbGl0aWVzID0gYXdhaXQgY2xpLmdldENhcGFiaWxpdGllcygpOyAvLyB0aGlzIGlzIGNhY2hlZFxuICAgICAgICBjb25zdCBjaGFuZ2VQYXNzd29yZENhcCA9IGNhcGFiaWxpdGllc1snbS5jaGFuZ2VfcGFzc3dvcmQnXTtcblxuICAgICAgICAvLyBZb3UgY2FuIGNoYW5nZSB5b3VyIHBhc3N3b3JkIHNvIGxvbmcgYXMgdGhlIGNhcGFiaWxpdHkgaXNuJ3QgZXhwbGljaXRseSBkaXNhYmxlZC4gVGhlIGltcGxpY2l0XG4gICAgICAgIC8vIGJlaGF2aW91ciBpcyB5b3UgY2FuIGNoYW5nZSB5b3VyIHBhc3N3b3JkIHdoZW4gdGhlIGNhcGFiaWxpdHkgaXMgbWlzc2luZyBvciBoYXMgbm90LWZhbHNlIGFzXG4gICAgICAgIC8vIHRoZSBlbmFibGVkIGZsYWcgdmFsdWUuXG4gICAgICAgIGNvbnN0IGNhbkNoYW5nZVBhc3N3b3JkID0gIWNoYW5nZVBhc3N3b3JkQ2FwIHx8IGNoYW5nZVBhc3N3b3JkQ2FwWydlbmFibGVkJ10gIT09IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzZXJ2ZXJTdXBwb3J0c1NlcGFyYXRlQWRkQW5kQmluZCwgY2FuQ2hhbmdlUGFzc3dvcmQgfSk7XG5cbiAgICAgICAgdGhpcy5nZXRUaHJlZXBpZFN0YXRlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGNvbXBvbmVudERpZE1vdW50KCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBwbGFmID0gUGxhdGZvcm1QZWcuZ2V0KCk7XG4gICAgICAgIGlmIChwbGFmKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBzcGVsbENoZWNrTGFuZ3VhZ2VzOiBhd2FpdCBwbGFmLmdldFNwZWxsQ2hlY2tMYW5ndWFnZXMoKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xuICAgICAgICBkaXMudW5yZWdpc3Rlcih0aGlzLmRpc3BhdGNoZXJSZWYpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25BY3Rpb24gPSAocGF5bG9hZDogQWN0aW9uUGF5bG9hZCk6IHZvaWQgPT4ge1xuICAgICAgICBpZiAocGF5bG9hZC5hY3Rpb24gPT09ICdpZF9zZXJ2ZXJfY2hhbmdlZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBoYXZlSWRTZXJ2ZXI6IEJvb2xlYW4oTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldElkZW50aXR5U2VydmVyVXJsKCkpIH0pO1xuICAgICAgICAgICAgdGhpcy5nZXRUaHJlZXBpZFN0YXRlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkVtYWlsc0NoYW5nZSA9IChlbWFpbHM6IElUaHJlZXBpZFtdKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlbWFpbHMgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Nc2lzZG5zQ2hhbmdlID0gKG1zaXNkbnM6IElUaHJlZXBpZFtdKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBtc2lzZG5zIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGFzeW5jIGdldFRocmVlcGlkU3RhdGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcblxuICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgdGVybXMgbmVlZCBhY2NlcHRpbmdcbiAgICAgICAgdGhpcy5jaGVja1Rlcm1zKCk7XG5cbiAgICAgICAgLy8gTmVlZCB0byBnZXQgM1BJRHMgZ2VuZXJhbGx5IGZvciBBY2NvdW50IHNlY3Rpb24gYW5kIHBvc3NpYmx5IGFsc28gZm9yXG4gICAgICAgIC8vIERpc2NvdmVyeSAoYXNzdW1pbmcgd2UgaGF2ZSBhbiBJUyBhbmQgdGVybXMgYXJlIGFncmVlZCkuXG4gICAgICAgIGxldCB0aHJlZXBpZHMgPSBbXTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRocmVlcGlkcyA9IGF3YWl0IGdldFRocmVlcGlkc1dpdGhCaW5kU3RhdHVzKGNsaSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGlkU2VydmVyVXJsID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldElkZW50aXR5U2VydmVyVXJsKCk7XG4gICAgICAgICAgICBsb2dnZXIud2FybihcbiAgICAgICAgICAgICAgICBgVW5hYmxlIHRvIHJlYWNoIGlkZW50aXR5IHNlcnZlciBhdCAke2lkU2VydmVyVXJsfSB0byBjaGVjayBgICtcbiAgICAgICAgICAgICAgICBgZm9yIDNQSURzIGJpbmRpbmdzIGluIFNldHRpbmdzYCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBsb2dnZXIud2FybihlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGVtYWlsczogdGhyZWVwaWRzLmZpbHRlcigoYSkgPT4gYS5tZWRpdW0gPT09ICdlbWFpbCcpLFxuICAgICAgICAgICAgbXNpc2RuczogdGhyZWVwaWRzLmZpbHRlcigoYSkgPT4gYS5tZWRpdW0gPT09ICdtc2lzZG4nKSxcbiAgICAgICAgICAgIGxvYWRpbmczcGlkczogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgY2hlY2tUZXJtcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmhhdmVJZFNlcnZlcikge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlkU2VydmVySGFzVW5zaWduZWRUZXJtczogZmFsc2UgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCeSBzdGFydGluZyB0aGUgdGVybXMgZmxvdyB3ZSBnZXQgdGhlIGxvZ2ljIGZvciBjaGVja2luZyB3aGljaCB0ZXJtcyB0aGUgdXNlciBoYXMgc2lnbmVkXG4gICAgICAgIC8vIGZvciBmcmVlLiBTbyB3ZSBtaWdodCBhcyB3ZWxsIHVzZSB0aGF0IGZvciBvdXIgb3duIHB1cnBvc2VzLlxuICAgICAgICBjb25zdCBpZFNlcnZlclVybCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRJZGVudGl0eVNlcnZlclVybCgpO1xuICAgICAgICBjb25zdCBhdXRoQ2xpZW50ID0gbmV3IElkZW50aXR5QXV0aENsaWVudCgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgaWRBY2Nlc3NUb2tlbiA9IGF3YWl0IGF1dGhDbGllbnQuZ2V0QWNjZXNzVG9rZW4oeyBjaGVjazogZmFsc2UgfSk7XG4gICAgICAgICAgICBhd2FpdCBzdGFydFRlcm1zRmxvdyhbbmV3IFNlcnZpY2UoXG4gICAgICAgICAgICAgICAgU0VSVklDRV9UWVBFUy5JUyxcbiAgICAgICAgICAgICAgICBpZFNlcnZlclVybCxcbiAgICAgICAgICAgICAgICBpZEFjY2Vzc1Rva2VuLFxuICAgICAgICAgICAgKV0sIChwb2xpY2llc0FuZFNlcnZpY2VzLCBhZ3JlZWRVcmxzLCBleHRyYUNsYXNzTmFtZXMpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkU2VydmVyTmFtZTogYWJicmV2aWF0ZVVybChpZFNlcnZlclVybCksXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZFBvbGljeUluZm86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNUZXJtczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2xpY2llc0FuZFNlcnZpY2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFncmVlZFVybHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBVc2VyIGFjY2VwdGVkIGFsbCB0ZXJtc1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgcmVxdWlyZWRQb2xpY3lJbmZvOiB7XG4gICAgICAgICAgICAgICAgICAgIGhhc1Rlcm1zOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5zdGF0ZS5yZXF1aXJlZFBvbGljeUluZm8sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsb2dnZXIud2FybihcbiAgICAgICAgICAgICAgICBgVW5hYmxlIHRvIHJlYWNoIGlkZW50aXR5IHNlcnZlciBhdCAke2lkU2VydmVyVXJsfSB0byBjaGVjayBgICtcbiAgICAgICAgICAgICAgICBgZm9yIHRlcm1zIGluIFNldHRpbmdzYCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBsb2dnZXIud2FybihlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgb25MYW5ndWFnZUNoYW5nZSA9IChuZXdMYW5ndWFnZTogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmxhbmd1YWdlID09PSBuZXdMYW5ndWFnZSkgcmV0dXJuO1xuXG4gICAgICAgIFNldHRpbmdzU3RvcmUuc2V0VmFsdWUoXCJsYW5ndWFnZVwiLCBudWxsLCBTZXR0aW5nTGV2ZWwuREVWSUNFLCBuZXdMYW5ndWFnZSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsYW5ndWFnZTogbmV3TGFuZ3VhZ2UgfSk7XG4gICAgICAgIGNvbnN0IHBsYXRmb3JtID0gUGxhdGZvcm1QZWcuZ2V0KCk7XG4gICAgICAgIGlmIChwbGF0Zm9ybSkge1xuICAgICAgICAgICAgcGxhdGZvcm0uc2V0TGFuZ3VhZ2UoW25ld0xhbmd1YWdlXSk7XG4gICAgICAgICAgICBwbGF0Zm9ybS5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU3BlbGxDaGVja0xhbmd1YWdlc0NoYW5nZSA9IChsYW5ndWFnZXM6IHN0cmluZ1tdKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzcGVsbENoZWNrTGFuZ3VhZ2VzOiBsYW5ndWFnZXMgfSk7XG5cbiAgICAgICAgY29uc3QgcGxhZiA9IFBsYXRmb3JtUGVnLmdldCgpO1xuICAgICAgICBpZiAocGxhZikge1xuICAgICAgICAgICAgcGxhZi5zZXRTcGVsbENoZWNrTGFuZ3VhZ2VzKGxhbmd1YWdlcyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBhc3N3b3JkQ2hhbmdlRXJyb3IgPSAoZXJyKTogdm9pZCA9PiB7XG4gICAgICAgIC8vIFRPRE86IEZpZ3VyZSBvdXQgYSBkZXNpZ24gdGhhdCBkb2Vzbid0IGludm9sdmUgcmVwbGFjaW5nIHRoZSBjdXJyZW50IGRpYWxvZ1xuICAgICAgICBsZXQgZXJyTXNnID0gZXJyLmVycm9yIHx8IGVyci5tZXNzYWdlIHx8IFwiXCI7XG4gICAgICAgIGlmIChlcnIuaHR0cFN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICAgICAgICBlcnJNc2cgPSBfdChcIkZhaWxlZCB0byBjaGFuZ2UgcGFzc3dvcmQuIElzIHlvdXIgcGFzc3dvcmQgY29ycmVjdD9cIik7XG4gICAgICAgIH0gZWxzZSBpZiAoIWVyck1zZykge1xuICAgICAgICAgICAgZXJyTXNnICs9IGAgKEhUVFAgc3RhdHVzICR7ZXJyLmh0dHBTdGF0dXN9KWA7XG4gICAgICAgIH1cbiAgICAgICAgbG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGNoYW5nZSBwYXNzd29yZDogXCIgKyBlcnJNc2cpO1xuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdGYWlsZWQgdG8gY2hhbmdlIHBhc3N3b3JkJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICB0aXRsZTogX3QoXCJFcnJvclwiKSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBlcnJNc2csXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUGFzc3dvcmRDaGFuZ2VkID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICAvLyBUT0RPOiBGaWd1cmUgb3V0IGEgZGVzaWduIHRoYXQgZG9lc24ndCBpbnZvbHZlIHJlcGxhY2luZyB0aGUgY3VycmVudCBkaWFsb2dcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnUGFzc3dvcmQgY2hhbmdlZCcsICcnLCBFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgdGl0bGU6IF90KFwiU3VjY2Vzc1wiKSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBfdChcbiAgICAgICAgICAgICAgICBcIllvdXIgcGFzc3dvcmQgd2FzIHN1Y2Nlc3NmdWxseSBjaGFuZ2VkLiBZb3Ugd2lsbCBub3QgcmVjZWl2ZSBcIiArXG4gICAgICAgICAgICAgICAgXCJwdXNoIG5vdGlmaWNhdGlvbnMgb24gb3RoZXIgc2Vzc2lvbnMgdW50aWwgeW91IGxvZyBiYWNrIGluIHRvIHRoZW1cIixcbiAgICAgICAgICAgICkgKyBcIi5cIixcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25EZWFjdGl2YXRlQ2xpY2tlZCA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRGVhY3RpdmF0ZSBBY2NvdW50JywgJycsIERlYWN0aXZhdGVBY2NvdW50RGlhbG9nLCB7XG4gICAgICAgICAgICBvbkZpbmlzaGVkOiAoc3VjY2VzcykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB0aGlzLnByb3BzLmNsb3NlU2V0dGluZ3NGbigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVuZGVyUHJvZmlsZVNlY3Rpb24oKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgPFByb2ZpbGVTZXR0aW5ncyAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJBY2NvdW50U2VjdGlvbigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGxldCBwYXNzd29yZENoYW5nZUZvcm0gPSAoXG4gICAgICAgICAgICA8Q2hhbmdlUGFzc3dvcmRcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9HZW5lcmFsVXNlclNldHRpbmdzVGFiX2NoYW5nZVBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICByb3dDbGFzc05hbWU9XCJcIlxuICAgICAgICAgICAgICAgIGJ1dHRvbktpbmQ9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICBvbkVycm9yPXt0aGlzLm9uUGFzc3dvcmRDaGFuZ2VFcnJvcn1cbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLm9uUGFzc3dvcmRDaGFuZ2VkfSAvPlxuICAgICAgICApO1xuXG4gICAgICAgIGxldCB0aHJlZXBpZFNlY3Rpb24gPSBudWxsO1xuXG4gICAgICAgIC8vIEZvciBvbGRlciBob21lc2VydmVycyB3aXRob3V0IHNlcGFyYXRlIDNQSUQgYWRkIGFuZCBiaW5kIG1ldGhvZHMgKE1TQzIyOTApLFxuICAgICAgICAvLyB3ZSB1c2UgYSBjb21ibyBhZGQgd2l0aCBiaW5kIG9wdGlvbiBBUEkgd2hpY2ggcmVxdWlyZXMgYW4gaWRlbnRpdHkgc2VydmVyIHRvXG4gICAgICAgIC8vIHZhbGlkYXRlIDNQSUQgb3duZXJzaGlwIGV2ZW4gaWYgd2UncmUganVzdCBhZGRpbmcgdG8gdGhlIGhvbWVzZXJ2ZXIgb25seS5cbiAgICAgICAgLy8gRm9yIG5ld2VyIGhvbWVzZXJ2ZXJzIHdpdGggc2VwYXJhdGUgM1BJRCBhZGQgYW5kIGJpbmQgbWV0aG9kcyAoTVNDMjI5MCksXG4gICAgICAgIC8vIHRoZXJlIGlzIG5vIHN1Y2ggY29uY2Vybiwgc28gd2UgY2FuIGFsd2F5cyBzaG93IHRoZSBIUyBhY2NvdW50IDNQSURzLlxuICAgICAgICBpZiAoU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShVSUZlYXR1cmUuVGhpcmRQYXJ0eUlEKSAmJlxuICAgICAgICAgICAgKHRoaXMuc3RhdGUuaGF2ZUlkU2VydmVyIHx8IHRoaXMuc3RhdGUuc2VydmVyU3VwcG9ydHNTZXBhcmF0ZUFkZEFuZEJpbmQgPT09IHRydWUpXG4gICAgICAgICkge1xuICAgICAgICAgICAgY29uc3QgZW1haWxzID0gdGhpcy5zdGF0ZS5sb2FkaW5nM3BpZHNcbiAgICAgICAgICAgICAgICA/IDxTcGlubmVyIC8+XG4gICAgICAgICAgICAgICAgOiA8QWNjb3VudEVtYWlsQWRkcmVzc2VzXG4gICAgICAgICAgICAgICAgICAgIGVtYWlscz17dGhpcy5zdGF0ZS5lbWFpbHN9XG4gICAgICAgICAgICAgICAgICAgIG9uRW1haWxzQ2hhbmdlPXt0aGlzLm9uRW1haWxzQ2hhbmdlfVxuICAgICAgICAgICAgICAgIC8+O1xuICAgICAgICAgICAgY29uc3QgbXNpc2RucyA9IHRoaXMuc3RhdGUubG9hZGluZzNwaWRzXG4gICAgICAgICAgICAgICAgPyA8U3Bpbm5lciAvPlxuICAgICAgICAgICAgICAgIDogPEFjY291bnRQaG9uZU51bWJlcnNcbiAgICAgICAgICAgICAgICAgICAgbXNpc2Rucz17dGhpcy5zdGF0ZS5tc2lzZG5zfVxuICAgICAgICAgICAgICAgICAgICBvbk1zaXNkbnNDaGFuZ2U9e3RoaXMub25Nc2lzZG5zQ2hhbmdlfVxuICAgICAgICAgICAgICAgIC8+O1xuICAgICAgICAgICAgdGhyZWVwaWRTZWN0aW9uID0gPGRpdj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zdWJoZWFkaW5nXCI+eyBfdChcIkVtYWlsIGFkZHJlc3Nlc1wiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgIHsgZW1haWxzIH1cblxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YmhlYWRpbmdcIj57IF90KFwiUGhvbmUgbnVtYmVyc1wiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgIHsgbXNpc2RucyB9XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5zZXJ2ZXJTdXBwb3J0c1NlcGFyYXRlQWRkQW5kQmluZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyZWVwaWRTZWN0aW9uID0gPFNwaW5uZXIgLz47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcGFzc3dvcmRDaGFuZ2VUZXh0ID0gX3QoXCJTZXQgYSBuZXcgYWNjb3VudCBwYXNzd29yZC4uLlwiKTtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmNhbkNoYW5nZVBhc3N3b3JkKSB7XG4gICAgICAgICAgICAvLyBKdXN0IGRvbid0IHNob3cgYW55dGhpbmcgaWYgeW91IGNhbid0IGRvIGFueXRoaW5nLlxuICAgICAgICAgICAgcGFzc3dvcmRDaGFuZ2VUZXh0ID0gbnVsbDtcbiAgICAgICAgICAgIHBhc3N3b3JkQ2hhbmdlRm9ybSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uIG14X0dlbmVyYWxVc2VyU2V0dGluZ3NUYWJfYWNjb3VudFNlY3Rpb25cIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zdWJoZWFkaW5nXCI+eyBfdChcIkFjY291bnRcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zdWJzZWN0aW9uVGV4dFwiPlxuICAgICAgICAgICAgICAgICAgICB7IHBhc3N3b3JkQ2hhbmdlVGV4dCB9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICAgIHsgcGFzc3dvcmRDaGFuZ2VGb3JtIH1cbiAgICAgICAgICAgICAgICB7IHRocmVlcGlkU2VjdGlvbiB9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlckxhbmd1YWdlU2VjdGlvbigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIC8vIFRPRE86IENvbnZlcnQgdG8gbmV3LXN0eWxlZCBGaWVsZFxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZ1wiPnsgX3QoXCJMYW5ndWFnZSBhbmQgcmVnaW9uXCIpIH08L3NwYW4+XG4gICAgICAgICAgICAgICAgPExhbmd1YWdlRHJvcGRvd25cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfR2VuZXJhbFVzZXJTZXR0aW5nc1RhYl9sYW5ndWFnZUlucHV0XCJcbiAgICAgICAgICAgICAgICAgICAgb25PcHRpb25DaGFuZ2U9e3RoaXMub25MYW5ndWFnZUNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUubGFuZ3VhZ2V9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyU3BlbGxDaGVja1NlY3Rpb24oKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZ1wiPnsgX3QoXCJTcGVsbCBjaGVjayBkaWN0aW9uYXJpZXNcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8U3BlbGxDaGVja1NldHRpbmdzXG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlcz17dGhpcy5zdGF0ZS5zcGVsbENoZWNrTGFuZ3VhZ2VzfVxuICAgICAgICAgICAgICAgICAgICBvbkxhbmd1YWdlc0NoYW5nZT17dGhpcy5vblNwZWxsQ2hlY2tMYW5ndWFnZXNDaGFuZ2V9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyRGlzY292ZXJ5U2VjdGlvbigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnJlcXVpcmVkUG9saWN5SW5mby5oYXNUZXJtcykge1xuICAgICAgICAgICAgY29uc3QgaW50cm8gPSA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zdWJzZWN0aW9uVGV4dFwiPlxuICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiQWdyZWUgdG8gdGhlIGlkZW50aXR5IHNlcnZlciAoJShzZXJ2ZXJOYW1lKXMpIFRlcm1zIG9mIFNlcnZpY2UgdG8gXCIgK1xuICAgICAgICAgICAgICAgICAgICBcImFsbG93IHlvdXJzZWxmIHRvIGJlIGRpc2NvdmVyYWJsZSBieSBlbWFpbCBhZGRyZXNzIG9yIHBob25lIG51bWJlci5cIixcbiAgICAgICAgICAgICAgICAgICAgeyBzZXJ2ZXJOYW1lOiB0aGlzLnN0YXRlLmlkU2VydmVyTmFtZSB9LFxuICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgPC9zcGFuPjtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgPElubGluZVRlcm1zQWdyZWVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICBwb2xpY2llc0FuZFNlcnZpY2VQYWlycz17dGhpcy5zdGF0ZS5yZXF1aXJlZFBvbGljeUluZm8ucG9saWNpZXNBbmRTZXJ2aWNlc31cbiAgICAgICAgICAgICAgICAgICAgICAgIGFncmVlZFVybHM9e3RoaXMuc3RhdGUucmVxdWlyZWRQb2xpY3lJbmZvLmFncmVlZFVybHN9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLnN0YXRlLnJlcXVpcmVkUG9saWN5SW5mby5yZXNvbHZlfVxuICAgICAgICAgICAgICAgICAgICAgICAgaW50cm9FbGVtZW50PXtpbnRyb31cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgeyAvKiBoYXMgaXRzIG93biBoZWFkaW5nIGFzIGl0IGluY2x1ZGVzIHRoZSBjdXJyZW50IGlkZW50aXR5IHNlcnZlciAqLyB9XG4gICAgICAgICAgICAgICAgICAgIDxTZXRJZFNlcnZlciBtaXNzaW5nVGVybXM9e3RydWV9IC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZW1haWxzID0gdGhpcy5zdGF0ZS5sb2FkaW5nM3BpZHMgPyA8U3Bpbm5lciAvPiA6IDxEaXNjb3ZlcnlFbWFpbEFkZHJlc3NlcyBlbWFpbHM9e3RoaXMuc3RhdGUuZW1haWxzfSAvPjtcbiAgICAgICAgY29uc3QgbXNpc2RucyA9IHRoaXMuc3RhdGUubG9hZGluZzNwaWRzID8gPFNwaW5uZXIgLz4gOiA8RGlzY292ZXJ5UGhvbmVOdW1iZXJzIG1zaXNkbnM9e3RoaXMuc3RhdGUubXNpc2Ruc30gLz47XG5cbiAgICAgICAgY29uc3QgdGhyZWVwaWRTZWN0aW9uID0gdGhpcy5zdGF0ZS5oYXZlSWRTZXJ2ZXIgPyA8ZGl2IGNsYXNzTmFtZT0nbXhfR2VuZXJhbFVzZXJTZXR0aW5nc1RhYl9kaXNjb3ZlcnknPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZ1wiPnsgX3QoXCJFbWFpbCBhZGRyZXNzZXNcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgIHsgZW1haWxzIH1cblxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZ1wiPnsgX3QoXCJQaG9uZSBudW1iZXJzXCIpIH08L3NwYW4+XG4gICAgICAgICAgICB7IG1zaXNkbnMgfVxuICAgICAgICA8L2Rpdj4gOiBudWxsO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3NlY3Rpb25cIj5cbiAgICAgICAgICAgICAgICB7IHRocmVlcGlkU2VjdGlvbiB9XG4gICAgICAgICAgICAgICAgeyAvKiBoYXMgaXRzIG93biBoZWFkaW5nIGFzIGl0IGluY2x1ZGVzIHRoZSBjdXJyZW50IGlkZW50aXR5IHNlcnZlciAqLyB9XG4gICAgICAgICAgICAgICAgPFNldElkU2VydmVyIG1pc3NpbmdUZXJtcz17ZmFsc2V9IC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlck1hbmFnZW1lbnRTZWN0aW9uKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgLy8gVE9ETzogSW1wcm92ZSB3YXJuaW5nIHRleHQgZm9yIGFjY291bnQgZGVhY3RpdmF0aW9uXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3NlY3Rpb25cIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zdWJoZWFkaW5nXCI+eyBfdChcIkFjY291bnQgbWFuYWdlbWVudFwiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YnNlY3Rpb25UZXh0XCI+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJEZWFjdGl2YXRpbmcgeW91ciBhY2NvdW50IGlzIGEgcGVybWFuZW50IGFjdGlvbiAtIGJlIGNhcmVmdWwhXCIpIH1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17dGhpcy5vbkRlYWN0aXZhdGVDbGlja2VkfSBraW5kPVwiZGFuZ2VyXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJEZWFjdGl2YXRlIEFjY291bnRcIikgfVxuICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVySW50ZWdyYXRpb25NYW5hZ2VyU2VjdGlvbigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGlmICghU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShVSUZlYXR1cmUuV2lkZ2V0cykpIHJldHVybiBudWxsO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3NlY3Rpb25cIj5cbiAgICAgICAgICAgICAgICB7IC8qIGhhcyBpdHMgb3duIGhlYWRpbmcgYXMgaXQgaW5jbHVkZXMgdGhlIGN1cnJlbnQgaW50ZWdyYXRpb24gbWFuYWdlciAqLyB9XG4gICAgICAgICAgICAgICAgPFNldEludGVncmF0aW9uTWFuYWdlciAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGNvbnN0IHBsYWYgPSBQbGF0Zm9ybVBlZy5nZXQoKTtcbiAgICAgICAgY29uc3Qgc3VwcG9ydHNNdWx0aUxhbmd1YWdlU3BlbGxDaGVjayA9IHBsYWYuc3VwcG9ydHNNdWx0aUxhbmd1YWdlU3BlbGxDaGVjaygpO1xuXG4gICAgICAgIGNvbnN0IGRpc2NvV2FybmluZyA9IHRoaXMuc3RhdGUucmVxdWlyZWRQb2xpY3lJbmZvLmhhc1Rlcm1zXG4gICAgICAgICAgICA/IDxpbWdcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9J214X0dlbmVyYWxVc2VyU2V0dGluZ3NUYWJfd2FybmluZ0ljb24nXG4gICAgICAgICAgICAgICAgc3JjPXtyZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vcmVzL2ltZy9mZWF0aGVyLWN1c3RvbWlzZWQvd2FybmluZy10cmlhbmdsZS5zdmdcIil9XG4gICAgICAgICAgICAgICAgd2lkdGg9XCIxOFwiXG4gICAgICAgICAgICAgICAgaGVpZ2h0PVwiMThcIlxuICAgICAgICAgICAgICAgIGFsdD17X3QoXCJXYXJuaW5nXCIpfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDogbnVsbDtcblxuICAgICAgICBsZXQgYWNjb3VudE1hbmFnZW1lbnRTZWN0aW9uO1xuICAgICAgICBpZiAoU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShVSUZlYXR1cmUuRGVhY3RpdmF0ZSkpIHtcbiAgICAgICAgICAgIGFjY291bnRNYW5hZ2VtZW50U2VjdGlvbiA9IDw+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9oZWFkaW5nXCI+eyBfdChcIkRlYWN0aXZhdGUgYWNjb3VudFwiKSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgeyB0aGlzLnJlbmRlck1hbmFnZW1lbnRTZWN0aW9uKCkgfVxuICAgICAgICAgICAgPC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGRpc2NvdmVyeVNlY3Rpb247XG4gICAgICAgIGlmIChTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFVJRmVhdHVyZS5JZGVudGl0eVNlcnZlcikpIHtcbiAgICAgICAgICAgIGRpc2NvdmVyeVNlY3Rpb24gPSA8PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgZGlzY29XYXJuaW5nIH0geyBfdChcIkRpc2NvdmVyeVwiKSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgeyB0aGlzLnJlbmRlckRpc2NvdmVyeVNlY3Rpb24oKSB9XG4gICAgICAgICAgICA8Lz47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYlwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJHZW5lcmFsXCIpIH08L2Rpdj5cbiAgICAgICAgICAgICAgICB7IHRoaXMucmVuZGVyUHJvZmlsZVNlY3Rpb24oKSB9XG4gICAgICAgICAgICAgICAgeyB0aGlzLnJlbmRlckFjY291bnRTZWN0aW9uKCkgfVxuICAgICAgICAgICAgICAgIHsgdGhpcy5yZW5kZXJMYW5ndWFnZVNlY3Rpb24oKSB9XG4gICAgICAgICAgICAgICAgeyBzdXBwb3J0c011bHRpTGFuZ3VhZ2VTcGVsbENoZWNrID8gdGhpcy5yZW5kZXJTcGVsbENoZWNrU2VjdGlvbigpIDogbnVsbCB9XG4gICAgICAgICAgICAgICAgeyBkaXNjb3ZlcnlTZWN0aW9uIH1cbiAgICAgICAgICAgICAgICB7IHRoaXMucmVuZGVySW50ZWdyYXRpb25NYW5hZ2VyU2VjdGlvbigpIC8qIEhhcyBpdHMgb3duIHRpdGxlICovIH1cbiAgICAgICAgICAgICAgICB7IGFjY291bnRNYW5hZ2VtZW50U2VjdGlvbiB9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=