"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _url = _interopRequireDefault(require("url"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _boundThreepids = require("../../../boundThreepids");

var _IdentityAuthClient = _interopRequireDefault(require("../../../IdentityAuthClient"));

var _UrlUtils = require("../../../utils/UrlUtils");

var _IdentityServerUtils = require("../../../utils/IdentityServerUtils");

var _promise = require("../../../utils/promise");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _InlineSpinner = _interopRequireDefault(require("../elements/InlineSpinner"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _Field = _interopRequireDefault(require("../elements/Field"));

var _QuestionDialog = _interopRequireDefault(require("../dialogs/QuestionDialog"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

// We'll wait up to this long when checking for 3PID bindings on the IS.
const REACHABILITY_TIMEOUT = 10000; // ms

/**
 * Check an IS URL is valid, including liveness check
 *
 * @param {string} u The url to check
 * @returns {string} null if url passes all checks, otherwise i18ned error string
 */

async function checkIdentityServerUrl(u) {
  const parsedUrl = _url.default.parse(u);

  if (parsedUrl.protocol !== 'https:') return (0, _languageHandler._t)("Identity server URL must be HTTPS"); // XXX: duplicated logic from js-sdk but it's quite tied up in the validation logic in the
  // js-sdk so probably as easy to duplicate it than to separate it out so we can reuse it

  try {
    const response = await fetch(u + '/_matrix/identity/api/v1');

    if (response.ok) {
      return null;
    } else if (response.status < 200 || response.status >= 300) {
      return (0, _languageHandler._t)("Not a valid identity server (status code %(code)s)", {
        code: response.status
      });
    } else {
      return (0, _languageHandler._t)("Could not connect to identity server");
    }
  } catch (e) {
    return (0, _languageHandler._t)("Could not connect to identity server");
  }
}

let SetIdServer = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.SetIdServer"), _dec(_class = class SetIdServer extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "onAction", payload => {
      // We react to changes in the identity server in the event the user is staring at this form
      // when changing their identity server on another device.
      if (payload.action !== "id_server_changed") return;
      this.setState({
        currentClientIdServer: _MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl()
      });
    });
    (0, _defineProperty2.default)(this, "onIdentityServerChanged", ev => {
      const u = ev.target.value;
      this.setState({
        idServer: u
      });
    });
    (0, _defineProperty2.default)(this, "getTooltip", () => {
      if (this.state.checking) {
        return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_InlineSpinner.default, null), (0, _languageHandler._t)("Checking server"));
      } else if (this.state.error) {
        return /*#__PURE__*/_react.default.createElement("span", {
          className: "warning"
        }, this.state.error);
      } else {
        return null;
      }
    });
    (0, _defineProperty2.default)(this, "idServerChangeEnabled", () => {
      return !!this.state.idServer && !this.state.busy;
    });
    (0, _defineProperty2.default)(this, "saveIdServer", fullUrl => {
      // Account data change will update localstorage, client, etc through dispatcher
      _MatrixClientPeg.MatrixClientPeg.get().setAccountData("m.identity_server", {
        base_url: fullUrl
      });

      this.setState({
        busy: false,
        error: null,
        currentClientIdServer: fullUrl,
        idServer: ''
      });
    });
    (0, _defineProperty2.default)(this, "checkIdServer", async e => {
      e.preventDefault();
      const {
        idServer,
        currentClientIdServer
      } = this.state;
      this.setState({
        busy: true,
        checking: true,
        error: null
      });
      const fullUrl = (0, _UrlUtils.unabbreviateUrl)(idServer);
      let errStr = await checkIdentityServerUrl(fullUrl);

      if (!errStr) {
        try {
          this.setState({
            checking: false
          }); // clear tooltip
          // Test the identity server by trying to register with it. This
          // may result in a terms of service prompt.

          const authClient = new _IdentityAuthClient.default(fullUrl);
          await authClient.getAccessToken();
          let save = true; // Double check that the identity server even has terms of service.

          const hasTerms = await (0, _IdentityServerUtils.doesIdentityServerHaveTerms)(fullUrl);

          if (!hasTerms) {
            const [confirmed] = await this.showNoTermsWarning(fullUrl);
            save = confirmed;
          } // Show a general warning, possibly with details about any bound
          // 3PIDs that would be left behind.


          if (save && currentClientIdServer && fullUrl !== currentClientIdServer) {
            const [confirmed] = await this.showServerChangeWarning({
              title: (0, _languageHandler._t)("Change identity server"),
              unboundMessage: (0, _languageHandler._t)("Disconnect from the identity server <current /> and " + "connect to <new /> instead?", {}, {
                current: sub => /*#__PURE__*/_react.default.createElement("b", null, (0, _UrlUtils.abbreviateUrl)(currentClientIdServer)),
                new: sub => /*#__PURE__*/_react.default.createElement("b", null, (0, _UrlUtils.abbreviateUrl)(idServer))
              }),
              button: (0, _languageHandler._t)("Continue")
            });
            save = confirmed;
          }

          if (save) {
            this.saveIdServer(fullUrl);
          }
        } catch (e) {
          _logger.logger.error(e);

          errStr = (0, _languageHandler._t)("Terms of service not accepted or the identity server is invalid.");
        }
      }

      this.setState({
        busy: false,
        checking: false,
        error: errStr,
        currentClientIdServer: _MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl()
      });
    });
    (0, _defineProperty2.default)(this, "onDisconnectClicked", async () => {
      this.setState({
        disconnectBusy: true
      });

      try {
        const [confirmed] = await this.showServerChangeWarning({
          title: (0, _languageHandler._t)("Disconnect identity server"),
          unboundMessage: (0, _languageHandler._t)("Disconnect from the identity server <idserver />?", {}, {
            idserver: sub => /*#__PURE__*/_react.default.createElement("b", null, (0, _UrlUtils.abbreviateUrl)(this.state.currentClientIdServer))
          }),
          button: (0, _languageHandler._t)("Disconnect")
        });

        if (confirmed) {
          this.disconnectIdServer();
        }
      } finally {
        this.setState({
          disconnectBusy: false
        });
      }
    });
    (0, _defineProperty2.default)(this, "disconnectIdServer", () => {
      // Account data change will update localstorage, client, etc through dispatcher
      _MatrixClientPeg.MatrixClientPeg.get().setAccountData("m.identity_server", {
        base_url: null // clear

      });

      let newFieldVal = '';

      if ((0, _IdentityServerUtils.getDefaultIdentityServerUrl)()) {
        // Prepopulate the client's default so the user at least has some idea of
        // a valid value they might enter
        newFieldVal = (0, _UrlUtils.abbreviateUrl)((0, _IdentityServerUtils.getDefaultIdentityServerUrl)());
      }

      this.setState({
        busy: false,
        error: null,
        currentClientIdServer: _MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl(),
        idServer: newFieldVal
      });
    });
    let defaultIdServer = '';

    if (!_MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl() && (0, _IdentityServerUtils.getDefaultIdentityServerUrl)()) {
      // If no identity server is configured but there's one in the config, prepopulate
      // the field to help the user.
      defaultIdServer = (0, _UrlUtils.abbreviateUrl)((0, _IdentityServerUtils.getDefaultIdentityServerUrl)());
    }

    this.state = {
      defaultIdServer,
      currentClientIdServer: _MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl(),
      idServer: "",
      error: null,
      busy: false,
      disconnectBusy: false,
      checking: false
    };
  }

  componentDidMount() {
    this.dispatcherRef = _dispatcher.default.register(this.onAction);
  }

  componentWillUnmount() {
    _dispatcher.default.unregister(this.dispatcherRef);
  }

  showNoTermsWarning(fullUrl) {
    const {
      finished
    } = _Modal.default.createTrackedDialog('No Terms Warning', '', _QuestionDialog.default, {
      title: (0, _languageHandler._t)("Identity server has no terms of service"),
      description: /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("span", {
        className: "warning"
      }, (0, _languageHandler._t)("The identity server you have chosen does not have any terms of service.")), /*#__PURE__*/_react.default.createElement("span", null, "\xA0", (0, _languageHandler._t)("Only continue if you trust the owner of the server."))),
      button: (0, _languageHandler._t)("Continue")
    });

    return finished;
  }

  async showServerChangeWarning({
    title,
    unboundMessage,
    button
  }) {
    const {
      currentClientIdServer
    } = this.state;
    let threepids = [];
    let currentServerReachable = true;

    try {
      threepids = await (0, _promise.timeout)((0, _boundThreepids.getThreepidsWithBindStatus)(_MatrixClientPeg.MatrixClientPeg.get()), Promise.reject(new Error("Timeout attempting to reach identity server")), REACHABILITY_TIMEOUT);
    } catch (e) {
      currentServerReachable = false;

      _logger.logger.warn(`Unable to reach identity server at ${currentClientIdServer} to check ` + `for 3PIDs during IS change flow`);

      _logger.logger.warn(e);
    }

    const boundThreepids = threepids.filter(tp => tp.bound);
    let message;
    let danger = false;
    const messageElements = {
      idserver: sub => /*#__PURE__*/_react.default.createElement("b", null, (0, _UrlUtils.abbreviateUrl)(currentClientIdServer)),
      b: sub => /*#__PURE__*/_react.default.createElement("b", null, sub)
    };

    if (!currentServerReachable) {
      message = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You should <b>remove your personal data</b> from identity server " + "<idserver /> before disconnecting. Unfortunately, identity server " + "<idserver /> is currently offline or cannot be reached.", {}, messageElements)), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You should:")), /*#__PURE__*/_react.default.createElement("ul", null, /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("check your browser plugins for anything that might block " + "the identity server (such as Privacy Badger)")), /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("contact the administrators of identity server <idserver />", {}, {
        idserver: messageElements.idserver
      })), /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("wait and try again later"))));
      danger = true;
      button = (0, _languageHandler._t)("Disconnect anyway");
    } else if (boundThreepids.length) {
      message = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You are still <b>sharing your personal data</b> on the identity " + "server <idserver />.", {}, messageElements)), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("We recommend that you remove your email addresses and phone numbers " + "from the identity server before disconnecting.")));
      danger = true;
      button = (0, _languageHandler._t)("Disconnect anyway");
    } else {
      message = unboundMessage;
    }

    const {
      finished
    } = _Modal.default.createTrackedDialog('Identity Server Bound Warning', '', _QuestionDialog.default, {
      title,
      description: message,
      button,
      cancelButton: (0, _languageHandler._t)("Go back"),
      danger
    });

    return finished;
  }

  render() {
    const idServerUrl = this.state.currentClientIdServer;
    let sectionTitle;
    let bodyText;

    if (idServerUrl) {
      sectionTitle = (0, _languageHandler._t)("Identity server (%(server)s)", {
        server: (0, _UrlUtils.abbreviateUrl)(idServerUrl)
      });
      bodyText = (0, _languageHandler._t)("You are currently using <server></server> to discover and be discoverable by " + "existing contacts you know. You can change your identity server below.", {}, {
        server: sub => /*#__PURE__*/_react.default.createElement("b", null, (0, _UrlUtils.abbreviateUrl)(idServerUrl))
      });

      if (this.props.missingTerms) {
        bodyText = (0, _languageHandler._t)("If you don't want to use <server /> to discover and be discoverable by existing " + "contacts you know, enter another identity server below.", {}, {
          server: sub => /*#__PURE__*/_react.default.createElement("b", null, (0, _UrlUtils.abbreviateUrl)(idServerUrl))
        });
      }
    } else {
      sectionTitle = (0, _languageHandler._t)("Identity server");
      bodyText = (0, _languageHandler._t)("You are not currently using an identity server. " + "To discover and be discoverable by existing contacts you know, " + "add one below.");
    }

    let discoSection;

    if (idServerUrl) {
      let discoButtonContent = (0, _languageHandler._t)("Disconnect");
      let discoBodyText = (0, _languageHandler._t)("Disconnecting from your identity server will mean you " + "won't be discoverable by other users and you won't be " + "able to invite others by email or phone.");

      if (this.props.missingTerms) {
        discoBodyText = (0, _languageHandler._t)("Using an identity server is optional. If you choose not to " + "use an identity server, you won't be discoverable by other users " + "and you won't be able to invite others by email or phone.");
        discoButtonContent = (0, _languageHandler._t)("Do not use an identity server");
      }

      if (this.state.disconnectBusy) {
        discoButtonContent = /*#__PURE__*/_react.default.createElement(_InlineSpinner.default, null);
      }

      discoSection = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_SettingsTab_subsectionText"
      }, discoBodyText), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        onClick: this.onDisconnectClicked,
        kind: "danger_sm"
      }, discoButtonContent));
    }

    return /*#__PURE__*/_react.default.createElement("form", {
      className: "mx_SettingsTab_section mx_SetIdServer",
      onSubmit: this.checkIdServer
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, sectionTitle), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subsectionText"
    }, bodyText), /*#__PURE__*/_react.default.createElement(_Field.default, {
      label: (0, _languageHandler._t)("Enter a new identity server"),
      type: "text",
      autoComplete: "off",
      placeholder: this.state.defaultIdServer,
      value: this.state.idServer,
      onChange: this.onIdentityServerChanged,
      tooltipContent: this.getTooltip(),
      tooltipClassName: "mx_SetIdServer_tooltip",
      disabled: this.state.busy,
      forceValidity: this.state.error ? false : null
    }), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      type: "submit",
      kind: "primary_sm",
      onClick: this.checkIdServer,
      disabled: !this.idServerChangeEnabled()
    }, (0, _languageHandler._t)("Change")), discoSection);
  }

}) || _class);
exports.default = SetIdServer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL1NldElkU2VydmVyLnRzeCJdLCJuYW1lcyI6WyJSRUFDSEFCSUxJVFlfVElNRU9VVCIsImNoZWNrSWRlbnRpdHlTZXJ2ZXJVcmwiLCJ1IiwicGFyc2VkVXJsIiwidXJsIiwicGFyc2UiLCJwcm90b2NvbCIsInJlc3BvbnNlIiwiZmV0Y2giLCJvayIsInN0YXR1cyIsImNvZGUiLCJlIiwiU2V0SWRTZXJ2ZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJwYXlsb2FkIiwiYWN0aW9uIiwic2V0U3RhdGUiLCJjdXJyZW50Q2xpZW50SWRTZXJ2ZXIiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJnZXRJZGVudGl0eVNlcnZlclVybCIsImV2IiwidGFyZ2V0IiwidmFsdWUiLCJpZFNlcnZlciIsInN0YXRlIiwiY2hlY2tpbmciLCJlcnJvciIsImJ1c3kiLCJmdWxsVXJsIiwic2V0QWNjb3VudERhdGEiLCJiYXNlX3VybCIsInByZXZlbnREZWZhdWx0IiwiZXJyU3RyIiwiYXV0aENsaWVudCIsIklkZW50aXR5QXV0aENsaWVudCIsImdldEFjY2Vzc1Rva2VuIiwic2F2ZSIsImhhc1Rlcm1zIiwiY29uZmlybWVkIiwic2hvd05vVGVybXNXYXJuaW5nIiwic2hvd1NlcnZlckNoYW5nZVdhcm5pbmciLCJ0aXRsZSIsInVuYm91bmRNZXNzYWdlIiwiY3VycmVudCIsInN1YiIsIm5ldyIsImJ1dHRvbiIsInNhdmVJZFNlcnZlciIsImxvZ2dlciIsImRpc2Nvbm5lY3RCdXN5IiwiaWRzZXJ2ZXIiLCJkaXNjb25uZWN0SWRTZXJ2ZXIiLCJuZXdGaWVsZFZhbCIsImRlZmF1bHRJZFNlcnZlciIsImNvbXBvbmVudERpZE1vdW50IiwiZGlzcGF0Y2hlclJlZiIsImRpcyIsInJlZ2lzdGVyIiwib25BY3Rpb24iLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInVucmVnaXN0ZXIiLCJmaW5pc2hlZCIsIk1vZGFsIiwiY3JlYXRlVHJhY2tlZERpYWxvZyIsIlF1ZXN0aW9uRGlhbG9nIiwiZGVzY3JpcHRpb24iLCJ0aHJlZXBpZHMiLCJjdXJyZW50U2VydmVyUmVhY2hhYmxlIiwiUHJvbWlzZSIsInJlamVjdCIsIkVycm9yIiwid2FybiIsImJvdW5kVGhyZWVwaWRzIiwiZmlsdGVyIiwidHAiLCJib3VuZCIsIm1lc3NhZ2UiLCJkYW5nZXIiLCJtZXNzYWdlRWxlbWVudHMiLCJiIiwibGVuZ3RoIiwiY2FuY2VsQnV0dG9uIiwicmVuZGVyIiwiaWRTZXJ2ZXJVcmwiLCJzZWN0aW9uVGl0bGUiLCJib2R5VGV4dCIsInNlcnZlciIsIm1pc3NpbmdUZXJtcyIsImRpc2NvU2VjdGlvbiIsImRpc2NvQnV0dG9uQ29udGVudCIsImRpc2NvQm9keVRleHQiLCJvbkRpc2Nvbm5lY3RDbGlja2VkIiwiY2hlY2tJZFNlcnZlciIsIm9uSWRlbnRpdHlTZXJ2ZXJDaGFuZ2VkIiwiZ2V0VG9vbHRpcCIsImlkU2VydmVyQ2hhbmdlRW5hYmxlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7QUFFQTtBQUNBLE1BQU1BLG9CQUFvQixHQUFHLEtBQTdCLEMsQ0FBb0M7O0FBRXBDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQSxlQUFlQyxzQkFBZixDQUFzQ0MsQ0FBdEMsRUFBeUM7QUFDckMsUUFBTUMsU0FBUyxHQUFHQyxhQUFJQyxLQUFKLENBQVVILENBQVYsQ0FBbEI7O0FBRUEsTUFBSUMsU0FBUyxDQUFDRyxRQUFWLEtBQXVCLFFBQTNCLEVBQXFDLE9BQU8seUJBQUcsbUNBQUgsQ0FBUCxDQUhBLENBS3JDO0FBQ0E7O0FBQ0EsTUFBSTtBQUNBLFVBQU1DLFFBQVEsR0FBRyxNQUFNQyxLQUFLLENBQUNO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RCxLQUFMLENBQVc2QixlQUo1QjtBQUtJLE1BQUEsS0FBSyxFQUFFLEtBQUs3QixLQUFMLENBQVdELFFBTHRCO0FBTUksTUFBQSxRQUFRLEVBQUUsS0FBS3NFLHVCQU5uQjtBQU9JLE1BQUEsY0FBYyxFQUFFLEtBQUtDLFVBQUwsRUFQcEI7QUFRSSxNQUFBLGdCQUFnQixFQUFDLHdCQVJyQjtBQVNJLE1BQUEsUUFBUSxFQUFFLEtBQUt0RSxLQUFMLENBQVdHLElBVHpCO0FBVUksTUFBQSxhQUFhLEVBQUUsS0FBS0gsS0FBTCxDQUFXRSxLQUFYLEdBQW1CLEtBQW5CLEdBQTJCO0FBVjlDLE1BUEosZUFtQkksNkJBQUMseUJBQUQ7QUFDSSxNQUFBLElBQUksRUFBQyxRQURUO0FBRUksTUFBQSxJQUFJLEVBQUMsWUFGVDtBQUdJLE1BQUEsT0FBTyxFQUFFLEtBQUtrRSxhQUhsQjtBQUlJLE1BQUEsUUFBUSxFQUFFLENBQUMsS0FBS0cscUJBQUw7QUFKZixPQUtHLHlCQUFHLFFBQUgsQ0FMSCxDQW5CSixFQXlCTVAsWUF6Qk4sQ0FESjtBQTZCSDs7QUFwV29FLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTktMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCB1cmwgZnJvbSAndXJsJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gXCIuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWdcIjtcbmltcG9ydCBNb2RhbCBmcm9tICcuLi8uLi8uLi9Nb2RhbCc7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCB7IGdldFRocmVlcGlkc1dpdGhCaW5kU3RhdHVzIH0gZnJvbSAnLi4vLi4vLi4vYm91bmRUaHJlZXBpZHMnO1xuaW1wb3J0IElkZW50aXR5QXV0aENsaWVudCBmcm9tIFwiLi4vLi4vLi4vSWRlbnRpdHlBdXRoQ2xpZW50XCI7XG5pbXBvcnQgeyBhYmJyZXZpYXRlVXJsLCB1bmFiYnJldmlhdGVVcmwgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvVXJsVXRpbHNcIjtcbmltcG9ydCB7IGdldERlZmF1bHRJZGVudGl0eVNlcnZlclVybCwgZG9lc0lkZW50aXR5U2VydmVySGF2ZVRlcm1zIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvSWRlbnRpdHlTZXJ2ZXJVdGlscyc7XG5pbXBvcnQgeyB0aW1lb3V0IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3Byb21pc2VcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBBY3Rpb25QYXlsb2FkIH0gZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9wYXlsb2Fkcyc7XG5pbXBvcnQgSW5saW5lU3Bpbm5lciBmcm9tICcuLi9lbGVtZW50cy9JbmxpbmVTcGlubmVyJztcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gJy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b24nO1xuaW1wb3J0IEZpZWxkIGZyb20gJy4uL2VsZW1lbnRzL0ZpZWxkJztcbmltcG9ydCBRdWVzdGlvbkRpYWxvZyBmcm9tIFwiLi4vZGlhbG9ncy9RdWVzdGlvbkRpYWxvZ1wiO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbi8vIFdlJ2xsIHdhaXQgdXAgdG8gdGhpcyBsb25nIHdoZW4gY2hlY2tpbmcgZm9yIDNQSUQgYmluZGluZ3Mgb24gdGhlIElTLlxuY29uc3QgUkVBQ0hBQklMSVRZX1RJTUVPVVQgPSAxMDAwMDsgLy8gbXNcblxuLyoqXG4gKiBDaGVjayBhbiBJUyBVUkwgaXMgdmFsaWQsIGluY2x1ZGluZyBsaXZlbmVzcyBjaGVja1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1IFRoZSB1cmwgdG8gY2hlY2tcbiAqIEByZXR1cm5zIHtzdHJpbmd9IG51bGwgaWYgdXJsIHBhc3NlcyBhbGwgY2hlY2tzLCBvdGhlcndpc2UgaTE4bmVkIGVycm9yIHN0cmluZ1xuICovXG5hc3luYyBmdW5jdGlvbiBjaGVja0lkZW50aXR5U2VydmVyVXJsKHUpIHtcbiAgICBjb25zdCBwYXJzZWRVcmwgPSB1cmwucGFyc2UodSk7XG5cbiAgICBpZiAocGFyc2VkVXJsLnByb3RvY29sICE9PSAnaHR0cHM6JykgcmV0dXJuIF90KFwiSWRlbnRpdHkgc2VydmVyIFVSTCBtdXN0IGJlIEhUVFBTXCIpO1xuXG4gICAgLy8gWFhYOiBkdXBsaWNhdGVkIGxvZ2ljIGZyb20ganMtc2RrIGJ1dCBpdCdzIHF1aXRlIHRpZWQgdXAgaW4gdGhlIHZhbGlkYXRpb24gbG9naWMgaW4gdGhlXG4gICAgLy8ganMtc2RrIHNvIHByb2JhYmx5IGFzIGVhc3kgdG8gZHVwbGljYXRlIGl0IHRoYW4gdG8gc2VwYXJhdGUgaXQgb3V0IHNvIHdlIGNhbiByZXVzZSBpdFxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godSArICcvX21hdHJpeC9pZGVudGl0eS9hcGkvdjEnKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPCAyMDAgfHwgcmVzcG9uc2Uuc3RhdHVzID49IDMwMCkge1xuICAgICAgICAgICAgcmV0dXJuIF90KFwiTm90IGEgdmFsaWQgaWRlbnRpdHkgc2VydmVyIChzdGF0dXMgY29kZSAlKGNvZGUpcylcIiwgeyBjb2RlOiByZXNwb25zZS5zdGF0dXMgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gX3QoXCJDb3VsZCBub3QgY29ubmVjdCB0byBpZGVudGl0eSBzZXJ2ZXJcIik7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBfdChcIkNvdWxkIG5vdCBjb25uZWN0IHRvIGlkZW50aXR5IHNlcnZlclwiKTtcbiAgICB9XG59XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIC8vIFdoZXRoZXIgb3Igbm90IHRoZSBpZGVudGl0eSBzZXJ2ZXIgaXMgbWlzc2luZyB0ZXJtcy4gVGhpcyBhZmZlY3RzIHRoZSB0ZXh0XG4gICAgLy8gc2hvd24gdG8gdGhlIHVzZXIuXG4gICAgbWlzc2luZ1Rlcm1zOiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBkZWZhdWx0SWRTZXJ2ZXI/OiBzdHJpbmc7XG4gICAgY3VycmVudENsaWVudElkU2VydmVyOiBzdHJpbmc7XG4gICAgaWRTZXJ2ZXI/OiBzdHJpbmc7XG4gICAgZXJyb3I/OiBzdHJpbmc7XG4gICAgYnVzeTogYm9vbGVhbjtcbiAgICBkaXNjb25uZWN0QnVzeTogYm9vbGVhbjtcbiAgICBjaGVja2luZzogYm9vbGVhbjtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3Muc2V0dGluZ3MuU2V0SWRTZXJ2ZXJcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNldElkU2VydmVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBkaXNwYXRjaGVyUmVmOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgbGV0IGRlZmF1bHRJZFNlcnZlciA9ICcnO1xuICAgICAgICBpZiAoIU1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRJZGVudGl0eVNlcnZlclVybCgpICYmIGdldERlZmF1bHRJZGVudGl0eVNlcnZlclVybCgpKSB7XG4gICAgICAgICAgICAvLyBJZiBubyBpZGVudGl0eSBzZXJ2ZXIgaXMgY29uZmlndXJlZCBidXQgdGhlcmUncyBvbmUgaW4gdGhlIGNvbmZpZywgcHJlcG9wdWxhdGVcbiAgICAgICAgICAgIC8vIHRoZSBmaWVsZCB0byBoZWxwIHRoZSB1c2VyLlxuICAgICAgICAgICAgZGVmYXVsdElkU2VydmVyID0gYWJicmV2aWF0ZVVybChnZXREZWZhdWx0SWRlbnRpdHlTZXJ2ZXJVcmwoKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgZGVmYXVsdElkU2VydmVyLFxuICAgICAgICAgICAgY3VycmVudENsaWVudElkU2VydmVyOiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0SWRlbnRpdHlTZXJ2ZXJVcmwoKSxcbiAgICAgICAgICAgIGlkU2VydmVyOiBcIlwiLFxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgICAgIGRpc2Nvbm5lY3RCdXN5OiBmYWxzZSxcbiAgICAgICAgICAgIGNoZWNraW5nOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXNwYXRjaGVyUmVmID0gZGlzLnJlZ2lzdGVyKHRoaXMub25BY3Rpb24pO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xuICAgICAgICBkaXMudW5yZWdpc3Rlcih0aGlzLmRpc3BhdGNoZXJSZWYpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25BY3Rpb24gPSAocGF5bG9hZDogQWN0aW9uUGF5bG9hZCkgPT4ge1xuICAgICAgICAvLyBXZSByZWFjdCB0byBjaGFuZ2VzIGluIHRoZSBpZGVudGl0eSBzZXJ2ZXIgaW4gdGhlIGV2ZW50IHRoZSB1c2VyIGlzIHN0YXJpbmcgYXQgdGhpcyBmb3JtXG4gICAgICAgIC8vIHdoZW4gY2hhbmdpbmcgdGhlaXIgaWRlbnRpdHkgc2VydmVyIG9uIGFub3RoZXIgZGV2aWNlLlxuICAgICAgICBpZiAocGF5bG9hZC5hY3Rpb24gIT09IFwiaWRfc2VydmVyX2NoYW5nZWRcIikgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgY3VycmVudENsaWVudElkU2VydmVyOiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0SWRlbnRpdHlTZXJ2ZXJVcmwoKSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25JZGVudGl0eVNlcnZlckNoYW5nZWQgPSAoZXYpID0+IHtcbiAgICAgICAgY29uc3QgdSA9IGV2LnRhcmdldC52YWx1ZTtcblxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaWRTZXJ2ZXI6IHUgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgZ2V0VG9vbHRpcCA9ICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuY2hlY2tpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgICAgIDxJbmxpbmVTcGlubmVyIC8+XG4gICAgICAgICAgICAgICAgeyBfdChcIkNoZWNraW5nIHNlcnZlclwiKSB9XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5lcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIDxzcGFuIGNsYXNzTmFtZT0nd2FybmluZyc+eyB0aGlzLnN0YXRlLmVycm9yIH08L3NwYW4+O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBpZFNlcnZlckNoYW5nZUVuYWJsZWQgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuc3RhdGUuaWRTZXJ2ZXIgJiYgIXRoaXMuc3RhdGUuYnVzeTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBzYXZlSWRTZXJ2ZXIgPSAoZnVsbFVybCkgPT4ge1xuICAgICAgICAvLyBBY2NvdW50IGRhdGEgY2hhbmdlIHdpbGwgdXBkYXRlIGxvY2Fsc3RvcmFnZSwgY2xpZW50LCBldGMgdGhyb3VnaCBkaXNwYXRjaGVyXG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5zZXRBY2NvdW50RGF0YShcIm0uaWRlbnRpdHlfc2VydmVyXCIsIHtcbiAgICAgICAgICAgIGJhc2VfdXJsOiBmdWxsVXJsLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgICAgY3VycmVudENsaWVudElkU2VydmVyOiBmdWxsVXJsLFxuICAgICAgICAgICAgaWRTZXJ2ZXI6ICcnLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjaGVja0lkU2VydmVyID0gYXN5bmMgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCB7IGlkU2VydmVyLCBjdXJyZW50Q2xpZW50SWRTZXJ2ZXIgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGJ1c3k6IHRydWUsIGNoZWNraW5nOiB0cnVlLCBlcnJvcjogbnVsbCB9KTtcblxuICAgICAgICBjb25zdCBmdWxsVXJsID0gdW5hYmJyZXZpYXRlVXJsKGlkU2VydmVyKTtcblxuICAgICAgICBsZXQgZXJyU3RyID0gYXdhaXQgY2hlY2tJZGVudGl0eVNlcnZlclVybChmdWxsVXJsKTtcbiAgICAgICAgaWYgKCFlcnJTdHIpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGNoZWNraW5nOiBmYWxzZSB9KTsgLy8gY2xlYXIgdG9vbHRpcFxuXG4gICAgICAgICAgICAgICAgLy8gVGVzdCB0aGUgaWRlbnRpdHkgc2VydmVyIGJ5IHRyeWluZyB0byByZWdpc3RlciB3aXRoIGl0LiBUaGlzXG4gICAgICAgICAgICAgICAgLy8gbWF5IHJlc3VsdCBpbiBhIHRlcm1zIG9mIHNlcnZpY2UgcHJvbXB0LlxuICAgICAgICAgICAgICAgIGNvbnN0IGF1dGhDbGllbnQgPSBuZXcgSWRlbnRpdHlBdXRoQ2xpZW50KGZ1bGxVcmwpO1xuICAgICAgICAgICAgICAgIGF3YWl0IGF1dGhDbGllbnQuZ2V0QWNjZXNzVG9rZW4oKTtcblxuICAgICAgICAgICAgICAgIGxldCBzYXZlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIC8vIERvdWJsZSBjaGVjayB0aGF0IHRoZSBpZGVudGl0eSBzZXJ2ZXIgZXZlbiBoYXMgdGVybXMgb2Ygc2VydmljZS5cbiAgICAgICAgICAgICAgICBjb25zdCBoYXNUZXJtcyA9IGF3YWl0IGRvZXNJZGVudGl0eVNlcnZlckhhdmVUZXJtcyhmdWxsVXJsKTtcbiAgICAgICAgICAgICAgICBpZiAoIWhhc1Rlcm1zKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IFtjb25maXJtZWRdID0gYXdhaXQgdGhpcy5zaG93Tm9UZXJtc1dhcm5pbmcoZnVsbFVybCk7XG4gICAgICAgICAgICAgICAgICAgIHNhdmUgPSBjb25maXJtZWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU2hvdyBhIGdlbmVyYWwgd2FybmluZywgcG9zc2libHkgd2l0aCBkZXRhaWxzIGFib3V0IGFueSBib3VuZFxuICAgICAgICAgICAgICAgIC8vIDNQSURzIHRoYXQgd291bGQgYmUgbGVmdCBiZWhpbmQuXG4gICAgICAgICAgICAgICAgaWYgKHNhdmUgJiYgY3VycmVudENsaWVudElkU2VydmVyICYmIGZ1bGxVcmwgIT09IGN1cnJlbnRDbGllbnRJZFNlcnZlcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBbY29uZmlybWVkXSA9IGF3YWl0IHRoaXMuc2hvd1NlcnZlckNoYW5nZVdhcm5pbmcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IF90KFwiQ2hhbmdlIGlkZW50aXR5IHNlcnZlclwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuYm91bmRNZXNzYWdlOiBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkRpc2Nvbm5lY3QgZnJvbSB0aGUgaWRlbnRpdHkgc2VydmVyIDxjdXJyZW50IC8+IGFuZCBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb25uZWN0IHRvIDxuZXcgLz4gaW5zdGVhZD9cIiwge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50OiBzdWIgPT4gPGI+eyBhYmJyZXZpYXRlVXJsKGN1cnJlbnRDbGllbnRJZFNlcnZlcikgfTwvYj4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldzogc3ViID0+IDxiPnsgYWJicmV2aWF0ZVVybChpZFNlcnZlcikgfTwvYj4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b246IF90KFwiQ29udGludWVcIiksXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzYXZlID0gY29uZmlybWVkO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzYXZlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZUlkU2VydmVyKGZ1bGxVcmwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgZXJyU3RyID0gX3QoXCJUZXJtcyBvZiBzZXJ2aWNlIG5vdCBhY2NlcHRlZCBvciB0aGUgaWRlbnRpdHkgc2VydmVyIGlzIGludmFsaWQuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgICBjaGVja2luZzogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogZXJyU3RyLFxuICAgICAgICAgICAgY3VycmVudENsaWVudElkU2VydmVyOiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0SWRlbnRpdHlTZXJ2ZXJVcmwoKSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgc2hvd05vVGVybXNXYXJuaW5nKGZ1bGxVcmwpIHtcbiAgICAgICAgY29uc3QgeyBmaW5pc2hlZCB9ID0gTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnTm8gVGVybXMgV2FybmluZycsICcnLCBRdWVzdGlvbkRpYWxvZywge1xuICAgICAgICAgICAgdGl0bGU6IF90KFwiSWRlbnRpdHkgc2VydmVyIGhhcyBubyB0ZXJtcyBvZiBzZXJ2aWNlXCIpLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IChcbiAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJ3YXJuaW5nXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiVGhlIGlkZW50aXR5IHNlcnZlciB5b3UgaGF2ZSBjaG9zZW4gZG9lcyBub3QgaGF2ZSBhbnkgdGVybXMgb2Ygc2VydmljZS5cIikgfVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7eyBfdChcIk9ubHkgY29udGludWUgaWYgeW91IHRydXN0IHRoZSBvd25lciBvZiB0aGUgc2VydmVyLlwiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBidXR0b246IF90KFwiQ29udGludWVcIiksXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmluaXNoZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkRpc2Nvbm5lY3RDbGlja2VkID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZGlzY29ubmVjdEJ1c3k6IHRydWUgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBbY29uZmlybWVkXSA9IGF3YWl0IHRoaXMuc2hvd1NlcnZlckNoYW5nZVdhcm5pbmcoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBfdChcIkRpc2Nvbm5lY3QgaWRlbnRpdHkgc2VydmVyXCIpLFxuICAgICAgICAgICAgICAgIHVuYm91bmRNZXNzYWdlOiBfdChcbiAgICAgICAgICAgICAgICAgICAgXCJEaXNjb25uZWN0IGZyb20gdGhlIGlkZW50aXR5IHNlcnZlciA8aWRzZXJ2ZXIgLz4/XCIsIHt9LFxuICAgICAgICAgICAgICAgICAgICB7IGlkc2VydmVyOiBzdWIgPT4gPGI+eyBhYmJyZXZpYXRlVXJsKHRoaXMuc3RhdGUuY3VycmVudENsaWVudElkU2VydmVyKSB9PC9iPiB9LFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgYnV0dG9uOiBfdChcIkRpc2Nvbm5lY3RcIiksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChjb25maXJtZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3RJZFNlcnZlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGRpc2Nvbm5lY3RCdXN5OiBmYWxzZSB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGFzeW5jIHNob3dTZXJ2ZXJDaGFuZ2VXYXJuaW5nKHsgdGl0bGUsIHVuYm91bmRNZXNzYWdlLCBidXR0b24gfSkge1xuICAgICAgICBjb25zdCB7IGN1cnJlbnRDbGllbnRJZFNlcnZlciB9ID0gdGhpcy5zdGF0ZTtcblxuICAgICAgICBsZXQgdGhyZWVwaWRzID0gW107XG4gICAgICAgIGxldCBjdXJyZW50U2VydmVyUmVhY2hhYmxlID0gdHJ1ZTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRocmVlcGlkcyA9IGF3YWl0IHRpbWVvdXQoXG4gICAgICAgICAgICAgICAgZ2V0VGhyZWVwaWRzV2l0aEJpbmRTdGF0dXMoTWF0cml4Q2xpZW50UGVnLmdldCgpKSxcbiAgICAgICAgICAgICAgICBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJUaW1lb3V0IGF0dGVtcHRpbmcgdG8gcmVhY2ggaWRlbnRpdHkgc2VydmVyXCIpKSxcbiAgICAgICAgICAgICAgICBSRUFDSEFCSUxJVFlfVElNRU9VVCxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGN1cnJlbnRTZXJ2ZXJSZWFjaGFibGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICAgICAgICAgIGBVbmFibGUgdG8gcmVhY2ggaWRlbnRpdHkgc2VydmVyIGF0ICR7Y3VycmVudENsaWVudElkU2VydmVyfSB0byBjaGVjayBgICtcbiAgICAgICAgICAgICAgICBgZm9yIDNQSURzIGR1cmluZyBJUyBjaGFuZ2UgZmxvd2AsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYm91bmRUaHJlZXBpZHMgPSB0aHJlZXBpZHMuZmlsdGVyKHRwID0+IHRwLmJvdW5kKTtcbiAgICAgICAgbGV0IG1lc3NhZ2U7XG4gICAgICAgIGxldCBkYW5nZXIgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgbWVzc2FnZUVsZW1lbnRzID0ge1xuICAgICAgICAgICAgaWRzZXJ2ZXI6IHN1YiA9PiA8Yj57IGFiYnJldmlhdGVVcmwoY3VycmVudENsaWVudElkU2VydmVyKSB9PC9iPixcbiAgICAgICAgICAgIGI6IHN1YiA9PiA8Yj57IHN1YiB9PC9iPixcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKCFjdXJyZW50U2VydmVyUmVhY2hhYmxlKSB7XG4gICAgICAgICAgICBtZXNzYWdlID0gPGRpdj5cbiAgICAgICAgICAgICAgICA8cD57IF90KFxuICAgICAgICAgICAgICAgICAgICBcIllvdSBzaG91bGQgPGI+cmVtb3ZlIHlvdXIgcGVyc29uYWwgZGF0YTwvYj4gZnJvbSBpZGVudGl0eSBzZXJ2ZXIgXCIgK1xuICAgICAgICAgICAgICAgICAgICBcIjxpZHNlcnZlciAvPiBiZWZvcmUgZGlzY29ubmVjdGluZy4gVW5mb3J0dW5hdGVseSwgaWRlbnRpdHkgc2VydmVyIFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCI8aWRzZXJ2ZXIgLz4gaXMgY3VycmVudGx5IG9mZmxpbmUgb3IgY2Fubm90IGJlIHJlYWNoZWQuXCIsXG4gICAgICAgICAgICAgICAgICAgIHt9LCBtZXNzYWdlRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXCJZb3Ugc2hvdWxkOlwiKSB9PC9wPlxuICAgICAgICAgICAgICAgIDx1bD5cbiAgICAgICAgICAgICAgICAgICAgPGxpPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNoZWNrIHlvdXIgYnJvd3NlciBwbHVnaW5zIGZvciBhbnl0aGluZyB0aGF0IG1pZ2h0IGJsb2NrIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGhlIGlkZW50aXR5IHNlcnZlciAoc3VjaCBhcyBQcml2YWN5IEJhZGdlcilcIixcbiAgICAgICAgICAgICAgICAgICAgKSB9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgPGxpPnsgX3QoXCJjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9ycyBvZiBpZGVudGl0eSBzZXJ2ZXIgPGlkc2VydmVyIC8+XCIsIHt9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZHNlcnZlcjogbWVzc2FnZUVsZW1lbnRzLmlkc2VydmVyLFxuICAgICAgICAgICAgICAgICAgICB9KSB9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgPGxpPnsgX3QoXCJ3YWl0IGFuZCB0cnkgYWdhaW4gbGF0ZXJcIikgfTwvbGk+XG4gICAgICAgICAgICAgICAgPC91bD5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgICAgIGRhbmdlciA9IHRydWU7XG4gICAgICAgICAgICBidXR0b24gPSBfdChcIkRpc2Nvbm5lY3QgYW55d2F5XCIpO1xuICAgICAgICB9IGVsc2UgaWYgKGJvdW5kVGhyZWVwaWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgbWVzc2FnZSA9IDxkaXY+XG4gICAgICAgICAgICAgICAgPHA+eyBfdChcbiAgICAgICAgICAgICAgICAgICAgXCJZb3UgYXJlIHN0aWxsIDxiPnNoYXJpbmcgeW91ciBwZXJzb25hbCBkYXRhPC9iPiBvbiB0aGUgaWRlbnRpdHkgXCIgK1xuICAgICAgICAgICAgICAgICAgICBcInNlcnZlciA8aWRzZXJ2ZXIgLz4uXCIsIHt9LCBtZXNzYWdlRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiV2UgcmVjb21tZW5kIHRoYXQgeW91IHJlbW92ZSB5b3VyIGVtYWlsIGFkZHJlc3NlcyBhbmQgcGhvbmUgbnVtYmVycyBcIiArXG4gICAgICAgICAgICAgICAgICAgIFwiZnJvbSB0aGUgaWRlbnRpdHkgc2VydmVyIGJlZm9yZSBkaXNjb25uZWN0aW5nLlwiLFxuICAgICAgICAgICAgICAgICkgfTwvcD5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgICAgIGRhbmdlciA9IHRydWU7XG4gICAgICAgICAgICBidXR0b24gPSBfdChcIkRpc2Nvbm5lY3QgYW55d2F5XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWVzc2FnZSA9IHVuYm91bmRNZXNzYWdlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBmaW5pc2hlZCB9ID0gTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnSWRlbnRpdHkgU2VydmVyIEJvdW5kIFdhcm5pbmcnLCAnJywgUXVlc3Rpb25EaWFsb2csIHtcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IG1lc3NhZ2UsXG4gICAgICAgICAgICBidXR0b24sXG4gICAgICAgICAgICBjYW5jZWxCdXR0b246IF90KFwiR28gYmFja1wiKSxcbiAgICAgICAgICAgIGRhbmdlcixcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmaW5pc2hlZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRpc2Nvbm5lY3RJZFNlcnZlciA9ICgpID0+IHtcbiAgICAgICAgLy8gQWNjb3VudCBkYXRhIGNoYW5nZSB3aWxsIHVwZGF0ZSBsb2NhbHN0b3JhZ2UsIGNsaWVudCwgZXRjIHRocm91Z2ggZGlzcGF0Y2hlclxuICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuc2V0QWNjb3VudERhdGEoXCJtLmlkZW50aXR5X3NlcnZlclwiLCB7XG4gICAgICAgICAgICBiYXNlX3VybDogbnVsbCwgLy8gY2xlYXJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IG5ld0ZpZWxkVmFsID0gJyc7XG4gICAgICAgIGlmIChnZXREZWZhdWx0SWRlbnRpdHlTZXJ2ZXJVcmwoKSkge1xuICAgICAgICAgICAgLy8gUHJlcG9wdWxhdGUgdGhlIGNsaWVudCdzIGRlZmF1bHQgc28gdGhlIHVzZXIgYXQgbGVhc3QgaGFzIHNvbWUgaWRlYSBvZlxuICAgICAgICAgICAgLy8gYSB2YWxpZCB2YWx1ZSB0aGV5IG1pZ2h0IGVudGVyXG4gICAgICAgICAgICBuZXdGaWVsZFZhbCA9IGFiYnJldmlhdGVVcmwoZ2V0RGVmYXVsdElkZW50aXR5U2VydmVyVXJsKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgICAgY3VycmVudENsaWVudElkU2VydmVyOiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0SWRlbnRpdHlTZXJ2ZXJVcmwoKSxcbiAgICAgICAgICAgIGlkU2VydmVyOiBuZXdGaWVsZFZhbCxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgaWRTZXJ2ZXJVcmwgPSB0aGlzLnN0YXRlLmN1cnJlbnRDbGllbnRJZFNlcnZlcjtcbiAgICAgICAgbGV0IHNlY3Rpb25UaXRsZTtcbiAgICAgICAgbGV0IGJvZHlUZXh0O1xuICAgICAgICBpZiAoaWRTZXJ2ZXJVcmwpIHtcbiAgICAgICAgICAgIHNlY3Rpb25UaXRsZSA9IF90KFwiSWRlbnRpdHkgc2VydmVyICglKHNlcnZlcilzKVwiLCB7IHNlcnZlcjogYWJicmV2aWF0ZVVybChpZFNlcnZlclVybCkgfSk7XG4gICAgICAgICAgICBib2R5VGV4dCA9IF90KFxuICAgICAgICAgICAgICAgIFwiWW91IGFyZSBjdXJyZW50bHkgdXNpbmcgPHNlcnZlcj48L3NlcnZlcj4gdG8gZGlzY292ZXIgYW5kIGJlIGRpc2NvdmVyYWJsZSBieSBcIiArXG4gICAgICAgICAgICAgICAgXCJleGlzdGluZyBjb250YWN0cyB5b3Uga25vdy4gWW91IGNhbiBjaGFuZ2UgeW91ciBpZGVudGl0eSBzZXJ2ZXIgYmVsb3cuXCIsXG4gICAgICAgICAgICAgICAge30sXG4gICAgICAgICAgICAgICAgeyBzZXJ2ZXI6IHN1YiA9PiA8Yj57IGFiYnJldmlhdGVVcmwoaWRTZXJ2ZXJVcmwpIH08L2I+IH0sXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMubWlzc2luZ1Rlcm1zKSB7XG4gICAgICAgICAgICAgICAgYm9keVRleHQgPSBfdChcbiAgICAgICAgICAgICAgICAgICAgXCJJZiB5b3UgZG9uJ3Qgd2FudCB0byB1c2UgPHNlcnZlciAvPiB0byBkaXNjb3ZlciBhbmQgYmUgZGlzY292ZXJhYmxlIGJ5IGV4aXN0aW5nIFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJjb250YWN0cyB5b3Uga25vdywgZW50ZXIgYW5vdGhlciBpZGVudGl0eSBzZXJ2ZXIgYmVsb3cuXCIsXG4gICAgICAgICAgICAgICAgICAgIHt9LCB7IHNlcnZlcjogc3ViID0+IDxiPnsgYWJicmV2aWF0ZVVybChpZFNlcnZlclVybCkgfTwvYj4gfSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VjdGlvblRpdGxlID0gX3QoXCJJZGVudGl0eSBzZXJ2ZXJcIik7XG4gICAgICAgICAgICBib2R5VGV4dCA9IF90KFxuICAgICAgICAgICAgICAgIFwiWW91IGFyZSBub3QgY3VycmVudGx5IHVzaW5nIGFuIGlkZW50aXR5IHNlcnZlci4gXCIgK1xuICAgICAgICAgICAgICAgIFwiVG8gZGlzY292ZXIgYW5kIGJlIGRpc2NvdmVyYWJsZSBieSBleGlzdGluZyBjb250YWN0cyB5b3Uga25vdywgXCIgK1xuICAgICAgICAgICAgICAgIFwiYWRkIG9uZSBiZWxvdy5cIixcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgZGlzY29TZWN0aW9uO1xuICAgICAgICBpZiAoaWRTZXJ2ZXJVcmwpIHtcbiAgICAgICAgICAgIGxldCBkaXNjb0J1dHRvbkNvbnRlbnQ6IFJlYWN0LlJlYWN0Tm9kZSA9IF90KFwiRGlzY29ubmVjdFwiKTtcbiAgICAgICAgICAgIGxldCBkaXNjb0JvZHlUZXh0ID0gX3QoXG4gICAgICAgICAgICAgICAgXCJEaXNjb25uZWN0aW5nIGZyb20geW91ciBpZGVudGl0eSBzZXJ2ZXIgd2lsbCBtZWFuIHlvdSBcIiArXG4gICAgICAgICAgICAgICAgXCJ3b24ndCBiZSBkaXNjb3ZlcmFibGUgYnkgb3RoZXIgdXNlcnMgYW5kIHlvdSB3b24ndCBiZSBcIiArXG4gICAgICAgICAgICAgICAgXCJhYmxlIHRvIGludml0ZSBvdGhlcnMgYnkgZW1haWwgb3IgcGhvbmUuXCIsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMubWlzc2luZ1Rlcm1zKSB7XG4gICAgICAgICAgICAgICAgZGlzY29Cb2R5VGV4dCA9IF90KFxuICAgICAgICAgICAgICAgICAgICBcIlVzaW5nIGFuIGlkZW50aXR5IHNlcnZlciBpcyBvcHRpb25hbC4gSWYgeW91IGNob29zZSBub3QgdG8gXCIgK1xuICAgICAgICAgICAgICAgICAgICBcInVzZSBhbiBpZGVudGl0eSBzZXJ2ZXIsIHlvdSB3b24ndCBiZSBkaXNjb3ZlcmFibGUgYnkgb3RoZXIgdXNlcnMgXCIgK1xuICAgICAgICAgICAgICAgICAgICBcImFuZCB5b3Ugd29uJ3QgYmUgYWJsZSB0byBpbnZpdGUgb3RoZXJzIGJ5IGVtYWlsIG9yIHBob25lLlwiLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgZGlzY29CdXR0b25Db250ZW50ID0gX3QoXCJEbyBub3QgdXNlIGFuIGlkZW50aXR5IHNlcnZlclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmRpc2Nvbm5lY3RCdXN5KSB7XG4gICAgICAgICAgICAgICAgZGlzY29CdXR0b25Db250ZW50ID0gPElubGluZVNwaW5uZXIgLz47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkaXNjb1NlY3Rpb24gPSA8ZGl2PlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YnNlY3Rpb25UZXh0XCI+eyBkaXNjb0JvZHlUZXh0IH08L3NwYW4+XG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17dGhpcy5vbkRpc2Nvbm5lY3RDbGlja2VkfSBraW5kPVwiZGFuZ2VyX3NtXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgZGlzY29CdXR0b25Db250ZW50IH1cbiAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGZvcm0gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc2VjdGlvbiBteF9TZXRJZFNlcnZlclwiIG9uU3VibWl0PXt0aGlzLmNoZWNrSWRTZXJ2ZXJ9PlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YmhlYWRpbmdcIj5cbiAgICAgICAgICAgICAgICAgICAgeyBzZWN0aW9uVGl0bGUgfVxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zdWJzZWN0aW9uVGV4dFwiPlxuICAgICAgICAgICAgICAgICAgICB7IGJvZHlUZXh0IH1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdChcIkVudGVyIGEgbmV3IGlkZW50aXR5IHNlcnZlclwiKX1cbiAgICAgICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj17dGhpcy5zdGF0ZS5kZWZhdWx0SWRTZXJ2ZXJ9XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmlkU2VydmVyfVxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbklkZW50aXR5U2VydmVyQ2hhbmdlZH1cbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcENvbnRlbnQ9e3RoaXMuZ2V0VG9vbHRpcCgpfVxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwQ2xhc3NOYW1lPVwibXhfU2V0SWRTZXJ2ZXJfdG9vbHRpcFwiXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLmJ1c3l9XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlVmFsaWRpdHk9e3RoaXMuc3RhdGUuZXJyb3IgPyBmYWxzZSA6IG51bGx9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICB0eXBlPVwic3VibWl0XCJcbiAgICAgICAgICAgICAgICAgICAga2luZD1cInByaW1hcnlfc21cIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLmNoZWNrSWRTZXJ2ZXJ9XG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXshdGhpcy5pZFNlcnZlckNoYW5nZUVuYWJsZWQoKX1cbiAgICAgICAgICAgICAgICA+eyBfdChcIkNoYW5nZVwiKSB9PC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgIHsgZGlzY29TZWN0aW9uIH1cbiAgICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=