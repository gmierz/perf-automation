"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../../../languageHandler");

var _SdkConfig = _interopRequireDefault(require("../../../../../SdkConfig"));

var _Mjolnir = require("../../../../../mjolnir/Mjolnir");

var _BanList = require("../../../../../mjolnir/BanList");

var _Modal = _interopRequireDefault(require("../../../../../Modal"));

var _MatrixClientPeg = require("../../../../../MatrixClientPeg");

var _replaceableComponent = require("../../../../../utils/replaceableComponent");

var _ErrorDialog = _interopRequireDefault(require("../../../dialogs/ErrorDialog"));

var _QuestionDialog = _interopRequireDefault(require("../../../dialogs/QuestionDialog"));

var _AccessibleButton = _interopRequireDefault(require("../../../elements/AccessibleButton"));

var _Field = _interopRequireDefault(require("../../../elements/Field"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

let MjolnirUserSettingsTab = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.tabs.user.MjolnirUserSettingsTab"), _dec(_class = class MjolnirUserSettingsTab extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onPersonalRuleChanged", e => {
      this.setState({
        newPersonalRule: e.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onNewListChanged", e => {
      this.setState({
        newList: e.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onAddPersonalRule", async e => {
      e.preventDefault();
      e.stopPropagation();
      let kind = _BanList.RULE_SERVER;

      if (this.state.newPersonalRule.startsWith("@")) {
        kind = _BanList.RULE_USER;
      }

      this.setState({
        busy: true
      });

      try {
        const list = await _Mjolnir.Mjolnir.sharedInstance().getOrCreatePersonalList();
        await list.banEntity(kind, this.state.newPersonalRule, (0, _languageHandler._t)("Ignored/Blocked"));
        this.setState({
          newPersonalRule: ""
        }); // this will also cause the new rule to be rendered
      } catch (e) {
        _logger.logger.error(e);

        _Modal.default.createTrackedDialog('Failed to add Mjolnir rule', '', _ErrorDialog.default, {
          title: (0, _languageHandler._t)('Error adding ignored user/server'),
          description: (0, _languageHandler._t)('Something went wrong. Please try again or view your console for hints.')
        });
      } finally {
        this.setState({
          busy: false
        });
      }
    });
    (0, _defineProperty2.default)(this, "onSubscribeList", async e => {
      e.preventDefault();
      e.stopPropagation();
      this.setState({
        busy: true
      });

      try {
        const room = await _MatrixClientPeg.MatrixClientPeg.get().joinRoom(this.state.newList);
        await _Mjolnir.Mjolnir.sharedInstance().subscribeToList(room.roomId);
        this.setState({
          newList: ""
        }); // this will also cause the new rule to be rendered
      } catch (e) {
        _logger.logger.error(e);

        _Modal.default.createTrackedDialog('Failed to subscribe to Mjolnir list', '', _ErrorDialog.default, {
          title: (0, _languageHandler._t)('Error subscribing to list'),
          description: (0, _languageHandler._t)('Please verify the room ID or address and try again.')
        });
      } finally {
        this.setState({
          busy: false
        });
      }
    });
    this.state = {
      busy: false,
      newPersonalRule: "",
      newList: ""
    };
  }

  async removePersonalRule(rule) {
    this.setState({
      busy: true
    });

    try {
      const list = _Mjolnir.Mjolnir.sharedInstance().getPersonalList();

      await list.unbanEntity(rule.kind, rule.entity);
    } catch (e) {
      _logger.logger.error(e);

      _Modal.default.createTrackedDialog('Failed to remove Mjolnir rule', '', _ErrorDialog.default, {
        title: (0, _languageHandler._t)('Error removing ignored user/server'),
        description: (0, _languageHandler._t)('Something went wrong. Please try again or view your console for hints.')
      });
    } finally {
      this.setState({
        busy: false
      });
    }
  }

  async unsubscribeFromList(list) {
    this.setState({
      busy: true
    });

    try {
      await _Mjolnir.Mjolnir.sharedInstance().unsubscribeFromList(list.roomId);
      await _MatrixClientPeg.MatrixClientPeg.get().leave(list.roomId);
    } catch (e) {
      _logger.logger.error(e);

      _Modal.default.createTrackedDialog('Failed to unsubscribe from Mjolnir list', '', _ErrorDialog.default, {
        title: (0, _languageHandler._t)('Error unsubscribing from list'),
        description: (0, _languageHandler._t)('Please try again or view your console for hints.')
      });
    } finally {
      this.setState({
        busy: false
      });
    }
  }

  viewListRules(list) {
    const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(list.roomId);

    const name = room ? room.name : list.roomId;

    const renderRules = rules => {
      if (rules.length === 0) return /*#__PURE__*/_react.default.createElement("i", null, (0, _languageHandler._t)("None"));
      const tiles = [];

      for (const rule of rules) {
        tiles.push( /*#__PURE__*/_react.default.createElement("li", {
          key: rule.kind + rule.entity
        }, /*#__PURE__*/_react.default.createElement("code", null, rule.entity)));
      }

      return /*#__PURE__*/_react.default.createElement("ul", null, tiles);
    };

    _Modal.default.createTrackedDialog('View Mjolnir list rules', '', _QuestionDialog.default, {
      title: (0, _languageHandler._t)("Ban list rules - %(roomName)s", {
        roomName: name
      }),
      description: /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Server rules")), renderRules(list.serverRules), /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("User rules")), renderRules(list.userRules)),
      button: (0, _languageHandler._t)("Close"),
      hasCancelButton: false
    });
  }

  renderPersonalBanListRules() {
    const list = _Mjolnir.Mjolnir.sharedInstance().getPersonalList();

    const rules = list ? [...list.userRules, ...list.serverRules] : [];
    if (!list || rules.length <= 0) return /*#__PURE__*/_react.default.createElement("i", null, (0, _languageHandler._t)("You have not ignored anyone."));
    const tiles = [];

    for (const rule of rules) {
      tiles.push( /*#__PURE__*/_react.default.createElement("li", {
        key: rule.entity,
        className: "mx_MjolnirUserSettingsTab_listItem"
      }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        kind: "danger_sm",
        onClick: () => this.removePersonalRule(rule),
        disabled: this.state.busy
      }, (0, _languageHandler._t)("Remove")), "\xA0", /*#__PURE__*/_react.default.createElement("code", null, rule.entity)));
    }

    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You are currently ignoring:")), /*#__PURE__*/_react.default.createElement("ul", null, tiles));
  }

  renderSubscribedBanLists() {
    const personalList = _Mjolnir.Mjolnir.sharedInstance().getPersonalList();

    const lists = _Mjolnir.Mjolnir.sharedInstance().lists.filter(b => {
      return personalList ? personalList.roomId !== b.roomId : true;
    });

    if (!lists || lists.length <= 0) return /*#__PURE__*/_react.default.createElement("i", null, (0, _languageHandler._t)("You are not subscribed to any lists"));
    const tiles = [];

    for (const list of lists) {
      const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(list.roomId);

      const name = room ? /*#__PURE__*/_react.default.createElement("span", null, room.name, " (", /*#__PURE__*/_react.default.createElement("code", null, list.roomId), ")") : /*#__PURE__*/_react.default.createElement("code", null, "list.roomId");
      tiles.push( /*#__PURE__*/_react.default.createElement("li", {
        key: list.roomId,
        className: "mx_MjolnirUserSettingsTab_listItem"
      }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        kind: "danger_sm",
        onClick: () => this.unsubscribeFromList(list),
        disabled: this.state.busy
      }, (0, _languageHandler._t)("Unsubscribe")), "\xA0", /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        kind: "primary_sm",
        onClick: () => this.viewListRules(list),
        disabled: this.state.busy
      }, (0, _languageHandler._t)("View rules")), "\xA0", name));
    }

    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You are currently subscribed to:")), /*#__PURE__*/_react.default.createElement("ul", null, tiles));
  }

  render() {
    const brand = _SdkConfig.default.get().brand;

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab mx_MjolnirUserSettingsTab"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Ignored users")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "warning"
    }, (0, _languageHandler._t)("âš  These settings are meant for advanced users.")), /*#__PURE__*/_react.default.createElement("br", null), /*#__PURE__*/_react.default.createElement("br", null), (0, _languageHandler._t)("Add users and servers you want to ignore here. Use asterisks " + "to have %(brand)s match any characters. For example, <code>@bot:*</code> " + "would ignore all users that have the name 'bot' on any server.", {
      brand
    }, {
      code: s => /*#__PURE__*/_react.default.createElement("code", null, s)
    }), /*#__PURE__*/_react.default.createElement("br", null), /*#__PURE__*/_react.default.createElement("br", null), (0, _languageHandler._t)("Ignoring people is done through ban lists which contain rules for " + "who to ban. Subscribing to a ban list means the users/servers blocked by " + "that list will be hidden from you."))), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Personal ban list")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_subsectionText"
    }, (0, _languageHandler._t)("Your personal ban list holds all the users/servers you personally don't " + "want to see messages from. After ignoring your first user/server, a new room " + "will show up in your room list named 'My Ban List' - stay in this room to keep " + "the ban list in effect.")), /*#__PURE__*/_react.default.createElement("div", null, this.renderPersonalBanListRules()), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onAddPersonalRule,
      autoComplete: "off"
    }, /*#__PURE__*/_react.default.createElement(_Field.default, {
      type: "text",
      label: (0, _languageHandler._t)("Server or user ID to ignore"),
      placeholder: (0, _languageHandler._t)("eg: @bot:* or example.org"),
      value: this.state.newPersonalRule,
      onChange: this.onPersonalRuleChanged
    }), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      type: "submit",
      kind: "primary",
      onClick: this.onAddPersonalRule,
      disabled: this.state.busy
    }, (0, _languageHandler._t)("Ignore"))))), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Subscribed lists")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_subsectionText"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "warning"
    }, (0, _languageHandler._t)("Subscribing to a ban list will cause you to join it!")), "\xA0", /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("If this isn't what you want, please use a different tool to ignore users."))), /*#__PURE__*/_react.default.createElement("div", null, this.renderSubscribedBanLists()), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onSubscribeList,
      autoComplete: "off"
    }, /*#__PURE__*/_react.default.createElement(_Field.default, {
      type: "text",
      label: (0, _languageHandler._t)("Room ID or address of ban list"),
      value: this.state.newList,
      onChange: this.onNewListChanged
    }), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      type: "submit",
      kind: "primary",
      onClick: this.onSubscribeList,
      disabled: this.state.busy
    }, (0, _languageHandler._t)("Subscribe"))))));
  }

}) || _class);
exports.default = MjolnirUserSettingsTab;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL3RhYnMvdXNlci9Nam9sbmlyVXNlclNldHRpbmdzVGFiLnRzeCJdLCJuYW1lcyI6WyJNam9sbmlyVXNlclNldHRpbmdzVGFiIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiZSIsInNldFN0YXRlIiwibmV3UGVyc29uYWxSdWxlIiwidGFyZ2V0IiwidmFsdWUiLCJuZXdMaXN0IiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJraW5kIiwiUlVMRV9TRVJWRVIiLCJzdGF0ZSIsInN0YXJ0c1dpdGgiLCJSVUxFX1VTRVIiLCJidXN5IiwibGlzdCIsIk1qb2xuaXIiLCJzaGFyZWRJbnN0YW5jZSIsImdldE9yQ3JlYXRlUGVyc29uYWxMaXN0IiwiYmFuRW50aXR5IiwibG9nZ2VyIiwiZXJyb3IiLCJNb2RhbCIsImNyZWF0ZVRyYWNrZWREaWFsb2ciLCJFcnJvckRpYWxvZyIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJyb29tIiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0Iiwiam9pblJvb20iLCJzdWJzY3JpYmVUb0xpc3QiLCJyb29tSWQiLCJyZW1vdmVQZXJzb25hbFJ1bGUiLCJydWxlIiwiZ2V0UGVyc29uYWxMaXN0IiwidW5iYW5FbnRpdHkiLCJlbnRpdHkiLCJ1bnN1YnNjcmliZUZyb21MaXN0IiwibGVhdmUiLCJ2aWV3TGlzdFJ1bGVzIiwiZ2V0Um9vbSIsIm5hbWUiLCJyZW5kZXJSdWxlcyIsInJ1bGVzIiwibGVuZ3RoIiwidGlsZXMiLCJwdXNoIiwiUXVlc3Rpb25EaWFsb2ciLCJyb29tTmFtZSIsInNlcnZlclJ1bGVzIiwidXNlclJ1bGVzIiwiYnV0dG9uIiwiaGFzQ2FuY2VsQnV0dG9uIiwicmVuZGVyUGVyc29uYWxCYW5MaXN0UnVsZXMiLCJyZW5kZXJTdWJzY3JpYmVkQmFuTGlzdHMiLCJwZXJzb25hbExpc3QiLCJsaXN0cyIsImZpbHRlciIsImIiLCJyZW5kZXIiLCJicmFuZCIsIlNka0NvbmZpZyIsImNvZGUiLCJzIiwib25BZGRQZXJzb25hbFJ1bGUiLCJvblBlcnNvbmFsUnVsZUNoYW5nZWQiLCJvblN1YnNjcmliZUxpc3QiLCJvbk5ld0xpc3RDaGFuZ2VkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7OztJQVNxQkEsc0IsV0FEcEIsZ0RBQXFCLGlEQUFyQixDLGdCQUFELE1BQ3FCQSxzQkFEckIsU0FDb0RDLGVBQU1DLFNBRDFELENBQ2dGO0FBQzVFQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBUTtBQUNmLFVBQU1BLEtBQU47QUFEZSxpRUFVY0MsQ0FBRCxJQUFPO0FBQ25DLFdBQUtDLFFBQUwsQ0FBYztBQUFFQyxRQUFBQSxlQUFlLEVBQUVGLENBQUMsQ0FBQ0csTUFBRixDQUFTQztBQUE1QixPQUFkO0FBQ0gsS0Faa0I7QUFBQSw0REFjU0osQ0FBRCxJQUFPO0FBQzlCLFdBQUtDLFFBQUwsQ0FBYztBQUFFSSxRQUFBQSxPQUFPLEVBQUVMLENBQUMsQ0FBQ0csTUFBRixDQUFTQztBQUFwQixPQUFkO0FBQ0gsS0FoQmtCO0FBQUEsNkRBa0JTLE1BQU9KLENBQVAsSUFBYTtBQUNyQ0EsTUFBQUEsQ0FBQyxDQUFDTSxjQUFGO0FBQ0FOLE1BQUFBLENBQUMsQ0FBQ08sZUFBRjtBQUVBLFVBQUlDLElBQUksR0FBR0Msb0JBQVg7O0FBQ0EsVUFBSSxLQUFLQyxLQUFMLENBQVdSLGVBQVgsQ0FBMkJTLFVBQTNCLENBQXNDLEdBQXRDLENBQUosRUFBZ0Q7QUFDNUNILFFBQUFBLElBQUksR0FBR0ksa0JBQVA7QUFDSDs7QUFFRCxXQUFLWCxRQUFMLENBQWM7QUFBRVksUUFBQUEsSUFBSSxFQUFFO0FBQVIsT0FBZDs7QUFDQSxVQUFJO0FBQ0EsY0FBTUMsSUFBSSxHQUFHLE1B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LEVBQUUsS0FBS0QsaUJBSGxCO0FBSUksTUFBQSxRQUFRLEVBQUUsS0FBS3RELEtBQUwsQ0FBV0c7QUFKekIsT0FNTSx5QkFBRyxRQUFILENBTk4sQ0FSSixDQURKLENBYkosQ0FwQkosZUFxREk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLG9CQUNJO0FBQU0sTUFBQSxTQUFTLEVBQUM7QUFBaEIsT0FBOEMseUJBQUcsa0JBQUgsQ0FBOUMsQ0FESixlQUVJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSTtBQUFNLE1BQUEsU0FBUyxFQUFDO0FBQWhCLE9BQTRCLHlCQUFHLHNEQUFILENBQTVCLENBREosdUJBR0ksMkNBQVEseUJBQ0osMkVBREksQ0FBUixDQUhKLENBRkosZUFTSSwwQ0FDTSxLQUFLeUMsd0JBQUwsRUFETixDQVRKLGVBWUksdURBQ0k7QUFBTSxNQUFBLFFBQVEsRUFBRSxLQUFLWSxlQUFyQjtBQUFzQyxNQUFBLFlBQVksRUFBQztBQUFuRCxvQkFDSSw2QkFBQyxjQUFEO0FBQ0ksTUFBQSxJQUFJLEVBQUMsTUFEVDtBQUVJLE1BQUEsS0FBSyxFQUFFLHlCQUFHLGdDQUFILENBRlg7QUFHSSxNQUFBLEtBQUssRUFBRSxLQUFLeEQsS0FBTCxDQUFXTCxPQUh0QjtBQUlJLE1BQUEsUUFBUSxFQUFFLEtBQUs4RDtBQUpuQixNQURKLGVBT0ksNkJBQUMseUJBQUQ7QUFDSSxNQUFBLElBQUksRUFBQyxRQURUO0FBRUksTUFBQSxJQUFJLEVBQUMsU0FGVDtBQUdJLE1BQUEsT0FBTyxFQUFFLEtBQUtELGVBSGxCO0FBSUksTUFBQSxRQUFRLEVBQUUsS0FBS3hELEtBQUwsQ0FBV0c7QUFKekIsT0FNTSx5QkFBRyxXQUFILENBTk4sQ0FQSixDQURKLENBWkosQ0FyREosQ0FESjtBQXVGSDs7QUFoUzJFLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTktMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBTZGtDb25maWcgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL1Nka0NvbmZpZ1wiO1xuaW1wb3J0IHsgTWpvbG5pciB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9tam9sbmlyL01qb2xuaXJcIjtcbmltcG9ydCB7IExpc3RSdWxlIH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL21qb2xuaXIvTGlzdFJ1bGVcIjtcbmltcG9ydCB7IEJhbkxpc3QsIFJVTEVfU0VSVkVSLCBSVUxFX1VTRVIgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vbWpvbG5pci9CYW5MaXN0XCI7XG5pbXBvcnQgTW9kYWwgZnJvbSBcIi4uLy4uLy4uLy4uLy4uL01vZGFsXCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IEVycm9yRGlhbG9nIGZyb20gXCIuLi8uLi8uLi9kaWFsb2dzL0Vycm9yRGlhbG9nXCI7XG5pbXBvcnQgUXVlc3Rpb25EaWFsb2cgZnJvbSBcIi4uLy4uLy4uL2RpYWxvZ3MvUXVlc3Rpb25EaWFsb2dcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi8uLi8uLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcIi4uLy4uLy4uL2VsZW1lbnRzL0ZpZWxkXCI7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgYnVzeTogYm9vbGVhbjtcbiAgICBuZXdQZXJzb25hbFJ1bGU6IHN0cmluZztcbiAgICBuZXdMaXN0OiBzdHJpbmc7XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLnNldHRpbmdzLnRhYnMudXNlci5Nam9sbmlyVXNlclNldHRpbmdzVGFiXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNam9sbmlyVXNlclNldHRpbmdzVGFiIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PHt9LCBJU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGJ1c3k6IGZhbHNlLFxuICAgICAgICAgICAgbmV3UGVyc29uYWxSdWxlOiBcIlwiLFxuICAgICAgICAgICAgbmV3TGlzdDogXCJcIixcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uUGVyc29uYWxSdWxlQ2hhbmdlZCA9IChlKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBuZXdQZXJzb25hbFJ1bGU6IGUudGFyZ2V0LnZhbHVlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uTmV3TGlzdENoYW5nZWQgPSAoZSkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbmV3TGlzdDogZS50YXJnZXQudmFsdWUgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25BZGRQZXJzb25hbFJ1bGUgPSBhc3luYyAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgbGV0IGtpbmQgPSBSVUxFX1NFUlZFUjtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUubmV3UGVyc29uYWxSdWxlLnN0YXJ0c1dpdGgoXCJAXCIpKSB7XG4gICAgICAgICAgICBraW5kID0gUlVMRV9VU0VSO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGJ1c3k6IHRydWUgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBsaXN0ID0gYXdhaXQgTWpvbG5pci5zaGFyZWRJbnN0YW5jZSgpLmdldE9yQ3JlYXRlUGVyc29uYWxMaXN0KCk7XG4gICAgICAgICAgICBhd2FpdCBsaXN0LmJhbkVudGl0eShraW5kLCB0aGlzLnN0YXRlLm5ld1BlcnNvbmFsUnVsZSwgX3QoXCJJZ25vcmVkL0Jsb2NrZWRcIikpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG5ld1BlcnNvbmFsUnVsZTogXCJcIiB9KTsgLy8gdGhpcyB3aWxsIGFsc28gY2F1c2UgdGhlIG5ldyBydWxlIHRvIGJlIHJlbmRlcmVkXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlKTtcblxuICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRmFpbGVkIHRvIGFkZCBNam9sbmlyIHJ1bGUnLCAnJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogX3QoJ0Vycm9yIGFkZGluZyBpZ25vcmVkIHVzZXIvc2VydmVyJyksXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KCdTb21ldGhpbmcgd2VudCB3cm9uZy4gUGxlYXNlIHRyeSBhZ2FpbiBvciB2aWV3IHlvdXIgY29uc29sZSBmb3IgaGludHMuJyksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBidXN5OiBmYWxzZSB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU3Vic2NyaWJlTGlzdCA9IGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgYnVzeTogdHJ1ZSB9KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJvb20gPSBhd2FpdCBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuam9pblJvb20odGhpcy5zdGF0ZS5uZXdMaXN0KTtcbiAgICAgICAgICAgIGF3YWl0IE1qb2xuaXIuc2hhcmVkSW5zdGFuY2UoKS5zdWJzY3JpYmVUb0xpc3Qocm9vbS5yb29tSWQpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG5ld0xpc3Q6IFwiXCIgfSk7IC8vIHRoaXMgd2lsbCBhbHNvIGNhdXNlIHRoZSBuZXcgcnVsZSB0byBiZSByZW5kZXJlZFxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZSk7XG5cbiAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0ZhaWxlZCB0byBzdWJzY3JpYmUgdG8gTWpvbG5pciBsaXN0JywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IF90KCdFcnJvciBzdWJzY3JpYmluZyB0byBsaXN0JyksXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KCdQbGVhc2UgdmVyaWZ5IHRoZSByb29tIElEIG9yIGFkZHJlc3MgYW5kIHRyeSBhZ2Fpbi4nKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGJ1c3k6IGZhbHNlIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgYXN5bmMgcmVtb3ZlUGVyc29uYWxSdWxlKHJ1bGU6IExpc3RSdWxlKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBidXN5OiB0cnVlIH0pO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbGlzdCA9IE1qb2xuaXIuc2hhcmVkSW5zdGFuY2UoKS5nZXRQZXJzb25hbExpc3QoKTtcbiAgICAgICAgICAgIGF3YWl0IGxpc3QudW5iYW5FbnRpdHkocnVsZS5raW5kLCBydWxlLmVudGl0eSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlKTtcblxuICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRmFpbGVkIHRvIHJlbW92ZSBNam9sbmlyIHJ1bGUnLCAnJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogX3QoJ0Vycm9yIHJlbW92aW5nIGlnbm9yZWQgdXNlci9zZXJ2ZXInKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoJ1NvbWV0aGluZyB3ZW50IHdyb25nLiBQbGVhc2UgdHJ5IGFnYWluIG9yIHZpZXcgeW91ciBjb25zb2xlIGZvciBoaW50cy4nKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGJ1c3k6IGZhbHNlIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyB1bnN1YnNjcmliZUZyb21MaXN0KGxpc3Q6IEJhbkxpc3QpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGJ1c3k6IHRydWUgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBNam9sbmlyLnNoYXJlZEluc3RhbmNlKCkudW5zdWJzY3JpYmVGcm9tTGlzdChsaXN0LnJvb21JZCk7XG4gICAgICAgICAgICBhd2FpdCBNYXRyaXhDbGllbnRQZWcuZ2V0KCkubGVhdmUobGlzdC5yb29tSWQpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZSk7XG5cbiAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0ZhaWxlZCB0byB1bnN1YnNjcmliZSBmcm9tIE1qb2xuaXIgbGlzdCcsICcnLCBFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBfdCgnRXJyb3IgdW5zdWJzY3JpYmluZyBmcm9tIGxpc3QnKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoJ1BsZWFzZSB0cnkgYWdhaW4gb3IgdmlldyB5b3VyIGNvbnNvbGUgZm9yIGhpbnRzLicpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgYnVzeTogZmFsc2UgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHZpZXdMaXN0UnVsZXMobGlzdDogQmFuTGlzdCkge1xuICAgICAgICBjb25zdCByb29tID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFJvb20obGlzdC5yb29tSWQpO1xuICAgICAgICBjb25zdCBuYW1lID0gcm9vbSA/IHJvb20ubmFtZSA6IGxpc3Qucm9vbUlkO1xuXG4gICAgICAgIGNvbnN0IHJlbmRlclJ1bGVzID0gKHJ1bGVzOiBMaXN0UnVsZVtdKSA9PiB7XG4gICAgICAgICAgICBpZiAocnVsZXMubGVuZ3RoID09PSAwKSByZXR1cm4gPGk+eyBfdChcIk5vbmVcIikgfTwvaT47XG5cbiAgICAgICAgICAgIGNvbnN0IHRpbGVzID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgcnVsZXMpIHtcbiAgICAgICAgICAgICAgICB0aWxlcy5wdXNoKDxsaSBrZXk9e3J1bGUua2luZCArIHJ1bGUuZW50aXR5fT48Y29kZT57IHJ1bGUuZW50aXR5IH08L2NvZGU+PC9saT4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIDx1bD57IHRpbGVzIH08L3VsPjtcbiAgICAgICAgfTtcblxuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdWaWV3IE1qb2xuaXIgbGlzdCBydWxlcycsICcnLCBRdWVzdGlvbkRpYWxvZywge1xuICAgICAgICAgICAgdGl0bGU6IF90KFwiQmFuIGxpc3QgcnVsZXMgLSAlKHJvb21OYW1lKXNcIiwgeyByb29tTmFtZTogbmFtZSB9KSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAoXG4gICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgPGgzPnsgX3QoXCJTZXJ2ZXIgcnVsZXNcIikgfTwvaDM+XG4gICAgICAgICAgICAgICAgICAgIHsgcmVuZGVyUnVsZXMobGlzdC5zZXJ2ZXJSdWxlcykgfVxuICAgICAgICAgICAgICAgICAgICA8aDM+eyBfdChcIlVzZXIgcnVsZXNcIikgfTwvaDM+XG4gICAgICAgICAgICAgICAgICAgIHsgcmVuZGVyUnVsZXMobGlzdC51c2VyUnVsZXMpIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBidXR0b246IF90KFwiQ2xvc2VcIiksXG4gICAgICAgICAgICBoYXNDYW5jZWxCdXR0b246IGZhbHNlLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclBlcnNvbmFsQmFuTGlzdFJ1bGVzKCkge1xuICAgICAgICBjb25zdCBsaXN0ID0gTWpvbG5pci5zaGFyZWRJbnN0YW5jZSgpLmdldFBlcnNvbmFsTGlzdCgpO1xuICAgICAgICBjb25zdCBydWxlcyA9IGxpc3QgPyBbLi4ubGlzdC51c2VyUnVsZXMsIC4uLmxpc3Quc2VydmVyUnVsZXNdIDogW107XG4gICAgICAgIGlmICghbGlzdCB8fCBydWxlcy5sZW5ndGggPD0gMCkgcmV0dXJuIDxpPnsgX3QoXCJZb3UgaGF2ZSBub3QgaWdub3JlZCBhbnlvbmUuXCIpIH08L2k+O1xuXG4gICAgICAgIGNvbnN0IHRpbGVzID0gW107XG4gICAgICAgIGZvciAoY29uc3QgcnVsZSBvZiBydWxlcykge1xuICAgICAgICAgICAgdGlsZXMucHVzaChcbiAgICAgICAgICAgICAgICA8bGkga2V5PXtydWxlLmVudGl0eX0gY2xhc3NOYW1lPVwibXhfTWpvbG5pclVzZXJTZXR0aW5nc1RhYl9saXN0SXRlbVwiPlxuICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAga2luZD1cImRhbmdlcl9zbVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnJlbW92ZVBlcnNvbmFsUnVsZShydWxlKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLmJ1c3l9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJSZW1vdmVcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+Jm5ic3A7XG4gICAgICAgICAgICAgICAgICAgIDxjb2RlPnsgcnVsZS5lbnRpdHkgfTwvY29kZT5cbiAgICAgICAgICAgICAgICA8L2xpPixcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8cD57IF90KFwiWW91IGFyZSBjdXJyZW50bHkgaWdub3Jpbmc6XCIpIH08L3A+XG4gICAgICAgICAgICAgICAgPHVsPnsgdGlsZXMgfTwvdWw+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclN1YnNjcmliZWRCYW5MaXN0cygpIHtcbiAgICAgICAgY29uc3QgcGVyc29uYWxMaXN0ID0gTWpvbG5pci5zaGFyZWRJbnN0YW5jZSgpLmdldFBlcnNvbmFsTGlzdCgpO1xuICAgICAgICBjb25zdCBsaXN0cyA9IE1qb2xuaXIuc2hhcmVkSW5zdGFuY2UoKS5saXN0cy5maWx0ZXIoYiA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcGVyc29uYWxMaXN0PyBwZXJzb25hbExpc3Qucm9vbUlkICE9PSBiLnJvb21JZCA6IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIWxpc3RzIHx8IGxpc3RzLmxlbmd0aCA8PSAwKSByZXR1cm4gPGk+eyBfdChcIllvdSBhcmUgbm90IHN1YnNjcmliZWQgdG8gYW55IGxpc3RzXCIpIH08L2k+O1xuXG4gICAgICAgIGNvbnN0IHRpbGVzID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbGlzdCBvZiBsaXN0cykge1xuICAgICAgICAgICAgY29uc3Qgcm9vbSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRSb29tKGxpc3Qucm9vbUlkKTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSByb29tID8gPHNwYW4+eyByb29tLm5hbWUgfSAoPGNvZGU+eyBsaXN0LnJvb21JZCB9PC9jb2RlPik8L3NwYW4+IDogPGNvZGU+bGlzdC5yb29tSWQ8L2NvZGU+O1xuICAgICAgICAgICAgdGlsZXMucHVzaChcbiAgICAgICAgICAgICAgICA8bGkga2V5PXtsaXN0LnJvb21JZH0gY2xhc3NOYW1lPVwibXhfTWpvbG5pclVzZXJTZXR0aW5nc1RhYl9saXN0SXRlbVwiPlxuICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAga2luZD1cImRhbmdlcl9zbVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnVuc3Vic2NyaWJlRnJvbUxpc3QobGlzdCl9XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17dGhpcy5zdGF0ZS5idXN5fVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiVW5zdWJzY3JpYmVcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+Jm5ic3A7XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICBraW5kPVwicHJpbWFyeV9zbVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnZpZXdMaXN0UnVsZXMobGlzdCl9XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17dGhpcy5zdGF0ZS5idXN5fVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiVmlldyBydWxlc1wiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj4mbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgeyBuYW1lIH1cbiAgICAgICAgICAgICAgICA8L2xpPixcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8cD57IF90KFwiWW91IGFyZSBjdXJyZW50bHkgc3Vic2NyaWJlZCB0bzpcIikgfTwvcD5cbiAgICAgICAgICAgICAgICA8dWw+eyB0aWxlcyB9PC91bD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgYnJhbmQgPSBTZGtDb25maWcuZ2V0KCkuYnJhbmQ7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWIgbXhfTWpvbG5pclVzZXJTZXR0aW5nc1RhYlwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPnsgX3QoXCJJZ25vcmVkIHVzZXJzXCIpIH08L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3NlY3Rpb25cIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3N1YnNlY3Rpb25UZXh0Jz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0nd2FybmluZyc+eyBfdChcIuKaoCBUaGVzZSBzZXR0aW5ncyBhcmUgbWVhbnQgZm9yIGFkdmFuY2VkIHVzZXJzLlwiKSB9PC9zcGFuPjxiciAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQWRkIHVzZXJzIGFuZCBzZXJ2ZXJzIHlvdSB3YW50IHRvIGlnbm9yZSBoZXJlLiBVc2UgYXN0ZXJpc2tzIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRvIGhhdmUgJShicmFuZClzIG1hdGNoIGFueSBjaGFyYWN0ZXJzLiBGb3IgZXhhbXBsZSwgPGNvZGU+QGJvdDoqPC9jb2RlPiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3b3VsZCBpZ25vcmUgYWxsIHVzZXJzIHRoYXQgaGF2ZSB0aGUgbmFtZSAnYm90JyBvbiBhbnkgc2VydmVyLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgYnJhbmQgfSwgeyBjb2RlOiAocykgPT4gPGNvZGU+eyBzIH08L2NvZGU+IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICApIH08YnIgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxiciAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIklnbm9yaW5nIHBlb3BsZSBpcyBkb25lIHRocm91Z2ggYmFuIGxpc3RzIHdoaWNoIGNvbnRhaW4gcnVsZXMgZm9yIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIndobyB0byBiYW4uIFN1YnNjcmliaW5nIHRvIGEgYmFuIGxpc3QgbWVhbnMgdGhlIHVzZXJzL3NlcnZlcnMgYmxvY2tlZCBieSBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aGF0IGxpc3Qgd2lsbCBiZSBoaWRkZW4gZnJvbSB5b3UuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YmhlYWRpbmdcIj57IF90KFwiUGVyc29uYWwgYmFuIGxpc3RcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3N1YnNlY3Rpb25UZXh0Jz5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJZb3VyIHBlcnNvbmFsIGJhbiBsaXN0IGhvbGRzIGFsbCB0aGUgdXNlcnMvc2VydmVycyB5b3UgcGVyc29uYWxseSBkb24ndCBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YW50IHRvIHNlZSBtZXNzYWdlcyBmcm9tLiBBZnRlciBpZ25vcmluZyB5b3VyIGZpcnN0IHVzZXIvc2VydmVyLCBhIG5ldyByb29tIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIndpbGwgc2hvdyB1cCBpbiB5b3VyIHJvb20gbGlzdCBuYW1lZCAnTXkgQmFuIExpc3QnIC0gc3RheSBpbiB0aGlzIHJvb20gdG8ga2VlcCBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aGUgYmFuIGxpc3QgaW4gZWZmZWN0LlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgeyB0aGlzLnJlbmRlclBlcnNvbmFsQmFuTGlzdFJ1bGVzKCkgfVxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxmb3JtIG9uU3VibWl0PXt0aGlzLm9uQWRkUGVyc29uYWxSdWxlfSBhdXRvQ29tcGxldGU9XCJvZmZcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJTZXJ2ZXIgb3IgdXNlciBJRCB0byBpZ25vcmVcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtfdChcImVnOiBAYm90Oiogb3IgZXhhbXBsZS5vcmdcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLm5ld1BlcnNvbmFsUnVsZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25QZXJzb25hbFJ1bGVDaGFuZ2VkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInN1Ym1pdFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkFkZFBlcnNvbmFsUnVsZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMuc3RhdGUuYnVzeX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJJZ25vcmVcIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YmhlYWRpbmdcIj57IF90KFwiU3Vic2NyaWJlZCBsaXN0c1wiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbXhfU2V0dGluZ3NUYWJfc3Vic2VjdGlvblRleHQnPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSd3YXJuaW5nJz57IF90KFwiU3Vic2NyaWJpbmcgdG8gYSBiYW4gbGlzdCB3aWxsIGNhdXNlIHlvdSB0byBqb2luIGl0IVwiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiSWYgdGhpcyBpc24ndCB3aGF0IHlvdSB3YW50LCBwbGVhc2UgdXNlIGEgZGlmZmVyZW50IHRvb2wgdG8gaWdub3JlIHVzZXJzLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5yZW5kZXJTdWJzY3JpYmVkQmFuTGlzdHMoKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGZvcm0gb25TdWJtaXQ9e3RoaXMub25TdWJzY3JpYmVMaXN0fSBhdXRvQ29tcGxldGU9XCJvZmZcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJSb29tIElEIG9yIGFkZHJlc3Mgb2YgYmFuIGxpc3RcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLm5ld0xpc3R9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uTmV3TGlzdENoYW5nZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwic3VibWl0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2luZD1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uU3Vic2NyaWJlTGlzdH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMuc3RhdGUuYnVzeX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJTdWJzY3JpYmVcIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=