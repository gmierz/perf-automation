"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _Field = _interopRequireDefault(require("../elements/Field"));

var _HostingLink = require("../../../utils/HostingLink");

var _OwnProfileStore = require("../../../stores/OwnProfileStore");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _ErrorDialog = _interopRequireDefault(require("../dialogs/ErrorDialog"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Media = require("../../../customisations/Media");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _AvatarSetting = _interopRequireDefault(require("./AvatarSetting"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let ProfileSettings = (_dec = (0, _replaceableComponent.replaceableComponent)("views.settings.ProfileSettings"), _dec(_class = class ProfileSettings extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "avatarUpload", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "uploadAvatar", () => {
      this.avatarUpload.current.click();
    });
    (0, _defineProperty2.default)(this, "removeAvatar", () => {
      // clear file upload field so same file can be selected
      this.avatarUpload.current.value = "";
      this.setState({
        avatarUrl: null,
        avatarFile: null,
        enableProfileSave: true
      });
    });
    (0, _defineProperty2.default)(this, "cancelProfileChanges", async e => {
      e.stopPropagation();
      e.preventDefault();
      if (!this.state.enableProfileSave) return;
      this.setState({
        enableProfileSave: false,
        displayName: this.state.originalDisplayName,
        avatarUrl: this.state.originalAvatarUrl,
        avatarFile: null
      });
    });
    (0, _defineProperty2.default)(this, "saveProfile", async e => {
      e.stopPropagation();
      e.preventDefault();
      if (!this.state.enableProfileSave) return;
      this.setState({
        enableProfileSave: false
      });

      const client = _MatrixClientPeg.MatrixClientPeg.get();

      const newState = {};
      const displayName = this.state.displayName.trim();

      try {
        if (this.state.originalDisplayName !== this.state.displayName) {
          await client.setDisplayName(displayName);
          newState.originalDisplayName = displayName;
          newState.displayName = displayName;
        }

        if (this.state.avatarFile) {
          _logger.logger.log(`Uploading new avatar, ${this.state.avatarFile.name} of type ${this.state.avatarFile.type},` + ` (${this.state.avatarFile.size}) bytes`);

          const uri = await client.uploadContent(this.state.avatarFile);
          await client.setAvatarUrl(uri);
          newState.avatarUrl = (0, _Media.mediaFromMxc)(uri).getSquareThumbnailHttp(96);
          newState.originalAvatarUrl = newState.avatarUrl;
          newState.avatarFile = null;
        } else if (this.state.originalAvatarUrl !== this.state.avatarUrl) {
          await client.setAvatarUrl(""); // use empty string as Synapse 500s on undefined
        }
      } catch (err) {
        _logger.logger.log("Failed to save profile", err);

        _Modal.default.createTrackedDialog('Failed to save profile', '', _ErrorDialog.default, {
          title: (0, _languageHandler._t)("Failed to save your profile"),
          description: err && err.message ? err.message : (0, _languageHandler._t)("The operation could not be completed")
        });
      }

      this.setState(newState);
    });
    (0, _defineProperty2.default)(this, "onDisplayNameChanged", e => {
      this.setState({
        displayName: e.target.value,
        enableProfileSave: true
      });
    });
    (0, _defineProperty2.default)(this, "onAvatarChanged", e => {
      if (!e.target.files || !e.target.files.length) {
        this.setState({
          avatarUrl: this.state.originalAvatarUrl,
          avatarFile: null,
          enableProfileSave: false
        });
        return;
      }

      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = ev => {
        this.setState({
          avatarUrl: ev.target.result,
          avatarFile: file,
          enableProfileSave: true
        });
      };

      reader.readAsDataURL(file);
    });

    const _client = _MatrixClientPeg.MatrixClientPeg.get();

    let avatarUrl = _OwnProfileStore.OwnProfileStore.instance.avatarMxc;
    if (avatarUrl) avatarUrl = (0, _Media.mediaFromMxc)(avatarUrl).getSquareThumbnailHttp(96);
    this.state = {
      userId: _client.getUserId(),
      originalDisplayName: _OwnProfileStore.OwnProfileStore.instance.displayName,
      displayName: _OwnProfileStore.OwnProfileStore.instance.displayName,
      originalAvatarUrl: avatarUrl,
      avatarUrl: avatarUrl,
      avatarFile: null,
      enableProfileSave: false
    };
  }

  render() {
    var _this$state$avatarUrl;

    const hostingSignupLink = (0, _HostingLink.getHostingLink)('user-settings');
    let hostingSignup = null;

    if (hostingSignupLink) {
      hostingSignup = /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_ProfileSettings_hostingSignup"
      }, (0, _languageHandler._t)("<a>Upgrade</a> to your own domain", {}, {
        a: sub => /*#__PURE__*/_react.default.createElement("a", {
          href: hostingSignupLink,
          target: "_blank",
          rel: "noreferrer noopener"
        }, sub)
      }), /*#__PURE__*/_react.default.createElement("a", {
        href: hostingSignupLink,
        target: "_blank",
        rel: "noreferrer noopener"
      }, /*#__PURE__*/_react.default.createElement("img", {
        src: require("../../../../res/img/external-link.svg"),
        width: "11",
        height: "10",
        alt: ""
      })));
    }

    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.saveProfile,
      autoComplete: "off",
      noValidate: true,
      className: "mx_ProfileSettings_profileForm"
    }, /*#__PURE__*/_react.default.createElement("input", {
      type: "file",
      ref: this.avatarUpload,
      className: "mx_ProfileSettings_avatarUpload",
      onChange: this.onAvatarChanged,
      accept: "image/*"
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ProfileSettings_profile"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ProfileSettings_controls"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Profile")), /*#__PURE__*/_react.default.createElement(_Field.default, {
      label: (0, _languageHandler._t)("Display Name"),
      type: "text",
      value: this.state.displayName,
      autoComplete: "off",
      onChange: this.onDisplayNameChanged
    }), /*#__PURE__*/_react.default.createElement("p", null, this.state.userId, hostingSignup)), /*#__PURE__*/_react.default.createElement(_AvatarSetting.default, {
      avatarUrl: (_this$state$avatarUrl = this.state.avatarUrl) === null || _this$state$avatarUrl === void 0 ? void 0 : _this$state$avatarUrl.toString(),
      avatarName: this.state.displayName || this.state.userId,
      avatarAltText: (0, _languageHandler._t)("Profile picture"),
      uploadAvatar: this.uploadAvatar,
      removeAvatar: this.removeAvatar
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ProfileSettings_buttons"
    }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.cancelProfileChanges,
      kind: "link",
      disabled: !this.state.enableProfileSave
    }, (0, _languageHandler._t)("Cancel")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.saveProfile,
      kind: "primary",
      disabled: !this.state.enableProfileSave
    }, (0, _languageHandler._t)("Save"))));
  }

}) || _class);
exports.default = ProfileSettings;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL1Byb2ZpbGVTZXR0aW5ncy50c3giXSwibmFtZXMiOlsiUHJvZmlsZVNldHRpbmdzIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiYXZhdGFyVXBsb2FkIiwiY3VycmVudCIsImNsaWNrIiwidmFsdWUiLCJzZXRTdGF0ZSIsImF2YXRhclVybCIsImF2YXRhckZpbGUiLCJlbmFibGVQcm9maWxlU2F2ZSIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsInN0YXRlIiwiZGlzcGxheU5hbWUiLCJvcmlnaW5hbERpc3BsYXlOYW1lIiwib3JpZ2luYWxBdmF0YXJVcmwiLCJjbGllbnQiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJuZXdTdGF0ZSIsInRyaW0iLCJzZXREaXNwbGF5TmFtZSIsImxvZ2dlciIsImxvZyIsIm5hbWUiLCJ0eXBlIiwic2l6ZSIsInVyaSIsInVwbG9hZENvbnRlbnQiLCJzZXRBdmF0YXJVcmwiLCJnZXRTcXVhcmVUaHVtYm5haWxIdHRwIiwiZXJyIiwiTW9kYWwiLCJjcmVhdGVUcmFja2VkRGlhbG9nIiwiRXJyb3JEaWFsb2ciLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwibWVzc2FnZSIsInRhcmdldCIsImZpbGVzIiwibGVuZ3RoIiwiZmlsZSIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJldiIsInJlc3VsdCIsInJlYWRBc0RhdGFVUkwiLCJPd25Qcm9maWxlU3RvcmUiLCJpbnN0YW5jZSIsImF2YXRhck14YyIsInVzZXJJZCIsImdldFVzZXJJZCIsInJlbmRlciIsImhvc3RpbmdTaWdudXBMaW5rIiwiaG9zdGluZ1NpZ251cCIsImEiLCJzdWIiLCJyZXF1aXJlIiwic2F2ZVByb2ZpbGUiLCJvbkF2YXRhckNoYW5nZWQiLCJvbkRpc3BsYXlOYW1lQ2hhbmdlZCIsInRvU3RyaW5nIiwidXBsb2Fk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USxFQUFFLENBQUMsS0FBSy9DLEtBQUwsQ0FBV0o7QUFIMUIsT0FLTSx5QkFBRyxNQUFILENBTE4sQ0FSSixDQW5DSixDQURKO0FBc0RIOztBQTVMb0UsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOSAtIDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgY3JlYXRlUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tIFwiLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcIi4uL2VsZW1lbnRzL0ZpZWxkXCI7XG5pbXBvcnQgeyBnZXRIb3N0aW5nTGluayB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL0hvc3RpbmdMaW5rJztcbmltcG9ydCB7IE93blByb2ZpbGVTdG9yZSB9IGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvT3duUHJvZmlsZVN0b3JlXCI7XG5pbXBvcnQgTW9kYWwgZnJvbSBcIi4uLy4uLy4uL01vZGFsXCI7XG5pbXBvcnQgRXJyb3JEaWFsb2cgZnJvbSBcIi4uL2RpYWxvZ3MvRXJyb3JEaWFsb2dcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBtZWRpYUZyb21NeGMgfSBmcm9tIFwiLi4vLi4vLi4vY3VzdG9taXNhdGlvbnMvTWVkaWFcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gJy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b24nO1xuaW1wb3J0IEF2YXRhclNldHRpbmcgZnJvbSAnLi9BdmF0YXJTZXR0aW5nJztcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICB1c2VySWQ/OiBzdHJpbmc7XG4gICAgb3JpZ2luYWxEaXNwbGF5TmFtZT86IHN0cmluZztcbiAgICBkaXNwbGF5TmFtZT86IHN0cmluZztcbiAgICBvcmlnaW5hbEF2YXRhclVybD86IHN0cmluZztcbiAgICBhdmF0YXJVcmw/OiBzdHJpbmcgfCBBcnJheUJ1ZmZlcjtcbiAgICBhdmF0YXJGaWxlPzogRmlsZTtcbiAgICBlbmFibGVQcm9maWxlU2F2ZT86IGJvb2xlYW47XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLnNldHRpbmdzLlByb2ZpbGVTZXR0aW5nc1wiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvZmlsZVNldHRpbmdzIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PHt9LCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIGF2YXRhclVwbG9hZDogUmVhY3QuUmVmT2JqZWN0PEhUTUxJbnB1dEVsZW1lbnQ+ID0gY3JlYXRlUmVmKCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczoge30pIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIGNvbnN0IGNsaWVudCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgbGV0IGF2YXRhclVybCA9IE93blByb2ZpbGVTdG9yZS5pbnN0YW5jZS5hdmF0YXJNeGM7XG4gICAgICAgIGlmIChhdmF0YXJVcmwpIGF2YXRhclVybCA9IG1lZGlhRnJvbU14YyhhdmF0YXJVcmwpLmdldFNxdWFyZVRodW1ibmFpbEh0dHAoOTYpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgdXNlcklkOiBjbGllbnQuZ2V0VXNlcklkKCksXG4gICAgICAgICAgICBvcmlnaW5hbERpc3BsYXlOYW1lOiBPd25Qcm9maWxlU3RvcmUuaW5zdGFuY2UuZGlzcGxheU5hbWUsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogT3duUHJvZmlsZVN0b3JlLmluc3RhbmNlLmRpc3BsYXlOYW1lLFxuICAgICAgICAgICAgb3JpZ2luYWxBdmF0YXJVcmw6IGF2YXRhclVybCxcbiAgICAgICAgICAgIGF2YXRhclVybDogYXZhdGFyVXJsLFxuICAgICAgICAgICAgYXZhdGFyRmlsZTogbnVsbCxcbiAgICAgICAgICAgIGVuYWJsZVByb2ZpbGVTYXZlOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwbG9hZEF2YXRhciA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5hdmF0YXJVcGxvYWQuY3VycmVudC5jbGljaygpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHJlbW92ZUF2YXRhciA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgLy8gY2xlYXIgZmlsZSB1cGxvYWQgZmllbGQgc28gc2FtZSBmaWxlIGNhbiBiZSBzZWxlY3RlZFxuICAgICAgICB0aGlzLmF2YXRhclVwbG9hZC5jdXJyZW50LnZhbHVlID0gXCJcIjtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBhdmF0YXJVcmw6IG51bGwsXG4gICAgICAgICAgICBhdmF0YXJGaWxlOiBudWxsLFxuICAgICAgICAgICAgZW5hYmxlUHJvZmlsZVNhdmU6IHRydWUsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGNhbmNlbFByb2ZpbGVDaGFuZ2VzID0gYXN5bmMgKGU6IFJlYWN0Lk1vdXNlRXZlbnQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5lbmFibGVQcm9maWxlU2F2ZSkgcmV0dXJuO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGVuYWJsZVByb2ZpbGVTYXZlOiBmYWxzZSxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiB0aGlzLnN0YXRlLm9yaWdpbmFsRGlzcGxheU5hbWUsXG4gICAgICAgICAgICBhdmF0YXJVcmw6IHRoaXMuc3RhdGUub3JpZ2luYWxBdmF0YXJVcmwsXG4gICAgICAgICAgICBhdmF0YXJGaWxlOiBudWxsLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBzYXZlUHJvZmlsZSA9IGFzeW5jIChlOiBSZWFjdC5Gb3JtRXZlbnQ8SFRNTEZvcm1FbGVtZW50Pik6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmVuYWJsZVByb2ZpbGVTYXZlKSByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlbmFibGVQcm9maWxlU2F2ZTogZmFsc2UgfSk7XG5cbiAgICAgICAgY29uc3QgY2xpZW50ID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCBuZXdTdGF0ZTogSVN0YXRlID0ge307XG5cbiAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSB0aGlzLnN0YXRlLmRpc3BsYXlOYW1lLnRyaW0oKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLm9yaWdpbmFsRGlzcGxheU5hbWUgIT09IHRoaXMuc3RhdGUuZGlzcGxheU5hbWUpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBjbGllbnQuc2V0RGlzcGxheU5hbWUoZGlzcGxheU5hbWUpO1xuICAgICAgICAgICAgICAgIG5ld1N0YXRlLm9yaWdpbmFsRGlzcGxheU5hbWUgPSBkaXNwbGF5TmFtZTtcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZS5kaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5hdmF0YXJGaWxlKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcbiAgICAgICAgICAgICAgICAgICAgYFVwbG9hZGluZyBuZXcgYXZhdGFyLCAke3RoaXMuc3RhdGUuYXZhdGFyRmlsZS5uYW1lfSBvZiB0eXBlICR7dGhpcy5zdGF0ZS5hdmF0YXJGaWxlLnR5cGV9LGAgK1xuICAgICAgICAgICAgICAgICAgICBgICgke3RoaXMuc3RhdGUuYXZhdGFyRmlsZS5zaXplfSkgYnl0ZXNgKTtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmkgPSBhd2FpdCBjbGllbnQudXBsb2FkQ29udGVudCh0aGlzLnN0YXRlLmF2YXRhckZpbGUpO1xuICAgICAgICAgICAgICAgIGF3YWl0IGNsaWVudC5zZXRBdmF0YXJVcmwodXJpKTtcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZS5hdmF0YXJVcmwgPSBtZWRpYUZyb21NeGModXJpKS5nZXRTcXVhcmVUaHVtYm5haWxIdHRwKDk2KTtcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZS5vcmlnaW5hbEF2YXRhclVybCA9IG5ld1N0YXRlLmF2YXRhclVybDtcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZS5hdmF0YXJGaWxlID0gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5vcmlnaW5hbEF2YXRhclVybCAhPT0gdGhpcy5zdGF0ZS5hdmF0YXJVcmwpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBjbGllbnQuc2V0QXZhdGFyVXJsKFwiXCIpOyAvLyB1c2UgZW1wdHkgc3RyaW5nIGFzIFN5bmFwc2UgNTAwcyBvbiB1bmRlZmluZWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBsb2dnZXIubG9nKFwiRmFpbGVkIHRvIHNhdmUgcHJvZmlsZVwiLCBlcnIpO1xuICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRmFpbGVkIHRvIHNhdmUgcHJvZmlsZScsICcnLCBFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBfdChcIkZhaWxlZCB0byBzYXZlIHlvdXIgcHJvZmlsZVwiKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogKChlcnIgJiYgZXJyLm1lc3NhZ2UpID8gZXJyLm1lc3NhZ2UgOiBfdChcIlRoZSBvcGVyYXRpb24gY291bGQgbm90IGJlIGNvbXBsZXRlZFwiKSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uRGlzcGxheU5hbWVDaGFuZ2VkID0gKGU6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZGlzcGxheU5hbWU6IGUudGFyZ2V0LnZhbHVlLFxuICAgICAgICAgICAgZW5hYmxlUHJvZmlsZVNhdmU6IHRydWUsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQXZhdGFyQ2hhbmdlZCA9IChlOiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50Pik6IHZvaWQgPT4ge1xuICAgICAgICBpZiAoIWUudGFyZ2V0LmZpbGVzIHx8ICFlLnRhcmdldC5maWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGF2YXRhclVybDogdGhpcy5zdGF0ZS5vcmlnaW5hbEF2YXRhclVybCxcbiAgICAgICAgICAgICAgICBhdmF0YXJGaWxlOiBudWxsLFxuICAgICAgICAgICAgICAgIGVuYWJsZVByb2ZpbGVTYXZlOiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdO1xuICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICByZWFkZXIub25sb2FkID0gKGV2KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IGV2LnRhcmdldC5yZXN1bHQsXG4gICAgICAgICAgICAgICAgYXZhdGFyRmlsZTogZmlsZSxcbiAgICAgICAgICAgICAgICBlbmFibGVQcm9maWxlU2F2ZTogdHJ1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGNvbnN0IGhvc3RpbmdTaWdudXBMaW5rID0gZ2V0SG9zdGluZ0xpbmsoJ3VzZXItc2V0dGluZ3MnKTtcbiAgICAgICAgbGV0IGhvc3RpbmdTaWdudXAgPSBudWxsO1xuICAgICAgICBpZiAoaG9zdGluZ1NpZ251cExpbmspIHtcbiAgICAgICAgICAgIGhvc3RpbmdTaWdudXAgPSA8c3BhbiBjbGFzc05hbWU9XCJteF9Qcm9maWxlU2V0dGluZ3NfaG9zdGluZ1NpZ251cFwiPlxuICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiPGE+VXBncmFkZTwvYT4gdG8geW91ciBvd24gZG9tYWluXCIsIHt9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhOiBzdWIgPT4gPGEgaHJlZj17aG9zdGluZ1NpZ251cExpbmt9IHRhcmdldD1cIl9ibGFua1wiIHJlbD1cIm5vcmVmZXJyZXIgbm9vcGVuZXJcIj57IHN1YiB9PC9hPixcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgICAgICA8YSBocmVmPXtob3N0aW5nU2lnbnVwTGlua30gdGFyZ2V0PVwiX2JsYW5rXCIgcmVsPVwibm9yZWZlcnJlciBub29wZW5lclwiPlxuICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz17cmVxdWlyZShcIi4uLy4uLy4uLy4uL3Jlcy9pbWcvZXh0ZXJuYWwtbGluay5zdmdcIil9IHdpZHRoPVwiMTFcIiBoZWlnaHQ9XCIxMFwiIGFsdD0nJyAvPlxuICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgIDwvc3Bhbj47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGZvcm1cbiAgICAgICAgICAgICAgICBvblN1Ym1pdD17dGhpcy5zYXZlUHJvZmlsZX1cbiAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgICAgIG5vVmFsaWRhdGU9e3RydWV9XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUHJvZmlsZVNldHRpbmdzX3Byb2ZpbGVGb3JtXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgICAgICAgdHlwZT1cImZpbGVcIlxuICAgICAgICAgICAgICAgICAgICByZWY9e3RoaXMuYXZhdGFyVXBsb2FkfVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Qcm9maWxlU2V0dGluZ3NfYXZhdGFyVXBsb2FkXCJcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25BdmF0YXJDaGFuZ2VkfVxuICAgICAgICAgICAgICAgICAgICBhY2NlcHQ9XCJpbWFnZS8qXCJcbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUHJvZmlsZVNldHRpbmdzX3Byb2ZpbGVcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Qcm9maWxlU2V0dGluZ3NfY29udHJvbHNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YmhlYWRpbmdcIj57IF90KFwiUHJvZmlsZVwiKSB9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiRGlzcGxheSBOYW1lXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5kaXNwbGF5TmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uRGlzcGxheU5hbWVDaGFuZ2VkfVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS51c2VySWQgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaG9zdGluZ1NpZ251cCB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8QXZhdGFyU2V0dGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyVXJsPXt0aGlzLnN0YXRlLmF2YXRhclVybD8udG9TdHJpbmcoKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhck5hbWU9e3RoaXMuc3RhdGUuZGlzcGxheU5hbWUgfHwgdGhpcy5zdGF0ZS51c2VySWR9XG4gICAgICAgICAgICAgICAgICAgICAgICBhdmF0YXJBbHRUZXh0PXtfdChcIlByb2ZpbGUgcGljdHVyZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZEF2YXRhcj17dGhpcy51cGxvYWRBdmF0YXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVBdmF0YXI9e3RoaXMucmVtb3ZlQXZhdGFyfSAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUHJvZmlsZVNldHRpbmdzX2J1dHRvbnNcIj5cbiAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuY2FuY2VsUHJvZmlsZUNoYW5nZXN9XG4gICAgICAgICAgICAgICAgICAgICAgICBraW5kPVwibGlua1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17IXRoaXMuc3RhdGUuZW5hYmxlUHJvZmlsZVNhdmV9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJDYW5jZWxcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnNhdmVQcm9maWxlfVxuICAgICAgICAgICAgICAgICAgICAgICAga2luZD1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9eyF0aGlzLnN0YXRlLmVuYWJsZVByb2ZpbGVTYXZlfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiU2F2ZVwiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=