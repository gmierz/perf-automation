"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.defaultSpacesRenderer = exports.defaultRoomsRenderer = exports.defaultDmsRenderer = exports.default = exports.SubspaceSelector = exports.Entry = exports.AddExistingToSpace = void 0;

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _utils = require("matrix-js-sdk/src/utils");

var _event = require("matrix-js-sdk/src/@types/event");

var _languageHandler = require("../../../languageHandler");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _Dropdown = _interopRequireDefault(require("../elements/Dropdown"));

var _SearchBox = _interopRequireDefault(require("../../structures/SearchBox"));

var _SpaceStore = _interopRequireDefault(require("../../../stores/spaces/SpaceStore"));

var _RoomAvatar = _interopRequireDefault(require("../avatars/RoomAvatar"));

var _Rooms = require("../../../Rooms");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _AutoHideScrollbar = _interopRequireDefault(require("../../structures/AutoHideScrollbar"));

var _DMRoomMap = _interopRequireDefault(require("../../../utils/DMRoomMap"));

var _Permalinks = require("../../../utils/permalinks/Permalinks");

var _StyledCheckbox = _interopRequireDefault(require("../elements/StyledCheckbox"));

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _RecentAlgorithm = require("../../../stores/room-list/algorithms/tag-sorting/RecentAlgorithm");

var _ProgressBar = _interopRequireDefault(require("../elements/ProgressBar"));

var _DecoratedRoomAvatar = _interopRequireDefault(require("../avatars/DecoratedRoomAvatar"));

var _QueryMatcher = _interopRequireDefault(require("../../../autocomplete/QueryMatcher"));

var _TruncatedList = _interopRequireDefault(require("../elements/TruncatedList"));

var _EntityTile = _interopRequireDefault(require("../rooms/EntityTile"));

var _BaseAvatar = _interopRequireDefault(require("../avatars/BaseAvatar"));

var _logger = require("matrix-js-sdk/src/logger");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const Entry = ({
  room,
  checked,
  onChange
}) => {
  return /*#__PURE__*/_react.default.createElement("label", {
    className: "mx_AddExistingToSpace_entry"
  }, room !== null && room !== void 0 && room.isSpaceRoom() ? /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
    room: room,
    height: 32,
    width: 32
  }) : /*#__PURE__*/_react.default.createElement(_DecoratedRoomAvatar.default, {
    room: room,
    avatarSize: 32
  }), /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_AddExistingToSpace_entry_name"
  }, room.name), /*#__PURE__*/_react.default.createElement(_StyledCheckbox.default, {
    onChange: onChange ? e => onChange(e.target.checked) : null,
    checked: checked,
    disabled: !onChange
  }));
};

exports.Entry = Entry;

const AddExistingToSpace = ({
  space,
  footerPrompt,
  emptySelectionButton,
  filterPlaceholder,
  roomsRenderer,
  dmsRenderer,
  spacesRenderer,
  onFinished
}) => {
  const cli = (0, _react.useContext)(_MatrixClientContext.default);
  const visibleRooms = (0, _react.useMemo)(() => cli.getVisibleRooms().filter(r => r.getMyMembership() === "join"), [cli]);
  const [selectedToAdd, setSelectedToAdd] = (0, _react.useState)(new Set());
  const [progress, setProgress] = (0, _react.useState)(null);
  const [error, setError] = (0, _react.useState)(null);
  const [query, setQuery] = (0, _react.useState)("");
  const lcQuery = query.toLowerCase().trim();
  const existingSubspacesSet = (0, _react.useMemo)(() => new Set(_SpaceStore.default.instance.getChildSpaces(space.roomId)), [space]);
  const existingRoomsSet = (0, _react.useMemo)(() => new Set(_SpaceStore.default.instance.getChildRooms(space.roomId)), [space]);
  const [spaces, rooms, dms] = (0, _react.useMemo)(() => {
    let rooms = visibleRooms;

    if (lcQuery) {
      const matcher = new _QueryMatcher.default(visibleRooms, {
        keys: ["name"],
        funcs: [r => [r.getCanonicalAlias(), ...r.getAltAliases()].filter(Boolean)],
        shouldMatchWordsOnly: false
      });
      rooms = matcher.match(lcQuery);
    }

    const joinRule = space.getJoinRule();
    return (0, _RecentAlgorithm.sortRooms)(rooms).reduce((arr, room) => {
      if (room.isSpaceRoom()) {
        if (room !== space && !existingSubspacesSet.has(room)) {
          arr[0].push(room);
        }
      } else if (!existingRoomsSet.has(room)) {
        if (!_DMRoomMap.default.shared().getUserIdForRoomId(room.roomId)) {
          arr[1].push(room);
        } else if (joinRule !== "public") {
          // Only show DMs for non-public spaces as they make very little sense in spaces other than "Just Me" ones.
          arr[2].push(room);
        }
      }

      return arr;
    }, [[], [], []]);
  }, [visibleRooms, space, lcQuery, existingRoomsSet, existingSubspacesSet]);

  const addRooms = async () => {
    setError(null);
    setProgress(0);
    let error;

    for (const room of selectedToAdd) {
      const via = (0, _Permalinks.calculateRoomVia)(room);

      try {
        await _SpaceStore.default.instance.addRoomToSpace(space, room.roomId, via).catch(async e => {
          if (e.errcode === "M_LIMIT_EXCEEDED") {
            await (0, _utils.sleep)(e.data.retry_after_ms);
            return _SpaceStore.default.instance.addRoomToSpace(space, room.roomId, via); // retry
          }

          throw e;
        });
        setProgress(i => i + 1);
      } catch (e) {
        _logger.logger.error("Failed to add rooms to space", e);

        setError(error = e);
        break;
      }
    }

    if (!error) {
      onFinished(true);
    }
  };

  const busy = progress !== null;
  let footer;

  if (error) {
    footer = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("img", {
      src: require("../../../../res/img/element-icons/warning-badge.svg"),
      height: "24",
      width: "24",
      alt: ""
    }), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_AddExistingToSpaceDialog_error"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AddExistingToSpaceDialog_errorHeading"
    }, (0, _languageHandler._t)("Not all selected were added")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AddExistingToSpaceDialog_errorCaption"
    }, (0, _languageHandler._t)("Try again"))), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_AddExistingToSpaceDialog_retryButton",
      onClick: addRooms
    }, (0, _languageHandler._t)("Retry")));
  } else if (busy) {
    footer = /*#__PURE__*/_react.default.createElement("span", null, /*#__PURE__*/_react.default.createElement(_ProgressBar.default, {
      value: progress,
      max: selectedToAdd.size
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AddExistingToSpaceDialog_progressText"
    }, (0, _languageHandler._t)("Adding rooms... (%(progress)s out of %(count)s)", {
      count: selectedToAdd.size,
      progress
    })));
  } else {
    let button = emptySelectionButton;

    if (!button || selectedToAdd.size > 0) {
      button = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        kind: "primary",
        disabled: selectedToAdd.size < 1,
        onClick: addRooms
      }, (0, _languageHandler._t)("Add"));
    }

    footer = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("span", null, footerPrompt), button);
  }

  const onChange = !busy && !error ? (checked, room) => {
    if (checked) {
      selectedToAdd.add(room);
    } else {
      selectedToAdd.delete(room);
    }

    setSelectedToAdd(new Set(selectedToAdd));
  } : null;
  const [truncateAt, setTruncateAt] = (0, _react.useState)(20);

  function overflowTile(overflowCount, totalCount) {
    const text = (0, _languageHandler._t)("and %(count)s others...", {
      count: overflowCount
    });
    return /*#__PURE__*/_react.default.createElement(_EntityTile.default, {
      className: "mx_EntityTile_ellipsis",
      avatarJsx: /*#__PURE__*/_react.default.createElement(_BaseAvatar.default, {
        url: require("../../../../res/img/ellipsis.svg"),
        name: "...",
        width: 36,
        height: 36
      }),
      name: text,
      presenceState: "online",
      suppressOnHover: true,
      onClick: () => setTruncateAt(totalCount)
    });
  }

  let noResults = true;

  if (roomsRenderer && rooms.length > 0 || dmsRenderer && dms.length > 0 || !roomsRenderer && !dmsRenderer && spacesRenderer && spaces.length > 0 // only count spaces when alone
  ) {
    noResults = false;
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_AddExistingToSpace"
  }, /*#__PURE__*/_react.default.createElement(_SearchBox.default, {
    className: "mx_textinput_icon mx_textinput_search",
    placeholder: filterPlaceholder,
    onSearch: setQuery,
    autoFocus: true
  }), /*#__PURE__*/_react.default.createElement(_AutoHideScrollbar.default, {
    className: "mx_AddExistingToSpace_content"
  }, rooms.length > 0 && roomsRenderer ? roomsRenderer(rooms, selectedToAdd, onChange, truncateAt, overflowTile) : undefined, spaces.length > 0 && spacesRenderer ? spacesRenderer(spaces, selectedToAdd, onChange) : null, dms.length > 0 && dmsRenderer ? dmsRenderer(dms, selectedToAdd, onChange) : null, noResults ? /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_AddExistingToSpace_noResults"
  }, (0, _languageHandler._t)("No results")) : undefined), /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_AddExistingToSpace_footer"
  }, footer));
};

exports.AddExistingToSpace = AddExistingToSpace;

const defaultRoomsRenderer = (rooms, selectedToAdd, onChange, truncateAt, overflowTile) => /*#__PURE__*/_react.default.createElement("div", {
  className: "mx_AddExistingToSpace_section"
}, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Rooms")), /*#__PURE__*/_react.default.createElement(_TruncatedList.default, {
  truncateAt: truncateAt,
  createOverflowElement: overflowTile,
  getChildren: (start, end) => rooms.slice(start, end).map(room => /*#__PURE__*/_react.default.createElement(Entry, {
    key: room.roomId,
    room: room,
    checked: selectedToAdd.has(room),
    onChange: onChange ? checked => {
      onChange(checked, room);
    } : null
  })),
  getChildCount: () => rooms.length
}));

exports.defaultRoomsRenderer = defaultRoomsRenderer;

const defaultSpacesRenderer = (spaces, selectedToAdd, onChange) => /*#__PURE__*/_react.default.createElement("div", {
  className: "mx_AddExistingToSpace_section"
}, spaces.map(space => {
  return /*#__PURE__*/_react.default.createElement(Entry, {
    key: space.roomId,
    room: space,
    checked: selectedToAdd.has(space),
    onChange: onChange ? checked => {
      onChange(checked, space);
    } : null
  });
}));

exports.defaultSpacesRenderer = defaultSpacesRenderer;

const defaultDmsRenderer = (dms, selectedToAdd, onChange) => /*#__PURE__*/_react.default.createElement("div", {
  className: "mx_AddExistingToSpace_section"
}, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Direct Messages")), dms.map(room => {
  return /*#__PURE__*/_react.default.createElement(Entry, {
    key: room.roomId,
    room: room,
    checked: selectedToAdd.has(room),
    onChange: onChange ? checked => {
      onChange(checked, room);
    } : null
  });
}));

exports.defaultDmsRenderer = defaultDmsRenderer;

const SubspaceSelector = ({
  title,
  space,
  value,
  onChange
}) => {
  const options = (0, _react.useMemo)(() => {
    return [space, ..._SpaceStore.default.instance.getChildSpaces(space.roomId).filter(space => {
      return space.currentState.maySendStateEvent(_event.EventType.SpaceChild, space.client.credentials.userId);
    })];
  }, [space]);
  let body;

  if (options.length > 1) {
    body = /*#__PURE__*/_react.default.createElement(_Dropdown.default, {
      id: "mx_SpaceSelectDropdown",
      className: "mx_SpaceSelectDropdown",
      onOptionChange: key => {
        onChange(options.find(space => space.roomId === key) || space);
      },
      value: value.roomId,
      label: (0, _languageHandler._t)("Space selection")
    }, options.map(space => {
      const classes = (0, _classnames.default)({
        mx_SubspaceSelector_dropdownOptionActive: space === value
      });
      return /*#__PURE__*/_react.default.createElement("div", {
        key: space.roomId,
        className: classes
      }, /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
        room: space,
        width: 24,
        height: 24
      }), space.name || (0, _Rooms.getDisplayAliasForRoom)(space) || space.roomId);
    }));
  } else {
    body = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SubspaceSelector_onlySpace"
    }, space.name || (0, _Rooms.getDisplayAliasForRoom)(space) || space.roomId);
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SubspaceSelector"
  }, /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
    room: value,
    height: 40,
    width: 40
  }), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("h1", null, title), body));
};

exports.SubspaceSelector = SubspaceSelector;

const AddExistingToSpaceDialog = ({
  space,
  onCreateRoomClick,
  onAddSubspaceClick,
  onFinished
}) => {
  const [selectedSpace, setSelectedSpace] = (0, _react.useState)(space);
  return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
    title: /*#__PURE__*/_react.default.createElement(SubspaceSelector, {
      title: (0, _languageHandler._t)("Add existing rooms"),
      space: space,
      value: selectedSpace,
      onChange: setSelectedSpace
    }),
    className: "mx_AddExistingToSpaceDialog",
    contentId: "mx_AddExistingToSpace",
    onFinished: onFinished,
    fixedWidth: false
  }, /*#__PURE__*/_react.default.createElement(_MatrixClientContext.default.Provider, {
    value: space.client
  }, /*#__PURE__*/_react.default.createElement(AddExistingToSpace, {
    space: space,
    onFinished: onFinished,
    footerPrompt: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Want to add a new room instead?")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "link",
      onClick: () => {
        onCreateRoomClick();
        onFinished();
      }
    }, (0, _languageHandler._t)("Create a new room"))),
    filterPlaceholder: (0, _languageHandler._t)("Search for rooms"),
    roomsRenderer: defaultRoomsRenderer,
    spacesRenderer: () => /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AddExistingToSpace_section"
    }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Spaces")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "link",
      onClick: () => {
        onAddSubspaceClick();
        onFinished();
      }
    }, (0, _languageHandler._t)("Adding spaces has moved."))),
    dmsRenderer: defaultDmsRenderer
  })));
};

var _default = AddExistingToSpaceDialog;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQWRkRXhpc3RpbmdUb1NwYWNlRGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJFbnRyeSIsInJvb20iLCJjaGVja2VkIiwib25DaGFuZ2UiLCJpc1NwYWNlUm9vbSIsIm5hbWUiLCJlIiwidGFyZ2V0IiwiQWRkRXhpc3RpbmdUb1NwYWNlIiwic3BhY2UiLCJmb290ZXJQcm9tcHQiLCJlbXB0eVNlbGVjdGlvbkJ1dHRvbiIsImZpbHRlclBsYWNlaG9sZGVyIiwicm9vbXNSZW5kZXJlciIsImRtc1JlbmRlcmVyIiwic3BhY2VzUmVuZGVyZXIiLCJvbkZpbmlzaGVkIiwiY2xpIiwiTWF0cml4Q2xpZW50Q29udGV4dCIsInZpc2libGVSb29tcyIsImdldFZpc2libGVSb29tcyIsImZpbHRlciIsInIiLCJnZXRNeU1lbWJlcnNoaXAiLCJzZWxlY3RlZFRvQWRkIiwic2V0U2VsZWN0ZWRUb0FkZCIsIlNldCIsInByb2dyZXNzIiwic2V0UHJvZ3Jlc3MiLCJlcnJvciIsInNldEVycm9yIiwicXVlcnkiLCJzZXRRdWVyeSIsImxjUXVlcnkiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJleGlzdGluZ1N1YnNwYWNlc1NldCIsIlNwYWNlU3RvcmUiLCJpbnN0YW5jZSIsImdldENoaWxkU3BhY2VzIiwicm9vbUlkIiwiZXhpc3RpbmdSb29tc1NldCIsImdldENoaWxkUm9vbXMiLCJzcGFjZXMiLCJyb29tcyIsImRtcyIsIm1hdGNoZXIiLCJRdWVyeU1hdGNoZXIiLCJrZXlzIiwiZnVuY3MiLCJnZXRDYW5vbmljYWxBbGlhcyIsImdldEFsdEFsaWFzZXMiLCJCb29sZWFuIiwic2hvdWxkTWF0Y2hXb3Jkc09ubHkiLCJtYXRjaCIsImpvaW5SdWxlIiwiZ2V0Sm9pblJ1bGUiLCJyZWR1Y2UiLCJhcnIiLCJoYXMiLCJwdXNoIiwiRE1Sb29tTWFwIiwic2hhcmVkIiwiZ2V0VXNlcklkRm9yUm9vbUlkIiwiYWRkUm9vbXMiLCJ2aWEiLCJhZGRSb29tVG9TcGFjZSIsImNhdGNoIiwiZXJyY29kZSIsImRhdGEiLCJyZXRyeV9hZnRlcl9tcyIsImkiLCJsb2dnZXIiLCJidXN5IiwiZm9vdGVyIiwicmVxdWlyZSIsInNpemUiLCJjb3VudCIsImJ1dHRvbiIsImFkZCIsImRlbGV0ZSIsInRydW5jYXRlQXQiLCJzZXRUcnVuY2F0ZUF0Iiwib3ZlcmZsb3dUaWxlIiwib3ZlcmZsb3dDb3VudCIsInRvdGFsQ291bnQiLCJ0ZXh0Iiwibm9SZXN1bHRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiZGVmYXVsdFJvb21zUmVuZGVyZXIiLCJzdGFydCIsImVuZCIsInNsaWNlIiwibWFwIiwiZGVmYXVsdFNwYWNlc1JlbmRlcmVyIiwiZGVmYXVsdERtc1JlbmRlcmVyIiwiU3Vic3BhY2VTZWxlY3RvciIsInRpdGxlIiwidmFsdWUiLCJvcHRpb25zIiwiY3VycmVudFN0YXRlIiwibWF5U2VuZFN0YXRlRXZlbnQiLCJFdmVudFR5cGUiLCJTcGFjZUNoaWxkIiwiY2xpZW50IiwiY3JlZGVudGlhbHMiLCJ1c2VySWQiLCJib2R5Iiwia2V5IiwiZmluZCIsImNsYXNzZXMiLCJteF9TdWJzcGFjZVNlbGVjdG9yX2Ryb3Bkb3duT3B0aW9uQWN0aXZlIiwiQWRkRXhpc3RpbmdUb1NwYWNlRGlhbG9nIiwib25DcmVhdGVSb29tQ2xpY2siLCJvbkFkZFN1YnNwYWNlQ2xpY2siLCJzZWxlY3RlZFNwYWNlIiwic2V0U2VsZWN0ZWRTcGFjZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7Ozs7QUEzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBc0NPLE1BQU1BLEtBQUssR0FBRyxDQUFDO0FBQUVDLEVBQUFBLElBQUY7QUFBUUMsRUFBQUEsT0FBUjtBQUFpQkMsRUFBQUE7QUFBakIsQ0FBRCxLQUFpQztBQUNsRCxzQkFBTztBQUFPLElBQUEsU0FBUyxFQUFDO0FBQWpCLEtBQ0RGLElBQUksU0FBSixJQUFBQSxJQUFJLFdBQUosSUFBQUEsSUFBSSxDQUFFRyxXQUFOLGtCQUNJLDZCQUFDLG1CQUFEO0FBQVksSUFBQSxJQUFJLEVBQUVILElBQWxCO0FBQXdCLElBQUEsTUFBTSxFQUFFLEVBQWhDO0FBQW9DLElBQUEsS0FBSyxFQUFFO0FBQTNDLElBREosZ0JBRUksNkJBQUMsNEJBQUQ7QUFBcUIsSUFBQSxJQUFJLEVBQUVBLElBQTNCO0FBQWlDLElBQUEsVUFBVSxFQUFFO0FBQTdDLElBSEgsZUFLSDtBQUFNLElBQUEsU0FBUyxFQUFDO0FBQWhCLEtBQXFEQSxJQUFJLENBQUNJLElBQTFELENBTEcsZUFNSCw2QkFBQyx1QkFBRDtBQUNJLElBQUEsUUFBUSxFQUFFRixRQUFRLEdBQUlHLENBQUQsSUFBT0gsUUFBUSxDQUFDRyxDQUFDLENBQUNDLE1BQUYsQ0FBU0wsT0FBVixDQUFsQixHQUF1QyxJQUQ3RDtBQUVJLElBQUEsT0FBTyxFQUFFQSxPQUZiO0FBR0ksSUFBQSxRQUFRLEVBQUUsQ0FBQ0M7QUFIZixJQU5HLENBQVA7QUFZSCxDQWJNOzs7O0FBd0NBLE1BQU1LLGtCQUFzRCxHQUFHLENBQUM7QUFDbkVDLEVBQUFBLEtBRG1FO0FBRW5FQyxFQUFBQSxZQUZtRTtBQUduRUMsRUFBQUEsb0JBSG1FO0FBSW5FQyxFQUFBQSxpQkFKbUU7QUFLbkVDLEVBQUFBLGFBTG1FO0FBTW5FQyxFQUFBQSxXQU5tRTtBQU9uRUMsRUFBQUEsY0FQbUU7QUFRbkVDLEVBQUFBO0FBUm1FLENBQUQsS0FTaEU7QUFDRixRQUFNQyxHQUFHLEdBQUcsdUJBQVdDLDRCQUFYLENBQVo7QUFDQSxRQUFNQyxZQUFZLEdBQUcsb0JBQVEsTUFBTUYsR0FBRyxDQUFDRyxlQUFKLEdBQXNCQyxNQUF0QixDQUE2QkMsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLGVBQUYsT0FBd0IsTUFBMUQsQ0FBZCxFQUFpRixDQUFDTixHQUFELENBQWpGLENBQXJCO0FBRUEsUUFBTSxDQUFDTyxhQUFELEVBQWdCQyxnQkFBaEIsSUFBb0MscUJBQVMsSUFBSUMsR0FBSixFQUFULENBQTFDO0FBQ0EsUUFBTSxDQUFDQyxRQUFELEVBQVdDLFdBQVgsSUFBMEIscUJBQWlCLElBQWpCLENBQWhDO0FBQ0EsUUFBTSxDQUFDQyxLQUFELEVBQVFDLFFBQVIsSUFBb0IscUJBQWdCLElBQWhCLENBQTFCO0FBQ0EsUUFBTSxDQUFDQyxLQUFELEVBQVFDLFFBQVIsSUFBb0IscUJBQVMsRUFBVCxDQUExQjtBQUNBLFFBQU1DLE9BQU8sR0FBR0YsS0FBSyxDQUFDRyxXQUFOLEdBQW9CQyxJQUFwQixFQUFoQjtBQUVBLFFBQU1DLG9CQUFvQixHQUFHLG9CQUFRLE1BQU0sSUFBSVYsR0FBSixDQUFRVyxvQkFBV0MsUUFBWCxDQUFvQkMsY0FBcEIsQ0FBbUM5QixLQUFLLENBQUMrQixNQUF6QyxDQUFSLENBQWQsRUFBeUUsQ0FBQy9CLEtBQUQsQ0FBekUsQ0FBN0I7QUFDQSxRQUFNZ0MsZ0JBQWdCLEdBQUcsb0JBQVEsTUFBTSxJQUFJZixHQUFKLENBQVFXLG9CQUFXQyxRQUFYLENBQW9CSSxhQUFwQixDQUFrQ2pDLEtBQUssQ0FBQytCLE1BQXhDLENBQVIsQ0FBZCxFQUF3RSxDQUFDL0IsS0FBRCxDQUF4RSxDQUF6QjtBQUVBLFFBQU0sQ0FBQ2tDLE1BQUQsRUFBU0MsS0FBVCxFQUFnQkMsR0FBaEIsSUFBdUIsb0JBQVEsTUFBTTtBQUN2QyxRQUFJRCxLQUFLLEdBQUd6QixZQUFaOztBQUVBLFFBQUljLE9BQUosRUFBYTtBQUNULFlBQU1hLE9BQU8sR0FBRyxJQUFJQyxxQkFBSixDQUF1QjVCLFlBQXZCLEVBQXFDO0FBQ2pENkIsUUFBQUEsSUFBSSxFQUFFLENBQUMsTUFBRCxDQUQyQztBQUVqREMsUUFBQUEsS0FBSyxFQUFFLENBQUMzQixDQUFDLElBQUksQ0FBQ0EsQ0FBQyxDQUFDNEIsaUJBQUYsRUFBRCxFQUF3QixHQUFHNUIsQ0FBQyxDQUFDNkIsYUFBRixFQUEzQixFQUE4QzlCLE1BQTlDLENBQXFEK0IsT0FBckQsQ0FBTixDQUYwQztBQUdqREMsUUFBQUEsb0JBQW9CLEVBQUU7QUFIMkIsT0FBckMsQ0FBaEI7QUFNQVQsTUFBQUEsS0FBSyxHQUFHRSxPQUFPLENBQUNRLEtBQVIsQ0FBY3JCLE9BQWQsQ0FBUjtBQUNIOztBQUVELFVBQU1zQixRQUFRLEdBQUc5QyxLQUFLLENBQUMrQyxXQUFOLEVBQWpCO0FBQ0EsV0FBTyxnQ0FBVVosS0FBVixFQUFpQmEsTUFBakIsQ0FBd0IsQ0FBQ0MsR0FBRCxFQUFNekQsSUFBTixLQUFlO0FBQzFDLFVBQUlBLElBQUksQ0FBQ0csV0FBTCxFQUFKLEVBQXdCO0FBQ3BCLFlBQUlILElBQUksS0FBS1EsS0FBVCxJQUFrQixDQUFDMkIsb0JBQW9CLENBQUN1QixHQUFyQixDQUF5QjFELElBQXpCLENBQXZCLEVBQXVEO0FBQ25EeUQsVUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxDQUFPRSxJQUFQLENBQVkzRCxJQUFaO0FBQ0g7QUFDSixPQUpELE1BSU8sSUFBSSxDQUFDd0MsZ0JBQWdCLENBQUNrQixHQUFqQixDQUFxQjFELElBQXJCLENBQUwsRUFBaUM7QUFDcEMsWUFBSSxDQUFDNEQsbUJBQVVDLE1BQVYsR0FBbUJDLGtCQUFuQixDQUFzQzlELElBQUksQ0FBQ3VDLE1BQTNDLENBQUwsRUFBeUQ7QUFDckRrQixVQUFBQSxHQUFHLENBQUMsQ0FBRCxDQUFILENBQU9FLElBQVAsQ0FBWTNELElBQVo7QUFDSCxTQUZELE1BRU8sSUFBSXNELFFBQVEsS0FBSyxRQUFqQixFQUEyQjtBQUM5QjtBQUNBRyxVQUFBQSxHQUFHLENBQUMsQ0FBRCxDQUFILENBQU9FLElBQVAsQ0FBWTNELElBQVo7QUFDSDtBQUNKOztBQUNELGFBQU95RCxHQUFQO0FBQ0gsS0FkTSxFQWNKLENBQUMsRUFBRCxFQUFLLEVBQUwsRUFBUyxFQUFULENBZEksQ0FBUDtBQWVILEdBN0I0QixFQTZCMUIsQ0FBQ3ZDLFlBQUQsRUFBZVYsS0FBZixFQUFzQndCLE9BQXRCLEVBQStCUSxnQkFBL0IsRUFBaURMLG9CQUFqRCxDQTdCMEIsQ0FBN0I7O0FBK0JBLFFBQU00QixRQUFRLEdBQUcsWUFBWTtBQUN6QmxDLElBQUFBLFFBQVEsQ0FBQyxJQUFELENBQVI7QUFDQUYsSUFBQUEsV0FBVyxDQUFDLENBQUQsQ0FBWDtBQUVBLFFBQUlDLEtBQUo7O0FBRUEsU0FBSyxNQUFNNUIsSUFBWCxJQUFtQnVCLGFBQW5CLEVBQWtDO0FBQzlCLFlBQU15QyxHQUFHLEdBQUcsa0NBQWlCaEUsSUFBakIsQ0FBWjs7QUFDQSxVQUFJO0FBQ0EsY0FBTW9DLG9CQUFXQyxRQUFYLENBQW9CNEIsY0FBcEIsQ0FBbUN6RCxLQUFuQyxFQUEwQ1IsSUFBSSxDQUFDdUMsTUFBL0MsRUFBdUR5QixHQUF2RCxFQUE0REUsS0FBNUQsQ0FBa0UsTUFBTTdELENBQU4sSUFBVztBQUMvRSxjQUFJQSxDQUFDLENBQUM4RCxPQUFGLEtBQWMsa0JBQWxCLEVBQXNDO0FBQ2xDLGtCQUFNLGtCQUFNOUQsQ0FBQyxDQUFDK0QsSUFBRixDQUFPQyxjQUFiLENBQU47QUFDQSxtQkFBT2pDLG9CQUFXQyxRQUFYLENBQW9CNEIsY0FBcEIsQ0FBbUN6RCxLQUFuQyxFQUEwQ1IsSUFBSSxDQUFDdUMsTUFBL0MsRUFBdUR5QixHQUF2RCxDQUFQLENBRmtDLENBRWtDO0FBQ3ZFOztBQUVELGdCQUFNM0QsQ0FBTjtBQUNILFNBUEssQ0FBTjtBQVFBc0IsUUFBQUEsV0FBVyxDQUFDMkMsQ0FBQyxJQUFJQSxDQUFDLEdBQUcsQ0FBVixDQUFYO0FBQ0gsT0FWRCxDQVVFLE9BQU9qRSxDQUFQLEVBQVU7QUFDUmtFLHVCQUFPM0MsS0FBUCxDQUFhLDhCQUFiLEVBQTZDdkIsQ0FBN0M7O0FBQ0F3QixRQUFBQSxRQUFRLENBQUNELEtBQUssR0FBR3ZCLENBQVQsQ0FBUjtBQUNBO0FBQ0g7QUFDSjs7QUFFRCxRQUFJLENBQUN1QixLQUFMLEVBQVk7QUFDUmIsTUFBQUEsVUFBVSxDQUFDLElBQUQsQ0FBVjtBQUNIO0FBQ0osR0E1QkQ7O0FBOEJBLFFBQU15RCxJQUFJLEdBQUc5QyxRQUFRLEtBQUssSUFBMUI7QUFFQSxNQUFJK0MsTUFBSjs7QUFDQSxNQUFJN0MsS0FBSixFQUFXO0FBQ1A2QyxJQUFBQSxNQUFNLGdCQUFHLHlFQUNMO0FBQ0ksTUFBQSxHQUFHLEVBQUVDLE9BQU8sQ0FBQyxxREFBRCxDQURoQjtBQUVJLE1BQUEsTUFBTSxFQUFDLElBRlg7QUFHSSxNQUFBLEtBQUssRUFBQyxJQUhWO0FBSUksTUFBQSxHQUFHLEVBQUM7QUFKUixNQURLLGVBUUw7QUFBTSxNQUFBLFNBQVMsRUFBQztBQUFoQixvQkFDSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FBNEQseUJBQUcsNkJBQUgsQ0FBNUQsQ0FESixlQUVJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUE0RCx5QkFBRyxXQUFILENBQTVELENBRkosQ0FSSyxlQWFMLDZCQUFDLHlCQUFEO0FBQWtCLE1BQUEsU0FBUyxFQUFDLHlDQUE1QjtBQUFzRSxNQUFBLE9BQU8sRUFBRVg7QUFBL0UsT0FDTSx5QkFBRyxPQUFILENBRE4sQ0FiSyxDQUFUO0FBaUJILEdBbEJELE1Ba0JPLElBQUlTLElBQUosRUFBVTtBQUNiQyxJQUFBQSxNQUFNLGdCQUFHLHdEQUNMLDZCQUFDLG9CQUFEO0FBQWEsTUFBQSxLQUFLLEVBQUUvQyxRQUFwQjtBQUE4QixNQUFBLEdBQUcsRUFBRUgsYUFBYSxDQUFDb0Q7QUFBakQsTUFESyxlQUVMO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNNLHlCQUFHLGlEQUFILEVBQXNEO0FBQ3BEQyxNQUFBQSxLQUFLLEVBQUVyRCxhQUFhLENBQUNvRCxJQUQrQjtBQUVwRGpELE1BQUFBO0FBRm9ELEtBQXRELENBRE4sQ0FGSyxDQUFUO0FBU0gsR0FWTSxNQVVBO0FBQ0gsUUFBSW1ELE1BQU0sR0FBR25FLG9CQUFiOztBQUNBLFFBQUksQ0FBQ21FLE1BQUQsSUFBV3RELGFBQWEsQ0FBQ29ELElBQWQsR0FBcUIsQ0FBcEMsRUFBdUM7QUFDbkNFLE1BQUFBLE1BQU0sZ0JBQUcsNkJBQUMseUJBQUQ7QUFBa0IsUUFBQSxJQUFJLEVBQUMsU0FBdkI7QUFBaUMsUUFBQSxRQUFRLEVBQUV0RCxhQUFhLENBQUNvRCxJQUFkLEdBQXFCLENBQWhFO0FBQW1FLFFBQUEsT0FBTyxFQUFFWjtBQUE1RSxTQUNILHlCQUFHLEtBQUgsQ0FERyxDQUFUO0FBR0g7O0FBRURVLElBQUFBLE1BQU0sZ0JBQUcseUVBQ0wsMkNBQ01oRSxZQUROLENBREssRUFLSG9FLE1BTEcsQ0FBVDtBQU9IOztBQUVELFFBQU0zRSxRQUFRLEdBQUcsQ0FBQ3NFLElBQUQsSUFBUyxDQUFDNUMsS0FBVixHQUFrQixDQUFDM0IsT0FBRCxFQUFtQkQsSUFBbkIsS0FBa0M7QUFDakUsUUFBSUMsT0FBSixFQUFhO0FBQ1RzQixNQUFBQSxhQUFhLENBQUN1RCxHQUFkLENBQWtCOUUsSUFBbEI7QUFDSCxLQUZELE1BRU87QUFDSHVCLE1BQUFBLGFBQWEsQ0FBQ3dELE1BQWQsQ0FBcUIvRSxJQUFyQjtBQUNIOztBQUNEd0IsSUFBQUEsZ0JBQWdCLENBQUMsSUFBSUMsR0FBSixDQUFRRixhQUFSLENBQUQsQ0FBaEI7QUFDSCxHQVBnQixHQU9iLElBUEo7QUFTQSxRQUFNLENBQUN5RCxVQUFELEVBQWFDLGFBQWIsSUFBOEIscUJBQVMsRUFBVCxDQUFwQzs7QUFDQSxXQUFTQyxZQUFULENBQXNCQyxhQUF0QixFQUE2Q0MsVUFBN0MsRUFBOEU7QUFDMUUsVUFBTUMsSUFBSSxHQUFHLHlCQUFHLHlCQUFILEVBQThCO0FBQUVULE1BQUFBLEtBQUssRUFBRU87QUFBVCxLQUE5QixDQUFiO0FBQ0Esd0JBQ0ksNkJBQUMsbUJBQUQ7QUFDSSxNQUFBLFNBQVMsRUFBQyx3QkFEZDtBQUVJLE1BQUEsU0FBUyxlQUNMLDZCQUFDLG1CQUFEO0FBQVksUUFBQSxHQUFHLEVBQUVULE9BQU8sQ0FBQyxrQ0FBRCxDQUF4QjtBQUE4RCxRQUFBLElBQUksRUFBQyxLQUFuRTtBQUF5RSxRQUFBLEtBQUssRUFBRSxFQUFoRjtBQUFvRixRQUFBLE1BQU0sRUFBRTtBQUE1RixRQUhSO0FBS0ksTUFBQSxJQUFJLEVBQUVXLElBTFY7QUFNSSxNQUFBLGFBQWEsRUFBQyxRQU5sQjtBQU9JLE1BQUEsZUFBZSxFQUFFLElBUHJCO0FBUUksTUFBQSxPQUFPLEVBQUUsTUFBTUosYUFBYSxDQUFDRyxVQUFEO0FBUmhDLE1BREo7QUFZSDs7QUFFRCxNQUFJRSxTQUFTLEdBQUcsSUFBaEI7O0FBQ0EsTUFBSzFFLGFBQWEsSUFBSStCLEtBQUssQ0FBQzRDLE1BQU4sR0FBZSxDQUFqQyxJQUNDMUUsV0FBVyxJQUFJK0IsR0FBRyxDQUFDMkMsTUFBSixHQUFhLENBRDdCLElBRUMsQ0FBQzNFLGFBQUQsSUFBa0IsQ0FBQ0MsV0FBbkIsSUFBa0NDLGNBQWxDLElBQW9ENEIsTUFBTSxDQUFDNkMsTUFBUCxHQUFnQixDQUZ6RSxDQUU0RTtBQUY1RSxJQUdFO0FBQ0VELElBQUFBLFNBQVMsR0FBRyxLQUFaO0FBQ0g7O0FBRUQsc0JBQU87QUFBSyxJQUFBLFNBQVMsRUFBQztBQUFmLGtCQUNILDZCQUFDLGtCQUFEO0FBQ0ksSUFBQSxTQUFTLEVBQUMsdUNBRGQ7QUFFSSxJQUFBLFdBQVcsRUFBRTNFLGlCQUZqQjtBQUdJLElBQUEsUUFBUSxFQUFFb0IsUUFIZDtBQUlJLElBQUEsU0FBUyxFQUFFO0FBSmYsSUFERyxlQU9ILDZCQUFDLDBCQUFEO0FBQW1CLElBQUEsU0FBUyxFQUFDO0FBQTdCLEtBQ01ZLEtBQUssQ0FBQzRDLE1BQU4sR0FBZSxDQUFmLElBQW9CM0UsYUFBcEIsR0FDRUEsYUFBYSxDQUFDK0IsS0FBRCxFQUFRcEIsYUFBUixFQUF1QnJCLFFBQXZCLEVBQWlDOEUsVUFBakMsRUFBNkNFLFlBQTdDLENBRGYsR0FFRU0sU0FIUixFQUtNOUMsTUFBTSxDQUFDNkMsTUFBUCxHQUFnQixDQUFoQixJQUFxQnpFLGNBQXJCLEdBQ0VBLGNBQWMsQ0FBQzRCLE1BQUQsRUFBU25CLGFBQVQsRUFBd0JyQixRQUF4QixDQURoQixHQUVFLElBUFIsRUFTTTBDLEdBQUcsQ0FBQzJDLE1BQUosR0FBYSxDQUFiLElBQWtCMUUsV0FBbEIsR0FDRUEsV0FBVyxDQUFDK0IsR0FBRCxFQUFNckIsYUFBTixFQUFxQnJCLFFBQXJCLENBRGIsR0FFRSxJQVhSLEVBYU1vRixTQUFTLGdCQUFHO0FBQU0sSUFBQSxTQUFTLEVBQUM7QUFBaEIsS0FDUix5QkFBRyxZQUFILENBRFEsQ0FBSCxHQUVERSxTQWZkLENBUEcsZUF5Qkg7QUFBSyxJQUFBLFNBQVMsRUFBQztBQUFmLEtBQ01mLE1BRE4sQ0F6QkcsQ0FBUDtBQTZCSCxDQWxNTTs7OztBQW9NQSxNQUFNZ0Isb0JBQStELEdBQUcsQ0FDM0U5QyxLQUQyRSxFQUNwRXBCLGFBRG9FLEVBQ3JEckIsUUFEcUQsRUFDM0M4RSxVQUQyQyxFQUMvQkUsWUFEK0Isa0JBRzNFO0FBQUssRUFBQSxTQUFTLEVBQUM7QUFBZixnQkFDSSx5Q0FBTSx5QkFBRyxPQUFILENBQU4sQ0FESixlQUVJLDZCQUFDLHNCQUFEO0FBQ0ksRUFBQSxVQUFVLEVBQUVGLFVBRGhCO0FBRUksRUFBQSxxQkFBcUIsRUFBRUUsWUFGM0I7QUFHSSxFQUFBLFdBQVcsRUFBRSxDQUFDUSxLQUFELEVBQVFDLEdBQVIsS0FBZ0JoRCxLQUFLLENBQUNpRCxLQUFOLENBQVlGLEtBQVosRUFBbUJDLEdBQW5CLEVBQXdCRSxHQUF4QixDQUE0QjdGLElBQUksaUJBQ3pELDZCQUFDLEtBQUQ7QUFDSSxJQUFBLEdBQUcsRUFBRUEsSUFBSSxDQUFDdUMsTUFEZDtBQUVJLElBQUEsSUFBSSxFQUFFdkMsSUFGVjtBQUdJLElBQUEsT0FBTyxFQUFFdUIsYUFBYSxDQUFDbUMsR0FBZCxDQUFrQjFELElBQWxCLENBSGI7QUFJSSxJQUFBLFFBQVEsRUFBRUUsUUFBUSxHQUFJRCxPQUFELElBQXNCO0FBQ3ZDQyxNQUFBQSxRQUFRLENBQUNELE9BQUQsRUFBVUQsSUFBVixDQUFSO0FBQ0gsS0FGaUIsR0FFZDtBQU5SLElBRHlCLENBSGpDO0FBYUksRUFBQSxhQUFhLEVBQUUsTUFBTTJDLEtBQUssQ0FBQzRDO0FBYi9CLEVBRkosQ0FIRzs7OztBQXVCQSxNQUFNTyxxQkFBaUUsR0FBRyxDQUFDcEQsTUFBRCxFQUFTbkIsYUFBVCxFQUF3QnJCLFFBQXhCLGtCQUM3RTtBQUFLLEVBQUEsU0FBUyxFQUFDO0FBQWYsR0FDTXdDLE1BQU0sQ0FBQ21ELEdBQVAsQ0FBV3JGLEtBQUssSUFBSTtBQUNsQixzQkFBTyw2QkFBQyxLQUFEO0FBQ0gsSUFBQSxHQUFHLEVBQUVBLEtBQUssQ0FBQytCLE1BRFI7QUFFSCxJQUFBLElBQUksRUFBRS9CLEtBRkg7QUFHSCxJQUFBLE9BQU8sRUFBRWUsYUFBYSxDQUFDbUMsR0FBZCxDQUFrQmxELEtBQWxCLENBSE47QUFJSCxJQUFBLFFBQVEsRUFBRU4sUUFBUSxHQUFJRCxPQUFELElBQWE7QUFDOUJDLE1BQUFBLFFBQVEsQ0FBQ0QsT0FBRCxFQUFVTyxLQUFWLENBQVI7QUFDSCxLQUZpQixHQUVkO0FBTkQsSUFBUDtBQVFILENBVEMsQ0FETixDQURHOzs7O0FBZUEsTUFBTXVGLGtCQUEyRCxHQUFHLENBQUNuRCxHQUFELEVBQU1yQixhQUFOLEVBQXFCckIsUUFBckIsa0JBQ3ZFO0FBQUssRUFBQSxTQUFTLEVBQUM7QUFBZixnQkFDSSx5Q0FBTSx5QkFBRyxpQkFBSCxDQUFOLENBREosRUFFTTBDLEdBQUcsQ0FBQ2lELEdBQUosQ0FBUTdGLElBQUksSUFBSTtBQUNkLHNCQUFPLDZCQUFDLEtBQUQ7QUFDSCxJQUFBLEdBQUcsRUFBRUEsSUFBSSxDQUFDdUMsTUFEUDtBQUVILElBQUEsSUFBSSxFQUFFdkMsSUFGSDtBQUdILElBQUEsT0FBTyxFQUFFdUIsYUFBYSxDQUFDbUMsR0FBZCxDQUFrQjFELElBQWxCLENBSE47QUFJSCxJQUFBLFFBQVEsRUFBRUUsUUFBUSxHQUFJRCxPQUFELElBQXNCO0FBQ3ZDQyxNQUFBQSxRQUFRLENBQUNELE9BQUQsRUFBVUQsSUFBVixDQUFSO0FBQ0gsS0FGaUIsR0FFZDtBQU5ELElBQVA7QUFRSCxDQVRDLENBRk4sQ0FERzs7OztBQXVCQSxNQUFNZ0csZ0JBQWdCLEdBQUcsQ0FBQztBQUFFQyxFQUFBQSxLQUFGO0FBQVN6RixFQUFBQSxLQUFUO0FBQWdCMEYsRUFBQUEsS0FBaEI7QUFBdUJoRyxFQUFBQTtBQUF2QixDQUFELEtBQStEO0FBQzNGLFFBQU1pRyxPQUFPLEdBQUcsb0JBQVEsTUFBTTtBQUMxQixXQUFPLENBQUMzRixLQUFELEVBQVEsR0FBRzRCLG9CQUFXQyxRQUFYLENBQW9CQyxjQUFwQixDQUFtQzlCLEtBQUssQ0FBQytCLE1BQXpDLEVBQWlEbkIsTUFBakQsQ0FBd0RaLEtBQUssSUFBSTtBQUMvRSxhQUFPQSxLQUFLLENBQUM0RixZQUFOLENBQW1CQyxpQkFBbkIsQ0FBcUNDLGlCQUFVQyxVQUEvQyxFQUEyRC9GLEtBQUssQ0FBQ2dHLE1BQU4sQ0FBYUMsV0FBYixDQUF5QkMsTUFBcEYsQ0FBUDtBQUNILEtBRmlCLENBQVgsQ0FBUDtBQUdILEdBSmUsRUFJYixDQUFDbEcsS0FBRCxDQUphLENBQWhCO0FBTUEsTUFBSW1HLElBQUo7O0FBQ0EsTUFBSVIsT0FBTyxDQUFDWixNQUFSLEdBQWlCLENBQXJCLEVBQXdCO0FBQ3BCb0IsSUFBQUEsSUFBSSxnQkFDQSw2QkFBQyxpQkFBRDtBQUNJLE1BQUEsRUFBRSxFQUFDLHdCQURQO0FBRUksTUFBQSxTQUFTLEVBQUMsd0JBRmQ7QUFHSSxNQUFBLGNBQWMsRUFBR0MsR0FBRCxJQUFpQjtBQUM3QjFHLFFBQUFBLFFBQVEsQ0FBQ2lHLE9BQU8sQ0FBQ1UsSUFBUixDQUFhckcsS0FBSyxJQUFJQSxLQUFLLENBQUMrQixNQUFOLEtBQWlCcUUsR0FBdkMsS0FBK0NwRyxLQUFoRCxDQUFSO0FBQ0gsT0FMTDtBQU1JLE1BQUEsS0FBSyxFQUFFMEYsS0FBSyxDQUFDM0QsTUFOakI7QUFPSSxNQUFBLEtBQUssRUFBRSx5QkFBRyxpQkFBSDtBQVBYLE9BU000RCxPQUFPLENBQUNOLEdBQVIsQ0FBYXJGLEtBQUQsSUFBVztBQUNyQixZQUFNc0csT0FBTyxHQUFHLHlCQUFXO0FBQ3ZCQyxRQUFBQSx3Q0FBd0MsRUFBRXZHLEtBQUssS0FBSzBGO0FBRDdCLE9BQVgsQ0FBaEI7QUFHQSwwQkFBTztBQUFLLFFBQUEsR0FBRyxFQUFFMUYsS0FBSyxDQUFDK0IsTUFBaEI7QUFBd0IsUUFBQSxTQUFTLEVBQUV1RTtBQUFuQyxzQkFDSCw2QkFBQyxtQkFBRDtBQUFZLFFBQUEsSUFBSSxFQUFFdEcsS0FBbEI7QUFBeUIsUUFBQSxLQUFLLEVBQUUsRUFBaEM7QUFBb0MsUUFBQSxNQUFNLEVBQUU7QUFBNUMsUUFERyxFQUVEQSxLQUFLLENBQUNKLElBQU4sSUFBYyxtQ0FBdUJJLEtBQXZCLENBQWQsSUFBK0NBLEtBQUssQ0FBQytCLE1BRnBELENBQVA7QUFJSCxLQVJDLENBVE4sQ0FESjtBQXFCSCxHQXRCRCxNQXNCTztBQUNIb0UsSUFBQUEsSUFBSSxnQkFDQTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FDTW5HLEtBQUssQ0FBQ0osSUFBTixJQUFjLG1DQUF1QkksS0FBdkIsQ0FBZCxJQUErQ0EsS0FBSyxDQUFDK0IsTUFEM0QsQ0FESjtBQUtIOztBQUVELHNCQUFPO0FBQUssSUFBQSxTQUFTLEVBQUM7QUFBZixrQkFDSCw2QkFBQyxtQkFBRDtBQUFZLElBQUEsSUFBSSxFQUFFMkQsS0FBbEI7QUFBeUIsSUFBQSxNQUFNLEVBQUUsRUFBakM7QUFBcUMsSUFBQSxLQUFLLEVBQUU7QUFBNUMsSUFERyxlQUVILHVEQUNJLHlDQUFNRCxLQUFOLENBREosRUFFTVUsSUFGTixDQUZHLENBQVA7QUFPSCxDQTdDTTs7OztBQStDUCxNQUFNSyx3QkFBMEMsR0FBRyxDQUFDO0FBQUV4RyxFQUFBQSxLQUFGO0FBQVN5RyxFQUFBQSxpQkFBVDtBQUE0QkMsRUFBQUEsa0JBQTVCO0FBQWdEbkcsRUFBQUE7QUFBaEQsQ0FBRCxLQUFrRTtBQUNqSCxRQUFNLENBQUNvRyxhQUFELEVBQWdCQyxnQkFBaEIsSUFBb0MscUJBQVM1RyxLQUFULENBQTFDO0FBRUEsc0JBQU8sNkJBQUMsbUJBQUQ7QUFDSCxJQUFBLEtBQUssZUFDRCw2QkFBQyxnQkFBRDtBQUNJLE1BQUEsS0FBSyxFQUFFLHlCQUFHLG9CQUFILENBRFg7QUFFSSxNQUFBLEtBQUssRUFBRUEsS0FGWDtBQUdJLE1BQUEsS0FBSyxFQUFFMkcsYUFIWDtBQUlJLE1BQUEsUUFBUSxFQUFFQztBQUpkLE1BRkQ7QUFTSCxJQUFBLFNBQVMsRUFBQyw2QkFUUDtBQVVILElBQUEsU0FBUyxFQUFDLHVCQVZQO0FBV0gsSUFBQSxVQUFVLEVBQUVyRyxVQVhUO0FBWUgsSUFBQSxVQUFVLEVBQUU7QUFaVCxrQkFjSCw2QkFBQyw0QkFBRCxDQUFxQixRQUFyQjtBQUE4QixJQUFBLEtBQUssRUFBRVAsS0FBSyxDQUFDZ0c7QUFBM0Msa0JBQ0ksNkJBQUMsa0JBQUQ7QUFDSSxJQUFBLEtBQUssRUFBRWhHLEtBRFg7QUFFSSxJQUFBLFVBQVUsRUFBRU8sVUFGaEI7QUFHSSxJQUFBLFlBQVksZUFBRSx5RUFDViwwQ0FBTyx5QkFBRyxpQ0FBSCxDQUFQLENBRFUsZUFFViw2QkFBQyx5QkFBRDtBQUNJLE1BQUEsSUFBSSxFQUFDLE1BRFQ7QUFFSSxNQUFBLE9BQU8sRUFBRSxNQUFNO0FBQ1hrRyxRQUFBQSxpQkFBaUI7QUFDakJsRyxRQUFBQSxVQUFVO0FBQ2I7QUFMTCxPQU9NLHlCQUFHLG1CQUFILENBUE4sQ0FGVSxDQUhsQjtBQWVJLElBQUEsaUJBQWlCLEVBQUUseUJBQUcsa0JBQUgsQ0FmdkI7QUFnQkksSUFBQSxhQUFhLEVBQUUwRSxvQkFoQm5CO0FBaUJJLElBQUEsY0FBYyxFQUFFLG1CQUNaO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSSx5Q0FBTSx5QkFBRyxRQUFILENBQU4sQ0FESixlQUVJLDZCQUFDLHlCQUFEO0FBQ0ksTUFBQSxJQUFJLEVBQUMsTUFEVDtBQUVJLE1BQUEsT0FBTyxFQUFFLE1BQU07QUFDWHlCLFFBQUFBLGtCQUFrQjtBQUNsQm5HLFFBQUFBLFVBQVU7QUFDYjtBQUxMLE9BT00seUJBQUcsMEJBQUgsQ0FQTixDQUZKLENBbEJSO0FBK0JJLElBQUEsV0FBVyxFQUFFZ0Y7QUEvQmpCLElBREosQ0FkRyxDQUFQO0FBa0RILENBckREOztlQXVEZWlCLHdCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IFJlYWN0Tm9kZSwgdXNlQ29udGV4dCwgdXNlTWVtbywgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5pbXBvcnQgeyBzbGVlcCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy91dGlsc1wiO1xuaW1wb3J0IHsgRXZlbnRUeXBlIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL0B0eXBlcy9ldmVudFwiO1xuXG5pbXBvcnQgeyBfdCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgQmFzZURpYWxvZyBmcm9tIFwiLi9CYXNlRGlhbG9nXCI7XG5pbXBvcnQgRHJvcGRvd24gZnJvbSBcIi4uL2VsZW1lbnRzL0Ryb3Bkb3duXCI7XG5pbXBvcnQgU2VhcmNoQm94IGZyb20gXCIuLi8uLi9zdHJ1Y3R1cmVzL1NlYXJjaEJveFwiO1xuaW1wb3J0IFNwYWNlU3RvcmUgZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9zcGFjZXMvU3BhY2VTdG9yZVwiO1xuaW1wb3J0IFJvb21BdmF0YXIgZnJvbSBcIi4uL2F2YXRhcnMvUm9vbUF2YXRhclwiO1xuaW1wb3J0IHsgZ2V0RGlzcGxheUFsaWFzRm9yUm9vbSB9IGZyb20gXCIuLi8uLi8uLi9Sb29tc1wiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCBBdXRvSGlkZVNjcm9sbGJhciBmcm9tIFwiLi4vLi4vc3RydWN0dXJlcy9BdXRvSGlkZVNjcm9sbGJhclwiO1xuaW1wb3J0IERNUm9vbU1hcCBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvRE1Sb29tTWFwXCI7XG5pbXBvcnQgeyBjYWxjdWxhdGVSb29tVmlhIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3Blcm1hbGlua3MvUGVybWFsaW5rc1wiO1xuaW1wb3J0IFN0eWxlZENoZWNrYm94IGZyb20gXCIuLi9lbGVtZW50cy9TdHlsZWRDaGVja2JveFwiO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCB7IHNvcnRSb29tcyB9IGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvcm9vbS1saXN0L2FsZ29yaXRobXMvdGFnLXNvcnRpbmcvUmVjZW50QWxnb3JpdGhtXCI7XG5pbXBvcnQgUHJvZ3Jlc3NCYXIgZnJvbSBcIi4uL2VsZW1lbnRzL1Byb2dyZXNzQmFyXCI7XG5pbXBvcnQgRGVjb3JhdGVkUm9vbUF2YXRhciBmcm9tIFwiLi4vYXZhdGFycy9EZWNvcmF0ZWRSb29tQXZhdGFyXCI7XG5pbXBvcnQgUXVlcnlNYXRjaGVyIGZyb20gXCIuLi8uLi8uLi9hdXRvY29tcGxldGUvUXVlcnlNYXRjaGVyXCI7XG5pbXBvcnQgVHJ1bmNhdGVkTGlzdCBmcm9tIFwiLi4vZWxlbWVudHMvVHJ1bmNhdGVkTGlzdFwiO1xuaW1wb3J0IEVudGl0eVRpbGUgZnJvbSBcIi4uL3Jvb21zL0VudGl0eVRpbGVcIjtcbmltcG9ydCBCYXNlQXZhdGFyIGZyb20gXCIuLi9hdmF0YXJzL0Jhc2VBdmF0YXJcIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBzcGFjZTogUm9vbTtcbiAgICBvbkNyZWF0ZVJvb21DbGljaygpOiB2b2lkO1xuICAgIG9uQWRkU3Vic3BhY2VDbGljaygpOiB2b2lkO1xuICAgIG9uRmluaXNoZWQoYWRkZWQ/OiBib29sZWFuKTogdm9pZDtcbn1cblxuZXhwb3J0IGNvbnN0IEVudHJ5ID0gKHsgcm9vbSwgY2hlY2tlZCwgb25DaGFuZ2UgfSkgPT4ge1xuICAgIHJldHVybiA8bGFiZWwgY2xhc3NOYW1lPVwibXhfQWRkRXhpc3RpbmdUb1NwYWNlX2VudHJ5XCI+XG4gICAgICAgIHsgcm9vbT8uaXNTcGFjZVJvb20oKVxuICAgICAgICAgICAgPyA8Um9vbUF2YXRhciByb29tPXtyb29tfSBoZWlnaHQ9ezMyfSB3aWR0aD17MzJ9IC8+XG4gICAgICAgICAgICA6IDxEZWNvcmF0ZWRSb29tQXZhdGFyIHJvb209e3Jvb219IGF2YXRhclNpemU9ezMyfSAvPlxuICAgICAgICB9XG4gICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X0FkZEV4aXN0aW5nVG9TcGFjZV9lbnRyeV9uYW1lXCI+eyByb29tLm5hbWUgfTwvc3Bhbj5cbiAgICAgICAgPFN0eWxlZENoZWNrYm94XG4gICAgICAgICAgICBvbkNoYW5nZT17b25DaGFuZ2UgPyAoZSkgPT4gb25DaGFuZ2UoZS50YXJnZXQuY2hlY2tlZCkgOiBudWxsfVxuICAgICAgICAgICAgY2hlY2tlZD17Y2hlY2tlZH1cbiAgICAgICAgICAgIGRpc2FibGVkPXshb25DaGFuZ2V9XG4gICAgICAgIC8+XG4gICAgPC9sYWJlbD47XG59O1xuXG5pbnRlcmZhY2UgSUFkZEV4aXN0aW5nVG9TcGFjZVByb3BzIHtcbiAgICBzcGFjZTogUm9vbTtcbiAgICBmb290ZXJQcm9tcHQ/OiBSZWFjdE5vZGU7XG4gICAgZmlsdGVyUGxhY2Vob2xkZXI6IHN0cmluZztcbiAgICBlbXB0eVNlbGVjdGlvbkJ1dHRvbj86IFJlYWN0Tm9kZTtcbiAgICBvbkZpbmlzaGVkKGFkZGVkOiBib29sZWFuKTogdm9pZDtcbiAgICByb29tc1JlbmRlcmVyPyhcbiAgICAgICAgcm9vbXM6IFJvb21bXSxcbiAgICAgICAgc2VsZWN0ZWRUb0FkZDogU2V0PFJvb20+LFxuICAgICAgICBvbkNoYW5nZTogdW5kZWZpbmVkIHwgKChjaGVja2VkOiBib29sZWFuLCByb29tOiBSb29tKSA9PiB2b2lkKSxcbiAgICAgICAgdHJ1bmNhdGVBdDogbnVtYmVyLFxuICAgICAgICBvdmVyZmxvd1RpbGU6IChvdmVyZmxvd0NvdW50OiBudW1iZXIsIHRvdGFsQ291bnQ6IG51bWJlcikgPT4gSlNYLkVsZW1lbnQsXG4gICAgKTogUmVhY3ROb2RlO1xuICAgIHNwYWNlc1JlbmRlcmVyPyhcbiAgICAgICAgc3BhY2VzOiBSb29tW10sXG4gICAgICAgIHNlbGVjdGVkVG9BZGQ6IFNldDxSb29tPixcbiAgICAgICAgb25DaGFuZ2U/OiAoY2hlY2tlZDogYm9vbGVhbiwgcm9vbTogUm9vbSkgPT4gdm9pZCxcbiAgICApOiBSZWFjdE5vZGU7XG4gICAgZG1zUmVuZGVyZXI/KFxuICAgICAgICBkbXM6IFJvb21bXSxcbiAgICAgICAgc2VsZWN0ZWRUb0FkZDogU2V0PFJvb20+LFxuICAgICAgICBvbkNoYW5nZT86IChjaGVja2VkOiBib29sZWFuLCByb29tOiBSb29tKSA9PiB2b2lkLFxuICAgICk6IFJlYWN0Tm9kZTtcbn1cblxuZXhwb3J0IGNvbnN0IEFkZEV4aXN0aW5nVG9TcGFjZTogUmVhY3QuRkM8SUFkZEV4aXN0aW5nVG9TcGFjZVByb3BzPiA9ICh7XG4gICAgc3BhY2UsXG4gICAgZm9vdGVyUHJvbXB0LFxuICAgIGVtcHR5U2VsZWN0aW9uQnV0dG9uLFxuICAgIGZpbHRlclBsYWNlaG9sZGVyLFxuICAgIHJvb21zUmVuZGVyZXIsXG4gICAgZG1zUmVuZGVyZXIsXG4gICAgc3BhY2VzUmVuZGVyZXIsXG4gICAgb25GaW5pc2hlZCxcbn0pID0+IHtcbiAgICBjb25zdCBjbGkgPSB1c2VDb250ZXh0KE1hdHJpeENsaWVudENvbnRleHQpO1xuICAgIGNvbnN0IHZpc2libGVSb29tcyA9IHVzZU1lbW8oKCkgPT4gY2xpLmdldFZpc2libGVSb29tcygpLmZpbHRlcihyID0+IHIuZ2V0TXlNZW1iZXJzaGlwKCkgPT09IFwiam9pblwiKSwgW2NsaV0pO1xuXG4gICAgY29uc3QgW3NlbGVjdGVkVG9BZGQsIHNldFNlbGVjdGVkVG9BZGRdID0gdXNlU3RhdGUobmV3IFNldDxSb29tPigpKTtcbiAgICBjb25zdCBbcHJvZ3Jlc3MsIHNldFByb2dyZXNzXSA9IHVzZVN0YXRlPG51bWJlcj4obnVsbCk7XG4gICAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZTxFcnJvcj4obnVsbCk7XG4gICAgY29uc3QgW3F1ZXJ5LCBzZXRRdWVyeV0gPSB1c2VTdGF0ZShcIlwiKTtcbiAgICBjb25zdCBsY1F1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7XG5cbiAgICBjb25zdCBleGlzdGluZ1N1YnNwYWNlc1NldCA9IHVzZU1lbW8oKCkgPT4gbmV3IFNldChTcGFjZVN0b3JlLmluc3RhbmNlLmdldENoaWxkU3BhY2VzKHNwYWNlLnJvb21JZCkpLCBbc3BhY2VdKTtcbiAgICBjb25zdCBleGlzdGluZ1Jvb21zU2V0ID0gdXNlTWVtbygoKSA9PiBuZXcgU2V0KFNwYWNlU3RvcmUuaW5zdGFuY2UuZ2V0Q2hpbGRSb29tcyhzcGFjZS5yb29tSWQpKSwgW3NwYWNlXSk7XG5cbiAgICBjb25zdCBbc3BhY2VzLCByb29tcywgZG1zXSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgICBsZXQgcm9vbXMgPSB2aXNpYmxlUm9vbXM7XG5cbiAgICAgICAgaWYgKGxjUXVlcnkpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoZXIgPSBuZXcgUXVlcnlNYXRjaGVyPFJvb20+KHZpc2libGVSb29tcywge1xuICAgICAgICAgICAgICAgIGtleXM6IFtcIm5hbWVcIl0sXG4gICAgICAgICAgICAgICAgZnVuY3M6IFtyID0+IFtyLmdldENhbm9uaWNhbEFsaWFzKCksIC4uLnIuZ2V0QWx0QWxpYXNlcygpXS5maWx0ZXIoQm9vbGVhbildLFxuICAgICAgICAgICAgICAgIHNob3VsZE1hdGNoV29yZHNPbmx5OiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByb29tcyA9IG1hdGNoZXIubWF0Y2gobGNRdWVyeSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBqb2luUnVsZSA9IHNwYWNlLmdldEpvaW5SdWxlKCk7XG4gICAgICAgIHJldHVybiBzb3J0Um9vbXMocm9vbXMpLnJlZHVjZSgoYXJyLCByb29tKSA9PiB7XG4gICAgICAgICAgICBpZiAocm9vbS5pc1NwYWNlUm9vbSgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJvb20gIT09IHNwYWNlICYmICFleGlzdGluZ1N1YnNwYWNlc1NldC5oYXMocm9vbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyWzBdLnB1c2gocm9vbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICghZXhpc3RpbmdSb29tc1NldC5oYXMocm9vbSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIURNUm9vbU1hcC5zaGFyZWQoKS5nZXRVc2VySWRGb3JSb29tSWQocm9vbS5yb29tSWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFyclsxXS5wdXNoKHJvb20pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoam9pblJ1bGUgIT09IFwicHVibGljXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBzaG93IERNcyBmb3Igbm9uLXB1YmxpYyBzcGFjZXMgYXMgdGhleSBtYWtlIHZlcnkgbGl0dGxlIHNlbnNlIGluIHNwYWNlcyBvdGhlciB0aGFuIFwiSnVzdCBNZVwiIG9uZXMuXG4gICAgICAgICAgICAgICAgICAgIGFyclsyXS5wdXNoKHJvb20pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhcnI7XG4gICAgICAgIH0sIFtbXSwgW10sIFtdXSk7XG4gICAgfSwgW3Zpc2libGVSb29tcywgc3BhY2UsIGxjUXVlcnksIGV4aXN0aW5nUm9vbXNTZXQsIGV4aXN0aW5nU3Vic3BhY2VzU2V0XSk7XG5cbiAgICBjb25zdCBhZGRSb29tcyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgc2V0RXJyb3IobnVsbCk7XG4gICAgICAgIHNldFByb2dyZXNzKDApO1xuXG4gICAgICAgIGxldCBlcnJvcjtcblxuICAgICAgICBmb3IgKGNvbnN0IHJvb20gb2Ygc2VsZWN0ZWRUb0FkZCkge1xuICAgICAgICAgICAgY29uc3QgdmlhID0gY2FsY3VsYXRlUm9vbVZpYShyb29tKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgU3BhY2VTdG9yZS5pbnN0YW5jZS5hZGRSb29tVG9TcGFjZShzcGFjZSwgcm9vbS5yb29tSWQsIHZpYSkuY2F0Y2goYXN5bmMgZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmVycmNvZGUgPT09IFwiTV9MSU1JVF9FWENFRURFRFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzbGVlcChlLmRhdGEucmV0cnlfYWZ0ZXJfbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNwYWNlU3RvcmUuaW5zdGFuY2UuYWRkUm9vbVRvU3BhY2Uoc3BhY2UsIHJvb20ucm9vbUlkLCB2aWEpOyAvLyByZXRyeVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZXRQcm9ncmVzcyhpID0+IGkgKyAxKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJGYWlsZWQgdG8gYWRkIHJvb21zIHRvIHNwYWNlXCIsIGUpO1xuICAgICAgICAgICAgICAgIHNldEVycm9yKGVycm9yID0gZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWVycm9yKSB7XG4gICAgICAgICAgICBvbkZpbmlzaGVkKHRydWUpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGJ1c3kgPSBwcm9ncmVzcyAhPT0gbnVsbDtcblxuICAgIGxldCBmb290ZXI7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGZvb3RlciA9IDw+XG4gICAgICAgICAgICA8aW1nXG4gICAgICAgICAgICAgICAgc3JjPXtyZXF1aXJlKFwiLi4vLi4vLi4vLi4vcmVzL2ltZy9lbGVtZW50LWljb25zL3dhcm5pbmctYmFkZ2Uuc3ZnXCIpfVxuICAgICAgICAgICAgICAgIGhlaWdodD1cIjI0XCJcbiAgICAgICAgICAgICAgICB3aWR0aD1cIjI0XCJcbiAgICAgICAgICAgICAgICBhbHQ9XCJcIlxuICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfQWRkRXhpc3RpbmdUb1NwYWNlRGlhbG9nX2Vycm9yXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9BZGRFeGlzdGluZ1RvU3BhY2VEaWFsb2dfZXJyb3JIZWFkaW5nXCI+eyBfdChcIk5vdCBhbGwgc2VsZWN0ZWQgd2VyZSBhZGRlZFwiKSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9BZGRFeGlzdGluZ1RvU3BhY2VEaWFsb2dfZXJyb3JDYXB0aW9uXCI+eyBfdChcIlRyeSBhZ2FpblwiKSB9PC9kaXY+XG4gICAgICAgICAgICA8L3NwYW4+XG5cbiAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGNsYXNzTmFtZT1cIm14X0FkZEV4aXN0aW5nVG9TcGFjZURpYWxvZ19yZXRyeUJ1dHRvblwiIG9uQ2xpY2s9e2FkZFJvb21zfT5cbiAgICAgICAgICAgICAgICB7IF90KFwiUmV0cnlcIikgfVxuICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICA8Lz47XG4gICAgfSBlbHNlIGlmIChidXN5KSB7XG4gICAgICAgIGZvb3RlciA9IDxzcGFuPlxuICAgICAgICAgICAgPFByb2dyZXNzQmFyIHZhbHVlPXtwcm9ncmVzc30gbWF4PXtzZWxlY3RlZFRvQWRkLnNpemV9IC8+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0FkZEV4aXN0aW5nVG9TcGFjZURpYWxvZ19wcm9ncmVzc1RleHRcIj5cbiAgICAgICAgICAgICAgICB7IF90KFwiQWRkaW5nIHJvb21zLi4uICglKHByb2dyZXNzKXMgb3V0IG9mICUoY291bnQpcylcIiwge1xuICAgICAgICAgICAgICAgICAgICBjb3VudDogc2VsZWN0ZWRUb0FkZC5zaXplLFxuICAgICAgICAgICAgICAgICAgICBwcm9ncmVzcyxcbiAgICAgICAgICAgICAgICB9KSB9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9zcGFuPjtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgYnV0dG9uID0gZW1wdHlTZWxlY3Rpb25CdXR0b247XG4gICAgICAgIGlmICghYnV0dG9uIHx8IHNlbGVjdGVkVG9BZGQuc2l6ZSA+IDApIHtcbiAgICAgICAgICAgIGJ1dHRvbiA9IDxBY2Nlc3NpYmxlQnV0dG9uIGtpbmQ9XCJwcmltYXJ5XCIgZGlzYWJsZWQ9e3NlbGVjdGVkVG9BZGQuc2l6ZSA8IDF9IG9uQ2xpY2s9e2FkZFJvb21zfT5cbiAgICAgICAgICAgICAgICB7IF90KFwiQWRkXCIpIH1cbiAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj47XG4gICAgICAgIH1cblxuICAgICAgICBmb290ZXIgPSA8PlxuICAgICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICAgICAgeyBmb290ZXJQcm9tcHQgfVxuICAgICAgICAgICAgPC9zcGFuPlxuXG4gICAgICAgICAgICB7IGJ1dHRvbiB9XG4gICAgICAgIDwvPjtcbiAgICB9XG5cbiAgICBjb25zdCBvbkNoYW5nZSA9ICFidXN5ICYmICFlcnJvciA/IChjaGVja2VkOiBib29sZWFuLCByb29tOiBSb29tKSA9PiB7XG4gICAgICAgIGlmIChjaGVja2VkKSB7XG4gICAgICAgICAgICBzZWxlY3RlZFRvQWRkLmFkZChyb29tKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNlbGVjdGVkVG9BZGQuZGVsZXRlKHJvb20pO1xuICAgICAgICB9XG4gICAgICAgIHNldFNlbGVjdGVkVG9BZGQobmV3IFNldChzZWxlY3RlZFRvQWRkKSk7XG4gICAgfSA6IG51bGw7XG5cbiAgICBjb25zdCBbdHJ1bmNhdGVBdCwgc2V0VHJ1bmNhdGVBdF0gPSB1c2VTdGF0ZSgyMCk7XG4gICAgZnVuY3Rpb24gb3ZlcmZsb3dUaWxlKG92ZXJmbG93Q291bnQ6IG51bWJlciwgdG90YWxDb3VudDogbnVtYmVyKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBjb25zdCB0ZXh0ID0gX3QoXCJhbmQgJShjb3VudClzIG90aGVycy4uLlwiLCB7IGNvdW50OiBvdmVyZmxvd0NvdW50IH0pO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEVudGl0eVRpbGVcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9FbnRpdHlUaWxlX2VsbGlwc2lzXCJcbiAgICAgICAgICAgICAgICBhdmF0YXJKc3g9e1xuICAgICAgICAgICAgICAgICAgICA8QmFzZUF2YXRhciB1cmw9e3JlcXVpcmUoXCIuLi8uLi8uLi8uLi9yZXMvaW1nL2VsbGlwc2lzLnN2Z1wiKX0gbmFtZT1cIi4uLlwiIHdpZHRoPXszNn0gaGVpZ2h0PXszNn0gLz5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmFtZT17dGV4dH1cbiAgICAgICAgICAgICAgICBwcmVzZW5jZVN0YXRlPVwib25saW5lXCJcbiAgICAgICAgICAgICAgICBzdXBwcmVzc09uSG92ZXI9e3RydWV9XG4gICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0VHJ1bmNhdGVBdCh0b3RhbENvdW50KX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgbGV0IG5vUmVzdWx0cyA9IHRydWU7XG4gICAgaWYgKChyb29tc1JlbmRlcmVyICYmIHJvb21zLmxlbmd0aCA+IDApIHx8XG4gICAgICAgIChkbXNSZW5kZXJlciAmJiBkbXMubGVuZ3RoID4gMCkgfHxcbiAgICAgICAgKCFyb29tc1JlbmRlcmVyICYmICFkbXNSZW5kZXJlciAmJiBzcGFjZXNSZW5kZXJlciAmJiBzcGFjZXMubGVuZ3RoID4gMCkgLy8gb25seSBjb3VudCBzcGFjZXMgd2hlbiBhbG9uZVxuICAgICkge1xuICAgICAgICBub1Jlc3VsdHMgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJteF9BZGRFeGlzdGluZ1RvU3BhY2VcIj5cbiAgICAgICAgPFNlYXJjaEJveFxuICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfdGV4dGlucHV0X2ljb24gbXhfdGV4dGlucHV0X3NlYXJjaFwiXG4gICAgICAgICAgICBwbGFjZWhvbGRlcj17ZmlsdGVyUGxhY2Vob2xkZXJ9XG4gICAgICAgICAgICBvblNlYXJjaD17c2V0UXVlcnl9XG4gICAgICAgICAgICBhdXRvRm9jdXM9e3RydWV9XG4gICAgICAgIC8+XG4gICAgICAgIDxBdXRvSGlkZVNjcm9sbGJhciBjbGFzc05hbWU9XCJteF9BZGRFeGlzdGluZ1RvU3BhY2VfY29udGVudFwiPlxuICAgICAgICAgICAgeyByb29tcy5sZW5ndGggPiAwICYmIHJvb21zUmVuZGVyZXIgPyAoXG4gICAgICAgICAgICAgICAgcm9vbXNSZW5kZXJlcihyb29tcywgc2VsZWN0ZWRUb0FkZCwgb25DaGFuZ2UsIHRydW5jYXRlQXQsIG92ZXJmbG93VGlsZSlcbiAgICAgICAgICAgICkgOiB1bmRlZmluZWQgfVxuXG4gICAgICAgICAgICB7IHNwYWNlcy5sZW5ndGggPiAwICYmIHNwYWNlc1JlbmRlcmVyID8gKFxuICAgICAgICAgICAgICAgIHNwYWNlc1JlbmRlcmVyKHNwYWNlcywgc2VsZWN0ZWRUb0FkZCwgb25DaGFuZ2UpXG4gICAgICAgICAgICApIDogbnVsbCB9XG5cbiAgICAgICAgICAgIHsgZG1zLmxlbmd0aCA+IDAgJiYgZG1zUmVuZGVyZXIgPyAoXG4gICAgICAgICAgICAgICAgZG1zUmVuZGVyZXIoZG1zLCBzZWxlY3RlZFRvQWRkLCBvbkNoYW5nZSlcbiAgICAgICAgICAgICkgOiBudWxsIH1cblxuICAgICAgICAgICAgeyBub1Jlc3VsdHMgPyA8c3BhbiBjbGFzc05hbWU9XCJteF9BZGRFeGlzdGluZ1RvU3BhY2Vfbm9SZXN1bHRzXCI+XG4gICAgICAgICAgICAgICAgeyBfdChcIk5vIHJlc3VsdHNcIikgfVxuICAgICAgICAgICAgPC9zcGFuPiA6IHVuZGVmaW5lZCB9XG4gICAgICAgIDwvQXV0b0hpZGVTY3JvbGxiYXI+XG5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9BZGRFeGlzdGluZ1RvU3BhY2VfZm9vdGVyXCI+XG4gICAgICAgICAgICB7IGZvb3RlciB9XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2Pjtcbn07XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0Um9vbXNSZW5kZXJlcjogSUFkZEV4aXN0aW5nVG9TcGFjZVByb3BzW1wicm9vbXNSZW5kZXJlclwiXSA9IChcbiAgICByb29tcywgc2VsZWN0ZWRUb0FkZCwgb25DaGFuZ2UsIHRydW5jYXRlQXQsIG92ZXJmbG93VGlsZSxcbikgPT4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQWRkRXhpc3RpbmdUb1NwYWNlX3NlY3Rpb25cIj5cbiAgICAgICAgPGgzPnsgX3QoXCJSb29tc1wiKSB9PC9oMz5cbiAgICAgICAgPFRydW5jYXRlZExpc3RcbiAgICAgICAgICAgIHRydW5jYXRlQXQ9e3RydW5jYXRlQXR9XG4gICAgICAgICAgICBjcmVhdGVPdmVyZmxvd0VsZW1lbnQ9e292ZXJmbG93VGlsZX1cbiAgICAgICAgICAgIGdldENoaWxkcmVuPXsoc3RhcnQsIGVuZCkgPT4gcm9vbXMuc2xpY2Uoc3RhcnQsIGVuZCkubWFwKHJvb20gPT5cbiAgICAgICAgICAgICAgICA8RW50cnlcbiAgICAgICAgICAgICAgICAgICAga2V5PXtyb29tLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgcm9vbT17cm9vbX1cbiAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17c2VsZWN0ZWRUb0FkZC5oYXMocm9vbSl9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtvbkNoYW5nZSA/IChjaGVja2VkOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZShjaGVja2VkLCByb29tKTtcbiAgICAgICAgICAgICAgICAgICAgfSA6IG51bGx9XG4gICAgICAgICAgICAgICAgLz4sXG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgZ2V0Q2hpbGRDb3VudD17KCkgPT4gcm9vbXMubGVuZ3RofVxuICAgICAgICAvPlxuICAgIDwvZGl2PlxuKTtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRTcGFjZXNSZW5kZXJlcjogSUFkZEV4aXN0aW5nVG9TcGFjZVByb3BzW1wic3BhY2VzUmVuZGVyZXJcIl0gPSAoc3BhY2VzLCBzZWxlY3RlZFRvQWRkLCBvbkNoYW5nZSkgPT4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQWRkRXhpc3RpbmdUb1NwYWNlX3NlY3Rpb25cIj5cbiAgICAgICAgeyBzcGFjZXMubWFwKHNwYWNlID0+IHtcbiAgICAgICAgICAgIHJldHVybiA8RW50cnlcbiAgICAgICAgICAgICAgICBrZXk9e3NwYWNlLnJvb21JZH1cbiAgICAgICAgICAgICAgICByb29tPXtzcGFjZX1cbiAgICAgICAgICAgICAgICBjaGVja2VkPXtzZWxlY3RlZFRvQWRkLmhhcyhzcGFjZSl9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e29uQ2hhbmdlID8gKGNoZWNrZWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2UoY2hlY2tlZCwgc3BhY2UpO1xuICAgICAgICAgICAgICAgIH0gOiBudWxsfVxuICAgICAgICAgICAgLz47XG4gICAgICAgIH0pIH1cbiAgICA8L2Rpdj5cbik7XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0RG1zUmVuZGVyZXI6IElBZGRFeGlzdGluZ1RvU3BhY2VQcm9wc1tcImRtc1JlbmRlcmVyXCJdID0gKGRtcywgc2VsZWN0ZWRUb0FkZCwgb25DaGFuZ2UpID0+IChcbiAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0FkZEV4aXN0aW5nVG9TcGFjZV9zZWN0aW9uXCI+XG4gICAgICAgIDxoMz57IF90KFwiRGlyZWN0IE1lc3NhZ2VzXCIpIH08L2gzPlxuICAgICAgICB7IGRtcy5tYXAocm9vbSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gPEVudHJ5XG4gICAgICAgICAgICAgICAga2V5PXtyb29tLnJvb21JZH1cbiAgICAgICAgICAgICAgICByb29tPXtyb29tfVxuICAgICAgICAgICAgICAgIGNoZWNrZWQ9e3NlbGVjdGVkVG9BZGQuaGFzKHJvb20pfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtvbkNoYW5nZSA/IChjaGVja2VkOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlKGNoZWNrZWQsIHJvb20pO1xuICAgICAgICAgICAgICAgIH0gOiBudWxsfVxuICAgICAgICAgICAgLz47XG4gICAgICAgIH0pIH1cbiAgICA8L2Rpdj5cbik7XG5cbmludGVyZmFjZSBJU3Vic3BhY2VTZWxlY3RvclByb3BzIHtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIHNwYWNlOiBSb29tO1xuICAgIHZhbHVlOiBSb29tO1xuICAgIG9uQ2hhbmdlKHNwYWNlOiBSb29tKTogdm9pZDtcbn1cblxuZXhwb3J0IGNvbnN0IFN1YnNwYWNlU2VsZWN0b3IgPSAoeyB0aXRsZSwgc3BhY2UsIHZhbHVlLCBvbkNoYW5nZSB9OiBJU3Vic3BhY2VTZWxlY3RvclByb3BzKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgICByZXR1cm4gW3NwYWNlLCAuLi5TcGFjZVN0b3JlLmluc3RhbmNlLmdldENoaWxkU3BhY2VzKHNwYWNlLnJvb21JZCkuZmlsdGVyKHNwYWNlID0+IHtcbiAgICAgICAgICAgIHJldHVybiBzcGFjZS5jdXJyZW50U3RhdGUubWF5U2VuZFN0YXRlRXZlbnQoRXZlbnRUeXBlLlNwYWNlQ2hpbGQsIHNwYWNlLmNsaWVudC5jcmVkZW50aWFscy51c2VySWQpO1xuICAgICAgICB9KV07XG4gICAgfSwgW3NwYWNlXSk7XG5cbiAgICBsZXQgYm9keTtcbiAgICBpZiAob3B0aW9ucy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGJvZHkgPSAoXG4gICAgICAgICAgICA8RHJvcGRvd25cbiAgICAgICAgICAgICAgICBpZD1cIm14X1NwYWNlU2VsZWN0RHJvcGRvd25cIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1NwYWNlU2VsZWN0RHJvcGRvd25cIlxuICAgICAgICAgICAgICAgIG9uT3B0aW9uQ2hhbmdlPXsoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2Uob3B0aW9ucy5maW5kKHNwYWNlID0+IHNwYWNlLnJvb21JZCA9PT0ga2V5KSB8fCBzcGFjZSk7XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWUucm9vbUlkfVxuICAgICAgICAgICAgICAgIGxhYmVsPXtfdChcIlNwYWNlIHNlbGVjdGlvblwiKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7IG9wdGlvbnMubWFwKChzcGFjZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjbGFzc2VzID0gY2xhc3NOYW1lcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBteF9TdWJzcGFjZVNlbGVjdG9yX2Ryb3Bkb3duT3B0aW9uQWN0aXZlOiBzcGFjZSA9PT0gdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gPGRpdiBrZXk9e3NwYWNlLnJvb21JZH0gY2xhc3NOYW1lPXtjbGFzc2VzfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSb29tQXZhdGFyIHJvb209e3NwYWNlfSB3aWR0aD17MjR9IGhlaWdodD17MjR9IC8+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHNwYWNlLm5hbWUgfHwgZ2V0RGlzcGxheUFsaWFzRm9yUm9vbShzcGFjZSkgfHwgc3BhY2Uucm9vbUlkIH1cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICAgICAgICAgIH0pIH1cbiAgICAgICAgICAgIDwvRHJvcGRvd24+XG4gICAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYm9keSA9IChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU3Vic3BhY2VTZWxlY3Rvcl9vbmx5U3BhY2VcIj5cbiAgICAgICAgICAgICAgICB7IHNwYWNlLm5hbWUgfHwgZ2V0RGlzcGxheUFsaWFzRm9yUm9vbShzcGFjZSkgfHwgc3BhY2Uucm9vbUlkIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X1N1YnNwYWNlU2VsZWN0b3JcIj5cbiAgICAgICAgPFJvb21BdmF0YXIgcm9vbT17dmFsdWV9IGhlaWdodD17NDB9IHdpZHRoPXs0MH0gLz5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxoMT57IHRpdGxlIH08L2gxPlxuICAgICAgICAgICAgeyBib2R5IH1cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+O1xufTtcblxuY29uc3QgQWRkRXhpc3RpbmdUb1NwYWNlRGlhbG9nOiBSZWFjdC5GQzxJUHJvcHM+ID0gKHsgc3BhY2UsIG9uQ3JlYXRlUm9vbUNsaWNrLCBvbkFkZFN1YnNwYWNlQ2xpY2ssIG9uRmluaXNoZWQgfSkgPT4ge1xuICAgIGNvbnN0IFtzZWxlY3RlZFNwYWNlLCBzZXRTZWxlY3RlZFNwYWNlXSA9IHVzZVN0YXRlKHNwYWNlKTtcblxuICAgIHJldHVybiA8QmFzZURpYWxvZ1xuICAgICAgICB0aXRsZT17KFxuICAgICAgICAgICAgPFN1YnNwYWNlU2VsZWN0b3JcbiAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJBZGQgZXhpc3Rpbmcgcm9vbXNcIil9XG4gICAgICAgICAgICAgICAgc3BhY2U9e3NwYWNlfVxuICAgICAgICAgICAgICAgIHZhbHVlPXtzZWxlY3RlZFNwYWNlfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtzZXRTZWxlY3RlZFNwYWNlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgICAgY2xhc3NOYW1lPVwibXhfQWRkRXhpc3RpbmdUb1NwYWNlRGlhbG9nXCJcbiAgICAgICAgY29udGVudElkPVwibXhfQWRkRXhpc3RpbmdUb1NwYWNlXCJcbiAgICAgICAgb25GaW5pc2hlZD17b25GaW5pc2hlZH1cbiAgICAgICAgZml4ZWRXaWR0aD17ZmFsc2V9XG4gICAgPlxuICAgICAgICA8TWF0cml4Q2xpZW50Q29udGV4dC5Qcm92aWRlciB2YWx1ZT17c3BhY2UuY2xpZW50fT5cbiAgICAgICAgICAgIDxBZGRFeGlzdGluZ1RvU3BhY2VcbiAgICAgICAgICAgICAgICBzcGFjZT17c3BhY2V9XG4gICAgICAgICAgICAgICAgb25GaW5pc2hlZD17b25GaW5pc2hlZH1cbiAgICAgICAgICAgICAgICBmb290ZXJQcm9tcHQ9ezw+XG4gICAgICAgICAgICAgICAgICAgIDxkaXY+eyBfdChcIldhbnQgdG8gYWRkIGEgbmV3IHJvb20gaW5zdGVhZD9cIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAga2luZD1cImxpbmtcIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ3JlYXRlUm9vbUNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GaW5pc2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkNyZWF0ZSBhIG5ldyByb29tXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgIDwvPn1cbiAgICAgICAgICAgICAgICBmaWx0ZXJQbGFjZWhvbGRlcj17X3QoXCJTZWFyY2ggZm9yIHJvb21zXCIpfVxuICAgICAgICAgICAgICAgIHJvb21zUmVuZGVyZXI9e2RlZmF1bHRSb29tc1JlbmRlcmVyfVxuICAgICAgICAgICAgICAgIHNwYWNlc1JlbmRlcmVyPXsoKSA9PiAoXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQWRkRXhpc3RpbmdUb1NwYWNlX3NlY3Rpb25cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxoMz57IF90KFwiU3BhY2VzXCIpIH08L2gzPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBraW5kPVwibGlua1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkFkZFN1YnNwYWNlQ2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GaW5pc2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkFkZGluZyBzcGFjZXMgaGFzIG1vdmVkLlwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgZG1zUmVuZGVyZXI9e2RlZmF1bHREbXNSZW5kZXJlcn1cbiAgICAgICAgICAgIC8+XG4gICAgICAgIDwvTWF0cml4Q2xpZW50Q29udGV4dC5Qcm92aWRlcj5cbiAgICA8L0Jhc2VEaWFsb2c+O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgQWRkRXhpc3RpbmdUb1NwYWNlRGlhbG9nO1xuXG4iXX0=