"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ROOM_SECURITY_TAB = exports.ROOM_ROLES_TAB = exports.ROOM_NOTIFICATIONS_TAB = exports.ROOM_GENERAL_TAB = exports.ROOM_BRIDGES_TAB = exports.ROOM_ADVANCED_TAB = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _TabbedView = _interopRequireWildcard(require("../../structures/TabbedView"));

var _languageHandler = require("../../../languageHandler");

var _AdvancedRoomSettingsTab = _interopRequireDefault(require("../settings/tabs/room/AdvancedRoomSettingsTab"));

var _RolesRoomSettingsTab = _interopRequireDefault(require("../settings/tabs/room/RolesRoomSettingsTab"));

var _GeneralRoomSettingsTab = _interopRequireDefault(require("../settings/tabs/room/GeneralRoomSettingsTab"));

var _SecurityRoomSettingsTab = _interopRequireDefault(require("../settings/tabs/room/SecurityRoomSettingsTab"));

var _NotificationSettingsTab = _interopRequireDefault(require("../settings/tabs/room/NotificationSettingsTab"));

var _BridgeSettingsTab = _interopRequireDefault(require("../settings/tabs/room/BridgeSettingsTab"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _UIFeature = require("../../../settings/UIFeature");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const ROOM_GENERAL_TAB = "ROOM_GENERAL_TAB";
exports.ROOM_GENERAL_TAB = ROOM_GENERAL_TAB;
const ROOM_SECURITY_TAB = "ROOM_SECURITY_TAB";
exports.ROOM_SECURITY_TAB = ROOM_SECURITY_TAB;
const ROOM_ROLES_TAB = "ROOM_ROLES_TAB";
exports.ROOM_ROLES_TAB = ROOM_ROLES_TAB;
const ROOM_NOTIFICATIONS_TAB = "ROOM_NOTIFICATIONS_TAB";
exports.ROOM_NOTIFICATIONS_TAB = ROOM_NOTIFICATIONS_TAB;
const ROOM_BRIDGES_TAB = "ROOM_BRIDGES_TAB";
exports.ROOM_BRIDGES_TAB = ROOM_BRIDGES_TAB;
const ROOM_ADVANCED_TAB = "ROOM_ADVANCED_TAB";
exports.ROOM_ADVANCED_TAB = ROOM_ADVANCED_TAB;
let RoomSettingsDialog = (_dec = (0, _replaceableComponent.replaceableComponent)("views.dialogs.RoomSettingsDialog"), _dec(_class = class RoomSettingsDialog extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "onAction", payload => {
      // When view changes below us, close the room settings
      // whilst the modal is open this can only be triggered when someone hits Leave Room
      if (payload.action === 'view_home_page') {
        this.props.onFinished(true);
      }
    });
    (0, _defineProperty2.default)(this, "onRoomName", () => {
      this.setState({
        roomName: _MatrixClientPeg.MatrixClientPeg.get().getRoom(this.props.roomId).name
      });
    });
    this.state = {
      roomName: ''
    };
  }

  componentDidMount() {
    this.dispatcherRef = _dispatcher.default.register(this.onAction);

    _MatrixClientPeg.MatrixClientPeg.get().on("Room.name", this.onRoomName);

    this.onRoomName();
  }

  componentWillUnmount() {
    if (this.dispatcherRef) {
      _dispatcher.default.unregister(this.dispatcherRef);
    }

    _MatrixClientPeg.MatrixClientPeg.get().removeListener("Room.name", this.onRoomName);
  }

  getTabs() {
    const tabs = [];
    tabs.push(new _TabbedView.Tab(ROOM_GENERAL_TAB, (0, _languageHandler._td)("General"), "mx_RoomSettingsDialog_settingsIcon", /*#__PURE__*/_react.default.createElement(_GeneralRoomSettingsTab.default, {
      roomId: this.props.roomId
    })));
    tabs.push(new _TabbedView.Tab(ROOM_SECURITY_TAB, (0, _languageHandler._td)("Security & Privacy"), "mx_RoomSettingsDialog_securityIcon", /*#__PURE__*/_react.default.createElement(_SecurityRoomSettingsTab.default, {
      roomId: this.props.roomId,
      closeSettingsFn: () => this.props.onFinished(true)
    })));
    tabs.push(new _TabbedView.Tab(ROOM_ROLES_TAB, (0, _languageHandler._td)("Roles & Permissions"), "mx_RoomSettingsDialog_rolesIcon", /*#__PURE__*/_react.default.createElement(_RolesRoomSettingsTab.default, {
      roomId: this.props.roomId
    })));
    tabs.push(new _TabbedView.Tab(ROOM_NOTIFICATIONS_TAB, (0, _languageHandler._td)("Notifications"), "mx_RoomSettingsDialog_notificationsIcon", /*#__PURE__*/_react.default.createElement(_NotificationSettingsTab.default, {
      roomId: this.props.roomId,
      closeSettingsFn: () => this.props.onFinished(true)
    })));

    if (_SettingsStore.default.getValue("feature_bridge_state")) {
      tabs.push(new _TabbedView.Tab(ROOM_BRIDGES_TAB, (0, _languageHandler._td)("Bridges"), "mx_RoomSettingsDialog_bridgesIcon", /*#__PURE__*/_react.default.createElement(_BridgeSettingsTab.default, {
        roomId: this.props.roomId
      })));
    }

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.AdvancedSettings)) {
      tabs.push(new _TabbedView.Tab(ROOM_ADVANCED_TAB, (0, _languageHandler._td)("Advanced"), "mx_RoomSettingsDialog_warningIcon", /*#__PURE__*/_react.default.createElement(_AdvancedRoomSettingsTab.default, {
        roomId: this.props.roomId,
        closeSettingsFn: () => this.props.onFinished(true)
      })));
    }

    return tabs;
  }

  render() {
    const roomName = this.state.roomName;
    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_RoomSettingsDialog",
      hasCancel: true,
      onFinished: this.props.onFinished,
      title: (0, _languageHandler._t)("Room Settings - %(roomName)s", {
        roomName
      })
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsDialog_content"
    }, /*#__PURE__*/_react.default.createElement(_TabbedView.default, {
      tabs: this.getTabs(),
      initialTabId: this.props.initialTabId
    })));
  }

}) || _class);
exports.default = RoomSettingsDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvUm9vbVNldHRpbmdzRGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJST09NX0dFTkVSQUxfVEFCIiwiUk9PTV9TRUNVUklUWV9UQUIiLCJST09NX1JPTEVTX1RBQiIsIlJPT01fTk9USUZJQ0FUSU9OU19UQUIiLCJST09NX0JSSURHRVNfVEFCIiwiUk9PTV9BRFZBTkNFRF9UQUIiLCJSb29tU2V0dGluZ3NEaWFsb2ciLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJwYXlsb2FkIiwiYWN0aW9uIiwib25GaW5pc2hlZCIsInNldFN0YXRlIiwicm9vbU5hbWUiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJnZXRSb29tIiwicm9vbUlkIiwibmFtZSIsInN0YXRlIiwiY29tcG9uZW50RGlkTW91bnQiLCJkaXNwYXRjaGVyUmVmIiwiZGlzIiwicmVnaXN0ZXIiLCJvbkFjdGlvbiIsIm9uIiwib25Sb29tTmFtZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwidW5yZWdpc3RlciIsInJlbW92ZUxpc3RlbmVyIiwiZ2V0VGFicyIsInRhYnMiLCJwdXNoIiwiVGFiIiwiU2V0dGluZ3NTdG9yZSIsImdldFZhbHVlIiwiVUlGZWF0dXJlIiwiQWR2YW5jZWRTZXR0aW5ncyIsInJlbmRlciIsImluaXRpYWxUYWJJZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBRU8sTUFBTUEsZ0JBQWdCLEdBQUcsa0JBQXpCOztBQUNBLE1BQU1DLGlCQUFpQixHQUFHLG1CQUExQjs7QUFDQSxNQUFNQyxjQUFjLEdBQUcsZ0JBQXZCOztBQUNBLE1BQU1DLHNCQUFzQixHQUFHLHdCQUEvQjs7QUFDQSxNQUFNQyxnQkFB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LFNBQUosQ0FGTSxFQUdOLG1DQUhNLGVBSU4sNkJBQUMsMEJBQUQ7QUFBbUIsUUFBQSxNQUFNLEVBQUUsS0FBS00sS0FBTCxDQUFXUztBQUF0QyxRQUpNLENBQVY7QUFNSDs7QUFFRCxRQUFJaUIsdUJBQWNDLFFBQWQsQ0FBdUJDLHFCQUFVQyxnQkFBakMsQ0FBSixFQUF3RDtBQUNwRE4sTUFBQUEsSUFBSSxDQUFDQyxJQUFMLENBQVUsSUFBSUMsZUFBSixDQUNOOUIsaUJBRE0sRUFFTiwwQkFBSSxVQUFKLENBRk0sRUFHTixtQ0FITSxlQUlOLDZCQUFDLGdDQUFEO0FBQ0ksUUFBQSxNQUFNLEVBQUUsS0FBS0ssS0FBTCxDQUFXUyxNQUR2QjtBQUVJLFFBQUEsZUFBZSxFQUFFLE1BQU0sS0FBS1QsS0FBTCxDQUFXRyxVQUFYLENBQXNCLElBQXRCO0FBRjNCLFFBSk0sQ0FBVjtBQVNIOztBQUVELFdBQU9vQixJQUFQO0FBQ0g7O0FBRURPLEVBQUFBLE1BQU0sR0FBRztBQUNMLFVBQU16QixRQUFRLEdBQUcsS0FBS00sS0FBTCxDQUFXTixRQUE1QjtBQUNBLHdCQUNJLDZCQUFDLG1CQUFEO0FBQ0ksTUFBQSxTQUFTLEVBQUMsdUJBRGQ7QUFFSSxNQUFBLFNBQVMsRUFBRSxJQUZmO0FBR0ksTUFBQSxVQUFVLEVBQUUsS0FBS0wsS0FBTCxDQUFXRyxVQUgzQjtBQUlJLE1BQUEsS0FBSyxFQUFFLHlCQUFHLDhCQUFILEVBQW1DO0FBQUVFLFFBQUFBO0FBQUYsT0FBbkM7QUFKWCxvQkFNSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsb0JBQ0ksNkJBQUMsbUJBQUQ7QUFDSSxNQUFBLElBQUksRUFBRSxLQUFLaUIsT0FBTCxFQURWO0FBRUksTUFBQSxZQUFZLEVBQUUsS0FBS3RCLEtBQUwsQ0FBVytCO0FBRjdCLE1BREosQ0FOSixDQURKO0FBZUg7O0FBNUcyRSxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSBNaWNoYWVsIFRlbGF0eW5za2kgPDd0M2NoZ3V5QGdtYWlsLmNvbT5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFRhYmJlZFZpZXcsIHsgVGFiIH0gZnJvbSBcIi4uLy4uL3N0cnVjdHVyZXMvVGFiYmVkVmlld1wiO1xuaW1wb3J0IHsgX3QsIF90ZCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBBZHZhbmNlZFJvb21TZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy9yb29tL0FkdmFuY2VkUm9vbVNldHRpbmdzVGFiXCI7XG5pbXBvcnQgUm9sZXNSb29tU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvcm9vbS9Sb2xlc1Jvb21TZXR0aW5nc1RhYlwiO1xuaW1wb3J0IEdlbmVyYWxSb29tU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvcm9vbS9HZW5lcmFsUm9vbVNldHRpbmdzVGFiXCI7XG5pbXBvcnQgU2VjdXJpdHlSb29tU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvcm9vbS9TZWN1cml0eVJvb21TZXR0aW5nc1RhYlwiO1xuaW1wb3J0IE5vdGlmaWNhdGlvblNldHRpbmdzVGFiIGZyb20gXCIuLi9zZXR0aW5ncy90YWJzL3Jvb20vTm90aWZpY2F0aW9uU2V0dGluZ3NUYWJcIjtcbmltcG9ydCBCcmlkZ2VTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy9yb29tL0JyaWRnZVNldHRpbmdzVGFiXCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tIFwiLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnXCI7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgeyBVSUZlYXR1cmUgfSBmcm9tIFwiLi4vLi4vLi4vc2V0dGluZ3MvVUlGZWF0dXJlXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IEJhc2VEaWFsb2cgZnJvbSBcIi4vQmFzZURpYWxvZ1wiO1xuXG5leHBvcnQgY29uc3QgUk9PTV9HRU5FUkFMX1RBQiA9IFwiUk9PTV9HRU5FUkFMX1RBQlwiO1xuZXhwb3J0IGNvbnN0IFJPT01fU0VDVVJJVFlfVEFCID0gXCJST09NX1NFQ1VSSVRZX1RBQlwiO1xuZXhwb3J0IGNvbnN0IFJPT01fUk9MRVNfVEFCID0gXCJST09NX1JPTEVTX1RBQlwiO1xuZXhwb3J0IGNvbnN0IFJPT01fTk9USUZJQ0FUSU9OU19UQUIgPSBcIlJPT01fTk9USUZJQ0FUSU9OU19UQUJcIjtcbmV4cG9ydCBjb25zdCBST09NX0JSSURHRVNfVEFCID0gXCJST09NX0JSSURHRVNfVEFCXCI7XG5leHBvcnQgY29uc3QgUk9PTV9BRFZBTkNFRF9UQUIgPSBcIlJPT01fQURWQU5DRURfVEFCXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHJvb21JZDogc3RyaW5nO1xuICAgIG9uRmluaXNoZWQ6IChzdWNjZXNzOiBib29sZWFuKSA9PiB2b2lkO1xuICAgIGluaXRpYWxUYWJJZD86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgcm9vbU5hbWU6IHN0cmluZztcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuZGlhbG9ncy5Sb29tU2V0dGluZ3NEaWFsb2dcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJvb21TZXR0aW5nc0RpYWxvZyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgZGlzcGF0Y2hlclJlZjogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7IHJvb21OYW1lOiAnJyB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy5kaXNwYXRjaGVyUmVmID0gZGlzLnJlZ2lzdGVyKHRoaXMub25BY3Rpb24pO1xuICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkub24oXCJSb29tLm5hbWVcIiwgdGhpcy5vblJvb21OYW1lKTtcbiAgICAgICAgdGhpcy5vblJvb21OYW1lKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBpZiAodGhpcy5kaXNwYXRjaGVyUmVmKSB7XG4gICAgICAgICAgICBkaXMudW5yZWdpc3Rlcih0aGlzLmRpc3BhdGNoZXJSZWYpO1xuICAgICAgICB9XG5cbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLnJlbW92ZUxpc3RlbmVyKFwiUm9vbS5uYW1lXCIsIHRoaXMub25Sb29tTmFtZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkFjdGlvbiA9IChwYXlsb2FkKTogdm9pZCA9PiB7XG4gICAgICAgIC8vIFdoZW4gdmlldyBjaGFuZ2VzIGJlbG93IHVzLCBjbG9zZSB0aGUgcm9vbSBzZXR0aW5nc1xuICAgICAgICAvLyB3aGlsc3QgdGhlIG1vZGFsIGlzIG9wZW4gdGhpcyBjYW4gb25seSBiZSB0cmlnZ2VyZWQgd2hlbiBzb21lb25lIGhpdHMgTGVhdmUgUm9vbVxuICAgICAgICBpZiAocGF5bG9hZC5hY3Rpb24gPT09ICd2aWV3X2hvbWVfcGFnZScpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25GaW5pc2hlZCh0cnVlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUm9vbU5hbWUgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcm9vbU5hbWU6IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRSb29tKHRoaXMucHJvcHMucm9vbUlkKS5uYW1lLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBnZXRUYWJzKCk6IFRhYltdIHtcbiAgICAgICAgY29uc3QgdGFiczogVGFiW10gPSBbXTtcblxuICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgIFJPT01fR0VORVJBTF9UQUIsXG4gICAgICAgICAgICBfdGQoXCJHZW5lcmFsXCIpLFxuICAgICAgICAgICAgXCJteF9Sb29tU2V0dGluZ3NEaWFsb2dfc2V0dGluZ3NJY29uXCIsXG4gICAgICAgICAgICA8R2VuZXJhbFJvb21TZXR0aW5nc1RhYiByb29tSWQ9e3RoaXMucHJvcHMucm9vbUlkfSAvPixcbiAgICAgICAgKSk7XG4gICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgUk9PTV9TRUNVUklUWV9UQUIsXG4gICAgICAgICAgICBfdGQoXCJTZWN1cml0eSAmIFByaXZhY3lcIiksXG4gICAgICAgICAgICBcIm14X1Jvb21TZXR0aW5nc0RpYWxvZ19zZWN1cml0eUljb25cIixcbiAgICAgICAgICAgIDxTZWN1cml0eVJvb21TZXR0aW5nc1RhYlxuICAgICAgICAgICAgICAgIHJvb21JZD17dGhpcy5wcm9wcy5yb29tSWR9XG4gICAgICAgICAgICAgICAgY2xvc2VTZXR0aW5nc0ZuPXsoKSA9PiB0aGlzLnByb3BzLm9uRmluaXNoZWQodHJ1ZSl9XG4gICAgICAgICAgICAvPixcbiAgICAgICAgKSk7XG4gICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgUk9PTV9ST0xFU19UQUIsXG4gICAgICAgICAgICBfdGQoXCJSb2xlcyAmIFBlcm1pc3Npb25zXCIpLFxuICAgICAgICAgICAgXCJteF9Sb29tU2V0dGluZ3NEaWFsb2dfcm9sZXNJY29uXCIsXG4gICAgICAgICAgICA8Um9sZXNSb29tU2V0dGluZ3NUYWIgcm9vbUlkPXt0aGlzLnByb3BzLnJvb21JZH0gLz4sXG4gICAgICAgICkpO1xuICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgIFJPT01fTk9USUZJQ0FUSU9OU19UQUIsXG4gICAgICAgICAgICBfdGQoXCJOb3RpZmljYXRpb25zXCIpLFxuICAgICAgICAgICAgXCJteF9Sb29tU2V0dGluZ3NEaWFsb2dfbm90aWZpY2F0aW9uc0ljb25cIixcbiAgICAgICAgICAgIDxOb3RpZmljYXRpb25TZXR0aW5nc1RhYiByb29tSWQ9e3RoaXMucHJvcHMucm9vbUlkfSBjbG9zZVNldHRpbmdzRm49eygpID0+IHRoaXMucHJvcHMub25GaW5pc2hlZCh0cnVlKX0gLz4sXG4gICAgICAgICkpO1xuXG4gICAgICAgIGlmIChTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwiZmVhdHVyZV9icmlkZ2Vfc3RhdGVcIikpIHtcbiAgICAgICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgICAgIFJPT01fQlJJREdFU19UQUIsXG4gICAgICAgICAgICAgICAgX3RkKFwiQnJpZGdlc1wiKSxcbiAgICAgICAgICAgICAgICBcIm14X1Jvb21TZXR0aW5nc0RpYWxvZ19icmlkZ2VzSWNvblwiLFxuICAgICAgICAgICAgICAgIDxCcmlkZ2VTZXR0aW5nc1RhYiByb29tSWQ9e3RoaXMucHJvcHMucm9vbUlkfSAvPixcbiAgICAgICAgICAgICkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoVUlGZWF0dXJlLkFkdmFuY2VkU2V0dGluZ3MpKSB7XG4gICAgICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgICAgICBST09NX0FEVkFOQ0VEX1RBQixcbiAgICAgICAgICAgICAgICBfdGQoXCJBZHZhbmNlZFwiKSxcbiAgICAgICAgICAgICAgICBcIm14X1Jvb21TZXR0aW5nc0RpYWxvZ193YXJuaW5nSWNvblwiLFxuICAgICAgICAgICAgICAgIDxBZHZhbmNlZFJvb21TZXR0aW5nc1RhYlxuICAgICAgICAgICAgICAgICAgICByb29tSWQ9e3RoaXMucHJvcHMucm9vbUlkfVxuICAgICAgICAgICAgICAgICAgICBjbG9zZVNldHRpbmdzRm49eygpID0+IHRoaXMucHJvcHMub25GaW5pc2hlZCh0cnVlKX1cbiAgICAgICAgICAgICAgICAvPixcbiAgICAgICAgICAgICkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRhYnM7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCByb29tTmFtZSA9IHRoaXMuc3RhdGUucm9vbU5hbWU7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZ1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0nbXhfUm9vbVNldHRpbmdzRGlhbG9nJ1xuICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17dHJ1ZX1cbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9XG4gICAgICAgICAgICAgICAgdGl0bGU9e190KFwiUm9vbSBTZXR0aW5ncyAtICUocm9vbU5hbWUpc1wiLCB7IHJvb21OYW1lIH0pfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9TZXR0aW5nc0RpYWxvZ19jb250ZW50Jz5cbiAgICAgICAgICAgICAgICAgICAgPFRhYmJlZFZpZXdcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYnM9e3RoaXMuZ2V0VGFicygpfVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFRhYklkPXt0aGlzLnByb3BzLmluaXRpYWxUYWJJZH1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvQmFzZURpYWxvZz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=