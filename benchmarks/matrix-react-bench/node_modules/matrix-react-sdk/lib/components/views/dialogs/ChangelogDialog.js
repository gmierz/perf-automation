"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _browserRequest = _interopRequireDefault(require("browser-request"));

var _languageHandler = require("../../../languageHandler");

var _QuestionDialog = _interopRequireDefault(require("./QuestionDialog"));

var _Spinner = _interopRequireDefault(require("../elements/Spinner"));

/*
 Copyright 2016 Aviral Dasgupta
Copyright 2019 Michael Telatynski <7t3chguy@gmail.com>

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 */
const REPOS = ['vector-im/element-web', 'matrix-org/matrix-react-sdk', 'matrix-org/matrix-js-sdk'];

class ChangelogDialog extends _react.default.Component {
  constructor(props) {
    super(props);
    this.state = {};
  }

  componentDidMount() {
    const version = this.props.newVersion.split('-');
    const version2 = this.props.version.split('-');
    if (version == null || version2 == null) return; // parse versions of form: [vectorversion]-react-[react-sdk-version]-js-[js-sdk-version]

    for (let i = 0; i < REPOS.length; i++) {
      const oldVersion = version2[2 * i];
      const newVersion = version[2 * i];
      const url = `https://riot.im/github/repos/${REPOS[i]}/compare/${oldVersion}...${newVersion}`;
      (0, _browserRequest.default)(url, (err, response, body) => {
        if (response.statusCode < 200 || response.statusCode >= 300) {
          this.setState({
            [REPOS[i]]: response.statusText
          });
          return;
        }

        this.setState({
          [REPOS[i]]: JSON.parse(body).commits
        });
      });
    }
  }

  elementsForCommit(commit) {
    return /*#__PURE__*/_react.default.createElement("li", {
      key: commit.sha,
      className: "mx_ChangelogDialog_li"
    }, /*#__PURE__*/_react.default.createElement("a", {
      href: commit.html_url,
      target: "_blank",
      rel: "noreferrer noopener"
    }, commit.commit.message.split('\n')[0]));
  }

  render() {
    const logs = REPOS.map(repo => {
      let content;

      if (this.state[repo] == null) {
        content = /*#__PURE__*/_react.default.createElement(_Spinner.default, {
          key: repo
        });
      } else if (typeof this.state[repo] === "string") {
        content = (0, _languageHandler._t)("Unable to load commit detail: %(msg)s", {
          msg: this.state[repo]
        });
      } else {
        content = this.state[repo].map(this.elementsForCommit);
      }

      return /*#__PURE__*/_react.default.createElement("div", {
        key: repo
      }, /*#__PURE__*/_react.default.createElement("h2", null, repo), /*#__PURE__*/_react.default.createElement("ul", null, content));
    });

    const content = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ChangelogDialog_content"
    }, this.props.version == null || this.props.newVersion == null ? /*#__PURE__*/_react.default.createElement("h2", null, (0, _languageHandler._t)("Unavailable")) : logs);

    return /*#__PURE__*/_react.default.createElement(_QuestionDialog.default, {
      title: (0, _languageHandler._t)("Changelog"),
      description: content,
      button: (0, _languageHandler._t)("Update"),
      onFinished: this.props.onFinished
    });
  }

}

exports.default = ChangelogDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQ2hhbmdlbG9nRGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJSRVBPUyIsIkNoYW5nZWxvZ0RpYWxvZyIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInN0YXRlIiwiY29tcG9uZW50RGlkTW91bnQiLCJ2ZXJzaW9uIiwibmV3VmVyc2lvbiIsInNwbGl0IiwidmVyc2lvbjIiLCJpIiwibGVuZ3RoIiwib2xkVmVyc2lvbiIsInVybCIsImVyciIsInJlc3BvbnNlIiwiYm9keSIsInN0YXR1c0NvZGUiLCJzZXRTdGF0ZSIsInN0YXR1c1RleHQiLCJKU09OIiwicGFyc2UiLCJjb21taXRzIiwiZWxlbWVudHNGb3JDb21taXQiLCJjb21taXQiLCJzaGEiLCJodG1sX3VybCIsIm1lc3NhZ2UiLCJyZW5kZXIiLCJsb2dzIiwibWFwIiwicmVwbyIsImNvbnRlbnQiLCJtc2ciLCJvbkZpbmlzaGVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFpQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBY0EsTUFBTUEsS0FBSyxHQUFHLENBQUMsdUJBQUQsRUFBMEIsNkJBQTFCLEVBQXlELDBCQUF6RCxDQUFkOztBQUVlLE1BQU1DLGVBQU4sU0FBOEJDLGVBQU1DLFNBQXBDLENBQXNEO0FBQ2pFQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBUTtBQUNmLFVBQU1BLEtBQU47QUFFQSxTQUFLQyxLQUFMLEdBQWEsRUFBYjtBQUNIOztBQUVNQyxFQUFBQSxpQkFBaUIsR0FBRztBQUN2QixVQUFNQyxPQUFPLEdBQUcsS0FBS0gsS0FBTCxDQUFXSSxVQUFYLENBQXNCQyxLQUF0QixDQUE0QixHQUE1QixDQUFoQjtBQUNBLFVBQU1DLFFB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QUFNLHlCQUFHLGFBQUgsQ0FBTixDQUE5RCxHQUErRnNCLElBRHJHLENBREo7O0FBTUEsd0JBQ0ksNkJBQUMsdUJBQUQ7QUFDSSxNQUFBLEtBQUssRUFBRSx5QkFBRyxXQUFILENBRFg7QUFFSSxNQUFBLFdBQVcsRUFBRUcsT0FGakI7QUFHSSxNQUFBLE1BQU0sRUFBRSx5QkFBRyxRQUFILENBSFo7QUFJSSxNQUFBLFVBQVUsRUFBRSxLQUFLN0IsS0FBTCxDQUFXK0I7QUFKM0IsTUFESjtBQVFIOztBQXRFZ0UiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuIENvcHlyaWdodCAyMDE2IEF2aXJhbCBEYXNndXB0YVxuQ29weXJpZ2h0IDIwMTkgTWljaGFlbCBUZWxhdHluc2tpIDw3dDNjaGd1eUBnbWFpbC5jb20+XG5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG4gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCByZXF1ZXN0IGZyb20gJ2Jyb3dzZXItcmVxdWVzdCc7XG5pbXBvcnQgeyBfdCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgUXVlc3Rpb25EaWFsb2cgZnJvbSBcIi4vUXVlc3Rpb25EaWFsb2dcIjtcbmltcG9ydCBTcGlubmVyIGZyb20gXCIuLi9lbGVtZW50cy9TcGlubmVyXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIG5ld1ZlcnNpb246IHN0cmluZztcbiAgICB2ZXJzaW9uOiBzdHJpbmc7XG4gICAgb25GaW5pc2hlZDogKHN1Y2Nlc3M6IGJvb2xlYW4pID0+IHZvaWQ7XG59XG5cbmNvbnN0IFJFUE9TID0gWyd2ZWN0b3ItaW0vZWxlbWVudC13ZWInLCAnbWF0cml4LW9yZy9tYXRyaXgtcmVhY3Qtc2RrJywgJ21hdHJpeC1vcmcvbWF0cml4LWpzLXNkayddO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDaGFuZ2Vsb2dEaWFsb2cgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7fTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHZlcnNpb24gPSB0aGlzLnByb3BzLm5ld1ZlcnNpb24uc3BsaXQoJy0nKTtcbiAgICAgICAgY29uc3QgdmVyc2lvbjIgPSB0aGlzLnByb3BzLnZlcnNpb24uc3BsaXQoJy0nKTtcbiAgICAgICAgaWYgKHZlcnNpb24gPT0gbnVsbCB8fCB2ZXJzaW9uMiA9PSBudWxsKSByZXR1cm47XG4gICAgICAgIC8vIHBhcnNlIHZlcnNpb25zIG9mIGZvcm06IFt2ZWN0b3J2ZXJzaW9uXS1yZWFjdC1bcmVhY3Qtc2RrLXZlcnNpb25dLWpzLVtqcy1zZGstdmVyc2lvbl1cbiAgICAgICAgZm9yIChsZXQgaT0wOyBpPFJFUE9TLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBvbGRWZXJzaW9uID0gdmVyc2lvbjJbMippXTtcbiAgICAgICAgICAgIGNvbnN0IG5ld1ZlcnNpb24gPSB2ZXJzaW9uWzIqaV07XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9yaW90LmltL2dpdGh1Yi9yZXBvcy8ke1JFUE9TW2ldfS9jb21wYXJlLyR7b2xkVmVyc2lvbn0uLi4ke25ld1ZlcnNpb259YDtcbiAgICAgICAgICAgIHJlcXVlc3QodXJsLCAoZXJyLCByZXNwb25zZSwgYm9keSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlIDwgMjAwIHx8IHJlc3BvbnNlLnN0YXR1c0NvZGUgPj0gMzAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBbUkVQT1NbaV1dOiByZXNwb25zZS5zdGF0dXNUZXh0IH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBbUkVQT1NbaV1dOiBKU09OLnBhcnNlKGJvZHkpLmNvbW1pdHMgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZWxlbWVudHNGb3JDb21taXQoY29tbWl0KTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGxpIGtleT17Y29tbWl0LnNoYX0gY2xhc3NOYW1lPVwibXhfQ2hhbmdlbG9nRGlhbG9nX2xpXCI+XG4gICAgICAgICAgICAgICAgPGEgaHJlZj17Y29tbWl0Lmh0bWxfdXJsfSB0YXJnZXQ9XCJfYmxhbmtcIiByZWw9XCJub3JlZmVycmVyIG5vb3BlbmVyXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgY29tbWl0LmNvbW1pdC5tZXNzYWdlLnNwbGl0KCdcXG4nKVswXSB9XG4gICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgPC9saT5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBsb2dzID0gUkVQT1MubWFwKHJlcG8gPT4ge1xuICAgICAgICAgICAgbGV0IGNvbnRlbnQ7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZVtyZXBvXSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IDxTcGlubmVyIGtleT17cmVwb30gLz47XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0aGlzLnN0YXRlW3JlcG9dID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IF90KFwiVW5hYmxlIHRvIGxvYWQgY29tbWl0IGRldGFpbDogJShtc2cpc1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIG1zZzogdGhpcy5zdGF0ZVtyZXBvXSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMuc3RhdGVbcmVwb10ubWFwKHRoaXMuZWxlbWVudHNGb3JDb21taXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8ZGl2IGtleT17cmVwb30+XG4gICAgICAgICAgICAgICAgICAgIDxoMj57IHJlcG8gfTwvaDI+XG4gICAgICAgICAgICAgICAgICAgIDx1bD57IGNvbnRlbnQgfTwvdWw+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjb250ZW50ID0gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DaGFuZ2Vsb2dEaWFsb2dfY29udGVudFwiPlxuICAgICAgICAgICAgICAgIHsgdGhpcy5wcm9wcy52ZXJzaW9uID09IG51bGwgfHwgdGhpcy5wcm9wcy5uZXdWZXJzaW9uID09IG51bGwgPyA8aDI+eyBfdChcIlVuYXZhaWxhYmxlXCIpIH08L2gyPiA6IGxvZ3MgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxRdWVzdGlvbkRpYWxvZ1xuICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcIkNoYW5nZWxvZ1wiKX1cbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj17Y29udGVudH1cbiAgICAgICAgICAgICAgICBidXR0b249e190KFwiVXBkYXRlXCIpfVxuICAgICAgICAgICAgICAgIG9uRmluaXNoZWQ9e3RoaXMucHJvcHMub25GaW5pc2hlZH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19