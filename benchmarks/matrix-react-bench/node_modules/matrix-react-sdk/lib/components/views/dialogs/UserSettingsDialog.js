"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.UserTab = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _TabbedView = _interopRequireWildcard(require("../../structures/TabbedView"));

var _languageHandler = require("../../../languageHandler");

var _GeneralUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/GeneralUserSettingsTab"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _LabsUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/LabsUserSettingsTab"));

var _AppearanceUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/AppearanceUserSettingsTab"));

var _SecurityUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/SecurityUserSettingsTab"));

var _NotificationUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/NotificationUserSettingsTab"));

var _PreferencesUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/PreferencesUserSettingsTab"));

var _VoiceUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/VoiceUserSettingsTab"));

var _HelpUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/HelpUserSettingsTab"));

var _FlairUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/FlairUserSettingsTab"));

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _MjolnirUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/MjolnirUserSettingsTab"));

var _UIFeature = require("../../../settings/UIFeature");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _SidebarUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/SidebarUserSettingsTab"));

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let UserTab;
exports.UserTab = UserTab;

(function (UserTab) {
  UserTab["General"] = "USER_GENERAL_TAB";
  UserTab["Appearance"] = "USER_APPEARANCE_TAB";
  UserTab["Flair"] = "USER_FLAIR_TAB";
  UserTab["Notifications"] = "USER_NOTIFICATIONS_TAB";
  UserTab["Preferences"] = "USER_PREFERENCES_TAB";
  UserTab["Sidebar"] = "USER_SIDEBAR_TAB";
  UserTab["Voice"] = "USER_VOICE_TAB";
  UserTab["Security"] = "USER_SECURITY_TAB";
  UserTab["Labs"] = "USER_LABS_TAB";
  UserTab["Mjolnir"] = "USER_MJOLNIR_TAB";
  UserTab["Help"] = "USER_HELP_TAB";
})(UserTab || (exports.UserTab = UserTab = {}));

let UserSettingsDialog = (_dec = (0, _replaceableComponent.replaceableComponent)("views.dialogs.UserSettingsDialog"), _dec(_class = class UserSettingsDialog extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "mjolnirWatcher", void 0);
    (0, _defineProperty2.default)(this, "mjolnirChanged", (settingName, roomId, atLevel, newValue) => {
      // We can cheat because we know what levels a feature is tracked at, and how it is tracked
      this.setState({
        mjolnirEnabled: newValue
      });
    });
    this.state = {
      mjolnirEnabled: _SettingsStore.default.getValue("feature_mjolnir")
    };
  }

  componentDidMount() {
    this.mjolnirWatcher = _SettingsStore.default.watchSetting("feature_mjolnir", null, this.mjolnirChanged);
  }

  componentWillUnmount() {
    _SettingsStore.default.unwatchSetting(this.mjolnirWatcher);
  }

  getTabs() {
    const tabs = [];
    tabs.push(new _TabbedView.Tab(UserTab.General, (0, _languageHandler._td)("General"), "mx_UserSettingsDialog_settingsIcon", /*#__PURE__*/_react.default.createElement(_GeneralUserSettingsTab.default, {
      closeSettingsFn: this.props.onFinished
    })));
    tabs.push(new _TabbedView.Tab(UserTab.Appearance, (0, _languageHandler._td)("Appearance"), "mx_UserSettingsDialog_appearanceIcon", /*#__PURE__*/_react.default.createElement(_AppearanceUserSettingsTab.default, null)));

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.Flair)) {
      tabs.push(new _TabbedView.Tab(UserTab.Flair, (0, _languageHandler._td)("Flair"), "mx_UserSettingsDialog_flairIcon", /*#__PURE__*/_react.default.createElement(_FlairUserSettingsTab.default, null)));
    }

    tabs.push(new _TabbedView.Tab(UserTab.Notifications, (0, _languageHandler._td)("Notifications"), "mx_UserSettingsDialog_bellIcon", /*#__PURE__*/_react.default.createElement(_NotificationUserSettingsTab.default, null)));
    tabs.push(new _TabbedView.Tab(UserTab.Preferences, (0, _languageHandler._td)("Preferences"), "mx_UserSettingsDialog_preferencesIcon", /*#__PURE__*/_react.default.createElement(_PreferencesUserSettingsTab.default, {
      closeSettingsFn: this.props.onFinished
    })));

    if (_SettingsStore.default.getValue("feature_spaces_metaspaces")) {
      tabs.push(new _TabbedView.Tab(UserTab.Sidebar, (0, _languageHandler._td)("Sidebar"), "mx_UserSettingsDialog_sidebarIcon", /*#__PURE__*/_react.default.createElement(_SidebarUserSettingsTab.default, null)));
    }

    if (_SettingsStore.default.getValue(_UIFeature.UIFeature.Voip)) {
      tabs.push(new _TabbedView.Tab(UserTab.Voice, (0, _languageHandler._td)("Voice & Video"), "mx_UserSettingsDialog_voiceIcon", /*#__PURE__*/_react.default.createElement(_VoiceUserSettingsTab.default, null)));
    }

    tabs.push(new _TabbedView.Tab(UserTab.Security, (0, _languageHandler._td)("Security & Privacy"), "mx_UserSettingsDialog_securityIcon", /*#__PURE__*/_react.default.createElement(_SecurityUserSettingsTab.default, {
      closeSettingsFn: this.props.onFinished
    }))); // Show the Labs tab if enabled or if there are any active betas

    if (_SdkConfig.default.get()['showLabsSettings'] || _SettingsStore.default.getFeatureSettingNames().some(k => _SettingsStore.default.getBetaInfo(k))) {
      tabs.push(new _TabbedView.Tab(UserTab.Labs, (0, _languageHandler._td)("Labs"), "mx_UserSettingsDialog_labsIcon", /*#__PURE__*/_react.default.createElement(_LabsUserSettingsTab.default, null)));
    }

    if (this.state.mjolnirEnabled) {
      tabs.push(new _TabbedView.Tab(UserTab.Mjolnir, (0, _languageHandler._td)("Ignored users"), "mx_UserSettingsDialog_mjolnirIcon", /*#__PURE__*/_react.default.createElement(_MjolnirUserSettingsTab.default, null)));
    }

    tabs.push(new _TabbedView.Tab(UserTab.Help, (0, _languageHandler._td)("Help & About"), "mx_UserSettingsDialog_helpIcon", /*#__PURE__*/_react.default.createElement(_HelpUserSettingsTab.default, {
      closeSettingsFn: () => this.props.onFinished(true)
    })));
    return tabs;
  }

  render() {
    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_UserSettingsDialog",
      hasCancel: true,
      onFinished: this.props.onFinished,
      title: (0, _languageHandler._t)("Settings")
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsDialog_content"
    }, /*#__PURE__*/_react.default.createElement(_TabbedView.default, {
      tabs: this.getTabs(),
      initialTabId: this.props.initialTabId
    })));
  }

}) || _class);
exports.default = UserSettingsDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvVXNlclNldHRpbmdzRGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJVc2VyVGFiIiwiVXNlclNldHRpbmdzRGlhbG9nIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwic2V0dGluZ05hbWUiLCJyb29tSWQiLCJhdExldmVsIiwibmV3VmFsdWUiLCJzZXRTdGF0ZSIsIm1qb2xuaXJFbmFibGVkIiwic3RhdGUiLCJTZXR0aW5nc1N0b3JlIiwiZ2V0VmFsdWUiLCJjb21wb25lbnREaWRNb3VudCIsIm1qb2xuaXJXYXRjaGVyIiwid2F0Y2hTZXR0aW5nIiwibWpvbG5pckNoYW5nZWQiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInVud2F0Y2hTZXR0aW5nIiwiZ2V0VGFicyIsInRhYnMiLCJwdXNoIiwiVGFiIiwiR2VuZXJhbCIsIm9uRmluaXNoZWQiLCJBcHBlYXJhbmNlIiwiVUlGZWF0dXJlIiwiRmxhaXIiLCJOb3RpZmljYXRpb25zIiwiUHJlZmVyZW5jZXMiLCJTaWRlYmFyIiwiVm9pcCIsIlZvaWNlIiwiU2VjdXJpdHkiLCJTZGtDb25maWciLCJnZXQiLCJnZXRGZWF0dXJlU2V0dGluZ05hbWVzIiwic29tZSIsImsiLCJnZXRCZXRhSW5mbyIsIkxhYnMiLCJNam9sbmlyIiwiSGVscCIsInJlbmRlciIsImluaXRpYWxUYWJJZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7Ozs7O0lBRVlBLE87OztXQUFBQSxPO0FBQUFBLEVBQUFBLE87QUFBQUEsRUFBQUEsTztBQUFBQSxFQUFBQSxPO0FBQUFBLEVBQUFBLE87QUFBQUEsRUFBQUEsTztBQUFBQSxFQUFB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R0FBRztBQUNMLHdCQUNJLDZCQUFDLG1CQUFEO0FBQ0ksTUFBQSxTQUFTLEVBQUMsdUJBRGQ7QUFFSSxNQUFBLFNBQVMsRUFBRSxJQUZmO0FBR0ksTUFBQSxVQUFVLEVBQUUsS0FBS3hDLEtBQUwsQ0FBV3FCLFVBSDNCO0FBSUksTUFBQSxLQUFLLEVBQUUseUJBQUcsVUFBSDtBQUpYLG9CQU1JO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSSw2QkFBQyxtQkFBRDtBQUFZLE1BQUEsSUFBSSxFQUFFLEtBQUtMLE9BQUwsRUFBbEI7QUFBa0MsTUFBQSxZQUFZLEVBQUUsS0FBS2hCLEtBQUwsQ0FBV3lDO0FBQTNELE1BREosQ0FOSixDQURKO0FBWUg7O0FBOUgyRSxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgVGFiYmVkVmlldywgeyBUYWIgfSBmcm9tIFwiLi4vLi4vc3RydWN0dXJlcy9UYWJiZWRWaWV3XCI7XG5pbXBvcnQgeyBfdCwgX3RkIH0gZnJvbSBcIi4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IEdlbmVyYWxVc2VyU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvdXNlci9HZW5lcmFsVXNlclNldHRpbmdzVGFiXCI7XG5pbXBvcnQgU2V0dGluZ3NTdG9yZSwgeyBDYWxsYmFja0ZuIH0gZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdzU3RvcmVcIjtcbmltcG9ydCBMYWJzVXNlclNldHRpbmdzVGFiIGZyb20gXCIuLi9zZXR0aW5ncy90YWJzL3VzZXIvTGFic1VzZXJTZXR0aW5nc1RhYlwiO1xuaW1wb3J0IEFwcGVhcmFuY2VVc2VyU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvdXNlci9BcHBlYXJhbmNlVXNlclNldHRpbmdzVGFiXCI7XG5pbXBvcnQgU2VjdXJpdHlVc2VyU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvdXNlci9TZWN1cml0eVVzZXJTZXR0aW5nc1RhYlwiO1xuaW1wb3J0IE5vdGlmaWNhdGlvblVzZXJTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy91c2VyL05vdGlmaWNhdGlvblVzZXJTZXR0aW5nc1RhYlwiO1xuaW1wb3J0IFByZWZlcmVuY2VzVXNlclNldHRpbmdzVGFiIGZyb20gXCIuLi9zZXR0aW5ncy90YWJzL3VzZXIvUHJlZmVyZW5jZXNVc2VyU2V0dGluZ3NUYWJcIjtcbmltcG9ydCBWb2ljZVVzZXJTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy91c2VyL1ZvaWNlVXNlclNldHRpbmdzVGFiXCI7XG5pbXBvcnQgSGVscFVzZXJTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy91c2VyL0hlbHBVc2VyU2V0dGluZ3NUYWJcIjtcbmltcG9ydCBGbGFpclVzZXJTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy91c2VyL0ZsYWlyVXNlclNldHRpbmdzVGFiXCI7XG5pbXBvcnQgU2RrQ29uZmlnIGZyb20gXCIuLi8uLi8uLi9TZGtDb25maWdcIjtcbmltcG9ydCBNam9sbmlyVXNlclNldHRpbmdzVGFiIGZyb20gXCIuLi9zZXR0aW5ncy90YWJzL3VzZXIvTWpvbG5pclVzZXJTZXR0aW5nc1RhYlwiO1xuaW1wb3J0IHsgVUlGZWF0dXJlIH0gZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL1VJRmVhdHVyZVwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gXCIuL0Jhc2VEaWFsb2dcIjtcbmltcG9ydCB7IElEaWFsb2dQcm9wcyB9IGZyb20gXCIuL0lEaWFsb2dQcm9wc1wiO1xuaW1wb3J0IFNpZGViYXJVc2VyU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvdXNlci9TaWRlYmFyVXNlclNldHRpbmdzVGFiXCI7XG5cbmV4cG9ydCBlbnVtIFVzZXJUYWIge1xuICAgIEdlbmVyYWwgPSBcIlVTRVJfR0VORVJBTF9UQUJcIixcbiAgICBBcHBlYXJhbmNlID0gXCJVU0VSX0FQUEVBUkFOQ0VfVEFCXCIsXG4gICAgRmxhaXIgPSBcIlVTRVJfRkxBSVJfVEFCXCIsXG4gICAgTm90aWZpY2F0aW9ucyA9IFwiVVNFUl9OT1RJRklDQVRJT05TX1RBQlwiLFxuICAgIFByZWZlcmVuY2VzID0gXCJVU0VSX1BSRUZFUkVOQ0VTX1RBQlwiLFxuICAgIFNpZGViYXIgPSBcIlVTRVJfU0lERUJBUl9UQUJcIixcbiAgICBWb2ljZSA9IFwiVVNFUl9WT0lDRV9UQUJcIixcbiAgICBTZWN1cml0eSA9IFwiVVNFUl9TRUNVUklUWV9UQUJcIixcbiAgICBMYWJzID0gXCJVU0VSX0xBQlNfVEFCXCIsXG4gICAgTWpvbG5pciA9IFwiVVNFUl9NSk9MTklSX1RBQlwiLFxuICAgIEhlbHAgPSBcIlVTRVJfSEVMUF9UQUJcIixcbn1cblxuaW50ZXJmYWNlIElQcm9wcyBleHRlbmRzIElEaWFsb2dQcm9wcyB7XG4gICAgaW5pdGlhbFRhYklkPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBtam9sbmlyRW5hYmxlZDogYm9vbGVhbjtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuZGlhbG9ncy5Vc2VyU2V0dGluZ3NEaWFsb2dcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJTZXR0aW5nc0RpYWxvZyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHByaXZhdGUgbWpvbG5pcldhdGNoZXI6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgbWpvbG5pckVuYWJsZWQ6IFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJmZWF0dXJlX21qb2xuaXJcIiksXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgICAgICB0aGlzLm1qb2xuaXJXYXRjaGVyID0gU2V0dGluZ3NTdG9yZS53YXRjaFNldHRpbmcoXCJmZWF0dXJlX21qb2xuaXJcIiwgbnVsbCwgdGhpcy5tam9sbmlyQ2hhbmdlZCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xuICAgICAgICBTZXR0aW5nc1N0b3JlLnVud2F0Y2hTZXR0aW5nKHRoaXMubWpvbG5pcldhdGNoZXIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWpvbG5pckNoYW5nZWQ6IENhbGxiYWNrRm4gPSAoc2V0dGluZ05hbWUsIHJvb21JZCwgYXRMZXZlbCwgbmV3VmFsdWUpID0+IHtcbiAgICAgICAgLy8gV2UgY2FuIGNoZWF0IGJlY2F1c2Ugd2Uga25vdyB3aGF0IGxldmVscyBhIGZlYXR1cmUgaXMgdHJhY2tlZCBhdCwgYW5kIGhvdyBpdCBpcyB0cmFja2VkXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBtam9sbmlyRW5hYmxlZDogbmV3VmFsdWUgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgZ2V0VGFicygpIHtcbiAgICAgICAgY29uc3QgdGFicyA9IFtdO1xuXG4gICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgVXNlclRhYi5HZW5lcmFsLFxuICAgICAgICAgICAgX3RkKFwiR2VuZXJhbFwiKSxcbiAgICAgICAgICAgIFwibXhfVXNlclNldHRpbmdzRGlhbG9nX3NldHRpbmdzSWNvblwiLFxuICAgICAgICAgICAgPEdlbmVyYWxVc2VyU2V0dGluZ3NUYWIgY2xvc2VTZXR0aW5nc0ZuPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9IC8+LFxuICAgICAgICApKTtcbiAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICBVc2VyVGFiLkFwcGVhcmFuY2UsXG4gICAgICAgICAgICBfdGQoXCJBcHBlYXJhbmNlXCIpLFxuICAgICAgICAgICAgXCJteF9Vc2VyU2V0dGluZ3NEaWFsb2dfYXBwZWFyYW5jZUljb25cIixcbiAgICAgICAgICAgIDxBcHBlYXJhbmNlVXNlclNldHRpbmdzVGFiIC8+LFxuICAgICAgICApKTtcbiAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoVUlGZWF0dXJlLkZsYWlyKSkge1xuICAgICAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICAgICAgVXNlclRhYi5GbGFpcixcbiAgICAgICAgICAgICAgICBfdGQoXCJGbGFpclwiKSxcbiAgICAgICAgICAgICAgICBcIm14X1VzZXJTZXR0aW5nc0RpYWxvZ19mbGFpckljb25cIixcbiAgICAgICAgICAgICAgICA8RmxhaXJVc2VyU2V0dGluZ3NUYWIgLz4sXG4gICAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgIFVzZXJUYWIuTm90aWZpY2F0aW9ucyxcbiAgICAgICAgICAgIF90ZChcIk5vdGlmaWNhdGlvbnNcIiksXG4gICAgICAgICAgICBcIm14X1VzZXJTZXR0aW5nc0RpYWxvZ19iZWxsSWNvblwiLFxuICAgICAgICAgICAgPE5vdGlmaWNhdGlvblVzZXJTZXR0aW5nc1RhYiAvPixcbiAgICAgICAgKSk7XG4gICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgVXNlclRhYi5QcmVmZXJlbmNlcyxcbiAgICAgICAgICAgIF90ZChcIlByZWZlcmVuY2VzXCIpLFxuICAgICAgICAgICAgXCJteF9Vc2VyU2V0dGluZ3NEaWFsb2dfcHJlZmVyZW5jZXNJY29uXCIsXG4gICAgICAgICAgICA8UHJlZmVyZW5jZXNVc2VyU2V0dGluZ3NUYWIgY2xvc2VTZXR0aW5nc0ZuPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9IC8+LFxuICAgICAgICApKTtcblxuICAgICAgICBpZiAoU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImZlYXR1cmVfc3BhY2VzX21ldGFzcGFjZXNcIikpIHtcbiAgICAgICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgICAgIFVzZXJUYWIuU2lkZWJhcixcbiAgICAgICAgICAgICAgICBfdGQoXCJTaWRlYmFyXCIpLFxuICAgICAgICAgICAgICAgIFwibXhfVXNlclNldHRpbmdzRGlhbG9nX3NpZGViYXJJY29uXCIsXG4gICAgICAgICAgICAgICAgPFNpZGViYXJVc2VyU2V0dGluZ3NUYWIgLz4sXG4gICAgICAgICAgICApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFVJRmVhdHVyZS5Wb2lwKSkge1xuICAgICAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICAgICAgVXNlclRhYi5Wb2ljZSxcbiAgICAgICAgICAgICAgICBfdGQoXCJWb2ljZSAmIFZpZGVvXCIpLFxuICAgICAgICAgICAgICAgIFwibXhfVXNlclNldHRpbmdzRGlhbG9nX3ZvaWNlSWNvblwiLFxuICAgICAgICAgICAgICAgIDxWb2ljZVVzZXJTZXR0aW5nc1RhYiAvPixcbiAgICAgICAgICAgICkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICBVc2VyVGFiLlNlY3VyaXR5LFxuICAgICAgICAgICAgX3RkKFwiU2VjdXJpdHkgJiBQcml2YWN5XCIpLFxuICAgICAgICAgICAgXCJteF9Vc2VyU2V0dGluZ3NEaWFsb2dfc2VjdXJpdHlJY29uXCIsXG4gICAgICAgICAgICA8U2VjdXJpdHlVc2VyU2V0dGluZ3NUYWIgY2xvc2VTZXR0aW5nc0ZuPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9IC8+LFxuICAgICAgICApKTtcbiAgICAgICAgLy8gU2hvdyB0aGUgTGFicyB0YWIgaWYgZW5hYmxlZCBvciBpZiB0aGVyZSBhcmUgYW55IGFjdGl2ZSBiZXRhc1xuICAgICAgICBpZiAoU2RrQ29uZmlnLmdldCgpWydzaG93TGFic1NldHRpbmdzJ11cbiAgICAgICAgICAgIHx8IFNldHRpbmdzU3RvcmUuZ2V0RmVhdHVyZVNldHRpbmdOYW1lcygpLnNvbWUoayA9PiBTZXR0aW5nc1N0b3JlLmdldEJldGFJbmZvKGspKVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgICAgIFVzZXJUYWIuTGFicyxcbiAgICAgICAgICAgICAgICBfdGQoXCJMYWJzXCIpLFxuICAgICAgICAgICAgICAgIFwibXhfVXNlclNldHRpbmdzRGlhbG9nX2xhYnNJY29uXCIsXG4gICAgICAgICAgICAgICAgPExhYnNVc2VyU2V0dGluZ3NUYWIgLz4sXG4gICAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5tam9sbmlyRW5hYmxlZCkge1xuICAgICAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICAgICAgVXNlclRhYi5Nam9sbmlyLFxuICAgICAgICAgICAgICAgIF90ZChcIklnbm9yZWQgdXNlcnNcIiksXG4gICAgICAgICAgICAgICAgXCJteF9Vc2VyU2V0dGluZ3NEaWFsb2dfbWpvbG5pckljb25cIixcbiAgICAgICAgICAgICAgICA8TWpvbG5pclVzZXJTZXR0aW5nc1RhYiAvPixcbiAgICAgICAgICAgICkpO1xuICAgICAgICB9XG4gICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgVXNlclRhYi5IZWxwLFxuICAgICAgICAgICAgX3RkKFwiSGVscCAmIEFib3V0XCIpLFxuICAgICAgICAgICAgXCJteF9Vc2VyU2V0dGluZ3NEaWFsb2dfaGVscEljb25cIixcbiAgICAgICAgICAgIDxIZWxwVXNlclNldHRpbmdzVGFiIGNsb3NlU2V0dGluZ3NGbj17KCkgPT4gdGhpcy5wcm9wcy5vbkZpbmlzaGVkKHRydWUpfSAvPixcbiAgICAgICAgKSk7XG5cbiAgICAgICAgcmV0dXJuIHRhYnM7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEJhc2VEaWFsb2dcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9J214X1VzZXJTZXR0aW5nc0RpYWxvZydcbiAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e3RydWV9XG4gICAgICAgICAgICAgICAgb25GaW5pc2hlZD17dGhpcy5wcm9wcy5vbkZpbmlzaGVkfVxuICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcIlNldHRpbmdzXCIpfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9TZXR0aW5nc0RpYWxvZ19jb250ZW50Jz5cbiAgICAgICAgICAgICAgICAgICAgPFRhYmJlZFZpZXcgdGFicz17dGhpcy5nZXRUYWJzKCl9IGluaXRpYWxUYWJJZD17dGhpcy5wcm9wcy5pbml0aWFsVGFiSWR9IC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L0Jhc2VEaWFsb2c+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19