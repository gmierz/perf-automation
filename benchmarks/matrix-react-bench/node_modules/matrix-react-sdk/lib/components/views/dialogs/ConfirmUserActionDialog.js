"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _languageHandler = require("../../../languageHandler");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Media = require("../../../customisations/Media");

var _MemberAvatar = _interopRequireDefault(require("../avatars/MemberAvatar"));

var _BaseAvatar = _interopRequireDefault(require("../avatars/BaseAvatar"));

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _DialogButtons = _interopRequireDefault(require("../elements/DialogButtons"));

var _Field = _interopRequireDefault(require("../elements/Field"));

var _dec, _class, _class2, _temp;

let ConfirmUserActionDialog = (
/*
 * A dialog for confirming an operation on another user.
 * Takes a user ID and a verb, displays the target user prominently
 * such that it should be easy to confirm that the operation is being
 * performed on the right person, and displays the operation prominently
 * to make it obvious what is going to happen.
 * Also tweaks the style for 'dangerous' actions (albeit only with colour)
 */
_dec = (0, _replaceableComponent.replaceableComponent)("views.dialogs.ConfirmUserActionDialog"), _dec(_class = (_temp = _class2 = class ConfirmUserActionDialog extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onOk", ev => {
      ev.preventDefault();
      this.props.onFinished(true, this.state.reason);
    });
    (0, _defineProperty2.default)(this, "onCancel", () => {
      this.props.onFinished(false);
    });
    (0, _defineProperty2.default)(this, "onReasonChange", ev => {
      this.setState({
        reason: ev.target.value
      });
    });
    this.state = {
      reason: ""
    };
  }

  render() {
    const confirmButtonClass = this.props.danger ? 'danger' : '';
    let reasonBox;

    if (this.props.askReason) {
      reasonBox = /*#__PURE__*/_react.default.createElement("form", {
        onSubmit: this.onOk
      }, /*#__PURE__*/_react.default.createElement(_Field.default, {
        type: "text",
        onChange: this.onReasonChange,
        value: this.state.reason,
        className: "mx_ConfirmUserActionDialog_reasonField",
        label: (0, _languageHandler._t)("Reason"),
        autoFocus: true
      }));
    }

    let avatar;
    let name;
    let userId;

    if (this.props.member) {
      avatar = /*#__PURE__*/_react.default.createElement(_MemberAvatar.default, {
        member: this.props.member,
        width: 48,
        height: 48
      });
      name = this.props.member.name;
      userId = this.props.member.userId;
    } else {
      const httpAvatarUrl = this.props.groupMember.avatarUrl ? (0, _Media.mediaFromMxc)(this.props.groupMember.avatarUrl).getSquareThumbnailHttp(48) : null;
      name = this.props.groupMember.displayname || this.props.groupMember.userId;
      userId = this.props.groupMember.userId;
      avatar = /*#__PURE__*/_react.default.createElement(_BaseAvatar.default, {
        name: name,
        url: httpAvatarUrl,
        width: 48,
        height: 48
      });
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: (0, _classnames.default)("mx_ConfirmUserActionDialog", this.props.className),
      onFinished: this.props.onFinished,
      title: this.props.title,
      contentId: "mx_Dialog_content"
    }, /*#__PURE__*/_react.default.createElement("div", {
      id: "mx_Dialog_content",
      className: "mx_Dialog_content"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ConfirmUserActionDialog_user"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ConfirmUserActionDialog_avatar"
    }, avatar), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ConfirmUserActionDialog_name"
    }, name), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ConfirmUserActionDialog_userId"
    }, userId)), reasonBox, this.props.children), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: this.props.action,
      onPrimaryButtonClick: this.onOk,
      primaryButtonClass: confirmButtonClass,
      focus: !this.props.askReason,
      onCancel: this.onCancel
    }));
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  danger: false,
  askReason: false
}), _temp)) || _class);
exports.default = ConfirmUserActionDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQ29uZmlybVVzZXJBY3Rpb25EaWFsb2cudHN4Il0sIm5hbWVzIjpbIkNvbmZpcm1Vc2VyQWN0aW9uRGlhbG9nIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiZXYiLCJwcmV2ZW50RGVmYXVsdCIsIm9uRmluaXNoZWQiLCJzdGF0ZSIsInJlYXNvbiIsInNldFN0YXRlIiwidGFyZ2V0IiwidmFsdWUiLCJyZW5kZXIiLCJjb25maXJtQnV0dG9uQ2xhc3MiLCJkYW5nZXIiLCJyZWFzb25Cb3giLCJhc2tSZWFzb24iLCJvbk9rIiwib25SZWFzb25DaGFuZ2UiLCJhdmF0YXIiLCJuYW1lIiwidXNlcklkIiwibWVtYmVyIiwiaHR0cEF2YXRhclVybCIsImdyb3VwTWVtYmVyIiwiYXZhdGFyVXJsIiwiZ2V0U3F1YXJlVGh1bWJuYWlsSHR0cCIsImRpc3BsYXluYW1lIiwiY2xhc3NOYW1lIiwidGl0bGUiLCJjaGlsZHJlbiIsImFjdGlvbiIsIm9uQ2FuY2VsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFHQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztJQW1DcUJBLHVCO0FBVHJCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7T0FDQyxnREFBcUIsdUNBQXJCLEMsbUNBQUQsTUFDcUJBLHVCQURyQixTQUNxREMsZUFBTUMsU0FEM0QsQ0FDcUY7QUFNakZDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFnQjtBQUN2QixVQUFNQSxLQUFOO0FBRHVCLGdEQVFYQyxFQUFELElBQXlCO0FBQ3BDQSxNQUFBQSxFQUFFLENBQUNDLGNBQUg7QUFDQSxXQUFLRixLQUFMLENBQVdHLFVBQVgsQ0FBc0IsSUFBdEIsRUFBNEIsS0FBS0MsS0FBTCxDQUFXQyxNQUF2QztBQUNILEtBWDBCO0FBQUEs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LEVBQUM7QUFBZixPQUNNVixNQUROLENBREosZUFJSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FBbURDLElBQW5ELENBSkosZUFLSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FBcURDLE1BQXJELENBTEosQ0FESixFQVNNTixTQVROLEVBVU0sS0FBS1osS0FBTCxDQUFXMkIsUUFWakIsQ0FOSixlQWtCSSw2QkFBQyxzQkFBRDtBQUNJLE1BQUEsYUFBYSxFQUFFLEtBQUszQixLQUFMLENBQVc0QixNQUQ5QjtBQUVJLE1BQUEsb0JBQW9CLEVBQUUsS0FBS2QsSUFGL0I7QUFHSSxNQUFBLGtCQUFrQixFQUFFSixrQkFIeEI7QUFJSSxNQUFBLEtBQUssRUFBRSxDQUFDLEtBQUtWLEtBQUwsQ0FBV2EsU0FKdkI7QUFLSSxNQUFBLFFBQVEsRUFBRSxLQUFLZ0I7QUFMbkIsTUFsQkosQ0FESjtBQTJCSDs7QUEzRmdGLEMseURBQzNEO0FBQ2xCbEIsRUFBQUEsTUFBTSxFQUFFLEtBRFU7QUFFbEJFLEVBQUFBLFNBQVMsRUFBRTtBQUZPLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTcgVmVjdG9yIENyZWF0aW9ucyBMdGRcblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgQ2hhbmdlRXZlbnQsIEZvcm1FdmVudCwgUmVhY3ROb2RlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50IH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvY2xpZW50JztcbmltcG9ydCB7IFJvb21NZW1iZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb20tbWVtYmVyXCI7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiO1xuXG5pbXBvcnQgeyBfdCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgeyBHcm91cE1lbWJlclR5cGUgfSBmcm9tICcuLi8uLi8uLi9ncm91cHMnO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCB7IG1lZGlhRnJvbU14YyB9IGZyb20gXCIuLi8uLi8uLi9jdXN0b21pc2F0aW9ucy9NZWRpYVwiO1xuaW1wb3J0IE1lbWJlckF2YXRhciBmcm9tICcuLi9hdmF0YXJzL01lbWJlckF2YXRhcic7XG5pbXBvcnQgQmFzZUF2YXRhciBmcm9tICcuLi9hdmF0YXJzL0Jhc2VBdmF0YXInO1xuaW1wb3J0IEJhc2VEaWFsb2cgZnJvbSBcIi4vQmFzZURpYWxvZ1wiO1xuaW1wb3J0IERpYWxvZ0J1dHRvbnMgZnJvbSBcIi4uL2VsZW1lbnRzL0RpYWxvZ0J1dHRvbnNcIjtcbmltcG9ydCBGaWVsZCBmcm9tICcuLi9lbGVtZW50cy9GaWVsZCc7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIC8vIG1hdHJpeC1qcy1zZGsgKHJvb20pIG1lbWJlciBvYmplY3QuIFN1cHBseSBlaXRoZXIgdGhpcyBvciAnZ3JvdXBNZW1iZXInXG4gICAgbWVtYmVyPzogUm9vbU1lbWJlcjtcbiAgICAvLyBncm91cCBtZW1iZXIgb2JqZWN0LiBTdXBwbHkgZWl0aGVyIHRoaXMgb3IgJ21lbWJlcidcbiAgICBncm91cE1lbWJlcj86IEdyb3VwTWVtYmVyVHlwZTtcbiAgICAvLyBuZWVkZWQgaWYgYSBncm91cCBtZW1iZXIgaXMgc3BlY2lmaWVkXG4gICAgbWF0cml4Q2xpZW50PzogTWF0cml4Q2xpZW50O1xuICAgIGFjdGlvbjogc3RyaW5nOyAvLyBlZy4gJ0JhbidcbiAgICB0aXRsZTogc3RyaW5nOyAvLyBlZy4gJ0JhbiB0aGlzIHVzZXI/J1xuXG4gICAgLy8gV2hldGhlciB0byBkaXNwbGF5IGEgdGV4dCBmaWVsZCBmb3IgYSByZWFzb25cbiAgICAvLyBJZiB0cnVlLCB0aGUgc2Vjb25kIGFyZ3VtZW50IHRvIG9uRmluaXNoZWQgd2lsbFxuICAgIC8vIGJlIHRoZSBzdHJpbmcgZW50ZXJlZC5cbiAgICBhc2tSZWFzb24/OiBib29sZWFuO1xuICAgIGRhbmdlcj86IGJvb2xlYW47XG4gICAgY2hpbGRyZW4/OiBSZWFjdE5vZGU7XG4gICAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICAgIG9uRmluaXNoZWQ6IChzdWNjZXNzOiBib29sZWFuLCByZWFzb24/OiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHJlYXNvbjogc3RyaW5nO1xufVxuXG4vKlxuICogQSBkaWFsb2cgZm9yIGNvbmZpcm1pbmcgYW4gb3BlcmF0aW9uIG9uIGFub3RoZXIgdXNlci5cbiAqIFRha2VzIGEgdXNlciBJRCBhbmQgYSB2ZXJiLCBkaXNwbGF5cyB0aGUgdGFyZ2V0IHVzZXIgcHJvbWluZW50bHlcbiAqIHN1Y2ggdGhhdCBpdCBzaG91bGQgYmUgZWFzeSB0byBjb25maXJtIHRoYXQgdGhlIG9wZXJhdGlvbiBpcyBiZWluZ1xuICogcGVyZm9ybWVkIG9uIHRoZSByaWdodCBwZXJzb24sIGFuZCBkaXNwbGF5cyB0aGUgb3BlcmF0aW9uIHByb21pbmVudGx5XG4gKiB0byBtYWtlIGl0IG9idmlvdXMgd2hhdCBpcyBnb2luZyB0byBoYXBwZW4uXG4gKiBBbHNvIHR3ZWFrcyB0aGUgc3R5bGUgZm9yICdkYW5nZXJvdXMnIGFjdGlvbnMgKGFsYmVpdCBvbmx5IHdpdGggY29sb3VyKVxuICovXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5kaWFsb2dzLkNvbmZpcm1Vc2VyQWN0aW9uRGlhbG9nXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb25maXJtVXNlckFjdGlvbkRpYWxvZyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgICAgIGRhbmdlcjogZmFsc2UsXG4gICAgICAgIGFza1JlYXNvbjogZmFsc2UsXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICByZWFzb246IFwiXCIsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbk9rID0gKGV2OiBGb3JtRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKHRydWUsIHRoaXMuc3RhdGUucmVhc29uKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkNhbmNlbCA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKGZhbHNlKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblJlYXNvbkNoYW5nZSA9IChldjogQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICByZWFzb246IGV2LnRhcmdldC52YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IGNvbmZpcm1CdXR0b25DbGFzcyA9IHRoaXMucHJvcHMuZGFuZ2VyID8gJ2RhbmdlcicgOiAnJztcblxuICAgICAgICBsZXQgcmVhc29uQm94O1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5hc2tSZWFzb24pIHtcbiAgICAgICAgICAgIHJlYXNvbkJveCA9IChcbiAgICAgICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17dGhpcy5vbk9rfT5cbiAgICAgICAgICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vblJlYXNvbkNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLnJlYXNvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0NvbmZpcm1Vc2VyQWN0aW9uRGlhbG9nX3JlYXNvbkZpZWxkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdChcIlJlYXNvblwiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Gb2N1cz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGF2YXRhcjtcbiAgICAgICAgbGV0IG5hbWU7XG4gICAgICAgIGxldCB1c2VySWQ7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm1lbWJlcikge1xuICAgICAgICAgICAgYXZhdGFyID0gPE1lbWJlckF2YXRhciBtZW1iZXI9e3RoaXMucHJvcHMubWVtYmVyfSB3aWR0aD17NDh9IGhlaWdodD17NDh9IC8+O1xuICAgICAgICAgICAgbmFtZSA9IHRoaXMucHJvcHMubWVtYmVyLm5hbWU7XG4gICAgICAgICAgICB1c2VySWQgPSB0aGlzLnByb3BzLm1lbWJlci51c2VySWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBodHRwQXZhdGFyVXJsID0gdGhpcy5wcm9wcy5ncm91cE1lbWJlci5hdmF0YXJVcmxcbiAgICAgICAgICAgICAgICA/IG1lZGlhRnJvbU14Yyh0aGlzLnByb3BzLmdyb3VwTWVtYmVyLmF2YXRhclVybCkuZ2V0U3F1YXJlVGh1bWJuYWlsSHR0cCg0OClcbiAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgICAgICBuYW1lID0gdGhpcy5wcm9wcy5ncm91cE1lbWJlci5kaXNwbGF5bmFtZSB8fCB0aGlzLnByb3BzLmdyb3VwTWVtYmVyLnVzZXJJZDtcbiAgICAgICAgICAgIHVzZXJJZCA9IHRoaXMucHJvcHMuZ3JvdXBNZW1iZXIudXNlcklkO1xuICAgICAgICAgICAgYXZhdGFyID0gPEJhc2VBdmF0YXIgbmFtZT17bmFtZX0gdXJsPXtodHRwQXZhdGFyVXJsfSB3aWR0aD17NDh9IGhlaWdodD17NDh9IC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxCYXNlRGlhbG9nXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfQ29uZmlybVVzZXJBY3Rpb25EaWFsb2dcIiwgdGhpcy5wcm9wcy5jbGFzc05hbWUpfVxuICAgICAgICAgICAgICAgIG9uRmluaXNoZWQ9e3RoaXMucHJvcHMub25GaW5pc2hlZH1cbiAgICAgICAgICAgICAgICB0aXRsZT17dGhpcy5wcm9wcy50aXRsZX1cbiAgICAgICAgICAgICAgICBjb250ZW50SWQ9J214X0RpYWxvZ19jb250ZW50J1xuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJteF9EaWFsb2dfY29udGVudFwiIGNsYXNzTmFtZT1cIm14X0RpYWxvZ19jb250ZW50XCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ29uZmlybVVzZXJBY3Rpb25EaWFsb2dfdXNlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Db25maXJtVXNlckFjdGlvbkRpYWxvZ19hdmF0YXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGF2YXRhciB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ29uZmlybVVzZXJBY3Rpb25EaWFsb2dfbmFtZVwiPnsgbmFtZSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0NvbmZpcm1Vc2VyQWN0aW9uRGlhbG9nX3VzZXJJZFwiPnsgdXNlcklkIH08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgeyByZWFzb25Cb3ggfVxuICAgICAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMuY2hpbGRyZW4gfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zXG4gICAgICAgICAgICAgICAgICAgIHByaW1hcnlCdXR0b249e3RoaXMucHJvcHMuYWN0aW9ufVxuICAgICAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17dGhpcy5vbk9rfVxuICAgICAgICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uQ2xhc3M9e2NvbmZpcm1CdXR0b25DbGFzc31cbiAgICAgICAgICAgICAgICAgICAgZm9jdXM9eyF0aGlzLnByb3BzLmFza1JlYXNvbn1cbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw9e3RoaXMub25DYW5jZWx9IC8+XG4gICAgICAgICAgICA8L0Jhc2VEaWFsb2c+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19