"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.CreateEventField = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _partials = require("matrix-js-sdk/src/@types/partials");

var _event = require("matrix-js-sdk/src/@types/event");

var _languageHandler = require("../../../languageHandler");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _SpaceCreateMenu = require("../spaces/SpaceCreateMenu");

var _JoinRuleDropdown = _interopRequireDefault(require("../elements/JoinRuleDropdown"));

var _GroupStore = require("../../../stores/GroupStore");

var _Permalinks = require("../../../utils/permalinks/Permalinks");

var _useAsyncMemo = require("../../../hooks/useAsyncMemo");

var _Spinner = _interopRequireDefault(require("../elements/Spinner"));

var _Media = require("../../../customisations/Media");

var _SpaceStore = _interopRequireDefault(require("../../../stores/spaces/SpaceStore"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _InfoDialog = _interopRequireDefault(require("./InfoDialog"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _actions = require("../../../dispatcher/actions");

var _UserSettingsDialog = require("./UserSettingsDialog");

var _TagOrderActions = _interopRequireDefault(require("../../../actions/TagOrderActions"));

var _RoomInvite = require("../../../RoomInvite");

var _ProgressBar = _interopRequireDefault(require("../elements/ProgressBar"));

var _logger = require("matrix-js-sdk/src/logger");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

const CreateEventField = "io.element.migrated_from_community";
exports.CreateEventField = CreateEventField;

/* eslint-enable camelcase */
var Progress;

(function (Progress) {
  Progress[Progress["NotStarted"] = 0] = "NotStarted";
  Progress[Progress["ValidatingInputs"] = 1] = "ValidatingInputs";
  Progress[Progress["FetchingData"] = 2] = "FetchingData";
  Progress[Progress["CreatingSpace"] = 3] = "CreatingSpace";
  Progress[Progress["InvitingUsers"] = 4] = "InvitingUsers";
})(Progress || (Progress = {}));

const CreateSpaceFromCommunityDialog = ({
  matrixClient: cli,
  groupId,
  onFinished
}) => {
  const [loading, setLoading] = (0, _react.useState)(true);
  const [error, setError] = (0, _react.useState)(null);
  const [progress, setProgress] = (0, _react.useState)(Progress.NotStarted);
  const [numInvites, setNumInvites] = (0, _react.useState)(0);
  const busy = progress > 0;
  const [avatar, setAvatar] = (0, _react.useState)(null); // undefined means to remove avatar

  const [name, setName] = (0, _react.useState)("");
  const spaceNameField = (0, _react.useRef)();
  const [alias, setAlias] = (0, _react.useState)("#" + groupId.substring(1, groupId.indexOf(":")) + ":" + cli.getDomain());
  const spaceAliasField = (0, _react.useRef)();
  const [topic, setTopic] = (0, _react.useState)("");
  const [joinRule, setJoinRule] = (0, _react.useState)(_partials.JoinRule.Public);
  const groupSummary = (0, _useAsyncMemo.useAsyncMemo)(() => cli.getGroupSummary(groupId), [groupId]);
  (0, _react.useEffect)(() => {
    if (groupSummary) {
      setName(groupSummary.profile.name || "");
      setTopic(groupSummary.profile.short_description || "");
      setJoinRule(groupSummary.profile.is_openly_joinable ? _partials.JoinRule.Public : _partials.JoinRule.Invite);
      setLoading(false);
    }
  }, [groupSummary]);

  if (loading) {
    return /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
  }

  const onCreateSpaceClick = async e => {
    e.preventDefault();
    if (busy) return;
    setError(null);
    setProgress(Progress.ValidatingInputs); // require & validate the space name field

    if (!(await spaceNameField.current.validate({
      allowEmpty: false
    }))) {
      setProgress(0);
      spaceNameField.current.focus();
      spaceNameField.current.validate({
        allowEmpty: false,
        focused: true
      });
      return;
    } // validate the space name alias field but do not require it


    if (joinRule === _partials.JoinRule.Public && !(await spaceAliasField.current.validate({
      allowEmpty: true
    }))) {
      setProgress(0);
      spaceAliasField.current.focus();
      spaceAliasField.current.validate({
        allowEmpty: true,
        focused: true
      });
      return;
    }

    try {
      setProgress(Progress.FetchingData);
      const [rooms, members, invitedMembers] = await Promise.all([cli.getGroupRooms(groupId).then(_GroupStore.parseRoomsResponse), cli.getGroupUsers(groupId).then(_GroupStore.parseMembersResponse), cli.getGroupInvitedUsers(groupId).then(_GroupStore.parseMembersResponse)]);
      setNumInvites(members.length + invitedMembers.length);
      const viaMap = new Map();

      for (const {
        roomId,
        canonicalAlias
      } of rooms) {
        var _viaMap$get;

        const room = cli.getRoom(roomId);

        if (room) {
          viaMap.set(roomId, (0, _Permalinks.calculateRoomVia)(room));
        } else if (canonicalAlias) {
          try {
            const {
              servers
            } = await cli.getRoomIdForAlias(canonicalAlias);
            viaMap.set(roomId, servers);
          } catch (e) {
            _logger.logger.warn("Failed to resolve alias during community migration", e);
          }
        }

        if (!((_viaMap$get = viaMap.get(roomId)) !== null && _viaMap$get !== void 0 && _viaMap$get.length)) {
          // XXX: lets guess the via, this might end up being incorrect.
          const str = canonicalAlias || roomId;
          viaMap.set(roomId, [str.substring(1, str.indexOf(":"))]);
        }
      }

      setProgress(Progress.CreatingSpace);
      const spaceAvatar = avatar !== undefined ? avatar : groupSummary.profile.avatar_url;
      const roomId = await (0, _SpaceCreateMenu.createSpace)(name, joinRule === _partials.JoinRule.Public, alias, topic, spaceAvatar, {
        creation_content: {
          [CreateEventField]: groupId
        },
        initial_state: rooms.map(({
          roomId
        }) => ({
          type: _event.EventType.SpaceChild,
          state_key: roomId,
          content: {
            via: viaMap.get(roomId) || []
          }
        })) // we do not specify the inviters here because Synapse applies a limit and this may cause it to trip

      }, {
        andView: false
      });
      setProgress(Progress.InvitingUsers);
      const userIds = [...members, ...invitedMembers].map(m => m.userId).filter(m => m !== cli.getUserId());
      await (0, _RoomInvite.inviteUsersToRoom)(roomId, userIds, () => setProgress(p => p + 1)); // eagerly remove it from the community panel

      _dispatcher.default.dispatch(_TagOrderActions.default.removeTag(cli, groupId)); // don't bother awaiting this, as we don't hugely care if it fails


      cli.setGroupProfile(groupId, _objectSpread(_objectSpread({}, groupSummary.profile), {}, {
        long_description: `<a href="${(0, _Permalinks.makeRoomPermalink)(roomId)}"><h1>` + (0, _languageHandler._t)("This community has been upgraded into a Space") + `</h1></a><br />` + groupSummary.profile.long_description
      })).catch(e => {
        _logger.logger.warn("Failed to update community profile during migration", e);
      });
      onFinished(roomId);

      const onSpaceClick = () => {
        _dispatcher.default.dispatch({
          action: "view_room",
          room_id: roomId
        });
      };

      const onPreferencesClick = () => {
        _dispatcher.default.dispatch({
          action: _actions.Action.ViewUserSettings,
          initialTabId: _UserSettingsDialog.UserTab.Preferences
        });
      };

      let spacesDisabledCopy;

      if (!_SpaceStore.default.spacesEnabled) {
        spacesDisabledCopy = (0, _languageHandler._t)("To view Spaces, hide communities in <a>Preferences</a>", {}, {
          a: sub => /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
            onClick: onPreferencesClick,
            kind: "link"
          }, sub)
        });
      }

      _Modal.default.createDialog(_InfoDialog.default, {
        title: (0, _languageHandler._t)("Space created"),
        description: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_CreateSpaceFromCommunityDialog_SuccessInfoDialog_checkmark"
        }), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("<SpaceName/> has been made and everyone who was a part of the community has " + "been invited to it.", {}, {
          SpaceName: () => /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
            onClick: onSpaceClick,
            kind: "link"
          }, name)
        }), "\xA0", spacesDisabledCopy), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("To create a Space from another community, just pick the community in Preferences."))),
        button: (0, _languageHandler._t)("Preferences"),
        onFinished: openPreferences => {
          if (openPreferences) {
            onPreferencesClick();
          }
        }
      }, "mx_CreateSpaceFromCommunityDialog_SuccessInfoDialog");
    } catch (e) {
      _logger.logger.error(e);

      setError(e);
    }

    setProgress(Progress.NotStarted);
  };

  let footer;

  if (error) {
    footer = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("img", {
      src: require("../../../../res/img/element-icons/warning-badge.svg"),
      height: "24",
      width: "24",
      alt: ""
    }), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_CreateSpaceFromCommunityDialog_error"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSpaceFromCommunityDialog_errorHeading"
    }, (0, _languageHandler._t)("Failed to migrate community")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSpaceFromCommunityDialog_errorCaption"
    }, (0, _languageHandler._t)("Try again"))), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_CreateSpaceFromCommunityDialog_retryButton",
      onClick: onCreateSpaceClick
    }, (0, _languageHandler._t)("Retry")));
  } else if (busy) {
    let description;

    switch (progress) {
      case Progress.ValidatingInputs:
      case Progress.FetchingData:
        description = (0, _languageHandler._t)("Fetching data...");
        break;

      case Progress.CreatingSpace:
        description = (0, _languageHandler._t)("Creating Space...");
        break;

      case Progress.InvitingUsers:
      default:
        description = (0, _languageHandler._t)("Adding rooms... (%(progress)s out of %(count)s)", {
          count: numInvites,
          progress
        });
        break;
    }

    footer = /*#__PURE__*/_react.default.createElement("span", null, /*#__PURE__*/_react.default.createElement(_ProgressBar.default, {
      value: progress > Progress.FetchingData ? progress : 0,
      max: numInvites + Progress.InvitingUsers
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSpaceFromCommunityDialog_progressText"
    }, description));
  } else {
    footer = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "primary_outline",
      onClick: () => onFinished()
    }, (0, _languageHandler._t)("Cancel")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "primary",
      onClick: onCreateSpaceClick
    }, (0, _languageHandler._t)("Create Space")));
  }

  return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
    title: (0, _languageHandler._t)("Create Space from community"),
    className: "mx_CreateSpaceFromCommunityDialog",
    onFinished: onFinished,
    fixedWidth: false
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_CreateSpaceFromCommunityDialog_content"
  }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("A link to the Space will be put in your community description."), "\xA0", (0, _languageHandler._t)("All rooms will be added and all community members will be invited.")), /*#__PURE__*/_react.default.createElement("p", {
    className: "mx_CreateSpaceFromCommunityDialog_flairNotice"
  }, (0, _languageHandler._t)("Flair won't be available in Spaces for the foreseeable future.")), /*#__PURE__*/_react.default.createElement(_SpaceCreateMenu.SpaceCreateForm, {
    busy: busy,
    onSubmit: onCreateSpaceClick,
    avatarUrl: groupSummary.profile.avatar_url ? (0, _Media.mediaFromMxc)(groupSummary.profile.avatar_url).getThumbnailOfSourceHttp(80, 80, "crop") : undefined,
    setAvatar: setAvatar,
    name: name,
    setName: setName,
    nameFieldRef: spaceNameField,
    topic: topic,
    setTopic: setTopic,
    alias: alias,
    setAlias: setAlias,
    showAliasField: joinRule === _partials.JoinRule.Public,
    aliasFieldRef: spaceAliasField
  }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This description will be shown to people when they view your space")), /*#__PURE__*/_react.default.createElement(_JoinRuleDropdown.default, {
    label: (0, _languageHandler._t)("Space visibility"),
    labelInvite: (0, _languageHandler._t)("Private space (invite only)"),
    labelPublic: (0, _languageHandler._t)("Public space"),
    value: joinRule,
    onChange: setJoinRule
  }), /*#__PURE__*/_react.default.createElement("p", null, joinRule === _partials.JoinRule.Public ? (0, _languageHandler._t)("Open space for anyone, best for communities") : (0, _languageHandler._t)("Invite only, best for yourself or teams")), joinRule !== _partials.JoinRule.Public && /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_CreateSpaceFromCommunityDialog_nonPublicSpacer"
  }))), /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_CreateSpaceFromCommunityDialog_footer"
  }, footer));
};

var _default = CreateSpaceFromCommunityDialog;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQ3JlYXRlU3BhY2VGcm9tQ29tbXVuaXR5RGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJDcmVhdGVFdmVudEZpZWxkIiwiUHJvZ3Jlc3MiLCJDcmVhdGVTcGFjZUZyb21Db21tdW5pdHlEaWFsb2ciLCJtYXRyaXhDbGllbnQiLCJjbGkiLCJncm91cElkIiwib25GaW5pc2hlZCIsImxvYWRpbmciLCJzZXRMb2FkaW5nIiwiZXJyb3IiLCJzZXRFcnJvciIsInByb2dyZXNzIiwic2V0UHJvZ3Jlc3MiLCJOb3RTdGFydGVkIiwibnVtSW52aXRlcyIsInNldE51bUludml0ZXMiLCJidXN5IiwiYXZhdGFyIiwic2V0QXZhdGFyIiwibmFtZSIsInNldE5hbWUiLCJzcGFjZU5hbWVGaWVsZCIsImFsaWFzIiwic2V0QWxpYXMiLCJzdWJzdHJpbmciLCJpbmRleE9mIiwiZ2V0RG9tYWluIiwic3BhY2VBbGlhc0ZpZWxkIiwidG9waWMiLCJzZXRUb3BpYyIsImpvaW5SdWxlIiwic2V0Sm9pblJ1bGUiLCJKb2luUnVsZSIsIlB1YmxpYyIsImdyb3VwU3VtbWFyeSIsImdldEdyb3VwU3VtbWFyeSIsInByb2ZpbGUiLCJzaG9ydF9kZXNjcmlwdGlvbiIsImlzX29wZW5seV9qb2luYWJsZSIsIkludml0ZSIsIm9uQ3JlYXRlU3BhY2VDbGljayIsImUiLCJwcmV2ZW50RGVmYXVsdCIsIlZhbGlkYXRpbmdJbnB1dHMiLCJjdXJyZW50IiwidmFsaWRhdGUiLCJhbGxvd0VtcHR5IiwiZm9jdXMiLCJmb2N1c2VkIiwiRmV0Y2hpbmdEYXRhIiwicm9vbXMiLCJtZW1iZXJzIiwiaW52aXRlZE1lbWJlcnMiLCJQcm9taXNlIiwiYWxsIiwiZ2V0R3JvdXBSb29tcyIsInRoZW4iLCJwYXJzZVJvb21zUmVzcG9uc2UiLCJnZXRHcm91cFVzZXJzIiwicGFyc2VNZW1iZXJzUmVzcG9uc2UiLCJnZXRHcm91cEludml0ZWRVc2VycyIsImxlbmd0aCIsInZpYU1hcCIsIk1hcCIsInJvb21JZCIsImNhbm9uaWNhbEFsaWFzIiwicm9vbSIsImdldFJvb20iLCJzZXQiLCJzZXJ2ZXJzIiwiZ2V0Um9vbUlkRm9yQWxpYXMiLCJsb2dnZXIiLCJ3YXJuIiwiZ2V0Iiwic3RyIiwiQ3JlYXRpbmdTcGFjZSIsInNwYWNlQXZhdGFyIiwidW5kZWZpbmVkIiwiYXZhdGFyX3VybCIsImNyZWF0aW9uX2NvbnRlbnQiLCJpbml0aWFsX3N0YXRlIiwibWFwIiwidHlwZSIsIkV2ZW50VHlwZSIsIlNwYWNlQ2hpbGQiLCJzdGF0ZV9rZXkiLCJjb250ZW50IiwidmlhIiwiYW5kVmlldyIsIkludml0aW5nVXNlcnMiLCJ1c2VySWRzIiwibSIsInVzZXJJZCIsImZpbHRlciIsImdldFVzZXJJZCIsInAiLCJkaXMiLCJkaXNwYXRjaCIsIlRhZ09yZGVyQWN0aW9ucyIsInJlbW92ZVRhZyIsInNldEdyb3VwUHJvZmlsZSIsImxvbmdfZGVzY3JpcHRpb24iLCJjYXRjaCIsIm9uU3BhY2VDbGljayIsImFjdGlvbiIsInJvb21faWQiLCJvblByZWZlcmVuY2VzQ2xpY2siLCJBY3Rpb24iLCJWaWV3VXNlclNldHRpbmdzIiwiaW5pdGlhbFRhYklkIiwiVXNlclRhYiIsIlByZWZlcmVuY2VzIiwic3BhY2VzRGlzYWJsZWRDb3B5IiwiU3BhY2VTdG9yZSIsInNwYWNlc0VuYWJsZWQiLCJhIiwic3ViIiwiTW9kYWwiLCJjcmVhdGVEaWFsb2ciLCJJbmZvRGlhbG9nIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsIlNwYWNlTmFtZSIsImJ1dHRvbiIsIm9wZW5QcmVmZXJlbmNlcyIsImZvb3RlciIsInJlcXVpcmUiLCJjb3VudCIsImdldFRodW1ibmFpbE9mU291cmNlSHR0cCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBSUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FB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LFNBTFY7QUFPSSxJQUFBLFNBQVMsRUFBRTNELFNBUGY7QUFRSSxJQUFBLElBQUksRUFBRUMsSUFSVjtBQVNJLElBQUEsT0FBTyxFQUFFQyxPQVRiO0FBVUksSUFBQSxZQUFZLEVBQUVDLGNBVmxCO0FBV0ksSUFBQSxLQUFLLEVBQUVPLEtBWFg7QUFZSSxJQUFBLFFBQVEsRUFBRUMsUUFaZDtBQWFJLElBQUEsS0FBSyxFQUFFUCxLQWJYO0FBY0ksSUFBQSxRQUFRLEVBQUVDLFFBZGQ7QUFlSSxJQUFBLGNBQWMsRUFBRU8sUUFBUSxLQUFLRSxtQkFBU0MsTUFmMUM7QUFnQkksSUFBQSxhQUFhLEVBQUVOO0FBaEJuQixrQkFrQkksd0NBQUsseUJBQUcsb0VBQUgsQ0FBTCxDQWxCSixlQW1CSSw2QkFBQyx5QkFBRDtBQUNJLElBQUEsS0FBSyxFQUFFLHlCQUFHLGtCQUFILENBRFg7QUFFSSxJQUFBLFdBQVcsRUFBRSx5QkFBRyw2QkFBSCxDQUZqQjtBQUdJLElBQUEsV0FBVyxFQUFFLHlCQUFHLGNBQUgsQ0FIakI7QUFJSSxJQUFBLEtBQUssRUFBRUcsUUFKWDtBQUtJLElBQUEsUUFBUSxFQUFFQztBQUxkLElBbkJKLGVBMEJJLHdDQUFLRCxRQUFRLEtBQUtFLG1CQUFTQyxNQUF0QixHQUNDLHlCQUFHLDZDQUFILENBREQsR0FFQyx5QkFBRyx5Q0FBSCxDQUZOLENBMUJKLEVBOEJNSCxRQUFRLEtBQUtFLG1CQUFTQyxNQUF0QixpQkFDRTtBQUFLLElBQUEsU0FBUyxFQUFDO0FBQWYsSUEvQlIsQ0FWSixDQU5HLGVBb0RIO0FBQUssSUFBQSxTQUFTLEVBQUM7QUFBZixLQUNNNEYsTUFETixDQXBERyxDQUFQO0FBd0RILENBOVJEOztlQWdTZTNILDhCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgSm9pblJ1bGUgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvQHR5cGVzL3BhcnRpYWxzXCI7XG5pbXBvcnQgeyBFdmVudFR5cGUgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvQHR5cGVzL2V2ZW50XCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbWF0cml4XCI7XG5cbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gXCIuL0Jhc2VEaWFsb2dcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgeyBjcmVhdGVTcGFjZSwgU3BhY2VDcmVhdGVGb3JtIH0gZnJvbSBcIi4uL3NwYWNlcy9TcGFjZUNyZWF0ZU1lbnVcIjtcbmltcG9ydCBKb2luUnVsZURyb3Bkb3duIGZyb20gXCIuLi9lbGVtZW50cy9Kb2luUnVsZURyb3Bkb3duXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcIi4uL2VsZW1lbnRzL0ZpZWxkXCI7XG5pbXBvcnQgUm9vbUFsaWFzRmllbGQgZnJvbSBcIi4uL2VsZW1lbnRzL1Jvb21BbGlhc0ZpZWxkXCI7XG5pbXBvcnQgeyBHcm91cE1lbWJlciB9IGZyb20gXCIuLi9yaWdodF9wYW5lbC9Vc2VySW5mb1wiO1xuaW1wb3J0IHsgcGFyc2VNZW1iZXJzUmVzcG9uc2UsIHBhcnNlUm9vbXNSZXNwb25zZSB9IGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvR3JvdXBTdG9yZVwiO1xuaW1wb3J0IHsgY2FsY3VsYXRlUm9vbVZpYSwgbWFrZVJvb21QZXJtYWxpbmsgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcGVybWFsaW5rcy9QZXJtYWxpbmtzXCI7XG5pbXBvcnQgeyB1c2VBc3luY01lbW8gfSBmcm9tIFwiLi4vLi4vLi4vaG9va3MvdXNlQXN5bmNNZW1vXCI7XG5pbXBvcnQgU3Bpbm5lciBmcm9tIFwiLi4vZWxlbWVudHMvU3Bpbm5lclwiO1xuaW1wb3J0IHsgbWVkaWFGcm9tTXhjIH0gZnJvbSBcIi4uLy4uLy4uL2N1c3RvbWlzYXRpb25zL01lZGlhXCI7XG5pbXBvcnQgU3BhY2VTdG9yZSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL3NwYWNlcy9TcGFjZVN0b3JlXCI7XG5pbXBvcnQgTW9kYWwgZnJvbSBcIi4uLy4uLy4uL01vZGFsXCI7XG5pbXBvcnQgSW5mb0RpYWxvZyBmcm9tIFwiLi9JbmZvRGlhbG9nXCI7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCB7IFVzZXJUYWIgfSBmcm9tIFwiLi9Vc2VyU2V0dGluZ3NEaWFsb2dcIjtcbmltcG9ydCBUYWdPcmRlckFjdGlvbnMgZnJvbSBcIi4uLy4uLy4uL2FjdGlvbnMvVGFnT3JkZXJBY3Rpb25zXCI7XG5pbXBvcnQgeyBpbnZpdGVVc2Vyc1RvUm9vbSB9IGZyb20gXCIuLi8uLi8uLi9Sb29tSW52aXRlXCI7XG5pbXBvcnQgUHJvZ3Jlc3NCYXIgZnJvbSBcIi4uL2VsZW1lbnRzL1Byb2dyZXNzQmFyXCI7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgbWF0cml4Q2xpZW50OiBNYXRyaXhDbGllbnQ7XG4gICAgZ3JvdXBJZDogc3RyaW5nO1xuICAgIG9uRmluaXNoZWQoc3BhY2VJZD86IHN0cmluZyk6IHZvaWQ7XG59XG5cbmV4cG9ydCBjb25zdCBDcmVhdGVFdmVudEZpZWxkID0gXCJpby5lbGVtZW50Lm1pZ3JhdGVkX2Zyb21fY29tbXVuaXR5XCI7XG5cbmludGVyZmFjZSBJR3JvdXBSb29tIHtcbiAgICBkaXNwbGF5bmFtZTogc3RyaW5nO1xuICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgcm9vbUlkOiBzdHJpbmc7XG4gICAgY2Fub25pY2FsQWxpYXM/OiBzdHJpbmc7XG4gICAgYXZhdGFyVXJsPzogc3RyaW5nO1xuICAgIHRvcGljPzogc3RyaW5nO1xuICAgIG51bUpvaW5lZE1lbWJlcnM/OiBudW1iZXI7XG4gICAgd29ybGRSZWFkYWJsZT86IGJvb2xlYW47XG4gICAgZ3Vlc3RDYW5Kb2luPzogYm9vbGVhbjtcbiAgICBpc1B1YmxpYz86IGJvb2xlYW47XG59XG5cbi8qIGVzbGludC1kaXNhYmxlIGNhbWVsY2FzZSAqL1xuZXhwb3J0IGludGVyZmFjZSBJR3JvdXBTdW1tYXJ5IHtcbiAgICBwcm9maWxlOiB7XG4gICAgICAgIGF2YXRhcl91cmw/OiBzdHJpbmc7XG4gICAgICAgIGlzX29wZW5seV9qb2luYWJsZT86IGJvb2xlYW47XG4gICAgICAgIGlzX3B1YmxpYz86IGJvb2xlYW47XG4gICAgICAgIGxvbmdfZGVzY3JpcHRpb246IHN0cmluZztcbiAgICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgICBzaG9ydF9kZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIH07XG4gICAgcm9vbXNfc2VjdGlvbjoge1xuICAgICAgICByb29tczogdW5rbm93bltdO1xuICAgICAgICBjYXRlZ29yaWVzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgICAgdG90YWxfcm9vbV9jb3VudF9lc3RpbWF0ZTogbnVtYmVyO1xuICAgIH07XG4gICAgdXNlcjoge1xuICAgICAgICBpc19wcml2aWxlZ2VkOiBib29sZWFuO1xuICAgICAgICBpc19wdWJsaWM6IGJvb2xlYW47XG4gICAgICAgIGlzX3B1YmxpY2lzZWQ6IGJvb2xlYW47XG4gICAgICAgIG1lbWJlcnNoaXA6IHN0cmluZztcbiAgICB9O1xuICAgIHVzZXJzX3NlY3Rpb246IHtcbiAgICAgICAgdXNlcnM6IHVua25vd25bXTtcbiAgICAgICAgcm9sZXM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgICB0b3RhbF91c2VyX2NvdW50X2VzdGltYXRlOiBudW1iZXI7XG4gICAgfTtcbn1cbi8qIGVzbGludC1lbmFibGUgY2FtZWxjYXNlICovXG5cbmVudW0gUHJvZ3Jlc3Mge1xuICAgIE5vdFN0YXJ0ZWQsXG4gICAgVmFsaWRhdGluZ0lucHV0cyxcbiAgICBGZXRjaGluZ0RhdGEsXG4gICAgQ3JlYXRpbmdTcGFjZSxcbiAgICBJbnZpdGluZ1VzZXJzLFxuICAgIC8vIGFueXRoaW5nIGJleW9uZCBoZXJlIGlzIGludml0aW5nIHVzZXIgbiAtIDRcbn1cblxuY29uc3QgQ3JlYXRlU3BhY2VGcm9tQ29tbXVuaXR5RGlhbG9nOiBSZWFjdC5GQzxJUHJvcHM+ID0gKHsgbWF0cml4Q2xpZW50OiBjbGksIGdyb3VwSWQsIG9uRmluaXNoZWQgfSkgPT4ge1xuICAgIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpO1xuICAgIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGU8c3RyaW5nPihudWxsKTtcblxuICAgIGNvbnN0IFtwcm9ncmVzcywgc2V0UHJvZ3Jlc3NdID0gdXNlU3RhdGUoUHJvZ3Jlc3MuTm90U3RhcnRlZCk7XG4gICAgY29uc3QgW251bUludml0ZXMsIHNldE51bUludml0ZXNdID0gdXNlU3RhdGUoMCk7XG4gICAgY29uc3QgYnVzeSA9IHByb2dyZXNzID4gMDtcblxuICAgIGNvbnN0IFthdmF0YXIsIHNldEF2YXRhcl0gPSB1c2VTdGF0ZTxGaWxlPihudWxsKTsgLy8gdW5kZWZpbmVkIG1lYW5zIHRvIHJlbW92ZSBhdmF0YXJcbiAgICBjb25zdCBbbmFtZSwgc2V0TmFtZV0gPSB1c2VTdGF0ZShcIlwiKTtcbiAgICBjb25zdCBzcGFjZU5hbWVGaWVsZCA9IHVzZVJlZjxGaWVsZD4oKTtcbiAgICBjb25zdCBbYWxpYXMsIHNldEFsaWFzXSA9IHVzZVN0YXRlKFwiI1wiICsgZ3JvdXBJZC5zdWJzdHJpbmcoMSwgZ3JvdXBJZC5pbmRleE9mKFwiOlwiKSkgKyBcIjpcIiArIGNsaS5nZXREb21haW4oKSk7XG4gICAgY29uc3Qgc3BhY2VBbGlhc0ZpZWxkID0gdXNlUmVmPFJvb21BbGlhc0ZpZWxkPigpO1xuICAgIGNvbnN0IFt0b3BpYywgc2V0VG9waWNdID0gdXNlU3RhdGUoXCJcIik7XG4gICAgY29uc3QgW2pvaW5SdWxlLCBzZXRKb2luUnVsZV0gPSB1c2VTdGF0ZTxKb2luUnVsZT4oSm9pblJ1bGUuUHVibGljKTtcblxuICAgIGNvbnN0IGdyb3VwU3VtbWFyeSA9IHVzZUFzeW5jTWVtbzxJR3JvdXBTdW1tYXJ5PigoKSA9PiBjbGkuZ2V0R3JvdXBTdW1tYXJ5KGdyb3VwSWQpLCBbZ3JvdXBJZF0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChncm91cFN1bW1hcnkpIHtcbiAgICAgICAgICAgIHNldE5hbWUoZ3JvdXBTdW1tYXJ5LnByb2ZpbGUubmFtZSB8fCBcIlwiKTtcbiAgICAgICAgICAgIHNldFRvcGljKGdyb3VwU3VtbWFyeS5wcm9maWxlLnNob3J0X2Rlc2NyaXB0aW9uIHx8IFwiXCIpO1xuICAgICAgICAgICAgc2V0Sm9pblJ1bGUoZ3JvdXBTdW1tYXJ5LnByb2ZpbGUuaXNfb3Blbmx5X2pvaW5hYmxlID8gSm9pblJ1bGUuUHVibGljIDogSm9pblJ1bGUuSW52aXRlKTtcbiAgICAgICAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSwgW2dyb3VwU3VtbWFyeV0pO1xuXG4gICAgaWYgKGxvYWRpbmcpIHtcbiAgICAgICAgcmV0dXJuIDxTcGlubmVyIC8+O1xuICAgIH1cblxuICAgIGNvbnN0IG9uQ3JlYXRlU3BhY2VDbGljayA9IGFzeW5jIChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKGJ1c3kpIHJldHVybjtcblxuICAgICAgICBzZXRFcnJvcihudWxsKTtcbiAgICAgICAgc2V0UHJvZ3Jlc3MoUHJvZ3Jlc3MuVmFsaWRhdGluZ0lucHV0cyk7XG5cbiAgICAgICAgLy8gcmVxdWlyZSAmIHZhbGlkYXRlIHRoZSBzcGFjZSBuYW1lIGZpZWxkXG4gICAgICAgIGlmICghKGF3YWl0IHNwYWNlTmFtZUZpZWxkLmN1cnJlbnQudmFsaWRhdGUoeyBhbGxvd0VtcHR5OiBmYWxzZSB9KSkpIHtcbiAgICAgICAgICAgIHNldFByb2dyZXNzKDApO1xuICAgICAgICAgICAgc3BhY2VOYW1lRmllbGQuY3VycmVudC5mb2N1cygpO1xuICAgICAgICAgICAgc3BhY2VOYW1lRmllbGQuY3VycmVudC52YWxpZGF0ZSh7IGFsbG93RW1wdHk6IGZhbHNlLCBmb2N1c2VkOiB0cnVlIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIHZhbGlkYXRlIHRoZSBzcGFjZSBuYW1lIGFsaWFzIGZpZWxkIGJ1dCBkbyBub3QgcmVxdWlyZSBpdFxuICAgICAgICBpZiAoam9pblJ1bGUgPT09IEpvaW5SdWxlLlB1YmxpYyAmJiAhKGF3YWl0IHNwYWNlQWxpYXNGaWVsZC5jdXJyZW50LnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogdHJ1ZSB9KSkpIHtcbiAgICAgICAgICAgIHNldFByb2dyZXNzKDApO1xuICAgICAgICAgICAgc3BhY2VBbGlhc0ZpZWxkLmN1cnJlbnQuZm9jdXMoKTtcbiAgICAgICAgICAgIHNwYWNlQWxpYXNGaWVsZC5jdXJyZW50LnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogdHJ1ZSwgZm9jdXNlZDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZXRQcm9ncmVzcyhQcm9ncmVzcy5GZXRjaGluZ0RhdGEpO1xuXG4gICAgICAgICAgICBjb25zdCBbcm9vbXMsIG1lbWJlcnMsIGludml0ZWRNZW1iZXJzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgICAgICBjbGkuZ2V0R3JvdXBSb29tcyhncm91cElkKS50aGVuKHBhcnNlUm9vbXNSZXNwb25zZSkgYXMgUHJvbWlzZTxJR3JvdXBSb29tW10+LFxuICAgICAgICAgICAgICAgIGNsaS5nZXRHcm91cFVzZXJzKGdyb3VwSWQpLnRoZW4ocGFyc2VNZW1iZXJzUmVzcG9uc2UpIGFzIFByb21pc2U8R3JvdXBNZW1iZXJbXT4sXG4gICAgICAgICAgICAgICAgY2xpLmdldEdyb3VwSW52aXRlZFVzZXJzKGdyb3VwSWQpLnRoZW4ocGFyc2VNZW1iZXJzUmVzcG9uc2UpIGFzIFByb21pc2U8R3JvdXBNZW1iZXJbXT4sXG4gICAgICAgICAgICBdKTtcblxuICAgICAgICAgICAgc2V0TnVtSW52aXRlcyhtZW1iZXJzLmxlbmd0aCArIGludml0ZWRNZW1iZXJzLmxlbmd0aCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHZpYU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmdbXT4oKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgeyByb29tSWQsIGNhbm9uaWNhbEFsaWFzIH0gb2Ygcm9vbXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByb29tID0gY2xpLmdldFJvb20ocm9vbUlkKTtcbiAgICAgICAgICAgICAgICBpZiAocm9vbSkge1xuICAgICAgICAgICAgICAgICAgICB2aWFNYXAuc2V0KHJvb21JZCwgY2FsY3VsYXRlUm9vbVZpYShyb29tKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjYW5vbmljYWxBbGlhcykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzZXJ2ZXJzIH0gPSBhd2FpdCBjbGkuZ2V0Um9vbUlkRm9yQWxpYXMoY2Fub25pY2FsQWxpYXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlhTWFwLnNldChyb29tSWQsIHNlcnZlcnMpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybihcIkZhaWxlZCB0byByZXNvbHZlIGFsaWFzIGR1cmluZyBjb21tdW5pdHkgbWlncmF0aW9uXCIsIGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCF2aWFNYXAuZ2V0KHJvb21JZCk/Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IGxldHMgZ3Vlc3MgdGhlIHZpYSwgdGhpcyBtaWdodCBlbmQgdXAgYmVpbmcgaW5jb3JyZWN0LlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHIgPSBjYW5vbmljYWxBbGlhcyB8fCByb29tSWQ7XG4gICAgICAgICAgICAgICAgICAgIHZpYU1hcC5zZXQocm9vbUlkLCBbc3RyLnN1YnN0cmluZygxLCBzdHIuaW5kZXhPZihcIjpcIikpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZXRQcm9ncmVzcyhQcm9ncmVzcy5DcmVhdGluZ1NwYWNlKTtcblxuICAgICAgICAgICAgY29uc3Qgc3BhY2VBdmF0YXIgPSBhdmF0YXIgIT09IHVuZGVmaW5lZCA/IGF2YXRhciA6IGdyb3VwU3VtbWFyeS5wcm9maWxlLmF2YXRhcl91cmw7XG4gICAgICAgICAgICBjb25zdCByb29tSWQgPSBhd2FpdCBjcmVhdGVTcGFjZShuYW1lLCBqb2luUnVsZSA9PT0gSm9pblJ1bGUuUHVibGljLCBhbGlhcywgdG9waWMsIHNwYWNlQXZhdGFyLCB7XG4gICAgICAgICAgICAgICAgY3JlYXRpb25fY29udGVudDoge1xuICAgICAgICAgICAgICAgICAgICBbQ3JlYXRlRXZlbnRGaWVsZF06IGdyb3VwSWQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbml0aWFsX3N0YXRlOiByb29tcy5tYXAoKHsgcm9vbUlkIH0pID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IEV2ZW50VHlwZS5TcGFjZUNoaWxkLFxuICAgICAgICAgICAgICAgICAgICBzdGF0ZV9rZXk6IHJvb21JZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlhOiB2aWFNYXAuZ2V0KHJvb21JZCkgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIC8vIHdlIGRvIG5vdCBzcGVjaWZ5IHRoZSBpbnZpdGVycyBoZXJlIGJlY2F1c2UgU3luYXBzZSBhcHBsaWVzIGEgbGltaXQgYW5kIHRoaXMgbWF5IGNhdXNlIGl0IHRvIHRyaXBcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBhbmRWaWV3OiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZXRQcm9ncmVzcyhQcm9ncmVzcy5JbnZpdGluZ1VzZXJzKTtcblxuICAgICAgICAgICAgY29uc3QgdXNlcklkcyA9IFsuLi5tZW1iZXJzLCAuLi5pbnZpdGVkTWVtYmVyc10ubWFwKG0gPT4gbS51c2VySWQpLmZpbHRlcihtID0+IG0gIT09IGNsaS5nZXRVc2VySWQoKSk7XG4gICAgICAgICAgICBhd2FpdCBpbnZpdGVVc2Vyc1RvUm9vbShyb29tSWQsIHVzZXJJZHMsICgpID0+IHNldFByb2dyZXNzKHAgPT4gcCArIDEpKTtcblxuICAgICAgICAgICAgLy8gZWFnZXJseSByZW1vdmUgaXQgZnJvbSB0aGUgY29tbXVuaXR5IHBhbmVsXG4gICAgICAgICAgICBkaXMuZGlzcGF0Y2goVGFnT3JkZXJBY3Rpb25zLnJlbW92ZVRhZyhjbGksIGdyb3VwSWQpKTtcblxuICAgICAgICAgICAgLy8gZG9uJ3QgYm90aGVyIGF3YWl0aW5nIHRoaXMsIGFzIHdlIGRvbid0IGh1Z2VseSBjYXJlIGlmIGl0IGZhaWxzXG4gICAgICAgICAgICBjbGkuc2V0R3JvdXBQcm9maWxlKGdyb3VwSWQsIHtcbiAgICAgICAgICAgICAgICAuLi5ncm91cFN1bW1hcnkucHJvZmlsZSxcbiAgICAgICAgICAgICAgICBsb25nX2Rlc2NyaXB0aW9uOiBgPGEgaHJlZj1cIiR7bWFrZVJvb21QZXJtYWxpbmsocm9vbUlkKX1cIj48aDE+YCArXG4gICAgICAgICAgICAgICAgICAgIF90KFwiVGhpcyBjb21tdW5pdHkgaGFzIGJlZW4gdXBncmFkZWQgaW50byBhIFNwYWNlXCIpICsgYDwvaDE+PC9hPjxiciAvPmBcbiAgICAgICAgICAgICAgICAgICAgKyBncm91cFN1bW1hcnkucHJvZmlsZS5sb25nX2Rlc2NyaXB0aW9uLFxuICAgICAgICAgICAgfSBhcyBJR3JvdXBTdW1tYXJ5W1wicHJvZmlsZVwiXSkuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oXCJGYWlsZWQgdG8gdXBkYXRlIGNvbW11bml0eSBwcm9maWxlIGR1cmluZyBtaWdyYXRpb25cIiwgZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgb25GaW5pc2hlZChyb29tSWQpO1xuXG4gICAgICAgICAgICBjb25zdCBvblNwYWNlQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBcInZpZXdfcm9vbVwiLFxuICAgICAgICAgICAgICAgICAgICByb29tX2lkOiByb29tSWQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBvblByZWZlcmVuY2VzQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBBY3Rpb24uVmlld1VzZXJTZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFRhYklkOiBVc2VyVGFiLlByZWZlcmVuY2VzLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGV0IHNwYWNlc0Rpc2FibGVkQ29weTtcbiAgICAgICAgICAgIGlmICghU3BhY2VTdG9yZS5zcGFjZXNFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgc3BhY2VzRGlzYWJsZWRDb3B5ID0gX3QoXCJUbyB2aWV3IFNwYWNlcywgaGlkZSBjb21tdW5pdGllcyBpbiA8YT5QcmVmZXJlbmNlczwvYT5cIiwge30sIHtcbiAgICAgICAgICAgICAgICAgICAgYTogc3ViID0+IDxBY2Nlc3NpYmxlQnV0dG9uIG9uQ2xpY2s9e29uUHJlZmVyZW5jZXNDbGlja30ga2luZD1cImxpbmtcIj57IHN1YiB9PC9BY2Nlc3NpYmxlQnV0dG9uPixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgTW9kYWwuY3JlYXRlRGlhbG9nKEluZm9EaWFsb2csIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogX3QoXCJTcGFjZSBjcmVhdGVkXCIpLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiA8PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNwYWNlRnJvbUNvbW11bml0eURpYWxvZ19TdWNjZXNzSW5mb0RpYWxvZ19jaGVja21hcmtcIiAvPlxuICAgICAgICAgICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCI8U3BhY2VOYW1lLz4gaGFzIGJlZW4gbWFkZSBhbmQgZXZlcnlvbmUgd2hvIHdhcyBhIHBhcnQgb2YgdGhlIGNvbW11bml0eSBoYXMgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmVlbiBpbnZpdGVkIHRvIGl0LlwiLCB7fSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNwYWNlTmFtZTogKCkgPT4gPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17b25TcGFjZUNsaWNrfSBraW5kPVwibGlua1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IG5hbWUgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj4sXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgc3BhY2VzRGlzYWJsZWRDb3B5IH1cbiAgICAgICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJUbyBjcmVhdGUgYSBTcGFjZSBmcm9tIGFub3RoZXIgY29tbXVuaXR5LCBqdXN0IHBpY2sgdGhlIGNvbW11bml0eSBpbiBQcmVmZXJlbmNlcy5cIikgfVxuICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgPC8+LFxuICAgICAgICAgICAgICAgIGJ1dHRvbjogX3QoXCJQcmVmZXJlbmNlc1wiKSxcbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkOiAob3BlblByZWZlcmVuY2VzOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcGVuUHJlZmVyZW5jZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJlZmVyZW5jZXNDbGljaygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sIFwibXhfQ3JlYXRlU3BhY2VGcm9tQ29tbXVuaXR5RGlhbG9nX1N1Y2Nlc3NJbmZvRGlhbG9nXCIpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZSk7XG4gICAgICAgICAgICBzZXRFcnJvcihlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNldFByb2dyZXNzKFByb2dyZXNzLk5vdFN0YXJ0ZWQpO1xuICAgIH07XG5cbiAgICBsZXQgZm9vdGVyO1xuICAgIGlmIChlcnJvcikge1xuICAgICAgICBmb290ZXIgPSA8PlxuICAgICAgICAgICAgPGltZyBzcmM9e3JlcXVpcmUoXCIuLi8uLi8uLi8uLi9yZXMvaW1nL2VsZW1lbnQtaWNvbnMvd2FybmluZy1iYWRnZS5zdmdcIil9IGhlaWdodD1cIjI0XCIgd2lkdGg9XCIyNFwiIGFsdD1cIlwiIC8+XG5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNwYWNlRnJvbUNvbW11bml0eURpYWxvZ19lcnJvclwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlU3BhY2VGcm9tQ29tbXVuaXR5RGlhbG9nX2Vycm9ySGVhZGluZ1wiPnsgX3QoXCJGYWlsZWQgdG8gbWlncmF0ZSBjb21tdW5pdHlcIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlU3BhY2VGcm9tQ29tbXVuaXR5RGlhbG9nX2Vycm9yQ2FwdGlvblwiPnsgX3QoXCJUcnkgYWdhaW5cIikgfTwvZGl2PlxuICAgICAgICAgICAgPC9zcGFuPlxuXG4gICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9XCJteF9DcmVhdGVTcGFjZUZyb21Db21tdW5pdHlEaWFsb2dfcmV0cnlCdXR0b25cIiBvbkNsaWNrPXtvbkNyZWF0ZVNwYWNlQ2xpY2t9PlxuICAgICAgICAgICAgICAgIHsgX3QoXCJSZXRyeVwiKSB9XG4gICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgIDwvPjtcbiAgICB9IGVsc2UgaWYgKGJ1c3kpIHtcbiAgICAgICAgbGV0IGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICAgIHN3aXRjaCAocHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgIGNhc2UgUHJvZ3Jlc3MuVmFsaWRhdGluZ0lucHV0czpcbiAgICAgICAgICAgIGNhc2UgUHJvZ3Jlc3MuRmV0Y2hpbmdEYXRhOlxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gX3QoXCJGZXRjaGluZyBkYXRhLi4uXCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQcm9ncmVzcy5DcmVhdGluZ1NwYWNlOlxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gX3QoXCJDcmVhdGluZyBTcGFjZS4uLlwiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUHJvZ3Jlc3MuSW52aXRpbmdVc2VyczpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBfdChcIkFkZGluZyByb29tcy4uLiAoJShwcm9ncmVzcylzIG91dCBvZiAlKGNvdW50KXMpXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IG51bUludml0ZXMsXG4gICAgICAgICAgICAgICAgICAgIHByb2dyZXNzLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9vdGVyID0gPHNwYW4+XG4gICAgICAgICAgICA8UHJvZ3Jlc3NCYXJcbiAgICAgICAgICAgICAgICB2YWx1ZT17cHJvZ3Jlc3MgPiBQcm9ncmVzcy5GZXRjaGluZ0RhdGEgPyBwcm9ncmVzcyA6IDB9XG4gICAgICAgICAgICAgICAgbWF4PXtudW1JbnZpdGVzICsgUHJvZ3Jlc3MuSW52aXRpbmdVc2Vyc31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNwYWNlRnJvbUNvbW11bml0eURpYWxvZ19wcm9ncmVzc1RleHRcIj5cbiAgICAgICAgICAgICAgICB7IGRlc2NyaXB0aW9uIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L3NwYW4+O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGZvb3RlciA9IDw+XG4gICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBraW5kPVwicHJpbWFyeV9vdXRsaW5lXCIgb25DbGljaz17KCkgPT4gb25GaW5pc2hlZCgpfT5cbiAgICAgICAgICAgICAgICB7IF90KFwiQ2FuY2VsXCIpIH1cbiAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGtpbmQ9XCJwcmltYXJ5XCIgb25DbGljaz17b25DcmVhdGVTcGFjZUNsaWNrfT5cbiAgICAgICAgICAgICAgICB7IF90KFwiQ3JlYXRlIFNwYWNlXCIpIH1cbiAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgPC8+O1xuICAgIH1cblxuICAgIHJldHVybiA8QmFzZURpYWxvZ1xuICAgICAgICB0aXRsZT17X3QoXCJDcmVhdGUgU3BhY2UgZnJvbSBjb21tdW5pdHlcIil9XG4gICAgICAgIGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNwYWNlRnJvbUNvbW11bml0eURpYWxvZ1wiXG4gICAgICAgIG9uRmluaXNoZWQ9e29uRmluaXNoZWR9XG4gICAgICAgIGZpeGVkV2lkdGg9e2ZhbHNlfVxuICAgID5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVTcGFjZUZyb21Db21tdW5pdHlEaWFsb2dfY29udGVudFwiPlxuICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgICAgeyBfdChcIkEgbGluayB0byB0aGUgU3BhY2Ugd2lsbCBiZSBwdXQgaW4geW91ciBjb21tdW5pdHkgZGVzY3JpcHRpb24uXCIpIH1cbiAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICB7IF90KFwiQWxsIHJvb21zIHdpbGwgYmUgYWRkZWQgYW5kIGFsbCBjb21tdW5pdHkgbWVtYmVycyB3aWxsIGJlIGludml0ZWQuXCIpIH1cbiAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNwYWNlRnJvbUNvbW11bml0eURpYWxvZ19mbGFpck5vdGljZVwiPlxuICAgICAgICAgICAgICAgIHsgX3QoXCJGbGFpciB3b24ndCBiZSBhdmFpbGFibGUgaW4gU3BhY2VzIGZvciB0aGUgZm9yZXNlZWFibGUgZnV0dXJlLlwiKSB9XG4gICAgICAgICAgICA8L3A+XG5cbiAgICAgICAgICAgIDxTcGFjZUNyZWF0ZUZvcm1cbiAgICAgICAgICAgICAgICBidXN5PXtidXN5fVxuICAgICAgICAgICAgICAgIG9uU3VibWl0PXtvbkNyZWF0ZVNwYWNlQ2xpY2t9XG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsPXtncm91cFN1bW1hcnkucHJvZmlsZS5hdmF0YXJfdXJsXG4gICAgICAgICAgICAgICAgICAgID8gbWVkaWFGcm9tTXhjKGdyb3VwU3VtbWFyeS5wcm9maWxlLmF2YXRhcl91cmwpLmdldFRodW1ibmFpbE9mU291cmNlSHR0cCg4MCwgODAsIFwiY3JvcFwiKVxuICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRBdmF0YXI9e3NldEF2YXRhcn1cbiAgICAgICAgICAgICAgICBuYW1lPXtuYW1lfVxuICAgICAgICAgICAgICAgIHNldE5hbWU9e3NldE5hbWV9XG4gICAgICAgICAgICAgICAgbmFtZUZpZWxkUmVmPXtzcGFjZU5hbWVGaWVsZH1cbiAgICAgICAgICAgICAgICB0b3BpYz17dG9waWN9XG4gICAgICAgICAgICAgICAgc2V0VG9waWM9e3NldFRvcGljfVxuICAgICAgICAgICAgICAgIGFsaWFzPXthbGlhc31cbiAgICAgICAgICAgICAgICBzZXRBbGlhcz17c2V0QWxpYXN9XG4gICAgICAgICAgICAgICAgc2hvd0FsaWFzRmllbGQ9e2pvaW5SdWxlID09PSBKb2luUnVsZS5QdWJsaWN9XG4gICAgICAgICAgICAgICAgYWxpYXNGaWVsZFJlZj17c3BhY2VBbGlhc0ZpZWxkfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXCJUaGlzIGRlc2NyaXB0aW9uIHdpbGwgYmUgc2hvd24gdG8gcGVvcGxlIHdoZW4gdGhleSB2aWV3IHlvdXIgc3BhY2VcIikgfTwvcD5cbiAgICAgICAgICAgICAgICA8Sm9pblJ1bGVEcm9wZG93blxuICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJTcGFjZSB2aXNpYmlsaXR5XCIpfVxuICAgICAgICAgICAgICAgICAgICBsYWJlbEludml0ZT17X3QoXCJQcml2YXRlIHNwYWNlIChpbnZpdGUgb25seSlcIil9XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsUHVibGljPXtfdChcIlB1YmxpYyBzcGFjZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2pvaW5SdWxlfVxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17c2V0Sm9pblJ1bGV9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8cD57IGpvaW5SdWxlID09PSBKb2luUnVsZS5QdWJsaWNcbiAgICAgICAgICAgICAgICAgICAgPyBfdChcIk9wZW4gc3BhY2UgZm9yIGFueW9uZSwgYmVzdCBmb3IgY29tbXVuaXRpZXNcIilcbiAgICAgICAgICAgICAgICAgICAgOiBfdChcIkludml0ZSBvbmx5LCBiZXN0IGZvciB5b3Vyc2VsZiBvciB0ZWFtc1wiKVxuICAgICAgICAgICAgICAgIH08L3A+XG4gICAgICAgICAgICAgICAgeyBqb2luUnVsZSAhPT0gSm9pblJ1bGUuUHVibGljICYmXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlU3BhY2VGcm9tQ29tbXVuaXR5RGlhbG9nX25vblB1YmxpY1NwYWNlclwiIC8+XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9TcGFjZUNyZWF0ZUZvcm0+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlU3BhY2VGcm9tQ29tbXVuaXR5RGlhbG9nX2Zvb3RlclwiPlxuICAgICAgICAgICAgeyBmb290ZXIgfVxuICAgICAgICA8L2Rpdj5cbiAgICA8L0Jhc2VEaWFsb2c+O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgQ3JlYXRlU3BhY2VGcm9tQ29tbXVuaXR5RGlhbG9nO1xuXG4iXX0=