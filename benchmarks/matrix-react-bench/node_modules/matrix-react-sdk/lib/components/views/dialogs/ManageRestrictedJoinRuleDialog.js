"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _room = require("matrix-js-sdk/src/models/room");

var _languageHandler = require("../../../languageHandler");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _SearchBox = _interopRequireDefault(require("../../structures/SearchBox"));

var _SpaceStore = _interopRequireDefault(require("../../../stores/spaces/SpaceStore"));

var _RoomAvatar = _interopRequireDefault(require("../avatars/RoomAvatar"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _AutoHideScrollbar = _interopRequireDefault(require("../../structures/AutoHideScrollbar"));

var _StyledCheckbox = _interopRequireDefault(require("../elements/StyledCheckbox"));

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const Entry = ({
  room,
  checked,
  onChange
}) => {
  const localRoom = room instanceof _room.Room;
  let description;

  if (localRoom) {
    description = (0, _languageHandler._t)("%(count)s members", {
      count: room.getJoinedMemberCount()
    });

    const numChildRooms = _SpaceStore.default.instance.getChildRooms(room.roomId).length;

    if (numChildRooms > 0) {
      description += " Â· " + (0, _languageHandler._t)("%(count)s rooms", {
        count: numChildRooms
      });
    }
  }

  return /*#__PURE__*/_react.default.createElement("label", {
    className: "mx_ManageRestrictedJoinRuleDialog_entry"
  }, /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", null, localRoom ? /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
    room: room,
    height: 20,
    width: 20
  }) : /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
    oobData: room,
    height: 20,
    width: 20
  }), /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_ManageRestrictedJoinRuleDialog_entry_name"
  }, room.name)), description && /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ManageRestrictedJoinRuleDialog_entry_description"
  }, description)), /*#__PURE__*/_react.default.createElement(_StyledCheckbox.default, {
    onChange: onChange ? e => onChange(e.target.checked) : null,
    checked: checked,
    disabled: !onChange
  }));
};

const addAllParents = (set, room) => {
  const cli = room.client;
  const parents = Array.from(_SpaceStore.default.instance.getKnownParents(room.roomId)).map(parentId => cli.getRoom(parentId));
  parents.forEach(parent => {
    if (set.has(parent)) return;
    set.add(parent);
    addAllParents(set, parent);
  });
};

const ManageRestrictedJoinRuleDialog = ({
  room,
  selected = [],
  onFinished
}) => {
  const cli = room.client;
  const [newSelected, setNewSelected] = (0, _react.useState)(new Set(selected));
  const [query, setQuery] = (0, _react.useState)("");
  const lcQuery = query.toLowerCase().trim();
  const [spacesContainingRoom, otherEntries] = (0, _react.useMemo)(() => {
    const parents = new Set();
    addAllParents(parents, room);
    return [Array.from(parents), selected.map(roomId => {
      const room = cli.getRoom(roomId);

      if (!room) {
        return {
          roomId,
          name: roomId
        };
      }

      if (room.getMyMembership() !== "join" || !room.isSpaceRoom()) {
        return room;
      }
    }).filter(Boolean)];
  }, [cli, selected, room]);
  const [filteredSpacesContainingRoom, filteredOtherEntries] = (0, _react.useMemo)(() => [spacesContainingRoom.filter(r => r.name.toLowerCase().includes(lcQuery)), otherEntries.filter(r => r.name.toLowerCase().includes(lcQuery))], [spacesContainingRoom, otherEntries, lcQuery]);

  const onChange = (checked, room) => {
    if (checked) {
      newSelected.add(room.roomId);
    } else {
      newSelected.delete(room.roomId);
    }

    setNewSelected(new Set(newSelected));
  };

  let inviteOnlyWarning;

  if (newSelected.size < 1) {
    inviteOnlyWarning = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ManageRestrictedJoinRuleDialog_section_info"
    }, (0, _languageHandler._t)("You're removing all spaces. Access will default to invite only"));
  }

  return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
    title: (0, _languageHandler._t)("Select spaces"),
    className: "mx_ManageRestrictedJoinRuleDialog",
    onFinished: onFinished,
    fixedWidth: false
  }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Decide which spaces can access this room. " + "If a space is selected, its members can find and join <RoomName/>.", {}, {
    RoomName: () => /*#__PURE__*/_react.default.createElement("b", null, room.name)
  })), /*#__PURE__*/_react.default.createElement(_MatrixClientContext.default.Provider, {
    value: cli
  }, /*#__PURE__*/_react.default.createElement(_SearchBox.default, {
    className: "mx_textinput_icon mx_textinput_search",
    placeholder: (0, _languageHandler._t)("Search spaces"),
    onSearch: setQuery,
    autoFocus: true
  }), /*#__PURE__*/_react.default.createElement(_AutoHideScrollbar.default, {
    className: "mx_ManageRestrictedJoinRuleDialog_content"
  }, filteredSpacesContainingRoom.length > 0 ? /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ManageRestrictedJoinRuleDialog_section"
  }, /*#__PURE__*/_react.default.createElement("h3", null, room.isSpaceRoom() ? (0, _languageHandler._t)("Spaces you know that contain this space") : (0, _languageHandler._t)("Spaces you know that contain this room")), filteredSpacesContainingRoom.map(space => {
    return /*#__PURE__*/_react.default.createElement(Entry, {
      key: space.roomId,
      room: space,
      checked: newSelected.has(space.roomId),
      onChange: checked => {
        onChange(checked, space);
      }
    });
  })) : undefined, filteredOtherEntries.length > 0 ? /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ManageRestrictedJoinRuleDialog_section"
  }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Other spaces or rooms you might not know")), /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ManageRestrictedJoinRuleDialog_section_info"
  }, /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("These are likely ones other room admins are a part of."))), filteredOtherEntries.map(space => {
    return /*#__PURE__*/_react.default.createElement(Entry, {
      key: space.roomId,
      room: space,
      checked: newSelected.has(space.roomId),
      onChange: checked => {
        onChange(checked, space);
      }
    });
  })) : null, filteredSpacesContainingRoom.length + filteredOtherEntries.length < 1 ? /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_ManageRestrictedJoinRuleDialog_noResults"
  }, (0, _languageHandler._t)("No results")) : undefined), /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ManageRestrictedJoinRuleDialog_footer"
  }, inviteOnlyWarning, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ManageRestrictedJoinRuleDialog_footer_buttons"
  }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    kind: "primary_outline",
    onClick: () => onFinished()
  }, (0, _languageHandler._t)("Cancel")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    kind: "primary",
    onClick: () => onFinished(Array.from(newSelected))
  }, (0, _languageHandler._t)("Confirm"))))));
};

var _default = ManageRestrictedJoinRuleDialog;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvTWFuYWdlUmVzdHJpY3RlZEpvaW5SdWxlRGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJFbnRyeSIsInJvb20iLCJjaGVja2VkIiwib25DaGFuZ2UiLCJsb2NhbFJvb20iLCJSb29tIiwiZGVzY3JpcHRpb24iLCJjb3VudCIsImdldEpvaW5lZE1lbWJlckNvdW50IiwibnVtQ2hpbGRSb29tcyIsIlNwYWNlU3RvcmUiLCJpbnN0YW5jZSIsImdldENoaWxkUm9vbXMiLCJyb29tSWQiLCJsZW5ndGgiLCJuYW1lIiwiZSIsInRhcmdldCIsImFkZEFsbFBhcmVudHMiLCJzZXQiLCJjbGkiLCJjbGllbnQiLCJwYXJlbnRzIiwiQXJyYXkiLCJmcm9tIiwiZ2V0S25vd25QYXJlbnRzIiwibWFwIiwicGFyZW50SWQiLCJnZXRSb29tIiwiZm9yRWFjaCIsInBhcmVudCIsImhhcyIsImFkZCIsIk1hbmFnZVJlc3RyaWN0ZWRKb2luUnVsZURpYWxvZyIsInNlbGVjdGVkIiwib25GaW5pc2hlZCIsIm5ld1NlbGVjdGVkIiwic2V0TmV3U2VsZWN0ZWQiLCJTZXQiLCJxdWVyeSIsInNldFF1ZXJ5IiwibGNRdWVyeSIsInRvTG93ZXJDYXNlIiwidHJpbSIsInNwYWNlc0NvbnRhaW5pbmdSb29tIiwib3RoZXJFbnRyaWVzIiwiZ2V0TXlNZW1iZXJzaGlwIiwiaXNTcGFjZVJvb20iLCJmaWx0ZXIiLCJCb29sZWFuIiwiZmlsdGVyZWRTcGFjZXNDb250YWluaW5nUm9vbSIsImZpbHRlcmVkT3RoZXJFbnRyaWVzIiwiciIsImluY2x1ZGVzIiwiZGVsZXRlIiwiaW52aXRlT25seVdhcm5pbmciLCJzaXplIiwiUm9vbU5hbWUiLCJzcGFjZSIsInVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUVBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNB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QUFDaEMsd0JBQU8sNkJBQUMsS0FBRDtBQUNILE1BQUEsR0FBRyxFQUFFQSxLQUFLLENBQUM3QyxNQURSO0FBRUgsTUFBQSxJQUFJLEVBQUU2QyxLQUZIO0FBR0gsTUFBQSxPQUFPLEVBQUV0QixXQUFXLENBQUNMLEdBQVosQ0FBZ0IyQixLQUFLLENBQUM3QyxNQUF0QixDQUhOO0FBSUgsTUFBQSxRQUFRLEVBQUdYLE9BQUQsSUFBc0I7QUFDNUJDLFFBQUFBLFFBQVEsQ0FBQ0QsT0FBRCxFQUFVd0QsS0FBVixDQUFSO0FBQ0g7QUFORSxNQUFQO0FBUUgsR0FUQyxDQUxOLENBREYsR0FpQkUsSUF0Q1IsRUF3Q01SLDRCQUE0QixDQUFDcEMsTUFBN0IsR0FBc0NxQyxvQkFBb0IsQ0FBQ3JDLE1BQTNELEdBQW9FLENBQXBFLGdCQUNJO0FBQU0sSUFBQSxTQUFTLEVBQUM7QUFBaEIsS0FDSSx5QkFBRyxZQUFILENBREosQ0FESixHQUlJNkMsU0E1Q1YsQ0FQSixlQXVESTtBQUFLLElBQUEsU0FBUyxFQUFDO0FBQWYsS0FDTUosaUJBRE4sZUFFSTtBQUFLLElBQUEsU0FBUyxFQUFDO0FBQWYsa0JBQ0ksNkJBQUMseUJBQUQ7QUFBa0IsSUFBQSxJQUFJLEVBQUMsaUJBQXZCO0FBQXlDLElBQUEsT0FBTyxFQUFFLE1BQU1wQixVQUFVO0FBQWxFLEtBQ00seUJBQUcsUUFBSCxDQUROLENBREosZUFJSSw2QkFBQyx5QkFBRDtBQUFrQixJQUFBLElBQUksRUFBQyxTQUF2QjtBQUFpQyxJQUFBLE9BQU8sRUFBRSxNQUFNQSxVQUFVLENBQUNaLEtBQUssQ0FBQ0MsSUFBTixDQUFXWSxXQUFYLENBQUQ7QUFBMUQsS0FDTSx5QkFBRyxTQUFILENBRE4sQ0FKSixDQUZKLENBdkRKLENBWkcsQ0FBUDtBQWdGSCxDQTVIRDs7ZUE4SGVILDhCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5cbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCB7IElEaWFsb2dQcm9wcyB9IGZyb20gXCIuL0lEaWFsb2dQcm9wc1wiO1xuaW1wb3J0IEJhc2VEaWFsb2cgZnJvbSBcIi4vQmFzZURpYWxvZ1wiO1xuaW1wb3J0IFNlYXJjaEJveCBmcm9tIFwiLi4vLi4vc3RydWN0dXJlcy9TZWFyY2hCb3hcIjtcbmltcG9ydCBTcGFjZVN0b3JlIGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvc3BhY2VzL1NwYWNlU3RvcmVcIjtcbmltcG9ydCBSb29tQXZhdGFyIGZyb20gXCIuLi9hdmF0YXJzL1Jvb21BdmF0YXJcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgQXV0b0hpZGVTY3JvbGxiYXIgZnJvbSBcIi4uLy4uL3N0cnVjdHVyZXMvQXV0b0hpZGVTY3JvbGxiYXJcIjtcbmltcG9ydCBTdHlsZWRDaGVja2JveCBmcm9tIFwiLi4vZWxlbWVudHMvU3R5bGVkQ2hlY2tib3hcIjtcbmltcG9ydCBNYXRyaXhDbGllbnRDb250ZXh0IGZyb20gXCIuLi8uLi8uLi9jb250ZXh0cy9NYXRyaXhDbGllbnRDb250ZXh0XCI7XG5cbmludGVyZmFjZSBJUHJvcHMgZXh0ZW5kcyBJRGlhbG9nUHJvcHMge1xuICAgIHJvb206IFJvb207XG4gICAgc2VsZWN0ZWQ/OiBzdHJpbmdbXTtcbn1cblxuY29uc3QgRW50cnkgPSAoeyByb29tLCBjaGVja2VkLCBvbkNoYW5nZSB9KSA9PiB7XG4gICAgY29uc3QgbG9jYWxSb29tID0gcm9vbSBpbnN0YW5jZW9mIFJvb207XG5cbiAgICBsZXQgZGVzY3JpcHRpb247XG4gICAgaWYgKGxvY2FsUm9vbSkge1xuICAgICAgICBkZXNjcmlwdGlvbiA9IF90KFwiJShjb3VudClzIG1lbWJlcnNcIiwgeyBjb3VudDogcm9vbS5nZXRKb2luZWRNZW1iZXJDb3VudCgpIH0pO1xuICAgICAgICBjb25zdCBudW1DaGlsZFJvb21zID0gU3BhY2VTdG9yZS5pbnN0YW5jZS5nZXRDaGlsZFJvb21zKHJvb20ucm9vbUlkKS5sZW5ndGg7XG4gICAgICAgIGlmIChudW1DaGlsZFJvb21zID4gMCkge1xuICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gXCIgwrcgXCIgKyBfdChcIiUoY291bnQpcyByb29tc1wiLCB7IGNvdW50OiBudW1DaGlsZFJvb21zIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIDxsYWJlbCBjbGFzc05hbWU9XCJteF9NYW5hZ2VSZXN0cmljdGVkSm9pblJ1bGVEaWFsb2dfZW50cnlcIj5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgeyBsb2NhbFJvb21cbiAgICAgICAgICAgICAgICAgICAgPyA8Um9vbUF2YXRhciByb29tPXtyb29tfSBoZWlnaHQ9ezIwfSB3aWR0aD17MjB9IC8+XG4gICAgICAgICAgICAgICAgICAgIDogPFJvb21BdmF0YXIgb29iRGF0YT17cm9vbX0gaGVpZ2h0PXsyMH0gd2lkdGg9ezIwfSAvPlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9NYW5hZ2VSZXN0cmljdGVkSm9pblJ1bGVEaWFsb2dfZW50cnlfbmFtZVwiPnsgcm9vbS5uYW1lIH08L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIHsgZGVzY3JpcHRpb24gJiYgPGRpdiBjbGFzc05hbWU9XCJteF9NYW5hZ2VSZXN0cmljdGVkSm9pblJ1bGVEaWFsb2dfZW50cnlfZGVzY3JpcHRpb25cIj5cbiAgICAgICAgICAgICAgICB7IGRlc2NyaXB0aW9uIH1cbiAgICAgICAgICAgIDwvZGl2PiB9XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8U3R5bGVkQ2hlY2tib3hcbiAgICAgICAgICAgIG9uQ2hhbmdlPXtvbkNoYW5nZSA/IChlKSA9PiBvbkNoYW5nZShlLnRhcmdldC5jaGVja2VkKSA6IG51bGx9XG4gICAgICAgICAgICBjaGVja2VkPXtjaGVja2VkfVxuICAgICAgICAgICAgZGlzYWJsZWQ9eyFvbkNoYW5nZX1cbiAgICAgICAgLz5cbiAgICA8L2xhYmVsPjtcbn07XG5cbmNvbnN0IGFkZEFsbFBhcmVudHMgPSAoc2V0OiBTZXQ8Um9vbT4sIHJvb206IFJvb20pOiB2b2lkID0+IHtcbiAgICBjb25zdCBjbGkgPSByb29tLmNsaWVudDtcbiAgICBjb25zdCBwYXJlbnRzID0gQXJyYXkuZnJvbShTcGFjZVN0b3JlLmluc3RhbmNlLmdldEtub3duUGFyZW50cyhyb29tLnJvb21JZCkpLm1hcChwYXJlbnRJZCA9PiBjbGkuZ2V0Um9vbShwYXJlbnRJZCkpO1xuXG4gICAgcGFyZW50cy5mb3JFYWNoKHBhcmVudCA9PiB7XG4gICAgICAgIGlmIChzZXQuaGFzKHBhcmVudCkpIHJldHVybjtcbiAgICAgICAgc2V0LmFkZChwYXJlbnQpO1xuICAgICAgICBhZGRBbGxQYXJlbnRzKHNldCwgcGFyZW50KTtcbiAgICB9KTtcbn07XG5cbmNvbnN0IE1hbmFnZVJlc3RyaWN0ZWRKb2luUnVsZURpYWxvZzogUmVhY3QuRkM8SVByb3BzPiA9ICh7IHJvb20sIHNlbGVjdGVkID0gW10sIG9uRmluaXNoZWQgfSkgPT4ge1xuICAgIGNvbnN0IGNsaSA9IHJvb20uY2xpZW50O1xuICAgIGNvbnN0IFtuZXdTZWxlY3RlZCwgc2V0TmV3U2VsZWN0ZWRdID0gdXNlU3RhdGUobmV3IFNldDxzdHJpbmc+KHNlbGVjdGVkKSk7XG4gICAgY29uc3QgW3F1ZXJ5LCBzZXRRdWVyeV0gPSB1c2VTdGF0ZShcIlwiKTtcbiAgICBjb25zdCBsY1F1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7XG5cbiAgICBjb25zdCBbc3BhY2VzQ29udGFpbmluZ1Jvb20sIG90aGVyRW50cmllc10gPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgICAgY29uc3QgcGFyZW50cyA9IG5ldyBTZXQ8Um9vbT4oKTtcbiAgICAgICAgYWRkQWxsUGFyZW50cyhwYXJlbnRzLCByb29tKTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIEFycmF5LmZyb20ocGFyZW50cyksXG4gICAgICAgICAgICBzZWxlY3RlZC5tYXAocm9vbUlkID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByb29tID0gY2xpLmdldFJvb20ocm9vbUlkKTtcbiAgICAgICAgICAgICAgICBpZiAoIXJvb20pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcm9vbUlkLCBuYW1lOiByb29tSWQgfSBhcyBSb29tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm9vbS5nZXRNeU1lbWJlcnNoaXAoKSAhPT0gXCJqb2luXCIgfHwgIXJvb20uaXNTcGFjZVJvb20oKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9vbTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5maWx0ZXIoQm9vbGVhbiksXG4gICAgICAgIF07XG4gICAgfSwgW2NsaSwgc2VsZWN0ZWQsIHJvb21dKTtcblxuICAgIGNvbnN0IFtmaWx0ZXJlZFNwYWNlc0NvbnRhaW5pbmdSb29tLCBmaWx0ZXJlZE90aGVyRW50cmllc10gPSB1c2VNZW1vKCgpID0+IFtcbiAgICAgICAgc3BhY2VzQ29udGFpbmluZ1Jvb20uZmlsdGVyKHIgPT4gci5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobGNRdWVyeSkpLFxuICAgICAgICBvdGhlckVudHJpZXMuZmlsdGVyKHIgPT4gci5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobGNRdWVyeSkpLFxuICAgIF0sIFtzcGFjZXNDb250YWluaW5nUm9vbSwgb3RoZXJFbnRyaWVzLCBsY1F1ZXJ5XSk7XG5cbiAgICBjb25zdCBvbkNoYW5nZSA9IChjaGVja2VkOiBib29sZWFuLCByb29tOiBSb29tKTogdm9pZCA9PiB7XG4gICAgICAgIGlmIChjaGVja2VkKSB7XG4gICAgICAgICAgICBuZXdTZWxlY3RlZC5hZGQocm9vbS5yb29tSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3U2VsZWN0ZWQuZGVsZXRlKHJvb20ucm9vbUlkKTtcbiAgICAgICAgfVxuICAgICAgICBzZXROZXdTZWxlY3RlZChuZXcgU2V0KG5ld1NlbGVjdGVkKSk7XG4gICAgfTtcblxuICAgIGxldCBpbnZpdGVPbmx5V2FybmluZztcbiAgICBpZiAobmV3U2VsZWN0ZWQuc2l6ZSA8IDEpIHtcbiAgICAgICAgaW52aXRlT25seVdhcm5pbmcgPSA8ZGl2IGNsYXNzTmFtZT1cIm14X01hbmFnZVJlc3RyaWN0ZWRKb2luUnVsZURpYWxvZ19zZWN0aW9uX2luZm9cIj5cbiAgICAgICAgICAgIHsgX3QoXCJZb3UncmUgcmVtb3ZpbmcgYWxsIHNwYWNlcy4gQWNjZXNzIHdpbGwgZGVmYXVsdCB0byBpbnZpdGUgb25seVwiKSB9XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICByZXR1cm4gPEJhc2VEaWFsb2dcbiAgICAgICAgdGl0bGU9e190KFwiU2VsZWN0IHNwYWNlc1wiKX1cbiAgICAgICAgY2xhc3NOYW1lPVwibXhfTWFuYWdlUmVzdHJpY3RlZEpvaW5SdWxlRGlhbG9nXCJcbiAgICAgICAgb25GaW5pc2hlZD17b25GaW5pc2hlZH1cbiAgICAgICAgZml4ZWRXaWR0aD17ZmFsc2V9XG4gICAgPlxuICAgICAgICA8cD5cbiAgICAgICAgICAgIHsgX3QoXCJEZWNpZGUgd2hpY2ggc3BhY2VzIGNhbiBhY2Nlc3MgdGhpcyByb29tLiBcIiArXG4gICAgICAgICAgICAgICAgXCJJZiBhIHNwYWNlIGlzIHNlbGVjdGVkLCBpdHMgbWVtYmVycyBjYW4gZmluZCBhbmQgam9pbiA8Um9vbU5hbWUvPi5cIiwge30sIHtcbiAgICAgICAgICAgICAgICBSb29tTmFtZTogKCkgPT4gPGI+eyByb29tLm5hbWUgfTwvYj4sXG4gICAgICAgICAgICB9KSB9XG4gICAgICAgIDwvcD5cbiAgICAgICAgPE1hdHJpeENsaWVudENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2NsaX0+XG4gICAgICAgICAgICA8U2VhcmNoQm94XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfdGV4dGlucHV0X2ljb24gbXhfdGV4dGlucHV0X3NlYXJjaFwiXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e190KFwiU2VhcmNoIHNwYWNlc1wiKX1cbiAgICAgICAgICAgICAgICBvblNlYXJjaD17c2V0UXVlcnl9XG4gICAgICAgICAgICAgICAgYXV0b0ZvY3VzPXt0cnVlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxBdXRvSGlkZVNjcm9sbGJhciBjbGFzc05hbWU9XCJteF9NYW5hZ2VSZXN0cmljdGVkSm9pblJ1bGVEaWFsb2dfY29udGVudFwiPlxuICAgICAgICAgICAgICAgIHsgZmlsdGVyZWRTcGFjZXNDb250YWluaW5nUm9vbS5sZW5ndGggPiAwID8gKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01hbmFnZVJlc3RyaWN0ZWRKb2luUnVsZURpYWxvZ19zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aDM+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyByb29tLmlzU3BhY2VSb29tKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBfdChcIlNwYWNlcyB5b3Uga25vdyB0aGF0IGNvbnRhaW4gdGhpcyBzcGFjZVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IF90KFwiU3BhY2VzIHlvdSBrbm93IHRoYXQgY29udGFpbiB0aGlzIHJvb21cIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9oMz5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgZmlsdGVyZWRTcGFjZXNDb250YWluaW5nUm9vbS5tYXAoc3BhY2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA8RW50cnlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtzcGFjZS5yb29tSWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb209e3NwYWNlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXtuZXdTZWxlY3RlZC5oYXMoc3BhY2Uucm9vbUlkKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhjaGVja2VkOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZShjaGVja2VkLCBzcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz47XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICkgOiB1bmRlZmluZWQgfVxuXG4gICAgICAgICAgICAgICAgeyBmaWx0ZXJlZE90aGVyRW50cmllcy5sZW5ndGggPiAwID8gKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01hbmFnZVJlc3RyaWN0ZWRKb2luUnVsZURpYWxvZ19zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aDM+eyBfdChcIk90aGVyIHNwYWNlcyBvciByb29tcyB5b3UgbWlnaHQgbm90IGtub3dcIikgfTwvaDM+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01hbmFnZVJlc3RyaWN0ZWRKb2luUnVsZURpYWxvZ19zZWN0aW9uX2luZm9cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PnsgX3QoXCJUaGVzZSBhcmUgbGlrZWx5IG9uZXMgb3RoZXIgcm9vbSBhZG1pbnMgYXJlIGEgcGFydCBvZi5cIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IGZpbHRlcmVkT3RoZXJFbnRyaWVzLm1hcChzcGFjZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDxFbnRyeVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e3NwYWNlLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbT17c3BhY2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e25ld1NlbGVjdGVkLmhhcyhzcGFjZS5yb29tSWQpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGNoZWNrZWQ6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlKGNoZWNrZWQsIHNwYWNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pIH1cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgKSA6IG51bGwgfVxuXG4gICAgICAgICAgICAgICAgeyBmaWx0ZXJlZFNwYWNlc0NvbnRhaW5pbmdSb29tLmxlbmd0aCArIGZpbHRlcmVkT3RoZXJFbnRyaWVzLmxlbmd0aCA8IDFcbiAgICAgICAgICAgICAgICAgICAgPyA8c3BhbiBjbGFzc05hbWU9XCJteF9NYW5hZ2VSZXN0cmljdGVkSm9pblJ1bGVEaWFsb2dfbm9SZXN1bHRzXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiTm8gcmVzdWx0c1wiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA8L0F1dG9IaWRlU2Nyb2xsYmFyPlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01hbmFnZVJlc3RyaWN0ZWRKb2luUnVsZURpYWxvZ19mb290ZXJcIj5cbiAgICAgICAgICAgICAgICB7IGludml0ZU9ubHlXYXJuaW5nIH1cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01hbmFnZVJlc3RyaWN0ZWRKb2luUnVsZURpYWxvZ19mb290ZXJfYnV0dG9uc1wiPlxuICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBraW5kPVwicHJpbWFyeV9vdXRsaW5lXCIgb25DbGljaz17KCkgPT4gb25GaW5pc2hlZCgpfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJDYW5jZWxcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGtpbmQ9XCJwcmltYXJ5XCIgb25DbGljaz17KCkgPT4gb25GaW5pc2hlZChBcnJheS5mcm9tKG5ld1NlbGVjdGVkKSl9PlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkNvbmZpcm1cIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9NYXRyaXhDbGllbnRDb250ZXh0LlByb3ZpZGVyPlxuICAgIDwvQmFzZURpYWxvZz47XG59O1xuXG5leHBvcnQgZGVmYXVsdCBNYW5hZ2VSZXN0cmljdGVkSm9pblJ1bGVEaWFsb2c7XG5cbiJdfQ==