"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _partials = require("matrix-js-sdk/src/@types/partials");

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _Validation = _interopRequireDefault(require("../elements/Validation"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _Keyboard = require("../../../Keyboard");

var _createRoom = require("../../../createRoom");

var _CommunityPrototypeStore = require("../../../stores/CommunityPrototypeStore");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Field = _interopRequireDefault(require("../elements/Field"));

var _RoomAliasField = _interopRequireDefault(require("../elements/RoomAliasField"));

var _LabelledToggleSwitch = _interopRequireDefault(require("../elements/LabelledToggleSwitch"));

var _DialogButtons = _interopRequireDefault(require("../elements/DialogButtons"));

var _BaseDialog = _interopRequireDefault(require("../dialogs/BaseDialog"));

var _SpaceStore = _interopRequireDefault(require("../../../stores/spaces/SpaceStore"));

var _JoinRuleDropdown = _interopRequireDefault(require("../elements/JoinRuleDropdown"));

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let CreateRoomDialog = (_dec = (0, _replaceableComponent.replaceableComponent)("views.dialogs.CreateRoomDialog"), _dec(_class = (_temp = _class2 = class CreateRoomDialog extends _react.default.Component {
  constructor(props) {
    var _SpaceStore$instance$;

    super(props);
    (0, _defineProperty2.default)(this, "supportsRestricted", void 0);
    (0, _defineProperty2.default)(this, "nameField", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "aliasField", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "onKeyDown", event => {
      if (event.key === _Keyboard.Key.ENTER) {
        this.onOk();
        event.preventDefault();
        event.stopPropagation();
      }
    });
    (0, _defineProperty2.default)(this, "onOk", async () => {
      const activeElement = document.activeElement;

      if (activeElement) {
        activeElement.blur();
      }

      await this.nameField.current.validate({
        allowEmpty: false
      });

      if (this.aliasField.current) {
        await this.aliasField.current.validate({
          allowEmpty: false
        });
      } // Validation and state updates are async, so we need to wait for them to complete
      // first. Queue a `setState` callback and wait for it to resolve.


      await new Promise(resolve => this.setState({}, resolve));

      if (this.state.nameIsValid && (!this.aliasField.current || this.aliasField.current.isValid)) {
        this.props.onFinished(true, this.roomCreateOptions());
      } else {
        let field;

        if (!this.state.nameIsValid) {
          field = this.nameField.current;
        } else if (this.aliasField.current && !this.aliasField.current.isValid) {
          field = this.aliasField.current;
        }

        if (field) {
          field.focus();
          field.validate({
            allowEmpty: false,
            focused: true
          });
        }
      }
    });
    (0, _defineProperty2.default)(this, "onCancel", () => {
      this.props.onFinished(false);
    });
    (0, _defineProperty2.default)(this, "onNameChange", ev => {
      this.setState({
        name: ev.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onTopicChange", ev => {
      this.setState({
        topic: ev.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onJoinRuleChange", joinRule => {
      this.setState({
        joinRule
      });
    });
    (0, _defineProperty2.default)(this, "onEncryptedChange", isEncrypted => {
      this.setState({
        isEncrypted
      });
    });
    (0, _defineProperty2.default)(this, "onAliasChange", alias => {
      this.setState({
        alias
      });
    });
    (0, _defineProperty2.default)(this, "onDetailsToggled", ev => {
      this.setState({
        detailsOpen: ev.target.open
      });
    });
    (0, _defineProperty2.default)(this, "onNoFederateChange", noFederate => {
      this.setState({
        noFederate
      });
    });
    (0, _defineProperty2.default)(this, "onNameValidate", async fieldState => {
      const result = await CreateRoomDialog.validateRoomName(fieldState);
      this.setState({
        nameIsValid: result.valid
      });
      return result;
    });
    this.supportsRestricted = this.props.parentSpace && !!((_SpaceStore$instance$ = _SpaceStore.default.instance.restrictedJoinRuleSupport) !== null && _SpaceStore$instance$ !== void 0 && _SpaceStore$instance$.preferred);
    let _joinRule = _partials.JoinRule.Invite;

    if (this.props.defaultPublic) {
      _joinRule = _partials.JoinRule.Public;
    } else if (this.supportsRestricted) {
      _joinRule = _partials.JoinRule.Restricted;
    }

    const config = _SdkConfig.default.get();

    this.state = {
      isPublic: this.props.defaultPublic || false,
      isEncrypted: this.props.defaultEncrypted ?? (0, _createRoom.privateShouldBeEncrypted)(),
      joinRule: _joinRule,
      name: this.props.defaultName || "",
      topic: "",
      alias: "",
      detailsOpen: false,
      noFederate: config.default_federate === false,
      nameIsValid: false,
      canChangeEncryption: true
    };

    _MatrixClientPeg.MatrixClientPeg.get().doesServerForceEncryptionForPreset(_partials.Preset.PrivateChat).then(isForced => this.setState({
      canChangeEncryption: !isForced
    }));
  }

  roomCreateOptions() {
    const opts = {};
    const createOpts = opts.createOpts = {};
    createOpts.name = this.state.name;

    if (this.state.joinRule === _partials.JoinRule.Public) {
      createOpts.visibility = _partials.Visibility.Public;
      createOpts.preset = _partials.Preset.PublicChat;
      opts.guestAccess = false;
      const {
        alias
      } = this.state;
      createOpts.room_alias_name = alias.substr(1, alias.indexOf(":") - 1);
    } else {
      // If we cannot change encryption we pass `true` for safety, the server should automatically do this for us.
      opts.encryption = this.state.canChangeEncryption ? this.state.isEncrypted : true;
    }

    if (this.state.topic) {
      createOpts.topic = this.state.topic;
    }

    if (this.state.noFederate) {
      createOpts.creation_content = {
        'm.federate': false
      };
    }

    if (_CommunityPrototypeStore.CommunityPrototypeStore.instance.getSelectedCommunityId()) {
      opts.associatedWithCommunity = _CommunityPrototypeStore.CommunityPrototypeStore.instance.getSelectedCommunityId();
    }

    opts.parentSpace = this.props.parentSpace;

    if (this.props.parentSpace && this.state.joinRule === _partials.JoinRule.Restricted) {
      opts.joinRule = _partials.JoinRule.Restricted;
    }

    return opts;
  }

  componentDidMount() {
    // move focus to first field when showing dialog
    this.nameField.current.focus();
  }

  componentWillUnmount() {}

  render() {
    let aliasField;

    if (this.state.joinRule === _partials.JoinRule.Public) {
      const domain = _MatrixClientPeg.MatrixClientPeg.get().getDomain();

      aliasField = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_CreateRoomDialog_aliasContainer"
      }, /*#__PURE__*/_react.default.createElement(_RoomAliasField.default, {
        ref: this.aliasField,
        onChange: this.onAliasChange,
        domain: domain,
        value: this.state.alias
      }));
    }

    let publicPrivateLabel;

    if (_CommunityPrototypeStore.CommunityPrototypeStore.instance.getSelectedCommunityId()) {
      publicPrivateLabel = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Private rooms can be found and joined by invitation only. Public rooms can be " + "found and joined by anyone in this community."));
    } else if (this.state.joinRule === _partials.JoinRule.Restricted) {
      publicPrivateLabel = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Everyone in <SpaceName/> will be able to find and join this room.", {}, {
        SpaceName: () => /*#__PURE__*/_react.default.createElement("b", null, this.props.parentSpace.name)
      }), "\xA0", (0, _languageHandler._t)("You can change this at any time from room settings."));
    } else if (this.state.joinRule === _partials.JoinRule.Public && this.props.parentSpace) {
      publicPrivateLabel = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Anyone will be able to find and join this room, not just members of <SpaceName/>.", {}, {
        SpaceName: () => /*#__PURE__*/_react.default.createElement("b", null, this.props.parentSpace.name)
      }), "\xA0", (0, _languageHandler._t)("You can change this at any time from room settings."));
    } else if (this.state.joinRule === _partials.JoinRule.Public) {
      publicPrivateLabel = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Anyone will be able to find and join this room."), "\xA0", (0, _languageHandler._t)("You can change this at any time from room settings."));
    } else if (this.state.joinRule === _partials.JoinRule.Invite) {
      publicPrivateLabel = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Only people invited will be able to find and join this room."), "\xA0", (0, _languageHandler._t)("You can change this at any time from room settings."));
    }

    let e2eeSection;

    if (this.state.joinRule !== _partials.JoinRule.Public) {
      let microcopy;

      if ((0, _createRoom.privateShouldBeEncrypted)()) {
        if (this.state.canChangeEncryption) {
          microcopy = (0, _languageHandler._t)("You can't disable this later. Bridges & most bots won't work yet.");
        } else {
          microcopy = (0, _languageHandler._t)("Your server requires encryption to be enabled in private rooms.");
        }
      } else {
        microcopy = (0, _languageHandler._t)("Your server admin has disabled end-to-end encryption by default " + "in private rooms & Direct Messages.");
      }

      e2eeSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
        label: (0, _languageHandler._t)("Enable end-to-end encryption"),
        onChange: this.onEncryptedChange,
        value: this.state.isEncrypted,
        className: "mx_CreateRoomDialog_e2eSwitch" // for end-to-end tests
        ,
        disabled: !this.state.canChangeEncryption
      }), /*#__PURE__*/_react.default.createElement("p", null, microcopy));
    }

    let federateLabel = (0, _languageHandler._t)("You might enable this if the room will only be used for collaborating with internal " + "teams on your homeserver. This cannot be changed later.");

    if (_SdkConfig.default.get().default_federate === false) {
      // We only change the label if the default setting is different to avoid jarring text changes to the
      // user. They will have read the implications of turning this off/on, so no need to rephrase for them.
      federateLabel = (0, _languageHandler._t)("You might disable this if the room will be used for collaborating with external " + "teams who have their own homeserver. This cannot be changed later.");
    }

    let title = (0, _languageHandler._t)("Create a room");

    if (_CommunityPrototypeStore.CommunityPrototypeStore.instance.getSelectedCommunityId()) {
      const name = _CommunityPrototypeStore.CommunityPrototypeStore.instance.getSelectedCommunityName();

      title = (0, _languageHandler._t)("Create a room in %(communityName)s", {
        communityName: name
      });
    } else if (!this.props.parentSpace) {
      title = this.state.joinRule === _partials.JoinRule.Public ? (0, _languageHandler._t)('Create a public room') : (0, _languageHandler._t)('Create a private room');
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_CreateRoomDialog",
      onFinished: this.props.onFinished,
      title: title
    }, /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onOk,
      onKeyDown: this.onKeyDown
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Dialog_content"
    }, /*#__PURE__*/_react.default.createElement(_Field.default, {
      ref: this.nameField,
      label: (0, _languageHandler._t)('Name'),
      onChange: this.onNameChange,
      onValidate: this.onNameValidate,
      value: this.state.name,
      className: "mx_CreateRoomDialog_name"
    }), /*#__PURE__*/_react.default.createElement(_Field.default, {
      label: (0, _languageHandler._t)('Topic (optional)'),
      onChange: this.onTopicChange,
      value: this.state.topic,
      className: "mx_CreateRoomDialog_topic"
    }), /*#__PURE__*/_react.default.createElement(_JoinRuleDropdown.default, {
      label: (0, _languageHandler._t)("Room visibility"),
      labelInvite: (0, _languageHandler._t)("Private room (invite only)"),
      labelPublic: (0, _languageHandler._t)("Public room"),
      labelRestricted: this.supportsRestricted ? (0, _languageHandler._t)("Visible to space members") : undefined,
      value: this.state.joinRule,
      onChange: this.onJoinRuleChange
    }), publicPrivateLabel, e2eeSection, aliasField, /*#__PURE__*/_react.default.createElement("details", {
      onToggle: this.onDetailsToggled,
      className: "mx_CreateRoomDialog_details"
    }, /*#__PURE__*/_react.default.createElement("summary", {
      className: "mx_CreateRoomDialog_details_summary"
    }, this.state.detailsOpen ? (0, _languageHandler._t)('Hide advanced') : (0, _languageHandler._t)('Show advanced')), /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
      label: (0, _languageHandler._t)("Block anyone not part of %(serverName)s from ever joining this room.", {
        serverName: _MatrixClientPeg.MatrixClientPeg.getHomeserverName()
      }),
      onChange: this.onNoFederateChange,
      value: this.state.noFederate
    }), /*#__PURE__*/_react.default.createElement("p", null, federateLabel)))), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('Create Room'),
      onPrimaryButtonClick: this.onOk,
      onCancel: this.onCancel
    }));
  }

}, (0, _defineProperty2.default)(_class2, "validateRoomName", (0, _Validation.default)({
  rules: [{
    key: "required",
    test: async ({
      value
    }) => !!value,
    invalid: () => (0, _languageHandler._t)("Please enter a name for the room")
  }]
})), _temp)) || _class);
exports.default = CreateRoomDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQ3JlYXRlUm9vbURpYWxvZy50c3giXSwibmFtZXMiOlsiQ3JlYXRlUm9vbURpYWxvZyIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImV2ZW50Iiwia2V5IiwiS2V5IiwiRU5URVIiLCJvbk9rIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJhY3RpdmVFbGVtZW50IiwiZG9jdW1lbnQiLCJibHVyIiwibmFtZUZpZWxkIiwiY3VycmVudCIsInZhbGlkYXRlIiwiYWxsb3dFbXB0eSIsImFsaWFzRmllbGQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFN0YXRlIiwic3RhdGUiLCJuYW1lSXNWYWxpZCIsImlzVmFsaWQiLCJvbkZpbmlzaGVkIiwicm9vbUNyZWF0ZU9wdGlvbnMiLCJmaWVsZCIsImZvY3VzIiwiZm9jdXNlZCIsImV2IiwibmFtZSIsInRhcmdldCIsInZhbHVlIiwidG9waWMiLCJqb2luUnVsZSIsImlzRW5jcnlwdGVkIiwiYWxpYXMiLCJkZXRhaWxzT3BlbiIsIm9wZW4iLCJub0ZlZGVyYXRlIiwiZmllbGRTdGF0ZSIsInJlc3VsdCIsInZhbGlkYXRlUm9vbU5hbWUiLCJ2YWxpZCIsInN1cHBvcnRzUmVzdHJpY3RlZCIsInBhcmVudFNwYWNlIiwiU3BhY2VTdG9yZSIsImluc3RhbmNlIiwicmVzdHJpY3RlZEpvaW5SdWxlU3VwcG9ydCIsInByZWZlcnJlZCIsIkpvaW5SdWxlIiwiSW52aXRlIiwiZGVmYXVsdFB1YmxpYyIsIlB1YmxpYyIsIlJlc3RyaWN0ZWQiLCJjb25maWciLCJTZGtDb25maWciLCJnZXQiLCJpc1B1YmxpYyIsImRlZmF1bHRFbmNyeXB0ZWQiLCJkZWZhdWx0TmFtZSIsImRlZmF1bHRfZmVkZXJhdGUiLCJjYW5DaGFuZ2VFbmNyeXB0aW9uIiwiTWF0cml4Q2xpZW50UGVnIiwiZG9lc1NlcnZlckZvcmNlRW5jcnlwdGlvbkZvclByZXNldCIsIlByZXNldCIsIlByaXZhdGVDaGF0IiwidGhlbiIsImlzRm9yY2VkIiwib3B0cyIsImNyZWF0ZU9wdHMiLCJ2aXNpYmlsaXR5IiwiVmlzaWJpbGl0eSIsInByZXNldCIsIlB1YmxpY0NoYXQiLCJndWVzdEFjY2VzcyIsInJvb21fYWxpYXNfbmFtZSIsInN1YnN0ciIsImluZGV4T2YiLCJlbmNyeXB0aW9uIiwiY3JlYXRpb25fY29udGVudCIsIkNvbW11bml0eVByb3RvdHlwZVN0b3JlIiwiZ2V0U2VsZWN0ZWRDb21tdW5pdHlJZCIsImFzc29jaWF0ZWRXaXRoQ29tbXVuaXR5IiwiY29tcG9uZW50RGlkTW91bnQiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbmRlciIsImRvbWFpbiIsImdldERvbWFpbiIsIm9uQWxpYXNDaGFuZ2UiLCJwdWJsaWNQcml2YXRlTGFiZWwiLCJTcGFjZU5hbWUiLCJlMmVlU2VjdGlvbiIsIm1pY3JvY29weSIsIm9uRW5jcnlwdGVkQ2hhbmdlIiwiZmVkZXJhdGVMYWJlbCIsInRpdGxlIiwiZ2V0U2VsZWN0ZWRDb21tdW5pdHlOYW1lIiwiY29tbXVuaXR5TmFtZSIsIm9uS2V5RG93biIsIm9uTmFtZUNoYW5nZSIsIm9uTmFtZVZhbGlkYXRlIiwib25Ub3BpY0NoYW5nZSIsInVuZGVmaW5lZCIsIm9uSm9pblJ1bGVDaGFuZ2UiLCJvbkRldGFpbHNUb2dnbGVkIiwic2VydmVyTmFtZSIsImdldEhvbWVzZXJ2ZXJOYW1lIiwib25Ob0ZlZGVyYXRlQ2hhbmdlIiwib25DYW5jZWwiLCJydWxlcyIsInRlc3QiLCJpbnZhbGlkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWlCQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7SUF3QnFCQSxnQixXQURwQixnREFBcUIsZ0NBQXJCLEMsbUNBQUQsTUFDcUJBLGdCQURyQixTQUM4Q0MsZUFBTUMsU0FEcEQsQ0FDOEU7QUFLMUVDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFRO0FBQUE7O0FBQ2YsVUFBTUEsS0FBTjtBQURlO0FBQUEsa0VBSEMsdUJBR0Q7QUFBQSxtRUFGRSx1QkFFRjtBQUFBLHFEQXlFRUMsS0FBRCxJQUEwQjtBQUMxQyxVQUFJQSxLQUFLLENBQUNDLEdBQU4sS0FBY0MsY0FBSUMsS0FBdEIsRUFBNkI7QUFDekIsYUFBS0MsSUFBTDtBQUNBSixRQUFBQSxLQUFLLENBQUNLLGNBQU47QUFDQUwsUUFBQUEsS0FBSyxDQUFDTSxlQUFOO0FBQ0g7QUFDSixLQS9Fa0I7QUFBQSxnREFpRkosWUFBWTtBQUN2QixZQUFNQyxhQUFhLEdBQUdDLFFBQVEsQ0FBQ0QsYUFBL0I7O0FBQ0EsVUFBSUEsYUFBSixFQUFtQjtBQUNmQSxRQUFBQSxhQUFhLENBQUNFLElBQWQ7QUFDSDs7QUFDRCxZQUFNLEtBQUtDLFNBQUwsQ0FBZUMsT0FBZixDQUF1QkMsUUFBdkIsQ0FBZ0M7QUFBRUMsUUFBQUEsVUFBVSxFQUFFO0FBQWQsT0FBaEMsQ0FBTjs7QUFDQSxVQUFJLEtBQUtDLFVBQUwsQ0FBZ0JILE9BQXBCLEVBQTZCO0FBQ3pCLGNBQU0sS0FBS0csVUFBTCxDQUFnQkgsT0FBaEIsQ0FBd0JDLFFBQXhCLENBQWlDO0FBQUVDLFVBQUFBLFVBQVUsRUFBRTtBQUFkLFNBQWpDLENBQU47QUFDSCxPQVJzQixDQVN2QjtBQUNBOzs7QUFDQSxZQUFNLElBQUlFLE9BQUosQ0FBa0JDLE9BQU8sSUFBSSxLQUFLQyxRQUFMLENBQWMsRUFBZCxFQUFrQkQsT0FBbEIsQ0FBN0IsQ0FBTjs7QUFDQSxVQUFJLEtBQUtFLEtBQUwsQ0FBV0MsV0FBWCxLQUEyQixDQUFDLEtBQUtMLFVBQUwsQ0FBZ0JILE9BQWpCLElBQTRCLEtBQUtHLFVBQUwsQ0FBZ0JILE9BQWhCLENBQXdCUyxPQUEvRSxDQUFKLEVBQTZGO0FBQ3pGLGFBQUtyQixLQUFMLENBQVdzQixVQUFYLENBQXNCLElBQXRCLEVBQTRCLEtBQUtDLGlCQUFMLEVBQTVCO0FBQ0gsT0FGRCxNQUVPO0FBQ0gsWUFBSUMsS0FBSjs7QUFDQSxZQUFJLENBQUMsS0FBS0wsS0FBTCxDQUFXQyxXQUFoQixFQUE2QjtBQUN6QkksVUFBQUEsS0FBSyxHQUFHLEtBQUtiLFNBQUwsQ0FBZUMsT0FBdkI7QUFDSCxTQUZELE1BRU8sSUFBSSxLQUFLRyxVQUFMLENBQWdCSCxPQUFoQixJQUEyQixDQUFDLEtBQUtHLFVBQUwsQ0FBZ0JILE9BQWhCLENBQXdCUyxPQUF4RCxFQUFpRTtBQUNwRUcsVUFBQUEsS0FBSyxHQUFHLEtBQUtULFVBQUwsQ0FBZ0JILE9BQXhCO0FBQ0g7O0FBQ0QsWUFBSVksS0FBSixFQUFXO0FBQ1BBLFVBQUFBLEtBQUssQ0FBQ0MsS0FBTjtBQUNBRCxVQUFBQSxLQUFLLENBQUNYLFFBQU4sQ0FBZTtBQUFFQyxZQUFBQSxVQUFVLEVBQUUsS0FBZDtBQUFxQlksWUFBQUEsT0FBTyxFQUFFO0FBQTlCLFdBQWY7QUFDSDtBQUNKO0FBQ0osS0EzR2tCO0FBQUEsb0RBNkdBLE1BQU07QUFDckIsV0FBSzFCLEtBQUwsQ0FBV3NCLFVBQVgsQ0FBc0IsS0FBdEI7QUFDSCxLQS9Ha0I7QUFBQSx3REFpSEtLLEVBQUQsSUFBdUM7QUFDMUQsV0FBS1QsUUFBTCxDQUFjO0FBQUVVLFFBQUFBLElBQUksRUFBRUQsRUFBRSxDQUFDRSxNQUFILENBQVVDO0FBQWxCLE9BQWQ7QUFDSCxLQW5Ia0I7QUFBQSx5REFxSE1ILEVBQUQsSUFBdUM7QUFDM0QsV0FBS1QsUUFBTCxDQUFjO0FBQUVhLFFBQUFBLEtBQUssRUFBRUosRUFBRSxDQUFDRSxNQUFILENBQVVDO0FBQW5CLE9BQWQ7QUFDSCxLQXZIa0I7QUFBQSw0REF5SFNFLFFBQUQsSUFBd0I7QUFDL0MsV0FBS2QsUUFBTCxDQUFjO0FBQUVjLFFBQUFBO0FBQUYsT0FBZDtBQUNILEtBM0hrQjtBQUFBLDZEQTZIVUMsV0FBRCxJQUEwQjtBQUNsRCxXQUFLZixRQUFMLENBQWM7QUFBRWUsUUFBQUE7QUFBRixPQUFkO0FBQ0gsS0EvSGtCO0FBQUEseURBaUlNQyxLQUFELElBQW1CO0FBQ3ZDLFdBQUtoQixRQUFMLENBQWM7QUFBRWdCLFFBQUFBO0FBQUYsT0FBZDtBQUNILEtBbklrQjtBQUFBLDREQXFJU1AsRUFBRCxJQUE0QztBQUNuRSxXQUFLVCxRQUFMLENBQWM7QUFBRWlCLFFBQUFBLFdBQVcsRUFBR1IsRUFBRSxDQUFDRSxNQUFKLENBQWtDTztBQUFqRCxPQUFkO0FBQ0gsS0F2SWtCO0FBQUEsOERBeUlXQyxVQUFELElBQXlCO0FBQ2xELFdBQUtuQixRQUFMLENBQWM7QUFBRW1CLFFBQUFBO0FBQUYsT0FBZDtBQUNILEtBM0lrQjtBQUFBLDBEQTZJTSxNQUFPQyxVQUFQLElBQW1DO0FBQ3hELFlBQU1DLE1BQU0sR0FBRyxNQUFNM0MsZ0JBQWdCLENBQUM0QyxnQkFBakIsQ0FBa0NGLFVBQWxDLENBQXJCO0FBQ0EsV0FBS3BCLFFBQUwsQ0FBYztBQUFFRSxRQUFBQSxXQUFXLEVBQUVtQixNQUFNLENBQUNFO0FBQXRCLE9BQWQ7QUFDQSxhQUFPRixNQUFQO0FBQ0gsS0FqSmtCO0FBR2YsU0FBS0csa0JBQUwsR0FBMEIsS0FBSzFDLEtBQUwsQ0FBVzJDLFdBQVgsSUFBMEIsQ0FBQywyQkFBQ0Msb0JBQVdDLFFBQVgsQ0FBb0JDLHlCQUFyQixrREFBQyxzQkFBK0NDLFNBQWhELENBQXJEO0FBRUEsUUFBSWYsU0FBUSxHQUFHZ0IsbUJBQVNDLE1BQXhCOztBQUNBLFFBQUksS0FBS2pELEtBQUwsQ0FBV2tELGFBQWYsRUFBOEI7QUFDMUJsQixNQUFBQSxTQUFRLEdBQUdnQixtQkFBU0csTUFBcEI7QUFDSCxLQUZELE1BRU8sSUFBSSxLQUFLVCxrQkFBVCxFQUE2QjtBQUNoQ1YsTUFBQUEsU0FBUSxHQUFHZ0IsbUJBQVNJLFVBQXBCO0FBQ0g7O0FBRUQsVUFBTUMsTUFBTSxHQUFHQyxtQkFBVUMsR0FBVixFQUFmOztBQUNBLFNBQUtwQyxLQUFMLEdBQWE7QUFDVHFDLE1BQUFBLFFBQVEsRUFBRSxLQUFLeEQsS0FBTCxDQUFXa0QsYUFBWCxJQUE0QixLQUQ3QjtBQUVUakIsTUFBQUEsV0FBVyxFQUFFLEtBQUtqQyxLQUFMLENBQVd5RCxnQkFBWCxJQUErQiwyQ0FGbkM7QUFHVHpCLE1BQUFBLFFBQVEsRUFBUkEsU0FIUztBQUlUSixNQUFBQSxJQUFJLEVBQUUsS0FBSzVCLEtBQUwsQ0FBVzBELFdBQVgsSUFBMEIsRUFKdkI7QUFLVDNCLE1BQUFBLEtBQUssRUFBRSxFQUxFO0FBTVRHLE1BQUFBLEtBQUssRUFBRSxFQU5FO0FBT1RDLE1BQUFBLFdBQVcsRUFBRSxLQVBKO0FBUVRFLE1BQUFBLFVBQVUsRUFBRWdCLE1BQU0sQ0FBQ00sZ0JBQVAsS0FBNEIsS0FSL0I7QUFTVHZDLE1BQUFBLFdBQVcsRUFBRSxLQVRKO0FBVVR3QyxNQUFBQSxtQkFBbUIsRUFBRTtBQVZaLEtBQWI7O0FBYUFDLHFDQUFnQk4sR0FBaEIsR0FBc0JPLGtDQUF0QixDQUF5REMsaUJBQU9DLFdBQWhFLEVBQ0tDLElBREwsQ0FDVUMsUUFBUSxJQUFJLEtBQUtoRCxRQUFMLENBQWM7QUFBRTBDLE1BQUFBLG1CQUFtQixFQUFFLENBQUNNO0FBQXhCLEtBQWQsQ0FEdEI7QUFFSDs7QUFFTzNDLEVBQUFBLGlCQUFpQixHQUFHO0FBQ3hCLFVBQU00QyxJQUFXLEdBQUcsRUFBcEI7QUFDQSxVQUFNQyxVQUErQixHQUFHRCxJQUFJLENBQUNDLFVBQUwsR0FBa0IsRUFBMUQ7QUFDQUEsSUFBQUEsVUFBVSxDQUFDeEMsSUFBWCxHQUFrQixLQUFLVCxLQUFMLENBQVdTLElBQTdCOztBQUVBLFFBQUksS0FBS1QsS0FBTCxDQUFXYSxRQUFYLEtBQXdCZ0IsbUJBQVNHLE1BQXJDLEVBQTZDO0FBQ3pDaUIsTUFBQUEsVUFBVSxDQUFDQyxVQUFYLEdBQXdCQyxxQkFBV25CLE1BQW5DO0FBQ0FpQixNQUFBQSxVQUFVLENBQUNHLE1BQVgsR0FBb0JSLGlCQUFPUyxVQUEzQjtBQUNBTCxNQUFBQSxJQUFJLENBQUNNLFdBQUwsR0FBbUIsS0FBbkI7QUFDQSxZQUFNO0FBQUV2QyxRQUFBQTtBQUFGLFVBQVksS0FBS2YsS0FBdkI7QUFDQWlELE1BQUFBLFVBQVUsQ0FBQ00sZUFBWCxHQUE2QnhDLEtBQUssQ0FBQ3lDLE1BQU4sQ0FBYSxDQUFiLEVBQWdCekMsS0FBSyxDQUFDMEMsT0FBTixDQUFjLEdBQWQsSUFBcUIsQ0FBckMsQ0FBN0I7QUFDSCxLQU5ELE1BTU87QUFDSDtBQUNBVCxNQUFBQSxJQUFJLENBQUNVLFVBQUwsR0FBa0IsS0FBSzFELEtBQUwsQ0FBV3lDLG1CQUFYLEdBQWlDLEtBQUt6QyxLQUFMLENBQVdjLFdBQTVDLEdBQTBELElBQTVFO0FBQ0g7O0FBRUQsUUFBSSxLQUFLZCxLQUFMLENBQVdZLEtBQWYsRUFBc0I7QUFDbEJxQyxNQUFBQSxVQUFVLENBQUNyQyxLQUFYLEdBQW1CLEtBQUtaLEtBQUwsQ0FBV1ksS0FBOUI7QUFDSDs7QUFDRCxRQUFJLEtBQUtaLEtBQUwsQ0FBV2tCLFVBQWYsRUFBMkI7QUFDdkIrQixNQUFBQSxVQUFVLENBQUNVLGdCQUFYLEdBQThCO0FBQUUsc0JBQWM7QUFBaEIsT0FBOUI7QUFDSDs7QUFFRCxRQUFJQyxpREFBd0JsQyxRQUF4QixDQUFpQ21DLHNCQUFqQyxFQUFKLEVBQStEO0FBQzNEYixNQUFBQSxJQUFJLENBQUNjLHVCQUFMLEdBQStCRixpREFBd0JsQyxRQUF4QixDQUFpQ21DLHNCQUFqQyxFQUEvQjtBQUNIOztBQUVEYixJQUFBQSxJQUFJLENBQUN4QixXQUFMLEdBQW1CLEtBQUszQyxLQUFMLENBQVcyQyxXQUE5Qjs7QUFDQSxRQUFJLEtBQUszQyxLQUFMLENBQVcyQyxXQUFYLElBQTBCLEtBQUt4QixLQUFMLENBQVdhLFFBQVgsS0FBd0JnQixtQkFBU0ksVUFBL0QsRUFBMkU7QUFDdkVlLE1BQUFBLElBQUksQ0FBQ25DLFFBQUwsR0FBZ0JnQixtQkFBU0ksVUFBekI7QUFDSDs7QUFFRCxXQUFPZSxJQUFQO0FBQ0g7O0FBRURlLEVBQUFBLGlCQUFpQixHQUFHO0FBQ2hCO0FBQ0EsU0FBS3ZFLFNBQUwsQ0FBZUMsT0FBZixDQUF1QmEsS0FBdkI7QUFDSDs7QUFFRDBELEVBQUFBLG9CQUFvQixHQUFHLENBQ3RCOztBQXNGREMsRUFBQUEsTUFBTSxHQUFHO0FBQ0wsUUFBSXJFLFVBQUo7O0FBQ0EsUUFBSSxLQUFLSSxLQUFMLENBQVdhLFFBQVgsS0FBd0JnQixtQkFBU0csTUFBckMsRUFBNkM7QUFDekMsWUFBTWtDLE1BQU0sR0FBR3hCLGlDQUFnQk4sR0FBaEIsR0FBc0IrQixTQUF0QixFQUFmOztBQUNBdkUsTUFBQUEsVUFBVSxnQkFDTjtBQUFLLFFBQUEsU0FBUyxFQUFDO0FBQWYsc0JBQ0ksNkJBQUMsdUJBQUQ7QUFDSSxRQUFBLEdBQUcsRUFBRSxLQUFLQSxVQURkO0FBRUksUUFBQSxRQUFRLEVBQUUsS0FBS3dFLGFBRm5CO0FBR0ksUUFBQSxNQUFNLEVBQUVGLE1BSFo7QUFJSSxRQUFBLEtBQUssRUFBRSxLQUFLbEUsS0FBTCxDQUFXZTtBQUp0QixRQURKLENBREo7QUFVSDs7QUFFRCxRQUFJc0Qsa0JBQUo7O0FBQ0EsUUFBSVQsaURBQXdCbEMsUUFBeEIsQ0FBaUNtQyxzQkFBakMsRUFBSixFQUErRDtBQUMzRFEsTUFBQUEsa0JBQWtCLGdCQUFHLHdDQUNmLHlCQUNFLG1GQUNBLCtDQUZGLENBRGUsQ0FBckI7QUFNSCxLQVBELE1BT08sSUFBSSxLQUFLckUsS0FBTCxDQUFXYSxRQUFYLEtBQXdCZ0IsbUJBQVNJLFVBQXJDLEVBQWlEO0FBQ3BEb0MsTUFBQUEsa0JBQWtCLGdCQUFHLHdDQUNmLHlCQUNFLG1FQURGLEVBQ3VFLEVBRHZFLEVBQzJFO0FBQ3JFQyxRQUFBQSxTQUFTLEVBQUUsbUJBQU0sd0NBQUssS0FBS3pGLEtBQUwsQ0FBVzJDLFdBQVgsQ0FBdUJmLElBQTVCO0FBRG9ELE9BRDNFLENBRGUsVUFPZix5QkFBRyxxREFBSCxDQVBlLENBQXJCO0FBU0gsS0FWTSxNQVVBLElBQUksS0FBS1QsS0FBTCxDQUFXYSxRQUFYLEtBQXdCZ0IsbUJBQVNHLE1BQWpDLElBQTJDLEtBQUtuRCxLQUFMLENBQVcyQyxXQUExRCxFQUF1RTtBQUMxRTZDLE1BQUFBLGtCQUFrQixnQkFBRyx3Q0FDZix5QkFDRSxtRkFERixFQUN1RixFQUR2RixFQUMyRjtBQUNyRkMsUUFBQUEsU0FBUyxFQUFFLG1CQUFNLHdDQUFLLEtBQUt6RixLQUFMLENBQVcyQyxXQUFYLENBQXVCZixJQUE1QjtBQURvRSxPQUQzRixDQURlLFVBT2YseUJBQUcscURBQUgsQ0FQZSxDQUFyQjtBQVNILEtBVk0sTUFVQSxJQUFJLEtBQUtULEtBQUwsQ0FBV2EsUUFBWCxLQUF3QmdCLG1CQUFTRyxNQUFyQyxFQUE2QztBQUNoRHFDLE1BQUFBLGtCQUFrQixnQkFBRyx3Q0FDZix5QkFBRyxpREFBSCxDQURlLFVBR2YseUJBQUcscURBQUgsQ0FIZSxDQUFyQjtBQUtILEtBTk0sTUFNQSxJQUFJLEtBQUtyRSxLQUFMLENBQVdhLFFBQVgsS0FBd0JnQixtQkFBU0MsTUFBckMsRUFBNkM7QUFDaER1QyxNQUFBQSxrQkFBa0IsZ0JBQUcsd0NBQ2YseUJBQ0UsOERBREYsQ0FEZSxVQUtmLHlCQUFHLHFEQUFILENBTGUsQ0FBckI7QUFPSDs7QUFFRCxRQUFJRSxXQUFKOztBQUNBLFFBQUksS0FBS3ZFLEtBQUwsQ0FBV2EsUUFBWCxLQUF3QmdCLG1CQUFTRyxNQUFyQyxFQUE2QztBQUN6QyxVQUFJd0MsU0FBSjs7QUFDQSxVQUFJLDJDQUFKLEVBQWdDO0FBQzVCLFlBQUksS0FBS3hFLEtBQUwsQ0FBV3lDLG1CQUFmLEVBQW9DO0FBQ2hDK0IsVUFBQUEsU0FBUyxHQUFHLHlCQUFHLG1FQUFILENBQVo7QUFDSCxTQUZELE1BRU87QUFDSEEsVUFBQUEsU0FBUyxHQUFHLHlCQUFHLGlFQUFILENBQVo7QUFDSDtBQUNKLE9BTkQsTUFNTztBQUNIQSxRQUFBQSxTQUFTLEdBQUcseUJBQUcscUVBQ1gscUNBRFEsQ0FBWjtBQUVIOztBQUNERCxNQUFBQSxXQUFXLGdCQUFHLDZCQUFDLGNBQUQsQ0FBTyxRQUFQLHFCQUNWLDZCQUFDLDZCQUFEO0FBQ0ksUUFBQSxLQUFLLEVBQUUseUJBQUcsOEJBQUgsQ0FEWDtBQUVJLFFBQUEsUUFBUSxFQUFFLEtBQUtFLGlCQUZuQjtBQUdJLFFBQUEsS0FBSyxFQUFFLEtBQUt6RSxLQUFMLENBQVdjLFdBSHRCO0FBSUksUUFBQSxTQUFTLEVBQUMsK0JBSmQsQ0FJOEM7QUFKOUM7QUFLSSxRQUFBLFFBQVEsRUFBRSxDQUFDLEtBQUtkLEtBQUwsQ0FBV3lDO0FBTDFCLFFBRFUsZUFRVix3Q0FBSytCLFNBQUwsQ0FSVSxDQUFkO0FBVUg7O0FBRUQsUUFBSUUsYUFBYSxHQUFHLHlCQUNoQix5RkFDQSx5REFGZ0IsQ0FBcEI7O0FBSUEsUUFBSXZDLG1CQUFVQyxHQUFWLEdBQWdCSSxnQkFBaEIsS0FBcUMsS0FBekMsRUFBZ0Q7QUFDNUM7QUFDQTtBQUNBa0MsTUFBQUEsYUFBYSxHQUFHLHlCQUNaLHFGQUNBLG9FQUZZLENBQWhCO0FBSUg7O0FBRUQsUUFBSUMsS0FBSyxHQUFHLHlCQUFHLGVBQUgsQ0FBWjs7QUFDQSxRQUFJZixpREFBd0JsQyxRQUF4QixDQUFpQ21DLHNCQUFqQyxFQUFKLEVBQStEO0FBQzNELFlBQU1wRCxJQUFJLEdBQUdtRCxpREFBd0JsQyxRQUF4QixDQUFpQ2tELHdCQUFqQyxFQUFiOztBQUNBRCxNQUFBQSxLQUFLLEdBQUcseUJBQUcsb0NBQUgsRUFBeUM7QUFBRUUsUUFBQUEsYUFBYSxFQUFFcEU7QUFBakIsT0FBekMsQ0FBUjtBQUNILEtBSEQsTUFHTyxJQUFJLENBQUMsS0FBSzVCLEtBQUwsQ0FBVzJDLFdBQWhCLEVBQTZCO0FBQ2hDbUQsTUFBQUEsS0FBSyxHQUFHLEtBQUszRSxLQUFMLENBQVdhLFFBQVgsS0FBd0JnQixtQkFBU0csTUFBakMsR0FBMEMseUJBQUcsc0JBQUgsQ0FBMUMsR0FBdUUseUJBQUcsdUJBQUgsQ0FBL0U7QUFDSDs7QUFFRCx3QkFDSSw2QkFBQyxtQkFBRDtBQUFZLE1BQUEsU0FBUyxFQUFDLHFCQUF0QjtBQUE0QyxNQUFBLFVBQVUsRUFBRSxLQUFLbkQsS0FBTCxDQUFXc0IsVUFBbkU7QUFBK0UsTUFBQSxLQUFLLEVBQUV3RTtBQUF0RixvQkFDSTtBQUFNLE1BQUEsUUFBUSxFQUFFLEtBQUt6RixJQUFyQjtBQUEyQixNQUFBLFNBQVMsRUFBRSxLQUFLNEY7QUFBM0Msb0JBQ0k7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLG9CQUNJLDZCQUFDLGNBQUQ7QUFDSSxNQUFBLEdBQUcsRUFBRSxLQUFLdEYsU0FEZDtBQUVJLE1BQUEsS0FBSyxFQUFFLHlCQUFHLE1BQUgsQ0FGWDtBQUdJLE1BQUEsUUFBUSxFQUFFLEtBQUt1RixZQUhuQjtBQUlJLE1BQUEsVUFBVSxFQUFFLEtBQUtDLGNBSnJCO0FBS0ksTUFBQSxLQUFLLEVBQUUsS0FBS2hGLEtBQUwsQ0FBV1MsSUFMdEI7QUFNSSxNQUFBLFNBQVMsRUFBQztBQU5kLE1BREosZUFTSSw2QkFBQyxjQUFEO0FBQ0ksTUFBQSxLQUFLLEVBQUUseUJBQUcsa0JBQUgsQ0FEWDtBQUVJLE1BQUEsUUFBUSxFQUFFLEtBQUt3RSxhQUZuQjtBQUdJLE1BQUEsS0FBSyxFQUFFLEtBQUtqRixLQUFMLENBQVdZLEtBSHRCO0FBSUksTUFBQSxTQUFTLEVBQUM7QUFKZCxNQVRKLGVBZ0JJLDZCQUFDLHlCQUFEO0FBQ0ksTUFBQSxLQUFLLEVBQUUseUJBQUcsaUJBQUgsQ0FEWDtBQUVJLE1BQUEsV0FBVyxFQUFFLHlCQUFHLDRCQUFILENBRmpCO0FBR0ksTUFBQSxXQUFXLEVBQUUseUJBQUcsYUFBSCxDQUhqQjtBQUlJLE1BQUEsZUFBZSxFQUFFLEtBQUtXLGtCQUFMLEdBQTBCLHlCQUFHLDBCQUFILENBQTFCLEdBQTJEMkQsU0FKaEY7QUFLSSxNQUFBLEtBQUssRUFBRSxLQUFLbEYsS0FBTCxDQUFXYSxRQUx0QjtBQU1JLE1BQUEsUUFBUSxFQUFFLEtBQUtzRTtBQU5uQixNQWhCSixFQXlCTWQsa0JBekJOLEVBMEJNRSxXQTFCTixFQTJCTTNFLFVBM0JOLGVBNEJJO0FBQVMsTUFBQSxRQUFRLEVBQUUsS0FBS3dGLGdCQUF4QjtBQUEwQyxNQUFBLFNBQVMsRUFBQztBQUFwRCxvQkFDSTtBQUFTLE1BQUEsU0FBUyxFQUFDO0FBQW5CLE9BQ00sS0FBS3BGLEtBQUwsQ0FBV2dCLFdBQVgsR0FBeUIseUJBQUcsZUFBSCxDQUF6QixHQUErQyx5QkFBRyxlQUFILENBRHJELENBREosZUFJSSw2QkFBQyw2QkFBRDtBQUNJLE1BQUEsS0FBSyxFQUFFLHlCQUNILHNFQURHLEVBRUg7QUFBRXFFLFFBQUFBLFVBQVUsRUFBRTNDLGlDQUFnQjRDLGlCQUFoQjtBQUFkLE9BRkcsQ0FEWDtBQUtJLE1BQUEsUUFBUSxFQUFFLEtBQUtDLGtCQUxuQjtBQU1JLE1BQUEsS0FBSyxFQUFFLEtBQUt2RixLQUFMLENBQVdrQjtBQU50QixNQUpKLGVBWUksd0NBQUt3RCxhQUFMLENBWkosQ0E1QkosQ0FESixDQURKLGVBOENJLDZCQUFDLHNCQUFEO0FBQWUsTUFBQSxhQUFhLEVBQUUseUJBQUcsYUFBSCxDQUE5QjtBQUNJLE1BQUEsb0JBQW9CLEVBQUUsS0FBS3hGLElBRC9CO0FBRUksTUFBQSxRQUFRLEVBQUUsS0FBS3NHO0FBRm5CLE1BOUNKLENBREo7QUFvREg7O0FBaFV5RSxDLDZEQXdKeEMseUJBQWU7QUFDN0NDLEVBQUFBLEtBQUssRUFBRSxDQUNIO0FBQ0kxRyxJQUFBQSxHQUFHLEVBQUUsVUFEVDtBQUVJMkcsSUFBQUEsSUFBSSxFQUFFLE9BQU87QUFBRS9FLE1BQUFBO0FBQUYsS0FBUCxLQUFxQixDQUFDLENBQUNBLEtBRmpDO0FBR0lnRixJQUFBQSxPQUFPLEVBQUUsTUFBTSx5QkFBRyxrQ0FBSDtBQUhuQixHQURHO0FBRHNDLENBQWYsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxNyBNaWNoYWVsIFRlbGF0eW5za2kgPDd0M2NoZ3V5QGdtYWlsLmNvbT5cbkNvcHlyaWdodCAyMDIwLCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IENoYW5nZUV2ZW50LCBjcmVhdGVSZWYsIEtleWJvYXJkRXZlbnQsIFN5bnRoZXRpY0V2ZW50IH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5pbXBvcnQgeyBKb2luUnVsZSwgUHJlc2V0LCBWaXNpYmlsaXR5IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL0B0eXBlcy9wYXJ0aWFsc1wiO1xuXG5pbXBvcnQgU2RrQ29uZmlnIGZyb20gJy4uLy4uLy4uL1Nka0NvbmZpZyc7XG5pbXBvcnQgd2l0aFZhbGlkYXRpb24sIHsgSUZpZWxkU3RhdGUgfSBmcm9tICcuLi9lbGVtZW50cy9WYWxpZGF0aW9uJztcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gJy4uLy4uLy4uL01hdHJpeENsaWVudFBlZyc7XG5pbXBvcnQgeyBLZXkgfSBmcm9tIFwiLi4vLi4vLi4vS2V5Ym9hcmRcIjtcbmltcG9ydCB7IElPcHRzLCBwcml2YXRlU2hvdWxkQmVFbmNyeXB0ZWQgfSBmcm9tIFwiLi4vLi4vLi4vY3JlYXRlUm9vbVwiO1xuaW1wb3J0IHsgQ29tbXVuaXR5UHJvdG90eXBlU3RvcmUgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL0NvbW11bml0eVByb3RvdHlwZVN0b3JlXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IEZpZWxkIGZyb20gXCIuLi9lbGVtZW50cy9GaWVsZFwiO1xuaW1wb3J0IFJvb21BbGlhc0ZpZWxkIGZyb20gXCIuLi9lbGVtZW50cy9Sb29tQWxpYXNGaWVsZFwiO1xuaW1wb3J0IExhYmVsbGVkVG9nZ2xlU3dpdGNoIGZyb20gXCIuLi9lbGVtZW50cy9MYWJlbGxlZFRvZ2dsZVN3aXRjaFwiO1xuaW1wb3J0IERpYWxvZ0J1dHRvbnMgZnJvbSBcIi4uL2VsZW1lbnRzL0RpYWxvZ0J1dHRvbnNcIjtcbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gXCIuLi9kaWFsb2dzL0Jhc2VEaWFsb2dcIjtcbmltcG9ydCBTcGFjZVN0b3JlIGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvc3BhY2VzL1NwYWNlU3RvcmVcIjtcbmltcG9ydCBKb2luUnVsZURyb3Bkb3duIGZyb20gXCIuLi9lbGVtZW50cy9Kb2luUnVsZURyb3Bkb3duXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGRlZmF1bHRQdWJsaWM/OiBib29sZWFuO1xuICAgIGRlZmF1bHROYW1lPzogc3RyaW5nO1xuICAgIHBhcmVudFNwYWNlPzogUm9vbTtcbiAgICBkZWZhdWx0RW5jcnlwdGVkPzogYm9vbGVhbjtcbiAgICBvbkZpbmlzaGVkKHByb2NlZWQ6IGJvb2xlYW4sIG9wdHM/OiBJT3B0cyk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIGpvaW5SdWxlOiBKb2luUnVsZTtcbiAgICBpc1B1YmxpYzogYm9vbGVhbjtcbiAgICBpc0VuY3J5cHRlZDogYm9vbGVhbjtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgdG9waWM6IHN0cmluZztcbiAgICBhbGlhczogc3RyaW5nO1xuICAgIGRldGFpbHNPcGVuOiBib29sZWFuO1xuICAgIG5vRmVkZXJhdGU6IGJvb2xlYW47XG4gICAgbmFtZUlzVmFsaWQ6IGJvb2xlYW47XG4gICAgY2FuQ2hhbmdlRW5jcnlwdGlvbjogYm9vbGVhbjtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuZGlhbG9ncy5DcmVhdGVSb29tRGlhbG9nXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDcmVhdGVSb29tRGlhbG9nIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBzdXBwb3J0c1Jlc3RyaWN0ZWQ6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBuYW1lRmllbGQgPSBjcmVhdGVSZWY8RmllbGQ+KCk7XG4gICAgcHJpdmF0ZSBhbGlhc0ZpZWxkID0gY3JlYXRlUmVmPFJvb21BbGlhc0ZpZWxkPigpO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3VwcG9ydHNSZXN0cmljdGVkID0gdGhpcy5wcm9wcy5wYXJlbnRTcGFjZSAmJiAhIVNwYWNlU3RvcmUuaW5zdGFuY2UucmVzdHJpY3RlZEpvaW5SdWxlU3VwcG9ydD8ucHJlZmVycmVkO1xuXG4gICAgICAgIGxldCBqb2luUnVsZSA9IEpvaW5SdWxlLkludml0ZTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuZGVmYXVsdFB1YmxpYykge1xuICAgICAgICAgICAgam9pblJ1bGUgPSBKb2luUnVsZS5QdWJsaWM7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdXBwb3J0c1Jlc3RyaWN0ZWQpIHtcbiAgICAgICAgICAgIGpvaW5SdWxlID0gSm9pblJ1bGUuUmVzdHJpY3RlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IFNka0NvbmZpZy5nZXQoKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGlzUHVibGljOiB0aGlzLnByb3BzLmRlZmF1bHRQdWJsaWMgfHwgZmFsc2UsXG4gICAgICAgICAgICBpc0VuY3J5cHRlZDogdGhpcy5wcm9wcy5kZWZhdWx0RW5jcnlwdGVkID8/IHByaXZhdGVTaG91bGRCZUVuY3J5cHRlZCgpLFxuICAgICAgICAgICAgam9pblJ1bGUsXG4gICAgICAgICAgICBuYW1lOiB0aGlzLnByb3BzLmRlZmF1bHROYW1lIHx8IFwiXCIsXG4gICAgICAgICAgICB0b3BpYzogXCJcIixcbiAgICAgICAgICAgIGFsaWFzOiBcIlwiLFxuICAgICAgICAgICAgZGV0YWlsc09wZW46IGZhbHNlLFxuICAgICAgICAgICAgbm9GZWRlcmF0ZTogY29uZmlnLmRlZmF1bHRfZmVkZXJhdGUgPT09IGZhbHNlLFxuICAgICAgICAgICAgbmFtZUlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgY2FuQ2hhbmdlRW5jcnlwdGlvbjogdHJ1ZSxcbiAgICAgICAgfTtcblxuICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZG9lc1NlcnZlckZvcmNlRW5jcnlwdGlvbkZvclByZXNldChQcmVzZXQuUHJpdmF0ZUNoYXQpXG4gICAgICAgICAgICAudGhlbihpc0ZvcmNlZCA9PiB0aGlzLnNldFN0YXRlKHsgY2FuQ2hhbmdlRW5jcnlwdGlvbjogIWlzRm9yY2VkIH0pKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJvb21DcmVhdGVPcHRpb25zKCkge1xuICAgICAgICBjb25zdCBvcHRzOiBJT3B0cyA9IHt9O1xuICAgICAgICBjb25zdCBjcmVhdGVPcHRzOiBJT3B0c1tcImNyZWF0ZU9wdHNcIl0gPSBvcHRzLmNyZWF0ZU9wdHMgPSB7fTtcbiAgICAgICAgY3JlYXRlT3B0cy5uYW1lID0gdGhpcy5zdGF0ZS5uYW1lO1xuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmpvaW5SdWxlID09PSBKb2luUnVsZS5QdWJsaWMpIHtcbiAgICAgICAgICAgIGNyZWF0ZU9wdHMudmlzaWJpbGl0eSA9IFZpc2liaWxpdHkuUHVibGljO1xuICAgICAgICAgICAgY3JlYXRlT3B0cy5wcmVzZXQgPSBQcmVzZXQuUHVibGljQ2hhdDtcbiAgICAgICAgICAgIG9wdHMuZ3Vlc3RBY2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIGNvbnN0IHsgYWxpYXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjcmVhdGVPcHRzLnJvb21fYWxpYXNfbmFtZSA9IGFsaWFzLnN1YnN0cigxLCBhbGlhcy5pbmRleE9mKFwiOlwiKSAtIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgd2UgY2Fubm90IGNoYW5nZSBlbmNyeXB0aW9uIHdlIHBhc3MgYHRydWVgIGZvciBzYWZldHksIHRoZSBzZXJ2ZXIgc2hvdWxkIGF1dG9tYXRpY2FsbHkgZG8gdGhpcyBmb3IgdXMuXG4gICAgICAgICAgICBvcHRzLmVuY3J5cHRpb24gPSB0aGlzLnN0YXRlLmNhbkNoYW5nZUVuY3J5cHRpb24gPyB0aGlzLnN0YXRlLmlzRW5jcnlwdGVkIDogdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnRvcGljKSB7XG4gICAgICAgICAgICBjcmVhdGVPcHRzLnRvcGljID0gdGhpcy5zdGF0ZS50b3BpYztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5ub0ZlZGVyYXRlKSB7XG4gICAgICAgICAgICBjcmVhdGVPcHRzLmNyZWF0aW9uX2NvbnRlbnQgPSB7ICdtLmZlZGVyYXRlJzogZmFsc2UgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChDb21tdW5pdHlQcm90b3R5cGVTdG9yZS5pbnN0YW5jZS5nZXRTZWxlY3RlZENvbW11bml0eUlkKCkpIHtcbiAgICAgICAgICAgIG9wdHMuYXNzb2NpYXRlZFdpdGhDb21tdW5pdHkgPSBDb21tdW5pdHlQcm90b3R5cGVTdG9yZS5pbnN0YW5jZS5nZXRTZWxlY3RlZENvbW11bml0eUlkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBvcHRzLnBhcmVudFNwYWNlID0gdGhpcy5wcm9wcy5wYXJlbnRTcGFjZTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMucGFyZW50U3BhY2UgJiYgdGhpcy5zdGF0ZS5qb2luUnVsZSA9PT0gSm9pblJ1bGUuUmVzdHJpY3RlZCkge1xuICAgICAgICAgICAgb3B0cy5qb2luUnVsZSA9IEpvaW5SdWxlLlJlc3RyaWN0ZWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3B0cztcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgLy8gbW92ZSBmb2N1cyB0byBmaXJzdCBmaWVsZCB3aGVuIHNob3dpbmcgZGlhbG9nXG4gICAgICAgIHRoaXMubmFtZUZpZWxkLmN1cnJlbnQuZm9jdXMoKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uS2V5RG93biA9IChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBLZXkuRU5URVIpIHtcbiAgICAgICAgICAgIHRoaXMub25PaygpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25PayA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIGlmIChhY3RpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICBhY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLm5hbWVGaWVsZC5jdXJyZW50LnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogZmFsc2UgfSk7XG4gICAgICAgIGlmICh0aGlzLmFsaWFzRmllbGQuY3VycmVudCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hbGlhc0ZpZWxkLmN1cnJlbnQudmFsaWRhdGUoeyBhbGxvd0VtcHR5OiBmYWxzZSB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBWYWxpZGF0aW9uIGFuZCBzdGF0ZSB1cGRhdGVzIGFyZSBhc3luYywgc28gd2UgbmVlZCB0byB3YWl0IGZvciB0aGVtIHRvIGNvbXBsZXRlXG4gICAgICAgIC8vIGZpcnN0LiBRdWV1ZSBhIGBzZXRTdGF0ZWAgY2FsbGJhY2sgYW5kIHdhaXQgZm9yIGl0IHRvIHJlc29sdmUuXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KHJlc29sdmUgPT4gdGhpcy5zZXRTdGF0ZSh7fSwgcmVzb2x2ZSkpO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5uYW1lSXNWYWxpZCAmJiAoIXRoaXMuYWxpYXNGaWVsZC5jdXJyZW50IHx8IHRoaXMuYWxpYXNGaWVsZC5jdXJyZW50LmlzVmFsaWQpKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uRmluaXNoZWQodHJ1ZSwgdGhpcy5yb29tQ3JlYXRlT3B0aW9ucygpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBmaWVsZDtcbiAgICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5uYW1lSXNWYWxpZCkge1xuICAgICAgICAgICAgICAgIGZpZWxkID0gdGhpcy5uYW1lRmllbGQuY3VycmVudDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hbGlhc0ZpZWxkLmN1cnJlbnQgJiYgIXRoaXMuYWxpYXNGaWVsZC5jdXJyZW50LmlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICBmaWVsZCA9IHRoaXMuYWxpYXNGaWVsZC5jdXJyZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgZmllbGQuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICBmaWVsZC52YWxpZGF0ZSh7IGFsbG93RW1wdHk6IGZhbHNlLCBmb2N1c2VkOiB0cnVlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25DYW5jZWwgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMucHJvcHMub25GaW5pc2hlZChmYWxzZSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25OYW1lQ2hhbmdlID0gKGV2OiBDaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbmFtZTogZXYudGFyZ2V0LnZhbHVlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uVG9waWNDaGFuZ2UgPSAoZXY6IENoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyB0b3BpYzogZXYudGFyZ2V0LnZhbHVlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uSm9pblJ1bGVDaGFuZ2UgPSAoam9pblJ1bGU6IEpvaW5SdWxlKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBqb2luUnVsZSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkVuY3J5cHRlZENoYW5nZSA9IChpc0VuY3J5cHRlZDogYm9vbGVhbikgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaXNFbmNyeXB0ZWQgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25BbGlhc0NoYW5nZSA9IChhbGlhczogc3RyaW5nKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBhbGlhcyB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkRldGFpbHNUb2dnbGVkID0gKGV2OiBTeW50aGV0aWNFdmVudDxIVE1MRGV0YWlsc0VsZW1lbnQ+KSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBkZXRhaWxzT3BlbjogKGV2LnRhcmdldCBhcyBIVE1MRGV0YWlsc0VsZW1lbnQpLm9wZW4gfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Ob0ZlZGVyYXRlQ2hhbmdlID0gKG5vRmVkZXJhdGU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG5vRmVkZXJhdGUgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25OYW1lVmFsaWRhdGUgPSBhc3luYyAoZmllbGRTdGF0ZTogSUZpZWxkU3RhdGUpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgQ3JlYXRlUm9vbURpYWxvZy52YWxpZGF0ZVJvb21OYW1lKGZpZWxkU3RhdGUpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbmFtZUlzVmFsaWQ6IHJlc3VsdC52YWxpZCB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBzdGF0aWMgdmFsaWRhdGVSb29tTmFtZSA9IHdpdGhWYWxpZGF0aW9uKHtcbiAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBrZXk6IFwicmVxdWlyZWRcIixcbiAgICAgICAgICAgICAgICB0ZXN0OiBhc3luYyAoeyB2YWx1ZSB9KSA9PiAhIXZhbHVlLFxuICAgICAgICAgICAgICAgIGludmFsaWQ6ICgpID0+IF90KFwiUGxlYXNlIGVudGVyIGEgbmFtZSBmb3IgdGhlIHJvb21cIiksXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0pO1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBsZXQgYWxpYXNGaWVsZDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuam9pblJ1bGUgPT09IEpvaW5SdWxlLlB1YmxpYykge1xuICAgICAgICAgICAgY29uc3QgZG9tYWluID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldERvbWFpbigpO1xuICAgICAgICAgICAgYWxpYXNGaWVsZCA9IChcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0NyZWF0ZVJvb21EaWFsb2dfYWxpYXNDb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPFJvb21BbGlhc0ZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICByZWY9e3RoaXMuYWxpYXNGaWVsZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uQWxpYXNDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW49e2RvbWFpbn1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmFsaWFzfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBwdWJsaWNQcml2YXRlTGFiZWw6IEpTWC5FbGVtZW50O1xuICAgICAgICBpZiAoQ29tbXVuaXR5UHJvdG90eXBlU3RvcmUuaW5zdGFuY2UuZ2V0U2VsZWN0ZWRDb21tdW5pdHlJZCgpKSB7XG4gICAgICAgICAgICBwdWJsaWNQcml2YXRlTGFiZWwgPSA8cD5cbiAgICAgICAgICAgICAgICB7IF90KFxuICAgICAgICAgICAgICAgICAgICBcIlByaXZhdGUgcm9vbXMgY2FuIGJlIGZvdW5kIGFuZCBqb2luZWQgYnkgaW52aXRhdGlvbiBvbmx5LiBQdWJsaWMgcm9vbXMgY2FuIGJlIFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJmb3VuZCBhbmQgam9pbmVkIGJ5IGFueW9uZSBpbiB0aGlzIGNvbW11bml0eS5cIixcbiAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgIDwvcD47XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5qb2luUnVsZSA9PT0gSm9pblJ1bGUuUmVzdHJpY3RlZCkge1xuICAgICAgICAgICAgcHVibGljUHJpdmF0ZUxhYmVsID0gPHA+XG4gICAgICAgICAgICAgICAgeyBfdChcbiAgICAgICAgICAgICAgICAgICAgXCJFdmVyeW9uZSBpbiA8U3BhY2VOYW1lLz4gd2lsbCBiZSBhYmxlIHRvIGZpbmQgYW5kIGpvaW4gdGhpcyByb29tLlwiLCB7fSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgU3BhY2VOYW1lOiAoKSA9PiA8Yj57IHRoaXMucHJvcHMucGFyZW50U3BhY2UubmFtZSB9PC9iPixcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICB7IF90KFwiWW91IGNhbiBjaGFuZ2UgdGhpcyBhdCBhbnkgdGltZSBmcm9tIHJvb20gc2V0dGluZ3MuXCIpIH1cbiAgICAgICAgICAgIDwvcD47XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5qb2luUnVsZSA9PT0gSm9pblJ1bGUuUHVibGljICYmIHRoaXMucHJvcHMucGFyZW50U3BhY2UpIHtcbiAgICAgICAgICAgIHB1YmxpY1ByaXZhdGVMYWJlbCA9IDxwPlxuICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiQW55b25lIHdpbGwgYmUgYWJsZSB0byBmaW5kIGFuZCBqb2luIHRoaXMgcm9vbSwgbm90IGp1c3QgbWVtYmVycyBvZiA8U3BhY2VOYW1lLz4uXCIsIHt9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBTcGFjZU5hbWU6ICgpID0+IDxiPnsgdGhpcy5wcm9wcy5wYXJlbnRTcGFjZS5uYW1lIH08L2I+LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgICZuYnNwO1xuICAgICAgICAgICAgICAgIHsgX3QoXCJZb3UgY2FuIGNoYW5nZSB0aGlzIGF0IGFueSB0aW1lIGZyb20gcm9vbSBzZXR0aW5ncy5cIikgfVxuICAgICAgICAgICAgPC9wPjtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLmpvaW5SdWxlID09PSBKb2luUnVsZS5QdWJsaWMpIHtcbiAgICAgICAgICAgIHB1YmxpY1ByaXZhdGVMYWJlbCA9IDxwPlxuICAgICAgICAgICAgICAgIHsgX3QoXCJBbnlvbmUgd2lsbCBiZSBhYmxlIHRvIGZpbmQgYW5kIGpvaW4gdGhpcyByb29tLlwiKSB9XG4gICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgeyBfdChcIllvdSBjYW4gY2hhbmdlIHRoaXMgYXQgYW55IHRpbWUgZnJvbSByb29tIHNldHRpbmdzLlwiKSB9XG4gICAgICAgICAgICA8L3A+O1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUuam9pblJ1bGUgPT09IEpvaW5SdWxlLkludml0ZSkge1xuICAgICAgICAgICAgcHVibGljUHJpdmF0ZUxhYmVsID0gPHA+XG4gICAgICAgICAgICAgICAgeyBfdChcbiAgICAgICAgICAgICAgICAgICAgXCJPbmx5IHBlb3BsZSBpbnZpdGVkIHdpbGwgYmUgYWJsZSB0byBmaW5kIGFuZCBqb2luIHRoaXMgcm9vbS5cIixcbiAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgICAgICAmbmJzcDtcbiAgICAgICAgICAgICAgICB7IF90KFwiWW91IGNhbiBjaGFuZ2UgdGhpcyBhdCBhbnkgdGltZSBmcm9tIHJvb20gc2V0dGluZ3MuXCIpIH1cbiAgICAgICAgICAgIDwvcD47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgZTJlZVNlY3Rpb247XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmpvaW5SdWxlICE9PSBKb2luUnVsZS5QdWJsaWMpIHtcbiAgICAgICAgICAgIGxldCBtaWNyb2NvcHk7XG4gICAgICAgICAgICBpZiAocHJpdmF0ZVNob3VsZEJlRW5jcnlwdGVkKCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5jYW5DaGFuZ2VFbmNyeXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIG1pY3JvY29weSA9IF90KFwiWW91IGNhbid0IGRpc2FibGUgdGhpcyBsYXRlci4gQnJpZGdlcyAmIG1vc3QgYm90cyB3b24ndCB3b3JrIHlldC5cIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbWljcm9jb3B5ID0gX3QoXCJZb3VyIHNlcnZlciByZXF1aXJlcyBlbmNyeXB0aW9uIHRvIGJlIGVuYWJsZWQgaW4gcHJpdmF0ZSByb29tcy5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtaWNyb2NvcHkgPSBfdChcIllvdXIgc2VydmVyIGFkbWluIGhhcyBkaXNhYmxlZCBlbmQtdG8tZW5kIGVuY3J5cHRpb24gYnkgZGVmYXVsdCBcIiArXG4gICAgICAgICAgICAgICAgICAgIFwiaW4gcHJpdmF0ZSByb29tcyAmIERpcmVjdCBNZXNzYWdlcy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlMmVlU2VjdGlvbiA9IDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgICA8TGFiZWxsZWRUb2dnbGVTd2l0Y2hcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiRW5hYmxlIGVuZC10by1lbmQgZW5jcnlwdGlvblwiKX1cbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25FbmNyeXB0ZWRDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmlzRW5jcnlwdGVkfVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9J214X0NyZWF0ZVJvb21EaWFsb2dfZTJlU3dpdGNoJyAvLyBmb3IgZW5kLXRvLWVuZCB0ZXN0c1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17IXRoaXMuc3RhdGUuY2FuQ2hhbmdlRW5jcnlwdGlvbn1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxwPnsgbWljcm9jb3B5IH08L3A+XG4gICAgICAgICAgICA8L1JlYWN0LkZyYWdtZW50PjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmZWRlcmF0ZUxhYmVsID0gX3QoXG4gICAgICAgICAgICBcIllvdSBtaWdodCBlbmFibGUgdGhpcyBpZiB0aGUgcm9vbSB3aWxsIG9ubHkgYmUgdXNlZCBmb3IgY29sbGFib3JhdGluZyB3aXRoIGludGVybmFsIFwiICtcbiAgICAgICAgICAgIFwidGVhbXMgb24geW91ciBob21lc2VydmVyLiBUaGlzIGNhbm5vdCBiZSBjaGFuZ2VkIGxhdGVyLlwiLFxuICAgICAgICApO1xuICAgICAgICBpZiAoU2RrQ29uZmlnLmdldCgpLmRlZmF1bHRfZmVkZXJhdGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAvLyBXZSBvbmx5IGNoYW5nZSB0aGUgbGFiZWwgaWYgdGhlIGRlZmF1bHQgc2V0dGluZyBpcyBkaWZmZXJlbnQgdG8gYXZvaWQgamFycmluZyB0ZXh0IGNoYW5nZXMgdG8gdGhlXG4gICAgICAgICAgICAvLyB1c2VyLiBUaGV5IHdpbGwgaGF2ZSByZWFkIHRoZSBpbXBsaWNhdGlvbnMgb2YgdHVybmluZyB0aGlzIG9mZi9vbiwgc28gbm8gbmVlZCB0byByZXBocmFzZSBmb3IgdGhlbS5cbiAgICAgICAgICAgIGZlZGVyYXRlTGFiZWwgPSBfdChcbiAgICAgICAgICAgICAgICBcIllvdSBtaWdodCBkaXNhYmxlIHRoaXMgaWYgdGhlIHJvb20gd2lsbCBiZSB1c2VkIGZvciBjb2xsYWJvcmF0aW5nIHdpdGggZXh0ZXJuYWwgXCIgK1xuICAgICAgICAgICAgICAgIFwidGVhbXMgd2hvIGhhdmUgdGhlaXIgb3duIGhvbWVzZXJ2ZXIuIFRoaXMgY2Fubm90IGJlIGNoYW5nZWQgbGF0ZXIuXCIsXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRpdGxlID0gX3QoXCJDcmVhdGUgYSByb29tXCIpO1xuICAgICAgICBpZiAoQ29tbXVuaXR5UHJvdG90eXBlU3RvcmUuaW5zdGFuY2UuZ2V0U2VsZWN0ZWRDb21tdW5pdHlJZCgpKSB7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gQ29tbXVuaXR5UHJvdG90eXBlU3RvcmUuaW5zdGFuY2UuZ2V0U2VsZWN0ZWRDb21tdW5pdHlOYW1lKCk7XG4gICAgICAgICAgICB0aXRsZSA9IF90KFwiQ3JlYXRlIGEgcm9vbSBpbiAlKGNvbW11bml0eU5hbWUpc1wiLCB7IGNvbW11bml0eU5hbWU6IG5hbWUgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMucHJvcHMucGFyZW50U3BhY2UpIHtcbiAgICAgICAgICAgIHRpdGxlID0gdGhpcy5zdGF0ZS5qb2luUnVsZSA9PT0gSm9pblJ1bGUuUHVibGljID8gX3QoJ0NyZWF0ZSBhIHB1YmxpYyByb29tJykgOiBfdCgnQ3JlYXRlIGEgcHJpdmF0ZSByb29tJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEJhc2VEaWFsb2cgY2xhc3NOYW1lPVwibXhfQ3JlYXRlUm9vbURpYWxvZ1wiIG9uRmluaXNoZWQ9e3RoaXMucHJvcHMub25GaW5pc2hlZH0gdGl0bGU9e3RpdGxlfT5cbiAgICAgICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17dGhpcy5vbk9rfSBvbktleURvd249e3RoaXMub25LZXlEb3dufT5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9EaWFsb2dfY29udGVudFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmPXt0aGlzLm5hbWVGaWVsZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoJ05hbWUnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbk5hbWVDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25WYWxpZGF0ZT17dGhpcy5vbk5hbWVWYWxpZGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5uYW1lfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0NyZWF0ZVJvb21EaWFsb2dfbmFtZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KCdUb3BpYyAob3B0aW9uYWwpJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25Ub3BpY0NoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS50b3BpY31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9DcmVhdGVSb29tRGlhbG9nX3RvcGljXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxKb2luUnVsZURyb3Bkb3duXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiUm9vbSB2aXNpYmlsaXR5XCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsSW52aXRlPXtfdChcIlByaXZhdGUgcm9vbSAoaW52aXRlIG9ubHkpXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsUHVibGljPXtfdChcIlB1YmxpYyByb29tXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsUmVzdHJpY3RlZD17dGhpcy5zdXBwb3J0c1Jlc3RyaWN0ZWQgPyBfdChcIlZpc2libGUgdG8gc3BhY2UgbWVtYmVyc1wiKSA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5qb2luUnVsZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbkpvaW5SdWxlQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgeyBwdWJsaWNQcml2YXRlTGFiZWwgfVxuICAgICAgICAgICAgICAgICAgICAgICAgeyBlMmVlU2VjdGlvbiB9XG4gICAgICAgICAgICAgICAgICAgICAgICB7IGFsaWFzRmllbGQgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPGRldGFpbHMgb25Ub2dnbGU9e3RoaXMub25EZXRhaWxzVG9nZ2xlZH0gY2xhc3NOYW1lPVwibXhfQ3JlYXRlUm9vbURpYWxvZ19kZXRhaWxzXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN1bW1hcnkgY2xhc3NOYW1lPVwibXhfQ3JlYXRlUm9vbURpYWxvZ19kZXRhaWxzX3N1bW1hcnlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0aGlzLnN0YXRlLmRldGFpbHNPcGVuID8gX3QoJ0hpZGUgYWR2YW5jZWQnKSA6IF90KCdTaG93IGFkdmFuY2VkJykgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3VtbWFyeT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWxsZWRUb2dnbGVTd2l0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJCbG9jayBhbnlvbmUgbm90IHBhcnQgb2YgJShzZXJ2ZXJOYW1lKXMgZnJvbSBldmVyIGpvaW5pbmcgdGhpcyByb29tLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBzZXJ2ZXJOYW1lOiBNYXRyaXhDbGllbnRQZWcuZ2V0SG9tZXNlcnZlck5hbWUoKSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbk5vRmVkZXJhdGVDaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLm5vRmVkZXJhdGV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD57IGZlZGVyYXRlTGFiZWwgfTwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGV0YWlscz5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9mb3JtPlxuICAgICAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zIHByaW1hcnlCdXR0b249e190KCdDcmVhdGUgUm9vbScpfVxuICAgICAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17dGhpcy5vbk9rfVxuICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbD17dGhpcy5vbkNhbmNlbH0gLz5cbiAgICAgICAgICAgIDwvQmFzZURpYWxvZz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=