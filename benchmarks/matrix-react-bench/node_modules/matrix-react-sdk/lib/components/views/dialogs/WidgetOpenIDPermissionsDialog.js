"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../languageHandler");

var _LabelledToggleSwitch = _interopRequireDefault(require("../elements/LabelledToggleSwitch"));

var _WidgetPermissionStore = require("../../../stores/widgets/WidgetPermissionStore");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _DialogButtons = _interopRequireDefault(require("../elements/DialogButtons"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

let WidgetOpenIDPermissionsDialog = (_dec = (0, _replaceableComponent.replaceableComponent)("views.dialogs.WidgetOpenIDPermissionsDialog"), _dec(_class = class WidgetOpenIDPermissionsDialog extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onAllow", () => {
      this.onPermissionSelection(true);
    });
    (0, _defineProperty2.default)(this, "onDeny", () => {
      this.onPermissionSelection(false);
    });
    (0, _defineProperty2.default)(this, "onRememberSelectionChange", newVal => {
      this.setState({
        rememberSelection: newVal
      });
    });
    this.state = {
      rememberSelection: false
    };
  }

  onPermissionSelection(allowed) {
    if (this.state.rememberSelection) {
      _logger.logger.log(`Remembering ${this.props.widget.id} as allowed=${allowed} for OpenID`);

      _WidgetPermissionStore.WidgetPermissionStore.instance.setOIDCState(this.props.widget, this.props.widgetKind, this.props.inRoomId, allowed ? _WidgetPermissionStore.OIDCState.Allowed : _WidgetPermissionStore.OIDCState.Denied);
    }

    this.props.onFinished(allowed);
  }

  render() {
    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_WidgetOpenIDPermissionsDialog",
      hasCancel: true,
      onFinished: this.props.onFinished,
      title: (0, _languageHandler._t)("Allow this widget to verify your identity")
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_WidgetOpenIDPermissionsDialog_content"
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("The widget will verify your user ID, but won't be able to perform actions for you:")), /*#__PURE__*/_react.default.createElement("p", {
      className: "text-muted"
    }, this.props.widget.templateUrl.split("?")[0].split("#")[0])), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)("Continue"),
      onPrimaryButtonClick: this.onAllow,
      onCancel: this.onDeny,
      additive: /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
        value: this.state.rememberSelection,
        toggleInFront: true,
        onChange: this.onRememberSelectionChange,
        label: (0, _languageHandler._t)("Remember this")
      })
    }));
  }

}) || _class);
exports.default = WidgetOpenIDPermissionsDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvV2lkZ2V0T3BlbklEUGVybWlzc2lvbnNEaWFsb2cudHN4Il0sIm5hbWVzIjpbIldpZGdldE9wZW5JRFBlcm1pc3Npb25zRGlhbG9nIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsIm9uUGVybWlzc2lvblNlbGVjdGlvbiIsIm5ld1ZhbCIsInNldFN0YXRlIiwicmVtZW1iZXJTZWxlY3Rpb24iLCJzdGF0ZSIsImFsbG93ZWQiLCJsb2dnZXIiLCJsb2ciLCJ3aWRnZXQiLCJpZCIsIldpZGdldFBlcm1pc3Npb25TdG9yZSIsImluc3RhbmNlIiwic2V0T0lEQ1N0YXRlIiwid2lkZ2V0S2luZCIsImluUm9vbUlkIiwiT0lEQ1N0YXRlIiwiQWxsb3dlZCIsIkRlbmllZCIsIm9uRmluaXNoZWQiLCJyZW5kZXIiLCJ0ZW1wbGF0ZVVybCIsInNwbGl0Iiwib25BbGxvdyIsIm9uRGVueSIsIm9uUmVtZW1iZXJTZWxlY3Rpb25DaGFuZ2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUVBOzs7O0lBYXFCQSw2QixXQURwQixnREFBcUIsNkNBQXJCLEMsZ0JBQUQsTUFDcUJBLDZCQURyQixTQUMyREMsZUFBTUMsYUFEakUsQ0FDK0Y7QUFDM0ZDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFnQjtBQUN2QixVQUFNQSxLQUFOO0FBRHVCLG1EQVFULE1BQVk7QUFDMUIsV0FBS0MscUJBQUwsQ0FBMkIsSUFBM0I7QUFDSCxLQVYwQjtBQUFBLGtEQVlWLE1BQVk7QUFDekIsV0FBS0EscUJBQUwsQ0FBMkIsS0FBM0I7QUFDSCxLQWQwQjtBQUFBLHFFQTZCVUMsTUFBRCxJQUEyQjtBQUMzRCxXQUFLQyxRQUFMLENBQWM7QUFBRUMsUUFBQUEsaUJBQWlCLEVBQUVGO0FBQXJCLE9BQWQ7QUFDSCxLQS9CMEI7QUFHdkIsU0FBS0csS0FBTCxHQUFhO0FBQ1RELE1BQUFBLGlCQUFpQixFQUFFO0FBRFYsS0FBYjtBQUdIOztBQVVPSCxFQUFBQSxxQkFBcUIsQ0FBQ0ssT0FBRCxFQUF5QjtBQUNsRCxRQUFJLEtBQUtELEtBQUwsQ0FBV0QsaUJBQWYsRUFBa0M7QUFDOUJHLHFCQUFPQyxHQUFQLENBQVksZUFBYyxLQUFLUixLQUFMLENBQVdTLE1BQVgsQ0FBa0JDLEVBQUcsZUFBY0osT0FBUSxhQUFyRTs7QUFFQUssbURBQXNCQyxRQUF0QixDQUErQkMsWUFBL0IsQ0FDSSxLQUFLYixLQUFMLENBQVdTLE1BRGYsRUFDdUIsS0FBS1QsS0FBTCxDQUFXYyxVQURsQyxFQUM4QyxLQUFLZCxLQUFMLENBQVdlLFFBRHpELEVBRUlULE9BQU8sR0FBR1UsaUNBQVVDLE9BQWIsR0FBdUJELGlDQUFVRSxNQUY1QztBQUlIOztBQUVELFNBQUtsQixLQUFMLENBQVdtQixVQUFYLENBQXNCYixPQUF0QjtBQUNIOztBQU1NYyxFQUFBQSxNQUFNLEdBQWdCO0FBQ3pCLHdCQUNJLDZCQUFDLG1CQUFEO0FBQ0ksTUFBQSxTQUFTLEVBQUMsa0NBRGQ7QUFFSSxNQUFBLFNBQVMsRUFBRSxJQUZmO0FBR0ksTUFBQSxVQUFVLEVBQUUsS0FBS3BCLEtBQUwsQ0FBV21CLFVBSDNCO0FBSUksTUFBQSxLQUFLLEVBQUUseUJBQUcsMkNBQUg7QUFKWCxvQkFNSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsb0JBQ0ksd0NBQ00seUJBQUcsb0ZBQUgsQ0FETixDQURKLGVBSUk7QUFBRyxNQUFBLFNBQVMsRUFBQztBQUFiLE9BRU0sS0FBS25CLEtBQUwsQ0FBV1MsTUFBWCxDQUFrQlksV0FBbEIsQ0FBOEJDLEtBQTlCLENBQW9DLEdBQXBDLEVBQXlDLENBQXpDLEVBQTRDQSxLQUE1QyxDQUFrRCxHQUFsRCxFQUF1RCxDQUF2RCxDQUZOLENBSkosQ0FOSixlQWVJLDZCQUFDLHNCQUFEO0FBQ0ksTUFBQSxhQUFhLEVBQUUseUJBQUcsVUFBSCxDQURuQjtBQUVJLE1BQUEsb0JBQW9CLEVBQUUsS0FBS0MsT0FGL0I7QUFHSSxNQUFBLFFBQVEsRUFBRSxLQUFLQyxNQUhuQjtBQUlJLE1BQUEsUUFBUSxlQUNKLDZCQUFDLDZCQUFEO0FBQ0ksUUFBQSxLQUFLLEVBQUUsS0FBS25CLEtBQUwsQ0FBV0QsaUJBRHRCO0FBRUksUUFBQSxhQUFhLEVBQUUsSUFGbkI7QUFHSSxRQUFBLFFBQVEsRUFBRSxLQUFLcUIseUJBSG5CO0FBSUksUUFBQSxLQUFLLEVBQUUseUJBQUcsZUFBSDtBQUpYO0FBTFIsTUFmSixDQURKO0FBNkJIOztBQWhFMEYsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOSBUcmF2aXMgUmFsc3RvblxuQ29weXJpZ2h0IDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgTGFiZWxsZWRUb2dnbGVTd2l0Y2ggZnJvbSBcIi4uL2VsZW1lbnRzL0xhYmVsbGVkVG9nZ2xlU3dpdGNoXCI7XG5pbXBvcnQgeyBXaWRnZXQsIFdpZGdldEtpbmQgfSBmcm9tIFwibWF0cml4LXdpZGdldC1hcGlcIjtcbmltcG9ydCB7IE9JRENTdGF0ZSwgV2lkZ2V0UGVybWlzc2lvblN0b3JlIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy93aWRnZXRzL1dpZGdldFBlcm1pc3Npb25TdG9yZVwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCB7IElEaWFsb2dQcm9wcyB9IGZyb20gXCIuL0lEaWFsb2dQcm9wc1wiO1xuaW1wb3J0IEJhc2VEaWFsb2cgZnJvbSBcIi4vQmFzZURpYWxvZ1wiO1xuaW1wb3J0IERpYWxvZ0J1dHRvbnMgZnJvbSBcIi4uL2VsZW1lbnRzL0RpYWxvZ0J1dHRvbnNcIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIGV4dGVuZHMgSURpYWxvZ1Byb3BzIHtcbiAgICB3aWRnZXQ6IFdpZGdldDtcbiAgICB3aWRnZXRLaW5kOiBXaWRnZXRLaW5kO1xuICAgIGluUm9vbUlkPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICByZW1lbWJlclNlbGVjdGlvbjogYm9vbGVhbjtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuZGlhbG9ncy5XaWRnZXRPcGVuSURQZXJtaXNzaW9uc0RpYWxvZ1wiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2lkZ2V0T3BlbklEUGVybWlzc2lvbnNEaWFsb2cgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHJlbWVtYmVyU2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uQWxsb3cgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMub25QZXJtaXNzaW9uU2VsZWN0aW9uKHRydWUpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uRGVueSA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5vblBlcm1pc3Npb25TZWxlY3Rpb24oZmFsc2UpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUGVybWlzc2lvblNlbGVjdGlvbihhbGxvd2VkOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnJlbWVtYmVyU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICBsb2dnZXIubG9nKGBSZW1lbWJlcmluZyAke3RoaXMucHJvcHMud2lkZ2V0LmlkfSBhcyBhbGxvd2VkPSR7YWxsb3dlZH0gZm9yIE9wZW5JRGApO1xuXG4gICAgICAgICAgICBXaWRnZXRQZXJtaXNzaW9uU3RvcmUuaW5zdGFuY2Uuc2V0T0lEQ1N0YXRlKFxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMud2lkZ2V0LCB0aGlzLnByb3BzLndpZGdldEtpbmQsIHRoaXMucHJvcHMuaW5Sb29tSWQsXG4gICAgICAgICAgICAgICAgYWxsb3dlZCA/IE9JRENTdGF0ZS5BbGxvd2VkIDogT0lEQ1N0YXRlLkRlbmllZCxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnByb3BzLm9uRmluaXNoZWQoYWxsb3dlZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblJlbWVtYmVyU2VsZWN0aW9uQ2hhbmdlID0gKG5ld1ZhbDogYm9vbGVhbik6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgcmVtZW1iZXJTZWxlY3Rpb246IG5ld1ZhbCB9KTtcbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZ1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0nbXhfV2lkZ2V0T3BlbklEUGVybWlzc2lvbnNEaWFsb2cnXG4gICAgICAgICAgICAgICAgaGFzQ2FuY2VsPXt0cnVlfVxuICAgICAgICAgICAgICAgIG9uRmluaXNoZWQ9e3RoaXMucHJvcHMub25GaW5pc2hlZH1cbiAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJBbGxvdyB0aGlzIHdpZGdldCB0byB2ZXJpZnkgeW91ciBpZGVudGl0eVwiKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbXhfV2lkZ2V0T3BlbklEUGVybWlzc2lvbnNEaWFsb2dfY29udGVudCc+XG4gICAgICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIlRoZSB3aWRnZXQgd2lsbCB2ZXJpZnkgeW91ciB1c2VyIElELCBidXQgd29uJ3QgYmUgYWJsZSB0byBwZXJmb3JtIGFjdGlvbnMgZm9yIHlvdTpcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtbXV0ZWRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgLyogY2hlYXAgdHJpbSB0byBqdXN0IGdldCB0aGUgcGF0aCAqLyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMud2lkZ2V0LnRlbXBsYXRlVXJsLnNwbGl0KFwiP1wiKVswXS5zcGxpdChcIiNcIilbMF0gfVxuICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPERpYWxvZ0J1dHRvbnNcbiAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbj17X3QoXCJDb250aW51ZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMub25BbGxvd31cbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw9e3RoaXMub25EZW55fVxuICAgICAgICAgICAgICAgICAgICBhZGRpdGl2ZT17XG4gICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWxsZWRUb2dnbGVTd2l0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5yZW1lbWJlclNlbGVjdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVJbkZyb250PXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uUmVtZW1iZXJTZWxlY3Rpb25DaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiUmVtZW1iZXIgdGhpc1wiKX0gLz59XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvQmFzZURpYWxvZz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=