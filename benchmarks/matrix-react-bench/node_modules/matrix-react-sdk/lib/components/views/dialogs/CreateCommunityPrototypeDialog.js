"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _languageHandler = require("../../../languageHandler");

var _Field = _interopRequireDefault(require("../elements/Field"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _InfoTooltip = _interopRequireDefault(require("../elements/InfoTooltip"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _actions = require("../../../dispatcher/actions");

var _RoomInvite = require("../../../RoomInvite");

var _GroupStore = _interopRequireDefault(require("../../../stores/GroupStore"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

let CreateCommunityPrototypeDialog = (_dec = (0, _replaceableComponent.replaceableComponent)("views.dialogs.CreateCommunityPrototypeDialog"), _dec(_class = class CreateCommunityPrototypeDialog extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "avatarUploadRef", /*#__PURE__*/_react.default.createRef());
    (0, _defineProperty2.default)(this, "onNameChange", ev => {
      const localpart = (ev.target.value || "").toLowerCase().replace(/[^a-z0-9.\-_]/g, '-');
      this.setState({
        name: ev.target.value,
        localpart
      });
    });
    (0, _defineProperty2.default)(this, "onSubmit", async ev => {
      ev.preventDefault();
      ev.stopPropagation();
      if (this.state.busy) return; // We'll create the community now to see if it's taken, leaving it active in
      // the background for the user to look at while they invite people.

      this.setState({
        busy: true
      });

      try {
        let avatarUrl = ''; // must be a string for synapse to accept it

        if (this.state.avatarFile) {
          avatarUrl = await _MatrixClientPeg.MatrixClientPeg.get().uploadContent(this.state.avatarFile);
        }

        const result = await _MatrixClientPeg.MatrixClientPeg.get().createGroup({
          localpart: this.state.localpart,
          profile: {
            name: this.state.name,
            avatar_url: avatarUrl
          }
        }); // Ensure the tag gets selected now that we've created it

        _dispatcher.default.dispatch({
          action: 'deselect_tags'
        }, true);

        _dispatcher.default.dispatch({
          action: 'select_tag',
          tag: result.group_id
        }); // Close our own dialog before moving much further


        this.props.onFinished(true);

        if (result.room_id) {
          // Force the group store to update as it might have missed the general chat
          await _GroupStore.default.refreshGroupRooms(result.group_id);

          _dispatcher.default.dispatch({
            action: _actions.Action.ViewRoom,
            room_id: result.room_id
          });

          (0, _RoomInvite.showCommunityRoomInviteDialog)(result.room_id, this.state.name);
        } else {
          _dispatcher.default.dispatch({
            action: 'view_group',
            group_id: result.group_id,
            group_is_new: true
          });
        }
      } catch (e) {
        _logger.logger.error(e);

        this.setState({
          busy: false,
          error: (0, _languageHandler._t)("There was an error creating your community. The name may be taken or the " + "server is unable to process your request.")
        });
      }
    });
    (0, _defineProperty2.default)(this, "onAvatarChanged", e => {
      if (!e.target.files || !e.target.files.length) {
        this.setState({
          avatarFile: null
        });
      } else {
        this.setState({
          busy: true
        });
        const file = e.target.files[0];
        const reader = new FileReader();

        reader.onload = ev => {
          this.setState({
            avatarFile: file,
            busy: false,
            avatarPreview: ev.target.result
          });
        };

        reader.readAsDataURL(file);
      }
    });
    (0, _defineProperty2.default)(this, "onChangeAvatar", () => {
      if (this.avatarUploadRef.current) this.avatarUploadRef.current.click();
    });
    this.state = {
      name: "",
      localpart: "",
      error: null,
      busy: false,
      avatarFile: null,
      avatarPreview: null
    };
  }

  render() {
    let communityId = null;

    if (this.state.localpart) {
      communityId = /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_CreateCommunityPrototypeDialog_communityId"
      }, (0, _languageHandler._t)("Community ID: +<localpart />:%(domain)s", {
        domain: _MatrixClientPeg.MatrixClientPeg.getHomeserverName()
      }, {
        localpart: () => /*#__PURE__*/_react.default.createElement("u", null, this.state.localpart)
      }), /*#__PURE__*/_react.default.createElement(_InfoTooltip.default, {
        tooltip: (0, _languageHandler._t)("Use this when referencing your community to others. The community ID " + "cannot be changed.")
      }));
    }

    let helpText = /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_CreateCommunityPrototypeDialog_subtext"
    }, (0, _languageHandler._t)("You can change this later if needed."));

    if (this.state.error) {
      const classes = "mx_CreateCommunityPrototypeDialog_subtext mx_CreateCommunityPrototypeDialog_subtext_error";
      helpText = /*#__PURE__*/_react.default.createElement("span", {
        className: classes
      }, this.state.error);
    }

    let preview = /*#__PURE__*/_react.default.createElement("img", {
      src: this.state.avatarPreview,
      className: "mx_CreateCommunityPrototypeDialog_avatar"
    });

    if (!this.state.avatarPreview) {
      preview = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_CreateCommunityPrototypeDialog_placeholderAvatar"
      });
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_CreateCommunityPrototypeDialog",
      onFinished: this.props.onFinished,
      title: (0, _languageHandler._t)("What's the name of your community or team?")
    }, /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onSubmit
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Dialog_content"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateCommunityPrototypeDialog_colName"
    }, /*#__PURE__*/_react.default.createElement(_Field.default, {
      value: this.state.name,
      onChange: this.onNameChange,
      placeholder: (0, _languageHandler._t)("Enter name"),
      label: (0, _languageHandler._t)("Enter name")
    }), helpText, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_CreateCommunityPrototypeDialog_subtext"
    }, "\xA0", communityId), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "primary",
      onClick: this.onSubmit,
      disabled: this.state.busy
    }, (0, _languageHandler._t)("Create"))), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateCommunityPrototypeDialog_colAvatar"
    }, /*#__PURE__*/_react.default.createElement("input", {
      type: "file",
      style: {
        display: "none"
      },
      ref: this.avatarUploadRef,
      accept: "image/*",
      onChange: this.onAvatarChanged
    }), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onChangeAvatar,
      className: "mx_CreateCommunityPrototypeDialog_avatarContainer"
    }, preview), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateCommunityPrototypeDialog_tip"
    }, /*#__PURE__*/_react.default.createElement("b", null, (0, _languageHandler._t)("Add image (optional)")), /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("An image will help people identify your community.")))))));
  }

}) || _class);
exports.default = CreateCommunityPrototypeDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQ3JlYXRlQ29tbXVuaXR5UHJvdG90eXBlRGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJDcmVhdGVDb21tdW5pdHlQcm90b3R5cGVEaWFsb2ciLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY3JlYXRlUmVmIiwiZXYiLCJsb2NhbHBhcnQiLCJ0YXJnZXQiLCJ2YWx1ZSIsInRvTG93ZXJDYXNlIiwicmVwbGFjZSIsInNldFN0YXRlIiwibmFtZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwic3RhdGUiLCJidXN5IiwiYXZhdGFyVXJsIiwiYXZhdGFyRmlsZSIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsInVwbG9hZENvbnRlbnQiLCJyZXN1bHQiLCJjcmVhdGVHcm91cCIsInByb2ZpbGUiLCJhdmF0YXJfdXJsIiwiZGlzIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJ0YWciLCJncm91cF9pZCIsIm9uRmluaXNoZWQiLCJyb29tX2lkIiwiR3JvdXBTdG9yZSIsInJlZnJlc2hHcm91cFJvb21zIiwiQWN0aW9uIiwiVmlld1Jvb20iLCJncm91cF9pc19uZXciLCJlIiwibG9nZ2VyIiwiZXJyb3IiLCJmaWxlcyIsImxlbmd0aCIsImZpbGUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwiYXZhdGFyUHJldmlldyIsInJlYWRBc0RhdGFVUkwiLCJhdmF0YXJVcGxvYWRSZWYiLCJjdXJyZW50IiwiY2xpY2siLCJyZW5kZXIiLCJjb21tdW5pdHlJZCIsImRvbWFpbiIsImdldEhvbWVzZXJ2ZXJOYW1lIiwiaGVscFRleHQiLCJjbGFzc2VzIiwicHJldmlldyIsIm9uU3VibWl0Iiwib25OYW1lQ2hhbmdlIiwiZGlzcGxheSIsIm9uQXZhdGFyQ2hhbmdlZCIsIm9uQ2hhbmdlQXZhdGFyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdC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S0MsY0FEbEI7QUFFSSxNQUFBLFNBQVMsRUFBQztBQUZkLE9BSU1MLE9BSk4sQ0FSSixlQWNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSSx3Q0FBSyx5QkFBRyxzQkFBSCxDQUFMLENBREosZUFFSSwyQ0FDTSx5QkFBRyxvREFBSCxDQUROLENBRkosQ0FkSixDQWpCSixDQURKLENBTEosQ0FESjtBQWlESDs7QUEzTDJGLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgQ2hhbmdlRXZlbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgQmFzZURpYWxvZyBmcm9tIFwiLi9CYXNlRGlhbG9nXCI7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCB7IElEaWFsb2dQcm9wcyB9IGZyb20gXCIuL0lEaWFsb2dQcm9wc1wiO1xuaW1wb3J0IEZpZWxkIGZyb20gXCIuLi9lbGVtZW50cy9GaWVsZFwiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gXCIuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWdcIjtcbmltcG9ydCBJbmZvVG9vbHRpcCBmcm9tIFwiLi4vZWxlbWVudHMvSW5mb1Rvb2x0aXBcIjtcbmltcG9ydCBkaXMgZnJvbSBcIi4uLy4uLy4uL2Rpc3BhdGNoZXIvZGlzcGF0Y2hlclwiO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zJztcbmltcG9ydCB7IHNob3dDb21tdW5pdHlSb29tSW52aXRlRGlhbG9nIH0gZnJvbSBcIi4uLy4uLy4uL1Jvb21JbnZpdGVcIjtcbmltcG9ydCBHcm91cFN0b3JlIGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvR3JvdXBTdG9yZVwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIGV4dGVuZHMgSURpYWxvZ1Byb3BzIHtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGxvY2FscGFydDogc3RyaW5nO1xuICAgIGVycm9yOiBzdHJpbmc7XG4gICAgYnVzeTogYm9vbGVhbjtcbiAgICBhdmF0YXJGaWxlOiBGaWxlO1xuICAgIGF2YXRhclByZXZpZXc6IHN0cmluZztcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuZGlhbG9ncy5DcmVhdGVDb21tdW5pdHlQcm90b3R5cGVEaWFsb2dcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENyZWF0ZUNvbW11bml0eVByb3RvdHlwZURpYWxvZyBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIGF2YXRhclVwbG9hZFJlZjogUmVhY3QuUmVmT2JqZWN0PEhUTUxJbnB1dEVsZW1lbnQ+ID0gUmVhY3QuY3JlYXRlUmVmKCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgbmFtZTogXCJcIixcbiAgICAgICAgICAgIGxvY2FscGFydDogXCJcIixcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgICBhdmF0YXJGaWxlOiBudWxsLFxuICAgICAgICAgICAgYXZhdGFyUHJldmlldzogbnVsbCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uTmFtZUNoYW5nZSA9IChldjogQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgY29uc3QgbG9jYWxwYXJ0ID0gKGV2LnRhcmdldC52YWx1ZSB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05LlxcLV9dL2csICctJyk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBuYW1lOiBldi50YXJnZXQudmFsdWUsIGxvY2FscGFydCB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblN1Ym1pdCA9IGFzeW5jIChldikgPT4ge1xuICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5idXN5KSByZXR1cm47XG5cbiAgICAgICAgLy8gV2UnbGwgY3JlYXRlIHRoZSBjb21tdW5pdHkgbm93IHRvIHNlZSBpZiBpdCdzIHRha2VuLCBsZWF2aW5nIGl0IGFjdGl2ZSBpblxuICAgICAgICAvLyB0aGUgYmFja2dyb3VuZCBmb3IgdGhlIHVzZXIgdG8gbG9vayBhdCB3aGlsZSB0aGV5IGludml0ZSBwZW9wbGUuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBidXN5OiB0cnVlIH0pO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IGF2YXRhclVybCA9ICcnOyAvLyBtdXN0IGJlIGEgc3RyaW5nIGZvciBzeW5hcHNlIHRvIGFjY2VwdCBpdFxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuYXZhdGFyRmlsZSkge1xuICAgICAgICAgICAgICAgIGF2YXRhclVybCA9IGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS51cGxvYWRDb250ZW50KHRoaXMuc3RhdGUuYXZhdGFyRmlsZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5jcmVhdGVHcm91cCh7XG4gICAgICAgICAgICAgICAgbG9jYWxwYXJ0OiB0aGlzLnN0YXRlLmxvY2FscGFydCxcbiAgICAgICAgICAgICAgICBwcm9maWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuc3RhdGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyX3VybDogYXZhdGFyVXJsLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gRW5zdXJlIHRoZSB0YWcgZ2V0cyBzZWxlY3RlZCBub3cgdGhhdCB3ZSd2ZSBjcmVhdGVkIGl0XG4gICAgICAgICAgICBkaXMuZGlzcGF0Y2goeyBhY3Rpb246ICdkZXNlbGVjdF90YWdzJyB9LCB0cnVlKTtcbiAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnc2VsZWN0X3RhZycsXG4gICAgICAgICAgICAgICAgdGFnOiByZXN1bHQuZ3JvdXBfaWQsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQ2xvc2Ugb3VyIG93biBkaWFsb2cgYmVmb3JlIG1vdmluZyBtdWNoIGZ1cnRoZXJcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25GaW5pc2hlZCh0cnVlKTtcblxuICAgICAgICAgICAgaWYgKHJlc3VsdC5yb29tX2lkKSB7XG4gICAgICAgICAgICAgICAgLy8gRm9yY2UgdGhlIGdyb3VwIHN0b3JlIHRvIHVwZGF0ZSBhcyBpdCBtaWdodCBoYXZlIG1pc3NlZCB0aGUgZ2VuZXJhbCBjaGF0XG4gICAgICAgICAgICAgICAgYXdhaXQgR3JvdXBTdG9yZS5yZWZyZXNoR3JvdXBSb29tcyhyZXN1bHQuZ3JvdXBfaWQpO1xuICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdSb29tLFxuICAgICAgICAgICAgICAgICAgICByb29tX2lkOiByZXN1bHQucm9vbV9pZCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzaG93Q29tbXVuaXR5Um9vbUludml0ZURpYWxvZyhyZXN1bHQucm9vbV9pZCwgdGhpcy5zdGF0ZS5uYW1lKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAndmlld19ncm91cCcsXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwX2lkOiByZXN1bHQuZ3JvdXBfaWQsXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwX2lzX25ldzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGUpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3I6IF90KFxuICAgICAgICAgICAgICAgICAgICBcIlRoZXJlIHdhcyBhbiBlcnJvciBjcmVhdGluZyB5b3VyIGNvbW11bml0eS4gVGhlIG5hbWUgbWF5IGJlIHRha2VuIG9yIHRoZSBcIiArXG4gICAgICAgICAgICAgICAgICAgIFwic2VydmVyIGlzIHVuYWJsZSB0byBwcm9jZXNzIHlvdXIgcmVxdWVzdC5cIixcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkF2YXRhckNoYW5nZWQgPSAoZTogQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgaWYgKCFlLnRhcmdldC5maWxlcyB8fCAhZS50YXJnZXQuZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgYXZhdGFyRmlsZTogbnVsbCB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBidXN5OiB0cnVlIH0pO1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdO1xuICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXY6IFByb2dyZXNzRXZlbnQ8RmlsZVJlYWRlcj4pID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgYXZhdGFyRmlsZTogZmlsZSwgYnVzeTogZmFsc2UsIGF2YXRhclByZXZpZXc6IGV2LnRhcmdldC5yZXN1bHQgYXMgc3RyaW5nIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25DaGFuZ2VBdmF0YXIgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmF2YXRhclVwbG9hZFJlZi5jdXJyZW50KSB0aGlzLmF2YXRhclVwbG9hZFJlZi5jdXJyZW50LmNsaWNrKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG4gICAgICAgIGxldCBjb21tdW5pdHlJZCA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmxvY2FscGFydCkge1xuICAgICAgICAgICAgY29tbXVuaXR5SWQgPSAoXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfQ3JlYXRlQ29tbXVuaXR5UHJvdG90eXBlRGlhbG9nX2NvbW11bml0eUlkXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJDb21tdW5pdHkgSUQ6ICs8bG9jYWxwYXJ0IC8+OiUoZG9tYWluKXNcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluOiBNYXRyaXhDbGllbnRQZWcuZ2V0SG9tZXNlcnZlck5hbWUoKSxcbiAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxwYXJ0OiAoKSA9PiA8dT57IHRoaXMuc3RhdGUubG9jYWxwYXJ0IH08L3U+LFxuICAgICAgICAgICAgICAgICAgICB9KSB9XG4gICAgICAgICAgICAgICAgICAgIDxJbmZvVG9vbHRpcFxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcD17X3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJVc2UgdGhpcyB3aGVuIHJlZmVyZW5jaW5nIHlvdXIgY29tbXVuaXR5IHRvIG90aGVycy4gVGhlIGNvbW11bml0eSBJRCBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjYW5ub3QgYmUgY2hhbmdlZC5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWxwVGV4dCA9IChcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X0NyZWF0ZUNvbW11bml0eVByb3RvdHlwZURpYWxvZ19zdWJ0ZXh0XCI+XG4gICAgICAgICAgICAgICAgeyBfdChcIllvdSBjYW4gY2hhbmdlIHRoaXMgbGF0ZXIgaWYgbmVlZGVkLlwiKSB9XG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBjbGFzc2VzID0gXCJteF9DcmVhdGVDb21tdW5pdHlQcm90b3R5cGVEaWFsb2dfc3VidGV4dCBteF9DcmVhdGVDb21tdW5pdHlQcm90b3R5cGVEaWFsb2dfc3VidGV4dF9lcnJvclwiO1xuICAgICAgICAgICAgaGVscFRleHQgPSAoXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtjbGFzc2VzfT5cbiAgICAgICAgICAgICAgICAgICAgeyB0aGlzLnN0YXRlLmVycm9yIH1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHByZXZpZXcgPSA8aW1nIHNyYz17dGhpcy5zdGF0ZS5hdmF0YXJQcmV2aWV3fSBjbGFzc05hbWU9XCJteF9DcmVhdGVDb21tdW5pdHlQcm90b3R5cGVEaWFsb2dfYXZhdGFyXCIgLz47XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5hdmF0YXJQcmV2aWV3KSB7XG4gICAgICAgICAgICBwcmV2aWV3ID0gPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVDb21tdW5pdHlQcm90b3R5cGVEaWFsb2dfcGxhY2Vob2xkZXJBdmF0YXJcIiAvPjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZ1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0NyZWF0ZUNvbW11bml0eVByb3RvdHlwZURpYWxvZ1wiXG4gICAgICAgICAgICAgICAgb25GaW5pc2hlZD17dGhpcy5wcm9wcy5vbkZpbmlzaGVkfVxuICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcIldoYXQncyB0aGUgbmFtZSBvZiB5b3VyIGNvbW11bml0eSBvciB0ZWFtP1wiKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17dGhpcy5vblN1Ym1pdH0+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRGlhbG9nX2NvbnRlbnRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlQ29tbXVuaXR5UHJvdG90eXBlRGlhbG9nX2NvbE5hbWVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUubmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25OYW1lQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj17X3QoXCJFbnRlciBuYW1lXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJFbnRlciBuYW1lXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBoZWxwVGV4dCB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfQ3JlYXRlQ29tbXVuaXR5UHJvdG90eXBlRGlhbG9nX3N1YnRleHRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAvKm5ic3AgaXMgdG8gcmVzZXJ2ZSB0aGUgaGVpZ2h0IG9mIHRoaXMgZWxlbWVudCB3aGVuIHRoZXJlJ3Mgbm90aGluZyovIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7eyBjb21tdW5pdHlJZCB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGtpbmQ9XCJwcmltYXJ5XCIgb25DbGljaz17dGhpcy5vblN1Ym1pdH0gZGlzYWJsZWQ9e3RoaXMuc3RhdGUuYnVzeX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJDcmVhdGVcIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVDb21tdW5pdHlQcm90b3R5cGVEaWFsb2dfY29sQXZhdGFyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJmaWxlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgZGlzcGxheTogXCJub25lXCIgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmPXt0aGlzLmF2YXRhclVwbG9hZFJlZn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0PVwiaW1hZ2UvKlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uQXZhdGFyQ2hhbmdlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25DaGFuZ2VBdmF0YXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0NyZWF0ZUNvbW11bml0eVByb3RvdHlwZURpYWxvZ19hdmF0YXJDb250YWluZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBwcmV2aWV3IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVDb21tdW5pdHlQcm90b3R5cGVEaWFsb2dfdGlwXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxiPnsgX3QoXCJBZGQgaW1hZ2UgKG9wdGlvbmFsKVwiKSB9PC9iPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJBbiBpbWFnZSB3aWxsIGhlbHAgcGVvcGxlIGlkZW50aWZ5IHlvdXIgY29tbXVuaXR5LlwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgICAgICA8L0Jhc2VEaWFsb2c+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19