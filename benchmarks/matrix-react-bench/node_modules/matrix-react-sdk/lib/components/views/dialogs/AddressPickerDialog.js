"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _utils = require("matrix-js-sdk/src/utils");

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _UserAddress = require("../../../UserAddress");

var _GroupStore = _interopRequireDefault(require("../../../stores/GroupStore"));

var Email = _interopRequireWildcard(require("../../../email"));

var _IdentityAuthClient = _interopRequireDefault(require("../../../IdentityAuthClient"));

var _IdentityServerUtils = require("../../../utils/IdentityServerUtils");

var _UrlUtils = require("../../../utils/UrlUtils");

var _Keyboard = require("../../../Keyboard");

var _actions = require("../../../dispatcher/actions");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _AddressSelector = _interopRequireDefault(require("../elements/AddressSelector"));

var _AddressTile = _interopRequireDefault(require("../elements/AddressTile"));

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _DialogButtons = _interopRequireDefault(require("../elements/DialogButtons"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const TRUNCATE_QUERY_LIST = 40;
const QUERY_USER_DIRECTORY_DEBOUNCE_MS = 200;
const addressTypeName = {
  'mx-user-id': (0, _languageHandler._td)("Matrix ID"),
  'mx-room-id': (0, _languageHandler._td)("Matrix Room ID"),
  'email': (0, _languageHandler._td)("email address")
};
let AddressPickerDialog = (_dec = (0, _replaceableComponent.replaceableComponent)("views.dialogs.AddressPickerDialog"), _dec(_class = (_temp = _class2 = class AddressPickerDialog extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "textinput", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "addressSelector", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "queryChangedDebouncer", void 0);
    (0, _defineProperty2.default)(this, "cancelThreepidLookup", void 0);
    (0, _defineProperty2.default)(this, "onButtonClick", () => {
      let selectedList = this.state.selectedList.slice(); // Check the text input field to see if user has an unconverted address
      // If there is and it's valid add it to the local selectedList

      if (this.textinput.current.value !== '') {
        selectedList = this.addAddressesToList([this.textinput.current.value]);
        if (selectedList === null) return;
      }

      this.props.onFinished(true, selectedList);
    });
    (0, _defineProperty2.default)(this, "onCancel", () => {
      this.props.onFinished(false);
    });
    (0, _defineProperty2.default)(this, "onKeyDown", e => {
      const textInput = this.textinput.current ? this.textinput.current.value : undefined;

      if (e.key === _Keyboard.Key.ESCAPE) {
        e.stopPropagation();
        e.preventDefault();
        this.props.onFinished(false);
      } else if (e.key === _Keyboard.Key.ARROW_UP) {
        e.stopPropagation();
        e.preventDefault();
        if (this.addressSelector.current) this.addressSelector.current.moveSelectionUp();
      } else if (e.key === _Keyboard.Key.ARROW_DOWN) {
        e.stopPropagation();
        e.preventDefault();
        if (this.addressSelector.current) this.addressSelector.current.moveSelectionDown();
      } else if (this.state.suggestedList.length > 0 && [_Keyboard.Key.COMMA, _Keyboard.Key.ENTER, _Keyboard.Key.TAB].includes(e.key)) {
        e.stopPropagation();
        e.preventDefault();
        if (this.addressSelector.current) this.addressSelector.current.chooseSelection();
      } else if (textInput.length === 0 && this.state.selectedList.length && e.key === _Keyboard.Key.BACKSPACE) {
        e.stopPropagation();
        e.preventDefault();
        this.onDismissed(this.state.selectedList.length - 1)();
      } else if (e.key === _Keyboard.Key.ENTER) {
        e.stopPropagation();
        e.preventDefault();

        if (textInput === '') {
          // if there's nothing in the input box, submit the form
          this.onButtonClick();
        } else {
          this.addAddressesToList([textInput]);
        }
      } else if (textInput && (e.key === _Keyboard.Key.COMMA || e.key === _Keyboard.Key.TAB)) {
        e.stopPropagation();
        e.preventDefault();
        this.addAddressesToList([textInput]);
      }
    });
    (0, _defineProperty2.default)(this, "onQueryChanged", ev => {
      const query = ev.target.value;

      if (this.queryChangedDebouncer) {
        clearTimeout(this.queryChangedDebouncer);
      } // Only do search if there is something to search


      if (query.length > 0 && query !== '@' && query.length >= 2) {
        this.queryChangedDebouncer = setTimeout(() => {
          if (this.props.pickerType === 'user') {
            if (this.props.groupId) {
              this.doNaiveGroupSearch(query);
            } else if (this.state.serverSupportsUserDirectory) {
              this.doUserDirectorySearch(query);
            } else {
              this.doLocalSearch(query);
            }
          } else if (this.props.pickerType === 'room') {
            if (this.props.groupId) {
              this.doNaiveGroupRoomSearch(query);
            } else {
              this.doRoomSearch(query);
            }
          } else {
            _logger.logger.error('Unknown pickerType', this.props.pickerType);
          }
        }, QUERY_USER_DIRECTORY_DEBOUNCE_MS);
      } else {
        this.setState({
          suggestedList: [],
          query: "",
          searchError: null
        });
      }
    });
    (0, _defineProperty2.default)(this, "onDismissed", index => () => {
      const selectedList = this.state.selectedList.slice();
      selectedList.splice(index, 1);
      this.setState({
        selectedList,
        suggestedList: [],
        query: ""
      });
      if (this.cancelThreepidLookup) this.cancelThreepidLookup();
    });
    (0, _defineProperty2.default)(this, "onSelected", index => {
      const selectedList = this.state.selectedList.slice();
      selectedList.push(this.getFilteredSuggestions()[index]);
      this.setState({
        selectedList,
        suggestedList: [],
        query: ""
      });
      if (this.cancelThreepidLookup) this.cancelThreepidLookup();
    });
    (0, _defineProperty2.default)(this, "onPaste", e => {
      // Prevent the text being pasted into the textarea
      e.preventDefault();
      const text = e.clipboardData.getData("text"); // Process it as a list of addresses to add instead

      this.addAddressesToList(text.split(/[\s,]+/));
    });
    (0, _defineProperty2.default)(this, "onUseDefaultIdentityServerClick", e => {
      e.preventDefault(); // Update the IS in account data. Actually using it may trigger terms.
      // eslint-disable-next-line react-hooks/rules-of-hooks

      (0, _IdentityServerUtils.useDefaultIdentityServer)(); // Add email as a valid address type.

      const {
        validAddressTypes
      } = this.state;
      validAddressTypes.push(_UserAddress.AddressType.Email);
      this.setState({
        validAddressTypes
      });
    });
    (0, _defineProperty2.default)(this, "onManageSettingsClick", e => {
      e.preventDefault();

      _dispatcher.default.fire(_actions.Action.ViewUserSettings);

      this.onCancel();
    });
    let _validAddressTypes = this.props.validAddressTypes; // Remove email from validAddressTypes if no IS is configured. It may be added at a later stage by the user

    if (!_MatrixClientPeg.MatrixClientPeg.get().getIdentityServerUrl() && _validAddressTypes.includes(_UserAddress.AddressType.Email)) {
      _validAddressTypes = _validAddressTypes.filter(type => type !== _UserAddress.AddressType.Email);
    }

    this.state = {
      invalidAddressError: false,
      selectedList: [],
      busy: false,
      searchError: null,
      serverSupportsUserDirectory: true,
      query: "",
      suggestedList: [],
      validAddressTypes: _validAddressTypes
    };
  }

  componentDidMount() {
    if (this.props.focus) {
      // Set the cursor at the end of the text input
      this.textinput.current.value = this.props.value;
    }
  }

  getPlaceholder() {
    const {
      placeholder
    } = this.props;

    if (typeof placeholder === "string") {
      return placeholder;
    } // Otherwise it's a function, as checked by prop types.


    return placeholder(this.state.validAddressTypes);
  }

  doNaiveGroupSearch(query) {
    const lowerCaseQuery = query.toLowerCase();
    this.setState({
      busy: true,
      query,
      searchError: null
    });

    _MatrixClientPeg.MatrixClientPeg.get().getGroupUsers(this.props.groupId).then(resp => {
      const results = [];
      resp.chunk.forEach(u => {
        const userIdMatch = u.user_id.toLowerCase().includes(lowerCaseQuery);
        const displayNameMatch = (u.displayname || '').toLowerCase().includes(lowerCaseQuery);

        if (!(userIdMatch || displayNameMatch)) {
          return;
        }

        results.push({
          user_id: u.user_id,
          avatar_url: u.avatar_url,
          display_name: u.displayname
        });
      });
      this.processResults(results, query);
    }).catch(err => {
      _logger.logger.error('Error whilst searching group rooms: ', err);

      this.setState({
        searchError: err.errcode ? err.message : (0, _languageHandler._t)('Something went wrong!')
      });
    }).then(() => {
      this.setState({
        busy: false
      });
    });
  }

  doNaiveGroupRoomSearch(query) {
    const lowerCaseQuery = query.toLowerCase();
    const results = [];

    _GroupStore.default.getGroupRooms(this.props.groupId).forEach(r => {
      const nameMatch = (r.name || '').toLowerCase().includes(lowerCaseQuery);
      const topicMatch = (r.topic || '').toLowerCase().includes(lowerCaseQuery);
      const aliasMatch = (r.canonical_alias || '').toLowerCase().includes(lowerCaseQuery);

      if (!(nameMatch || topicMatch || aliasMatch)) {
        return;
      }

      results.push({
        room_id: r.room_id,
        avatar_url: r.avatar_url,
        name: r.name || r.canonical_alias
      });
    });

    this.processResults(results, query);
    this.setState({
      busy: false
    });
  }

  doRoomSearch(query) {
    const lowerCaseQuery = query.toLowerCase();

    const rooms = _MatrixClientPeg.MatrixClientPeg.get().getRooms();

    const results = [];
    rooms.forEach(room => {
      let rank = Infinity;
      const nameEvent = room.currentState.getStateEvents('m.room.name', '');
      const name = nameEvent ? nameEvent.getContent().name : '';
      const canonicalAlias = room.getCanonicalAlias();
      const aliasEvents = room.currentState.getStateEvents('m.room.aliases');
      const aliases = aliasEvents.map(ev => ev.getContent().aliases).reduce((a, b) => {
        return a.concat(b);
      }, []);
      const nameMatch = (name || '').toLowerCase().includes(lowerCaseQuery);
      let aliasMatch = false;
      let shortestMatchingAliasLength = Infinity;
      aliases.forEach(alias => {
        if ((alias || '').toLowerCase().includes(lowerCaseQuery)) {
          aliasMatch = true;

          if (shortestMatchingAliasLength > alias.length) {
            shortestMatchingAliasLength = alias.length;
          }
        }
      });

      if (!(nameMatch || aliasMatch)) {
        return;
      }

      if (aliasMatch) {
        // A shorter matching alias will give a better rank
        rank = shortestMatchingAliasLength;
      }

      const avatarEvent = room.currentState.getStateEvents('m.room.avatar', '');
      const avatarUrl = avatarEvent ? avatarEvent.getContent().url : undefined;
      results.push({
        rank,
        room_id: room.roomId,
        avatar_url: avatarUrl,
        name: name || canonicalAlias || aliases[0] || (0, _languageHandler._t)('Unnamed Room')
      });
    }); // Sort by rank ascending (a high rank being less relevant)

    const sortedResults = results.sort((a, b) => {
      return a.rank - b.rank;
    });
    this.processResults(sortedResults, query);
    this.setState({
      busy: false
    });
  }

  doUserDirectorySearch(query) {
    this.setState({
      busy: true,
      query,
      searchError: null
    });

    _MatrixClientPeg.MatrixClientPeg.get().searchUserDirectory({
      term: query
    }).then(resp => {
      // The query might have changed since we sent the request, so ignore
      // responses for anything other than the latest query.
      if (this.state.query !== query) {
        return;
      }

      this.processResults(resp.results, query);
    }).catch(err => {
      _logger.logger.error('Error whilst searching user directory: ', err);

      this.setState({
        searchError: err.errcode ? err.message : (0, _languageHandler._t)('Something went wrong!')
      });

      if (err.errcode === 'M_UNRECOGNIZED') {
        this.setState({
          serverSupportsUserDirectory: false
        }); // Do a local search immediately

        this.doLocalSearch(query);
      }
    }).then(() => {
      this.setState({
        busy: false
      });
    });
  }

  doLocalSearch(query) {
    this.setState({
      query,
      searchError: null
    });
    const queryLowercase = query.toLowerCase();
    const results = [];

    _MatrixClientPeg.MatrixClientPeg.get().getUsers().forEach(user => {
      if (user.userId.toLowerCase().indexOf(queryLowercase) === -1 && user.displayName.toLowerCase().indexOf(queryLowercase) === -1) {
        return;
      } // Put results in the format of the new API


      results.push({
        user_id: user.userId,
        display_name: user.displayName,
        avatar_url: user.avatarUrl
      });
    });

    this.processResults(results, query);
  }

  processResults(results, query) {
    const suggestedList = [];
    results.forEach(result => {
      if (result.room_id) {
        const client = _MatrixClientPeg.MatrixClientPeg.get();

        const room = client.getRoom(result.room_id);

        if (room) {
          const tombstone = room.currentState.getStateEvents('m.room.tombstone', '');

          if (tombstone && tombstone.getContent() && tombstone.getContent()["replacement_room"]) {
            const replacementRoom = client.getRoom(tombstone.getContent()["replacement_room"]); // Skip rooms with tombstones where we are also aware of the replacement room.

            if (replacementRoom) return;
          }
        }

        suggestedList.push({
          addressType: 'mx-room-id',
          address: result.room_id,
          displayName: result.name,
          avatarMxc: result.avatar_url,
          isKnown: true
        });
        return;
      }

      if (!this.props.includeSelf && result.user_id === _MatrixClientPeg.MatrixClientPeg.get().credentials.userId) {
        return;
      } // Return objects, structure of which is defined
      // by UserAddressType


      suggestedList.push({
        addressType: 'mx-user-id',
        address: result.user_id,
        displayName: result.display_name,
        avatarMxc: result.avatar_url,
        isKnown: true
      });
    }); // If the query is a valid address, add an entry for that
    // This is important, otherwise there's no way to invite
    // a perfectly valid address if there are close matches.

    const addrType = (0, _UserAddress.getAddressType)(query);

    if (this.state.validAddressTypes.includes(addrType)) {
      if (addrType === 'email' && !Email.looksValid(query)) {
        this.setState({
          searchError: (0, _languageHandler._t)("That doesn't look like a valid email address")
        });
        return;
      }

      suggestedList.unshift({
        addressType: addrType,
        address: query,
        isKnown: false
      });
      if (this.cancelThreepidLookup) this.cancelThreepidLookup();

      if (addrType === 'email') {
        this.lookupThreepid(addrType, query);
      }
    }

    this.setState({
      suggestedList,
      invalidAddressError: false
    }, () => {
      if (this.addressSelector.current) this.addressSelector.current.moveSelectionTop();
    });
  }

  addAddressesToList(addressTexts) {
    const selectedList = this.state.selectedList.slice();
    let hasError = false;
    addressTexts.forEach(addressText => {
      addressText = addressText.trim();
      const addrType = (0, _UserAddress.getAddressType)(addressText);
      const addrObj = {
        addressType: addrType,
        address: addressText,
        isKnown: false
      };

      if (!this.state.validAddressTypes.includes(addrType)) {
        hasError = true;
      } else if (addrType === 'mx-user-id') {
        const user = _MatrixClientPeg.MatrixClientPeg.get().getUser(addrObj.address);

        if (user) {
          addrObj.displayName = user.displayName;
          addrObj.avatarMxc = user.avatarUrl;
          addrObj.isKnown = true;
        }
      } else if (addrType === 'mx-room-id') {
        const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(addrObj.address);

        if (room) {
          addrObj.displayName = room.name;
          addrObj.isKnown = true;
        }
      }

      selectedList.push(addrObj);
    });
    this.setState({
      selectedList,
      suggestedList: [],
      query: "",
      invalidAddressError: hasError ? true : this.state.invalidAddressError
    });
    if (this.cancelThreepidLookup) this.cancelThreepidLookup();
    return hasError ? null : selectedList;
  }

  async lookupThreepid(medium, address) {
    let cancelled = false; // Note that we can't safely remove this after we're done
    // because we don't know that it's the same one, so we just
    // leave it: it's replacing the old one each time so it's
    // not like they leak.

    this.cancelThreepidLookup = function () {
      cancelled = true;
    }; // wait a bit to let the user finish typing


    await (0, _utils.sleep)(500);
    if (cancelled) return null;

    try {
      const authClient = new _IdentityAuthClient.default();
      const identityAccessToken = await authClient.getAccessToken();
      if (cancelled) return null;
      const lookup = await _MatrixClientPeg.MatrixClientPeg.get().lookupThreePid(medium, address, undefined
      /* callback */
      , identityAccessToken);
      if (cancelled || lookup === null || !lookup.mxid) return null;
      const profile = await _MatrixClientPeg.MatrixClientPeg.get().getProfileInfo(lookup.mxid);
      if (cancelled || profile === null) return null;
      this.setState({
        suggestedList: [{
          // a UserAddressType
          addressType: medium,
          address: address,
          displayName: profile.displayname,
          avatarMxc: profile.avatar_url,
          isKnown: true
        }]
      });
    } catch (e) {
      _logger.logger.error(e);

      this.setState({
        searchError: (0, _languageHandler._t)('Something went wrong!')
      });
    }
  }

  getFilteredSuggestions() {
    // map addressType => set of addresses to avoid O(n*m) operation
    const selectedAddresses = {};
    this.state.selectedList.forEach(({
      address,
      addressType
    }) => {
      if (!selectedAddresses[addressType]) selectedAddresses[addressType] = new Set();
      selectedAddresses[addressType].add(address);
    }); // Filter out any addresses in the above already selected addresses (matching both type and address)

    return this.state.suggestedList.filter(({
      address,
      addressType
    }) => {
      return !(selectedAddresses[addressType] && selectedAddresses[addressType].has(address));
    });
  }

  render() {
    let inputLabel;

    if (this.props.description) {
      inputLabel = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_AddressPickerDialog_label"
      }, /*#__PURE__*/_react.default.createElement("label", {
        htmlFor: "textinput"
      }, this.props.description));
    }

    const query = []; // create the invite list

    if (this.state.selectedList.length > 0) {
      for (let i = 0; i < this.state.selectedList.length; i++) {
        query.push( /*#__PURE__*/_react.default.createElement(_AddressTile.default, {
          key: i,
          address: this.state.selectedList[i],
          canDismiss: true,
          onDismissed: this.onDismissed(i),
          showAddress: this.props.pickerType === 'user'
        }));
      }
    } // Add the query at the end


    query.push( /*#__PURE__*/_react.default.createElement("textarea", {
      key: this.state.selectedList.length,
      onPaste: this.onPaste,
      rows: 1,
      id: "textinput",
      ref: this.textinput,
      className: "mx_AddressPickerDialog_input",
      onChange: this.onQueryChanged,
      placeholder: this.getPlaceholder(),
      defaultValue: this.props.value,
      autoFocus: this.props.focus
    }));
    const filteredSuggestedList = this.getFilteredSuggestions();
    let error;
    let addressSelector;

    if (this.state.invalidAddressError) {
      const validTypeDescriptions = this.state.validAddressTypes.map(t => (0, _languageHandler._t)(addressTypeName[t]));
      error = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_AddressPickerDialog_error"
      }, (0, _languageHandler._t)("You have entered an invalid address."), /*#__PURE__*/_react.default.createElement("br", null), (0, _languageHandler._t)("Try using one of the following valid address types: %(validTypesList)s.", {
        validTypesList: validTypeDescriptions.join(", ")
      }));
    } else if (this.state.searchError) {
      error = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_AddressPickerDialog_error"
      }, this.state.searchError);
    } else if (this.state.query.length > 0 && filteredSuggestedList.length === 0 && !this.state.busy) {
      error = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_AddressPickerDialog_error"
      }, (0, _languageHandler._t)("No results"));
    } else {
      addressSelector = /*#__PURE__*/_react.default.createElement(_AddressSelector.default, {
        ref: this.addressSelector,
        addressList: filteredSuggestedList,
        showAddress: this.props.pickerType === 'user',
        onSelected: this.onSelected,
        truncateAt: TRUNCATE_QUERY_LIST
      });
    }

    let identityServer; // If picker cannot currently accept e-mail but should be able to

    if (this.props.pickerType === 'user' && !this.state.validAddressTypes.includes(_UserAddress.AddressType.Email) && this.props.validAddressTypes.includes(_UserAddress.AddressType.Email)) {
      const defaultIdentityServerUrl = (0, _IdentityServerUtils.getDefaultIdentityServerUrl)();

      if (defaultIdentityServerUrl) {
        identityServer = /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_AddressPickerDialog_identityServer"
        }, (0, _languageHandler._t)("Use an identity server to invite by email. " + "<default>Use the default (%(defaultIdentityServerName)s)</default> " + "or manage in <settings>Settings</settings>.", {
          defaultIdentityServerName: (0, _UrlUtils.abbreviateUrl)(defaultIdentityServerUrl)
        }, {
          default: sub => /*#__PURE__*/_react.default.createElement("a", {
            href: "#",
            onClick: this.onUseDefaultIdentityServerClick
          }, sub),
          settings: sub => /*#__PURE__*/_react.default.createElement("a", {
            href: "#",
            onClick: this.onManageSettingsClick
          }, sub)
        }));
      } else {
        identityServer = /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_AddressPickerDialog_identityServer"
        }, (0, _languageHandler._t)("Use an identity server to invite by email. " + "Manage in <settings>Settings</settings>.", {}, {
          settings: sub => /*#__PURE__*/_react.default.createElement("a", {
            href: "#",
            onClick: this.onManageSettingsClick
          }, sub)
        }));
      }
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_AddressPickerDialog",
      onKeyDown: this.onKeyDown,
      onFinished: this.props.onFinished,
      title: this.props.title
    }, inputLabel, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Dialog_content"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AddressPickerDialog_inputContainer"
    }, query), error, addressSelector, this.props.extraNode, identityServer), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: this.props.button,
      onPrimaryButtonClick: this.onButtonClick,
      onCancel: this.onCancel
    }));
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  value: "",
  focus: true,
  validAddressTypes: _UserAddress.addressTypes,
  pickerType: 'user',
  includeSelf: false
}), _temp)) || _class);
exports.default = AddressPickerDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQWRkcmVzc1BpY2tlckRpYWxvZy50c3giXSwibmFtZXMiOlsiVFJVTkNBVEVfUVVFUllfTElTVCIsIlFVRVJZX1VTRVJfRElSRUNUT1JZX0RFQk9VTkNFX01TIiwiYWRkcmVzc1R5cGVOYW1lIiwiQWRkcmVzc1BpY2tlckRpYWxvZyIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInNlbGVjdGVkTGlzdCIsInN0YXRlIiwic2xpY2UiLCJ0ZXh0aW5wdXQiLCJjdXJyZW50IiwidmFsdWUiLCJhZGRBZGRyZXNzZXNUb0xpc3QiLCJvbkZpbmlzaGVkIiwiZSIsInRleHRJbnB1dCIsInVuZGVmaW5lZCIsImtleSIsIktleSIsIkVTQ0FQRSIsInN0b3BQcm9wYWdhdGlvbiIsInByZXZlbnREZWZhdWx0IiwiQVJST1dfVVAiLCJhZGRyZXNzU2VsZWN0b3IiLCJtb3ZlU2VsZWN0aW9uVXAiLCJBUlJPV19ET1dOIiwibW92ZVNlbGVjdGlvbkRvd24iLCJzdWdnZXN0ZWRMaXN0IiwibGVuZ3RoIiwiQ09NTUEiLCJFTlRFUiIsIlRBQiIsImluY2x1ZGVzIiwiY2hvb3NlU2VsZWN0aW9uIiwiQkFDS1NQQUNFIiwib25EaXNtaXNzZWQiLCJvbkJ1dHRvbkNsaWNrIiwiZXYiLCJxdWVyeSIsInRhcmdldCIsInF1ZXJ5Q2hhbmdlZERlYm91bmNlciIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJwaWNrZXJUeXBlIiwiZ3JvdXBJZCIsImRvTmFpdmVHcm91cFNlYXJjaCIsInNlcnZlclN1cHBvcnRzVXNlckRpcmVjdG9yeSIsImRvVXNlckRpcmVjdG9yeVNlYXJjaCIsImRvTG9jYWxTZWFyY2giLCJkb05haXZlR3JvdXBSb29tU2VhcmNoIiwiZG9Sb29tU2VhcmNoIiwibG9nZ2VyIiwiZXJyb3IiLCJzZXRTdGF0ZSIsInNlYXJjaEVycm9yIiwiaW5kZXgiLCJzcGxpY2UiLCJjYW5jZWxUaHJlZXBpZExvb2t1cCIsInB1c2giLCJnZXRGaWx0ZXJlZFN1Z2dlc3Rpb25zIiwidGV4dCIsImNsaXBib2FyZERhdGEiLCJnZXREYXRhIiwic3BsaXQiLCJ2YWxpZEFkZHJlc3NUeXBlcyIsIkFkZHJlc3NUeXBlIiwiRW1haWwiLCJkaXMiLCJmaXJlIiwiQWN0aW9uIiwiVmlld1VzZXJTZXR0aW5ncyIsIm9uQ2FuY2VsIiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0IiwiZ2V0SWRlbnRpdHlTZXJ2ZXJVcmwiLCJmaWx0ZXIiLCJ0eXBlIiwiaW52YWxpZEFkZHJlc3NFcnJvciIsImJ1c3kiLCJjb21wb25lbnREaWRNb3VudCIsImZvY3VzIiwiZ2V0UGxhY2Vob2xkZXIiLCJwbGFjZWhvbGRlciIsImxvd2VyQ2FzZVF1ZXJ5IiwidG9Mb3dlckNhc2UiLCJnZXRHcm91cFVzZXJzIiwidGhlbiIsInJlc3AiLCJyZXN1bHRzIiwiY2h1bmsiLCJmb3JFYWNoIiwidSIsInVzZXJJZE1hdGNoIiwidXNlcl9pZCIsImRpc3BsYXlOYW1lTWF0Y2giLCJkaXNwbGF5bmFtZSIsImF2YXRhcl91cmwiLCJkaXNwbGF5X25hbWUiLCJwcm9jZXNzUmVzdWx0cyIsImNhdGNoIiwiZXJyIiwiZXJyY29kZSIsIm1lc3NhZ2UiLCJHcm91cFN0b3JlIiwiZ2V0R3JvdXBSb29tcyIsInIiLCJuYW1lTWF0Y2giLCJuYW1lIiwidG9waWNNYXRjaCIsInRvcGljIiwiYWxpYXNNYXRjaCIsImNhbm9uaWNhbF9hbGlhcyIsInJvb21faWQiLCJyb29tcyIsImdldFJvb21zIiwicm9vbSIsInJhbmsiLCJJbmZpbml0eSIsIm5hbWVFdmVudCIsImN1cnJlbnRTdGF0ZSIsImdldFN0YXRlRXZlbnRzIiwiZ2V0Q29udGVudCIsImNhbm9uaWNhbEFsaWFzIiwiZ2V0Q2Fub25pY2FsQWxpYXMiLCJhbGlhc0V2ZW50cyIsImFsaWFzZXMiLCJtYXAiLCJyZWR1Y2UiLCJhIiwiYiIsImNvbmNhdCIsInNob3J0ZXN0TWF0Y2hpbmdBbGlhc0xlbmd0aCIsImFsaWFzIiwiYXZhdGFyRXZlbnQiLCJhdmF0YXJVcmwiLCJ1cmwiLCJyb29tSWQiLCJzb3J0ZWRSZXN1bHRzIiwic29ydCIsInNlYXJjaFVzZXJEaXJlY3RvcnkiLCJ0ZXJtIiwicXVlcnlMb3dlcmNhc2UiLCJnZXRVc2VycyIsInVzZXIiLCJ1c2VySWQiLCJpbmRleE9mIiwiZGlzcGxheU5hbWUiLCJyZXN1bHQiLCJjbGllbnQiLCJnZXRSb29tIiwidG9tYnN0b25lIiwicmVwbGFjZW1lbnRSb29tIiwiYWRkcmVzc1R5cGUiLCJhZGRyZXNzIiwiYXZhdGFyTXhjIiwiaXNLbm93biIsImluY2x1ZGVTZWxmIiwiY3JlZGVudGlhbHMiLCJhZGRyVHlwZSIsImxvb2tzVmFsaWQiLCJ1bnNoaWZ0IiwibG9va3VwVGhyZWVwaWQiLCJtb3ZlU2VsZWN0aW9uVG9wIiwiYWRkcmVzc1RleHRzIiwiaGFzRXJyb3IiLCJhZGRyZXNzVGV4dCIsInRyaW0iLCJhZGRyT2JqIiwiZ2V0VXNlciIsIm1lZGl1bSIsImNhbmNlbGxlZCIsImF1dGhDbGllbnQiLCJJZGVudGl0eUF1dGhDbGllbnQiLCJpZGVudGl0eUFjY2Vzc1Rva2VuIiwiZ2V0QWNjZXNzVG9rZW4iLCJsb29rdXAiLCJsb29rdXBUaHJlZVBpZCIsIm14aWQiLCJwcm9maWxlIiwiZ2V0UHJvZmlsZUluZm8iLCJzZWxlY3RlZEFkZHJlc3NlcyIsIlNldCIsImFkZCIsImhhcyIsInJlbmRlciIsImlucHV0TGFiZWwiLCJkZXNjcmlwdGlvbiIsImkiLCJvblBhc3RlIiwib25RdWVyeUNoYW5nZWQiLCJmaWx0ZXJlZFN1Z2dlc3RlZExpc3QiLCJ2YWxpZFR5cGVEZXNjcmlwdGlvbnMiLCJ0IiwidmFsaWRUeXBlc0xpc3QiLCJqb2luIiwib25TZWxlY3RlZCIsImlkZW50aXR5U2VydmVyIiwiZGVmYXVsdElkZW50aXR5U2VydmVyVXJsIiwiZGVmYXVsdElkZW50aXR5U2VydmVyTmFtZSIsImRlZmF1bHQiLCJzdWIiLCJvblVzZURlZmF1bHRJZGVudGl0eVNlcnZlckNsaWNrIiwic2V0dGluZ3MiLCJvbk1hbmFnZVNldHRpbmdzQ2xpY2siLCJvbktleURvd24iLCJ0aXRsZSIsImV4dHJhTm9kZSIsImJ1dHRvbiIsImFkZHJlc3NUeXBlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFtQkE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7Ozs7O0FBRUEsTUFBTUEsbUJBQW1CLEdBQUcsRUFBNUI7QUFDQSxNQUFNQyxnQ0FBZ0MsR0FBRyxHQUF6QztBQUVBLE1BQU1DLGVBQWUsR0FBRztBQUNwQixnQkFBYywwQkFBSSxXQUFKLENBRE07QUFFcEIsZ0JBQWMsMEJBQUksZ0JBQUosQ0FGTTtBQUdwQixXQUFTLDBCQUFJLGVBQUo7QUFIVyxDQUF4QjtJQXlEcUJDLG1CLFdBRHBCLGdEQUFxQixtQ0FBckIsQyxtQ0FBRCxNQUNxQkEsbUJBRHJCLFNBQ2lEQyxlQUFNQyxTQUR2RCxDQUNpRjtBQWM3RUMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0FBQ3ZCLFVBQU1BLEtBQU47QUFEdUIsa0VBYlAsdUJBYU87QUFBQSx3RUFaRCx1QkFZQztBQUFBO0FBQUE7QUFBQSx5REFxQ0gsTUFBWTtBQUNoQyxVQUFJQyxZQUFZLEdBQUcsS0FBS0MsS0FBTCxDQUFXRCxZQUFYLENBQXdCRSxLQUF4QixFQUFuQixDQURnQyxDQUVoQztBQUNBOztBQUNBLFVBQUksS0FBS0MsU0FBTCxDQUFlQyxPQUFmLENBQXVCQyxLQUF2QixLQUFpQyxFQUFyQyxFQUF5QztBQUNyQ0wsUUFBQUEsWUFBWSxHQUFHLEtBQUtNLGtCQUFMLENBQXdCLENBQUMsS0FBS0gsU0FBTCxDQUFlQyxPQUFmLENBQXVCQyxLQUF4QixDQUF4QixDQUFmO0FBQ0EsWUFBSUwsWUFBWSxLQUFLLElBQXJCLEVBQTJCO0FBQzlCOztBQUNELFdB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O0FBem9CNEUsQyx5REFNdEM7QUFDbkM1RCxFQUFBQSxLQUFLLEVBQUUsRUFENEI7QUFFbkNxRSxFQUFBQSxLQUFLLEVBQUUsSUFGNEI7QUFHbkNoQixFQUFBQSxpQkFBaUIsRUFBRWdKLHlCQUhnQjtBQUluQ3JLLEVBQUFBLFVBQVUsRUFBRSxNQUp1QjtBQUtuQ2lILEVBQUFBLFdBQVcsRUFBRTtBQUxzQixDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE1LCAyMDE2IE9wZW5NYXJrZXQgTHRkXG5Db3B5cmlnaHQgMjAxNywgMjAxOCwgMjAxOSBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTkgTWljaGFlbCBUZWxhdHluc2tpIDw3dDNjaGd1eUBnbWFpbC5jb20+XG5Db3B5cmlnaHQgMjAxOSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwgeyBjcmVhdGVSZWYgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBzbGVlcCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy91dGlsc1wiO1xuXG5pbXBvcnQgeyBfdCwgX3RkIH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gJy4uLy4uLy4uL01hdHJpeENsaWVudFBlZyc7XG5pbXBvcnQgZGlzIGZyb20gJy4uLy4uLy4uL2Rpc3BhdGNoZXIvZGlzcGF0Y2hlcic7XG5pbXBvcnQgeyBBZGRyZXNzVHlwZSwgYWRkcmVzc1R5cGVzLCBnZXRBZGRyZXNzVHlwZSwgSVVzZXJBZGRyZXNzIH0gZnJvbSAnLi4vLi4vLi4vVXNlckFkZHJlc3MnO1xuaW1wb3J0IEdyb3VwU3RvcmUgZnJvbSAnLi4vLi4vLi4vc3RvcmVzL0dyb3VwU3RvcmUnO1xuaW1wb3J0ICogYXMgRW1haWwgZnJvbSAnLi4vLi4vLi4vZW1haWwnO1xuaW1wb3J0IElkZW50aXR5QXV0aENsaWVudCBmcm9tICcuLi8uLi8uLi9JZGVudGl0eUF1dGhDbGllbnQnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdElkZW50aXR5U2VydmVyVXJsLCB1c2VEZWZhdWx0SWRlbnRpdHlTZXJ2ZXIgfSBmcm9tICcuLi8uLi8uLi91dGlscy9JZGVudGl0eVNlcnZlclV0aWxzJztcbmltcG9ydCB7IGFiYnJldmlhdGVVcmwgfSBmcm9tICcuLi8uLi8uLi91dGlscy9VcmxVdGlscyc7XG5pbXBvcnQgeyBLZXkgfSBmcm9tIFwiLi4vLi4vLi4vS2V5Ym9hcmRcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgQWRkcmVzc1NlbGVjdG9yIGZyb20gJy4uL2VsZW1lbnRzL0FkZHJlc3NTZWxlY3Rvcic7XG5pbXBvcnQgQWRkcmVzc1RpbGUgZnJvbSAnLi4vZWxlbWVudHMvQWRkcmVzc1RpbGUnO1xuaW1wb3J0IEJhc2VEaWFsb2cgZnJvbSBcIi4vQmFzZURpYWxvZ1wiO1xuaW1wb3J0IERpYWxvZ0J1dHRvbnMgZnJvbSBcIi4uL2VsZW1lbnRzL0RpYWxvZ0J1dHRvbnNcIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5jb25zdCBUUlVOQ0FURV9RVUVSWV9MSVNUID0gNDA7XG5jb25zdCBRVUVSWV9VU0VSX0RJUkVDVE9SWV9ERUJPVU5DRV9NUyA9IDIwMDtcblxuY29uc3QgYWRkcmVzc1R5cGVOYW1lID0ge1xuICAgICdteC11c2VyLWlkJzogX3RkKFwiTWF0cml4IElEXCIpLFxuICAgICdteC1yb29tLWlkJzogX3RkKFwiTWF0cml4IFJvb20gSURcIiksXG4gICAgJ2VtYWlsJzogX3RkKFwiZW1haWwgYWRkcmVzc1wiKSxcbn07XG5cbmludGVyZmFjZSBJUmVzdWx0IHtcbiAgICB1c2VyX2lkOiBzdHJpbmc7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG4gICAgcm9vbV9pZD86IHN0cmluZzsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2VcbiAgICBuYW1lPzogc3RyaW5nO1xuICAgIGRpc3BsYXlfbmFtZT86IHN0cmluZzsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2VcbiAgICBhdmF0YXJfdXJsPzogc3RyaW5nOy8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG59XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb24/OiBKU1guRWxlbWVudDtcbiAgICAvLyBFeHRyYSBub2RlIGluc2VydGVkIGFmdGVyIHBpY2tlciBpbnB1dCwgZHJvcGRvd24gYW5kIGVycm9yc1xuICAgIGV4dHJhTm9kZT86IEpTWC5FbGVtZW50O1xuICAgIHZhbHVlPzogc3RyaW5nO1xuICAgIHBsYWNlaG9sZGVyPzogKCh2YWxpZEFkZHJlc3NUeXBlczogYW55KSA9PiBzdHJpbmcpIHwgc3RyaW5nO1xuICAgIHJvb21JZD86IHN0cmluZztcbiAgICBidXR0b24/OiBzdHJpbmc7XG4gICAgZm9jdXM/OiBib29sZWFuO1xuICAgIHZhbGlkQWRkcmVzc1R5cGVzPzogQWRkcmVzc1R5cGVbXTtcbiAgICBvbkZpbmlzaGVkOiAoc3VjY2VzczogYm9vbGVhbiwgbGlzdD86IElVc2VyQWRkcmVzc1tdKSA9PiB2b2lkO1xuICAgIGdyb3VwSWQ/OiBzdHJpbmc7XG4gICAgLy8gVGhlIHR5cGUgb2YgZW50aXR5IHRvIHNlYXJjaCBmb3IuIERlZmF1bHQ6ICd1c2VyJy5cbiAgICBwaWNrZXJUeXBlPzogJ3VzZXInIHwgJ3Jvb20nO1xuICAgIC8vIFdoZXRoZXIgdGhlIGN1cnJlbnQgdXNlciBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIGFkZHJlc3NlcyByZXR1cm5lZC4gT25seVxuICAgIC8vIGFwcGxpY2FibGUgd2hlbiBwaWNrZXJUeXBlIGlzIGB1c2VyYC4gRGVmYXVsdDogZmFsc2UuXG4gICAgaW5jbHVkZVNlbGY/OiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICAvLyBXaGV0aGVyIHRvIHNob3cgYW4gZXJyb3IgbWVzc2FnZSBiZWNhdXNlIG9mIGFuIGludmFsaWQgYWRkcmVzc1xuICAgIGludmFsaWRBZGRyZXNzRXJyb3I6IGJvb2xlYW47XG4gICAgLy8gTGlzdCBvZiBVc2VyQWRkcmVzc1R5cGUgb2JqZWN0cyByZXByZXNlbnRpbmdcbiAgICAvLyB0aGUgbGlzdCBvZiBhZGRyZXNzZXMgd2UncmUgZ29pbmcgdG8gaW52aXRlXG4gICAgc2VsZWN0ZWRMaXN0OiBJVXNlckFkZHJlc3NbXTtcbiAgICAvLyBXaGV0aGVyIGEgc2VhcmNoIGlzIG9uZ29pbmdcbiAgICBidXN5OiBib29sZWFuO1xuICAgIC8vIEFuIGVycm9yIG1lc3NhZ2UgZ2VuZXJhdGVkIGR1cmluZyB0aGUgdXNlciBkaXJlY3Rvcnkgc2VhcmNoXG4gICAgc2VhcmNoRXJyb3I6IHN0cmluZztcbiAgICAvLyBXaGV0aGVyIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgdGhlIHVzZXJfZGlyZWN0b3J5IEFQSVxuICAgIHNlcnZlclN1cHBvcnRzVXNlckRpcmVjdG9yeTogYm9vbGVhbjtcbiAgICAvLyBUaGUgcXVlcnkgYmVpbmcgc2VhcmNoZWQgZm9yXG4gICAgcXVlcnk6IHN0cmluZztcbiAgICAvLyBMaXN0IG9mIFVzZXJBZGRyZXNzVHlwZSBvYmplY3RzIHJlcHJlc2VudGluZyB0aGUgc2V0IG9mXG4gICAgLy8gYXV0by1jb21wbGV0aW9uIHJlc3VsdHMgZm9yIHRoZSBjdXJyZW50IHNlYXJjaCBxdWVyeS5cbiAgICBzdWdnZXN0ZWRMaXN0OiBJVXNlckFkZHJlc3NbXTtcbiAgICAvLyBMaXN0IG9mIGFkZHJlc3MgdHlwZXMgaW5pdGlhbGlzZWQgZnJvbSBwcm9wcywgYnV0IG1heSBjaGFuZ2Ugd2hpbGUgdGhlXG4gICAgLy8gZGlhbG9nIGlzIG9wZW4gYW5kIHJlcHJlc2VudHMgdGhlIHN1cHBvcnRlZCBsaXN0IG9mIGFkZHJlc3MgdHlwZXMgYXQgdGhpcyB0aW1lLlxuICAgIHZhbGlkQWRkcmVzc1R5cGVzOiBBZGRyZXNzVHlwZVtdO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5kaWFsb2dzLkFkZHJlc3NQaWNrZXJEaWFsb2dcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFkZHJlc3NQaWNrZXJEaWFsb2cgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIHRleHRpbnB1dCA9IGNyZWF0ZVJlZjxIVE1MVGV4dEFyZWFFbGVtZW50PigpO1xuICAgIHByaXZhdGUgYWRkcmVzc1NlbGVjdG9yID0gY3JlYXRlUmVmPEFkZHJlc3NTZWxlY3Rvcj4oKTtcbiAgICBwcml2YXRlIHF1ZXJ5Q2hhbmdlZERlYm91bmNlcjogbnVtYmVyO1xuICAgIHByaXZhdGUgY2FuY2VsVGhyZWVwaWRMb29rdXA6ICgpID0+IHZvaWQ7XG5cbiAgICBzdGF0aWMgZGVmYXVsdFByb3BzOiBQYXJ0aWFsPElQcm9wcz4gPSB7XG4gICAgICAgIHZhbHVlOiBcIlwiLFxuICAgICAgICBmb2N1czogdHJ1ZSxcbiAgICAgICAgdmFsaWRBZGRyZXNzVHlwZXM6IGFkZHJlc3NUeXBlcyxcbiAgICAgICAgcGlja2VyVHlwZTogJ3VzZXInLFxuICAgICAgICBpbmNsdWRlU2VsZjogZmFsc2UsXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIGxldCB2YWxpZEFkZHJlc3NUeXBlcyA9IHRoaXMucHJvcHMudmFsaWRBZGRyZXNzVHlwZXM7XG4gICAgICAgIC8vIFJlbW92ZSBlbWFpbCBmcm9tIHZhbGlkQWRkcmVzc1R5cGVzIGlmIG5vIElTIGlzIGNvbmZpZ3VyZWQuIEl0IG1heSBiZSBhZGRlZCBhdCBhIGxhdGVyIHN0YWdlIGJ5IHRoZSB1c2VyXG4gICAgICAgIGlmICghTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldElkZW50aXR5U2VydmVyVXJsKCkgJiYgdmFsaWRBZGRyZXNzVHlwZXMuaW5jbHVkZXMoQWRkcmVzc1R5cGUuRW1haWwpKSB7XG4gICAgICAgICAgICB2YWxpZEFkZHJlc3NUeXBlcyA9IHZhbGlkQWRkcmVzc1R5cGVzLmZpbHRlcih0eXBlID0+IHR5cGUgIT09IEFkZHJlc3NUeXBlLkVtYWlsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBpbnZhbGlkQWRkcmVzc0Vycm9yOiBmYWxzZSxcbiAgICAgICAgICAgIHNlbGVjdGVkTGlzdDogW10sXG4gICAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgICAgIHNlYXJjaEVycm9yOiBudWxsLFxuICAgICAgICAgICAgc2VydmVyU3VwcG9ydHNVc2VyRGlyZWN0b3J5OiB0cnVlLFxuICAgICAgICAgICAgcXVlcnk6IFwiXCIsXG4gICAgICAgICAgICBzdWdnZXN0ZWRMaXN0OiBbXSxcbiAgICAgICAgICAgIHZhbGlkQWRkcmVzc1R5cGVzLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5mb2N1cykge1xuICAgICAgICAgICAgLy8gU2V0IHRoZSBjdXJzb3IgYXQgdGhlIGVuZCBvZiB0aGUgdGV4dCBpbnB1dFxuICAgICAgICAgICAgdGhpcy50ZXh0aW5wdXQuY3VycmVudC52YWx1ZSA9IHRoaXMucHJvcHMudmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFBsYWNlaG9sZGVyKCk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHsgcGxhY2Vob2xkZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0eXBlb2YgcGxhY2Vob2xkZXIgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBwbGFjZWhvbGRlcjtcbiAgICAgICAgfVxuICAgICAgICAvLyBPdGhlcndpc2UgaXQncyBhIGZ1bmN0aW9uLCBhcyBjaGVja2VkIGJ5IHByb3AgdHlwZXMuXG4gICAgICAgIHJldHVybiBwbGFjZWhvbGRlcih0aGlzLnN0YXRlLnZhbGlkQWRkcmVzc1R5cGVzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uQnV0dG9uQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIGxldCBzZWxlY3RlZExpc3QgPSB0aGlzLnN0YXRlLnNlbGVjdGVkTGlzdC5zbGljZSgpO1xuICAgICAgICAvLyBDaGVjayB0aGUgdGV4dCBpbnB1dCBmaWVsZCB0byBzZWUgaWYgdXNlciBoYXMgYW4gdW5jb252ZXJ0ZWQgYWRkcmVzc1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbmQgaXQncyB2YWxpZCBhZGQgaXQgdG8gdGhlIGxvY2FsIHNlbGVjdGVkTGlzdFxuICAgICAgICBpZiAodGhpcy50ZXh0aW5wdXQuY3VycmVudC52YWx1ZSAhPT0gJycpIHtcbiAgICAgICAgICAgIHNlbGVjdGVkTGlzdCA9IHRoaXMuYWRkQWRkcmVzc2VzVG9MaXN0KFt0aGlzLnRleHRpbnB1dC5jdXJyZW50LnZhbHVlXSk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRMaXN0ID09PSBudWxsKSByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKHRydWUsIHNlbGVjdGVkTGlzdCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25DYW5jZWwgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMucHJvcHMub25GaW5pc2hlZChmYWxzZSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25LZXlEb3duID0gKGU6IFJlYWN0LktleWJvYXJkRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3QgdGV4dElucHV0ID0gdGhpcy50ZXh0aW5wdXQuY3VycmVudCA/IHRoaXMudGV4dGlucHV0LmN1cnJlbnQudmFsdWUgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgaWYgKGUua2V5ID09PSBLZXkuRVNDQVBFKSB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKGZhbHNlKTtcbiAgICAgICAgfSBlbHNlIGlmIChlLmtleSA9PT0gS2V5LkFSUk9XX1VQKSB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuYWRkcmVzc1NlbGVjdG9yLmN1cnJlbnQpIHRoaXMuYWRkcmVzc1NlbGVjdG9yLmN1cnJlbnQubW92ZVNlbGVjdGlvblVwKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IEtleS5BUlJPV19ET1dOKSB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuYWRkcmVzc1NlbGVjdG9yLmN1cnJlbnQpIHRoaXMuYWRkcmVzc1NlbGVjdG9yLmN1cnJlbnQubW92ZVNlbGVjdGlvbkRvd24oKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLnN1Z2dlc3RlZExpc3QubGVuZ3RoID4gMCAmJiBbS2V5LkNPTU1BLCBLZXkuRU5URVIsIEtleS5UQUJdLmluY2x1ZGVzKGUua2V5KSkge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmFkZHJlc3NTZWxlY3Rvci5jdXJyZW50KSB0aGlzLmFkZHJlc3NTZWxlY3Rvci5jdXJyZW50LmNob29zZVNlbGVjdGlvbigpO1xuICAgICAgICB9IGVsc2UgaWYgKHRleHRJbnB1dC5sZW5ndGggPT09IDAgJiYgdGhpcy5zdGF0ZS5zZWxlY3RlZExpc3QubGVuZ3RoICYmIGUua2V5ID09PSBLZXkuQkFDS1NQQUNFKSB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5vbkRpc21pc3NlZCh0aGlzLnN0YXRlLnNlbGVjdGVkTGlzdC5sZW5ndGggLSAxKSgpO1xuICAgICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSBLZXkuRU5URVIpIHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBpZiAodGV4dElucHV0ID09PSAnJykge1xuICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3Mgbm90aGluZyBpbiB0aGUgaW5wdXQgYm94LCBzdWJtaXQgdGhlIGZvcm1cbiAgICAgICAgICAgICAgICB0aGlzLm9uQnV0dG9uQ2xpY2soKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRBZGRyZXNzZXNUb0xpc3QoW3RleHRJbnB1dF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRleHRJbnB1dCAmJiAoZS5rZXkgPT09IEtleS5DT01NQSB8fCBlLmtleSA9PT0gS2V5LlRBQikpIHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLmFkZEFkZHJlc3Nlc1RvTGlzdChbdGV4dElucHV0XSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblF1ZXJ5Q2hhbmdlZCA9IChldjogUmVhY3QuQ2hhbmdlRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSAoZXYudGFyZ2V0IGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQpLnZhbHVlO1xuICAgICAgICBpZiAodGhpcy5xdWVyeUNoYW5nZWREZWJvdW5jZXIpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnF1ZXJ5Q2hhbmdlZERlYm91bmNlcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gT25seSBkbyBzZWFyY2ggaWYgdGhlcmUgaXMgc29tZXRoaW5nIHRvIHNlYXJjaFxuICAgICAgICBpZiAocXVlcnkubGVuZ3RoID4gMCAmJiBxdWVyeSAhPT0gJ0AnICYmIHF1ZXJ5Lmxlbmd0aCA+PSAyKSB7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5Q2hhbmdlZERlYm91bmNlciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLnBpY2tlclR5cGUgPT09ICd1c2VyJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5ncm91cElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvTmFpdmVHcm91cFNlYXJjaChxdWVyeSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5zZXJ2ZXJTdXBwb3J0c1VzZXJEaXJlY3RvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9Vc2VyRGlyZWN0b3J5U2VhcmNoKHF1ZXJ5KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9Mb2NhbFNlYXJjaChxdWVyeSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMucGlja2VyVHlwZSA9PT0gJ3Jvb20nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmdyb3VwSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9OYWl2ZUdyb3VwUm9vbVNlYXJjaChxdWVyeSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvUm9vbVNlYXJjaChxdWVyeSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ1Vua25vd24gcGlja2VyVHlwZScsIHRoaXMucHJvcHMucGlja2VyVHlwZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgUVVFUllfVVNFUl9ESVJFQ1RPUllfREVCT1VOQ0VfTVMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc3VnZ2VzdGVkTGlzdDogW10sXG4gICAgICAgICAgICAgICAgcXVlcnk6IFwiXCIsXG4gICAgICAgICAgICAgICAgc2VhcmNoRXJyb3I6IG51bGwsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uRGlzbWlzc2VkID0gKGluZGV4OiBudW1iZXIpID0+ICgpID0+IHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRMaXN0ID0gdGhpcy5zdGF0ZS5zZWxlY3RlZExpc3Quc2xpY2UoKTtcbiAgICAgICAgc2VsZWN0ZWRMaXN0LnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2VsZWN0ZWRMaXN0LFxuICAgICAgICAgICAgc3VnZ2VzdGVkTGlzdDogW10sXG4gICAgICAgICAgICBxdWVyeTogXCJcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLmNhbmNlbFRocmVlcGlkTG9va3VwKSB0aGlzLmNhbmNlbFRocmVlcGlkTG9va3VwKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25TZWxlY3RlZCA9IChpbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTGlzdCA9IHRoaXMuc3RhdGUuc2VsZWN0ZWRMaXN0LnNsaWNlKCk7XG4gICAgICAgIHNlbGVjdGVkTGlzdC5wdXNoKHRoaXMuZ2V0RmlsdGVyZWRTdWdnZXN0aW9ucygpW2luZGV4XSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2VsZWN0ZWRMaXN0LFxuICAgICAgICAgICAgc3VnZ2VzdGVkTGlzdDogW10sXG4gICAgICAgICAgICBxdWVyeTogXCJcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLmNhbmNlbFRocmVlcGlkTG9va3VwKSB0aGlzLmNhbmNlbFRocmVlcGlkTG9va3VwKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgZG9OYWl2ZUdyb3VwU2VhcmNoKHF1ZXJ5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgbG93ZXJDYXNlUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGJ1c3k6IHRydWUsXG4gICAgICAgICAgICBxdWVyeSxcbiAgICAgICAgICAgIHNlYXJjaEVycm9yOiBudWxsLFxuICAgICAgICB9KTtcbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldEdyb3VwVXNlcnModGhpcy5wcm9wcy5ncm91cElkKS50aGVuKChyZXNwKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gW107XG4gICAgICAgICAgICByZXNwLmNodW5rLmZvckVhY2goKHUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB1c2VySWRNYXRjaCA9IHUudXNlcl9pZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvd2VyQ2FzZVF1ZXJ5KTtcbiAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5TmFtZU1hdGNoID0gKHUuZGlzcGxheW5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJDYXNlUXVlcnkpO1xuICAgICAgICAgICAgICAgIGlmICghKHVzZXJJZE1hdGNoIHx8IGRpc3BsYXlOYW1lTWF0Y2gpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9pZDogdS51c2VyX2lkLFxuICAgICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsOiB1LmF2YXRhcl91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlfbmFtZTogdS5kaXNwbGF5bmFtZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzUmVzdWx0cyhyZXN1bHRzLCBxdWVyeSk7XG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRXJyb3Igd2hpbHN0IHNlYXJjaGluZyBncm91cCByb29tczogJywgZXJyKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHNlYXJjaEVycm9yOiBlcnIuZXJyY29kZSA/IGVyci5tZXNzYWdlIDogX3QoJ1NvbWV0aGluZyB3ZW50IHdyb25nIScpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkb05haXZlR3JvdXBSb29tU2VhcmNoKHF1ZXJ5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgbG93ZXJDYXNlUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCByZXN1bHRzID0gW107XG4gICAgICAgIEdyb3VwU3RvcmUuZ2V0R3JvdXBSb29tcyh0aGlzLnByb3BzLmdyb3VwSWQpLmZvckVhY2goKHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWVNYXRjaCA9IChyLm5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJDYXNlUXVlcnkpO1xuICAgICAgICAgICAgY29uc3QgdG9waWNNYXRjaCA9IChyLnRvcGljIHx8ICcnKS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvd2VyQ2FzZVF1ZXJ5KTtcbiAgICAgICAgICAgIGNvbnN0IGFsaWFzTWF0Y2ggPSAoci5jYW5vbmljYWxfYWxpYXMgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJDYXNlUXVlcnkpO1xuICAgICAgICAgICAgaWYgKCEobmFtZU1hdGNoIHx8IHRvcGljTWF0Y2ggfHwgYWxpYXNNYXRjaCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgICAgIHJvb21faWQ6IHIucm9vbV9pZCxcbiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsOiByLmF2YXRhcl91cmwsXG4gICAgICAgICAgICAgICAgbmFtZTogci5uYW1lIHx8IHIuY2Fub25pY2FsX2FsaWFzLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnByb2Nlc3NSZXN1bHRzKHJlc3VsdHMsIHF1ZXJ5KTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkb1Jvb21TZWFyY2gocXVlcnk6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zdCBsb3dlckNhc2VRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHJvb21zID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFJvb21zKCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgICAgICAgcm9vbXMuZm9yRWFjaCgocm9vbSkgPT4ge1xuICAgICAgICAgICAgbGV0IHJhbmsgPSBJbmZpbml0eTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWVFdmVudCA9IHJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKCdtLnJvb20ubmFtZScsICcnKTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBuYW1lRXZlbnQgPyBuYW1lRXZlbnQuZ2V0Q29udGVudCgpLm5hbWUgOiAnJztcbiAgICAgICAgICAgIGNvbnN0IGNhbm9uaWNhbEFsaWFzID0gcm9vbS5nZXRDYW5vbmljYWxBbGlhcygpO1xuICAgICAgICAgICAgY29uc3QgYWxpYXNFdmVudHMgPSByb29tLmN1cnJlbnRTdGF0ZS5nZXRTdGF0ZUV2ZW50cygnbS5yb29tLmFsaWFzZXMnKTtcbiAgICAgICAgICAgIGNvbnN0IGFsaWFzZXMgPSBhbGlhc0V2ZW50cy5tYXAoKGV2KSA9PiBldi5nZXRDb250ZW50KCkuYWxpYXNlcykucmVkdWNlKChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEuY29uY2F0KGIpO1xuICAgICAgICAgICAgfSwgW10pO1xuXG4gICAgICAgICAgICBjb25zdCBuYW1lTWF0Y2ggPSAobmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlckNhc2VRdWVyeSk7XG4gICAgICAgICAgICBsZXQgYWxpYXNNYXRjaCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IHNob3J0ZXN0TWF0Y2hpbmdBbGlhc0xlbmd0aCA9IEluZmluaXR5O1xuICAgICAgICAgICAgYWxpYXNlcy5mb3JFYWNoKChhbGlhcykgPT4ge1xuICAgICAgICAgICAgICAgIGlmICgoYWxpYXMgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJDYXNlUXVlcnkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsaWFzTWF0Y2ggPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2hvcnRlc3RNYXRjaGluZ0FsaWFzTGVuZ3RoID4gYWxpYXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG9ydGVzdE1hdGNoaW5nQWxpYXNMZW5ndGggPSBhbGlhcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCEobmFtZU1hdGNoIHx8IGFsaWFzTWF0Y2gpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYWxpYXNNYXRjaCkge1xuICAgICAgICAgICAgICAgIC8vIEEgc2hvcnRlciBtYXRjaGluZyBhbGlhcyB3aWxsIGdpdmUgYSBiZXR0ZXIgcmFua1xuICAgICAgICAgICAgICAgIHJhbmsgPSBzaG9ydGVzdE1hdGNoaW5nQWxpYXNMZW5ndGg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGF2YXRhckV2ZW50ID0gcm9vbS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoJ20ucm9vbS5hdmF0YXInLCAnJyk7XG4gICAgICAgICAgICBjb25zdCBhdmF0YXJVcmwgPSBhdmF0YXJFdmVudCA/IGF2YXRhckV2ZW50LmdldENvbnRlbnQoKS51cmwgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgcmFuayxcbiAgICAgICAgICAgICAgICByb29tX2lkOiByb29tLnJvb21JZCxcbiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsOiBhdmF0YXJVcmwsXG4gICAgICAgICAgICAgICAgbmFtZTogbmFtZSB8fCBjYW5vbmljYWxBbGlhcyB8fCBhbGlhc2VzWzBdIHx8IF90KCdVbm5hbWVkIFJvb20nKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTb3J0IGJ5IHJhbmsgYXNjZW5kaW5nIChhIGhpZ2ggcmFuayBiZWluZyBsZXNzIHJlbGV2YW50KVxuICAgICAgICBjb25zdCBzb3J0ZWRSZXN1bHRzID0gcmVzdWx0cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYS5yYW5rIC0gYi5yYW5rO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnByb2Nlc3NSZXN1bHRzKHNvcnRlZFJlc3VsdHMsIHF1ZXJ5KTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBidXN5OiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkb1VzZXJEaXJlY3RvcnlTZWFyY2gocXVlcnk6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGJ1c3k6IHRydWUsXG4gICAgICAgICAgICBxdWVyeSxcbiAgICAgICAgICAgIHNlYXJjaEVycm9yOiBudWxsLFxuICAgICAgICB9KTtcbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLnNlYXJjaFVzZXJEaXJlY3Rvcnkoe1xuICAgICAgICAgICAgdGVybTogcXVlcnksXG4gICAgICAgIH0pLnRoZW4oKHJlc3ApID0+IHtcbiAgICAgICAgICAgIC8vIFRoZSBxdWVyeSBtaWdodCBoYXZlIGNoYW5nZWQgc2luY2Ugd2Ugc2VudCB0aGUgcmVxdWVzdCwgc28gaWdub3JlXG4gICAgICAgICAgICAvLyByZXNwb25zZXMgZm9yIGFueXRoaW5nIG90aGVyIHRoYW4gdGhlIGxhdGVzdCBxdWVyeS5cbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnF1ZXJ5ICE9PSBxdWVyeSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc1Jlc3VsdHMocmVzcC5yZXN1bHRzLCBxdWVyeSk7XG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRXJyb3Igd2hpbHN0IHNlYXJjaGluZyB1c2VyIGRpcmVjdG9yeTogJywgZXJyKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHNlYXJjaEVycm9yOiBlcnIuZXJyY29kZSA/IGVyci5tZXNzYWdlIDogX3QoJ1NvbWV0aGluZyB3ZW50IHdyb25nIScpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoZXJyLmVycmNvZGUgPT09ICdNX1VOUkVDT0dOSVpFRCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyU3VwcG9ydHNVc2VyRGlyZWN0b3J5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBEbyBhIGxvY2FsIHNlYXJjaCBpbW1lZGlhdGVseVxuICAgICAgICAgICAgICAgIHRoaXMuZG9Mb2NhbFNlYXJjaChxdWVyeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgYnVzeTogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkb0xvY2FsU2VhcmNoKHF1ZXJ5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBxdWVyeSxcbiAgICAgICAgICAgIHNlYXJjaEVycm9yOiBudWxsLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcXVlcnlMb3dlcmNhc2UgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCByZXN1bHRzID0gW107XG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRVc2VycygpLmZvckVhY2goKHVzZXIpID0+IHtcbiAgICAgICAgICAgIGlmICh1c2VyLnVzZXJJZC50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXVlcnlMb3dlcmNhc2UpID09PSAtMSAmJlxuICAgICAgICAgICAgICAgIHVzZXIuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHF1ZXJ5TG93ZXJjYXNlKSA9PT0gLTFcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUHV0IHJlc3VsdHMgaW4gdGhlIGZvcm1hdCBvZiB0aGUgbmV3IEFQSVxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICB1c2VyX2lkOiB1c2VyLnVzZXJJZCxcbiAgICAgICAgICAgICAgICBkaXNwbGF5X25hbWU6IHVzZXIuZGlzcGxheU5hbWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyX3VybDogdXNlci5hdmF0YXJVcmwsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucHJvY2Vzc1Jlc3VsdHMocmVzdWx0cywgcXVlcnkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcHJvY2Vzc1Jlc3VsdHMocmVzdWx0czogSVJlc3VsdFtdLCBxdWVyeTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHN1Z2dlc3RlZExpc3QgPSBbXTtcbiAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQucm9vbV9pZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCByb29tID0gY2xpZW50LmdldFJvb20ocmVzdWx0LnJvb21faWQpO1xuICAgICAgICAgICAgICAgIGlmIChyb29tKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvbWJzdG9uZSA9IHJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKCdtLnJvb20udG9tYnN0b25lJywgJycpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodG9tYnN0b25lICYmIHRvbWJzdG9uZS5nZXRDb250ZW50KCkgJiYgdG9tYnN0b25lLmdldENvbnRlbnQoKVtcInJlcGxhY2VtZW50X3Jvb21cIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcGxhY2VtZW50Um9vbSA9IGNsaWVudC5nZXRSb29tKHRvbWJzdG9uZS5nZXRDb250ZW50KClbXCJyZXBsYWNlbWVudF9yb29tXCJdKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb29tcyB3aXRoIHRvbWJzdG9uZXMgd2hlcmUgd2UgYXJlIGFsc28gYXdhcmUgb2YgdGhlIHJlcGxhY2VtZW50IHJvb20uXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnRSb29tKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3VnZ2VzdGVkTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgYWRkcmVzc1R5cGU6ICdteC1yb29tLWlkJyxcbiAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogcmVzdWx0LnJvb21faWQsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiByZXN1bHQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyTXhjOiByZXN1bHQuYXZhdGFyX3VybCxcbiAgICAgICAgICAgICAgICAgICAgaXNLbm93bjogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMucHJvcHMuaW5jbHVkZVNlbGYgJiZcbiAgICAgICAgICAgICAgICByZXN1bHQudXNlcl9pZCA9PT0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmNyZWRlbnRpYWxzLnVzZXJJZFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm4gb2JqZWN0cywgc3RydWN0dXJlIG9mIHdoaWNoIGlzIGRlZmluZWRcbiAgICAgICAgICAgIC8vIGJ5IFVzZXJBZGRyZXNzVHlwZVxuICAgICAgICAgICAgc3VnZ2VzdGVkTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICBhZGRyZXNzVHlwZTogJ214LXVzZXItaWQnLFxuICAgICAgICAgICAgICAgIGFkZHJlc3M6IHJlc3VsdC51c2VyX2lkLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiByZXN1bHQuZGlzcGxheV9uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhck14YzogcmVzdWx0LmF2YXRhcl91cmwsXG4gICAgICAgICAgICAgICAgaXNLbm93bjogdHJ1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBJZiB0aGUgcXVlcnkgaXMgYSB2YWxpZCBhZGRyZXNzLCBhZGQgYW4gZW50cnkgZm9yIHRoYXRcbiAgICAgICAgLy8gVGhpcyBpcyBpbXBvcnRhbnQsIG90aGVyd2lzZSB0aGVyZSdzIG5vIHdheSB0byBpbnZpdGVcbiAgICAgICAgLy8gYSBwZXJmZWN0bHkgdmFsaWQgYWRkcmVzcyBpZiB0aGVyZSBhcmUgY2xvc2UgbWF0Y2hlcy5cbiAgICAgICAgY29uc3QgYWRkclR5cGUgPSBnZXRBZGRyZXNzVHlwZShxdWVyeSk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnZhbGlkQWRkcmVzc1R5cGVzLmluY2x1ZGVzKGFkZHJUeXBlKSkge1xuICAgICAgICAgICAgaWYgKGFkZHJUeXBlID09PSAnZW1haWwnICYmICFFbWFpbC5sb29rc1ZhbGlkKHF1ZXJ5KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzZWFyY2hFcnJvcjogX3QoXCJUaGF0IGRvZXNuJ3QgbG9vayBsaWtlIGEgdmFsaWQgZW1haWwgYWRkcmVzc1wiKSB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdWdnZXN0ZWRMaXN0LnVuc2hpZnQoe1xuICAgICAgICAgICAgICAgIGFkZHJlc3NUeXBlOiBhZGRyVHlwZSxcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiBxdWVyeSxcbiAgICAgICAgICAgICAgICBpc0tub3duOiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FuY2VsVGhyZWVwaWRMb29rdXApIHRoaXMuY2FuY2VsVGhyZWVwaWRMb29rdXAoKTtcbiAgICAgICAgICAgIGlmIChhZGRyVHlwZSA9PT0gJ2VtYWlsJykge1xuICAgICAgICAgICAgICAgIHRoaXMubG9va3VwVGhyZWVwaWQoYWRkclR5cGUsIHF1ZXJ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHN1Z2dlc3RlZExpc3QsXG4gICAgICAgICAgICBpbnZhbGlkQWRkcmVzc0Vycm9yOiBmYWxzZSxcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuYWRkcmVzc1NlbGVjdG9yLmN1cnJlbnQpIHRoaXMuYWRkcmVzc1NlbGVjdG9yLmN1cnJlbnQubW92ZVNlbGVjdGlvblRvcCgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFkZEFkZHJlc3Nlc1RvTGlzdChhZGRyZXNzVGV4dHM6IHN0cmluZ1tdKTogSVVzZXJBZGRyZXNzW10ge1xuICAgICAgICBjb25zdCBzZWxlY3RlZExpc3QgPSB0aGlzLnN0YXRlLnNlbGVjdGVkTGlzdC5zbGljZSgpO1xuXG4gICAgICAgIGxldCBoYXNFcnJvciA9IGZhbHNlO1xuICAgICAgICBhZGRyZXNzVGV4dHMuZm9yRWFjaCgoYWRkcmVzc1RleHQpID0+IHtcbiAgICAgICAgICAgIGFkZHJlc3NUZXh0ID0gYWRkcmVzc1RleHQudHJpbSgpO1xuICAgICAgICAgICAgY29uc3QgYWRkclR5cGUgPSBnZXRBZGRyZXNzVHlwZShhZGRyZXNzVGV4dCk7XG4gICAgICAgICAgICBjb25zdCBhZGRyT2JqOiBJVXNlckFkZHJlc3MgPSB7XG4gICAgICAgICAgICAgICAgYWRkcmVzc1R5cGU6IGFkZHJUeXBlLFxuICAgICAgICAgICAgICAgIGFkZHJlc3M6IGFkZHJlc3NUZXh0LFxuICAgICAgICAgICAgICAgIGlzS25vd246IGZhbHNlLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLnZhbGlkQWRkcmVzc1R5cGVzLmluY2x1ZGVzKGFkZHJUeXBlKSkge1xuICAgICAgICAgICAgICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWRkclR5cGUgPT09ICdteC11c2VyLWlkJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0VXNlcihhZGRyT2JqLmFkZHJlc3MpO1xuICAgICAgICAgICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZHJPYmouZGlzcGxheU5hbWUgPSB1c2VyLmRpc3BsYXlOYW1lO1xuICAgICAgICAgICAgICAgICAgICBhZGRyT2JqLmF2YXRhck14YyA9IHVzZXIuYXZhdGFyVXJsO1xuICAgICAgICAgICAgICAgICAgICBhZGRyT2JqLmlzS25vd24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWRkclR5cGUgPT09ICdteC1yb29tLWlkJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb20gPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0Um9vbShhZGRyT2JqLmFkZHJlc3MpO1xuICAgICAgICAgICAgICAgIGlmIChyb29tKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZHJPYmouZGlzcGxheU5hbWUgPSByb29tLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGFkZHJPYmouaXNLbm93biA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxlY3RlZExpc3QucHVzaChhZGRyT2JqKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzZWxlY3RlZExpc3QsXG4gICAgICAgICAgICBzdWdnZXN0ZWRMaXN0OiBbXSxcbiAgICAgICAgICAgIHF1ZXJ5OiBcIlwiLFxuICAgICAgICAgICAgaW52YWxpZEFkZHJlc3NFcnJvcjogaGFzRXJyb3IgPyB0cnVlIDogdGhpcy5zdGF0ZS5pbnZhbGlkQWRkcmVzc0Vycm9yLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMuY2FuY2VsVGhyZWVwaWRMb29rdXApIHRoaXMuY2FuY2VsVGhyZWVwaWRMb29rdXAoKTtcbiAgICAgICAgcmV0dXJuIGhhc0Vycm9yID8gbnVsbCA6IHNlbGVjdGVkTGlzdDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGxvb2t1cFRocmVlcGlkKG1lZGl1bTogQWRkcmVzc1R5cGUsIGFkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGxldCBjYW5jZWxsZWQgPSBmYWxzZTtcbiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGNhbid0IHNhZmVseSByZW1vdmUgdGhpcyBhZnRlciB3ZSdyZSBkb25lXG4gICAgICAgIC8vIGJlY2F1c2Ugd2UgZG9uJ3Qga25vdyB0aGF0IGl0J3MgdGhlIHNhbWUgb25lLCBzbyB3ZSBqdXN0XG4gICAgICAgIC8vIGxlYXZlIGl0OiBpdCdzIHJlcGxhY2luZyB0aGUgb2xkIG9uZSBlYWNoIHRpbWUgc28gaXQnc1xuICAgICAgICAvLyBub3QgbGlrZSB0aGV5IGxlYWsuXG4gICAgICAgIHRoaXMuY2FuY2VsVGhyZWVwaWRMb29rdXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNhbmNlbGxlZCA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gd2FpdCBhIGJpdCB0byBsZXQgdGhlIHVzZXIgZmluaXNoIHR5cGluZ1xuICAgICAgICBhd2FpdCBzbGVlcCg1MDApO1xuICAgICAgICBpZiAoY2FuY2VsbGVkKSByZXR1cm4gbnVsbDtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYXV0aENsaWVudCA9IG5ldyBJZGVudGl0eUF1dGhDbGllbnQoKTtcbiAgICAgICAgICAgIGNvbnN0IGlkZW50aXR5QWNjZXNzVG9rZW4gPSBhd2FpdCBhdXRoQ2xpZW50LmdldEFjY2Vzc1Rva2VuKCk7XG4gICAgICAgICAgICBpZiAoY2FuY2VsbGVkKSByZXR1cm4gbnVsbDtcblxuICAgICAgICAgICAgY29uc3QgbG9va3VwID0gYXdhaXQgTWF0cml4Q2xpZW50UGVnLmdldCgpLmxvb2t1cFRocmVlUGlkKFxuICAgICAgICAgICAgICAgIG1lZGl1bSxcbiAgICAgICAgICAgICAgICBhZGRyZXNzLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCAvKiBjYWxsYmFjayAqLyxcbiAgICAgICAgICAgICAgICBpZGVudGl0eUFjY2Vzc1Rva2VuLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChjYW5jZWxsZWQgfHwgbG9va3VwID09PSBudWxsIHx8ICFsb29rdXAubXhpZCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICAgIGNvbnN0IHByb2ZpbGUgPSBhd2FpdCBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0UHJvZmlsZUluZm8obG9va3VwLm14aWQpO1xuICAgICAgICAgICAgaWYgKGNhbmNlbGxlZCB8fCBwcm9maWxlID09PSBudWxsKSByZXR1cm4gbnVsbDtcblxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc3VnZ2VzdGVkTGlzdDogW3tcbiAgICAgICAgICAgICAgICAgICAgLy8gYSBVc2VyQWRkcmVzc1R5cGVcbiAgICAgICAgICAgICAgICAgICAgYWRkcmVzc1R5cGU6IG1lZGl1bSxcbiAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogYWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IHByb2ZpbGUuZGlzcGxheW5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGF2YXRhck14YzogcHJvZmlsZS5hdmF0YXJfdXJsLFxuICAgICAgICAgICAgICAgICAgICBpc0tub3duOiB0cnVlLFxuICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHNlYXJjaEVycm9yOiBfdCgnU29tZXRoaW5nIHdlbnQgd3JvbmchJyksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RmlsdGVyZWRTdWdnZXN0aW9ucygpOiBJVXNlckFkZHJlc3NbXSB7XG4gICAgICAgIC8vIG1hcCBhZGRyZXNzVHlwZSA9PiBzZXQgb2YgYWRkcmVzc2VzIHRvIGF2b2lkIE8obiptKSBvcGVyYXRpb25cbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRBZGRyZXNzZXMgPSB7fTtcbiAgICAgICAgdGhpcy5zdGF0ZS5zZWxlY3RlZExpc3QuZm9yRWFjaCgoeyBhZGRyZXNzLCBhZGRyZXNzVHlwZSB9KSA9PiB7XG4gICAgICAgICAgICBpZiAoIXNlbGVjdGVkQWRkcmVzc2VzW2FkZHJlc3NUeXBlXSkgc2VsZWN0ZWRBZGRyZXNzZXNbYWRkcmVzc1R5cGVdID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgc2VsZWN0ZWRBZGRyZXNzZXNbYWRkcmVzc1R5cGVdLmFkZChhZGRyZXNzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRmlsdGVyIG91dCBhbnkgYWRkcmVzc2VzIGluIHRoZSBhYm92ZSBhbHJlYWR5IHNlbGVjdGVkIGFkZHJlc3NlcyAobWF0Y2hpbmcgYm90aCB0eXBlIGFuZCBhZGRyZXNzKVxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5zdWdnZXN0ZWRMaXN0LmZpbHRlcigoeyBhZGRyZXNzLCBhZGRyZXNzVHlwZSB9KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gIShzZWxlY3RlZEFkZHJlc3Nlc1thZGRyZXNzVHlwZV0gJiYgc2VsZWN0ZWRBZGRyZXNzZXNbYWRkcmVzc1R5cGVdLmhhcyhhZGRyZXNzKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25QYXN0ZSA9IChlOiBSZWFjdC5DbGlwYm9hcmRFdmVudCk6IHZvaWQgPT4ge1xuICAgICAgICAvLyBQcmV2ZW50IHRoZSB0ZXh0IGJlaW5nIHBhc3RlZCBpbnRvIHRoZSB0ZXh0YXJlYVxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IHRleHQgPSBlLmNsaXBib2FyZERhdGEuZ2V0RGF0YShcInRleHRcIik7XG4gICAgICAgIC8vIFByb2Nlc3MgaXQgYXMgYSBsaXN0IG9mIGFkZHJlc3NlcyB0byBhZGQgaW5zdGVhZFxuICAgICAgICB0aGlzLmFkZEFkZHJlc3Nlc1RvTGlzdCh0ZXh0LnNwbGl0KC9bXFxzLF0rLykpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uVXNlRGVmYXVsdElkZW50aXR5U2VydmVyQ2xpY2sgPSAoZTogUmVhY3QuTW91c2VFdmVudCk6IHZvaWQgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBJUyBpbiBhY2NvdW50IGRhdGEuIEFjdHVhbGx5IHVzaW5nIGl0IG1heSB0cmlnZ2VyIHRlcm1zLlxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvcnVsZXMtb2YtaG9va3NcbiAgICAgICAgdXNlRGVmYXVsdElkZW50aXR5U2VydmVyKCk7XG5cbiAgICAgICAgLy8gQWRkIGVtYWlsIGFzIGEgdmFsaWQgYWRkcmVzcyB0eXBlLlxuICAgICAgICBjb25zdCB7IHZhbGlkQWRkcmVzc1R5cGVzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICB2YWxpZEFkZHJlc3NUeXBlcy5wdXNoKEFkZHJlc3NUeXBlLkVtYWlsKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbGlkQWRkcmVzc1R5cGVzIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uTWFuYWdlU2V0dGluZ3NDbGljayA9IChlOiBSZWFjdC5Nb3VzZUV2ZW50KTogdm9pZCA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZGlzLmZpcmUoQWN0aW9uLlZpZXdVc2VyU2V0dGluZ3MpO1xuICAgICAgICB0aGlzLm9uQ2FuY2VsKCk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgbGV0IGlucHV0TGFiZWw7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLmRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICBpbnB1dExhYmVsID0gPGRpdiBjbGFzc05hbWU9XCJteF9BZGRyZXNzUGlja2VyRGlhbG9nX2xhYmVsXCI+XG4gICAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ0ZXh0aW5wdXRcIj57IHRoaXMucHJvcHMuZGVzY3JpcHRpb24gfTwvbGFiZWw+XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBxdWVyeSA9IFtdO1xuICAgICAgICAvLyBjcmVhdGUgdGhlIGludml0ZSBsaXN0XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnNlbGVjdGVkTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc3RhdGUuc2VsZWN0ZWRMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcXVlcnkucHVzaChcbiAgICAgICAgICAgICAgICAgICAgPEFkZHJlc3NUaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk9e2l9XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzPXt0aGlzLnN0YXRlLnNlbGVjdGVkTGlzdFtpXX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbkRpc21pc3M9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkRpc21pc3NlZD17dGhpcy5vbkRpc21pc3NlZChpKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBZGRyZXNzPXt0aGlzLnByb3BzLnBpY2tlclR5cGUgPT09ICd1c2VyJ30gLz4sXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCB0aGUgcXVlcnkgYXQgdGhlIGVuZFxuICAgICAgICBxdWVyeS5wdXNoKFxuICAgICAgICAgICAgPHRleHRhcmVhXG4gICAgICAgICAgICAgICAga2V5PXt0aGlzLnN0YXRlLnNlbGVjdGVkTGlzdC5sZW5ndGh9XG4gICAgICAgICAgICAgICAgb25QYXN0ZT17dGhpcy5vblBhc3RlfVxuICAgICAgICAgICAgICAgIHJvd3M9ezF9XG4gICAgICAgICAgICAgICAgaWQ9XCJ0ZXh0aW5wdXRcIlxuICAgICAgICAgICAgICAgIHJlZj17dGhpcy50ZXh0aW5wdXR9XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfQWRkcmVzc1BpY2tlckRpYWxvZ19pbnB1dFwiXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25RdWVyeUNoYW5nZWR9XG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e3RoaXMuZ2V0UGxhY2Vob2xkZXIoKX1cbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU9e3RoaXMucHJvcHMudmFsdWV9XG4gICAgICAgICAgICAgICAgYXV0b0ZvY3VzPXt0aGlzLnByb3BzLmZvY3VzfVxuICAgICAgICAgICAgLz4sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgZmlsdGVyZWRTdWdnZXN0ZWRMaXN0ID0gdGhpcy5nZXRGaWx0ZXJlZFN1Z2dlc3Rpb25zKCk7XG5cbiAgICAgICAgbGV0IGVycm9yO1xuICAgICAgICBsZXQgYWRkcmVzc1NlbGVjdG9yO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pbnZhbGlkQWRkcmVzc0Vycm9yKSB7XG4gICAgICAgICAgICBjb25zdCB2YWxpZFR5cGVEZXNjcmlwdGlvbnMgPSB0aGlzLnN0YXRlLnZhbGlkQWRkcmVzc1R5cGVzLm1hcCgodCkgPT4gX3QoYWRkcmVzc1R5cGVOYW1lW3RdKSk7XG4gICAgICAgICAgICBlcnJvciA9IDxkaXYgY2xhc3NOYW1lPVwibXhfQWRkcmVzc1BpY2tlckRpYWxvZ19lcnJvclwiPlxuICAgICAgICAgICAgICAgIHsgX3QoXCJZb3UgaGF2ZSBlbnRlcmVkIGFuIGludmFsaWQgYWRkcmVzcy5cIikgfVxuICAgICAgICAgICAgICAgIDxiciAvPlxuICAgICAgICAgICAgICAgIHsgX3QoXCJUcnkgdXNpbmcgb25lIG9mIHRoZSBmb2xsb3dpbmcgdmFsaWQgYWRkcmVzcyB0eXBlczogJSh2YWxpZFR5cGVzTGlzdClzLlwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkVHlwZXNMaXN0OiB2YWxpZFR5cGVEZXNjcmlwdGlvbnMuam9pbihcIiwgXCIpLFxuICAgICAgICAgICAgICAgIH0pIH1cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLnNlYXJjaEVycm9yKSB7XG4gICAgICAgICAgICBlcnJvciA9IDxkaXYgY2xhc3NOYW1lPVwibXhfQWRkcmVzc1BpY2tlckRpYWxvZ19lcnJvclwiPnsgdGhpcy5zdGF0ZS5zZWFyY2hFcnJvciB9PC9kaXY+O1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUucXVlcnkubGVuZ3RoID4gMCAmJiBmaWx0ZXJlZFN1Z2dlc3RlZExpc3QubGVuZ3RoID09PSAwICYmICF0aGlzLnN0YXRlLmJ1c3kpIHtcbiAgICAgICAgICAgIGVycm9yID0gPGRpdiBjbGFzc05hbWU9XCJteF9BZGRyZXNzUGlja2VyRGlhbG9nX2Vycm9yXCI+eyBfdChcIk5vIHJlc3VsdHNcIikgfTwvZGl2PjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFkZHJlc3NTZWxlY3RvciA9IChcbiAgICAgICAgICAgICAgICA8QWRkcmVzc1NlbGVjdG9yIHJlZj17dGhpcy5hZGRyZXNzU2VsZWN0b3J9XG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3NMaXN0PXtmaWx0ZXJlZFN1Z2dlc3RlZExpc3R9XG4gICAgICAgICAgICAgICAgICAgIHNob3dBZGRyZXNzPXt0aGlzLnByb3BzLnBpY2tlclR5cGUgPT09ICd1c2VyJ31cbiAgICAgICAgICAgICAgICAgICAgb25TZWxlY3RlZD17dGhpcy5vblNlbGVjdGVkfVxuICAgICAgICAgICAgICAgICAgICB0cnVuY2F0ZUF0PXtUUlVOQ0FURV9RVUVSWV9MSVNUfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGlkZW50aXR5U2VydmVyO1xuICAgICAgICAvLyBJZiBwaWNrZXIgY2Fubm90IGN1cnJlbnRseSBhY2NlcHQgZS1tYWlsIGJ1dCBzaG91bGQgYmUgYWJsZSB0b1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5waWNrZXJUeXBlID09PSAndXNlcicgJiYgIXRoaXMuc3RhdGUudmFsaWRBZGRyZXNzVHlwZXMuaW5jbHVkZXMoQWRkcmVzc1R5cGUuRW1haWwpXG4gICAgICAgICAgICAmJiB0aGlzLnByb3BzLnZhbGlkQWRkcmVzc1R5cGVzLmluY2x1ZGVzKEFkZHJlc3NUeXBlLkVtYWlsKSkge1xuICAgICAgICAgICAgY29uc3QgZGVmYXVsdElkZW50aXR5U2VydmVyVXJsID0gZ2V0RGVmYXVsdElkZW50aXR5U2VydmVyVXJsKCk7XG4gICAgICAgICAgICBpZiAoZGVmYXVsdElkZW50aXR5U2VydmVyVXJsKSB7XG4gICAgICAgICAgICAgICAgaWRlbnRpdHlTZXJ2ZXIgPSA8ZGl2IGNsYXNzTmFtZT1cIm14X0FkZHJlc3NQaWNrZXJEaWFsb2dfaWRlbnRpdHlTZXJ2ZXJcIj57IF90KFxuICAgICAgICAgICAgICAgICAgICBcIlVzZSBhbiBpZGVudGl0eSBzZXJ2ZXIgdG8gaW52aXRlIGJ5IGVtYWlsLiBcIiArXG4gICAgICAgICAgICAgICAgICAgIFwiPGRlZmF1bHQ+VXNlIHRoZSBkZWZhdWx0ICglKGRlZmF1bHRJZGVudGl0eVNlcnZlck5hbWUpcyk8L2RlZmF1bHQ+IFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJvciBtYW5hZ2UgaW4gPHNldHRpbmdzPlNldHRpbmdzPC9zZXR0aW5ncz4uXCIsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRJZGVudGl0eVNlcnZlck5hbWU6IGFiYnJldmlhdGVVcmwoZGVmYXVsdElkZW50aXR5U2VydmVyVXJsKSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogc3ViID0+IDxhIGhyZWY9XCIjXCIgb25DbGljaz17dGhpcy5vblVzZURlZmF1bHRJZGVudGl0eVNlcnZlckNsaWNrfT57IHN1YiB9PC9hPixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiBzdWIgPT4gPGEgaHJlZj1cIiNcIiBvbkNsaWNrPXt0aGlzLm9uTWFuYWdlU2V0dGluZ3NDbGlja30+eyBzdWIgfTwvYT4sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKSB9PC9kaXY+O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZGVudGl0eVNlcnZlciA9IDxkaXYgY2xhc3NOYW1lPVwibXhfQWRkcmVzc1BpY2tlckRpYWxvZ19pZGVudGl0eVNlcnZlclwiPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiVXNlIGFuIGlkZW50aXR5IHNlcnZlciB0byBpbnZpdGUgYnkgZW1haWwuIFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJNYW5hZ2UgaW4gPHNldHRpbmdzPlNldHRpbmdzPC9zZXR0aW5ncz4uXCIsXG4gICAgICAgICAgICAgICAgICAgIHt9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczogc3ViID0+IDxhIGhyZWY9XCIjXCIgb25DbGljaz17dGhpcy5vbk1hbmFnZVNldHRpbmdzQ2xpY2t9Pnsgc3ViIH08L2E+LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICkgfTwvZGl2PjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZ1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0FkZHJlc3NQaWNrZXJEaWFsb2dcIlxuICAgICAgICAgICAgICAgIG9uS2V5RG93bj17dGhpcy5vbktleURvd259XG4gICAgICAgICAgICAgICAgb25GaW5pc2hlZD17dGhpcy5wcm9wcy5vbkZpbmlzaGVkfVxuICAgICAgICAgICAgICAgIHRpdGxlPXt0aGlzLnByb3BzLnRpdGxlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHsgaW5wdXRMYWJlbCB9XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9EaWFsb2dfY29udGVudFwiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0FkZHJlc3NQaWNrZXJEaWFsb2dfaW5wdXRDb250YWluZXJcIj57IHF1ZXJ5IH08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgeyBlcnJvciB9XG4gICAgICAgICAgICAgICAgICAgIHsgYWRkcmVzc1NlbGVjdG9yIH1cbiAgICAgICAgICAgICAgICAgICAgeyB0aGlzLnByb3BzLmV4dHJhTm9kZSB9XG4gICAgICAgICAgICAgICAgICAgIHsgaWRlbnRpdHlTZXJ2ZXIgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zIHByaW1hcnlCdXR0b249e3RoaXMucHJvcHMuYnV0dG9ufVxuICAgICAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17dGhpcy5vbkJ1dHRvbkNsaWNrfVxuICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbD17dGhpcy5vbkNhbmNlbH0gLz5cbiAgICAgICAgICAgIDwvQmFzZURpYWxvZz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=