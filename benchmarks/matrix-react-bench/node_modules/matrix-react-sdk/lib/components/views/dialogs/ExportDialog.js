"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _languageHandler = require("../../../languageHandler");

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _DialogButtons = _interopRequireDefault(require("../elements/DialogButtons"));

var _Field = _interopRequireDefault(require("../elements/Field"));

var _StyledRadioGroup = _interopRequireDefault(require("../elements/StyledRadioGroup"));

var _StyledCheckbox = _interopRequireDefault(require("../elements/StyledCheckbox"));

var _exportUtils = require("../../../utils/exportUtils/exportUtils");

var _Validation = _interopRequireDefault(require("../elements/Validation"));

var _HtmlExport = _interopRequireDefault(require("../../../utils/exportUtils/HtmlExport"));

var _JSONExport = _interopRequireDefault(require("../../../utils/exportUtils/JSONExport"));

var _PlainTextExport = _interopRequireDefault(require("../../../utils/exportUtils/PlainTextExport"));

var _useStateCallback = require("../../../hooks/useStateCallback");

var _Spinner = _interopRequireDefault(require("../elements/Spinner"));

var _InfoDialog = _interopRequireDefault(require("./InfoDialog"));

var _logger = require("matrix-js-sdk/src/logger");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const ExportDialog = ({
  room,
  onFinished
}) => {
  const [exportFormat, setExportFormat] = (0, _react.useState)(_exportUtils.ExportFormat.Html);
  const [exportType, setExportType] = (0, _react.useState)(_exportUtils.ExportType.Timeline);
  const [includeAttachments, setAttachments] = (0, _react.useState)(false);
  const [isExporting, setExporting] = (0, _react.useState)(false);
  const [numberOfMessages, setNumberOfMessages] = (0, _react.useState)(100);
  const [sizeLimit, setSizeLimit] = (0, _react.useState)(8);
  const sizeLimitRef = (0, _react.useRef)();
  const messageCountRef = (0, _react.useRef)();
  const [exportProgressText, setExportProgressText] = (0, _react.useState)("Processing...");
  const [displayCancel, setCancelWarning] = (0, _react.useState)(false);
  const [exportCancelled, setExportCancelled] = (0, _react.useState)(false);
  const [exportSuccessful, setExportSuccessful] = (0, _react.useState)(false);
  const [exporter, setExporter] = (0, _useStateCallback.useStateCallback)(null, async exporter => {
    await (exporter === null || exporter === void 0 ? void 0 : exporter.export().then(() => {
      if (!exportCancelled) setExportSuccessful(true);
    }));
  });

  const startExport = async () => {
    const exportOptions = {
      numberOfMessages,
      attachmentsIncluded: includeAttachments,
      maxSize: sizeLimit * 1024 * 1024
    };

    switch (exportFormat) {
      case _exportUtils.ExportFormat.Html:
        setExporter(new _HtmlExport.default(room, _exportUtils.ExportType[exportType], exportOptions, setExportProgressText));
        break;

      case _exportUtils.ExportFormat.Json:
        setExporter(new _JSONExport.default(room, _exportUtils.ExportType[exportType], exportOptions, setExportProgressText));
        break;

      case _exportUtils.ExportFormat.PlainText:
        setExporter(new _PlainTextExport.default(room, _exportUtils.ExportType[exportType], exportOptions, setExportProgressText));
        break;

      default:
        _logger.logger.error("Unknown export format");

        return;
    }
  };

  const onExportClick = async () => {
    const isValidSize = await sizeLimitRef.current.validate({
      focused: false
    });

    if (!isValidSize) {
      sizeLimitRef.current.validate({
        focused: true
      });
      return;
    }

    if (exportType === _exportUtils.ExportType.LastNMessages) {
      const isValidNumberOfMessages = await messageCountRef.current.validate({
        focused: false
      });

      if (!isValidNumberOfMessages) {
        messageCountRef.current.validate({
          focused: true
        });
        return;
      }
    }

    setExporting(true);
    await startExport();
  };

  const validateSize = (0, _Validation.default)({
    rules: [{
      key: "required",

      test({
        value,
        allowEmpty
      }) {
        return allowEmpty || !!value;
      },

      invalid: () => {
        const min = 1;
        const max = 10 ** 8;
        return (0, _languageHandler._t)("Enter a number between %(min)s and %(max)s", {
          min,
          max
        });
      }
    }, {
      key: "number",
      test: ({
        value
      }) => {
        const parsedSize = parseFloat(value);
        const min = 1;
        const max = 2000;
        return !(isNaN(parsedSize) || min > parsedSize || parsedSize > max);
      },
      invalid: () => {
        const min = 1;
        const max = 2000;
        return (0, _languageHandler._t)("Size can only be a number between %(min)s MB and %(max)s MB", {
          min,
          max
        });
      }
    }]
  });

  const onValidateSize = async fieldState => {
    const result = await validateSize(fieldState);
    return result;
  };

  const validateNumberOfMessages = (0, _Validation.default)({
    rules: [{
      key: "required",

      test({
        value,
        allowEmpty
      }) {
        return allowEmpty || !!value;
      },

      invalid: () => {
        const min = 1;
        const max = 10 ** 8;
        return (0, _languageHandler._t)("Enter a number between %(min)s and %(max)s", {
          min,
          max
        });
      }
    }, {
      key: "number",
      test: ({
        value
      }) => {
        const parsedSize = parseFloat(value);
        const min = 1;
        const max = 10 ** 8;
        if (isNaN(parsedSize)) return false;
        return !(min > parsedSize || parsedSize > max);
      },
      invalid: () => {
        const min = 1;
        const max = 10 ** 8;
        return (0, _languageHandler._t)("Number of messages can only be a number between %(min)s and %(max)s", {
          min,
          max
        });
      }
    }]
  });

  const onValidateNumberOfMessages = async fieldState => {
    const result = await validateNumberOfMessages(fieldState);
    return result;
  };

  const onCancel = async () => {
    if (isExporting) setCancelWarning(true);else onFinished(false);
  };

  const confirmCanel = async () => {
    await (exporter === null || exporter === void 0 ? void 0 : exporter.cancelExport());
    setExportCancelled(true);
    setExporting(false);
    setExporter(null);
  };

  const exportFormatOptions = Object.keys(_exportUtils.ExportFormat).map(format => ({
    value: _exportUtils.ExportFormat[format],
    label: (0, _exportUtils.textForFormat)(_exportUtils.ExportFormat[format])
  }));
  const exportTypeOptions = Object.keys(_exportUtils.ExportType).map(type => {
    return /*#__PURE__*/_react.default.createElement("option", {
      key: type,
      value: _exportUtils.ExportType[type]
    }, (0, _exportUtils.textForType)(_exportUtils.ExportType[type]));
  });
  let messageCount = null;

  if (exportType === _exportUtils.ExportType.LastNMessages) {
    messageCount = /*#__PURE__*/_react.default.createElement(_Field.default, {
      element: "input",
      type: "number",
      value: numberOfMessages.toString(),
      ref: messageCountRef,
      onValidate: onValidateNumberOfMessages,
      label: (0, _languageHandler._t)("Number of messages"),
      onChange: e => {
        setNumberOfMessages(parseInt(e.target.value));
      }
    });
  }

  const sizePostFix = /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("MB"));

  if (exportCancelled) {
    // Display successful cancellation message
    return /*#__PURE__*/_react.default.createElement(_InfoDialog.default, {
      title: (0, _languageHandler._t)("Export Successful"),
      description: (0, _languageHandler._t)("The export was cancelled successfully"),
      hasCloseButton: true,
      onFinished: onFinished
    });
  } else if (exportSuccessful) {
    // Display successful export message
    return /*#__PURE__*/_react.default.createElement(_InfoDialog.default, {
      title: (0, _languageHandler._t)("Export Successful"),
      description: (0, _languageHandler._t)("Your export was successful. Find it in your Downloads folder."),
      hasCloseButton: true,
      onFinished: onFinished
    });
  } else if (displayCancel) {
    // Display cancel warning
    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      title: (0, _languageHandler._t)("Warning"),
      className: "mx_ExportDialog",
      contentId: "mx_Dialog_content",
      onFinished: onFinished,
      fixedWidth: true
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Are you sure you want to stop exporting your data? If you do, you'll need to start over.")), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)("Stop"),
      primaryButtonClass: "danger",
      hasCancel: true,
      cancelButton: (0, _languageHandler._t)("Continue"),
      onCancel: () => setCancelWarning(false),
      onPrimaryButtonClick: confirmCanel
    }));
  } else {
    // Display export settings
    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      title: isExporting ? (0, _languageHandler._t)("Exporting your data") : (0, _languageHandler._t)("Export Chat"),
      className: `mx_ExportDialog ${isExporting && "mx_ExportDialog_Exporting"}`,
      contentId: "mx_Dialog_content",
      hasCancel: true,
      onFinished: onFinished,
      fixedWidth: true
    }, !isExporting ? /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Select from the options below to export chats from your timeline")) : null, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_ExportDialog_subheading"
    }, (0, _languageHandler._t)("Format")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ExportDialog_options"
    }, /*#__PURE__*/_react.default.createElement(_StyledRadioGroup.default, {
      name: "exportFormat",
      value: exportFormat,
      onChange: key => setExportFormat(_exportUtils.ExportFormat[key]),
      definitions: exportFormatOptions
    }), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_ExportDialog_subheading"
    }, (0, _languageHandler._t)("Messages")), /*#__PURE__*/_react.default.createElement(_Field.default, {
      element: "select",
      value: exportType,
      onChange: e => {
        setExportType(_exportUtils.ExportType[e.target.value]);
      }
    }, exportTypeOptions), messageCount, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_ExportDialog_subheading"
    }, (0, _languageHandler._t)("Size Limit")), /*#__PURE__*/_react.default.createElement(_Field.default, {
      type: "number",
      autoComplete: "off",
      onValidate: onValidateSize,
      element: "input",
      ref: sizeLimitRef,
      value: sizeLimit.toString(),
      postfixComponent: sizePostFix,
      onChange: e => setSizeLimit(parseInt(e.target.value))
    }), /*#__PURE__*/_react.default.createElement(_StyledCheckbox.default, {
      checked: includeAttachments,
      onChange: e => setAttachments(e.target.checked)
    }, (0, _languageHandler._t)("Include Attachments"))), isExporting ? /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ExportDialog_progress"
    }, /*#__PURE__*/_react.default.createElement(_Spinner.default, {
      w: 24,
      h: 24
    }), /*#__PURE__*/_react.default.createElement("p", null, exportProgressText), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)("Cancel"),
      primaryButtonClass: "danger",
      hasCancel: false,
      onPrimaryButtonClick: onCancel
    })) : /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)("Export"),
      onPrimaryButtonClick: onExportClick,
      onCancel: () => onFinished(false)
    }));
  }
};

var _default = ExportDialog;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvRXhwb3J0RGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJFeHBvcnREaWFsb2ciLCJyb29tIiwib25GaW5pc2hlZCIsImV4cG9ydEZvcm1hdCIsInNldEV4cG9ydEZvcm1hdCIsIkV4cG9ydEZvcm1hdCIsIkh0bWwiLCJleHBvcnRUeXBlIiwic2V0RXhwb3J0VHlwZSIsIkV4cG9ydFR5cGUiLCJUaW1lbGluZSIsImluY2x1ZGVBdHRhY2htZW50cyIsInNldEF0dGFjaG1lbnRzIiwiaXNFeHBvcnRpbmciLCJzZXRFeHBvcnRpbmciLCJudW1iZXJPZk1lc3NhZ2VzIiwic2V0TnVtYmVyT2ZNZXNzYWdlcyIsInNpemVMaW1pdCIsInNldFNpemVMaW1pdCIsInNpemVMaW1pdFJlZiIsIm1lc3NhZ2VDb3VudFJlZiIsImV4cG9ydFByb2dyZXNzVGV4dCIsInNldEV4cG9ydFByb2dyZXNzVGV4dCIsImRpc3BsYXlDYW5jZWwiLCJzZXRDYW5jZWxXYXJuaW5nIiwiZXhwb3J0Q2FuY2VsbGVkIiwic2V0RXhwb3J0Q2FuY2VsbGVkIiwiZXhwb3J0U3VjY2Vzc2Z1bCIsInNldEV4cG9ydFN1Y2Nlc3NmdWwiLCJleHBvcnRlciIsInNldEV4cG9ydGVyIiwiZXhwb3J0IiwidGhlbiIsInN0YXJ0RXhwb3J0IiwiZXhwb3J0T3B0aW9ucyIsImF0dGFjaG1lbnRzSW5jbHVkZWQiLCJtYXhTaXplIiwiSFRNTEV4cG9ydGVyIiwiSnNvbiIsIkpTT05FeHBvcnRlciIsIlBsYWluVGV4dCIsIlBsYWluVGV4dEV4cG9ydGVyIiwibG9nZ2VyIiwiZXJyb3IiLCJvbkV4cG9ydENsaWNrIiwiaXNWYWxpZFNpemUiLCJjdXJyZW50IiwidmFsaWRhdGUiLCJmb2N1c2VkIiwiTGFzdE5NZXNzYWdlcyIsImlzVmFsaWROdW1iZXJPZk1lc3NhZ2VzIiwidmFsaWRhdGVTaXplIiwicnVsZXMiLCJrZXkiLCJ0ZXN0IiwidmFsdWUiLCJhbGxvd0VtcHR5IiwiaW52YWxpZCIsIm1pbiIsIm1heCIsInBhcnNlZFNpemUiLCJwYXJzZUZsb2F0IiwiaXNOYU4iLCJvblZhbGlkYXRlU2l6ZSIsImZpZWxkU3RhdGUiLCJyZXN1bHQiLCJ2YWxpZGF0ZU51bWJlck9mTWVzc2FnZXMiLCJvblZhbGlkYXRlTnVtYmVyT2ZNZXNzYWdlcyIsIm9uQ2FuY2VsIiwiY29uZmlybUNhbmVsIiwiY2FuY2VsRXhwb3J0IiwiZXhwb3J0Rm9ybWF0T3B0aW9ucyIsIk9iamVjdCIsImtleXMiLCJtYXAiLCJmb3JtYXQiLCJsYWJlbCIsImV4cG9ydFR5cGVPcHRpb25zIiwidHlwZSIsIm1lc3NhZ2VDb3VudCIsInRvU3RyaW5nIiwiZSIsInBhcnNlSW50IiwidGFyZ2V0Iiwic2l6ZVBvc3RGaXgiLCJjaGVja2VkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFnQkE7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBTUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBRUE7Ozs7OztBQXhDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFnQ0EsTUFBTUEsWUFBOEIsR0FBRyxDQUFDO0FBQUVDLEVBQUFBLElBQUY7QUFBUUMsRUFBQUE7QUFBUixDQUFELEtBQTBCO0FBQzdELFFBQU0sQ0FBQ0MsWUFBRCxFQUFlQyxlQUFmLElBQWtDLHFCQUFTQywwQkFBYUMsSUFBdEIsQ0FBeEM7QUFDQSxRQUFNLENBQUNDLFVBQUQsRUFBYUMsYUFBYixJQUE4QixxQkFBU0Msd0JBQVdDLFFBQXBCLENBQXBDO0FBQ0EsUUFBTSxDQUFDQyxrQkFBRCxFQUFxQkMsY0FBckIsSUFBdUMscUJBQVMsS0FBVCxDQUE3QztBQUNBLFFBQU0sQ0FBQ0MsV0FBRCxFQUFjQyxZQUFkLElBQThCLHFCQUFTLEtBQVQsQ0FBcEM7QUFDQSxRQUFNLENBQUNDLGdC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LEVBQUdzRSxDQUFELElBQ05yRSxjQUFjLENBQ1RxRSxDQUFDLENBQUNFLE1BQUgsQ0FBK0JFLE9BRHJCO0FBSHRCLE9BUU0seUJBQUcscUJBQUgsQ0FSTixDQXRDSixDQWxCSixFQW1FTXhFLFdBQVcsZ0JBQ1Q7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLG9CQUNJLDZCQUFDLGdCQUFEO0FBQVMsTUFBQSxDQUFDLEVBQUUsRUFBWjtBQUFnQixNQUFBLENBQUMsRUFBRTtBQUFuQixNQURKLGVBRUksd0NBQ01RLGtCQUROLENBRkosZUFLSSw2QkFBQyxzQkFBRDtBQUNJLE1BQUEsYUFBYSxFQUFFLHlCQUFHLFFBQUgsQ0FEbkI7QUFFSSxNQUFBLGtCQUFrQixFQUFDLFFBRnZCO0FBR0ksTUFBQSxTQUFTLEVBQUUsS0FIZjtBQUlJLE1BQUEsb0JBQW9CLEVBQUUrQztBQUoxQixNQUxKLENBRFMsZ0JBY1QsNkJBQUMsc0JBQUQ7QUFDSSxNQUFBLGFBQWEsRUFBRSx5QkFBRyxRQUFILENBRG5CO0FBRUksTUFBQSxvQkFBb0IsRUFBRXhCLGFBRjFCO0FBR0ksTUFBQSxRQUFRLEVBQUUsTUFBTTFDLFVBQVUsQ0FBQyxLQUFEO0FBSDlCLE1BakZSLENBREo7QUEwRkg7QUFDSixDQTlWRDs7ZUFnV2VGLFkiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyY1wiO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgeyBJRGlhbG9nUHJvcHMgfSBmcm9tIFwiLi9JRGlhbG9nUHJvcHNcIjtcbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gXCIuL0Jhc2VEaWFsb2dcIjtcbmltcG9ydCBEaWFsb2dCdXR0b25zIGZyb20gXCIuLi9lbGVtZW50cy9EaWFsb2dCdXR0b25zXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcIi4uL2VsZW1lbnRzL0ZpZWxkXCI7XG5pbXBvcnQgU3R5bGVkUmFkaW9Hcm91cCBmcm9tIFwiLi4vZWxlbWVudHMvU3R5bGVkUmFkaW9Hcm91cFwiO1xuaW1wb3J0IFN0eWxlZENoZWNrYm94IGZyb20gXCIuLi9lbGVtZW50cy9TdHlsZWRDaGVja2JveFwiO1xuaW1wb3J0IHtcbiAgICBFeHBvcnRGb3JtYXQsXG4gICAgRXhwb3J0VHlwZSxcbiAgICB0ZXh0Rm9yRm9ybWF0LFxuICAgIHRleHRGb3JUeXBlLFxufSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvZXhwb3J0VXRpbHMvZXhwb3J0VXRpbHNcIjtcbmltcG9ydCB3aXRoVmFsaWRhdGlvbiwgeyBJRmllbGRTdGF0ZSwgSVZhbGlkYXRpb25SZXN1bHQgfSBmcm9tIFwiLi4vZWxlbWVudHMvVmFsaWRhdGlvblwiO1xuaW1wb3J0IEhUTUxFeHBvcnRlciBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvZXhwb3J0VXRpbHMvSHRtbEV4cG9ydFwiO1xuaW1wb3J0IEpTT05FeHBvcnRlciBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvZXhwb3J0VXRpbHMvSlNPTkV4cG9ydFwiO1xuaW1wb3J0IFBsYWluVGV4dEV4cG9ydGVyIGZyb20gXCIuLi8uLi8uLi91dGlscy9leHBvcnRVdGlscy9QbGFpblRleHRFeHBvcnRcIjtcbmltcG9ydCB7IHVzZVN0YXRlQ2FsbGJhY2sgfSBmcm9tIFwiLi4vLi4vLi4vaG9va3MvdXNlU3RhdGVDYWxsYmFja1wiO1xuaW1wb3J0IEV4cG9ydGVyIGZyb20gXCIuLi8uLi8uLi91dGlscy9leHBvcnRVdGlscy9FeHBvcnRlclwiO1xuaW1wb3J0IFNwaW5uZXIgZnJvbSBcIi4uL2VsZW1lbnRzL1NwaW5uZXJcIjtcbmltcG9ydCBJbmZvRGlhbG9nIGZyb20gXCIuL0luZm9EaWFsb2dcIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIGV4dGVuZHMgSURpYWxvZ1Byb3BzIHtcbiAgICByb29tOiBSb29tO1xufVxuXG5jb25zdCBFeHBvcnREaWFsb2c6IFJlYWN0LkZDPElQcm9wcz4gPSAoeyByb29tLCBvbkZpbmlzaGVkIH0pID0+IHtcbiAgICBjb25zdCBbZXhwb3J0Rm9ybWF0LCBzZXRFeHBvcnRGb3JtYXRdID0gdXNlU3RhdGUoRXhwb3J0Rm9ybWF0Lkh0bWwpO1xuICAgIGNvbnN0IFtleHBvcnRUeXBlLCBzZXRFeHBvcnRUeXBlXSA9IHVzZVN0YXRlKEV4cG9ydFR5cGUuVGltZWxpbmUpO1xuICAgIGNvbnN0IFtpbmNsdWRlQXR0YWNobWVudHMsIHNldEF0dGFjaG1lbnRzXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbaXNFeHBvcnRpbmcsIHNldEV4cG9ydGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW251bWJlck9mTWVzc2FnZXMsIHNldE51bWJlck9mTWVzc2FnZXNdID0gdXNlU3RhdGU8bnVtYmVyPigxMDApO1xuICAgIGNvbnN0IFtzaXplTGltaXQsIHNldFNpemVMaW1pdF0gPSB1c2VTdGF0ZTxudW1iZXIgfCBudWxsPig4KTtcbiAgICBjb25zdCBzaXplTGltaXRSZWYgPSB1c2VSZWY8RmllbGQ+KCk7XG4gICAgY29uc3QgbWVzc2FnZUNvdW50UmVmID0gdXNlUmVmPEZpZWxkPigpO1xuICAgIGNvbnN0IFtleHBvcnRQcm9ncmVzc1RleHQsIHNldEV4cG9ydFByb2dyZXNzVGV4dF0gPSB1c2VTdGF0ZShcIlByb2Nlc3NpbmcuLi5cIik7XG4gICAgY29uc3QgW2Rpc3BsYXlDYW5jZWwsIHNldENhbmNlbFdhcm5pbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtleHBvcnRDYW5jZWxsZWQsIHNldEV4cG9ydENhbmNlbGxlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2V4cG9ydFN1Y2Nlc3NmdWwsIHNldEV4cG9ydFN1Y2Nlc3NmdWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtleHBvcnRlciwgc2V0RXhwb3J0ZXJdID0gdXNlU3RhdGVDYWxsYmFjazxFeHBvcnRlcj4oXG4gICAgICAgIG51bGwsXG4gICAgICAgIGFzeW5jIChleHBvcnRlcjogRXhwb3J0ZXIpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IGV4cG9ydGVyPy5leHBvcnQoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWV4cG9ydENhbmNlbGxlZCkgc2V0RXhwb3J0U3VjY2Vzc2Z1bCh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICk7XG5cbiAgICBjb25zdCBzdGFydEV4cG9ydCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZXhwb3J0T3B0aW9ucyA9IHtcbiAgICAgICAgICAgIG51bWJlck9mTWVzc2FnZXMsXG4gICAgICAgICAgICBhdHRhY2htZW50c0luY2x1ZGVkOiBpbmNsdWRlQXR0YWNobWVudHMsXG4gICAgICAgICAgICBtYXhTaXplOiBzaXplTGltaXQgKiAxMDI0ICogMTAyNCxcbiAgICAgICAgfTtcbiAgICAgICAgc3dpdGNoIChleHBvcnRGb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgRXhwb3J0Rm9ybWF0Lkh0bWw6XG4gICAgICAgICAgICAgICAgc2V0RXhwb3J0ZXIoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBIVE1MRXhwb3J0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICByb29tLFxuICAgICAgICAgICAgICAgICAgICAgICAgRXhwb3J0VHlwZVtleHBvcnRUeXBlXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydE9wdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRFeHBvcnRQcm9ncmVzc1RleHQsXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRXhwb3J0Rm9ybWF0Lkpzb246XG4gICAgICAgICAgICAgICAgc2V0RXhwb3J0ZXIoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBKU09ORXhwb3J0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICByb29tLFxuICAgICAgICAgICAgICAgICAgICAgICAgRXhwb3J0VHlwZVtleHBvcnRUeXBlXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydE9wdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRFeHBvcnRQcm9ncmVzc1RleHQsXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRXhwb3J0Rm9ybWF0LlBsYWluVGV4dDpcbiAgICAgICAgICAgICAgICBzZXRFeHBvcnRlcihcbiAgICAgICAgICAgICAgICAgICAgbmV3IFBsYWluVGV4dEV4cG9ydGVyKFxuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIEV4cG9ydFR5cGVbZXhwb3J0VHlwZV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRPcHRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0RXhwb3J0UHJvZ3Jlc3NUZXh0LFxuICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcIlVua25vd24gZXhwb3J0IGZvcm1hdFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3Qgb25FeHBvcnRDbGljayA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgaXNWYWxpZFNpemUgPSBhd2FpdCBzaXplTGltaXRSZWYuY3VycmVudC52YWxpZGF0ZSh7XG4gICAgICAgICAgICBmb2N1c2VkOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghaXNWYWxpZFNpemUpIHtcbiAgICAgICAgICAgIHNpemVMaW1pdFJlZi5jdXJyZW50LnZhbGlkYXRlKHsgZm9jdXNlZDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXhwb3J0VHlwZSA9PT0gRXhwb3J0VHlwZS5MYXN0Tk1lc3NhZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCBpc1ZhbGlkTnVtYmVyT2ZNZXNzYWdlcyA9XG4gICAgICAgICAgICAgICAgYXdhaXQgbWVzc2FnZUNvdW50UmVmLmN1cnJlbnQudmFsaWRhdGUoeyBmb2N1c2VkOiBmYWxzZSB9KTtcbiAgICAgICAgICAgIGlmICghaXNWYWxpZE51bWJlck9mTWVzc2FnZXMpIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlQ291bnRSZWYuY3VycmVudC52YWxpZGF0ZSh7IGZvY3VzZWQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNldEV4cG9ydGluZyh0cnVlKTtcbiAgICAgICAgYXdhaXQgc3RhcnRFeHBvcnQoKTtcbiAgICB9O1xuXG4gICAgY29uc3QgdmFsaWRhdGVTaXplID0gd2l0aFZhbGlkYXRpb24oe1xuICAgICAgICBydWxlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogXCJyZXF1aXJlZFwiLFxuICAgICAgICAgICAgICAgIHRlc3QoeyB2YWx1ZSwgYWxsb3dFbXB0eSB9KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGxvd0VtcHR5IHx8ICEhdmFsdWU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heCA9IDEwICoqIDg7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdChcIkVudGVyIGEgbnVtYmVyIGJldHdlZW4gJShtaW4pcyBhbmQgJShtYXgpc1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaW4sXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXgsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAga2V5OiBcIm51bWJlclwiLFxuICAgICAgICAgICAgICAgIHRlc3Q6ICh7IHZhbHVlIH0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkU2l6ZSA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW4gPSAxO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSAyMDAwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIShpc05hTihwYXJzZWRTaXplKSB8fCBtaW4gPiBwYXJzZWRTaXplIHx8IHBhcnNlZFNpemUgPiBtYXgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW52YWxpZDogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW4gPSAxO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSAyMDAwO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlNpemUgY2FuIG9ubHkgYmUgYSBudW1iZXIgYmV0d2VlbiAlKG1pbilzIE1CIGFuZCAlKG1heClzIE1CXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IG1pbiwgbWF4IH0sXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBvblZhbGlkYXRlU2l6ZSA9IGFzeW5jIChmaWVsZFN0YXRlOiBJRmllbGRTdGF0ZSk6IFByb21pc2U8SVZhbGlkYXRpb25SZXN1bHQ+ID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVTaXplKGZpZWxkU3RhdGUpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICBjb25zdCB2YWxpZGF0ZU51bWJlck9mTWVzc2FnZXMgPSB3aXRoVmFsaWRhdGlvbih7XG4gICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAga2V5OiBcInJlcXVpcmVkXCIsXG4gICAgICAgICAgICAgICAgdGVzdCh7IHZhbHVlLCBhbGxvd0VtcHR5IH0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbG93RW1wdHkgfHwgISF2YWx1ZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGludmFsaWQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWluID0gMTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4ID0gMTAgKiogODtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90KFwiRW50ZXIgYSBudW1iZXIgYmV0d2VlbiAlKG1pbilzIGFuZCAlKG1heClzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heCxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBrZXk6IFwibnVtYmVyXCIsXG4gICAgICAgICAgICAgICAgdGVzdDogKHsgdmFsdWUgfSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWRTaXplID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heCA9IDEwICoqIDg7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihwYXJzZWRTaXplKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIShtaW4gPiBwYXJzZWRTaXplIHx8IHBhcnNlZFNpemUgPiBtYXgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW52YWxpZDogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW4gPSAxO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSAxMCAqKiA4O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIk51bWJlciBvZiBtZXNzYWdlcyBjYW4gb25seSBiZSBhIG51bWJlciBiZXR3ZWVuICUobWluKXMgYW5kICUobWF4KXNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbWluLCBtYXggfSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IG9uVmFsaWRhdGVOdW1iZXJPZk1lc3NhZ2VzID0gYXN5bmMgKGZpZWxkU3RhdGU6IElGaWVsZFN0YXRlKTogUHJvbWlzZTxJVmFsaWRhdGlvblJlc3VsdD4gPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZU51bWJlck9mTWVzc2FnZXMoZmllbGRTdGF0ZSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIGNvbnN0IG9uQ2FuY2VsID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoaXNFeHBvcnRpbmcpIHNldENhbmNlbFdhcm5pbmcodHJ1ZSk7XG4gICAgICAgIGVsc2Ugb25GaW5pc2hlZChmYWxzZSk7XG4gICAgfTtcblxuICAgIGNvbnN0IGNvbmZpcm1DYW5lbCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZXhwb3J0ZXI/LmNhbmNlbEV4cG9ydCgpO1xuICAgICAgICBzZXRFeHBvcnRDYW5jZWxsZWQodHJ1ZSk7XG4gICAgICAgIHNldEV4cG9ydGluZyhmYWxzZSk7XG4gICAgICAgIHNldEV4cG9ydGVyKG51bGwpO1xuICAgIH07XG5cbiAgICBjb25zdCBleHBvcnRGb3JtYXRPcHRpb25zID0gT2JqZWN0LmtleXMoRXhwb3J0Rm9ybWF0KS5tYXAoKGZvcm1hdCkgPT4gKHtcbiAgICAgICAgdmFsdWU6IEV4cG9ydEZvcm1hdFtmb3JtYXRdLFxuICAgICAgICBsYWJlbDogdGV4dEZvckZvcm1hdChFeHBvcnRGb3JtYXRbZm9ybWF0XSksXG4gICAgfSkpO1xuXG4gICAgY29uc3QgZXhwb3J0VHlwZU9wdGlvbnMgPSBPYmplY3Qua2V5cyhFeHBvcnRUeXBlKS5tYXAoKHR5cGUpID0+IHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxvcHRpb24ga2V5PXt0eXBlfSB2YWx1ZT17RXhwb3J0VHlwZVt0eXBlXX0+XG4gICAgICAgICAgICAgICAgeyB0ZXh0Rm9yVHlwZShFeHBvcnRUeXBlW3R5cGVdKSB9XG4gICAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgKTtcbiAgICB9KTtcblxuICAgIGxldCBtZXNzYWdlQ291bnQgPSBudWxsO1xuICAgIGlmIChleHBvcnRUeXBlID09PSBFeHBvcnRUeXBlLkxhc3ROTWVzc2FnZXMpIHtcbiAgICAgICAgbWVzc2FnZUNvdW50ID0gKFxuICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgZWxlbWVudD1cImlucHV0XCJcbiAgICAgICAgICAgICAgICB0eXBlPVwibnVtYmVyXCJcbiAgICAgICAgICAgICAgICB2YWx1ZT17bnVtYmVyT2ZNZXNzYWdlcy50b1N0cmluZygpfVxuICAgICAgICAgICAgICAgIHJlZj17bWVzc2FnZUNvdW50UmVmfVxuICAgICAgICAgICAgICAgIG9uVmFsaWRhdGU9e29uVmFsaWRhdGVOdW1iZXJPZk1lc3NhZ2VzfVxuICAgICAgICAgICAgICAgIGxhYmVsPXtfdChcIk51bWJlciBvZiBtZXNzYWdlc1wiKX1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2V0TnVtYmVyT2ZNZXNzYWdlcyhwYXJzZUludChlLnRhcmdldC52YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAvPlxuICAgICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHNpemVQb3N0Rml4ID0gPHNwYW4+eyBfdChcIk1CXCIpIH08L3NwYW4+O1xuXG4gICAgaWYgKGV4cG9ydENhbmNlbGxlZCkge1xuICAgICAgICAvLyBEaXNwbGF5IHN1Y2Nlc3NmdWwgY2FuY2VsbGF0aW9uIG1lc3NhZ2VcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxJbmZvRGlhbG9nXG4gICAgICAgICAgICAgICAgdGl0bGU9e190KFwiRXhwb3J0IFN1Y2Nlc3NmdWxcIil9XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb249e190KFwiVGhlIGV4cG9ydCB3YXMgY2FuY2VsbGVkIHN1Y2Nlc3NmdWxseVwiKX1cbiAgICAgICAgICAgICAgICBoYXNDbG9zZUJ1dHRvbj17dHJ1ZX1cbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXtvbkZpbmlzaGVkfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKGV4cG9ydFN1Y2Nlc3NmdWwpIHtcbiAgICAgICAgLy8gRGlzcGxheSBzdWNjZXNzZnVsIGV4cG9ydCBtZXNzYWdlXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8SW5mb0RpYWxvZ1xuICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcIkV4cG9ydCBTdWNjZXNzZnVsXCIpfVxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPXtfdChcbiAgICAgICAgICAgICAgICAgICAgXCJZb3VyIGV4cG9ydCB3YXMgc3VjY2Vzc2Z1bC4gRmluZCBpdCBpbiB5b3VyIERvd25sb2FkcyBmb2xkZXIuXCIsXG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICBoYXNDbG9zZUJ1dHRvbj17dHJ1ZX1cbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXtvbkZpbmlzaGVkfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKGRpc3BsYXlDYW5jZWwpIHtcbiAgICAgICAgLy8gRGlzcGxheSBjYW5jZWwgd2FybmluZ1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEJhc2VEaWFsb2dcbiAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJXYXJuaW5nXCIpfVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0V4cG9ydERpYWxvZ1wiXG4gICAgICAgICAgICAgICAgY29udGVudElkPVwibXhfRGlhbG9nX2NvbnRlbnRcIlxuICAgICAgICAgICAgICAgIG9uRmluaXNoZWQ9e29uRmluaXNoZWR9XG4gICAgICAgICAgICAgICAgZml4ZWRXaWR0aD17dHJ1ZX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHN0b3AgZXhwb3J0aW5nIHlvdXIgZGF0YT8gSWYgeW91IGRvLCB5b3UnbGwgbmVlZCB0byBzdGFydCBvdmVyLlwiLFxuICAgICAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgPERpYWxvZ0J1dHRvbnNcbiAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbj17X3QoXCJTdG9wXCIpfVxuICAgICAgICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uQ2xhc3M9XCJkYW5nZXJcIlxuICAgICAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbj17X3QoXCJDb250aW51ZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw9eygpID0+IHNldENhbmNlbFdhcm5pbmcoZmFsc2UpfVxuICAgICAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17Y29uZmlybUNhbmVsfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L0Jhc2VEaWFsb2c+XG4gICAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRGlzcGxheSBleHBvcnQgc2V0dGluZ3NcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxCYXNlRGlhbG9nXG4gICAgICAgICAgICAgICAgdGl0bGU9e2lzRXhwb3J0aW5nID8gX3QoXCJFeHBvcnRpbmcgeW91ciBkYXRhXCIpIDogX3QoXCJFeHBvcnQgQ2hhdFwiKX1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2BteF9FeHBvcnREaWFsb2cgJHtpc0V4cG9ydGluZyAmJiBcIm14X0V4cG9ydERpYWxvZ19FeHBvcnRpbmdcIn1gfVxuICAgICAgICAgICAgICAgIGNvbnRlbnRJZD1cIm14X0RpYWxvZ19jb250ZW50XCJcbiAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e3RydWV9XG4gICAgICAgICAgICAgICAgb25GaW5pc2hlZD17b25GaW5pc2hlZH1cbiAgICAgICAgICAgICAgICBmaXhlZFdpZHRoPXt0cnVlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHsgIWlzRXhwb3J0aW5nID8gPHA+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlNlbGVjdCBmcm9tIHRoZSBvcHRpb25zIGJlbG93IHRvIGV4cG9ydCBjaGF0cyBmcm9tIHlvdXIgdGltZWxpbmVcIixcbiAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgPC9wPiA6IG51bGwgfVxuXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfRXhwb3J0RGlhbG9nX3N1YmhlYWRpbmdcIj5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcIkZvcm1hdFwiKSB9XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9FeHBvcnREaWFsb2dfb3B0aW9uc1wiPlxuICAgICAgICAgICAgICAgICAgICA8U3R5bGVkUmFkaW9Hcm91cFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1cImV4cG9ydEZvcm1hdFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17ZXhwb3J0Rm9ybWF0fVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhrZXkpID0+IHNldEV4cG9ydEZvcm1hdChFeHBvcnRGb3JtYXRba2V5XSl9XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZpbml0aW9ucz17ZXhwb3J0Rm9ybWF0T3B0aW9uc31cbiAgICAgICAgICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9FeHBvcnREaWFsb2dfc3ViaGVhZGluZ1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIk1lc3NhZ2VzXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuXG4gICAgICAgICAgICAgICAgICAgIDxGaWVsZFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudD1cInNlbGVjdFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17ZXhwb3J0VHlwZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEV4cG9ydFR5cGUoRXhwb3J0VHlwZVtlLnRhcmdldC52YWx1ZV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBleHBvcnRUeXBlT3B0aW9ucyB9XG4gICAgICAgICAgICAgICAgICAgIDwvRmllbGQ+XG4gICAgICAgICAgICAgICAgICAgIHsgbWVzc2FnZUNvdW50IH1cblxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9FeHBvcnREaWFsb2dfc3ViaGVhZGluZ1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIlNpemUgTGltaXRcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG5cbiAgICAgICAgICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwibnVtYmVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Db21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICAgICAgICAgICAgICBvblZhbGlkYXRlPXtvblZhbGlkYXRlU2l6ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ9XCJpbnB1dFwiXG4gICAgICAgICAgICAgICAgICAgICAgICByZWY9e3NpemVMaW1pdFJlZn1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtzaXplTGltaXQudG9TdHJpbmcoKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RmaXhDb21wb25lbnQ9e3NpemVQb3N0Rml4fVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRTaXplTGltaXQocGFyc2VJbnQoZS50YXJnZXQudmFsdWUpKX1cbiAgICAgICAgICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgICAgICAgICA8U3R5bGVkQ2hlY2tib3hcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e2luY2x1ZGVBdHRhY2htZW50c31cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRBdHRhY2htZW50cyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLmNoZWNrZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiSW5jbHVkZSBBdHRhY2htZW50c1wiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvU3R5bGVkQ2hlY2tib3g+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgeyBpc0V4cG9ydGluZyA/IChcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9FeHBvcnREaWFsb2dfcHJvZ3Jlc3NcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxTcGlubmVyIHc9ezI0fSBoPXsyNH0gLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgZXhwb3J0UHJvZ3Jlc3NUZXh0IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbj17X3QoXCJDYW5jZWxcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbkNsYXNzPVwiZGFuZ2VyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJpbWFyeUJ1dHRvbkNsaWNrPXtvbkNhbmNlbH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5QnV0dG9uPXtfdChcIkV4cG9ydFwiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJpbWFyeUJ1dHRvbkNsaWNrPXtvbkV4cG9ydENsaWNrfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw9eygpID0+IG9uRmluaXNoZWQoZmFsc2UpfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgPC9CYXNlRGlhbG9nPlxuICAgICAgICApO1xuICAgIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IEV4cG9ydERpYWxvZztcbiJdfQ==