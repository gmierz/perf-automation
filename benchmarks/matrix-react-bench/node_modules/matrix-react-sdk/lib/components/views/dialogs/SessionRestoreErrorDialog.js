"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _languageHandler = require("../../../languageHandler");

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _QuestionDialog = _interopRequireDefault(require("./QuestionDialog"));

var _BugReportDialog = _interopRequireDefault(require("./BugReportDialog"));

var _BaseDialog = _interopRequireDefault(require("./BaseDialog"));

var _DialogButtons = _interopRequireDefault(require("../elements/DialogButtons"));

var _dec, _class;

let SessionRestoreErrorDialog = (_dec = (0, _replaceableComponent.replaceableComponent)("views.dialogs.SessionRestoreErrorDialog"), _dec(_class = class SessionRestoreErrorDialog extends _react.default.Component {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "sendBugReport", () => {
      _Modal.default.createTrackedDialog('Session Restore Error', 'Send Bug Report Dialog', _BugReportDialog.default, {
        error: this.props.error
      });
    });
    (0, _defineProperty2.default)(this, "onClearStorageClick", () => {
      _Modal.default.createTrackedDialog('Session Restore Confirm Logout', '', _QuestionDialog.default, {
        title: (0, _languageHandler._t)("Sign out"),
        description: /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Sign out and remove encryption keys?")),
        button: (0, _languageHandler._t)("Sign out"),
        danger: true,
        onFinished: this.props.onFinished
      });
    });
    (0, _defineProperty2.default)(this, "onRefreshClick", () => {
      // Is this likely to help? Probably not, but giving only one button
      // that clears your storage seems awful.
      window.location.reload();
    });
  }

  render() {
    const brand = _SdkConfig.default.get().brand;

    const clearStorageButton = /*#__PURE__*/_react.default.createElement("button", {
      onClick: this.onClearStorageClick,
      className: "danger"
    }, (0, _languageHandler._t)("Clear Storage and Sign Out"));

    let dialogButtons;

    if (_SdkConfig.default.get().bug_report_endpoint_url) {
      dialogButtons = /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
        primaryButton: (0, _languageHandler._t)("Send Logs"),
        onPrimaryButtonClick: this.sendBugReport,
        focus: true,
        hasCancel: false
      }, clearStorageButton);
    } else {
      dialogButtons = /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
        primaryButton: (0, _languageHandler._t)("Refresh"),
        onPrimaryButtonClick: this.onRefreshClick,
        focus: true,
        hasCancel: false
      }, clearStorageButton);
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_ErrorDialog",
      onFinished: this.props.onFinished,
      title: (0, _languageHandler._t)('Unable to restore session'),
      contentId: "mx_Dialog_content",
      hasCancel: false
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Dialog_content",
      id: "mx_Dialog_content"
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("We encountered an error trying to restore your previous session.")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("If you have previously used a more recent version of %(brand)s, your session " + "may be incompatible with this version. Close this window and return " + "to the more recent version.", {
      brand
    })), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Clearing your browser's storage may fix the problem, but will sign you " + "out and cause any encrypted chat history to become unreadable."))), dialogButtons);
  }

}) || _class);
exports.default = SessionRestoreErrorDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvU2Vzc2lvblJlc3RvcmVFcnJvckRpYWxvZy50c3giXSwibmFtZXMiOlsiU2Vzc2lvblJlc3RvcmVFcnJvckRpYWxvZyIsIlJlYWN0IiwiQ29tcG9uZW50IiwiTW9kYWwiLCJjcmVhdGVUcmFja2VkRGlhbG9nIiwiQnVnUmVwb3J0RGlhbG9nIiwiZXJyb3IiLCJwcm9wcyIsIlF1ZXN0aW9uRGlhbG9nIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImJ1dHRvbiIsImRhbmdlciIsIm9uRmluaXNoZWQiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInJlbG9hZCIsInJlbmRlciIsImJyYW5kIiwiU2RrQ29uZmlnIiwiZ2V0IiwiY2xlYXJTdG9yYWdlQnV0dG9uIiwib25DbGVhclN0b3JhZ2VDbGljayIsImRpYWxvZ0J1dHRvbnMiLCJidWdfcmVwb3J0X2VuZHBvaW50X3VybCIsInNlbmRCdWdSZXBvcnQiLCJvblJlZnJlc2hDbGljayJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFrQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7SUFRcUJBLHlCLFdBRHBCLGdEQUFxQix5Q0FBckIsQyxnQkFBRCxNQUNxQkEseUJBRHJCLFNBQ3VEQyxlQUFNQyxTQUQ3RCxDQUMrRTtBQUFBO0FBQUE7QUFBQSx5REFDbkQsTUFBWTtBQUNoQ0MscUJBQU1DLG1CQUFOLENBQTBCLHVCQUExQixFQUFtRCx3QkFBbkQsRUFBNkVDLHdCQUE3RSxFQUE4RjtBQUMxRkMsUUFBQUEsS0FBSyxFQUFFLEtBQUtDLEtBQUwsQ0FBV0Q7QUFEd0UsT0FBOUY7QUFHSCxLQUwwRTtBQUFBLCtEQU83QyxNQUFZO0FBQ3RDSCxxQkFBTUMsbUJBQU4sQ0FBMEIsZ0NBQTFCLEVBQTRELEVBQTVELEVBQWdFSSx1QkFBaEUsRUFBZ0Y7QUFDNUVDLFFBQUFBLEtBQUssRUFBRSx5QkFBRyxVQUFILENBRHFFO0FBRTVFQyxRQUFBQSxXQUFXLGVBQ1AsMENBQU8seUJBQUcsc0NBQUgsQ0FBUCxDQUh3RTtBQUk1RUMsUUFBQUEsTUFBTSxFQUFFLHlCQUFHLFVBQUgsQ0FKb0U7QUFLNUVDLFFBQUFBLE1BQU0sRUFBRSxJQUxvRTtBQU01RUMsUUFBQUEsVUFBVSxFQUFFLEtBQUtOLEtBQUwsQ0FBV007QUFOcUQsT0FBaEY7QUFRSCxLQWhCMEU7QUFBQSwwREFrQmxELE1BQVk7QUFDakM7QUFDQTtBQUNBQyxNQUFBQSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE1BQWhCO0FBQ0gsS0F0QjBFO0FBQUE7O0FBd0JwRUMsRUFBQUEsTUFBTSxHQUFnQjtBQUN6QixVQUFNQyxLQUFLLEdBQUdDLG1CQUFVQyxHQUFWLEdBQWdCRixLQUE5Qjs7QUFFQSxVQUFNRyxrQkFBa0IsZ0JBQ3BCO0FBQVEsTUFBQSxPQUFPLEVBQUUsS0FBS0MsbUJBQXRCO0FBQTJDLE1BQUEsU0FBUyxFQUFDO0FBQXJELE9BQ00seUJBQUcsNEJBQUgsQ0FETixDQURKOztBQU1BLFFBQUlDLGFBQUo7O0FBQ0EsUUFBSUosbUJBQVVDLEdBQVYsR0FBZ0JJLHVCQUFwQixFQUE2QztBQUN6Q0QsTUFBQUEsYUFBYSxnQkFBRyw2QkFBQyxzQkFBRDtBQUFlLFFBQUEsYUFBYSxFQUFFLHlCQUFHLFdBQUgsQ0FBOUI7QUFDWixRQUFBLG9CQUFvQixFQUFFLEtBQUtFLGFBRGY7QUFFWixRQUFBLEtBQUssRUFBRSxJQUZLO0FBR1osUUFBQSxTQUFTLEVBQUU7QUFIQyxTQUtWSixrQkFMVSxDQUFoQjtBQU9ILEtBUkQsTUFRTztBQUNIRSxNQUFBQSxhQUFhLGdCQUFHLDZCQUFDLHNCQUFEO0FBQWUsUUFBQSxhQUFhLEVBQUUseUJBQUcsU0FBSCxDQUE5QjtBQUNaLFFBQUEsb0JBQW9CLEVBQUUsS0FBS0csY0FEZjtBQUVaLFFBQUEsS0FBSyxFQUFFLElBRks7QUFHWixRQUFBLFNBQVMsRUFBRTtBQUhDLFNBS1ZMLGtCQUxVLENBQWhCO0FBT0g7O0FBRUQsd0JBQ0ksNkJBQUMsbUJBQUQ7QUFDSSxNQUFBLFNBQVMsRUFBQyxnQkFEZDtBQUVJLE1BQUEsVUFBVSxFQUFFLEtBQUtkLEtBQUwsQ0FBV00sVUFGM0I7QUFHSSxNQUFBLEtBQUssRUFBRSx5QkFBRywyQkFBSCxDQUhYO0FBSUksTUFBQSxTQUFTLEVBQUMsbUJBSmQ7QUFLSSxNQUFBLFNBQVMsRUFBRTtBQUxmLG9CQU9JO0FBQUssTUFBQSxTQUFTLEVBQUMsbUJBQWY7QUFBbUMsTUFBQSxFQUFFLEVBQUM7QUFBdEMsb0JBQ0ksd0NBQUsseUJBQUcsa0VBQUgsQ0FBTCxDQURKLGVBR0ksd0NBQUsseUJBQ0Qsa0ZBQ0Esc0VBREEsR0FFQSw2QkFIQyxFQUlEO0FBQUVLLE1BQUFBO0FBQUYsS0FKQyxDQUFMLENBSEosZUFVSSx3Q0FBSyx5QkFDRCw0RUFDQSxnRUFGQyxDQUFMLENBVkosQ0FQSixFQXNCTUssYUF0Qk4sQ0FESjtBQTBCSDs7QUE5RTBFLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTcgVmVjdG9yIENyZWF0aW9ucyBMdGRcbkNvcHlyaWdodCAyMDE4IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgU2RrQ29uZmlnIGZyb20gJy4uLy4uLy4uL1Nka0NvbmZpZyc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnLi4vLi4vLi4vTW9kYWwnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCBRdWVzdGlvbkRpYWxvZyBmcm9tIFwiLi9RdWVzdGlvbkRpYWxvZ1wiO1xuaW1wb3J0IEJ1Z1JlcG9ydERpYWxvZyBmcm9tIFwiLi9CdWdSZXBvcnREaWFsb2dcIjtcbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gXCIuL0Jhc2VEaWFsb2dcIjtcbmltcG9ydCBEaWFsb2dCdXR0b25zIGZyb20gXCIuLi9lbGVtZW50cy9EaWFsb2dCdXR0b25zXCI7XG5pbXBvcnQgeyBJRGlhbG9nUHJvcHMgfSBmcm9tIFwiLi9JRGlhbG9nUHJvcHNcIjtcblxuaW50ZXJmYWNlIElQcm9wcyBleHRlbmRzIElEaWFsb2dQcm9wcyB7XG4gICAgZXJyb3I6IEVycm9yO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5kaWFsb2dzLlNlc3Npb25SZXN0b3JlRXJyb3JEaWFsb2dcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlc3Npb25SZXN0b3JlRXJyb3JEaWFsb2cgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzPiB7XG4gICAgcHJpdmF0ZSBzZW5kQnVnUmVwb3J0ID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdTZXNzaW9uIFJlc3RvcmUgRXJyb3InLCAnU2VuZCBCdWcgUmVwb3J0IERpYWxvZycsIEJ1Z1JlcG9ydERpYWxvZywge1xuICAgICAgICAgICAgZXJyb3I6IHRoaXMucHJvcHMuZXJyb3IsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQ2xlYXJTdG9yYWdlQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ1Nlc3Npb24gUmVzdG9yZSBDb25maXJtIExvZ291dCcsICcnLCBRdWVzdGlvbkRpYWxvZywge1xuICAgICAgICAgICAgdGl0bGU6IF90KFwiU2lnbiBvdXRcIiksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAgICAgICA8ZGl2PnsgX3QoXCJTaWduIG91dCBhbmQgcmVtb3ZlIGVuY3J5cHRpb24ga2V5cz9cIikgfTwvZGl2PixcbiAgICAgICAgICAgIGJ1dHRvbjogX3QoXCJTaWduIG91dFwiKSxcbiAgICAgICAgICAgIGRhbmdlcjogdHJ1ZSxcbiAgICAgICAgICAgIG9uRmluaXNoZWQ6IHRoaXMucHJvcHMub25GaW5pc2hlZCxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25SZWZyZXNoQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIC8vIElzIHRoaXMgbGlrZWx5IHRvIGhlbHA/IFByb2JhYmx5IG5vdCwgYnV0IGdpdmluZyBvbmx5IG9uZSBidXR0b25cbiAgICAgICAgLy8gdGhhdCBjbGVhcnMgeW91ciBzdG9yYWdlIHNlZW1zIGF3ZnVsLlxuICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBjb25zdCBicmFuZCA9IFNka0NvbmZpZy5nZXQoKS5icmFuZDtcblxuICAgICAgICBjb25zdCBjbGVhclN0b3JhZ2VCdXR0b24gPSAoXG4gICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e3RoaXMub25DbGVhclN0b3JhZ2VDbGlja30gY2xhc3NOYW1lPVwiZGFuZ2VyXCI+XG4gICAgICAgICAgICAgICAgeyBfdChcIkNsZWFyIFN0b3JhZ2UgYW5kIFNpZ24gT3V0XCIpIH1cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICApO1xuXG4gICAgICAgIGxldCBkaWFsb2dCdXR0b25zO1xuICAgICAgICBpZiAoU2RrQ29uZmlnLmdldCgpLmJ1Z19yZXBvcnRfZW5kcG9pbnRfdXJsKSB7XG4gICAgICAgICAgICBkaWFsb2dCdXR0b25zID0gPERpYWxvZ0J1dHRvbnMgcHJpbWFyeUJ1dHRvbj17X3QoXCJTZW5kIExvZ3NcIil9XG4gICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMuc2VuZEJ1Z1JlcG9ydH1cbiAgICAgICAgICAgICAgICBmb2N1cz17dHJ1ZX1cbiAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e2ZhbHNlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHsgY2xlYXJTdG9yYWdlQnV0dG9uIH1cbiAgICAgICAgICAgIDwvRGlhbG9nQnV0dG9ucz47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaWFsb2dCdXR0b25zID0gPERpYWxvZ0J1dHRvbnMgcHJpbWFyeUJ1dHRvbj17X3QoXCJSZWZyZXNoXCIpfVxuICAgICAgICAgICAgICAgIG9uUHJpbWFyeUJ1dHRvbkNsaWNrPXt0aGlzLm9uUmVmcmVzaENsaWNrfVxuICAgICAgICAgICAgICAgIGZvY3VzPXt0cnVlfVxuICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17ZmFsc2V9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgeyBjbGVhclN0b3JhZ2VCdXR0b24gfVxuICAgICAgICAgICAgPC9EaWFsb2dCdXR0b25zPjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZ1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0Vycm9yRGlhbG9nXCJcbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9XG4gICAgICAgICAgICAgICAgdGl0bGU9e190KCdVbmFibGUgdG8gcmVzdG9yZSBzZXNzaW9uJyl9XG4gICAgICAgICAgICAgICAgY29udGVudElkPSdteF9EaWFsb2dfY29udGVudCdcbiAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e2ZhbHNlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRGlhbG9nX2NvbnRlbnRcIiBpZD0nbXhfRGlhbG9nX2NvbnRlbnQnPlxuICAgICAgICAgICAgICAgICAgICA8cD57IF90KFwiV2UgZW5jb3VudGVyZWQgYW4gZXJyb3IgdHJ5aW5nIHRvIHJlc3RvcmUgeW91ciBwcmV2aW91cyBzZXNzaW9uLlwiKSB9PC9wPlxuXG4gICAgICAgICAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIklmIHlvdSBoYXZlIHByZXZpb3VzbHkgdXNlZCBhIG1vcmUgcmVjZW50IHZlcnNpb24gb2YgJShicmFuZClzLCB5b3VyIHNlc3Npb24gXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJtYXkgYmUgaW5jb21wYXRpYmxlIHdpdGggdGhpcyB2ZXJzaW9uLiBDbG9zZSB0aGlzIHdpbmRvdyBhbmQgcmV0dXJuIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidG8gdGhlIG1vcmUgcmVjZW50IHZlcnNpb24uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGJyYW5kIH0sXG4gICAgICAgICAgICAgICAgICAgICkgfTwvcD5cblxuICAgICAgICAgICAgICAgICAgICA8cD57IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJDbGVhcmluZyB5b3VyIGJyb3dzZXIncyBzdG9yYWdlIG1heSBmaXggdGhlIHByb2JsZW0sIGJ1dCB3aWxsIHNpZ24geW91IFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwib3V0IGFuZCBjYXVzZSBhbnkgZW5jcnlwdGVkIGNoYXQgaGlzdG9yeSB0byBiZWNvbWUgdW5yZWFkYWJsZS5cIixcbiAgICAgICAgICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIHsgZGlhbG9nQnV0dG9ucyB9XG4gICAgICAgICAgICA8L0Jhc2VEaWFsb2c+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19