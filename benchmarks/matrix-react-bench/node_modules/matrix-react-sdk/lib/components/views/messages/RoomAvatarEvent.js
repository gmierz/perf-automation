"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _languageHandler = require("../../../languageHandler");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Media = require("../../../customisations/Media");

var _RoomAvatar = _interopRequireDefault(require("../avatars/RoomAvatar"));

var _ImageView = _interopRequireDefault(require("../elements/ImageView"));

var _dec, _class;

let RoomAvatarEvent = (_dec = (0, _replaceableComponent.replaceableComponent)("views.messages.RoomAvatarEvent"), _dec(_class = class RoomAvatarEvent extends _react.default.Component {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "onAvatarClick", () => {
      const cli = _MatrixClientPeg.MatrixClientPeg.get();

      const ev = this.props.mxEvent;
      const httpUrl = (0, _Media.mediaFromMxc)(ev.getContent().url).srcHttp;
      const room = cli.getRoom(this.props.mxEvent.getRoomId());
      const text = (0, _languageHandler._t)('%(senderDisplayName)s changed the avatar for %(roomName)s', {
        senderDisplayName: ev.sender && ev.sender.name ? ev.sender.name : ev.getSender(),
        roomName: room ? room.name : ''
      });
      const params = {
        src: httpUrl,
        name: text
      };

      _Modal.default.createDialog(_ImageView.default, params, "mx_Dialog_lightbox", null, true);
    });
  }

  render() {
    const ev = this.props.mxEvent;
    const senderDisplayName = ev.sender && ev.sender.name ? ev.sender.name : ev.getSender();

    if (!ev.getContent().url || ev.getContent().url.trim().length === 0) {
      return /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_TextualEvent"
      }, (0, _languageHandler._t)('%(senderDisplayName)s removed the room avatar.', {
        senderDisplayName
      }));
    }

    const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(ev.getRoomId()); // Provide all arguments to RoomAvatar via oobData because the avatar is historic


    const oobData = {
      avatarUrl: ev.getContent().url,
      name: room ? room.name : ""
    };
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomAvatarEvent"
    }, (0, _languageHandler._t)('%(senderDisplayName)s changed the room avatar to <img/>', {
      senderDisplayName: senderDisplayName
    }, {
      'img': () => /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        key: "avatar",
        className: "mx_RoomAvatarEvent_avatar",
        onClick: this.onAvatarClick
      }, /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
        width: 14,
        height: 14,
        oobData: oobData
      }))
    }));
  }

}) || _class);
exports.default = RoomAvatarEvent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL21lc3NhZ2VzL1Jvb21BdmF0YXJFdmVudC50c3giXSwibmFtZXMiOlsiUm9vbUF2YXRhckV2ZW50IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjbGkiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJldiIsInByb3BzIiwibXhFdmVudCIsImh0dHBVcmwiLCJnZXRDb250ZW50IiwidXJsIiwic3JjSHR0cCIsInJvb20iLCJnZXRSb29tIiwiZ2V0Um9vbUlkIiwidGV4dCIsInNlbmRlckRpc3BsYXlOYW1lIiwic2VuZGVyIiwibmFtZSIsImdldFNlbmRlciIsInJvb21OYW1lIiwicGFyYW1zIiwic3JjIiwiTW9kYWwiLCJjcmVhdGVEaWFsb2ciLCJJbWFnZVZpZXciLCJyZW5kZXIiLCJ0cmltIiwibGVuZ3RoIiwib29iRGF0YSIsImF2YXRhclVybCIsIm9uQXZhdGFyQ2xpY2siXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBa0JBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0lBUXFCQSxlLFdBRHBCLGdEQUFxQixnQ0FBckIsQyxnQkFBRCxNQUNxQkEsZUFEckIsU0FDNkNDLGVBQU1DLFNBRG5ELENBQ3FFO0FBQUE7QUFBQTtBQUFBLHlEQUN6QyxNQUFZO0FBQ2hDLFlBQU1DLEdBQUcsR0FBR0MsaUNBQWdCQyxHQUFoQixFQUFaOztBQUNBLFlBQU1DLEVBQUUsR0FBRyxLQUFLQyxLQUFMLENBQVdDLE9BQXRCO0FBQ0EsWUFBTUMsT0FBTyxHQUFHLHlCQUFhSCxFQUFFLENBQUNJLFVBQUgsR0FBZ0JDLEdBQTdCLEVBQWtDQyxPQUFsRDtBQUVBLFlBQU1DLElBQUksR0FBR1YsR0FBRyxDQUFDVyxPQUFKLENBQVksS0FBS1AsS0FBTCxDQUFXQyxPQUFYLENBQW1CTyxTQUFuQixFQUFaLENBQWI7QUFDQSxZQUFNQyxJQUFJLEdBQUcseUJBQUcsMkRBQUgsRUFBZ0U7QUFDekVDLFFBQUFBLGlCQUFpQixFQUFFWCxFQUFFLENBQUNZLE1BQUgsSUFBYVosRUFBRSxDQUFDWSxNQUFILENBQVVDLElBQXZCLEdBQThCYixFQUFFLENBQUNZLE1BQUgsQ0FBVUMsSUFBeEMsR0FBK0NiLEVBQUUsQ0FBQ2MsU0FBSCxFQURPO0FBRXpFQyxRQUFBQSxRQUFRLEVBQUVSLElBQUksR0FBR0EsSUFBSSxDQUFDTSxJQUFSLEdBQWU7QUFGNEMsT0FBaEUsQ0FBYjtBQUtBLFlBQU1HLE1BQU0sR0FBRztBQUNYQyxRQUFBQSxHQUFHLEVBQUVkLE9BRE07QUFFWFUsUUFBQUEsSUFBSSxFQUFFSDtBQUZLLE9BQWY7O0FBSUFRLHFCQUFNQyxZQUFOLENBQW1CQyxrQkFBbkIsRUFBOEJKLE1BQTlCLEVBQXNDLG9CQUF0QyxFQUE0RCxJQUE1RCxFQUFrRSxJQUFsRTtBQUNILEtBakJnRTtBQUFBOztBQW1CMURLLEVBQUFBLE1BQU0sR0FBZ0I7QUFDekIsVUFBTXJCLEVBQUUsR0FBRyxLQUFLQyxLQUFMLENBQVdDLE9BQXRCO0FBQ0EsVUFBTVMsaUJBQWlCLEdBQUdYLEVBQUUsQ0FBQ1ksTUFBSCxJQUFhWixFQUFFLENBQUNZLE1BQUgsQ0FBVUMsSUFBdkIsR0FBOEJiLEVBQUUsQ0FBQ1ksTUFBSCxDQUFVQyxJQUF4QyxHQUErQ2IsRUFBRSxDQUFDYyxTQUFILEVBQXpFOztBQUVBLFFBQUksQ0FBQ2QsRUFBRSxDQUFDSSxVQUFILEdBQWdCQyxHQUFqQixJQUF3QkwsRUFBRSxDQUFDSSxVQUFILEdBQWdCQyxHQUFoQixDQUFvQmlCLElBQXBCLEdBQTJCQyxNQUEzQixLQUFzQyxDQUFsRSxFQUFxRTtBQUNqRSwwQkFDSTtBQUFLLFFBQUEsU0FBUyxFQUFDO0FBQWYsU0FDTSx5QkFBRyxnREFBSCxFQUFxRDtBQUFFWixRQUFBQTtBQUFGLE9BQXJELENBRE4sQ0FESjtBQUtIOztBQUVELFVBQU1KLElBQUksR0FBR1QsaUNBQWdCQyxHQUFoQixHQUFzQlMsT0FBdEIsQ0FBOEJSLEVBQUUsQ0FBQ1MsU0FBSCxFQUE5QixDQUFiLENBWnlCLENBYXpCOzs7QUFDQSxVQUFNZSxPQUFPLEdBQUc7QUFDWkMsTUFBQUEsU0FBUyxFQUFFekIsRUFBRSxDQUFDSSxVQUFILEdBQWdCQyxHQURmO0FBRVpRLE1BQUFBLElBQUksRUFBRU4sSUFBSSxHQUFHQSxJQUFJLENBQUNNLElBQVIsR0FBZTtBQUZiLEtBQWhCO0FBS0Esd0JBQ0k7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQ00seUJBQUcseURBQUgsRUFDRTtBQUFFRixNQUFBQSxpQkFBaUIsRUFBRUE7QUFBckIsS0FERixFQUVFO0FBQ0ksYUFBTyxtQkFDSCw2QkFBQyx5QkFBRDtBQUNJLFFBQUEsR0FBRyxFQUFDLFFBRFI7QUFFSSxRQUFBLFNBQVMsRUFBQywyQkFGZDtBQUdJLFFBQUEsT0FBTyxFQUFFLEtBQUtlO0FBSGxCLHNCQUtJLDZCQUFDLG1CQUFEO0FBQVksUUFBQSxLQUFLLEVBQUUsRUFBbkI7QUFBdUIsUUFBQSxNQUFNLEVBQUUsRUFBL0I7QUFBbUMsUUFBQSxPQUFPLEVBQUVGO0FBQTVDLFFBTEo7QUFGUixLQUZGLENBRE4sQ0FESjtBQWlCSDs7QUF2RGdFLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTcgVmVjdG9yIENyZWF0aW9ucyBMdGRcbkNvcHlyaWdodCAyMDE5IE1pY2hhZWwgVGVsYXR5bnNraSA8N3QzY2hndXlAZ21haWwuY29tPlxuQ29weXJpZ2h0IDIwMTkgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgTWF0cml4RXZlbnQgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50XCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tICcuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWcnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IE1vZGFsIGZyb20gJy4uLy4uLy4uL01vZGFsJztcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gJy4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b24nO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCB7IG1lZGlhRnJvbU14YyB9IGZyb20gXCIuLi8uLi8uLi9jdXN0b21pc2F0aW9ucy9NZWRpYVwiO1xuaW1wb3J0IFJvb21BdmF0YXIgZnJvbSBcIi4uL2F2YXRhcnMvUm9vbUF2YXRhclwiO1xuaW1wb3J0IEltYWdlVmlldyBmcm9tIFwiLi4vZWxlbWVudHMvSW1hZ2VWaWV3XCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIC8qIHRoZSBNYXRyaXhFdmVudCB0byBzaG93ICovXG4gICAgbXhFdmVudDogTWF0cml4RXZlbnQ7XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLm1lc3NhZ2VzLlJvb21BdmF0YXJFdmVudFwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUm9vbUF2YXRhckV2ZW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcz4ge1xuICAgIHByaXZhdGUgb25BdmF0YXJDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCBldiA9IHRoaXMucHJvcHMubXhFdmVudDtcbiAgICAgICAgY29uc3QgaHR0cFVybCA9IG1lZGlhRnJvbU14Yyhldi5nZXRDb250ZW50KCkudXJsKS5zcmNIdHRwO1xuXG4gICAgICAgIGNvbnN0IHJvb20gPSBjbGkuZ2V0Um9vbSh0aGlzLnByb3BzLm14RXZlbnQuZ2V0Um9vbUlkKCkpO1xuICAgICAgICBjb25zdCB0ZXh0ID0gX3QoJyUoc2VuZGVyRGlzcGxheU5hbWUpcyBjaGFuZ2VkIHRoZSBhdmF0YXIgZm9yICUocm9vbU5hbWUpcycsIHtcbiAgICAgICAgICAgIHNlbmRlckRpc3BsYXlOYW1lOiBldi5zZW5kZXIgJiYgZXYuc2VuZGVyLm5hbWUgPyBldi5zZW5kZXIubmFtZSA6IGV2LmdldFNlbmRlcigpLFxuICAgICAgICAgICAgcm9vbU5hbWU6IHJvb20gPyByb29tLm5hbWUgOiAnJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgc3JjOiBodHRwVXJsLFxuICAgICAgICAgICAgbmFtZTogdGV4dCxcbiAgICAgICAgfTtcbiAgICAgICAgTW9kYWwuY3JlYXRlRGlhbG9nKEltYWdlVmlldywgcGFyYW1zLCBcIm14X0RpYWxvZ19saWdodGJveFwiLCBudWxsLCB0cnVlKTtcbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGNvbnN0IGV2ID0gdGhpcy5wcm9wcy5teEV2ZW50O1xuICAgICAgICBjb25zdCBzZW5kZXJEaXNwbGF5TmFtZSA9IGV2LnNlbmRlciAmJiBldi5zZW5kZXIubmFtZSA/IGV2LnNlbmRlci5uYW1lIDogZXYuZ2V0U2VuZGVyKCk7XG5cbiAgICAgICAgaWYgKCFldi5nZXRDb250ZW50KCkudXJsIHx8IGV2LmdldENvbnRlbnQoKS51cmwudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1RleHR1YWxFdmVudFwiPlxuICAgICAgICAgICAgICAgICAgICB7IF90KCclKHNlbmRlckRpc3BsYXlOYW1lKXMgcmVtb3ZlZCB0aGUgcm9vbSBhdmF0YXIuJywgeyBzZW5kZXJEaXNwbGF5TmFtZSB9KSB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgcm9vbSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRSb29tKGV2LmdldFJvb21JZCgpKTtcbiAgICAgICAgLy8gUHJvdmlkZSBhbGwgYXJndW1lbnRzIHRvIFJvb21BdmF0YXIgdmlhIG9vYkRhdGEgYmVjYXVzZSB0aGUgYXZhdGFyIGlzIGhpc3RvcmljXG4gICAgICAgIGNvbnN0IG9vYkRhdGEgPSB7XG4gICAgICAgICAgICBhdmF0YXJVcmw6IGV2LmdldENvbnRlbnQoKS51cmwsXG4gICAgICAgICAgICBuYW1lOiByb29tID8gcm9vbS5uYW1lIDogXCJcIixcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tQXZhdGFyRXZlbnRcIj5cbiAgICAgICAgICAgICAgICB7IF90KCclKHNlbmRlckRpc3BsYXlOYW1lKXMgY2hhbmdlZCB0aGUgcm9vbSBhdmF0YXIgdG8gPGltZy8+JyxcbiAgICAgICAgICAgICAgICAgICAgeyBzZW5kZXJEaXNwbGF5TmFtZTogc2VuZGVyRGlzcGxheU5hbWUgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2ltZyc6ICgpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PVwiYXZhdGFyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfUm9vbUF2YXRhckV2ZW50X2F2YXRhclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25BdmF0YXJDbGlja31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSb29tQXZhdGFyIHdpZHRoPXsxNH0gaGVpZ2h0PXsxNH0gb29iRGF0YT17b29iRGF0YX0gLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+LFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==