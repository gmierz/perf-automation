"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _react = _interopRequireDefault(require("react"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _InlineSpinner = _interopRequireDefault(require("../elements/InlineSpinner"));

var _languageHandler = require("../../../languageHandler");

var _AudioPlayer = _interopRequireDefault(require("../audio_messages/AudioPlayer"));

var _MFileBody = _interopRequireDefault(require("./MFileBody"));

var _PlaybackManager = require("../../../audio/PlaybackManager");

var _EventUtils = require("../../../utils/EventUtils");

var _PlaybackQueue = require("../../../audio/PlaybackQueue");

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

let MAudioBody = (_dec = (0, _replaceableComponent.replaceableComponent)("views.messages.MAudioBody"), _dec(_class = class MAudioBody extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    this.state = {};
  }

  async componentDidMount() {
    var _content$orgMatrixM, _content$orgMatrixM$w;

    let buffer;

    try {
      try {
        const blob = await this.props.mediaEventHelper.sourceBlob.value;
        buffer = await blob.arrayBuffer();
      } catch (e) {
        this.setState({
          error: e
        });

        _logger.logger.warn("Unable to decrypt audio message", e);

        return; // stop processing the audio file
      }
    } catch (e) {
      this.setState({
        error: e
      });

      _logger.logger.warn("Unable to decrypt/download audio message", e);

      return; // stop processing the audio file
    } // We should have a buffer to work with now: let's set it up
    // Note: we don't actually need a waveform to render an audio event, but voice messages do.


    const content = this.props.mxEvent.getContent();
    const waveform = content === null || content === void 0 ? void 0 : (_content$orgMatrixM = content["org.matrix.msc1767.audio"]) === null || _content$orgMatrixM === void 0 ? void 0 : (_content$orgMatrixM$w = _content$orgMatrixM.waveform) === null || _content$orgMatrixM$w === void 0 ? void 0 : _content$orgMatrixM$w.map(p => p / 1024); // We should have a buffer to work with now: let's set it up

    const playback = _PlaybackManager.PlaybackManager.instance.createPlaybackInstance(buffer, waveform);

    playback.clockInfo.populatePlaceholdersFrom(this.props.mxEvent);
    this.setState({
      playback
    });

    if ((0, _EventUtils.isVoiceMessage)(this.props.mxEvent)) {
      _PlaybackQueue.PlaybackQueue.forRoom(this.props.mxEvent.getRoomId()).unsortedEnqueue(this.props.mxEvent, playback);
    } // Note: the components later on will handle preparing the Playback class for us.

  }

  componentWillUnmount() {
    var _this$state$playback;

    (_this$state$playback = this.state.playback) === null || _this$state$playback === void 0 ? void 0 : _this$state$playback.destroy();
  }

  render() {
    if (this.state.error) {
      return /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_MAudioBody"
      }, /*#__PURE__*/_react.default.createElement("img", {
        src: require("../../../../res/img/warning.svg"),
        width: "16",
        height: "16"
      }), (0, _languageHandler._t)("Error processing audio message"));
    }

    if (this.props.forExport) {
      var _content$file;

      const content = this.props.mxEvent.getContent(); // During export, the content url will point to the MSC, which will later point to a local url

      const contentUrl = ((_content$file = content.file) === null || _content$file === void 0 ? void 0 : _content$file.url) || content.url;
      return /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_MAudioBody"
      }, /*#__PURE__*/_react.default.createElement("audio", {
        src: contentUrl,
        controls: true
      }));
    }

    if (!this.state.playback) {
      return /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_MAudioBody"
      }, /*#__PURE__*/_react.default.createElement(_InlineSpinner.default, null));
    } // At this point we should have a playable state


    return /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_MAudioBody"
    }, /*#__PURE__*/_react.default.createElement(_AudioPlayer.default, {
      playback: this.state.playback,
      mediaName: this.props.mxEvent.getContent().body
    }), this.props.tileShape && /*#__PURE__*/_react.default.createElement(_MFileBody.default, (0, _extends2.default)({}, this.props, {
      showGenericPlaceholder: false
    })));
  }

}) || _class);
exports.default = MAudioBody;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL21lc3NhZ2VzL01BdWRpb0JvZHkudHN4Il0sIm5hbWVzIjpbIk1BdWRpb0JvZHkiLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwic3RhdGUiLCJjb21wb25lbnREaWRNb3VudCIsImJ1ZmZlciIsImJsb2IiLCJtZWRpYUV2ZW50SGVscGVyIiwic291cmNlQmxvYiIsInZhbHVlIiwiYXJyYXlCdWZmZXIiLCJlIiwic2V0U3RhdGUiLCJlcnJvciIsImxvZ2dlciIsIndhcm4iLCJjb250ZW50IiwibXhFdmVudCIsImdldENvbnRlbnQiLCJ3YXZlZm9ybSIsIm1hcCIsInAiLCJwbGF5YmFjayIsIlBsYXliYWNrTWFuYWdlciIsImluc3RhbmNlIiwiY3JlYXRlUGxheWJhY2tJbnN0YW5jZSIsImNsb2NrSW5mbyIsInBvcHVsYXRlUGxhY2Vob2xkZXJzRnJvbSIsIlBsYXliYWNrUXVldWUiLCJmb3JSb29tIiwiZ2V0Um9vbUlkIiwidW5zb3J0ZWRFbnF1ZXVlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkZXN0cm95IiwicmVuZGVyIiwicmVxdWlyZSIsImZvckV4cG9ydCIsImNvbnRlbnRVcmwiLCJmaWxlIiwidXJsIiwiYm9keSIsInRpbGVTaGFwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7SUFRcUJBLFUsV0FEcEIsZ0RBQXFCLDJCQUFyQixDLGdCQUFELE1BQ3FCQSxVQURyQixTQUN3Q0MsZUFBTUMsYUFEOUMsQ0FDZ0Y7QUFDNUVDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFvQjtBQUMzQixVQUFNQSxLQUFOO0FBRUEsU0FBS0MsS0FBTCxHQUFhLEVBQWI7QUFDSDs7QUFFNkIsUUFBakJDLGlCQUFpQixHQUFHO0FBQUE7O0FBQzdCLFFBQUlD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QVMsRUFBQztBQUFoQixzQkFDSSw2QkFBQyxzQkFBRCxPQURKLENBREo7QUFLSCxLQTNCVyxDQTZCWjs7O0FBQ0Esd0JBQ0k7QUFBTSxNQUFBLFNBQVMsRUFBQztBQUFoQixvQkFDSSw2QkFBQyxvQkFBRDtBQUFhLE1BQUEsUUFBUSxFQUFFLEtBQUtuQixLQUFMLENBQVdtQixRQUFsQztBQUE0QyxNQUFBLFNBQVMsRUFBRSxLQUFLcEIsS0FBTCxDQUFXZSxPQUFYLENBQW1CQyxVQUFuQixHQUFnQ3NCO0FBQXZGLE1BREosRUFFTSxLQUFLdEMsS0FBTCxDQUFXdUMsU0FBWCxpQkFBd0IsNkJBQUMsa0JBQUQsNkJBQWUsS0FBS3ZDLEtBQXBCO0FBQTJCLE1BQUEsc0JBQXNCLEVBQUU7QUFBbkQsT0FGOUIsQ0FESjtBQU1IOztBQW5GMkUsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBQbGF5YmFjayB9IGZyb20gXCIuLi8uLi8uLi9hdWRpby9QbGF5YmFja1wiO1xuaW1wb3J0IElubGluZVNwaW5uZXIgZnJvbSAnLi4vZWxlbWVudHMvSW5saW5lU3Bpbm5lcic7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBBdWRpb1BsYXllciBmcm9tIFwiLi4vYXVkaW9fbWVzc2FnZXMvQXVkaW9QbGF5ZXJcIjtcbmltcG9ydCB7IElNZWRpYUV2ZW50Q29udGVudCB9IGZyb20gXCIuLi8uLi8uLi9jdXN0b21pc2F0aW9ucy9tb2RlbHMvSU1lZGlhRXZlbnRDb250ZW50XCI7XG5pbXBvcnQgTUZpbGVCb2R5IGZyb20gXCIuL01GaWxlQm9keVwiO1xuaW1wb3J0IHsgSUJvZHlQcm9wcyB9IGZyb20gXCIuL0lCb2R5UHJvcHNcIjtcbmltcG9ydCB7IFBsYXliYWNrTWFuYWdlciB9IGZyb20gXCIuLi8uLi8uLi9hdWRpby9QbGF5YmFja01hbmFnZXJcIjtcbmltcG9ydCB7IGlzVm9pY2VNZXNzYWdlIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL0V2ZW50VXRpbHNcIjtcbmltcG9ydCB7IFBsYXliYWNrUXVldWUgfSBmcm9tIFwiLi4vLi4vLi4vYXVkaW8vUGxheWJhY2tRdWV1ZVwiO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIGVycm9yPzogRXJyb3I7XG4gICAgcGxheWJhY2s/OiBQbGF5YmFjaztcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MubWVzc2FnZXMuTUF1ZGlvQm9keVwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTUF1ZGlvQm9keSBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SUJvZHlQcm9wcywgSVN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IElCb2R5UHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7fTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGxldCBidWZmZXI6IEFycmF5QnVmZmVyO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCB0aGlzLnByb3BzLm1lZGlhRXZlbnRIZWxwZXIuc291cmNlQmxvYi52YWx1ZTtcbiAgICAgICAgICAgICAgICBidWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yOiBlIH0pO1xuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKFwiVW5hYmxlIHRvIGRlY3J5cHQgYXVkaW8gbWVzc2FnZVwiLCBlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47IC8vIHN0b3AgcHJvY2Vzc2luZyB0aGUgYXVkaW8gZmlsZVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3I6IGUgfSk7XG4gICAgICAgICAgICBsb2dnZXIud2FybihcIlVuYWJsZSB0byBkZWNyeXB0L2Rvd25sb2FkIGF1ZGlvIG1lc3NhZ2VcIiwgZSk7XG4gICAgICAgICAgICByZXR1cm47IC8vIHN0b3AgcHJvY2Vzc2luZyB0aGUgYXVkaW8gZmlsZVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2Ugc2hvdWxkIGhhdmUgYSBidWZmZXIgdG8gd29yayB3aXRoIG5vdzogbGV0J3Mgc2V0IGl0IHVwXG5cbiAgICAgICAgLy8gTm90ZTogd2UgZG9uJ3QgYWN0dWFsbHkgbmVlZCBhIHdhdmVmb3JtIHRvIHJlbmRlciBhbiBhdWRpbyBldmVudCwgYnV0IHZvaWNlIG1lc3NhZ2VzIGRvLlxuICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5wcm9wcy5teEV2ZW50LmdldENvbnRlbnQ8SU1lZGlhRXZlbnRDb250ZW50PigpO1xuICAgICAgICBjb25zdCB3YXZlZm9ybSA9IGNvbnRlbnQ/LltcIm9yZy5tYXRyaXgubXNjMTc2Ny5hdWRpb1wiXT8ud2F2ZWZvcm0/Lm1hcChwID0+IHAgLyAxMDI0KTtcblxuICAgICAgICAvLyBXZSBzaG91bGQgaGF2ZSBhIGJ1ZmZlciB0byB3b3JrIHdpdGggbm93OiBsZXQncyBzZXQgaXQgdXBcbiAgICAgICAgY29uc3QgcGxheWJhY2sgPSBQbGF5YmFja01hbmFnZXIuaW5zdGFuY2UuY3JlYXRlUGxheWJhY2tJbnN0YW5jZShidWZmZXIsIHdhdmVmb3JtKTtcbiAgICAgICAgcGxheWJhY2suY2xvY2tJbmZvLnBvcHVsYXRlUGxhY2Vob2xkZXJzRnJvbSh0aGlzLnByb3BzLm14RXZlbnQpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgcGxheWJhY2sgfSk7XG5cbiAgICAgICAgaWYgKGlzVm9pY2VNZXNzYWdlKHRoaXMucHJvcHMubXhFdmVudCkpIHtcbiAgICAgICAgICAgIFBsYXliYWNrUXVldWUuZm9yUm9vbSh0aGlzLnByb3BzLm14RXZlbnQuZ2V0Um9vbUlkKCkpLnVuc29ydGVkRW5xdWV1ZSh0aGlzLnByb3BzLm14RXZlbnQsIHBsYXliYWNrKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vdGU6IHRoZSBjb21wb25lbnRzIGxhdGVyIG9uIHdpbGwgaGFuZGxlIHByZXBhcmluZyB0aGUgUGxheWJhY2sgY2xhc3MgZm9yIHVzLlxuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5wbGF5YmFjaz8uZGVzdHJveSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X01BdWRpb0JvZHlcIj5cbiAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9e3JlcXVpcmUoXCIuLi8uLi8uLi8uLi9yZXMvaW1nL3dhcm5pbmcuc3ZnXCIpfSB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiAvPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiRXJyb3IgcHJvY2Vzc2luZyBhdWRpbyBtZXNzYWdlXCIpIH1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuZm9yRXhwb3J0KSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5wcm9wcy5teEV2ZW50LmdldENvbnRlbnQoKTtcbiAgICAgICAgICAgIC8vIER1cmluZyBleHBvcnQsIHRoZSBjb250ZW50IHVybCB3aWxsIHBvaW50IHRvIHRoZSBNU0MsIHdoaWNoIHdpbGwgbGF0ZXIgcG9pbnQgdG8gYSBsb2NhbCB1cmxcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRVcmwgPSBjb250ZW50LmZpbGU/LnVybCB8fCBjb250ZW50LnVybDtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfTUF1ZGlvQm9keVwiPlxuICAgICAgICAgICAgICAgICAgICA8YXVkaW8gc3JjPXtjb250ZW50VXJsfSBjb250cm9scyAvPlxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuc3RhdGUucGxheWJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfTUF1ZGlvQm9keVwiPlxuICAgICAgICAgICAgICAgICAgICA8SW5saW5lU3Bpbm5lciAvPlxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBdCB0aGlzIHBvaW50IHdlIHNob3VsZCBoYXZlIGEgcGxheWFibGUgc3RhdGVcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X01BdWRpb0JvZHlcIj5cbiAgICAgICAgICAgICAgICA8QXVkaW9QbGF5ZXIgcGxheWJhY2s9e3RoaXMuc3RhdGUucGxheWJhY2t9IG1lZGlhTmFtZT17dGhpcy5wcm9wcy5teEV2ZW50LmdldENvbnRlbnQoKS5ib2R5fSAvPlxuICAgICAgICAgICAgICAgIHsgdGhpcy5wcm9wcy50aWxlU2hhcGUgJiYgPE1GaWxlQm9keSB7Li4udGhpcy5wcm9wc30gc2hvd0dlbmVyaWNQbGFjZWhvbGRlcj17ZmFsc2V9IC8+IH1cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=