"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _Playback = require("../../../audio/Playback");

var _react = _interopRequireDefault(require("react"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _MarkedExecution = require("../../../utils/MarkedExecution");

var _numbers = require("../../../utils/numbers");

var _dec, _class, _class2, _temp;

const ARROW_SKIP_SECONDS = 5; // arbitrary

let SeekBar = (_dec = (0, _replaceableComponent.replaceableComponent)("views.audio_messages.SeekBar"), _dec(_class = (_temp = _class2 = class SeekBar extends _react.default.PureComponent {
  // We use an animation frame request to avoid overly spamming prop updates, even if we aren't
  // really using anything demanding on the CSS front.
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "animationFrameFn", new _MarkedExecution.MarkedExecution(() => this.doUpdate(), () => requestAnimationFrame(() => this.animationFrameFn.trigger())));
    (0, _defineProperty2.default)(this, "onChange", ev => {
      // Thankfully, onChange is only called when the user changes the value, not when we
      // change the value on the component. We can use this as a reliable "skip to X" function.
      //
      // noinspection JSIgnoredPromiseFromCall
      this.props.playback.skipTo(Number(ev.target.value) * this.props.playback.clockInfo.durationSeconds);
    });
    this.state = {
      percentage: 0
    }; // We don't need to de-register: the class handles this for us internally

    this.props.playback.clockInfo.liveData.onUpdate(() => this.animationFrameFn.mark());
  }

  doUpdate() {
    this.setState({
      percentage: (0, _numbers.percentageOf)(this.props.playback.clockInfo.timeSeconds, 0, this.props.playback.clockInfo.durationSeconds)
    });
  }

  left() {
    // noinspection JSIgnoredPromiseFromCall
    this.props.playback.skipTo(this.props.playback.clockInfo.timeSeconds - ARROW_SKIP_SECONDS);
  }

  right() {
    // noinspection JSIgnoredPromiseFromCall
    this.props.playback.skipTo(this.props.playback.clockInfo.timeSeconds + ARROW_SKIP_SECONDS);
  }

  render() {
    // We use a range input to avoid having to re-invent accessibility handling on
    // a custom set of divs.
    return /*#__PURE__*/_react.default.createElement("input", {
      type: "range",
      className: "mx_SeekBar",
      tabIndex: this.props.tabIndex,
      onChange: this.onChange,
      min: 0,
      max: 1,
      value: this.state.percentage,
      step: 0.001,
      style: {
        '--fillTo': this.state.percentage
      },
      disabled: this.props.playbackPhase === _Playback.PlaybackState.Decoding
    });
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  tabIndex: 0
}), _temp)) || _class);
exports.default = SeekBar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2F1ZGlvX21lc3NhZ2VzL1NlZWtCYXIudHN4Il0sIm5hbWVzIjpbIkFSUk9XX1NLSVBfU0VDT05EUyIsIlNlZWtCYXIiLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiTWFya2VkRXhlY3V0aW9uIiwiZG9VcGRhdGUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJhbmltYXRpb25GcmFtZUZuIiwidHJpZ2dlciIsImV2IiwicGxheWJhY2siLCJza2lwVG8iLCJOdW1iZXIiLCJ0YXJnZXQiLCJ2YWx1ZSIsImNsb2NrSW5mbyIsImR1cmF0aW9uU2Vjb25kcyIsInN0YXRlIiwicGVyY2VudGFnZSIsImxpdmVEYXRhIiwib25VcGRhdGUiLCJtYXJrIiwic2V0U3RhdGUiLCJ0aW1lU2Vjb25kcyIsImxlZnQiLCJyaWdodCIsInJlbmRlciIsInRhYkluZGV4Iiwib25DaGFuZ2UiLCJwbGF5YmFja1BoYXNlIiwiUGxheWJhY2tTdGF0ZSIsIkRlY29kaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQXNCQSxNQUFNQSxrQkFBa0IsR0FBRyxDQUEzQixDLENBQThCOztJQUdUQyxPLFdBRHBCLGdEQUFxQiw4QkFBckIsQyxtQ0FBRCxNQUNxQkEsT0FEckIsU0FDcUNDLGVBQU1DLGFBRDNDLENBQ3lFO0FBQ3JFO0FBQ0E7QUFVQUMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0FBQ3ZCLFVBQU1BLEtBQU47QUFEdUIsNERBUkEsSUFBSUMsZ0NBQUosQ0FDdkIsTUFBTSxLQUFLQyxRQUFMLEVBRGlCLEVBRXZCLE1BQU1DLHFCQUFxQixDQUFDLE1BQU0sS0FBS0MsZ0JBQUwsQ0FBc0JDLE9BQXRCLEVBQVAsQ0FGSixDQVFBO0FBQUEsb0RBOEJQQyxFQUFELElBQXVDO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBS04sS0FBTCxDQUFXTyxRQUFYLENBQW9CQyxNQUFwQixDQUEyQkMsTUFBTSxDQUFDSCxFQUFFLENBQUNJLE1BQUgsQ0FBVUMsS0FBWCxDQUFOLEdBQTBCLEtBQUtYLEtBQUwsQ0FBV08sUUFBWCxDQUFvQkssU0FBcEIsQ0FBOEJDLGVBQW5GO0FBQ0gsS0FwQzBCO0FBR3ZCLFNBQUtDLEtBQUwsR0FBYTtBQUNUQyxNQUFBQSxVQUFVLEVBQUU7QUFESCxLQUFiLENBSHVCLENBT3ZCOztBQUNBLFNBQUtmLEtBQUwsQ0FBV08sUUFBWCxDQUFvQkssU0FBcEIsQ0FBOEJJLFFBQTlCLENBQXVDQyxRQUF2QyxDQUFnRCxNQUFNLEtBQUtiLGdCQUFMLENBQXNCYyxJQUF0QixFQUF0RDtBQUNIOztBQUVPaEIsRUFBQUEsUUFBUSxHQUFHO0FBQ2YsU0FBS2lCLFFBQUwsQ0FBYztBQUNWSixNQUFBQSxVQUFVLEVBQUUsMkJBQ1IsS0FBS2YsS0FBTCxDQUFXTyxRQUFYLENBQW9CSyxTQUFwQixDQUE4QlEsV0FEdEIsRUFFUixDQUZRLEVBR1IsS0FBS3BCLEtBQUwsQ0FBV08sUUFBWCxDQUFvQkssU0FBcEIsQ0FBOEJDLGVBSHRCO0FBREYsS0FBZDtBQU1IOztBQUVNUSxFQUFBQSxJQUFJLEdBQUc7QUFDVjtBQUNBLFNBQUtyQixLQUFMLENBQVdPLFFBQVgsQ0FBb0JDLE1BQXBCLENBQTJCLEtBQUtSLEtBQUwsQ0FBV08sUUFBWCxDQUFvQkssU0FBcEIsQ0FBOEJRLFdBQTlCLEdBQTRDekIsa0JBQXZFO0FBQ0g7O0FBRU0yQixFQUFBQSxLQUFLLEdBQUc7QUFDWDtBQUNBLFNBQUt0QixLQUFMLENBQVdPLFFBQVgsQ0FBb0JDLE1BQXBCLENBQTJCLEtBQUtSLEtBQUwsQ0FBV08sUUFBWCxDQUFvQkssU0FBcEIsQ0FBOEJRLFdBQTlCLEdBQTRDekIsa0JBQXZFO0FBQ0g7O0FBVU00QixFQUFBQSxNQUFNLEdBQWM7QUFDdkI7QUFDQTtBQUNBLHdCQUFPO0FBQ0gsTUFBQSxJQUFJLEVBQUMsT0FERjtBQUVILE1BQUEsU0FBUyxFQUFDLFlBRlA7QUFHSCxNQUFBLFFBQVEsRUFBRSxLQUFLdkIsS0FBTCxDQUFXd0IsUUFIbEI7QUFJSCxNQUFBLFFBQVEsRUFBRSxLQUFLQyxRQUpaO0FBS0gsTUFBQSxHQUFHLEVBQUUsQ0FMRjtBQU1ILE1BQUEsR0FBRyxFQUFFLENBTkY7QUFPSCxNQUFBLEtBQUssRUFBRSxLQUFLWCxLQUFMLENBQVdDLFVBUGY7QUFRSCxNQUFBLElBQUksRUFBRSxLQVJIO0FBU0gsTUFBQSxLQUFLLEVBQUU7QUFBRSxvQkFBWSxLQUFLRCxLQUFMLENBQVdDO0FBQXpCLE9BVEo7QUFVSCxNQUFBLFFBQVEsRUFBRSxLQUFLZixLQUFMLENBQVcwQixhQUFYLEtBQTZCQyx3QkFBY0M7QUFWbEQsTUFBUDtBQVlIOztBQWpFb0UsQyx5REFReEM7QUFDekJKLEVBQUFBLFFBQVEsRUFBRTtBQURlLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgeyBQbGF5YmFjaywgUGxheWJhY2tTdGF0ZSB9IGZyb20gXCIuLi8uLi8uLi9hdWRpby9QbGF5YmFja1wiO1xuaW1wb3J0IFJlYWN0LCB7IENoYW5nZUV2ZW50LCBDU1NQcm9wZXJ0aWVzLCBSZWFjdE5vZGUgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBNYXJrZWRFeGVjdXRpb24gfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvTWFya2VkRXhlY3V0aW9uXCI7XG5pbXBvcnQgeyBwZXJjZW50YWdlT2YgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvbnVtYmVyc1wiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICAvLyBQbGF5YmFjayBpbnN0YW5jZSB0byByZW5kZXIuIENhbm5vdCBjaGFuZ2UgZHVyaW5nIGNvbXBvbmVudCBsaWZlY3ljbGU6IGNyZWF0ZVxuICAgIC8vIGFuIGFsbC1uZXcgY29tcG9uZW50IGluc3RlYWQuXG4gICAgcGxheWJhY2s6IFBsYXliYWNrO1xuXG4gICAgLy8gVGFiIGluZGV4IGZvciB0aGUgdW5kZXJseWluZyBjb21wb25lbnQuIFVzZWZ1bCBpZiB0aGUgc2VlayBiYXIgaXMgaW4gYSBtYW5hZ2VkIHN0YXRlLlxuICAgIC8vIERlZmF1bHRzIHRvIHplcm8uXG4gICAgdGFiSW5kZXg/OiBudW1iZXI7XG5cbiAgICBwbGF5YmFja1BoYXNlOiBQbGF5YmFja1N0YXRlO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBwZXJjZW50YWdlOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBJU2Vla0NTUyBleHRlbmRzIENTU1Byb3BlcnRpZXMge1xuICAgICctLWZpbGxUbyc6IG51bWJlcjtcbn1cblxuY29uc3QgQVJST1dfU0tJUF9TRUNPTkRTID0gNTsgLy8gYXJiaXRyYXJ5XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLmF1ZGlvX21lc3NhZ2VzLlNlZWtCYXJcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlZWtCYXIgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgLy8gV2UgdXNlIGFuIGFuaW1hdGlvbiBmcmFtZSByZXF1ZXN0IHRvIGF2b2lkIG92ZXJseSBzcGFtbWluZyBwcm9wIHVwZGF0ZXMsIGV2ZW4gaWYgd2UgYXJlbid0XG4gICAgLy8gcmVhbGx5IHVzaW5nIGFueXRoaW5nIGRlbWFuZGluZyBvbiB0aGUgQ1NTIGZyb250LlxuXG4gICAgcHJpdmF0ZSBhbmltYXRpb25GcmFtZUZuID0gbmV3IE1hcmtlZEV4ZWN1dGlvbihcbiAgICAgICAgKCkgPT4gdGhpcy5kb1VwZGF0ZSgpLFxuICAgICAgICAoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5hbmltYXRpb25GcmFtZUZuLnRyaWdnZXIoKSkpO1xuXG4gICAgcHVibGljIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgICAgIHRhYkluZGV4OiAwLFxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgcGVyY2VudGFnZTogMCxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBXZSBkb24ndCBuZWVkIHRvIGRlLXJlZ2lzdGVyOiB0aGUgY2xhc3MgaGFuZGxlcyB0aGlzIGZvciB1cyBpbnRlcm5hbGx5XG4gICAgICAgIHRoaXMucHJvcHMucGxheWJhY2suY2xvY2tJbmZvLmxpdmVEYXRhLm9uVXBkYXRlKCgpID0+IHRoaXMuYW5pbWF0aW9uRnJhbWVGbi5tYXJrKCkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZG9VcGRhdGUoKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcGVyY2VudGFnZTogcGVyY2VudGFnZU9mKFxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMucGxheWJhY2suY2xvY2tJbmZvLnRpbWVTZWNvbmRzLFxuICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5wbGF5YmFjay5jbG9ja0luZm8uZHVyYXRpb25TZWNvbmRzKSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGxlZnQoKSB7XG4gICAgICAgIC8vIG5vaW5zcGVjdGlvbiBKU0lnbm9yZWRQcm9taXNlRnJvbUNhbGxcbiAgICAgICAgdGhpcy5wcm9wcy5wbGF5YmFjay5za2lwVG8odGhpcy5wcm9wcy5wbGF5YmFjay5jbG9ja0luZm8udGltZVNlY29uZHMgLSBBUlJPV19TS0lQX1NFQ09ORFMpO1xuICAgIH1cblxuICAgIHB1YmxpYyByaWdodCgpIHtcbiAgICAgICAgLy8gbm9pbnNwZWN0aW9uIEpTSWdub3JlZFByb21pc2VGcm9tQ2FsbFxuICAgICAgICB0aGlzLnByb3BzLnBsYXliYWNrLnNraXBUbyh0aGlzLnByb3BzLnBsYXliYWNrLmNsb2NrSW5mby50aW1lU2Vjb25kcyArIEFSUk9XX1NLSVBfU0VDT05EUyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkNoYW5nZSA9IChldjogQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgLy8gVGhhbmtmdWxseSwgb25DaGFuZ2UgaXMgb25seSBjYWxsZWQgd2hlbiB0aGUgdXNlciBjaGFuZ2VzIHRoZSB2YWx1ZSwgbm90IHdoZW4gd2VcbiAgICAgICAgLy8gY2hhbmdlIHRoZSB2YWx1ZSBvbiB0aGUgY29tcG9uZW50LiBXZSBjYW4gdXNlIHRoaXMgYXMgYSByZWxpYWJsZSBcInNraXAgdG8gWFwiIGZ1bmN0aW9uLlxuICAgICAgICAvL1xuICAgICAgICAvLyBub2luc3BlY3Rpb24gSlNJZ25vcmVkUHJvbWlzZUZyb21DYWxsXG4gICAgICAgIHRoaXMucHJvcHMucGxheWJhY2suc2tpcFRvKE51bWJlcihldi50YXJnZXQudmFsdWUpICogdGhpcy5wcm9wcy5wbGF5YmFjay5jbG9ja0luZm8uZHVyYXRpb25TZWNvbmRzKTtcbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpOiBSZWFjdE5vZGUge1xuICAgICAgICAvLyBXZSB1c2UgYSByYW5nZSBpbnB1dCB0byBhdm9pZCBoYXZpbmcgdG8gcmUtaW52ZW50IGFjY2Vzc2liaWxpdHkgaGFuZGxpbmcgb25cbiAgICAgICAgLy8gYSBjdXN0b20gc2V0IG9mIGRpdnMuXG4gICAgICAgIHJldHVybiA8aW5wdXRcbiAgICAgICAgICAgIHR5cGU9XCJyYW5nZVwiXG4gICAgICAgICAgICBjbGFzc05hbWU9J214X1NlZWtCYXInXG4gICAgICAgICAgICB0YWJJbmRleD17dGhpcy5wcm9wcy50YWJJbmRleH1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uQ2hhbmdlfVxuICAgICAgICAgICAgbWluPXswfVxuICAgICAgICAgICAgbWF4PXsxfVxuICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUucGVyY2VudGFnZX1cbiAgICAgICAgICAgIHN0ZXA9ezAuMDAxfVxuICAgICAgICAgICAgc3R5bGU9e3sgJy0tZmlsbFRvJzogdGhpcy5zdGF0ZS5wZXJjZW50YWdlIH0gYXMgSVNlZWtDU1N9XG4gICAgICAgICAgICBkaXNhYmxlZD17dGhpcy5wcm9wcy5wbGF5YmFja1BoYXNlID09PSBQbGF5YmFja1N0YXRlLkRlY29kaW5nfVxuICAgICAgICAvPjtcbiAgICB9XG59XG4iXX0=