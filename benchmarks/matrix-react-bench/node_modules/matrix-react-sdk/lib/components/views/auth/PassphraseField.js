"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _Validation = _interopRequireDefault(require("../elements/Validation"));

var _languageHandler = require("../../../languageHandler");

var _Field = _interopRequireDefault(require("../elements/Field"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let PassphraseField = (_dec = (0, _replaceableComponent.replaceableComponent)("views.auth.PassphraseField"), _dec(_class = (_temp = _class2 = class PassphraseField extends _react.PureComponent {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "validate", (0, _Validation.default)({
      description: function (complexity) {
        const score = complexity ? complexity.score : 0;
        return /*#__PURE__*/_react.default.createElement("progress", {
          className: "mx_PassphraseField_progress",
          max: 4,
          value: score
        });
      },
      deriveData: async ({
        value
      }) => {
        if (!value) return null;
        const {
          scorePassword
        } = await Promise.resolve().then(() => _interopRequireWildcard(require('../../../utils/PasswordScorer')));
        return scorePassword(value);
      },
      rules: [{
        key: "required",
        test: ({
          value,
          allowEmpty
        }) => allowEmpty || !!value,
        invalid: () => (0, _languageHandler._t)(this.props.labelEnterPassword)
      }, {
        key: "complexity",
        test: async function ({
          value
        }, complexity) {
          if (!value) {
            return false;
          }

          const safe = complexity.score >= this.props.minScore;

          const allowUnsafe = _SdkConfig.default.get()["dangerously_allow_unsafe_and_insecure_passwords"];

          return allowUnsafe || safe;
        },
        valid: function (complexity) {
          // Unsafe passwords that are valid are only possible through a
          // configuration flag. We'll print some helper text to signal
          // to the user that their password is allowed, but unsafe.
          if (complexity.score >= this.props.minScore) {
            return (0, _languageHandler._t)(this.props.labelStrongPassword);
          }

          return (0, _languageHandler._t)(this.props.labelAllowedButUnsafe);
        },
        invalid: function (complexity) {
          if (!complexity) {
            return null;
          }

          const {
            feedback
          } = complexity;
          return feedback.warning || feedback.suggestions[0] || (0, _languageHandler._t)("Keep going...");
        }
      }]
    }));
    (0, _defineProperty2.default)(this, "onValidate", async fieldState => {
      const result = await this.validate(fieldState);

      if (this.props.onValidate) {
        this.props.onValidate(result);
      }

      return result;
    });
  }

  render() {
    return /*#__PURE__*/_react.default.createElement(_Field.default, {
      id: this.props.id,
      autoFocus: this.props.autoFocus,
      className: (0, _classnames.default)("mx_PassphraseField", this.props.className),
      ref: this.props.fieldRef,
      type: "password",
      autoComplete: "new-password",
      label: (0, _languageHandler._t)(this.props.label),
      value: this.props.value,
      onChange: this.props.onChange,
      onValidate: this.onValidate
    });
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  label: (0, _languageHandler._td)("Password"),
  labelEnterPassword: (0, _languageHandler._td)("Enter password"),
  labelStrongPassword: (0, _languageHandler._td)("Nice, strong password!"),
  labelAllowedButUnsafe: (0, _languageHandler._td)("Password is allowed, but unsafe")
}), _temp)) || _class);
var _default = PassphraseField;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2F1dGgvUGFzc3BocmFzZUZpZWxkLnRzeCJdLCJuYW1lcyI6WyJQYXNzcGhyYXNlRmllbGQiLCJQdXJlQ29tcG9uZW50IiwiZGVzY3JpcHRpb24iLCJjb21wbGV4aXR5Iiwic2NvcmUiLCJkZXJpdmVEYXRhIiwidmFsdWUiLCJzY29yZVBhc3N3b3JkIiwicnVsZXMiLCJrZXkiLCJ0ZXN0IiwiYWxsb3dFbXB0eSIsImludmFsaWQiLCJwcm9wcyIsImxhYmVsRW50ZXJQYXNzd29yZCIsInNhZmUiLCJtaW5TY29yZSIsImFsbG93VW5zYWZlIiwiU2RrQ29uZmlnIiwiZ2V0IiwidmFsaWQiLCJsYWJlbFN0cm9uZ1Bhc3N3b3JkIiwibGFiZWxBbGxvd2VkQnV0VW5zYWZlIiwiZmVlZGJhY2siLCJ3YXJuaW5nIiwic3VnZ2VzdGlvbnMiLCJmaWVsZFN0YXRlIiwicmVzdWx0IiwidmFsaWRhdGUiLCJvblZhbGlkYXRlIiwicmVuZGVyIiwiaWQiLCJhdXRvRm9jdXMiLCJjbGFzc05hbWUiLCJmaWVsZFJlZiIsImxhYmVsIiwib25DaGFuZ2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7OztJQW9CTUEsZSxXQURMLGdEQUFxQiw0QkFBckIsQyxtQ0FBRCxNQUNNQSxlQUROLFNBQzhCQyxvQkFEOUIsQ0FDb0Q7QUFBQTtBQUFBO0FBQUEsb0RBUXJCLHlCQUEwQztBQUNqRUMsTUFBQUEsV0FBVyxFQUFFLFVBQVNDLFVBQVQsRUFBcUI7QUFDOUIsY0FBTUMsS0FBSyxHQUFHRCxVQUFVLEdBQUdBLFVBQVUsQ0FBQ0MsS0FBZCxHQUFzQixDQUE5QztBQUNBLDRCQUFPO0FBQVUsVUFBQSxTQUFTLEVBQUMsNkJBQXBCO0FBQWtELFVBQUEsR0FBRyxFQUFFLENBQXZEO0FBQTBELFVBQUEsS0FBSyxFQUFFQTtBQUFqRSxVQUFQO0FBQ0gs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LEtBQUwsQ0FBV1AsS0FSZjtBQVNILE1BQUEsUUFBUSxFQUFFLEtBQUtPLEtBQUwsQ0FBV3VCLFFBVGxCO0FBVUgsTUFBQSxVQUFVLEVBQUUsS0FBS1A7QUFWZCxNQUFQO0FBWUg7O0FBM0UrQyxDLHlEQUMxQjtBQUNsQk0sRUFBQUEsS0FBSyxFQUFFLDBCQUFJLFVBQUosQ0FEVztBQUVsQnJCLEVBQUFBLGtCQUFrQixFQUFFLDBCQUFJLGdCQUFKLENBRkY7QUFHbEJPLEVBQUFBLG1CQUFtQixFQUFFLDBCQUFJLHdCQUFKLENBSEg7QUFJbEJDLEVBQUFBLHFCQUFxQixFQUFFLDBCQUFJLGlDQUFKO0FBSkwsQztlQTZFWHRCLGUiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgUHVyZUNvbXBvbmVudCwgUmVmQ2FsbGJhY2ssIFJlZk9iamVjdCB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSBcImNsYXNzbmFtZXNcIjtcbmltcG9ydCB6eGN2Ym4gZnJvbSBcInp4Y3ZiblwiO1xuXG5pbXBvcnQgU2RrQ29uZmlnIGZyb20gXCIuLi8uLi8uLi9TZGtDb25maWdcIjtcbmltcG9ydCB3aXRoVmFsaWRhdGlvbiwgeyBJRmllbGRTdGF0ZSwgSVZhbGlkYXRpb25SZXN1bHQgfSBmcm9tIFwiLi4vZWxlbWVudHMvVmFsaWRhdGlvblwiO1xuaW1wb3J0IHsgX3QsIF90ZCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBGaWVsZCwgeyBJSW5wdXRQcm9wcyB9IGZyb20gXCIuLi9lbGVtZW50cy9GaWVsZFwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcblxuaW50ZXJmYWNlIElQcm9wcyBleHRlbmRzIE9taXQ8SUlucHV0UHJvcHMsIFwib25WYWxpZGF0ZVwiPiB7XG4gICAgYXV0b0ZvY3VzPzogYm9vbGVhbjtcbiAgICBpZD86IHN0cmluZztcbiAgICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gICAgbWluU2NvcmU6IDAgfCAxIHwgMiB8IDMgfCA0O1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgZmllbGRSZWY/OiBSZWZDYWxsYmFjazxGaWVsZD4gfCBSZWZPYmplY3Q8RmllbGQ+O1xuXG4gICAgbGFiZWw/OiBzdHJpbmc7XG4gICAgbGFiZWxFbnRlclBhc3N3b3JkPzogc3RyaW5nO1xuICAgIGxhYmVsU3Ryb25nUGFzc3dvcmQ/OiBzdHJpbmc7XG4gICAgbGFiZWxBbGxvd2VkQnV0VW5zYWZlPzogc3RyaW5nO1xuXG4gICAgb25DaGFuZ2UoZXY6IFJlYWN0LkZvcm1FdmVudDxIVE1MRWxlbWVudD4pO1xuICAgIG9uVmFsaWRhdGU/KHJlc3VsdDogSVZhbGlkYXRpb25SZXN1bHQpO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5hdXRoLlBhc3NwaHJhc2VGaWVsZFwiKVxuY2xhc3MgUGFzc3BocmFzZUZpZWxkIGV4dGVuZHMgUHVyZUNvbXBvbmVudDxJUHJvcHM+IHtcbiAgICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgICBsYWJlbDogX3RkKFwiUGFzc3dvcmRcIiksXG4gICAgICAgIGxhYmVsRW50ZXJQYXNzd29yZDogX3RkKFwiRW50ZXIgcGFzc3dvcmRcIiksXG4gICAgICAgIGxhYmVsU3Ryb25nUGFzc3dvcmQ6IF90ZChcIk5pY2UsIHN0cm9uZyBwYXNzd29yZCFcIiksXG4gICAgICAgIGxhYmVsQWxsb3dlZEJ1dFVuc2FmZTogX3RkKFwiUGFzc3dvcmQgaXMgYWxsb3dlZCwgYnV0IHVuc2FmZVwiKSxcbiAgICB9O1xuXG4gICAgcHVibGljIHJlYWRvbmx5IHZhbGlkYXRlID0gd2l0aFZhbGlkYXRpb248dGhpcywgenhjdmJuLlpYQ1ZCTlJlc3VsdD4oe1xuICAgICAgICBkZXNjcmlwdGlvbjogZnVuY3Rpb24oY29tcGxleGl0eSkge1xuICAgICAgICAgICAgY29uc3Qgc2NvcmUgPSBjb21wbGV4aXR5ID8gY29tcGxleGl0eS5zY29yZSA6IDA7XG4gICAgICAgICAgICByZXR1cm4gPHByb2dyZXNzIGNsYXNzTmFtZT1cIm14X1Bhc3NwaHJhc2VGaWVsZF9wcm9ncmVzc1wiIG1heD17NH0gdmFsdWU9e3Njb3JlfSAvPjtcbiAgICAgICAgfSxcbiAgICAgICAgZGVyaXZlRGF0YTogYXN5bmMgKHsgdmFsdWUgfSkgPT4ge1xuICAgICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IHNjb3JlUGFzc3dvcmQgfSA9IGF3YWl0IGltcG9ydCgnLi4vLi4vLi4vdXRpbHMvUGFzc3dvcmRTY29yZXInKTtcbiAgICAgICAgICAgIHJldHVybiBzY29yZVBhc3N3b3JkKHZhbHVlKTtcbiAgICAgICAgfSxcbiAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBrZXk6IFwicmVxdWlyZWRcIixcbiAgICAgICAgICAgICAgICB0ZXN0OiAoeyB2YWx1ZSwgYWxsb3dFbXB0eSB9KSA9PiBhbGxvd0VtcHR5IHx8ICEhdmFsdWUsXG4gICAgICAgICAgICAgICAgaW52YWxpZDogKCkgPT4gX3QodGhpcy5wcm9wcy5sYWJlbEVudGVyUGFzc3dvcmQpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBrZXk6IFwiY29tcGxleGl0eVwiLFxuICAgICAgICAgICAgICAgIHRlc3Q6IGFzeW5jIGZ1bmN0aW9uKHsgdmFsdWUgfSwgY29tcGxleGl0eSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FmZSA9IGNvbXBsZXhpdHkuc2NvcmUgPj0gdGhpcy5wcm9wcy5taW5TY29yZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxsb3dVbnNhZmUgPSBTZGtDb25maWcuZ2V0KClbXCJkYW5nZXJvdXNseV9hbGxvd191bnNhZmVfYW5kX2luc2VjdXJlX3Bhc3N3b3Jkc1wiXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbG93VW5zYWZlIHx8IHNhZmU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWxpZDogZnVuY3Rpb24oY29tcGxleGl0eSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVbnNhZmUgcGFzc3dvcmRzIHRoYXQgYXJlIHZhbGlkIGFyZSBvbmx5IHBvc3NpYmxlIHRocm91Z2ggYVxuICAgICAgICAgICAgICAgICAgICAvLyBjb25maWd1cmF0aW9uIGZsYWcuIFdlJ2xsIHByaW50IHNvbWUgaGVscGVyIHRleHQgdG8gc2lnbmFsXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvIHRoZSB1c2VyIHRoYXQgdGhlaXIgcGFzc3dvcmQgaXMgYWxsb3dlZCwgYnV0IHVuc2FmZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBsZXhpdHkuc2NvcmUgPj0gdGhpcy5wcm9wcy5taW5TY29yZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90KHRoaXMucHJvcHMubGFiZWxTdHJvbmdQYXNzd29yZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90KHRoaXMucHJvcHMubGFiZWxBbGxvd2VkQnV0VW5zYWZlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGludmFsaWQ6IGZ1bmN0aW9uKGNvbXBsZXhpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb21wbGV4aXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrIH0gPSBjb21wbGV4aXR5O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmVlZGJhY2sud2FybmluZyB8fCBmZWVkYmFjay5zdWdnZXN0aW9uc1swXSB8fCBfdChcIktlZXAgZ29pbmcuLi5cIik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBvblZhbGlkYXRlID0gYXN5bmMgKGZpZWxkU3RhdGU6IElGaWVsZFN0YXRlKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudmFsaWRhdGUoZmllbGRTdGF0ZSk7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uVmFsaWRhdGUpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25WYWxpZGF0ZShyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIDxGaWVsZFxuICAgICAgICAgICAgaWQ9e3RoaXMucHJvcHMuaWR9XG4gICAgICAgICAgICBhdXRvRm9jdXM9e3RoaXMucHJvcHMuYXV0b0ZvY3VzfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfUGFzc3BocmFzZUZpZWxkXCIsIHRoaXMucHJvcHMuY2xhc3NOYW1lKX1cbiAgICAgICAgICAgIHJlZj17dGhpcy5wcm9wcy5maWVsZFJlZn1cbiAgICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJuZXctcGFzc3dvcmRcIlxuICAgICAgICAgICAgbGFiZWw9e190KHRoaXMucHJvcHMubGFiZWwpfVxuICAgICAgICAgICAgdmFsdWU9e3RoaXMucHJvcHMudmFsdWV9XG4gICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5wcm9wcy5vbkNoYW5nZX1cbiAgICAgICAgICAgIG9uVmFsaWRhdGU9e3RoaXMub25WYWxpZGF0ZX1cbiAgICAgICAgLz47XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQYXNzcGhyYXNlRmllbGQ7XG4iXX0=