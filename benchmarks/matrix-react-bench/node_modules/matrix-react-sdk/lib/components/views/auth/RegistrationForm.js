"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.PASSWORD_MIN_SCORE = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var Email = _interopRequireWildcard(require("../../../email"));

var _phonenumber = require("../../../phonenumber");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _languageHandler = require("../../../languageHandler");

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _Registration = require("../../../Registration");

var _Validation = _interopRequireDefault(require("../elements/Validation"));

var _EmailField = _interopRequireDefault(require("./EmailField"));

var _PassphraseField = _interopRequireDefault(require("./PassphraseField"));

var _CountlyAnalytics = _interopRequireDefault(require("../../../CountlyAnalytics"));

var _Field = _interopRequireDefault(require("../elements/Field"));

var _RegistrationEmailPromptDialog = _interopRequireDefault(require("../dialogs/RegistrationEmailPromptDialog"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _CountryDropdown = _interopRequireDefault(require("./CountryDropdown"));

var _logger = require("matrix-js-sdk/src/logger");

var _PassphraseConfirmField = _interopRequireDefault(require("./PassphraseConfirmField"));

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

var RegistrationField;

(function (RegistrationField) {
  RegistrationField["Email"] = "field_email";
  RegistrationField["PhoneNumber"] = "field_phone_number";
  RegistrationField["Username"] = "field_username";
  RegistrationField["Password"] = "field_password";
  RegistrationField["PasswordConfirm"] = "field_password_confirm";
})(RegistrationField || (RegistrationField = {}));

const PASSWORD_MIN_SCORE = 3; // safely unguessable: moderate protection from offline slow-hash scenario.

exports.PASSWORD_MIN_SCORE = PASSWORD_MIN_SCORE;
let RegistrationForm = (
/*
 * A pure UI component which displays a registration form.
 */
_dec = (0, _replaceableComponent.replaceableComponent)("views.auth.RegistrationForm"), _dec(_class = (_temp = _class2 = class RegistrationForm extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onSubmit", async ev => {
      ev.preventDefault();
      ev.persist();
      if (!this.props.canSubmit) return;
      const allFieldsValid = await this.verifyFieldsBeforeSubmit();

      if (!allFieldsValid) {
        _CountlyAnalytics.default.instance.track("onboarding_registration_submit_failed");

        return;
      }

      if (this.state.email === '') {
        if (this.showEmail()) {
          _CountlyAnalytics.default.instance.track("onboarding_registration_submit_warn");

          _Modal.default.createTrackedDialog("Email prompt dialog", '', _RegistrationEmailPromptDialog.default, {
            onFinished: async (confirmed, email) => {
              if (confirmed) {
                this.setState({
                  email
                }, () => {
                  this.doSubmit(ev);
                });
              }
            }
          });
        } else {
          // user can't set an e-mail so don't prompt them to
          this.doSubmit(ev);
          return;
        }
      } else {
        this.doSubmit(ev);
      }
    });
    (0, _defineProperty2.default)(this, "onEmailChange", ev => {
      this.setState({
        email: ev.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onEmailValidate", result => {
      this.markFieldValid(RegistrationField.Email, result.valid);
    });
    (0, _defineProperty2.default)(this, "validateEmailRules", (0, _Validation.default)({
      description: () => (0, _languageHandler._t)("Use an email address to recover your account"),
      hideDescriptionIfValid: true,
      rules: [{
        key: "required",

        test({
          value,
          allowEmpty
        }) {
          return allowEmpty || !this.authStepIsRequired('m.login.email.identity') || !!value;
        },

        invalid: () => (0, _languageHandler._t)("Enter email address (required on this homeserver)")
      }, {
        key: "email",
        test: ({
          value
        }) => !value || Email.looksValid(value),
        invalid: () => (0, _languageHandler._t)("Doesn't look like a valid email address")
      }]
    }));
    (0, _defineProperty2.default)(this, "onPasswordChange", ev => {
      this.setState({
        password: ev.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onPasswordValidate", result => {
      this.markFieldValid(RegistrationField.Password, result.valid);
    });
    (0, _defineProperty2.default)(this, "onPasswordConfirmChange", ev => {
      this.setState({
        passwordConfirm: ev.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onPasswordConfirmValidate", result => {
      this.markFieldValid(RegistrationField.PasswordConfirm, result.valid);
    });
    (0, _defineProperty2.default)(this, "onPhoneCountryChange", newVal => {
      this.setState({
        phoneCountry: newVal.iso2
      });
    });
    (0, _defineProperty2.default)(this, "onPhoneNumberChange", ev => {
      this.setState({
        phoneNumber: ev.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onPhoneNumberValidate", async fieldState => {
      const result = await this.validatePhoneNumberRules(fieldState);
      this.markFieldValid(RegistrationField.PhoneNumber, result.valid);
      return result;
    });
    (0, _defineProperty2.default)(this, "validatePhoneNumberRules", (0, _Validation.default)({
      description: () => (0, _languageHandler._t)("Other users can invite you to rooms using your contact details"),
      hideDescriptionIfValid: true,
      rules: [{
        key: "required",

        test({
          value,
          allowEmpty
        }) {
          return allowEmpty || !this.authStepIsRequired('m.login.msisdn') || !!value;
        },

        invalid: () => (0, _languageHandler._t)("Enter phone number (required on this homeserver)")
      }, {
        key: "email",
        test: ({
          value
        }) => !value || (0, _phonenumber.looksValid)(value),
        invalid: () => (0, _languageHandler._t)("That phone number doesn't look quite right, please check and try again")
      }]
    }));
    (0, _defineProperty2.default)(this, "onUsernameChange", ev => {
      this.setState({
        username: ev.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onUsernameValidate", async fieldState => {
      const result = await this.validateUsernameRules(fieldState);
      this.markFieldValid(RegistrationField.Username, result.valid);
      return result;
    });
    (0, _defineProperty2.default)(this, "validateUsernameRules", (0, _Validation.default)({
      description: (_, results) => {
        // omit the description if the only failing result is the `available` one as it makes no sense for it.
        if (results.every(({
          key,
          valid
        }) => key === "available" || valid)) return;
        return (0, _languageHandler._t)("Use lowercase letters, numbers, dashes and underscores only");
      },
      hideDescriptionIfValid: true,
      rules: [{
        key: "required",
        test: ({
          value,
          allowEmpty
        }) => allowEmpty || !!value,
        invalid: () => (0, _languageHandler._t)("Enter username")
      }, {
        key: "safeLocalpart",
        test: ({
          value
        }) => !value || _Registration.SAFE_LOCALPART_REGEX.test(value),
        invalid: () => (0, _languageHandler._t)("Some characters not allowed")
      }, {
        key: "available",
        final: true,
        test: async ({
          value
        }) => {
          if (!value) {
            return true;
          }

          try {
            await this.props.matrixClient.isUsernameAvailable(value);
            return true;
          } catch (err) {
            return false;
          }
        },
        invalid: () => (0, _languageHandler._t)("Someone already has that username. Try another or if it is you, sign in below.")
      }]
    }));
    this.state = {
      fieldValid: {},
      phoneCountry: this.props.defaultPhoneCountry,
      username: this.props.defaultUsername || "",
      email: this.props.defaultEmail || "",
      phoneNumber: this.props.defaultPhoneNumber || "",
      password: this.props.defaultPassword || "",
      passwordConfirm: this.props.defaultPassword || "",
      passwordComplexity: null
    };

    _CountlyAnalytics.default.instance.track("onboarding_registration_begin");
  }

  doSubmit(ev) {
    const email = this.state.email.trim();

    _CountlyAnalytics.default.instance.track("onboarding_registration_submit_ok", {
      email: !!email
    });

    const promise = this.props.onRegisterClick({
      username: this.state.username.trim(),
      password: this.state.password.trim(),
      email: email,
      phoneCountry: this.state.phoneCountry,
      phoneNumber: this.state.phoneNumber
    });

    if (promise) {
      ev.target.disabled = true;
      promise.finally(function () {
        ev.target.disabled = false;
      });
    }
  }

  async verifyFieldsBeforeSubmit() {
    // Blur the active element if any, so we first run its blur validation,
    // which is less strict than the pass we're about to do below for all fields.
    const activeElement = document.activeElement;

    if (activeElement) {
      activeElement.blur();
    }

    const fieldIDsInDisplayOrder = [RegistrationField.Username, RegistrationField.Password, RegistrationField.PasswordConfirm, RegistrationField.Email, RegistrationField.PhoneNumber]; // Run all fields with stricter validation that no longer allows empty
    // values for required fields.

    for (const fieldID of fieldIDsInDisplayOrder) {
      const field = this[fieldID];

      if (!field) {
        continue;
      } // We must wait for these validations to finish before queueing
      // up the setState below so our setState goes in the queue after
      // all the setStates from these validate calls (that's how we
      // know they've finished).


      await field.validate({
        allowEmpty: false
      });
    } // Validation and state updates are async, so we need to wait for them to complete
    // first. Queue a `setState` callback and wait for it to resolve.


    await new Promise(resolve => this.setState({}, resolve));

    if (this.allFieldsValid()) {
      return true;
    }

    const invalidField = this.findFirstInvalidField(fieldIDsInDisplayOrder);

    if (!invalidField) {
      return true;
    } // Focus the first invalid field and show feedback in the stricter mode
    // that no longer allows empty values for required fields.


    invalidField.focus();
    invalidField.validate({
      allowEmpty: false,
      focused: true
    });
    return false;
  }
  /**
   * @returns {boolean} true if all fields were valid last time they were validated.
   */


  allFieldsValid() {
    const keys = Object.keys(this.state.fieldValid);

    for (let i = 0; i < keys.length; ++i) {
      if (!this.state.fieldValid[keys[i]]) {
        return false;
      }
    }

    return true;
  }

  findFirstInvalidField(fieldIDs) {
    for (const fieldID of fieldIDs) {
      if (!this.state.fieldValid[fieldID] && this[fieldID]) {
        return this[fieldID];
      }
    }

    return null;
  }

  markFieldValid(fieldID, valid) {
    const {
      fieldValid
    } = this.state;
    fieldValid[fieldID] = valid;
    this.setState({
      fieldValid
    });
  }

  /**
   * A step is required if all flows include that step.
   *
   * @param {string} step A stage name to check
   * @returns {boolean} Whether it is required
   */
  authStepIsRequired(step) {
    return this.props.flows.every(flow => {
      return flow.stages.includes(step);
    });
  }
  /**
   * A step is used if any flows include that step.
   *
   * @param {string} step A stage name to check
   * @returns {boolean} Whether it is used
   */


  authStepIsUsed(step) {
    return this.props.flows.some(flow => {
      return flow.stages.includes(step);
    });
  }

  showEmail() {
    if (!this.authStepIsUsed('m.login.email.identity')) {
      return false;
    }

    return true;
  }

  showPhoneNumber() {
    const threePidLogin = !_SdkConfig.default.get().disable_3pid_login;

    if (!threePidLogin || !this.authStepIsUsed('m.login.msisdn')) {
      return false;
    }

    return true;
  }

  renderEmail() {
    if (!this.showEmail()) {
      return null;
    }

    const emailLabel = this.authStepIsRequired('m.login.email.identity') ? (0, _languageHandler._t)("Email") : (0, _languageHandler._t)("Email (optional)");
    return /*#__PURE__*/_react.default.createElement(_EmailField.default, {
      fieldRef: field => this[RegistrationField.Email] = field,
      label: emailLabel,
      value: this.state.email,
      validationRules: this.validateEmailRules.bind(this),
      onChange: this.onEmailChange,
      onValidate: this.onEmailValidate,
      onFocus: () => _CountlyAnalytics.default.instance.track("onboarding_registration_email_focus"),
      onBlur: () => _CountlyAnalytics.default.instance.track("onboarding_registration_email_blur")
    });
  }

  renderPassword() {
    return /*#__PURE__*/_react.default.createElement(_PassphraseField.default, {
      id: "mx_RegistrationForm_password",
      fieldRef: field => this[RegistrationField.Password] = field,
      minScore: PASSWORD_MIN_SCORE,
      value: this.state.password,
      onChange: this.onPasswordChange,
      onValidate: this.onPasswordValidate,
      onFocus: () => _CountlyAnalytics.default.instance.track("onboarding_registration_password_focus"),
      onBlur: () => _CountlyAnalytics.default.instance.track("onboarding_registration_password_blur")
    });
  }

  renderPasswordConfirm() {
    return /*#__PURE__*/_react.default.createElement(_PassphraseConfirmField.default, {
      id: "mx_RegistrationForm_passwordConfirm",
      fieldRef: field => this[RegistrationField.PasswordConfirm] = field,
      autoComplete: "new-password",
      value: this.state.passwordConfirm,
      password: this.state.password,
      onChange: this.onPasswordConfirmChange,
      onValidate: this.onPasswordConfirmValidate,
      onFocus: () => _CountlyAnalytics.default.instance.track("onboarding_registration_passwordConfirm_focus"),
      onBlur: () => _CountlyAnalytics.default.instance.track("onboarding_registration_passwordConfirm_blur")
    });
  }

  renderPhoneNumber() {
    if (!this.showPhoneNumber()) {
      return null;
    }

    const phoneLabel = this.authStepIsRequired('m.login.msisdn') ? (0, _languageHandler._t)("Phone") : (0, _languageHandler._t)("Phone (optional)");

    const phoneCountry = /*#__PURE__*/_react.default.createElement(_CountryDropdown.default, {
      value: this.state.phoneCountry,
      isSmall: true,
      showPrefix: true,
      onOptionChange: this.onPhoneCountryChange
    });

    return /*#__PURE__*/_react.default.createElement(_Field.default, {
      ref: field => this[RegistrationField.PhoneNumber] = field,
      type: "text",
      label: phoneLabel,
      value: this.state.phoneNumber,
      prefixComponent: phoneCountry,
      onChange: this.onPhoneNumberChange,
      onValidate: this.onPhoneNumberValidate
    });
  }

  renderUsername() {
    return /*#__PURE__*/_react.default.createElement(_Field.default, {
      id: "mx_RegistrationForm_username",
      ref: field => this[RegistrationField.Username] = field,
      type: "text",
      autoFocus: true,
      label: (0, _languageHandler._t)("Username"),
      placeholder: (0, _languageHandler._t)("Username").toLocaleLowerCase(),
      value: this.state.username,
      onChange: this.onUsernameChange,
      onValidate: this.onUsernameValidate,
      onFocus: () => _CountlyAnalytics.default.instance.track("onboarding_registration_username_focus"),
      onBlur: () => _CountlyAnalytics.default.instance.track("onboarding_registration_username_blur")
    });
  }

  render() {
    const registerButton = /*#__PURE__*/_react.default.createElement("input", {
      className: "mx_Login_submit",
      type: "submit",
      value: (0, _languageHandler._t)("Register"),
      disabled: !this.props.canSubmit
    });

    let emailHelperText = null;

    if (this.showEmail()) {
      if (this.showPhoneNumber()) {
        emailHelperText = /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Add an email to be able to reset your password."), " ", (0, _languageHandler._t)("Use email or phone to optionally be discoverable by existing contacts."));
      } else {
        emailHelperText = /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Add an email to be able to reset your password."), " ", (0, _languageHandler._t)("Use email to optionally be discoverable by existing contacts."));
      }
    }

    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onSubmit
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AuthBody_fieldRow"
    }, this.renderUsername()), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AuthBody_fieldRow"
    }, this.renderPassword(), this.renderPasswordConfirm()), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AuthBody_fieldRow"
    }, this.renderEmail(), this.renderPhoneNumber()), emailHelperText, registerButton));
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  onValidationChange: _logger.logger.error,
  canSubmit: true
}), _temp)) || _class);
exports.default = RegistrationForm;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2F1dGgvUmVnaXN0cmF0aW9uRm9ybS50c3giXSwibmFtZXMiOlsiUmVnaXN0cmF0aW9uRmllbGQiLCJQQVNTV09SRF9NSU5fU0NPUkUiLCJSZWdpc3RyYXRpb25Gb3JtIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImV2IiwicHJldmVudERlZmF1bHQiLCJwZXJzaXN0IiwiY2FuU3VibWl0IiwiYWxsRmllbGRzVmFsaWQiLCJ2ZXJpZnlGaWVsZHNCZWZvcmVTdWJtaXQiLCJDb3VudGx5QW5hbHl0aWNzIiwiaW5zdGFuY2UiLCJ0cmFjayIsInN0YXRlIiwiZW1haWwiLCJzaG93RW1haWwiLCJNb2RhbCIsImNyZWF0ZVRyYWNrZWREaWFsb2ciLCJSZWdpc3RyYXRpb25FbWFpbFByb21wdERpYWxvZyIsIm9uRmluaXNoZWQiLCJjb25maXJtZWQiLCJzZXRTdGF0ZSIsImRvU3VibWl0IiwidGFyZ2V0IiwidmFsdWUiLCJyZXN1bHQiLCJtYXJrRmllbGRWYWxpZCIsIkVtYWlsIiwidmFsaWQiLCJkZXNjcmlwdGlvbiIsImhpZGVEZXNjcmlwdGlvbklmVmFsaWQiLCJydWxlcyIsImtleSIsInRlc3QiLCJhbGxvd0VtcHR5IiwiYXV0aFN0ZXBJc1JlcXVpcmVkIiwiaW52YWxpZCIsImxvb2tzVmFsaWQiLCJwYXNzd29yZCIsIlBhc3N3b3JkIiwicGFzc3dvcmRDb25maXJtIiwiUGFzc3dvcmRDb25maXJtIiwibmV3VmFsIiwicGhvbmVDb3VudHJ5IiwiaXNvMiIsInBob25lTnVtYmVyIiwiZmllbGRTdGF0ZSIsInZhbGlkYXRlUGhvbmVOdW1iZXJSdWxlcyIsIlBob25lTnVtYmVyIiwidXNlcm5hbWUiLCJ2YWxpZGF0ZVVzZXJuYW1lUnVsZXMiLCJVc2VybmFtZSIsIl8iLCJyZXN1bHRzIiwiZXZlcnkiLCJTQUZFX0xPQ0FMUEFSVF9SRUdFWCIsImZpbmFsIiwibWF0cml4Q2xpZW50IiwiaXNVc2VybmFtZUF2YWlsYWJsZSIsImVyciIsImZpZWxkVmFsaWQiLCJkZWZhdWx0UGhvbmVDb3VudHJ5IiwiZGVmYXVsdFVzZXJuYW1lIiwiZGVmYXVsdEVtYWlsIiwiZGVmYXVsdFBob25lTnVtYmVyIiwiZGVmYXVsdFBhc3N3b3JkIiwicGFzc3dvcmRDb21wbGV4aXR5IiwidHJpbSIsInByb21pc2UiLCJvblJlZ2lzdGVyQ2xpY2siLCJkaXNhYmxlZCIsImZpbmFsbHkiLCJhY3RpdmVFbGVtZW50IiwiZG9jdW1lbnQiLCJibHVyIiwiZmllbGRJRHNJbkRpc3BsYXlPcmRlciIsImZpZWxkSUQiLCJmaWVsZCIsInZhbGlkYXRlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJpbnZhbGlkRmllbGQiLCJmaW5kRmlyc3RJbnZhbGlkRmllbGQiLCJmb2N1cyIsImZvY3VzZWQiLCJrZXlzIiwiT2JqZWN0IiwiaSIsImxlbmd0aCIsImZpZWxkSURzIiwic3RlcCIsImZsb3dzIiwiZmxvdyIsInN0YWdlcyIsImluY2x1ZGVzIiwiYXV0aFN0ZXBJc1VzZWQiLCJzb21lIiwic2hvd1Bob25lTnVtYmVyIiwidGhyZWVQaWRMb2dpbiIsIlNka0NvbmZpZyIsImdldCIsImRpc2FibGVfM3BpZF9sb2dpbiIsInJlbmRlckVtYWlsIiwiZW1haWxMYWJlbCIsInZhbGlkYXRlRW1haWxSdWxlcyIsImJpbmQiLCJvbkVtYWlsQ2hhbmdlIiwib25FbWFpbFZhbGlkYXRlIiwicmVuZGVyUGFzc3dvcmQiLCJvblBhc3N3b3JkQ2hhbmdlIiwib25QYXNzd29yZFZhbGlkYXRlIiwicmVuZGVyUGFzc3dvcmRDb25maXJtIiwib25QYXNzd29yZENvbmZpcm1DaGFuZ2UiLCJvblBhc3N3b3JkQ29uZmlybVZhbGlkYXRlIiwicmVuZGVyUGhvbmVOdW1iZXIiLCJwaG9uZUxhYmVsIiwib25QaG9uZUNvdW50cnlDaGFuZ2UiLCJvblBob25lTnVtYmVyQ2hhbmdlIiwib25QaG9uZU51bWJlclZhbGlkYXRlIiwicmVuZGVyVXNlcm5hbWUiLCJ0b0xvY2FsZUxvd2VyQ2FzZSIsIm9uVXNlcm5hbWVDaGFuZ2UiLCJvblVzZXJuYW1lVmFsaWRhdGUiLCJyZW5kZXIiLCJyZWdpc3RlckJ1dHRvbiIsImVtYWlsSGVscGVyVGV4dCIsIm9uU3VibWl0Iiwib25WYWxpZGF0aW9uQ2hhbmdlIiwibG9nZ2VyIiwiZXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOzs7Ozs7OztJQUVLQSxpQjs7V0FBQUEsaUI7QUFBQUEsRUFBQUEsaUI7QUFBQUEsRUFBQUEsaUI7QUFBQUEsRUFBQUEsaUI7QUFBQUEsRUFBQUEsaUI7QUFBQUEsRUFBQUEsaUI7R0FBQUEsaUIsS0FBQUEsaUI7O0FBUUUsTUFBTUMsa0JBQWtCLEdBQUcsQ0FBM0IsQyxDQUE4Qjs7O0lBMkNoQkMsZ0I7QUFKckI7QUFDQTtBQUNBO09BQ0MsZ0RBQXFCLDZCQUFyQixDLG1DQUFELE1BQ3FCQSxnQkFEckIsU0FDOENDLGVBQU1DLGFBRHBELENBQ2tGO0FBTTlFQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBUTtBQUNmLFVBQU1BLEtBQU47QUFEZSxvREFpQkEsTUFBTUMsRUFBTixJQUFZO0FBQzNCQSxNQUFBQSxFQUFFLENBQUNDLGNBQUg7QUFDQUQsTUFBQUEsRUFBRSxDQUFDRSxPQUFIO0FBRUEsVUFBSSxDQUFDLEtBQUtILEtBQUwsQ0FBV0ksU0FBaEIsRUFBMkI7QUFFM0IsWUFBTUMsY0FBYyxHQUFHLE1BQU0sS0FBS0Msd0JBQUwsRUFBN0I7O0FBQ0EsVUFBSSxDQUFDRCxjQUFMLEVBQXFCO0FBQ2pCRSxrQ0FBaUJDLFFBQWpCLENBQTBCQyxLQUExQixDQUFnQyx1Q0FBaEM7O0FBQ0E7QUFDSDs7QUFFRCxVQUFJLEtBQUtDLEtBQUwsQ0FBV0MsS0FBWCxLQUFxQixFQUF6QixFQUE2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QUFILENBRlUsT0FJVix5QkFBRywrREFBSCxDQUpVLENBQWxCO0FBT0g7QUFDSjs7QUFFRCx3QkFDSSx1REFDSTtBQUFNLE1BQUEsUUFBUSxFQUFFLEtBQUtDO0FBQXJCLG9CQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNNLEtBQUtQLGNBQUwsRUFETixDQURKLGVBSUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQ00sS0FBS1gsY0FBTCxFQUROLEVBRU0sS0FBS0cscUJBQUwsRUFGTixDQUpKLGVBUUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQ00sS0FBS1QsV0FBTCxFQUROLEVBRU0sS0FBS1ksaUJBQUwsRUFGTixDQVJKLEVBWU1XLGVBWk4sRUFhTUQsY0FiTixDQURKLENBREo7QUFtQkg7O0FBcmQ2RSxDLHlEQUN4RDtBQUNsQkcsRUFBQUEsa0JBQWtCLEVBQUVDLGVBQU9DLEtBRFQ7QUFFbEIxSCxFQUFBQSxTQUFTLEVBQUU7QUFGTyxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE1pY2hhZWwgVGVsYXR5bnNraSA8N3QzY2hndXlAZ21haWwuY29tPlxuQ29weXJpZ2h0IDIwMTUsIDIwMTYsIDIwMTcsIDIwMTgsIDIwMTksIDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50IH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvY2xpZW50JztcblxuaW1wb3J0ICogYXMgRW1haWwgZnJvbSAnLi4vLi4vLi4vZW1haWwnO1xuaW1wb3J0IHsgbG9va3NWYWxpZCBhcyBwaG9uZU51bWJlckxvb2tzVmFsaWQgfSBmcm9tICcuLi8uLi8uLi9waG9uZW51bWJlcic7XG5pbXBvcnQgTW9kYWwgZnJvbSAnLi4vLi4vLi4vTW9kYWwnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IFNka0NvbmZpZyBmcm9tICcuLi8uLi8uLi9TZGtDb25maWcnO1xuaW1wb3J0IHsgU0FGRV9MT0NBTFBBUlRfUkVHRVggfSBmcm9tICcuLi8uLi8uLi9SZWdpc3RyYXRpb24nO1xuaW1wb3J0IHdpdGhWYWxpZGF0aW9uLCB7IElWYWxpZGF0aW9uUmVzdWx0IH0gZnJvbSAnLi4vZWxlbWVudHMvVmFsaWRhdGlvbic7XG5pbXBvcnQgeyBWYWxpZGF0ZWRTZXJ2ZXJDb25maWcgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvQXV0b0Rpc2NvdmVyeVV0aWxzXCI7XG5pbXBvcnQgRW1haWxGaWVsZCBmcm9tIFwiLi9FbWFpbEZpZWxkXCI7XG5pbXBvcnQgUGFzc3BocmFzZUZpZWxkIGZyb20gXCIuL1Bhc3NwaHJhc2VGaWVsZFwiO1xuaW1wb3J0IENvdW50bHlBbmFseXRpY3MgZnJvbSBcIi4uLy4uLy4uL0NvdW50bHlBbmFseXRpY3NcIjtcbmltcG9ydCBGaWVsZCBmcm9tICcuLi9lbGVtZW50cy9GaWVsZCc7XG5pbXBvcnQgUmVnaXN0cmF0aW9uRW1haWxQcm9tcHREaWFsb2cgZnJvbSAnLi4vZGlhbG9ncy9SZWdpc3RyYXRpb25FbWFpbFByb21wdERpYWxvZyc7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IENvdW50cnlEcm9wZG93biBmcm9tIFwiLi9Db3VudHJ5RHJvcGRvd25cIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuaW1wb3J0IFBhc3NwaHJhc2VDb25maXJtRmllbGQgZnJvbSBcIi4vUGFzc3BocmFzZUNvbmZpcm1GaWVsZFwiO1xuXG5lbnVtIFJlZ2lzdHJhdGlvbkZpZWxkIHtcbiAgICBFbWFpbCA9IFwiZmllbGRfZW1haWxcIixcbiAgICBQaG9uZU51bWJlciA9IFwiZmllbGRfcGhvbmVfbnVtYmVyXCIsXG4gICAgVXNlcm5hbWUgPSBcImZpZWxkX3VzZXJuYW1lXCIsXG4gICAgUGFzc3dvcmQgPSBcImZpZWxkX3Bhc3N3b3JkXCIsXG4gICAgUGFzc3dvcmRDb25maXJtID0gXCJmaWVsZF9wYXNzd29yZF9jb25maXJtXCIsXG59XG5cbmV4cG9ydCBjb25zdCBQQVNTV09SRF9NSU5fU0NPUkUgPSAzOyAvLyBzYWZlbHkgdW5ndWVzc2FibGU6IG1vZGVyYXRlIHByb3RlY3Rpb24gZnJvbSBvZmZsaW5lIHNsb3ctaGFzaCBzY2VuYXJpby5cblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgLy8gVmFsdWVzIHByZS1maWxsZWQgaW4gdGhlIGlucHV0IGJveGVzIHdoZW4gdGhlIGNvbXBvbmVudCBsb2Fkc1xuICAgIGRlZmF1bHRFbWFpbD86IHN0cmluZztcbiAgICBkZWZhdWx0UGhvbmVDb3VudHJ5Pzogc3RyaW5nO1xuICAgIGRlZmF1bHRQaG9uZU51bWJlcj86IHN0cmluZztcbiAgICBkZWZhdWx0VXNlcm5hbWU/OiBzdHJpbmc7XG4gICAgZGVmYXVsdFBhc3N3b3JkPzogc3RyaW5nO1xuICAgIGZsb3dzOiB7XG4gICAgICAgIHN0YWdlczogc3RyaW5nW107XG4gICAgfVtdO1xuICAgIHNlcnZlckNvbmZpZzogVmFsaWRhdGVkU2VydmVyQ29uZmlnO1xuICAgIGNhblN1Ym1pdD86IGJvb2xlYW47XG4gICAgbWF0cml4Q2xpZW50OiBNYXRyaXhDbGllbnQ7XG5cbiAgICBvblJlZ2lzdGVyQ2xpY2socGFyYW1zOiB7XG4gICAgICAgIHVzZXJuYW1lOiBzdHJpbmc7XG4gICAgICAgIHBhc3N3b3JkOiBzdHJpbmc7XG4gICAgICAgIGVtYWlsPzogc3RyaW5nO1xuICAgICAgICBwaG9uZUNvdW50cnk/OiBzdHJpbmc7XG4gICAgICAgIHBob25lTnVtYmVyPzogc3RyaW5nO1xuICAgIH0pOiBQcm9taXNlPHZvaWQ+O1xuICAgIG9uRWRpdFNlcnZlckRldGFpbHNDbGljaz8oKTogdm9pZDtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgLy8gRmllbGQgZXJyb3IgY29kZXMgYnkgZmllbGQgSURcbiAgICBmaWVsZFZhbGlkOiBQYXJ0aWFsPFJlY29yZDxSZWdpc3RyYXRpb25GaWVsZCwgYm9vbGVhbj4+O1xuICAgIC8vIFRoZSBJU08yIGNvdW50cnkgY29kZSBzZWxlY3RlZCBpbiB0aGUgcGhvbmUgbnVtYmVyIGVudHJ5XG4gICAgcGhvbmVDb3VudHJ5OiBzdHJpbmc7XG4gICAgdXNlcm5hbWU6IHN0cmluZztcbiAgICBlbWFpbDogc3RyaW5nO1xuICAgIHBob25lTnVtYmVyOiBzdHJpbmc7XG4gICAgcGFzc3dvcmQ6IHN0cmluZztcbiAgICBwYXNzd29yZENvbmZpcm06IHN0cmluZztcbiAgICBwYXNzd29yZENvbXBsZXhpdHk/OiBudW1iZXI7XG59XG5cbi8qXG4gKiBBIHB1cmUgVUkgY29tcG9uZW50IHdoaWNoIGRpc3BsYXlzIGEgcmVnaXN0cmF0aW9uIGZvcm0uXG4gKi9cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLmF1dGguUmVnaXN0cmF0aW9uRm9ybVwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVnaXN0cmF0aW9uRm9ybSBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgICBvblZhbGlkYXRpb25DaGFuZ2U6IGxvZ2dlci5lcnJvcixcbiAgICAgICAgY2FuU3VibWl0OiB0cnVlLFxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGZpZWxkVmFsaWQ6IHt9LFxuICAgICAgICAgICAgcGhvbmVDb3VudHJ5OiB0aGlzLnByb3BzLmRlZmF1bHRQaG9uZUNvdW50cnksXG4gICAgICAgICAgICB1c2VybmFtZTogdGhpcy5wcm9wcy5kZWZhdWx0VXNlcm5hbWUgfHwgXCJcIixcbiAgICAgICAgICAgIGVtYWlsOiB0aGlzLnByb3BzLmRlZmF1bHRFbWFpbCB8fCBcIlwiLFxuICAgICAgICAgICAgcGhvbmVOdW1iZXI6IHRoaXMucHJvcHMuZGVmYXVsdFBob25lTnVtYmVyIHx8IFwiXCIsXG4gICAgICAgICAgICBwYXNzd29yZDogdGhpcy5wcm9wcy5kZWZhdWx0UGFzc3dvcmQgfHwgXCJcIixcbiAgICAgICAgICAgIHBhc3N3b3JkQ29uZmlybTogdGhpcy5wcm9wcy5kZWZhdWx0UGFzc3dvcmQgfHwgXCJcIixcbiAgICAgICAgICAgIHBhc3N3b3JkQ29tcGxleGl0eTogbnVsbCxcbiAgICAgICAgfTtcblxuICAgICAgICBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnRyYWNrKFwib25ib2FyZGluZ19yZWdpc3RyYXRpb25fYmVnaW5cIik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblN1Ym1pdCA9IGFzeW5jIGV2ID0+IHtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXYucGVyc2lzdCgpO1xuXG4gICAgICAgIGlmICghdGhpcy5wcm9wcy5jYW5TdWJtaXQpIHJldHVybjtcblxuICAgICAgICBjb25zdCBhbGxGaWVsZHNWYWxpZCA9IGF3YWl0IHRoaXMudmVyaWZ5RmllbGRzQmVmb3JlU3VibWl0KCk7XG4gICAgICAgIGlmICghYWxsRmllbGRzVmFsaWQpIHtcbiAgICAgICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX3JlZ2lzdHJhdGlvbl9zdWJtaXRfZmFpbGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuZW1haWwgPT09ICcnKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zaG93RW1haWwoKSkge1xuICAgICAgICAgICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX3JlZ2lzdHJhdGlvbl9zdWJtaXRfd2FyblwiKTtcbiAgICAgICAgICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKFwiRW1haWwgcHJvbXB0IGRpYWxvZ1wiLCAnJywgUmVnaXN0cmF0aW9uRW1haWxQcm9tcHREaWFsb2csIHtcbiAgICAgICAgICAgICAgICAgICAgb25GaW5pc2hlZDogYXN5bmMgKGNvbmZpcm1lZDogYm9vbGVhbiwgZW1haWw/OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvU3VibWl0KGV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gdXNlciBjYW4ndCBzZXQgYW4gZS1tYWlsIHNvIGRvbid0IHByb21wdCB0aGVtIHRvXG4gICAgICAgICAgICAgICAgdGhpcy5kb1N1Ym1pdChldik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kb1N1Ym1pdChldik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBkb1N1Ym1pdChldikge1xuICAgICAgICBjb25zdCBlbWFpbCA9IHRoaXMuc3RhdGUuZW1haWwudHJpbSgpO1xuXG4gICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX3JlZ2lzdHJhdGlvbl9zdWJtaXRfb2tcIiwge1xuICAgICAgICAgICAgZW1haWw6ICEhZW1haWwsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLnByb3BzLm9uUmVnaXN0ZXJDbGljayh7XG4gICAgICAgICAgICB1c2VybmFtZTogdGhpcy5zdGF0ZS51c2VybmFtZS50cmltKCksXG4gICAgICAgICAgICBwYXNzd29yZDogdGhpcy5zdGF0ZS5wYXNzd29yZC50cmltKCksXG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwaG9uZUNvdW50cnk6IHRoaXMuc3RhdGUucGhvbmVDb3VudHJ5LFxuICAgICAgICAgICAgcGhvbmVOdW1iZXI6IHRoaXMuc3RhdGUucGhvbmVOdW1iZXIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChwcm9taXNlKSB7XG4gICAgICAgICAgICBldi50YXJnZXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgcHJvbWlzZS5maW5hbGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGV2LnRhcmdldC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHZlcmlmeUZpZWxkc0JlZm9yZVN1Ym1pdCgpIHtcbiAgICAgICAgLy8gQmx1ciB0aGUgYWN0aXZlIGVsZW1lbnQgaWYgYW55LCBzbyB3ZSBmaXJzdCBydW4gaXRzIGJsdXIgdmFsaWRhdGlvbixcbiAgICAgICAgLy8gd2hpY2ggaXMgbGVzcyBzdHJpY3QgdGhhbiB0aGUgcGFzcyB3ZSdyZSBhYm91dCB0byBkbyBiZWxvdyBmb3IgYWxsIGZpZWxkcy5cbiAgICAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIGlmIChhY3RpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICBhY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZpZWxkSURzSW5EaXNwbGF5T3JkZXIgPSBbXG4gICAgICAgICAgICBSZWdpc3RyYXRpb25GaWVsZC5Vc2VybmFtZSxcbiAgICAgICAgICAgIFJlZ2lzdHJhdGlvbkZpZWxkLlBhc3N3b3JkLFxuICAgICAgICAgICAgUmVnaXN0cmF0aW9uRmllbGQuUGFzc3dvcmRDb25maXJtLFxuICAgICAgICAgICAgUmVnaXN0cmF0aW9uRmllbGQuRW1haWwsXG4gICAgICAgICAgICBSZWdpc3RyYXRpb25GaWVsZC5QaG9uZU51bWJlcixcbiAgICAgICAgXTtcblxuICAgICAgICAvLyBSdW4gYWxsIGZpZWxkcyB3aXRoIHN0cmljdGVyIHZhbGlkYXRpb24gdGhhdCBubyBsb25nZXIgYWxsb3dzIGVtcHR5XG4gICAgICAgIC8vIHZhbHVlcyBmb3IgcmVxdWlyZWQgZmllbGRzLlxuICAgICAgICBmb3IgKGNvbnN0IGZpZWxkSUQgb2YgZmllbGRJRHNJbkRpc3BsYXlPcmRlcikge1xuICAgICAgICAgICAgY29uc3QgZmllbGQgPSB0aGlzW2ZpZWxkSURdO1xuICAgICAgICAgICAgaWYgKCFmaWVsZCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gV2UgbXVzdCB3YWl0IGZvciB0aGVzZSB2YWxpZGF0aW9ucyB0byBmaW5pc2ggYmVmb3JlIHF1ZXVlaW5nXG4gICAgICAgICAgICAvLyB1cCB0aGUgc2V0U3RhdGUgYmVsb3cgc28gb3VyIHNldFN0YXRlIGdvZXMgaW4gdGhlIHF1ZXVlIGFmdGVyXG4gICAgICAgICAgICAvLyBhbGwgdGhlIHNldFN0YXRlcyBmcm9tIHRoZXNlIHZhbGlkYXRlIGNhbGxzICh0aGF0J3MgaG93IHdlXG4gICAgICAgICAgICAvLyBrbm93IHRoZXkndmUgZmluaXNoZWQpLlxuICAgICAgICAgICAgYXdhaXQgZmllbGQudmFsaWRhdGUoeyBhbGxvd0VtcHR5OiBmYWxzZSB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbGlkYXRpb24gYW5kIHN0YXRlIHVwZGF0ZXMgYXJlIGFzeW5jLCBzbyB3ZSBuZWVkIHRvIHdhaXQgZm9yIHRoZW0gdG8gY29tcGxldGVcbiAgICAgICAgLy8gZmlyc3QuIFF1ZXVlIGEgYHNldFN0YXRlYCBjYWxsYmFjayBhbmQgd2FpdCBmb3IgaXQgdG8gcmVzb2x2ZS5cbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4ocmVzb2x2ZSA9PiB0aGlzLnNldFN0YXRlKHt9LCByZXNvbHZlKSk7XG5cbiAgICAgICAgaWYgKHRoaXMuYWxsRmllbGRzVmFsaWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpbnZhbGlkRmllbGQgPSB0aGlzLmZpbmRGaXJzdEludmFsaWRGaWVsZChmaWVsZElEc0luRGlzcGxheU9yZGVyKTtcblxuICAgICAgICBpZiAoIWludmFsaWRGaWVsZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGb2N1cyB0aGUgZmlyc3QgaW52YWxpZCBmaWVsZCBhbmQgc2hvdyBmZWVkYmFjayBpbiB0aGUgc3RyaWN0ZXIgbW9kZVxuICAgICAgICAvLyB0aGF0IG5vIGxvbmdlciBhbGxvd3MgZW1wdHkgdmFsdWVzIGZvciByZXF1aXJlZCBmaWVsZHMuXG4gICAgICAgIGludmFsaWRGaWVsZC5mb2N1cygpO1xuICAgICAgICBpbnZhbGlkRmllbGQudmFsaWRhdGUoeyBhbGxvd0VtcHR5OiBmYWxzZSwgZm9jdXNlZDogdHJ1ZSB9KTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIGFsbCBmaWVsZHMgd2VyZSB2YWxpZCBsYXN0IHRpbWUgdGhleSB3ZXJlIHZhbGlkYXRlZC5cbiAgICAgKi9cbiAgICBwcml2YXRlIGFsbEZpZWxkc1ZhbGlkKCkge1xuICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5zdGF0ZS5maWVsZFZhbGlkKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUuZmllbGRWYWxpZFtrZXlzW2ldXSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbmRGaXJzdEludmFsaWRGaWVsZChmaWVsZElEczogUmVnaXN0cmF0aW9uRmllbGRbXSkge1xuICAgICAgICBmb3IgKGNvbnN0IGZpZWxkSUQgb2YgZmllbGRJRHMpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5maWVsZFZhbGlkW2ZpZWxkSURdICYmIHRoaXNbZmllbGRJRF0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1tmaWVsZElEXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIG1hcmtGaWVsZFZhbGlkKGZpZWxkSUQ6IFJlZ2lzdHJhdGlvbkZpZWxkLCB2YWxpZDogYm9vbGVhbikge1xuICAgICAgICBjb25zdCB7IGZpZWxkVmFsaWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGZpZWxkVmFsaWRbZmllbGRJRF0gPSB2YWxpZDtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBmaWVsZFZhbGlkLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uRW1haWxDaGFuZ2UgPSBldiA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZW1haWw6IGV2LnRhcmdldC52YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25FbWFpbFZhbGlkYXRlID0gKHJlc3VsdDogSVZhbGlkYXRpb25SZXN1bHQpID0+IHtcbiAgICAgICAgdGhpcy5tYXJrRmllbGRWYWxpZChSZWdpc3RyYXRpb25GaWVsZC5FbWFpbCwgcmVzdWx0LnZhbGlkKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSB2YWxpZGF0ZUVtYWlsUnVsZXMgPSB3aXRoVmFsaWRhdGlvbih7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAoKSA9PiBfdChcIlVzZSBhbiBlbWFpbCBhZGRyZXNzIHRvIHJlY292ZXIgeW91ciBhY2NvdW50XCIpLFxuICAgICAgICBoaWRlRGVzY3JpcHRpb25JZlZhbGlkOiB0cnVlLFxuICAgICAgICBydWxlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogXCJyZXF1aXJlZFwiLFxuICAgICAgICAgICAgICAgIHRlc3QodGhpczogUmVnaXN0cmF0aW9uRm9ybSwgeyB2YWx1ZSwgYWxsb3dFbXB0eSB9KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGxvd0VtcHR5IHx8ICF0aGlzLmF1dGhTdGVwSXNSZXF1aXJlZCgnbS5sb2dpbi5lbWFpbC5pZGVudGl0eScpIHx8ICEhdmFsdWU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkOiAoKSA9PiBfdChcIkVudGVyIGVtYWlsIGFkZHJlc3MgKHJlcXVpcmVkIG9uIHRoaXMgaG9tZXNlcnZlcilcIiksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgIHRlc3Q6ICh7IHZhbHVlIH0pID0+ICF2YWx1ZSB8fCBFbWFpbC5sb29rc1ZhbGlkKHZhbHVlKSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkOiAoKSA9PiBfdChcIkRvZXNuJ3QgbG9vayBsaWtlIGEgdmFsaWQgZW1haWwgYWRkcmVzc1wiKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBwcml2YXRlIG9uUGFzc3dvcmRDaGFuZ2UgPSBldiA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcGFzc3dvcmQ6IGV2LnRhcmdldC52YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25QYXNzd29yZFZhbGlkYXRlID0gcmVzdWx0ID0+IHtcbiAgICAgICAgdGhpcy5tYXJrRmllbGRWYWxpZChSZWdpc3RyYXRpb25GaWVsZC5QYXNzd29yZCwgcmVzdWx0LnZhbGlkKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBhc3N3b3JkQ29uZmlybUNoYW5nZSA9IGV2ID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBwYXNzd29yZENvbmZpcm06IGV2LnRhcmdldC52YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25QYXNzd29yZENvbmZpcm1WYWxpZGF0ZSA9IChyZXN1bHQ6IElWYWxpZGF0aW9uUmVzdWx0KSA9PiB7XG4gICAgICAgIHRoaXMubWFya0ZpZWxkVmFsaWQoUmVnaXN0cmF0aW9uRmllbGQuUGFzc3dvcmRDb25maXJtLCByZXN1bHQudmFsaWQpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUGhvbmVDb3VudHJ5Q2hhbmdlID0gbmV3VmFsID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBwaG9uZUNvdW50cnk6IG5ld1ZhbC5pc28yLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBob25lTnVtYmVyQ2hhbmdlID0gZXYgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHBob25lTnVtYmVyOiBldi50YXJnZXQudmFsdWUsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUGhvbmVOdW1iZXJWYWxpZGF0ZSA9IGFzeW5jIGZpZWxkU3RhdGUgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlUGhvbmVOdW1iZXJSdWxlcyhmaWVsZFN0YXRlKTtcbiAgICAgICAgdGhpcy5tYXJrRmllbGRWYWxpZChSZWdpc3RyYXRpb25GaWVsZC5QaG9uZU51bWJlciwgcmVzdWx0LnZhbGlkKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSB2YWxpZGF0ZVBob25lTnVtYmVyUnVsZXMgPSB3aXRoVmFsaWRhdGlvbih7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAoKSA9PiBfdChcIk90aGVyIHVzZXJzIGNhbiBpbnZpdGUgeW91IHRvIHJvb21zIHVzaW5nIHlvdXIgY29udGFjdCBkZXRhaWxzXCIpLFxuICAgICAgICBoaWRlRGVzY3JpcHRpb25JZlZhbGlkOiB0cnVlLFxuICAgICAgICBydWxlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogXCJyZXF1aXJlZFwiLFxuICAgICAgICAgICAgICAgIHRlc3QodGhpczogUmVnaXN0cmF0aW9uRm9ybSwgeyB2YWx1ZSwgYWxsb3dFbXB0eSB9KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGxvd0VtcHR5IHx8ICF0aGlzLmF1dGhTdGVwSXNSZXF1aXJlZCgnbS5sb2dpbi5tc2lzZG4nKSB8fCAhIXZhbHVlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW52YWxpZDogKCkgPT4gX3QoXCJFbnRlciBwaG9uZSBudW1iZXIgKHJlcXVpcmVkIG9uIHRoaXMgaG9tZXNlcnZlcilcIiksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgIHRlc3Q6ICh7IHZhbHVlIH0pID0+ICF2YWx1ZSB8fCBwaG9uZU51bWJlckxvb2tzVmFsaWQodmFsdWUpLFxuICAgICAgICAgICAgICAgIGludmFsaWQ6ICgpID0+IF90KFwiVGhhdCBwaG9uZSBudW1iZXIgZG9lc24ndCBsb29rIHF1aXRlIHJpZ2h0LCBwbGVhc2UgY2hlY2sgYW5kIHRyeSBhZ2FpblwiKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBwcml2YXRlIG9uVXNlcm5hbWVDaGFuZ2UgPSBldiA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdXNlcm5hbWU6IGV2LnRhcmdldC52YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Vc2VybmFtZVZhbGlkYXRlID0gYXN5bmMgZmllbGRTdGF0ZSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudmFsaWRhdGVVc2VybmFtZVJ1bGVzKGZpZWxkU3RhdGUpO1xuICAgICAgICB0aGlzLm1hcmtGaWVsZFZhbGlkKFJlZ2lzdHJhdGlvbkZpZWxkLlVzZXJuYW1lLCByZXN1bHQudmFsaWQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICBwcml2YXRlIHZhbGlkYXRlVXNlcm5hbWVSdWxlcyA9IHdpdGhWYWxpZGF0aW9uKHtcbiAgICAgICAgZGVzY3JpcHRpb246IChfLCByZXN1bHRzKSA9PiB7XG4gICAgICAgICAgICAvLyBvbWl0IHRoZSBkZXNjcmlwdGlvbiBpZiB0aGUgb25seSBmYWlsaW5nIHJlc3VsdCBpcyB0aGUgYGF2YWlsYWJsZWAgb25lIGFzIGl0IG1ha2VzIG5vIHNlbnNlIGZvciBpdC5cbiAgICAgICAgICAgIGlmIChyZXN1bHRzLmV2ZXJ5KCh7IGtleSwgdmFsaWQgfSkgPT4ga2V5ID09PSBcImF2YWlsYWJsZVwiIHx8IHZhbGlkKSkgcmV0dXJuO1xuICAgICAgICAgICAgcmV0dXJuIF90KFwiVXNlIGxvd2VyY2FzZSBsZXR0ZXJzLCBudW1iZXJzLCBkYXNoZXMgYW5kIHVuZGVyc2NvcmVzIG9ubHlcIik7XG4gICAgICAgIH0sXG4gICAgICAgIGhpZGVEZXNjcmlwdGlvbklmVmFsaWQ6IHRydWUsXG4gICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAga2V5OiBcInJlcXVpcmVkXCIsXG4gICAgICAgICAgICAgICAgdGVzdDogKHsgdmFsdWUsIGFsbG93RW1wdHkgfSkgPT4gYWxsb3dFbXB0eSB8fCAhIXZhbHVlLFxuICAgICAgICAgICAgICAgIGludmFsaWQ6ICgpID0+IF90KFwiRW50ZXIgdXNlcm5hbWVcIiksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogXCJzYWZlTG9jYWxwYXJ0XCIsXG4gICAgICAgICAgICAgICAgdGVzdDogKHsgdmFsdWUgfSkgPT4gIXZhbHVlIHx8IFNBRkVfTE9DQUxQQVJUX1JFR0VYLnRlc3QodmFsdWUpLFxuICAgICAgICAgICAgICAgIGludmFsaWQ6ICgpID0+IF90KFwiU29tZSBjaGFyYWN0ZXJzIG5vdCBhbGxvd2VkXCIpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBrZXk6IFwiYXZhaWxhYmxlXCIsXG4gICAgICAgICAgICAgICAgZmluYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgdGVzdDogYXN5bmMgKHsgdmFsdWUgfSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnByb3BzLm1hdHJpeENsaWVudC5pc1VzZXJuYW1lQXZhaWxhYmxlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW52YWxpZDogKCkgPT4gX3QoXCJTb21lb25lIGFscmVhZHkgaGFzIHRoYXQgdXNlcm5hbWUuIFRyeSBhbm90aGVyIG9yIGlmIGl0IGlzIHlvdSwgc2lnbiBpbiBiZWxvdy5cIiksXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQSBzdGVwIGlzIHJlcXVpcmVkIGlmIGFsbCBmbG93cyBpbmNsdWRlIHRoYXQgc3RlcC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwIEEgc3RhZ2UgbmFtZSB0byBjaGVja1xuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBXaGV0aGVyIGl0IGlzIHJlcXVpcmVkXG4gICAgICovXG4gICAgcHJpdmF0ZSBhdXRoU3RlcElzUmVxdWlyZWQoc3RlcDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLmZsb3dzLmV2ZXJ5KChmbG93KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZmxvdy5zdGFnZXMuaW5jbHVkZXMoc3RlcCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgc3RlcCBpcyB1c2VkIGlmIGFueSBmbG93cyBpbmNsdWRlIHRoYXQgc3RlcC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwIEEgc3RhZ2UgbmFtZSB0byBjaGVja1xuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBXaGV0aGVyIGl0IGlzIHVzZWRcbiAgICAgKi9cbiAgICBwcml2YXRlIGF1dGhTdGVwSXNVc2VkKHN0ZXA6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5mbG93cy5zb21lKChmbG93KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZmxvdy5zdGFnZXMuaW5jbHVkZXMoc3RlcCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2hvd0VtYWlsKCkge1xuICAgICAgICBpZiAoIXRoaXMuYXV0aFN0ZXBJc1VzZWQoJ20ubG9naW4uZW1haWwuaWRlbnRpdHknKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2hvd1Bob25lTnVtYmVyKCkge1xuICAgICAgICBjb25zdCB0aHJlZVBpZExvZ2luID0gIVNka0NvbmZpZy5nZXQoKS5kaXNhYmxlXzNwaWRfbG9naW47XG4gICAgICAgIGlmICghdGhyZWVQaWRMb2dpbiB8fCAhdGhpcy5hdXRoU3RlcElzVXNlZCgnbS5sb2dpbi5tc2lzZG4nKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyRW1haWwoKSB7XG4gICAgICAgIGlmICghdGhpcy5zaG93RW1haWwoKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZW1haWxMYWJlbCA9IHRoaXMuYXV0aFN0ZXBJc1JlcXVpcmVkKCdtLmxvZ2luLmVtYWlsLmlkZW50aXR5JykgP1xuICAgICAgICAgICAgX3QoXCJFbWFpbFwiKSA6XG4gICAgICAgICAgICBfdChcIkVtYWlsIChvcHRpb25hbClcIik7XG4gICAgICAgIHJldHVybiA8RW1haWxGaWVsZFxuICAgICAgICAgICAgZmllbGRSZWY9e2ZpZWxkID0+IHRoaXNbUmVnaXN0cmF0aW9uRmllbGQuRW1haWxdID0gZmllbGR9XG4gICAgICAgICAgICBsYWJlbD17ZW1haWxMYWJlbH1cbiAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmVtYWlsfVxuICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGVzPXt0aGlzLnZhbGlkYXRlRW1haWxSdWxlcy5iaW5kKHRoaXMpfVxuICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25FbWFpbENoYW5nZX1cbiAgICAgICAgICAgIG9uVmFsaWRhdGU9e3RoaXMub25FbWFpbFZhbGlkYXRlfVxuICAgICAgICAgICAgb25Gb2N1cz17KCkgPT4gQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFjayhcIm9uYm9hcmRpbmdfcmVnaXN0cmF0aW9uX2VtYWlsX2ZvY3VzXCIpfVxuICAgICAgICAgICAgb25CbHVyPXsoKSA9PiBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnRyYWNrKFwib25ib2FyZGluZ19yZWdpc3RyYXRpb25fZW1haWxfYmx1clwiKX1cbiAgICAgICAgLz47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJQYXNzd29yZCgpIHtcbiAgICAgICAgcmV0dXJuIDxQYXNzcGhyYXNlRmllbGRcbiAgICAgICAgICAgIGlkPVwibXhfUmVnaXN0cmF0aW9uRm9ybV9wYXNzd29yZFwiXG4gICAgICAgICAgICBmaWVsZFJlZj17ZmllbGQgPT4gdGhpc1tSZWdpc3RyYXRpb25GaWVsZC5QYXNzd29yZF0gPSBmaWVsZH1cbiAgICAgICAgICAgIG1pblNjb3JlPXtQQVNTV09SRF9NSU5fU0NPUkV9XG4gICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5wYXNzd29yZH1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uUGFzc3dvcmRDaGFuZ2V9XG4gICAgICAgICAgICBvblZhbGlkYXRlPXt0aGlzLm9uUGFzc3dvcmRWYWxpZGF0ZX1cbiAgICAgICAgICAgIG9uRm9jdXM9eygpID0+IENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX3JlZ2lzdHJhdGlvbl9wYXNzd29yZF9mb2N1c1wiKX1cbiAgICAgICAgICAgIG9uQmx1cj17KCkgPT4gQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFjayhcIm9uYm9hcmRpbmdfcmVnaXN0cmF0aW9uX3Bhc3N3b3JkX2JsdXJcIil9XG4gICAgICAgIC8+O1xuICAgIH1cblxuICAgIHJlbmRlclBhc3N3b3JkQ29uZmlybSgpIHtcbiAgICAgICAgcmV0dXJuIDxQYXNzcGhyYXNlQ29uZmlybUZpZWxkXG4gICAgICAgICAgICBpZD1cIm14X1JlZ2lzdHJhdGlvbkZvcm1fcGFzc3dvcmRDb25maXJtXCJcbiAgICAgICAgICAgIGZpZWxkUmVmPXtmaWVsZCA9PiB0aGlzW1JlZ2lzdHJhdGlvbkZpZWxkLlBhc3N3b3JkQ29uZmlybV0gPSBmaWVsZH1cbiAgICAgICAgICAgIGF1dG9Db21wbGV0ZT1cIm5ldy1wYXNzd29yZFwiXG4gICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5wYXNzd29yZENvbmZpcm19XG4gICAgICAgICAgICBwYXNzd29yZD17dGhpcy5zdGF0ZS5wYXNzd29yZH1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uUGFzc3dvcmRDb25maXJtQ2hhbmdlfVxuICAgICAgICAgICAgb25WYWxpZGF0ZT17dGhpcy5vblBhc3N3b3JkQ29uZmlybVZhbGlkYXRlfVxuICAgICAgICAgICAgb25Gb2N1cz17KCkgPT4gQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFjayhcIm9uYm9hcmRpbmdfcmVnaXN0cmF0aW9uX3Bhc3N3b3JkQ29uZmlybV9mb2N1c1wiKX1cbiAgICAgICAgICAgIG9uQmx1cj17KCkgPT4gQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFjayhcIm9uYm9hcmRpbmdfcmVnaXN0cmF0aW9uX3Bhc3N3b3JkQ29uZmlybV9ibHVyXCIpfVxuICAgICAgICAvPjtcbiAgICB9XG5cbiAgICByZW5kZXJQaG9uZU51bWJlcigpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNob3dQaG9uZU51bWJlcigpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwaG9uZUxhYmVsID0gdGhpcy5hdXRoU3RlcElzUmVxdWlyZWQoJ20ubG9naW4ubXNpc2RuJykgP1xuICAgICAgICAgICAgX3QoXCJQaG9uZVwiKSA6XG4gICAgICAgICAgICBfdChcIlBob25lIChvcHRpb25hbClcIik7XG4gICAgICAgIGNvbnN0IHBob25lQ291bnRyeSA9IDxDb3VudHJ5RHJvcGRvd25cbiAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLnBob25lQ291bnRyeX1cbiAgICAgICAgICAgIGlzU21hbGw9e3RydWV9XG4gICAgICAgICAgICBzaG93UHJlZml4PXt0cnVlfVxuICAgICAgICAgICAgb25PcHRpb25DaGFuZ2U9e3RoaXMub25QaG9uZUNvdW50cnlDaGFuZ2V9XG4gICAgICAgIC8+O1xuICAgICAgICByZXR1cm4gPEZpZWxkXG4gICAgICAgICAgICByZWY9e2ZpZWxkID0+IHRoaXNbUmVnaXN0cmF0aW9uRmllbGQuUGhvbmVOdW1iZXJdID0gZmllbGR9XG4gICAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICBsYWJlbD17cGhvbmVMYWJlbH1cbiAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLnBob25lTnVtYmVyfVxuICAgICAgICAgICAgcHJlZml4Q29tcG9uZW50PXtwaG9uZUNvdW50cnl9XG4gICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vblBob25lTnVtYmVyQ2hhbmdlfVxuICAgICAgICAgICAgb25WYWxpZGF0ZT17dGhpcy5vblBob25lTnVtYmVyVmFsaWRhdGV9XG4gICAgICAgIC8+O1xuICAgIH1cblxuICAgIHJlbmRlclVzZXJuYW1lKCkge1xuICAgICAgICByZXR1cm4gPEZpZWxkXG4gICAgICAgICAgICBpZD1cIm14X1JlZ2lzdHJhdGlvbkZvcm1fdXNlcm5hbWVcIlxuICAgICAgICAgICAgcmVmPXtmaWVsZCA9PiB0aGlzW1JlZ2lzdHJhdGlvbkZpZWxkLlVzZXJuYW1lXSA9IGZpZWxkfVxuICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgYXV0b0ZvY3VzPXt0cnVlfVxuICAgICAgICAgICAgbGFiZWw9e190KFwiVXNlcm5hbWVcIil9XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj17X3QoXCJVc2VybmFtZVwiKS50b0xvY2FsZUxvd2VyQ2FzZSgpfVxuICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUudXNlcm5hbWV9XG4gICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vblVzZXJuYW1lQ2hhbmdlfVxuICAgICAgICAgICAgb25WYWxpZGF0ZT17dGhpcy5vblVzZXJuYW1lVmFsaWRhdGV9XG4gICAgICAgICAgICBvbkZvY3VzPXsoKSA9PiBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnRyYWNrKFwib25ib2FyZGluZ19yZWdpc3RyYXRpb25fdXNlcm5hbWVfZm9jdXNcIil9XG4gICAgICAgICAgICBvbkJsdXI9eygpID0+IENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX3JlZ2lzdHJhdGlvbl91c2VybmFtZV9ibHVyXCIpfVxuICAgICAgICAvPjtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHJlZ2lzdGVyQnV0dG9uID0gKFxuICAgICAgICAgICAgPGlucHV0IGNsYXNzTmFtZT1cIm14X0xvZ2luX3N1Ym1pdFwiIHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT17X3QoXCJSZWdpc3RlclwiKX0gZGlzYWJsZWQ9eyF0aGlzLnByb3BzLmNhblN1Ym1pdH0gLz5cbiAgICAgICAgKTtcblxuICAgICAgICBsZXQgZW1haWxIZWxwZXJUZXh0ID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuc2hvd0VtYWlsKCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dQaG9uZU51bWJlcigpKSB7XG4gICAgICAgICAgICAgICAgZW1haWxIZWxwZXJUZXh0ID0gPGRpdj5cbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3QoXCJBZGQgYW4gZW1haWwgdG8gYmUgYWJsZSB0byByZXNldCB5b3VyIHBhc3N3b3JkLlwiKVxuICAgICAgICAgICAgICAgICAgICB9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90KFwiVXNlIGVtYWlsIG9yIHBob25lIHRvIG9wdGlvbmFsbHkgYmUgZGlzY292ZXJhYmxlIGJ5IGV4aXN0aW5nIGNvbnRhY3RzLlwiKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbWFpbEhlbHBlclRleHQgPSA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdChcIkFkZCBhbiBlbWFpbCB0byBiZSBhYmxlIHRvIHJlc2V0IHlvdXIgcGFzc3dvcmQuXCIpXG4gICAgICAgICAgICAgICAgICAgIH0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3QoXCJVc2UgZW1haWwgdG8gb3B0aW9uYWxseSBiZSBkaXNjb3ZlcmFibGUgYnkgZXhpc3RpbmcgY29udGFjdHMuXCIpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17dGhpcy5vblN1Ym1pdH0+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQXV0aEJvZHlfZmllbGRSb3dcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5yZW5kZXJVc2VybmFtZSgpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQXV0aEJvZHlfZmllbGRSb3dcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5yZW5kZXJQYXNzd29yZCgpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5yZW5kZXJQYXNzd29yZENvbmZpcm0oKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0F1dGhCb2R5X2ZpZWxkUm93XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHRoaXMucmVuZGVyRW1haWwoKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHRoaXMucmVuZGVyUGhvbmVOdW1iZXIoKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICB7IGVtYWlsSGVscGVyVGV4dCB9XG4gICAgICAgICAgICAgICAgICAgIHsgcmVnaXN0ZXJCdXR0b24gfVxuICAgICAgICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==