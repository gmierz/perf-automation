"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _languageHandler = require("../../../languageHandler");

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _CountlyAnalytics = _interopRequireDefault(require("../../../CountlyAnalytics"));

var _Validation = _interopRequireDefault(require("../elements/Validation"));

var _Field = _interopRequireDefault(require("../elements/Field"));

var _CountryDropdown = _interopRequireDefault(require("./CountryDropdown"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _EmailField = _interopRequireDefault(require("./EmailField"));

var _dec, _class, _class2, _temp;

// For validating phone numbers without country codes
const PHONE_NUMBER_REGEX = /^[0-9()\-\s]*$/;
var LoginField;
/*
 * A pure UI component which displays a username/password form.
 * The email/username/phone fields are fully-controlled, the password field is not.
 */

(function (LoginField) {
  LoginField["Email"] = "login_field_email";
  LoginField["MatrixId"] = "login_field_mxid";
  LoginField["Phone"] = "login_field_phone";
  LoginField["Password"] = "login_field_phone";
})(LoginField || (LoginField = {}));

let PasswordLogin = (_dec = (0, _replaceableComponent.replaceableComponent)("views.auth.PasswordLogin"), _dec(_class = (_temp = _class2 = class PasswordLogin extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onForgotPasswordClick", ev => {
      ev.preventDefault();
      ev.stopPropagation();
      this.props.onForgotPasswordClick();
    });
    (0, _defineProperty2.default)(this, "onSubmitForm", async ev => {
      ev.preventDefault();
      const allFieldsValid = await this.verifyFieldsBeforeSubmit();

      if (!allFieldsValid) {
        _CountlyAnalytics.default.instance.track("onboarding_registration_submit_failed");

        return;
      }

      let username = ''; // XXX: Synapse breaks if you send null here:

      let phoneCountry = null;
      let phoneNumber = null;

      switch (this.state.loginType) {
        case LoginField.Email:
        case LoginField.MatrixId:
          username = this.props.username;
          break;

        case LoginField.Phone:
          phoneCountry = this.props.phoneCountry;
          phoneNumber = this.props.phoneNumber;
          break;
      }

      this.props.onSubmit(username, phoneCountry, phoneNumber, this.state.password);
    });
    (0, _defineProperty2.default)(this, "onUsernameChanged", ev => {
      this.props.onUsernameChanged(ev.target.value);
    });
    (0, _defineProperty2.default)(this, "onUsernameFocus", () => {
      if (this.state.loginType === LoginField.MatrixId) {
        _CountlyAnalytics.default.instance.track("onboarding_login_mxid_focus");
      } else {
        _CountlyAnalytics.default.instance.track("onboarding_login_email_focus");
      }
    });
    (0, _defineProperty2.default)(this, "onUsernameBlur", ev => {
      if (this.state.loginType === LoginField.MatrixId) {
        _CountlyAnalytics.default.instance.track("onboarding_login_mxid_blur");
      } else {
        _CountlyAnalytics.default.instance.track("onboarding_login_email_blur");
      }

      this.props.onUsernameBlur(ev.target.value);
    });
    (0, _defineProperty2.default)(this, "onLoginTypeChange", ev => {
      const loginType = ev.target.value;
      this.setState({
        loginType
      });
      this.props.onUsernameChanged(""); // Reset because email and username use the same state

      _CountlyAnalytics.default.instance.track("onboarding_login_type_changed", {
        loginType
      });
    });
    (0, _defineProperty2.default)(this, "onPhoneCountryChanged", country => {
      this.props.onPhoneCountryChanged(country.iso2);
    });
    (0, _defineProperty2.default)(this, "onPhoneNumberChanged", ev => {
      this.props.onPhoneNumberChanged(ev.target.value);
    });
    (0, _defineProperty2.default)(this, "onPhoneNumberFocus", () => {
      _CountlyAnalytics.default.instance.track("onboarding_login_phone_number_focus");
    });
    (0, _defineProperty2.default)(this, "onPhoneNumberBlur", ev => {
      _CountlyAnalytics.default.instance.track("onboarding_login_phone_number_blur");
    });
    (0, _defineProperty2.default)(this, "onPasswordChanged", ev => {
      this.setState({
        password: ev.target.value
      });
    });
    (0, _defineProperty2.default)(this, "validateUsernameRules", (0, _Validation.default)({
      rules: [{
        key: "required",

        test({
          value,
          allowEmpty
        }) {
          return allowEmpty || !!value;
        },

        invalid: () => (0, _languageHandler._t)("Enter username")
      }]
    }));
    (0, _defineProperty2.default)(this, "onUsernameValidate", async fieldState => {
      const result = await this.validateUsernameRules(fieldState);
      this.markFieldValid(LoginField.MatrixId, result.valid);
      return result;
    });
    (0, _defineProperty2.default)(this, "onEmailValidate", result => {
      this.markFieldValid(LoginField.Email, result.valid);
    });
    (0, _defineProperty2.default)(this, "validatePhoneNumberRules", (0, _Validation.default)({
      rules: [{
        key: "required",

        test({
          value,
          allowEmpty
        }) {
          return allowEmpty || !!value;
        },

        invalid: () => (0, _languageHandler._t)("Enter phone number")
      }, {
        key: "number",
        test: ({
          value
        }) => !value || PHONE_NUMBER_REGEX.test(value),
        invalid: () => (0, _languageHandler._t)("That phone number doesn't look quite right, please check and try again")
      }]
    }));
    (0, _defineProperty2.default)(this, "onPhoneNumberValidate", async fieldState => {
      const result = await this.validatePhoneNumberRules(fieldState);
      this.markFieldValid(LoginField.Password, result.valid);
      return result;
    });
    (0, _defineProperty2.default)(this, "validatePasswordRules", (0, _Validation.default)({
      rules: [{
        key: "required",

        test({
          value,
          allowEmpty
        }) {
          return allowEmpty || !!value;
        },

        invalid: () => (0, _languageHandler._t)("Enter password")
      }]
    }));
    (0, _defineProperty2.default)(this, "onPasswordValidate", async fieldState => {
      const result = await this.validatePasswordRules(fieldState);
      this.markFieldValid(LoginField.Password, result.valid);
      return result;
    });
    this.state = {
      // Field error codes by field ID
      fieldValid: {},
      loginType: LoginField.MatrixId,
      password: ""
    };
  }

  async verifyFieldsBeforeSubmit() {
    // Blur the active element if any, so we first run its blur validation,
    // which is less strict than the pass we're about to do below for all fields.
    const activeElement = document.activeElement;

    if (activeElement) {
      activeElement.blur();
    }

    const fieldIDsInDisplayOrder = [this.state.loginType, LoginField.Password]; // Run all fields with stricter validation that no longer allows empty
    // values for required fields.

    for (const fieldID of fieldIDsInDisplayOrder) {
      const field = this[fieldID];

      if (!field) {
        continue;
      } // We must wait for these validations to finish before queueing
      // up the setState below so our setState goes in the queue after
      // all the setStates from these validate calls (that's how we
      // know they've finished).


      await field.validate({
        allowEmpty: false
      });
    } // Validation and state updates are async, so we need to wait for them to complete
    // first. Queue a `setState` callback and wait for it to resolve.


    await new Promise(resolve => this.setState({}, resolve));

    if (this.allFieldsValid()) {
      return true;
    }

    const invalidField = this.findFirstInvalidField(fieldIDsInDisplayOrder);

    if (!invalidField) {
      return true;
    } // Focus the first invalid field and show feedback in the stricter mode
    // that no longer allows empty values for required fields.


    invalidField.focus();
    invalidField.validate({
      allowEmpty: false,
      focused: true
    });
    return false;
  }

  allFieldsValid() {
    const keys = Object.keys(this.state.fieldValid);

    for (let i = 0; i < keys.length; ++i) {
      if (!this.state.fieldValid[keys[i]]) {
        return false;
      }
    }

    return true;
  }

  findFirstInvalidField(fieldIDs) {
    for (const fieldID of fieldIDs) {
      if (!this.state.fieldValid[fieldID] && this[fieldID]) {
        return this[fieldID];
      }
    }

    return null;
  }

  markFieldValid(fieldID, valid) {
    const {
      fieldValid
    } = this.state;
    fieldValid[fieldID] = valid;
    this.setState({
      fieldValid
    });
  }

  renderLoginField(loginType, autoFocus) {
    const classes = {
      error: false
    };

    switch (loginType) {
      case LoginField.Email:
        classes.error = this.props.loginIncorrect && !this.props.username;
        return /*#__PURE__*/_react.default.createElement(_EmailField.default, {
          className: (0, _classnames.default)(classes),
          name: "username" // make it a little easier for browser's remember-password
          ,
          autoComplete: "email",
          type: "email",
          key: "email_input",
          placeholder: "joe@example.com",
          value: this.props.username,
          onChange: this.onUsernameChanged,
          onFocus: this.onUsernameFocus,
          onBlur: this.onUsernameBlur,
          disabled: this.props.disableSubmit,
          autoFocus: autoFocus,
          onValidate: this.onEmailValidate,
          fieldRef: field => this[LoginField.Email] = field
        });

      case LoginField.MatrixId:
        classes.error = this.props.loginIncorrect && !this.props.username;
        return /*#__PURE__*/_react.default.createElement(_Field.default, {
          className: (0, _classnames.default)(classes),
          name: "username" // make it a little easier for browser's remember-password
          ,
          autoComplete: "username",
          key: "username_input",
          type: "text",
          label: (0, _languageHandler._t)("Username"),
          placeholder: (0, _languageHandler._t)("Username").toLocaleLowerCase(),
          value: this.props.username,
          onChange: this.onUsernameChanged,
          onFocus: this.onUsernameFocus,
          onBlur: this.onUsernameBlur,
          disabled: this.props.disableSubmit,
          autoFocus: autoFocus,
          onValidate: this.onUsernameValidate,
          ref: field => this[LoginField.MatrixId] = field
        });

      case LoginField.Phone:
        {
          classes.error = this.props.loginIncorrect && !this.props.phoneNumber;

          const phoneCountry = /*#__PURE__*/_react.default.createElement(_CountryDropdown.default, {
            value: this.props.phoneCountry,
            isSmall: true,
            showPrefix: true,
            onOptionChange: this.onPhoneCountryChanged
          });

          return /*#__PURE__*/_react.default.createElement(_Field.default, {
            className: (0, _classnames.default)(classes),
            name: "phoneNumber",
            autoComplete: "tel-national",
            key: "phone_input",
            type: "text",
            label: (0, _languageHandler._t)("Phone"),
            value: this.props.phoneNumber,
            prefixComponent: phoneCountry,
            onChange: this.onPhoneNumberChanged,
            onFocus: this.onPhoneNumberFocus,
            onBlur: this.onPhoneNumberBlur,
            disabled: this.props.disableSubmit,
            autoFocus: autoFocus,
            onValidate: this.onPhoneNumberValidate,
            ref: field => this[LoginField.Password] = field
          });
        }
    }
  }

  isLoginEmpty() {
    switch (this.state.loginType) {
      case LoginField.Email:
      case LoginField.MatrixId:
        return !this.props.username;

      case LoginField.Phone:
        return !this.props.phoneCountry || !this.props.phoneNumber;
    }
  }

  render() {
    let forgotPasswordJsx;

    if (this.props.onForgotPasswordClick) {
      forgotPasswordJsx = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        className: "mx_Login_forgot",
        disabled: this.props.busy,
        kind: "link",
        onClick: this.onForgotPasswordClick
      }, (0, _languageHandler._t)("Forgot password?"));
    }

    const pwFieldClass = (0, _classnames.default)({
      error: this.props.loginIncorrect && !this.isLoginEmpty() // only error password if error isn't top field

    }); // If login is empty, autoFocus login, otherwise autoFocus password.
    // this is for when auto server discovery remounts us when the user tries to tab from username to password

    const autoFocusPassword = !this.isLoginEmpty();
    const loginField = this.renderLoginField(this.state.loginType, !autoFocusPassword);
    let loginType;

    if (!_SdkConfig.default.get().disable_3pid_login) {
      loginType = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_Login_type_container"
      }, /*#__PURE__*/_react.default.createElement("label", {
        className: "mx_Login_type_label"
      }, (0, _languageHandler._t)('Sign in with')), /*#__PURE__*/_react.default.createElement(_Field.default, {
        element: "select",
        value: this.state.loginType,
        onChange: this.onLoginTypeChange,
        disabled: this.props.disableSubmit
      }, /*#__PURE__*/_react.default.createElement("option", {
        key: LoginField.MatrixId,
        value: LoginField.MatrixId
      }, (0, _languageHandler._t)('Username')), /*#__PURE__*/_react.default.createElement("option", {
        key: LoginField.Email,
        value: LoginField.Email
      }, (0, _languageHandler._t)('Email address')), /*#__PURE__*/_react.default.createElement("option", {
        key: LoginField.Password,
        value: LoginField.Password
      }, (0, _languageHandler._t)('Phone'))));
    }

    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onSubmitForm
    }, loginType, loginField, /*#__PURE__*/_react.default.createElement(_Field.default, {
      className: pwFieldClass,
      autoComplete: "password",
      type: "password",
      name: "password",
      label: (0, _languageHandler._t)('Password'),
      value: this.state.password,
      onChange: this.onPasswordChanged,
      disabled: this.props.disableSubmit,
      autoFocus: autoFocusPassword,
      onValidate: this.onPasswordValidate,
      ref: field => this[LoginField.Password] = field
    }), forgotPasswordJsx, !this.props.busy && /*#__PURE__*/_react.default.createElement("input", {
      className: "mx_Login_submit",
      type: "submit",
      value: (0, _languageHandler._t)('Sign in'),
      disabled: this.props.disableSubmit
    })));
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  onUsernameChanged: function () {},
  onUsernameBlur: function () {},
  onPhoneCountryChanged: function () {},
  onPhoneNumberChanged: function () {},
  loginIncorrect: false,
  disableSubmit: false
}), _temp)) || _class);
exports.default = PasswordLogin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2F1dGgvUGFzc3dvcmRMb2dpbi50c3giXSwibmFtZXMiOlsiUEhPTkVfTlVNQkVSX1JFR0VYIiwiTG9naW5GaWVsZCIsIlBhc3N3b3JkTG9naW4iLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiZXYiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsIm9uRm9yZ290UGFzc3dvcmRDbGljayIsImFsbEZpZWxkc1ZhbGlkIiwidmVyaWZ5RmllbGRzQmVmb3JlU3VibWl0IiwiQ291bnRseUFuYWx5dGljcyIsImluc3RhbmNlIiwidHJhY2siLCJ1c2VybmFtZSIsInBob25lQ291bnRyeSIsInBob25lTnVtYmVyIiwic3RhdGUiLCJsb2dpblR5cGUiLCJFbWFpbCIsIk1hdHJpeElkIiwiUGhvbmUiLCJvblN1Ym1pdCIsInBhc3N3b3JkIiwib25Vc2VybmFtZUNoYW5nZWQiLCJ0YXJnZXQiLCJ2YWx1ZSIsIm9uVXNlcm5hbWVCbHVyIiwic2V0U3RhdGUiLCJjb3VudHJ5Iiwib25QaG9uZUNvdW50cnlDaGFuZ2VkIiwiaXNvMiIsIm9uUGhvbmVOdW1iZXJDaGFuZ2VkIiwicnVsZXMiLCJrZXkiLCJ0ZXN0IiwiYWxsb3dFbXB0eSIsImludmFsaWQiLCJmaWVsZFN0YXRlIiwicmVzdWx0IiwidmFsaWRhdGVVc2VybmFtZVJ1bGVzIiwibWFya0ZpZWxkVmFsaWQiLCJ2YWxpZCIsInZhbGlkYXRlUGhvbmVOdW1iZXJSdWxlcyIsIlBhc3N3b3JkIiwidmFsaWRhdGVQYXNzd29yZFJ1bGVzIiwiZmllbGRWYWxpZCIsImFjdGl2ZUVsZW1lbnQiLCJkb2N1bWVudCIsImJsdXIiLCJmaWVsZElEc0luRGlzcGxheU9yZGVyIiwiZmllbGRJRCIsImZpZWxkIiwidmFsaWRhdGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsImludmFsaWRGaWVsZCIsImZpbmRGaXJzdEludmFsaWRGaWVsZCIsImZvY3VzIiwiZm9jdXNlZCIsImtleXMiLCJPYmplY3QiLCJpIiwibGVuZ3RoIiwiZmllbGRJRHMiLCJyZW5kZXJMb2dpbkZpZWxkIiwiYXV0b0ZvY3VzIiwiY2xhc3NlcyIsImVycm9yIiwibG9naW5JbmNvcnJlY3QiLCJvblVzZXJuYW1lRm9jdXMiLCJkaXNhYmxlU3VibWl0Iiwib25FbWFpbFZhbGlkYXRlIiwidG9Mb2NhbGVMb3dlckNhc2UiLCJvblVzZXJuYW1lVmFsaWRhdGUiLCJvblBob25lTnVtYmVyRm9jdXMiLCJvblBob25lTnVtYmVyQmx1ciIsIm9uUGhvbmVOdW1iZXJWYWxpZGF0ZSIsImlzTG9naW5FbXB0eSIsInJlbmRlciIsImZvcmdvdFBhc3N3b3JkSnN4IiwiYnVzeSIsInB3RmllbGRDbGFzcyIsImF1dG9Gb2N1c1Bhc3N3b3JkIiwibG9naW5GaWVsZCIsIlNka0NvbmZpZyIsImdldCIsImRpc2FibGVfM3BpZF9sb2dpbiIsIm9uTG9naW5UeXBlQ2hhbmdlIiwib25TdWJtaXRGb3JtIiwib25QYXNzd29yZENoYW5nZWQiLCJvblBhc3N3b3JkVmFsaWRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUE7QUFDQSxNQUFNQSxrQkFBa0IsR0FBRyxnQkFBM0I7SUEyQktDLFU7QUFPTDtBQUNBO0FBQ0E7QUFDQTs7V0FWS0EsVTtBQUFBQSxFQUFBQSxVO0FBQUFBLEVBQUFBLFU7QUFBQUEsRUFBQUEsVTtBQUFBQSxFQUFBQSxVO0dBQUFBLFUsS0FBQUEsVTs7SUFZZ0JDLGEsV0FEcEIsZ0RBQXFCLDBCQUFyQixDLG1DQUFELE1BQ3FCQSxhQURyQixTQUMyQ0MsZUFBTUMsYUFEakQsQ0FDK0U7QUFVM0VDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFRO0FBQ2YsVUFBTUEsS0FBTjtBQURlLGlFQVVhQyxFQUFFLElBQUk7QUFDbENBLE1BQUFBLEVBQUUsQ0FBQ0MsY0FBSDtBQUNBRCxNQUFBQSxFQUFFLENBQUNFLGVBQUg7QUFDQSxXQUFLSCxLQUFMLENBQVdJLHFCQUFYO0FBQ0gsS0Fka0I7QUFBQSx3REFnQkksTUFBTUgsRUFBTixJQUFZO0FBQy9CQSxNQUFBQSxFQUFFLENBQUNDLGNBQUg7QUFFQSxZQUFNRyxjQUFjLEdBQUcsTUFBTSxLQUFLQyx3QkFBTCxFQUE3Qjs7QUFDQSxVQUFJLENBQUNELGNBQUwsRUFBcUI7QUFDakJFLGtDQUFpQkMsUUFBakIsQ0FBMEJDLEtBQTFCLENBQWdDLHVDQUFoQzs7QUFDQTtBQUNIOztBQUVELFVBQUlDLFFBQVEsR0FBRyxFQUFmLENBVCtCLENBU1o7O0FBQ25CLFVBQUlDLFlBQVksR0FBRyxJQUFuQjtBQUNBLFVBQUlDLFdBQVcsR0FBRyxJQUFsQjs7QUFFQSxjQUFRLEtBQUtDLEtBQUwsQ0FBV0MsU0FBbkI7QUFDSSxhQUFLbkIsVUFBVSxDQUFDb0IsS0FBaEI7QUFDQSxhQUFLcEIsVUFBVSxDQUFDcUIsUUFBaEI7QUFDSU4sVUFBQUEsUUFBUSxHQUFHLEtBQUtWLEtBQUwsQ0FBV1UsUUFBdEI7QUFDQTs7QUFDSixhQUFLZixVQUFVLENBQUNzQixLQUFoQjtBQUNJTixVQUFBQSxZQUFZLEdBQUcsS0FBS1gsS0FBTCxDQUFXVyxZQUExQjtBQUNBQyxVQUFBQSxXQUFXLEdBQUcsS0FBS1osS0FBTCxDQUFXWSxXQUF6QjtBQUNBO0FBUlI7O0FBV0EsV0FBS1osS0FBTCxDQUFXa0IsUUFBWCxDQUFvQlIsUUFBcEIsRUFBOEJDLFlBQTlCLEVBQTRDQyxXQUE1QyxFQUF5RCxLQUFLQyxLQUFMLENBQVdNLFFBQXBFO0FBQ0gsS0F6Q2tCO0FBQUEsNkRBMkNTbEIsRUFBRSxJQUFJO0FBQzlCLFdBQUtELEtBQUwsQ0FBV29CLGlCQUFYLENBQTZCbkIsRUFBRSxDQUFDb0IsTUFBSCxDQUFVQyxLQUF2QztBQUNILEtBN0NrQjtBQUFBLDJEQStDTyxNQUFNO0FBQzVCLFVBQUksS0FBS1QsS0FBTCxDQUFXQyxTQUFYLEtBQXlCbkIsVUFBVSxDQUFDcUIsUUFBeEMsRUFBa0Q7QUFDOUNULGtDQUFpQkMsUUFBakIsQ0FBMEJDLEtBQTFCLENBQWdDLDZCQUFoQztBQUNILE9BRkQsTUFFTztBQUNIRixrQ0FBaUJDLFFBQWpCLENBQTBCQyxLQUExQixDQUFnQyw4QkFBaEM7QUFDSDtBQUNKLEtBckRrQjtBQUFBLDBEQXVETVIsRUFBRSxJQUFJO0FBQzNCLFVBQUksS0FBS1ksS0FBTCxDQUFXQyxTQUFYLEtBQXlCbkIsVUFBVSxDQUFDcUIsUUFBeEMsRUFBa0Q7QUFDOUNULGtDQUFpQkMsUUFBakIsQ0FBMEJDLEtBQTFCLENBQWdDLDRCQUFoQztBQUNILE9BRkQsTUFFTztBQUNIRixrQ0FBaUJDLFFBQWpCLENBQTBCQyxLQUExQixDQUFnQyw2QkFBaEM7QUFDSDs7QUFDRCxXQUFLVCxLQUFMLENBQVd1QixjQUFYLENBQTBCdEIsRUFBRSxDQUFDb0IsTUFBSCxDQUFVQyxLQUFwQztBQUNILEtBOURrQjtBQUFBLDZEQWdFU3JCLEVBQUUsSUFBSTtBQUM5QixZQUFNYSxTQUFTLEdBQUdiLEVBQUUsQ0FBQ29CLE1BQUgsQ0FBVUMsS0FBNUI7QUFDQSxXQUFLRSxRQUFMLENBQWM7QUFBRVYsUUFBQUE7QUFBRixPQUFkO0FBQ0EsV0FBS2QsS0FBTCxDQUFXb0IsaUJBQVgsQ0FBNkIsRUFBN0IsRUFIOEIsQ0FHSTs7QUFDbENiLGdDQUFpQkMsUUFBakIsQ0FBMEJDLEtBQTFCLENBQWdDLCtCQUFoQyxFQUFpRTtBQUFFSyxRQUFBQTtBQUFGLE9BQWpFO0FBQ0gsS0FyRWtCO0FBQUEsaUVBdUVhVyxPQUFPLElBQUk7QUFDdkMsV0FBS3pCLEtBQUwsQ0FBVzBCLHFCQUFYLENBQWlDRCxPQUFPLENBQUNFLElBQXpDO0FBQ0gsS0F6RWtCO0FBQUEsZ0VBMkVZMUIsRUFBRSxJQUFJO0FBQ2pDLFdBQUtELEtBQUwsQ0FBVzRCLG9CQUFYLENBQWdDM0IsRUFBRSxDQUFDb0IsTUFBSCxDQUFVQyxLQUExQztBQUNILEtBN0VrQjtBQUFBLDhEQStFVSxNQUFNO0FBQy9CZixnQ0FBaUJDLFFBQWpCLENBQTBCQyxLQUExQixDQUFnQyxxQ0FBaEM7QUFDSCxLQWpGa0I7QUFBQSw2REFtRlNSLEVBQUUsSUFBSTtBQUM5Qk0sZ0NBQWlCQyxRQUFqQixDQUEwQkMsS0FBMUIsQ0FBZ0Msb0NBQWhDO0FBQ0gsS0FyRmtCO0FBQUEsNkRBdUZTUixFQUFFLElBQUk7QUFDOUIsV0FBS3VCLFFBQUwsQ0FBYztBQUFFTCxRQUFBQSxRQUFRLEVBQUVsQixFQUFFLENBQUNvQixNQUFILENBQVVDO0FBQXRCLE9BQWQ7QUFDSCxLQXpGa0I7QUFBQSxpRUFzS2EseUJBQWU7QUFDM0NPLE1BQUFBLEtBQUssRUFBRSxDQUNIO0FBQ0lDLFFBQUFBLEdBQUcsRUFBRSxVQURUOztBQUVJQyxRQUFBQSxJQUFJLENBQUM7QUFBRVQsVUFBQUEsS0FBRjtBQUFTVSxVQUFBQTtBQUFULFNBQUQsRUFBd0I7QUFDeEIsaUJBQU9BLFVBQVUsSUFBSSxDQUFDLENBQUNWLEtBQXZCO0FBQ0gsU0FKTDs7QUFLSVcsUUFBQUEsT0FBTyxFQUFFLE1BQU0seUJBQUcsZ0JBQUg7QUFMbkIsT0FERztBQURvQyxLQUFmLENBdEtiO0FBQUEsOERBa0xVLE1BQU9DLFVBQVAsSUFBc0I7QUFDL0MsWUFBTUMsTUFBTSxHQUFHLE1BQU0sS0FBS0MscUJBQUwsQ0FBMkJGLFVBQTNCLENBQXJCO0FBQ0EsV0FBS0csY0FBTCxDQUFvQjFDLFVBQVUsQ0FBQ3FCLFFBQS9CLEVBQXlDbUIsTUFBTSxDQUFDRyxLQUFoRDtBQUNBLGFBQU9ILE1BQVA7QUFDSCxLQXRMa0I7QUFBQSwyREF3TFFBLE1BQUQsSUFBK0I7QUFDckQsV0FBS0UsY0FBTCxDQUFvQjFDLFVBQVUsQ0FBQ29CLEtBQS9CLEVBQXNDb0IsTUFBTSxDQUFDRyxLQUE3QztBQUNILEtBMUxrQjtBQUFBLG9FQTRMZ0IseUJBQWU7QUFDOUNULE1BQUFBLEtBQUssRUFBRSxDQUNIO0FBQ0lDLFFBQUFBLEdBQUcsRUFBRSxVQURUOztBQUVJQyxRQUFBQSxJQUFJLENBQUM7QUFBRVQsVUFBQUEsS0FBRjtBQUFTVSxVQUFBQTtBQUFULFNBQUQsRUFBd0I7QUFDeEIsaUJBQU9BLFVBQVUsSUFBSSxDQUFDLENBQUNWLEtBQXZCO0FBQ0gsU0FKTDs7QUFLSVcsUUFBQUEsT0FBTyxFQUFFLE1BQU0seUJBQUcsb0JBQUg7QUFMbkIsT0FERyxFQU9BO0FBQ0NILFFBQUFBLEdBQUcsRUFBRSxRQUROO0FBRUNDLFFBQUFBLElBQUksRUFBRSxDQUFDO0FBQUVULFVBQUFBO0FBQUYsU0FBRCxLQUFlLENBQUNBLEtBQUQsSUFBVTVCLGtCQUFrQixDQUFDcUMsSUFBbkIsQ0FBd0JULEtBQXhCLENBRmhDO0FBR0NXLFFBQUFBLE9BQU8sRUFBRSxNQUFNLHlCQUFHLHdFQUFIO0FBSGhCLE9BUEE7QUFEdUMsS0FBZixDQTVMaEI7QUFBQSxpRUE0TWEsTUFBT0MsVUFBUCxJQUFzQjtBQUNsRCxZQUFNQyxNQUFNLEdBQUcsTUFBTSxLQUFLSSx3QkFBTCxDQUE4QkwsVUFBOUIsQ0FBckI7QUFDQSxXQUFLRyxjQUFMLENBQW9CMUMsVUFBVSxDQUFDNkMsUUFBL0IsRUFBeUNMLE1BQU0sQ0FBQ0csS0FBaEQ7QUFDQSxhQUFPSCxNQUFQO0FBQ0gsS0FoTmtCO0FBQUEsaUVBa05hLHlCQUFlO0FBQzNDTixNQUFBQSxLQUFLLEVBQUUsQ0FDSDtBQUNJQyxRQUFBQSxHQUFHLEVBQUUsVUFEVDs7QUFFSUMsUUFBQUEsSUFBSSxDQUFDO0FBQUVULFVBQUFBLEtBQUY7QUFBU1UsVUFBQUE7QUFBVCxTQUFELEVBQXdCO0FBQ3hCLGlCQUFPQSxVQUFVLElBQUksQ0FBQyxDQUFDVixLQUF2QjtBQUNILFNBSkw7O0FBS0lXLFFBQUFBLE9BQU8sRUFBRSxNQUFNLHlCQUFHLGdCQUFIO0FBTG5CLE9BREc7QUFEb0MsS0FBZixDQWxOYjtBQUFBLDhEQThOVSxNQUFPQyxVQUFQLElBQXNCO0FBQy9DLFlBQU1DLE1BQU0sR0FBRyxNQUFNLEtBQUtNLHFCQUFMLENBQTJCUCxVQUEzQixDQUFyQjtBQUNBLFdBQUtHLGNBQUwsQ0FBb0IxQyxVQUFVLENBQUM2QyxRQUEvQixFQUF5Q0wsTUFBTSxDQUFDRyxLQUFoRDtBQUNBLGFBQU9ILE1BQVA7QUFDSCxLQWxPa0I7QUFFZixTQUFLdEIsS0FBTCxHQUFhO0FBQ1Q7QUFDQTZCLE1BQUFBLFVBQVUsRUFBRSxFQUZIO0FBR1Q1QixNQUFBQSxTQUFTLEVBQUVuQixVQUFVLENBQUNxQixRQUhiO0FBSVRHLE1BQUFBLFFBQVEsRUFBRTtBQUpELEtBQWI7QUFNSDs7QUFtRnFDLFFBQXhCYix3QkFBd0IsR0FBRztBQUNyQztBQUNBO0FBQ0EsVUFBTXFDLGFBQWEsR0FBR0MsUUFBUSxDQUFDRCxhQUEvQjs7QUFDQSxRQUFJQSxhQUFKLEVBQW1CO0FBQ2ZBLE1BQUFBLGFBQWEsQ0FBQ0UsSUFBZDtBQUNIOztBQUVELFVBQU1DLHNCQUFzQixHQUFHLENBQzNCLEtBQUtqQyxLQUFMLENBQVdDLFNBRGdCLEVBRTNCbkIsVUFBVSxDQUFDNkMsUUFGZ0IsQ0FBL0IsQ0FScUMsQ0FhckM7QUFDQTs7QUFDQSxTQUFLLE1BQU1PLE9BQVgsSUFBc0JELHNCQUF0QixFQUE4QztBQUMxQyxZQUFNRSxLQUFLLEdBQUcsS0FBS0QsT0FBTCxDQUFkOztBQUNBLFVBQUksQ0FBQ0MsS0FBTCxFQUFZO0FBQ1I7QUFDSCxPQUp5QyxDQUsxQztBQUNBO0FBQ0E7QUFDQTs7O0FBQ0EsWUFBTUEsS0FBSyxDQUFDQyxRQUFOLENBQWU7QUFBRWpCLFFBQUFBLFVBQVUsRUFBRTtBQUFkLE9BQWYsQ0FBTjtBQUNILEtBekJvQyxDQTJCckM7QUFDQTs7O0FBQ0EsVUFBTSxJQUFJa0IsT0FBSixDQUFrQkMsT0FBTyxJQUFJLEtBQUszQixRQUFMLENBQWMsRUFBZCxFQUFrQjJCLE9BQWxCLENBQTdCLENBQU47O0FBRUEsUUFBSSxLQUFLOUMsY0FBTCxFQUFKLEVBQTJCO0FBQ3ZCLGFBQU8sSUFBUDtBQUNIOztBQUVELFVBQU0rQyxZQUFZLEdBQUcsS0FBS0MscUJBQUwsQ0FBMkJQLHNCQUEzQixDQUFyQjs7QUFFQSxRQUFJLENBQUNNLFlBQUwsRUFBbUI7QUFDZixhQUFPLElBQVA7QUFDSCxLQXZDb0MsQ0F5Q3JDO0FBQ0E7OztBQUNBQSxJQUFBQSxZQUFZLENBQUNFLEtBQWI7QUFDQUYsSUFBQUEsWUFBWSxDQUFDSCxRQUFiLENBQXNCO0FBQUVqQixNQUFBQSxVQUFVLEVBQUUsS0FBZDtBQUFxQnVCLE1BQUFBLE9BQU8sRUFBRTtBQUE5QixLQUF0QjtBQUNBLFdBQU8sS0FBUDtBQUNIOztBQUVPbEQsRUFBQUEsY0FBYyxHQUFHO0FBQ3JCLFVBQU1tRCxJQUFJLEdBQUdDLE1BQU0sQ0FBQ0QsSUFBUCxDQUFZLEtBQUszQyxLQUFMLENBQVc2QixVQUF2QixDQUFiOztBQUNBLFNBQUssSUFBSWdCLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdGLElBQUksQ0FBQ0csTUFBekIsRUFBaUMsRUFBRUQsQ0FBbkMsRUFBc0M7QUFDbEMsVUFBSSxDQUFDLEtBQUs3QyxLQUFMLENBQVc2QixVQUFYLENBQXNCYyxJQUFJLENBQUNFLENBQUQsQ0FBMUIsQ0FBTCxFQUFxQztBQUNqQyxlQUFPLEtBQVA7QUFDSDtBQUNKOztBQUNELFdBQU8sSUFBUDtBQUNIOztBQUVPTCxFQUFBQSxxQkFBcUIsQ0FBQ08sUUFBRCxFQUF5QjtBQUNsRCxTQUFLLE1BQU1iLE9BQVgsSUFBc0JhLFFBQXRCLEVBQWdDO0FBQzVCLFVBQUksQ0FBQyxLQUFLL0MsS0FBTCxDQUFXNkIsVUFBWCxDQUFzQkssT0FBdEIsQ0FBRCxJQUFtQyxLQUFLQSxPQUFMLENBQXZDLEVBQXNEO0FBQ2xELGVBQU8sS0FBS0EsT0FBTCxDQUFQO0FBQ0g7QUFDSjs7QUFDRCxXQUFPLElBQVA7QUFDSDs7QUFFT1YsRUFBQUEsY0FBYyxDQUFDVSxPQUFELEVBQXNCVCxLQUF0QixFQUFzQztBQUN4RCxVQUFNO0FBQUVJLE1BQUFBO0FBQUYsUUFBaUIsS0FBSzdCLEtBQTVCO0FBQ0E2QixJQUFBQSxVQUFVLENBQUNLLE9BQUQsQ0FBVixHQUFzQlQsS0FBdEI7QUFDQSxTQUFLZCxRQUFMLENBQWM7QUFDVmtCLE1BQUFBO0FBRFUsS0FBZDtBQUdIOztBQWdFT21CLEVBQUFBLGdCQUFnQixDQUFDL0MsU0FBRCxFQUFpQ2dELFNBQWpDLEVBQXFEO0FBQ3pFLFVBQU1DLE9BQU8sR0FBRztBQUNaQyxNQUFBQSxLQUFLLEVBQUU7QUFESyxLQUFoQjs7QUFJQSxZQUFRbEQsU0FBUjtBQUNJLFdBQUtuQixVQUFVLENBQUNvQixLQUFoQjtBQUNJZ0QsUUFBQUEsT0FBTyxDQUFDQyxLQUFSLEdBQWdCLEtBQUtoRSxLQUFMLENBQVdpRSxjQUFYLElBQTZCLENBQUMsS0FBS2pFLEtBQUwsQ0FBV1UsUUFBekQ7QUFDQSw0QkFBTyw2QkFBQyxtQkFBRDtBQUNILFVBQUEsU0FBUyxFQUFFLHlCQUFXcUQsT0FBWCxDQURSO0FBRUgsVUFBQSxJQUFJLEVBQUMsVUFGRixDQUVhO0FBRmI7QUFHSCxVQUFBLFlBQVksRUFBQyxPQUhWO0FBSUgsVUFBQSxJQUFJLEVBQUMsT0FKRjtBQUtILFVBQUEsR0FBRyxFQUFDLGFBTEQ7QUFNSCxVQUFBLFdBQVcsRUFBQyxpQkFOVDtBQU9ILFVBQUEsS0FBSyxFQUFFLEtBQUsvRCxLQUFMLENBQVdVLFFBUGY7QUFRSCxVQUFBLFFBQVEsRUFBRSxLQUFLVSxpQkFSWjtBQVNILFVBQUEsT0FBTyxFQUFFLEtBQUs4QyxlQVRYO0FBVUgsVUFBQSxNQUFNLEVBQUUsS0FBSzNDLGNBVlY7QUFXSCxVQUFBLFFBQVEsRUFBRSxLQUFLdkIsS0FBTCxDQUFXbUUsYUFYbEI7QUFZSCxVQUFBLFNBQVMsRUFBRUwsU0FaUjtBQWFILFVBQUEsVUFBVSxFQUFFLEtBQUtNLGVBYmQ7QUFjSCxVQUFBLFFBQVEsRUFBRXBCLEtBQUssSUFBSSxLQUFLckQsVUFBVSxDQUFDb0IsS0FBaEIsSUFBeUJpQztBQWR6QyxVQUFQOztBQWdCSixXQUFLckQsVUFBVSxDQUFDcUIsUUFBaEI7QUFDSStDLFFBQUFBLE9BQU8sQ0FBQ0MsS0FBUixHQUFnQixLQUFLaEUsS0FBTCxDQUFXaUUsY0FBWCxJQUE2QixDQUFDLEtBQUtqRSxLQUFMLENBQVdVLFFBQXpEO0FBQ0EsNEJBQU8sNkJBQUMsY0FBRDtBQUNILFVBQUEsU0FBUyxFQUFFLHlCQUFXcUQsT0FBWCxDQURSO0FBRUgsVUFBQSxJQUFJLEVBQUMsVUFGRixDQUVhO0FBRmI7QUFHSCxVQUFBLFlBQVksRUFBQyxVQUhWO0FBSUgsVUFBQSxHQUFHLEVBQUMsZ0JBSkQ7QUFLSCxVQUFBLElBQUksRUFBQyxNQUxGO0FBTUgsVUFBQSxLQUFLLEVBQUUseUJBQUcsVUFBSCxDQU5KO0FBT0gsVUFBQSxXQUFXLEVBQUUseUJBQUcsVUFBSCxFQUFlTSxpQkFBZixFQVBWO0FBUUgsVUFBQSxLQUFLLEVBQUUsS0FBS3JFLEtBQUwsQ0FBV1UsUUFSZjtBQVNILFVBQUEsUUFBUSxFQUFFLEtBQUtVLGlCQVRaO0FBVUgsVUFBQSxPQUFPLEVBQUUsS0FBSzhDLGVBVlg7QUFXSCxVQUFBLE1BQU0sRUFBRSxLQUFLM0MsY0FYVjtBQVlILFVBQUEsUUFBUSxFQUFFLEtBQUt2QixLQUFMLENBQVdtRSxhQVpsQjtBQWFILFVBQUEsU0FBUyxFQUFFTCxTQWJSO0FBY0gsVUFBQSxVQUFVLEVBQUUsS0FBS1Esa0JBZGQ7QUFlSCxVQUFBLEdBQUcsRUFBRXRCLEtBQUssSUFBSSxLQUFLckQsVUFBVSxDQUFDcUIsUUFBaEIsSUFBNEJnQztBQWZ2QyxVQUFQOztBQWlCSixXQUFLckQsVUFBVSxDQUFDc0IsS0FBaEI7QUFBdUI7QUFDbkI4QyxVQUFBQSxPQUFPLENBQUNDLEtBQVIsR0FBZ0IsS0FBS2hFLEtBQUwsQ0FBV2lFLGNBQVgsSUFBNkIsQ0FBQyxLQUFLakUsS0FBTCxDQUFXWSxXQUF6RDs7QUFFQSxnQkFBTUQsWUFBWSxnQkFBRyw2QkFBQyx3QkFBRDtBQUNqQixZQUFBLEtBQUssRUFBRSxLQUFLWCxLQUFMLENBQVdXLFlBREQ7QUFFakIsWUFBQSxPQUFPLEVBQUUsSUFGUTtBQUdqQixZQUFBLFVBQVUsRUFBRSxJQUhLO0FBSWpCLFlBQUEsY0FBYyxFQUFFLEtBQUtlO0FBSkosWUFBckI7O0FBT0EsOEJBQU8sNkJBQUMsY0FBRDtBQUNILFlBQUEsU0FBUyxFQUFFLHlCQUFXcUMsT0FBWCxDQURSO0FBRUgsWUFBQSxJQUFJLEVBQUMsYUFGRjtBQUdILFlBQUEsWUFBWSxFQUFDLGNBSFY7QUFJSCxZQUFBLEdBQUcsRUFBQyxhQUpEO0FBS0gsWUFBQSxJQUFJLEVBQUMsTUFMRjtBQU1ILFlBQUEsS0FBSyxFQUFFLHlCQUFHLE9BQUgsQ0FOSjtBQU9ILFlBQUEsS0FBSyxFQUFFLEtBQUsvRCxLQUFMLENBQVdZLFdBUGY7QUFRSCxZQUFBLGVBQWUsRUFBRUQsWUFSZDtBQVNILFlBQUEsUUFBUSxFQUFFLEtBQUtpQixvQkFUWjtBQVVILFlBQUEsT0FBTyxFQUFFLEtBQUsyQyxrQkFWWDtBQVdILFlBQUEsTUFBTSxFQUFFLEtBQUtDLGlCQVhWO0FBWUgsWUFBQSxRQUFRLEVBQUUsS0FBS3hFLEtBQUwsQ0FBV21FLGFBWmxCO0FBYUgsWUFBQSxTQUFTLEVBQUVMLFNBYlI7QUFjSCxZQUFBLFVBQVUsRUFBRSxLQUFLVyxxQkFkZDtBQWVILFlBQUEsR0FBRyxFQUFFekIsS0FBSyxJQUFJLEtBQUtyRCxVQUFVLENBQUM2QyxRQUFoQixJQUE0QlE7QUFmdkMsWUFBUDtBQWlCSDtBQWpFTDtBQW1FSDs7QUFFTzBCLEVBQUFBLFlBQVksR0FBRztBQUNuQixZQUFRLEtBQUs3RCxLQUFMLENBQVdDLFNBQW5CO0FBQ0ksV0FBS25CLFVBQVUsQ0FBQ29CLEtBQWhCO0FBQ0EsV0FBS3BCLFVBQVUsQ0FBQ3FCLFFBQWhCO0FBQ0ksZUFBTyxDQUFDLEtBQUtoQixLQUFMLENBQVdVLFFBQW5COztBQUNKLFdBQUtmLFVBQVUsQ0FBQ3NCLEtBQWhCO0FBQ0ksZUFBTyxDQUFDLEtBQUtqQixLQUFMLENBQVdXLFlBQVosSUFBNEIsQ0FBQyxLQUFLWCxLQUFMLENBQVdZLFdBQS9DO0FBTFI7QUFPSDs7QUFFRCtELEVBQUFBLE1BQU0sR0FBRztBQUNMLFFBQUlDLGlCQUFKOztBQUVBLFFBQUksS0FBSzVFLEtBQUwsQ0FBV0kscUJBQWYsRUFBc0M7QUFDbEN3RSxNQUFBQSxpQkFBaUIsZ0JBQUcsNkJBQUMseUJBQUQ7QUFDaEIsUUFBQSxTQUFTLEVBQUMsaUJBRE07QUFFaEIsUUFBQSxRQUFRLEVBQUUsS0FBSzVFLEtBQUwsQ0FBVzZFLElBRkw7QUFHaEIsUUFBQSxJQUFJLEVBQUMsTUFIVztBQUloQixRQUFBLE9BQU8sRUFBRSxLQUFLekU7QUFKRSxTQU1kLHlCQUFHLGtCQUFILENBTmMsQ0FBcEI7QUFRSDs7QUFFRCxVQUFNMEUsWUFBWSxHQUFHLHlCQUFXO0FBQzVCZCxNQUFBQSxLQUFLLEVBQUUsS0FBS2hFLEtBQUwsQ0FBV2lFLGNBQVgsSUFBNkIsQ0FBQyxLQUFLUyxZQUFMLEVBRFQsQ0FDOEI7O0FBRDlCLEtBQVgsQ0FBckIsQ0FkSyxDQWtCTDtBQUNBOztBQUNBLFVBQU1LLGlCQUFpQixHQUFHLENBQUMsS0FBS0wsWUFBTCxFQUEzQjtBQUNBLFVBQU1NLFVBQVUsR0FBRyxLQUFLbkIsZ0JBQUwsQ0FBc0IsS0FBS2hELEtBQUwsQ0FBV0MsU0FBakMsRUFBNEMsQ0FBQ2lFLGlCQUE3QyxDQUFuQjtBQUVBLFFBQUlqRSxTQUFKOztBQUNBLFFBQUksQ0FBQ21FLG1CQUFVQyxHQUFWLEdBQWdCQyxrQkFBckIsRUFBeUM7QUFDckNyRSxNQUFBQSxTQUFTLGdCQUNMO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixzQkFDSTtBQUFPLFFBQUEsU0FBUyxFQUFDO0FBQWpCLFNBQXlDLHlCQUFHLGNBQUgsQ0FBekMsQ0FESixlQUVJLDZCQUFDLGNBQUQ7QUFDSSxRQUFBLE9BQU8sRUFBQyxRQURaO0FBRUksUUFBQSxLQUFLLEVBQUUsS0FBS0QsS0FBTCxDQUFXQyxTQUZ0QjtBQUdJLFFBQUEsUUFBUSxFQUFFLEtBQUtzRSxpQkFIbkI7QUFJSSxRQUFBLFFBQVEsRUFBRSxLQUFLcEYsS0FBTCxDQUFXbUU7QUFKekIsc0JBTUk7QUFBUSxRQUFBLEdBQUcsRUFBRXhFLFVBQVUsQ0FBQ3FCLFFBQXhCO0FBQWtDLFFBQUEsS0FBSyxFQUFFckIsVUFBVSxDQUFDcUI7QUFBcEQsU0FDTSx5QkFBRyxVQUFILENBRE4sQ0FOSixlQVNJO0FBQ0ksUUFBQSxHQUFHLEVBQUVyQixVQUFVLENBQUNvQixLQURwQjtBQUVJLFFBQUEsS0FBSyxFQUFFcEIsVUFBVSxDQUFDb0I7QUFGdEIsU0FJTSx5QkFBRyxlQUFILENBSk4sQ0FUSixlQWVJO0FBQVEsUUFBQSxHQUFHLEVBQUVwQixVQUFVLENBQUM2QyxRQUF4QjtBQUFrQyxRQUFBLEtBQUssRUFBRTdDLFVBQVUsQ0FBQzZDO0FBQXBELFNBQ00seUJBQUcsT0FBSCxDQUROLENBZkosQ0FGSixDQURKO0FBd0JIOztBQUVELHdCQUNJLHVEQUNJO0FBQU0sTUFBQSxRQUFRLEVBQUUsS0FBSzZDO0FBQXJCLE9BQ012RSxTQUROLEVBRU1rRSxVQUZOLGVBR0ksNkJBQUMsY0FBRDtBQUNJLE1BQUEsU0FBUyxFQUFFRixZQURmO0FBRUksTUFBQSxZQUFZLEVBQUMsVUFGakI7QUFHSSxNQUFBLElBQUksRUFBQyxVQUhUO0FBSUksTUFBQSxJQUFJLEVBQUMsVUFKVDtBQUtJLE1BQUEsS0FBSyxFQUFFLHlCQUFHLFVBQUgsQ0FMWDtBQU1JLE1BQUEsS0FBSyxFQUFFLEtBQUtqRSxLQUFMLENBQVdNLFFBTnRCO0FBT0ksTUFBQSxRQUFRLEVBQUUsS0FBS21FLGlCQVBuQjtBQVFJLE1BQUEsUUFBUSxFQUFFLEtBQUt0RixLQUFMLENBQVdtRSxhQVJ6QjtBQVNJLE1BQUEsU0FBUyxFQUFFWSxpQkFUZjtBQVVJLE1BQUEsVUFBVSxFQUFFLEtBQUtRLGtCQVZyQjtBQVdJLE1BQUEsR0FBRyxFQUFFdkMsS0FBSyxJQUFJLEtBQUtyRCxVQUFVLENBQUM2QyxRQUFoQixJQUE0QlE7QUFYOUMsTUFISixFQWdCTTRCLGlCQWhCTixFQWlCTSxDQUFDLEtBQUs1RSxLQUFMLENBQVc2RSxJQUFaLGlCQUFvQjtBQUFPLE1BQUEsU0FBUyxFQUFDLGlCQUFqQjtBQUNsQixNQUFBLElBQUksRUFBQyxRQURhO0FBRWxCLE1BQUEsS0FBSyxFQUFFLHlCQUFHLFNBQUgsQ0FGVztBQUdsQixNQUFBLFFBQVEsRUFBRSxLQUFLN0UsS0FBTCxDQUFXbUU7QUFISCxNQWpCMUIsQ0FESixDQURKO0FBMkJIOztBQWhaMEUsQyx5REFDckQ7QUFDbEIvQyxFQUFBQSxpQkFBaUIsRUFBRSxZQUFXLENBQUUsQ0FEZDtBQUVsQkcsRUFBQUEsY0FBYyxFQUFFLFlBQVcsQ0FBRSxDQUZYO0FBR2xCRyxFQUFBQSxxQkFBcUIsRUFBRSxZQUFXLENBQUUsQ0FIbEI7QUFJbEJFLEVBQUFBLG9CQUFvQixFQUFFLFlBQVcsQ0FBRSxDQUpqQjtBQUtsQnFDLEVBQUFBLGNBQWMsRUFBRSxLQUxFO0FBTWxCRSxFQUFBQSxhQUFhLEVBQUU7QUFORyxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE1LCAyMDE2LCAyMDE3LCAyMDE5IFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuXG5pbXBvcnQgeyBfdCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgU2RrQ29uZmlnIGZyb20gJy4uLy4uLy4uL1Nka0NvbmZpZyc7XG5pbXBvcnQgeyBWYWxpZGF0ZWRTZXJ2ZXJDb25maWcgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvQXV0b0Rpc2NvdmVyeVV0aWxzXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IENvdW50bHlBbmFseXRpY3MgZnJvbSBcIi4uLy4uLy4uL0NvdW50bHlBbmFseXRpY3NcIjtcbmltcG9ydCB3aXRoVmFsaWRhdGlvbiwgeyBJVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gXCIuLi9lbGVtZW50cy9WYWxpZGF0aW9uXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcIi4uL2VsZW1lbnRzL0ZpZWxkXCI7XG5pbXBvcnQgQ291bnRyeURyb3Bkb3duIGZyb20gXCIuL0NvdW50cnlEcm9wZG93blwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCBFbWFpbEZpZWxkIGZyb20gXCIuL0VtYWlsRmllbGRcIjtcblxuLy8gRm9yIHZhbGlkYXRpbmcgcGhvbmUgbnVtYmVycyB3aXRob3V0IGNvdW50cnkgY29kZXNcbmNvbnN0IFBIT05FX05VTUJFUl9SRUdFWCA9IC9eWzAtOSgpXFwtXFxzXSokLztcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgdXNlcm5hbWU6IHN0cmluZzsgLy8gYWxzbyB1c2VkIGZvciBlbWFpbCBhZGRyZXNzXG4gICAgcGhvbmVDb3VudHJ5OiBzdHJpbmc7XG4gICAgcGhvbmVOdW1iZXI6IHN0cmluZztcblxuICAgIHNlcnZlckNvbmZpZzogVmFsaWRhdGVkU2VydmVyQ29uZmlnO1xuICAgIGxvZ2luSW5jb3JyZWN0PzogYm9vbGVhbjtcbiAgICBkaXNhYmxlU3VibWl0PzogYm9vbGVhbjtcbiAgICBidXN5PzogYm9vbGVhbjtcblxuICAgIG9uU3VibWl0KHVzZXJuYW1lOiBzdHJpbmcsIHBob25lQ291bnRyeTogdm9pZCwgcGhvbmVOdW1iZXI6IHZvaWQsIHBhc3N3b3JkOiBzdHJpbmcpOiB2b2lkO1xuICAgIG9uU3VibWl0KHVzZXJuYW1lOiB2b2lkLCBwaG9uZUNvdW50cnk6IHN0cmluZywgcGhvbmVOdW1iZXI6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IHZvaWQ7XG4gICAgb25Vc2VybmFtZUNoYW5nZWQ/KHVzZXJuYW1lOiBzdHJpbmcpOiB2b2lkO1xuICAgIG9uVXNlcm5hbWVCbHVyPyh1c2VybmFtZTogc3RyaW5nKTogdm9pZDtcbiAgICBvblBob25lQ291bnRyeUNoYW5nZWQ/KHBob25lQ291bnRyeTogc3RyaW5nKTogdm9pZDtcbiAgICBvblBob25lTnVtYmVyQ2hhbmdlZD8ocGhvbmVOdW1iZXI6IHN0cmluZyk6IHZvaWQ7XG4gICAgb25Gb3Jnb3RQYXNzd29yZENsaWNrPygpOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBmaWVsZFZhbGlkOiBQYXJ0aWFsPFJlY29yZDxMb2dpbkZpZWxkLCBib29sZWFuPj47XG4gICAgbG9naW5UeXBlOiBMb2dpbkZpZWxkLkVtYWlsIHwgTG9naW5GaWVsZC5NYXRyaXhJZCB8IExvZ2luRmllbGQuUGhvbmU7XG4gICAgcGFzc3dvcmQ6IFwiXCI7XG59XG5cbmVudW0gTG9naW5GaWVsZCB7XG4gICAgRW1haWwgPSBcImxvZ2luX2ZpZWxkX2VtYWlsXCIsXG4gICAgTWF0cml4SWQgPSBcImxvZ2luX2ZpZWxkX214aWRcIixcbiAgICBQaG9uZSA9IFwibG9naW5fZmllbGRfcGhvbmVcIixcbiAgICBQYXNzd29yZCA9IFwibG9naW5fZmllbGRfcGhvbmVcIixcbn1cblxuLypcbiAqIEEgcHVyZSBVSSBjb21wb25lbnQgd2hpY2ggZGlzcGxheXMgYSB1c2VybmFtZS9wYXNzd29yZCBmb3JtLlxuICogVGhlIGVtYWlsL3VzZXJuYW1lL3Bob25lIGZpZWxkcyBhcmUgZnVsbHktY29udHJvbGxlZCwgdGhlIHBhc3N3b3JkIGZpZWxkIGlzIG5vdC5cbiAqL1xuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuYXV0aC5QYXNzd29yZExvZ2luXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYXNzd29yZExvZ2luIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgICAgIG9uVXNlcm5hbWVDaGFuZ2VkOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICBvblVzZXJuYW1lQmx1cjogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgb25QaG9uZUNvdW50cnlDaGFuZ2VkOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICBvblBob25lTnVtYmVyQ2hhbmdlZDogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgbG9naW5JbmNvcnJlY3Q6IGZhbHNlLFxuICAgICAgICBkaXNhYmxlU3VibWl0OiBmYWxzZSxcbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgLy8gRmllbGQgZXJyb3IgY29kZXMgYnkgZmllbGQgSURcbiAgICAgICAgICAgIGZpZWxkVmFsaWQ6IHt9LFxuICAgICAgICAgICAgbG9naW5UeXBlOiBMb2dpbkZpZWxkLk1hdHJpeElkLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IFwiXCIsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkZvcmdvdFBhc3N3b3JkQ2xpY2sgPSBldiA9PiB7XG4gICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnByb3BzLm9uRm9yZ290UGFzc3dvcmRDbGljaygpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU3VibWl0Rm9ybSA9IGFzeW5jIGV2ID0+IHtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBjb25zdCBhbGxGaWVsZHNWYWxpZCA9IGF3YWl0IHRoaXMudmVyaWZ5RmllbGRzQmVmb3JlU3VibWl0KCk7XG4gICAgICAgIGlmICghYWxsRmllbGRzVmFsaWQpIHtcbiAgICAgICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX3JlZ2lzdHJhdGlvbl9zdWJtaXRfZmFpbGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHVzZXJuYW1lID0gJyc7IC8vIFhYWDogU3luYXBzZSBicmVha3MgaWYgeW91IHNlbmQgbnVsbCBoZXJlOlxuICAgICAgICBsZXQgcGhvbmVDb3VudHJ5ID0gbnVsbDtcbiAgICAgICAgbGV0IHBob25lTnVtYmVyID0gbnVsbDtcblxuICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUubG9naW5UeXBlKSB7XG4gICAgICAgICAgICBjYXNlIExvZ2luRmllbGQuRW1haWw6XG4gICAgICAgICAgICBjYXNlIExvZ2luRmllbGQuTWF0cml4SWQ6XG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgPSB0aGlzLnByb3BzLnVzZXJuYW1lO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBMb2dpbkZpZWxkLlBob25lOlxuICAgICAgICAgICAgICAgIHBob25lQ291bnRyeSA9IHRoaXMucHJvcHMucGhvbmVDb3VudHJ5O1xuICAgICAgICAgICAgICAgIHBob25lTnVtYmVyID0gdGhpcy5wcm9wcy5waG9uZU51bWJlcjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucHJvcHMub25TdWJtaXQodXNlcm5hbWUsIHBob25lQ291bnRyeSwgcGhvbmVOdW1iZXIsIHRoaXMuc3RhdGUucGFzc3dvcmQpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uVXNlcm5hbWVDaGFuZ2VkID0gZXYgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLm9uVXNlcm5hbWVDaGFuZ2VkKGV2LnRhcmdldC52YWx1ZSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Vc2VybmFtZUZvY3VzID0gKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5sb2dpblR5cGUgPT09IExvZ2luRmllbGQuTWF0cml4SWQpIHtcbiAgICAgICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX2xvZ2luX214aWRfZm9jdXNcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnRyYWNrKFwib25ib2FyZGluZ19sb2dpbl9lbWFpbF9mb2N1c1wiKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uVXNlcm5hbWVCbHVyID0gZXYgPT4ge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5sb2dpblR5cGUgPT09IExvZ2luRmllbGQuTWF0cml4SWQpIHtcbiAgICAgICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX2xvZ2luX214aWRfYmx1clwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX2xvZ2luX2VtYWlsX2JsdXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcm9wcy5vblVzZXJuYW1lQmx1cihldi50YXJnZXQudmFsdWUpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uTG9naW5UeXBlQ2hhbmdlID0gZXYgPT4ge1xuICAgICAgICBjb25zdCBsb2dpblR5cGUgPSBldi50YXJnZXQudmFsdWU7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsb2dpblR5cGUgfSk7XG4gICAgICAgIHRoaXMucHJvcHMub25Vc2VybmFtZUNoYW5nZWQoXCJcIik7IC8vIFJlc2V0IGJlY2F1c2UgZW1haWwgYW5kIHVzZXJuYW1lIHVzZSB0aGUgc2FtZSBzdGF0ZVxuICAgICAgICBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnRyYWNrKFwib25ib2FyZGluZ19sb2dpbl90eXBlX2NoYW5nZWRcIiwgeyBsb2dpblR5cGUgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25QaG9uZUNvdW50cnlDaGFuZ2VkID0gY291bnRyeSA9PiB7XG4gICAgICAgIHRoaXMucHJvcHMub25QaG9uZUNvdW50cnlDaGFuZ2VkKGNvdW50cnkuaXNvMik7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25QaG9uZU51bWJlckNoYW5nZWQgPSBldiA9PiB7XG4gICAgICAgIHRoaXMucHJvcHMub25QaG9uZU51bWJlckNoYW5nZWQoZXYudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBob25lTnVtYmVyRm9jdXMgPSAoKSA9PiB7XG4gICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX2xvZ2luX3Bob25lX251bWJlcl9mb2N1c1wiKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBob25lTnVtYmVyQmx1ciA9IGV2ID0+IHtcbiAgICAgICAgQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFjayhcIm9uYm9hcmRpbmdfbG9naW5fcGhvbmVfbnVtYmVyX2JsdXJcIik7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25QYXNzd29yZENoYW5nZWQgPSBldiA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBwYXNzd29yZDogZXYudGFyZ2V0LnZhbHVlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGFzeW5jIHZlcmlmeUZpZWxkc0JlZm9yZVN1Ym1pdCgpIHtcbiAgICAgICAgLy8gQmx1ciB0aGUgYWN0aXZlIGVsZW1lbnQgaWYgYW55LCBzbyB3ZSBmaXJzdCBydW4gaXRzIGJsdXIgdmFsaWRhdGlvbixcbiAgICAgICAgLy8gd2hpY2ggaXMgbGVzcyBzdHJpY3QgdGhhbiB0aGUgcGFzcyB3ZSdyZSBhYm91dCB0byBkbyBiZWxvdyBmb3IgYWxsIGZpZWxkcy5cbiAgICAgICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIGlmIChhY3RpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICBhY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZpZWxkSURzSW5EaXNwbGF5T3JkZXIgPSBbXG4gICAgICAgICAgICB0aGlzLnN0YXRlLmxvZ2luVHlwZSxcbiAgICAgICAgICAgIExvZ2luRmllbGQuUGFzc3dvcmQsXG4gICAgICAgIF07XG5cbiAgICAgICAgLy8gUnVuIGFsbCBmaWVsZHMgd2l0aCBzdHJpY3RlciB2YWxpZGF0aW9uIHRoYXQgbm8gbG9uZ2VyIGFsbG93cyBlbXB0eVxuICAgICAgICAvLyB2YWx1ZXMgZm9yIHJlcXVpcmVkIGZpZWxkcy5cbiAgICAgICAgZm9yIChjb25zdCBmaWVsZElEIG9mIGZpZWxkSURzSW5EaXNwbGF5T3JkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gdGhpc1tmaWVsZElEXTtcbiAgICAgICAgICAgIGlmICghZmllbGQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFdlIG11c3Qgd2FpdCBmb3IgdGhlc2UgdmFsaWRhdGlvbnMgdG8gZmluaXNoIGJlZm9yZSBxdWV1ZWluZ1xuICAgICAgICAgICAgLy8gdXAgdGhlIHNldFN0YXRlIGJlbG93IHNvIG91ciBzZXRTdGF0ZSBnb2VzIGluIHRoZSBxdWV1ZSBhZnRlclxuICAgICAgICAgICAgLy8gYWxsIHRoZSBzZXRTdGF0ZXMgZnJvbSB0aGVzZSB2YWxpZGF0ZSBjYWxscyAodGhhdCdzIGhvdyB3ZVxuICAgICAgICAgICAgLy8ga25vdyB0aGV5J3ZlIGZpbmlzaGVkKS5cbiAgICAgICAgICAgIGF3YWl0IGZpZWxkLnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogZmFsc2UgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0aW9uIGFuZCBzdGF0ZSB1cGRhdGVzIGFyZSBhc3luYywgc28gd2UgbmVlZCB0byB3YWl0IGZvciB0aGVtIHRvIGNvbXBsZXRlXG4gICAgICAgIC8vIGZpcnN0LiBRdWV1ZSBhIGBzZXRTdGF0ZWAgY2FsbGJhY2sgYW5kIHdhaXQgZm9yIGl0IHRvIHJlc29sdmUuXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KHJlc29sdmUgPT4gdGhpcy5zZXRTdGF0ZSh7fSwgcmVzb2x2ZSkpO1xuXG4gICAgICAgIGlmICh0aGlzLmFsbEZpZWxkc1ZhbGlkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaW52YWxpZEZpZWxkID0gdGhpcy5maW5kRmlyc3RJbnZhbGlkRmllbGQoZmllbGRJRHNJbkRpc3BsYXlPcmRlcik7XG5cbiAgICAgICAgaWYgKCFpbnZhbGlkRmllbGQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRm9jdXMgdGhlIGZpcnN0IGludmFsaWQgZmllbGQgYW5kIHNob3cgZmVlZGJhY2sgaW4gdGhlIHN0cmljdGVyIG1vZGVcbiAgICAgICAgLy8gdGhhdCBubyBsb25nZXIgYWxsb3dzIGVtcHR5IHZhbHVlcyBmb3IgcmVxdWlyZWQgZmllbGRzLlxuICAgICAgICBpbnZhbGlkRmllbGQuZm9jdXMoKTtcbiAgICAgICAgaW52YWxpZEZpZWxkLnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogZmFsc2UsIGZvY3VzZWQ6IHRydWUgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFsbEZpZWxkc1ZhbGlkKCkge1xuICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5zdGF0ZS5maWVsZFZhbGlkKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUuZmllbGRWYWxpZFtrZXlzW2ldXSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbmRGaXJzdEludmFsaWRGaWVsZChmaWVsZElEczogTG9naW5GaWVsZFtdKSB7XG4gICAgICAgIGZvciAoY29uc3QgZmllbGRJRCBvZiBmaWVsZElEcykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmZpZWxkVmFsaWRbZmllbGRJRF0gJiYgdGhpc1tmaWVsZElEXSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2ZpZWxkSURdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWFya0ZpZWxkVmFsaWQoZmllbGRJRDogTG9naW5GaWVsZCwgdmFsaWQ6IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgeyBmaWVsZFZhbGlkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBmaWVsZFZhbGlkW2ZpZWxkSURdID0gdmFsaWQ7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZmllbGRWYWxpZCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB2YWxpZGF0ZVVzZXJuYW1lUnVsZXMgPSB3aXRoVmFsaWRhdGlvbih7XG4gICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAga2V5OiBcInJlcXVpcmVkXCIsXG4gICAgICAgICAgICAgICAgdGVzdCh7IHZhbHVlLCBhbGxvd0VtcHR5IH0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbG93RW1wdHkgfHwgISF2YWx1ZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGludmFsaWQ6ICgpID0+IF90KFwiRW50ZXIgdXNlcm5hbWVcIiksXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0pO1xuXG4gICAgcHJpdmF0ZSBvblVzZXJuYW1lVmFsaWRhdGUgPSBhc3luYyAoZmllbGRTdGF0ZSkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlVXNlcm5hbWVSdWxlcyhmaWVsZFN0YXRlKTtcbiAgICAgICAgdGhpcy5tYXJrRmllbGRWYWxpZChMb2dpbkZpZWxkLk1hdHJpeElkLCByZXN1bHQudmFsaWQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uRW1haWxWYWxpZGF0ZSA9IChyZXN1bHQ6IElWYWxpZGF0aW9uUmVzdWx0KSA9PiB7XG4gICAgICAgIHRoaXMubWFya0ZpZWxkVmFsaWQoTG9naW5GaWVsZC5FbWFpbCwgcmVzdWx0LnZhbGlkKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSB2YWxpZGF0ZVBob25lTnVtYmVyUnVsZXMgPSB3aXRoVmFsaWRhdGlvbih7XG4gICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAga2V5OiBcInJlcXVpcmVkXCIsXG4gICAgICAgICAgICAgICAgdGVzdCh7IHZhbHVlLCBhbGxvd0VtcHR5IH0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbG93RW1wdHkgfHwgISF2YWx1ZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGludmFsaWQ6ICgpID0+IF90KFwiRW50ZXIgcGhvbmUgbnVtYmVyXCIpLFxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGtleTogXCJudW1iZXJcIixcbiAgICAgICAgICAgICAgICB0ZXN0OiAoeyB2YWx1ZSB9KSA9PiAhdmFsdWUgfHwgUEhPTkVfTlVNQkVSX1JFR0VYLnRlc3QodmFsdWUpLFxuICAgICAgICAgICAgICAgIGludmFsaWQ6ICgpID0+IF90KFwiVGhhdCBwaG9uZSBudW1iZXIgZG9lc24ndCBsb29rIHF1aXRlIHJpZ2h0LCBwbGVhc2UgY2hlY2sgYW5kIHRyeSBhZ2FpblwiKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBwcml2YXRlIG9uUGhvbmVOdW1iZXJWYWxpZGF0ZSA9IGFzeW5jIChmaWVsZFN0YXRlKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudmFsaWRhdGVQaG9uZU51bWJlclJ1bGVzKGZpZWxkU3RhdGUpO1xuICAgICAgICB0aGlzLm1hcmtGaWVsZFZhbGlkKExvZ2luRmllbGQuUGFzc3dvcmQsIHJlc3VsdC52YWxpZCk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIHByaXZhdGUgdmFsaWRhdGVQYXNzd29yZFJ1bGVzID0gd2l0aFZhbGlkYXRpb24oe1xuICAgICAgICBydWxlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogXCJyZXF1aXJlZFwiLFxuICAgICAgICAgICAgICAgIHRlc3QoeyB2YWx1ZSwgYWxsb3dFbXB0eSB9KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGxvd0VtcHR5IHx8ICEhdmFsdWU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkOiAoKSA9PiBfdChcIkVudGVyIHBhc3N3b3JkXCIpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICB9KTtcblxuICAgIHByaXZhdGUgb25QYXNzd29yZFZhbGlkYXRlID0gYXN5bmMgKGZpZWxkU3RhdGUpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy52YWxpZGF0ZVBhc3N3b3JkUnVsZXMoZmllbGRTdGF0ZSk7XG4gICAgICAgIHRoaXMubWFya0ZpZWxkVmFsaWQoTG9naW5GaWVsZC5QYXNzd29yZCwgcmVzdWx0LnZhbGlkKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZW5kZXJMb2dpbkZpZWxkKGxvZ2luVHlwZTogSVN0YXRlW1wibG9naW5UeXBlXCJdLCBhdXRvRm9jdXM6IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgY2xhc3NlcyA9IHtcbiAgICAgICAgICAgIGVycm9yOiBmYWxzZSxcbiAgICAgICAgfTtcblxuICAgICAgICBzd2l0Y2ggKGxvZ2luVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBMb2dpbkZpZWxkLkVtYWlsOlxuICAgICAgICAgICAgICAgIGNsYXNzZXMuZXJyb3IgPSB0aGlzLnByb3BzLmxvZ2luSW5jb3JyZWN0ICYmICF0aGlzLnByb3BzLnVzZXJuYW1lO1xuICAgICAgICAgICAgICAgIHJldHVybiA8RW1haWxGaWVsZFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoY2xhc3Nlcyl9XG4gICAgICAgICAgICAgICAgICAgIG5hbWU9XCJ1c2VybmFtZVwiIC8vIG1ha2UgaXQgYSBsaXR0bGUgZWFzaWVyIGZvciBicm93c2VyJ3MgcmVtZW1iZXItcGFzc3dvcmRcbiAgICAgICAgICAgICAgICAgICAgYXV0b0NvbXBsZXRlPVwiZW1haWxcIlxuICAgICAgICAgICAgICAgICAgICB0eXBlPVwiZW1haWxcIlxuICAgICAgICAgICAgICAgICAgICBrZXk9XCJlbWFpbF9pbnB1dFwiXG4gICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiam9lQGV4YW1wbGUuY29tXCJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMucHJvcHMudXNlcm5hbWV9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uVXNlcm5hbWVDaGFuZ2VkfVxuICAgICAgICAgICAgICAgICAgICBvbkZvY3VzPXt0aGlzLm9uVXNlcm5hbWVGb2N1c31cbiAgICAgICAgICAgICAgICAgICAgb25CbHVyPXt0aGlzLm9uVXNlcm5hbWVCbHVyfVxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17dGhpcy5wcm9wcy5kaXNhYmxlU3VibWl0fVxuICAgICAgICAgICAgICAgICAgICBhdXRvRm9jdXM9e2F1dG9Gb2N1c31cbiAgICAgICAgICAgICAgICAgICAgb25WYWxpZGF0ZT17dGhpcy5vbkVtYWlsVmFsaWRhdGV9XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkUmVmPXtmaWVsZCA9PiB0aGlzW0xvZ2luRmllbGQuRW1haWxdID0gZmllbGR9XG4gICAgICAgICAgICAgICAgLz47XG4gICAgICAgICAgICBjYXNlIExvZ2luRmllbGQuTWF0cml4SWQ6XG4gICAgICAgICAgICAgICAgY2xhc3Nlcy5lcnJvciA9IHRoaXMucHJvcHMubG9naW5JbmNvcnJlY3QgJiYgIXRoaXMucHJvcHMudXNlcm5hbWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDxGaWVsZFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoY2xhc3Nlcyl9XG4gICAgICAgICAgICAgICAgICAgIG5hbWU9XCJ1c2VybmFtZVwiIC8vIG1ha2UgaXQgYSBsaXR0bGUgZWFzaWVyIGZvciBicm93c2VyJ3MgcmVtZW1iZXItcGFzc3dvcmRcbiAgICAgICAgICAgICAgICAgICAgYXV0b0NvbXBsZXRlPVwidXNlcm5hbWVcIlxuICAgICAgICAgICAgICAgICAgICBrZXk9XCJ1c2VybmFtZV9pbnB1dFwiXG4gICAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiVXNlcm5hbWVcIil9XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtfdChcIlVzZXJuYW1lXCIpLnRvTG9jYWxlTG93ZXJDYXNlKCl9XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnByb3BzLnVzZXJuYW1lfVxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vblVzZXJuYW1lQ2hhbmdlZH1cbiAgICAgICAgICAgICAgICAgICAgb25Gb2N1cz17dGhpcy5vblVzZXJuYW1lRm9jdXN9XG4gICAgICAgICAgICAgICAgICAgIG9uQmx1cj17dGhpcy5vblVzZXJuYW1lQmx1cn1cbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMucHJvcHMuZGlzYWJsZVN1Ym1pdH1cbiAgICAgICAgICAgICAgICAgICAgYXV0b0ZvY3VzPXthdXRvRm9jdXN9XG4gICAgICAgICAgICAgICAgICAgIG9uVmFsaWRhdGU9e3RoaXMub25Vc2VybmFtZVZhbGlkYXRlfVxuICAgICAgICAgICAgICAgICAgICByZWY9e2ZpZWxkID0+IHRoaXNbTG9naW5GaWVsZC5NYXRyaXhJZF0gPSBmaWVsZH1cbiAgICAgICAgICAgICAgICAvPjtcbiAgICAgICAgICAgIGNhc2UgTG9naW5GaWVsZC5QaG9uZToge1xuICAgICAgICAgICAgICAgIGNsYXNzZXMuZXJyb3IgPSB0aGlzLnByb3BzLmxvZ2luSW5jb3JyZWN0ICYmICF0aGlzLnByb3BzLnBob25lTnVtYmVyO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgcGhvbmVDb3VudHJ5ID0gPENvdW50cnlEcm9wZG93blxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5wcm9wcy5waG9uZUNvdW50cnl9XG4gICAgICAgICAgICAgICAgICAgIGlzU21hbGw9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgIHNob3dQcmVmaXg9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgIG9uT3B0aW9uQ2hhbmdlPXt0aGlzLm9uUGhvbmVDb3VudHJ5Q2hhbmdlZH1cbiAgICAgICAgICAgICAgICAvPjtcblxuICAgICAgICAgICAgICAgIHJldHVybiA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKGNsYXNzZXMpfVxuICAgICAgICAgICAgICAgICAgICBuYW1lPVwicGhvbmVOdW1iZXJcIlxuICAgICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJ0ZWwtbmF0aW9uYWxcIlxuICAgICAgICAgICAgICAgICAgICBrZXk9XCJwaG9uZV9pbnB1dFwiXG4gICAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiUGhvbmVcIil9XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnByb3BzLnBob25lTnVtYmVyfVxuICAgICAgICAgICAgICAgICAgICBwcmVmaXhDb21wb25lbnQ9e3Bob25lQ291bnRyeX1cbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25QaG9uZU51bWJlckNoYW5nZWR9XG4gICAgICAgICAgICAgICAgICAgIG9uRm9jdXM9e3RoaXMub25QaG9uZU51bWJlckZvY3VzfVxuICAgICAgICAgICAgICAgICAgICBvbkJsdXI9e3RoaXMub25QaG9uZU51bWJlckJsdXJ9XG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnByb3BzLmRpc2FibGVTdWJtaXR9XG4gICAgICAgICAgICAgICAgICAgIGF1dG9Gb2N1cz17YXV0b0ZvY3VzfVxuICAgICAgICAgICAgICAgICAgICBvblZhbGlkYXRlPXt0aGlzLm9uUGhvbmVOdW1iZXJWYWxpZGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgcmVmPXtmaWVsZCA9PiB0aGlzW0xvZ2luRmllbGQuUGFzc3dvcmRdID0gZmllbGR9XG4gICAgICAgICAgICAgICAgLz47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzTG9naW5FbXB0eSgpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlLmxvZ2luVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBMb2dpbkZpZWxkLkVtYWlsOlxuICAgICAgICAgICAgY2FzZSBMb2dpbkZpZWxkLk1hdHJpeElkOlxuICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5wcm9wcy51c2VybmFtZTtcbiAgICAgICAgICAgIGNhc2UgTG9naW5GaWVsZC5QaG9uZTpcbiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMucHJvcHMucGhvbmVDb3VudHJ5IHx8ICF0aGlzLnByb3BzLnBob25lTnVtYmVyO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBsZXQgZm9yZ290UGFzc3dvcmRKc3g7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25Gb3Jnb3RQYXNzd29yZENsaWNrKSB7XG4gICAgICAgICAgICBmb3Jnb3RQYXNzd29yZEpzeCA9IDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfTG9naW5fZm9yZ290XCJcbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17dGhpcy5wcm9wcy5idXN5fVxuICAgICAgICAgICAgICAgIGtpbmQ9XCJsaW5rXCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uRm9yZ290UGFzc3dvcmRDbGlja31cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7IF90KFwiRm9yZ290IHBhc3N3b3JkP1wiKSB9XG4gICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcHdGaWVsZENsYXNzID0gY2xhc3NOYW1lcyh7XG4gICAgICAgICAgICBlcnJvcjogdGhpcy5wcm9wcy5sb2dpbkluY29ycmVjdCAmJiAhdGhpcy5pc0xvZ2luRW1wdHkoKSwgLy8gb25seSBlcnJvciBwYXNzd29yZCBpZiBlcnJvciBpc24ndCB0b3AgZmllbGRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSWYgbG9naW4gaXMgZW1wdHksIGF1dG9Gb2N1cyBsb2dpbiwgb3RoZXJ3aXNlIGF1dG9Gb2N1cyBwYXNzd29yZC5cbiAgICAgICAgLy8gdGhpcyBpcyBmb3Igd2hlbiBhdXRvIHNlcnZlciBkaXNjb3ZlcnkgcmVtb3VudHMgdXMgd2hlbiB0aGUgdXNlciB0cmllcyB0byB0YWIgZnJvbSB1c2VybmFtZSB0byBwYXNzd29yZFxuICAgICAgICBjb25zdCBhdXRvRm9jdXNQYXNzd29yZCA9ICF0aGlzLmlzTG9naW5FbXB0eSgpO1xuICAgICAgICBjb25zdCBsb2dpbkZpZWxkID0gdGhpcy5yZW5kZXJMb2dpbkZpZWxkKHRoaXMuc3RhdGUubG9naW5UeXBlLCAhYXV0b0ZvY3VzUGFzc3dvcmQpO1xuXG4gICAgICAgIGxldCBsb2dpblR5cGU7XG4gICAgICAgIGlmICghU2RrQ29uZmlnLmdldCgpLmRpc2FibGVfM3BpZF9sb2dpbikge1xuICAgICAgICAgICAgbG9naW5UeXBlID0gKFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTG9naW5fdHlwZV9jb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT1cIm14X0xvZ2luX3R5cGVfbGFiZWxcIj57IF90KCdTaWduIGluIHdpdGgnKSB9PC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50PVwic2VsZWN0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmxvZ2luVHlwZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uTG9naW5UeXBlQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMucHJvcHMuZGlzYWJsZVN1Ym1pdH1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiBrZXk9e0xvZ2luRmllbGQuTWF0cml4SWR9IHZhbHVlPXtMb2dpbkZpZWxkLk1hdHJpeElkfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KCdVc2VybmFtZScpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvb3B0aW9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT17TG9naW5GaWVsZC5FbWFpbH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17TG9naW5GaWVsZC5FbWFpbH1cbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KCdFbWFpbCBhZGRyZXNzJykgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9vcHRpb24+XG4gICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIGtleT17TG9naW5GaWVsZC5QYXNzd29yZH0gdmFsdWU9e0xvZ2luRmllbGQuUGFzc3dvcmR9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoJ1Bob25lJykgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9vcHRpb24+XG4gICAgICAgICAgICAgICAgICAgIDwvRmllbGQ+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPGZvcm0gb25TdWJtaXQ9e3RoaXMub25TdWJtaXRGb3JtfT5cbiAgICAgICAgICAgICAgICAgICAgeyBsb2dpblR5cGUgfVxuICAgICAgICAgICAgICAgICAgICB7IGxvZ2luRmllbGQgfVxuICAgICAgICAgICAgICAgICAgICA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17cHdGaWVsZENsYXNzfVxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b0NvbXBsZXRlPVwicGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoJ1Bhc3N3b3JkJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5wYXNzd29yZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uUGFzc3dvcmRDaGFuZ2VkfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMucHJvcHMuZGlzYWJsZVN1Ym1pdH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Gb2N1cz17YXV0b0ZvY3VzUGFzc3dvcmR9XG4gICAgICAgICAgICAgICAgICAgICAgICBvblZhbGlkYXRlPXt0aGlzLm9uUGFzc3dvcmRWYWxpZGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZj17ZmllbGQgPT4gdGhpc1tMb2dpbkZpZWxkLlBhc3N3b3JkXSA9IGZpZWxkfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICB7IGZvcmdvdFBhc3N3b3JkSnN4IH1cbiAgICAgICAgICAgICAgICAgICAgeyAhdGhpcy5wcm9wcy5idXN5ICYmIDxpbnB1dCBjbGFzc05hbWU9XCJteF9Mb2dpbl9zdWJtaXRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInN1Ym1pdFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17X3QoJ1NpZ24gaW4nKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnByb3BzLmRpc2FibGVTdWJtaXR9XG4gICAgICAgICAgICAgICAgICAgIC8+IH1cbiAgICAgICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=