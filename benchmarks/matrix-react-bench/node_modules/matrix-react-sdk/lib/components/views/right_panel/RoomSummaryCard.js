"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useWidgets = exports.onRoomMembersClick = exports.onRoomFilesClick = exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _useIsEncrypted = require("../../../hooks/useIsEncrypted");

var _BaseCard = _interopRequireWildcard(require("./BaseCard"));

var _languageHandler = require("../../../languageHandler");

var _RoomAvatar = _interopRequireDefault(require("../avatars/RoomAvatar"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _actions = require("../../../dispatcher/actions");

var _RightPanelStorePhases = require("../../../stores/RightPanelStorePhases");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _ShareDialog = _interopRequireDefault(require("../dialogs/ShareDialog"));

var _useEventEmitter = require("../../../hooks/useEventEmitter");

var _WidgetUtils = _interopRequireDefault(require("../../../utils/WidgetUtils"));

var _IntegrationManagers = require("../../../integrations/IntegrationManagers");

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _TextWithTooltip = _interopRequireDefault(require("../elements/TextWithTooltip"));

var _WidgetAvatar = _interopRequireDefault(require("../avatars/WidgetAvatar"));

var _AccessibleTooltipButton = _interopRequireDefault(require("../elements/AccessibleTooltipButton"));

var _WidgetStore = _interopRequireDefault(require("../../../stores/WidgetStore"));

var _ShieldUtils = require("../../../utils/ShieldUtils");

var _RoomContext = _interopRequireDefault(require("../../../contexts/RoomContext"));

var _UIFeature = require("../../../settings/UIFeature");

var _ContextMenu = require("../../structures/ContextMenu");

var _WidgetContextMenu = _interopRequireDefault(require("../context_menus/WidgetContextMenu"));

var _useRoomMembers = require("../../../hooks/useRoomMembers");

var _WidgetLayoutStore = require("../../../stores/widgets/WidgetLayoutStore");

var _RoomName = _interopRequireDefault(require("../elements/RoomName"));

var _UIStore = _interopRequireDefault(require("../../../stores/UIStore"));

var _ExportDialog = _interopRequireDefault(require("../dialogs/ExportDialog"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const Button = ({
  children,
  className,
  onClick
}) => {
  return /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    className: (0, _classnames.default)("mx_BaseCard_Button mx_RoomSummaryCard_Button", className),
    onClick: onClick
  }, children);
};

const useWidgets = room => {
  const [apps, setApps] = (0, _react.useState)(_WidgetStore.default.instance.getApps(room.roomId));
  const updateApps = (0, _react.useCallback)(() => {
    // Copy the array so that we always trigger a re-render, as some updates mutate the array of apps/settings
    setApps([..._WidgetStore.default.instance.getApps(room.roomId)]);
  }, [room]);
  (0, _react.useEffect)(updateApps, [room, updateApps]);
  (0, _useEventEmitter.useEventEmitter)(_WidgetStore.default.instance, room.roomId, updateApps);
  (0, _useEventEmitter.useEventEmitter)(_WidgetLayoutStore.WidgetLayoutStore.instance, _WidgetLayoutStore.WidgetLayoutStore.emissionForRoom(room), updateApps);
  return apps;
};

exports.useWidgets = useWidgets;

const AppRow = ({
  app,
  room
}) => {
  const name = _WidgetUtils.default.getWidgetName(app);

  const dataTitle = _WidgetUtils.default.getWidgetDataTitle(app);

  const subtitle = dataTitle && " - " + dataTitle;

  const onOpenWidgetClick = () => {
    _dispatcher.default.dispatch({
      action: _actions.Action.SetRightPanelPhase,
      phase: _RightPanelStorePhases.RightPanelPhases.Widget,
      refireParams: {
        widgetId: app.id
      }
    });
  };

  const isPinned = _WidgetLayoutStore.WidgetLayoutStore.instance.isInContainer(room, app, _WidgetLayoutStore.Container.Top);

  const togglePin = isPinned ? () => {
    _WidgetLayoutStore.WidgetLayoutStore.instance.moveToContainer(room, app, _WidgetLayoutStore.Container.Right);
  } : () => {
    _WidgetLayoutStore.WidgetLayoutStore.instance.moveToContainer(room, app, _WidgetLayoutStore.Container.Top);
  };
  const [menuDisplayed, handle, openMenu, closeMenu] = (0, _ContextMenu.useContextMenu)();
  let contextMenu;

  if (menuDisplayed) {
    const rect = handle.current.getBoundingClientRect();
    contextMenu = /*#__PURE__*/_react.default.createElement(_WidgetContextMenu.default, {
      chevronFace: _ContextMenu.ChevronFace.None,
      right: _UIStore.default.instance.windowWidth - rect.right,
      bottom: _UIStore.default.instance.windowHeight - rect.top,
      onFinished: closeMenu,
      app: app
    });
  }

  const cannotPin = !isPinned && !_WidgetLayoutStore.WidgetLayoutStore.instance.canAddToContainer(room, _WidgetLayoutStore.Container.Top);
  let pinTitle;

  if (cannotPin) {
    pinTitle = (0, _languageHandler._t)("You can only pin up to %(count)s widgets", {
      count: _WidgetLayoutStore.MAX_PINNED
    });
  } else {
    pinTitle = isPinned ? (0, _languageHandler._t)("Unpin") : (0, _languageHandler._t)("Pin");
  }

  const classes = (0, _classnames.default)("mx_BaseCard_Button mx_RoomSummaryCard_Button", {
    mx_RoomSummaryCard_Button_pinned: isPinned
  });

  const isMaximised = _WidgetLayoutStore.WidgetLayoutStore.instance.isInContainer(room, app, _WidgetLayoutStore.Container.Center);

  const toggleMaximised = isMaximised ? () => {
    _WidgetLayoutStore.WidgetLayoutStore.instance.moveToContainer(room, app, _WidgetLayoutStore.Container.Right);
  } : () => {
    _WidgetLayoutStore.WidgetLayoutStore.instance.moveToContainer(room, app, _WidgetLayoutStore.Container.Center);
  };
  const maximiseTitle = isMaximised ? (0, _languageHandler._t)("Close") : (0, _languageHandler._t)("Maximise widget");
  let openTitle = "";

  if (isPinned) {
    openTitle = (0, _languageHandler._t)("Unpin this widget to view it in this panel");
  } else if (isMaximised) {
    openTitle = (0, _languageHandler._t)("Close this widget to view it in this panel");
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: classes,
    ref: handle
  }, /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
    className: "mx_RoomSummaryCard_icon_app",
    onClick: onOpenWidgetClick // only show a tooltip if the widget is pinned
    ,
    title: openTitle,
    forceHide: !(isPinned || isMaximised),
    disabled: isPinned || isMaximised,
    yOffset: -48
  }, /*#__PURE__*/_react.default.createElement(_WidgetAvatar.default, {
    app: app
  }), /*#__PURE__*/_react.default.createElement("span", null, name), subtitle), /*#__PURE__*/_react.default.createElement(_ContextMenu.ContextMenuTooltipButton, {
    className: (0, _classnames.default)({
      "mx_RoomSummaryCard_app_options": true,
      "mx_RoomSummaryCard_maximised_widget": _SettingsStore.default.getValue("feature_maximised_widgets")
    }),
    isExpanded: menuDisplayed,
    onClick: openMenu,
    title: (0, _languageHandler._t)("Options"),
    yOffset: -24
  }), /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
    className: "mx_RoomSummaryCard_app_pinToggle",
    onClick: togglePin,
    title: pinTitle,
    disabled: cannotPin,
    yOffset: -24
  }), _SettingsStore.default.getValue("feature_maximised_widgets") && /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
    className: isMaximised ? "mx_RoomSummaryCard_app_minimise" : "mx_RoomSummaryCard_app_maximise",
    onClick: toggleMaximised,
    title: maximiseTitle,
    yOffset: -24
  }), contextMenu);
};

const AppsSection = ({
  room
}) => {
  const apps = useWidgets(room);

  const onManageIntegrations = () => {
    const managers = _IntegrationManagers.IntegrationManagers.sharedInstance();

    if (!managers.hasManager()) {
      managers.openNoManagerDialog();
    } else {
      if (_SettingsStore.default.getValue("feature_many_integration_managers")) {
        managers.openAll(room);
      } else {
        managers.getPrimaryManager().open(room);
      }
    }
  };

  let copyLayoutBtn = null;

  if (apps.length > 0 && _WidgetLayoutStore.WidgetLayoutStore.instance.canCopyLayoutToRoom(room)) {
    copyLayoutBtn = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "link",
      onClick: () => _WidgetLayoutStore.WidgetLayoutStore.instance.copyLayoutToRoom(room)
    }, (0, _languageHandler._t)("Set my room layout for everyone"));
  }

  return /*#__PURE__*/_react.default.createElement(_BaseCard.Group, {
    className: "mx_RoomSummaryCard_appsGroup",
    title: (0, _languageHandler._t)("Widgets")
  }, apps.map(app => /*#__PURE__*/_react.default.createElement(AppRow, {
    key: app.id,
    app: app,
    room: room
  })), copyLayoutBtn, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    kind: "link",
    onClick: onManageIntegrations
  }, apps.length > 0 ? (0, _languageHandler._t)("Edit widgets, bridges & bots") : (0, _languageHandler._t)("Add widgets, bridges & bots")));
};

const onRoomMembersClick = (allowClose = true) => {
  _dispatcher.default.dispatch({
    action: _actions.Action.SetRightPanelPhase,
    phase: _RightPanelStorePhases.RightPanelPhases.RoomMemberList,
    allowClose
  });
};

exports.onRoomMembersClick = onRoomMembersClick;

const onRoomFilesClick = (allowClose = true) => {
  _dispatcher.default.dispatch({
    action: _actions.Action.SetRightPanelPhase,
    phase: _RightPanelStorePhases.RightPanelPhases.FilePanel,
    allowClose
  });
};

exports.onRoomFilesClick = onRoomFilesClick;

const onRoomSettingsClick = () => {
  _dispatcher.default.dispatch({
    action: "open_room_settings"
  });
};

const RoomSummaryCard = ({
  room,
  onClose
}) => {
  const cli = (0, _react.useContext)(_MatrixClientContext.default);

  const onShareRoomClick = () => {
    _Modal.default.createTrackedDialog('share room dialog', '', _ShareDialog.default, {
      target: room
    });
  };

  const onRoomExportClick = async () => {
    _Modal.default.createTrackedDialog('export room dialog', '', _ExportDialog.default, {
      room
    });
  };

  const isRoomEncrypted = (0, _useIsEncrypted.useIsEncrypted)(cli, room);
  const roomContext = (0, _react.useContext)(_RoomContext.default);
  const e2eStatus = roomContext.e2eStatus;
  const alias = room.getCanonicalAlias() || room.getAltAliases()[0] || "";

  const header = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_RoomSummaryCard_avatar",
    role: "presentation"
  }, /*#__PURE__*/_react.default.createElement(_RoomAvatar.default, {
    room: room,
    height: 54,
    width: 54,
    viewAvatarOnClick: true
  }), /*#__PURE__*/_react.default.createElement(_TextWithTooltip.default, {
    tooltip: isRoomEncrypted ? (0, _languageHandler._t)("Encrypted") : (0, _languageHandler._t)("Not encrypted"),
    class: (0, _classnames.default)("mx_RoomSummaryCard_e2ee", {
      mx_RoomSummaryCard_e2ee_normal: isRoomEncrypted,
      mx_RoomSummaryCard_e2ee_warning: isRoomEncrypted && e2eStatus === _ShieldUtils.E2EStatus.Warning,
      mx_RoomSummaryCard_e2ee_verified: isRoomEncrypted && e2eStatus === _ShieldUtils.E2EStatus.Verified
    })
  })), /*#__PURE__*/_react.default.createElement(_RoomName.default, {
    room: room
  }, name => /*#__PURE__*/_react.default.createElement("h2", {
    title: name
  }, name)), /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_RoomSummaryCard_alias",
    title: alias
  }, alias));

  const memberCount = (0, _useRoomMembers.useRoomMemberCount)(room);
  return /*#__PURE__*/_react.default.createElement(_BaseCard.default, {
    header: header,
    className: "mx_RoomSummaryCard",
    onClose: onClose
  }, /*#__PURE__*/_react.default.createElement(_BaseCard.Group, {
    title: (0, _languageHandler._t)("About"),
    className: "mx_RoomSummaryCard_aboutGroup"
  }, /*#__PURE__*/_react.default.createElement(Button, {
    className: "mx_RoomSummaryCard_icon_people",
    onClick: onRoomMembersClick
  }, (0, _languageHandler._t)("People"), /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_BaseCard_Button_sublabel"
  }, memberCount)), /*#__PURE__*/_react.default.createElement(Button, {
    className: "mx_RoomSummaryCard_icon_files",
    onClick: onRoomFilesClick
  }, (0, _languageHandler._t)("Files")), /*#__PURE__*/_react.default.createElement(Button, {
    className: "mx_RoomSummaryCard_icon_export",
    onClick: onRoomExportClick
  }, (0, _languageHandler._t)("Export chat")), /*#__PURE__*/_react.default.createElement(Button, {
    className: "mx_RoomSummaryCard_icon_share",
    onClick: onShareRoomClick
  }, (0, _languageHandler._t)("Share room")), /*#__PURE__*/_react.default.createElement(Button, {
    className: "mx_RoomSummaryCard_icon_settings",
    onClick: onRoomSettingsClick
  }, (0, _languageHandler._t)("Room settings"))), _SettingsStore.default.getValue(_UIFeature.UIFeature.Widgets) && /*#__PURE__*/_react.default.createElement(AppsSection, {
    room: room
  }));
};

var _default = RoomSummaryCard;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3JpZ2h0X3BhbmVsL1Jvb21TdW1tYXJ5Q2FyZC50c3giXSwibmFtZXMiOlsiQnV0dG9uIiwiY2hpbGRyZW4iLCJjbGFzc05hbWUiLCJvbkNsaWNrIiwidXNlV2lkZ2V0cyIsInJvb20iLCJhcHBzIiwic2V0QXBwcyIsIldpZGdldFN0b3JlIiwiaW5zdGFuY2UiLCJnZXRBcHBzIiwicm9vbUlkIiwidXBkYXRlQXBwcyIsIldpZGdldExheW91dFN0b3JlIiwiZW1pc3Npb25Gb3JSb29tIiwiQXBwUm93IiwiYXBwIiwibmFtZSIsIldpZGdldFV0aWxzIiwiZ2V0V2lkZ2V0TmFtZSIsImRhdGFUaXRsZSIsImdldFdpZGdldERhdGFUaXRsZSIsInN1YnRpdGxlIiwib25PcGVuV2lkZ2V0Q2xpY2siLCJkZWZhdWx0RGlzcGF0Y2hlciIsImRpc3BhdGNoIiwiYWN0aW9uIiwiQWN0aW9uIiwiU2V0UmlnaHRQYW5lbFBoYXNlIiwicGhhc2UiLCJSaWdodFBhbmVsUGhhc2VzIiwiV2lkZ2V0IiwicmVmaXJlUGFyYW1zIiwid2lkZ2V0SWQiLCJpZCIsImlzUGlubmVkIiwiaXNJbkNvbnRhaW5lciIsIkNvbnRhaW5lciIsIlRvcCIsInRvZ2dsZVBpbiIsIm1vdmVUb0NvbnRhaW5lciIsIlJpZ2h0IiwibWVudURpc3BsYXllZCIsImhhbmRsZSIsIm9wZW5NZW51IiwiY2xvc2VNZW51IiwiY29udGV4dE1lbnUiLCJyZWN0IiwiY3VycmVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsIkNoZXZyb25GYWNlIiwiTm9uZSIsIlVJU3RvcmUiLCJ3aW5kb3dXaWR0aCIsInJpZ2h0Iiwid2luZG93SGVpZ2h0IiwidG9wIiwiY2Fubm90UGluIiwiY2FuQWRkVG9Db250YWluZXIiLCJwaW5UaXRsZSIsImNvdW50IiwiTUFYX1BJTk5FRCIsImNsYXNzZXMiLCJteF9Sb29tU3VtbWFyeUNhcmRfQnV0dG9uX3Bpbm5lZCIsImlzTWF4aW1pc2VkIiwiQ2VudGVyIiwidG9nZ2xlTWF4aW1pc2VkIiwibWF4aW1pc2VUaXRsZSIsIm9wZW5UaXRsZSIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsIkFwcHNTZWN0aW9uIiwib25NYW5hZ2VJbnRlZ3JhdGlvbnMiLCJtYW5hZ2VycyIsIkludGVncmF0aW9uTWFuYWdlcnMiLCJzaGFyZWRJbnN0YW5jZSIsImhhc01hbmFnZXIiLCJvcGVuTm9NYW5hZ2VyRGlhbG9nIiwib3BlbkFsbCIsImdldFByaW1hcnlNYW5hZ2VyIiwib3BlbiIsImNvcHlMYXlvdXRCdG4iLCJsZW5ndGgiLCJjYW5Db3B5TGF5b3V0VG9Sb29tIiwiY29weUxheW91dFRvUm9vbSIsIm1hcCIsIm9uUm9vbU1lbWJlcnNDbGljayIsImFsbG93Q2xvc2UiLCJSb29tTWVtYmVyTGlzdCIsIm9uUm9vbUZpbGVzQ2xpY2siLCJGaWxlUGFuZWwiLCJvblJvb21TZXR0aW5nc0NsaWNrIiwiUm9vbVN1bW1hcnlDYXJkIiwib25DbG9zZSIsImNsaSIsIk1hdHJpeENsaWVudENvbnRleHQiLCJvblNoYXJlUm9vbUNsaWNrIiwiTW9kYWwiLCJjcmVhdGVUcmFja2VkRGlhbG9nIiwiU2hhcmVEaWFsb2ciLCJ0YXJnZXQiLCJvblJvb21FeHBvcnRDbGljayIsIkV4cG9ydERpYWxvZyIsImlzUm9vbUVuY3J5cHRlZCIsInJvb21Db250ZXh0IiwiUm9vbUNvbnRleHQiLCJlMmVTdGF0dXMiLCJhbGlhcyIsImdldENhbm9uaWNhbEFsaWFzIiwiZ2V0QWx0QWxpYXNlcyIsImhlYWRlciIsIm14X1Jvb21TdW1tYXJ5Q2FyZF9lMmVlX25vcm1hbCIsIm14X1Jvb21TdW1tYXJ5Q2FyZF9lMmVlX3dhcm5pbmciLCJFMkVTdGF0dXMiLCJXYXJuaW5nIiwibXhfUm9vbVN1bW1hcnlDYXJkX2UyZWVfdmVyaWZpZWQiLCJWZXJpZmllZCIsIm1lbWJlckNvdW50IiwiVUlGZWF0dXJlIiwiV2lkZ2V0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBZ0JB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QUFDLFdBQUQ7QUFBYSxJQUFBLElBQUksRUFBRWxIO0FBQW5CLElBdEI1QyxDQUFQO0FBd0JILENBdkVEOztlQXlFZXVGLGUiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNvbnRleHQgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5cbmltcG9ydCBNYXRyaXhDbGllbnRDb250ZXh0IGZyb20gXCIuLi8uLi8uLi9jb250ZXh0cy9NYXRyaXhDbGllbnRDb250ZXh0XCI7XG5pbXBvcnQgeyB1c2VJc0VuY3J5cHRlZCB9IGZyb20gJy4uLy4uLy4uL2hvb2tzL3VzZUlzRW5jcnlwdGVkJztcbmltcG9ydCBCYXNlQ2FyZCwgeyBHcm91cCB9IGZyb20gXCIuL0Jhc2VDYXJkXCI7XG5pbXBvcnQgeyBfdCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgUm9vbUF2YXRhciBmcm9tIFwiLi4vYXZhdGFycy9Sb29tQXZhdGFyXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IGRlZmF1bHREaXNwYXRjaGVyIGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCB7IFJpZ2h0UGFuZWxQaGFzZXMgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL1JpZ2h0UGFuZWxTdG9yZVBoYXNlc1wiO1xuaW1wb3J0IHsgU2V0UmlnaHRQYW5lbFBoYXNlUGF5bG9hZCB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL3BheWxvYWRzL1NldFJpZ2h0UGFuZWxQaGFzZVBheWxvYWRcIjtcbmltcG9ydCBNb2RhbCBmcm9tIFwiLi4vLi4vLi4vTW9kYWxcIjtcbmltcG9ydCBTaGFyZURpYWxvZyBmcm9tICcuLi9kaWFsb2dzL1NoYXJlRGlhbG9nJztcbmltcG9ydCB7IHVzZUV2ZW50RW1pdHRlciB9IGZyb20gXCIuLi8uLi8uLi9ob29rcy91c2VFdmVudEVtaXR0ZXJcIjtcbmltcG9ydCBXaWRnZXRVdGlscyBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvV2lkZ2V0VXRpbHNcIjtcbmltcG9ydCB7IEludGVncmF0aW9uTWFuYWdlcnMgfSBmcm9tIFwiLi4vLi4vLi4vaW50ZWdyYXRpb25zL0ludGVncmF0aW9uTWFuYWdlcnNcIjtcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgVGV4dFdpdGhUb29sdGlwIGZyb20gXCIuLi9lbGVtZW50cy9UZXh0V2l0aFRvb2x0aXBcIjtcbmltcG9ydCBXaWRnZXRBdmF0YXIgZnJvbSBcIi4uL2F2YXRhcnMvV2lkZ2V0QXZhdGFyXCI7XG5pbXBvcnQgQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVUb29sdGlwQnV0dG9uXCI7XG5pbXBvcnQgV2lkZ2V0U3RvcmUsIHsgSUFwcCB9IGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvV2lkZ2V0U3RvcmVcIjtcbmltcG9ydCB7IEUyRVN0YXR1cyB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9TaGllbGRVdGlsc1wiO1xuaW1wb3J0IFJvb21Db250ZXh0IGZyb20gXCIuLi8uLi8uLi9jb250ZXh0cy9Sb29tQ29udGV4dFwiO1xuaW1wb3J0IHsgVUlGZWF0dXJlIH0gZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL1VJRmVhdHVyZVwiO1xuaW1wb3J0IHsgQ2hldnJvbkZhY2UsIENvbnRleHRNZW51VG9vbHRpcEJ1dHRvbiwgdXNlQ29udGV4dE1lbnUgfSBmcm9tIFwiLi4vLi4vc3RydWN0dXJlcy9Db250ZXh0TWVudVwiO1xuaW1wb3J0IFdpZGdldENvbnRleHRNZW51IGZyb20gXCIuLi9jb250ZXh0X21lbnVzL1dpZGdldENvbnRleHRNZW51XCI7XG5pbXBvcnQgeyB1c2VSb29tTWVtYmVyQ291bnQgfSBmcm9tIFwiLi4vLi4vLi4vaG9va3MvdXNlUm9vbU1lbWJlcnNcIjtcbmltcG9ydCB7IENvbnRhaW5lciwgTUFYX1BJTk5FRCwgV2lkZ2V0TGF5b3V0U3RvcmUgfSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL3dpZGdldHMvV2lkZ2V0TGF5b3V0U3RvcmVcIjtcbmltcG9ydCBSb29tTmFtZSBmcm9tIFwiLi4vZWxlbWVudHMvUm9vbU5hbWVcIjtcbmltcG9ydCBVSVN0b3JlIGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvVUlTdG9yZVwiO1xuaW1wb3J0IEV4cG9ydERpYWxvZyBmcm9tIFwiLi4vZGlhbG9ncy9FeHBvcnREaWFsb2dcIjtcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgcm9vbTogUm9vbTtcbiAgICBvbkNsb3NlKCk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBJQXBwc1NlY3Rpb25Qcm9wcyB7XG4gICAgcm9vbTogUm9vbTtcbn1cblxuaW50ZXJmYWNlIElCdXR0b25Qcm9wcyB7XG4gICAgY2xhc3NOYW1lOiBzdHJpbmc7XG4gICAgb25DbGljaygpOiB2b2lkO1xufVxuXG5jb25zdCBCdXR0b246IFJlYWN0LkZDPElCdXR0b25Qcm9wcz4gPSAoeyBjaGlsZHJlbiwgY2xhc3NOYW1lLCBvbkNsaWNrIH0pID0+IHtcbiAgICByZXR1cm4gPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfQmFzZUNhcmRfQnV0dG9uIG14X1Jvb21TdW1tYXJ5Q2FyZF9CdXR0b25cIiwgY2xhc3NOYW1lKX1cbiAgICAgICAgb25DbGljaz17b25DbGlja31cbiAgICA+XG4gICAgICAgIHsgY2hpbGRyZW4gfVxuICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj47XG59O1xuXG5leHBvcnQgY29uc3QgdXNlV2lkZ2V0cyA9IChyb29tOiBSb29tKSA9PiB7XG4gICAgY29uc3QgW2FwcHMsIHNldEFwcHNdID0gdXNlU3RhdGU8SUFwcFtdPihXaWRnZXRTdG9yZS5pbnN0YW5jZS5nZXRBcHBzKHJvb20ucm9vbUlkKSk7XG5cbiAgICBjb25zdCB1cGRhdGVBcHBzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICAvLyBDb3B5IHRoZSBhcnJheSBzbyB0aGF0IHdlIGFsd2F5cyB0cmlnZ2VyIGEgcmUtcmVuZGVyLCBhcyBzb21lIHVwZGF0ZXMgbXV0YXRlIHRoZSBhcnJheSBvZiBhcHBzL3NldHRpbmdzXG4gICAgICAgIHNldEFwcHMoWy4uLldpZGdldFN0b3JlLmluc3RhbmNlLmdldEFwcHMocm9vbS5yb29tSWQpXSk7XG4gICAgfSwgW3Jvb21dKTtcblxuICAgIHVzZUVmZmVjdCh1cGRhdGVBcHBzLCBbcm9vbSwgdXBkYXRlQXBwc10pO1xuICAgIHVzZUV2ZW50RW1pdHRlcihXaWRnZXRTdG9yZS5pbnN0YW5jZSwgcm9vbS5yb29tSWQsIHVwZGF0ZUFwcHMpO1xuICAgIHVzZUV2ZW50RW1pdHRlcihXaWRnZXRMYXlvdXRTdG9yZS5pbnN0YW5jZSwgV2lkZ2V0TGF5b3V0U3RvcmUuZW1pc3Npb25Gb3JSb29tKHJvb20pLCB1cGRhdGVBcHBzKTtcblxuICAgIHJldHVybiBhcHBzO1xufTtcblxuaW50ZXJmYWNlIElBcHBSb3dQcm9wcyB7XG4gICAgYXBwOiBJQXBwO1xuICAgIHJvb206IFJvb207XG59XG5cbmNvbnN0IEFwcFJvdzogUmVhY3QuRkM8SUFwcFJvd1Byb3BzPiA9ICh7IGFwcCwgcm9vbSB9KSA9PiB7XG4gICAgY29uc3QgbmFtZSA9IFdpZGdldFV0aWxzLmdldFdpZGdldE5hbWUoYXBwKTtcbiAgICBjb25zdCBkYXRhVGl0bGUgPSBXaWRnZXRVdGlscy5nZXRXaWRnZXREYXRhVGl0bGUoYXBwKTtcbiAgICBjb25zdCBzdWJ0aXRsZSA9IGRhdGFUaXRsZSAmJiBcIiAtIFwiICsgZGF0YVRpdGxlO1xuXG4gICAgY29uc3Qgb25PcGVuV2lkZ2V0Q2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIGRlZmF1bHREaXNwYXRjaGVyLmRpc3BhdGNoPFNldFJpZ2h0UGFuZWxQaGFzZVBheWxvYWQ+KHtcbiAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlNldFJpZ2h0UGFuZWxQaGFzZSxcbiAgICAgICAgICAgIHBoYXNlOiBSaWdodFBhbmVsUGhhc2VzLldpZGdldCxcbiAgICAgICAgICAgIHJlZmlyZVBhcmFtczoge1xuICAgICAgICAgICAgICAgIHdpZGdldElkOiBhcHAuaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgY29uc3QgaXNQaW5uZWQgPSBXaWRnZXRMYXlvdXRTdG9yZS5pbnN0YW5jZS5pc0luQ29udGFpbmVyKHJvb20sIGFwcCwgQ29udGFpbmVyLlRvcCk7XG4gICAgY29uc3QgdG9nZ2xlUGluID0gaXNQaW5uZWRcbiAgICAgICAgPyAoKSA9PiB7IFdpZGdldExheW91dFN0b3JlLmluc3RhbmNlLm1vdmVUb0NvbnRhaW5lcihyb29tLCBhcHAsIENvbnRhaW5lci5SaWdodCk7IH1cbiAgICAgICAgOiAoKSA9PiB7IFdpZGdldExheW91dFN0b3JlLmluc3RhbmNlLm1vdmVUb0NvbnRhaW5lcihyb29tLCBhcHAsIENvbnRhaW5lci5Ub3ApOyB9O1xuXG4gICAgY29uc3QgW21lbnVEaXNwbGF5ZWQsIGhhbmRsZSwgb3Blbk1lbnUsIGNsb3NlTWVudV0gPSB1c2VDb250ZXh0TWVudTxIVE1MRGl2RWxlbWVudD4oKTtcbiAgICBsZXQgY29udGV4dE1lbnU7XG4gICAgaWYgKG1lbnVEaXNwbGF5ZWQpIHtcbiAgICAgICAgY29uc3QgcmVjdCA9IGhhbmRsZS5jdXJyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb250ZXh0TWVudSA9IDxXaWRnZXRDb250ZXh0TWVudVxuICAgICAgICAgICAgY2hldnJvbkZhY2U9e0NoZXZyb25GYWNlLk5vbmV9XG4gICAgICAgICAgICByaWdodD17VUlTdG9yZS5pbnN0YW5jZS53aW5kb3dXaWR0aCAtIHJlY3QucmlnaHR9XG4gICAgICAgICAgICBib3R0b209e1VJU3RvcmUuaW5zdGFuY2Uud2luZG93SGVpZ2h0IC0gcmVjdC50b3B9XG4gICAgICAgICAgICBvbkZpbmlzaGVkPXtjbG9zZU1lbnV9XG4gICAgICAgICAgICBhcHA9e2FwcH1cbiAgICAgICAgLz47XG4gICAgfVxuXG4gICAgY29uc3QgY2Fubm90UGluID0gIWlzUGlubmVkICYmICFXaWRnZXRMYXlvdXRTdG9yZS5pbnN0YW5jZS5jYW5BZGRUb0NvbnRhaW5lcihyb29tLCBDb250YWluZXIuVG9wKTtcblxuICAgIGxldCBwaW5UaXRsZTogc3RyaW5nO1xuICAgIGlmIChjYW5ub3RQaW4pIHtcbiAgICAgICAgcGluVGl0bGUgPSBfdChcIllvdSBjYW4gb25seSBwaW4gdXAgdG8gJShjb3VudClzIHdpZGdldHNcIiwgeyBjb3VudDogTUFYX1BJTk5FRCB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBwaW5UaXRsZSA9IGlzUGlubmVkID8gX3QoXCJVbnBpblwiKSA6IF90KFwiUGluXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjbGFzc05hbWVzKFwibXhfQmFzZUNhcmRfQnV0dG9uIG14X1Jvb21TdW1tYXJ5Q2FyZF9CdXR0b25cIiwge1xuICAgICAgICBteF9Sb29tU3VtbWFyeUNhcmRfQnV0dG9uX3Bpbm5lZDogaXNQaW5uZWQsXG4gICAgfSk7XG5cbiAgICBjb25zdCBpc01heGltaXNlZCA9IFdpZGdldExheW91dFN0b3JlLmluc3RhbmNlLmlzSW5Db250YWluZXIocm9vbSwgYXBwLCBDb250YWluZXIuQ2VudGVyKTtcbiAgICBjb25zdCB0b2dnbGVNYXhpbWlzZWQgPSBpc01heGltaXNlZFxuICAgICAgICA/ICgpID0+IHsgV2lkZ2V0TGF5b3V0U3RvcmUuaW5zdGFuY2UubW92ZVRvQ29udGFpbmVyKHJvb20sIGFwcCwgQ29udGFpbmVyLlJpZ2h0KTsgfVxuICAgICAgICA6ICgpID0+IHsgV2lkZ2V0TGF5b3V0U3RvcmUuaW5zdGFuY2UubW92ZVRvQ29udGFpbmVyKHJvb20sIGFwcCwgQ29udGFpbmVyLkNlbnRlcik7IH07XG5cbiAgICBjb25zdCBtYXhpbWlzZVRpdGxlID0gaXNNYXhpbWlzZWQgPyBfdChcIkNsb3NlXCIpIDogX3QoXCJNYXhpbWlzZSB3aWRnZXRcIik7XG5cbiAgICBsZXQgb3BlblRpdGxlID0gXCJcIjtcbiAgICBpZiAoaXNQaW5uZWQpIHtcbiAgICAgICAgb3BlblRpdGxlID0gX3QoXCJVbnBpbiB0aGlzIHdpZGdldCB0byB2aWV3IGl0IGluIHRoaXMgcGFuZWxcIik7XG4gICAgfSBlbHNlIGlmIChpc01heGltaXNlZCkge1xuICAgICAgICBvcGVuVGl0bGUgPV90KFwiQ2xvc2UgdGhpcyB3aWRnZXQgdG8gdmlldyBpdCBpbiB0aGlzIHBhbmVsXCIpO1xuICAgIH1cblxuICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlc30gcmVmPXtoYW5kbGV9PlxuICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1Jvb21TdW1tYXJ5Q2FyZF9pY29uX2FwcFwiXG4gICAgICAgICAgICBvbkNsaWNrPXtvbk9wZW5XaWRnZXRDbGlja31cbiAgICAgICAgICAgIC8vIG9ubHkgc2hvdyBhIHRvb2x0aXAgaWYgdGhlIHdpZGdldCBpcyBwaW5uZWRcbiAgICAgICAgICAgIHRpdGxlPXtvcGVuVGl0bGV9XG4gICAgICAgICAgICBmb3JjZUhpZGU9eyEoaXNQaW5uZWQgfHwgaXNNYXhpbWlzZWQpfVxuICAgICAgICAgICAgZGlzYWJsZWQ9e2lzUGlubmVkIHx8IGlzTWF4aW1pc2VkfVxuICAgICAgICAgICAgeU9mZnNldD17LTQ4fVxuICAgICAgICA+XG4gICAgICAgICAgICA8V2lkZ2V0QXZhdGFyIGFwcD17YXBwfSAvPlxuICAgICAgICAgICAgPHNwYW4+eyBuYW1lIH08L3NwYW4+XG4gICAgICAgICAgICB7IHN1YnRpdGxlIH1cbiAgICAgICAgPC9BY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvbj5cblxuICAgICAgICA8Q29udGV4dE1lbnVUb29sdGlwQnV0dG9uXG4gICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoe1xuICAgICAgICAgICAgICAgIFwibXhfUm9vbVN1bW1hcnlDYXJkX2FwcF9vcHRpb25zXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgXCJteF9Sb29tU3VtbWFyeUNhcmRfbWF4aW1pc2VkX3dpZGdldFwiOiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFwiZmVhdHVyZV9tYXhpbWlzZWRfd2lkZ2V0c1wiKSxcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgaXNFeHBhbmRlZD17bWVudURpc3BsYXllZH1cbiAgICAgICAgICAgIG9uQ2xpY2s9e29wZW5NZW51fVxuICAgICAgICAgICAgdGl0bGU9e190KFwiT3B0aW9uc1wiKX1cbiAgICAgICAgICAgIHlPZmZzZXQ9ey0yNH1cbiAgICAgICAgLz5cblxuICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1Jvb21TdW1tYXJ5Q2FyZF9hcHBfcGluVG9nZ2xlXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e3RvZ2dsZVBpbn1cbiAgICAgICAgICAgIHRpdGxlPXtwaW5UaXRsZX1cbiAgICAgICAgICAgIGRpc2FibGVkPXtjYW5ub3RQaW59XG4gICAgICAgICAgICB5T2Zmc2V0PXstMjR9XG4gICAgICAgIC8+XG4gICAgICAgIHsgU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcImZlYXR1cmVfbWF4aW1pc2VkX3dpZGdldHNcIikgJiZcbiAgICAgICAgPEFjY2Vzc2libGVUb29sdGlwQnV0dG9uXG4gICAgICAgICAgICBjbGFzc05hbWU9e2lzTWF4aW1pc2VkID8gXCJteF9Sb29tU3VtbWFyeUNhcmRfYXBwX21pbmltaXNlXCIgOiBcIm14X1Jvb21TdW1tYXJ5Q2FyZF9hcHBfbWF4aW1pc2VcIn1cbiAgICAgICAgICAgIG9uQ2xpY2s9e3RvZ2dsZU1heGltaXNlZH1cbiAgICAgICAgICAgIHRpdGxlPXttYXhpbWlzZVRpdGxlfVxuICAgICAgICAgICAgeU9mZnNldD17LTI0fVxuICAgICAgICAvPiB9XG5cbiAgICAgICAgeyBjb250ZXh0TWVudSB9XG4gICAgPC9kaXY+O1xufTtcblxuY29uc3QgQXBwc1NlY3Rpb246IFJlYWN0LkZDPElBcHBzU2VjdGlvblByb3BzPiA9ICh7IHJvb20gfSkgPT4ge1xuICAgIGNvbnN0IGFwcHMgPSB1c2VXaWRnZXRzKHJvb20pO1xuXG4gICAgY29uc3Qgb25NYW5hZ2VJbnRlZ3JhdGlvbnMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hbmFnZXJzID0gSW50ZWdyYXRpb25NYW5hZ2Vycy5zaGFyZWRJbnN0YW5jZSgpO1xuICAgICAgICBpZiAoIW1hbmFnZXJzLmhhc01hbmFnZXIoKSkge1xuICAgICAgICAgICAgbWFuYWdlcnMub3Blbk5vTWFuYWdlckRpYWxvZygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJmZWF0dXJlX21hbnlfaW50ZWdyYXRpb25fbWFuYWdlcnNcIikpIHtcbiAgICAgICAgICAgICAgICBtYW5hZ2Vycy5vcGVuQWxsKHJvb20pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtYW5hZ2Vycy5nZXRQcmltYXJ5TWFuYWdlcigpLm9wZW4ocm9vbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgbGV0IGNvcHlMYXlvdXRCdG4gPSBudWxsO1xuICAgIGlmIChhcHBzLmxlbmd0aCA+IDAgJiYgV2lkZ2V0TGF5b3V0U3RvcmUuaW5zdGFuY2UuY2FuQ29weUxheW91dFRvUm9vbShyb29tKSkge1xuICAgICAgICBjb3B5TGF5b3V0QnRuID0gKFxuICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24ga2luZD1cImxpbmtcIiBvbkNsaWNrPXsoKSA9PiBXaWRnZXRMYXlvdXRTdG9yZS5pbnN0YW5jZS5jb3B5TGF5b3V0VG9Sb29tKHJvb20pfT5cbiAgICAgICAgICAgICAgICB7IF90KFwiU2V0IG15IHJvb20gbGF5b3V0IGZvciBldmVyeW9uZVwiKSB9XG4gICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIDxHcm91cCBjbGFzc05hbWU9XCJteF9Sb29tU3VtbWFyeUNhcmRfYXBwc0dyb3VwXCIgdGl0bGU9e190KFwiV2lkZ2V0c1wiKX0+XG4gICAgICAgIHsgYXBwcy5tYXAoYXBwID0+IDxBcHBSb3cga2V5PXthcHAuaWR9IGFwcD17YXBwfSByb29tPXtyb29tfSAvPikgfVxuICAgICAgICB7IGNvcHlMYXlvdXRCdG4gfVxuICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBraW5kPVwibGlua1wiIG9uQ2xpY2s9e29uTWFuYWdlSW50ZWdyYXRpb25zfT5cbiAgICAgICAgICAgIHsgYXBwcy5sZW5ndGggPiAwID8gX3QoXCJFZGl0IHdpZGdldHMsIGJyaWRnZXMgJiBib3RzXCIpIDogX3QoXCJBZGQgd2lkZ2V0cywgYnJpZGdlcyAmIGJvdHNcIikgfVxuICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgPC9Hcm91cD47XG59O1xuXG5leHBvcnQgY29uc3Qgb25Sb29tTWVtYmVyc0NsaWNrID0gKGFsbG93Q2xvc2UgPSB0cnVlKSA9PiB7XG4gICAgZGVmYXVsdERpc3BhdGNoZXIuZGlzcGF0Y2g8U2V0UmlnaHRQYW5lbFBoYXNlUGF5bG9hZD4oe1xuICAgICAgICBhY3Rpb246IEFjdGlvbi5TZXRSaWdodFBhbmVsUGhhc2UsXG4gICAgICAgIHBoYXNlOiBSaWdodFBhbmVsUGhhc2VzLlJvb21NZW1iZXJMaXN0LFxuICAgICAgICBhbGxvd0Nsb3NlLFxuICAgIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IG9uUm9vbUZpbGVzQ2xpY2sgPSAoYWxsb3dDbG9zZSA9IHRydWUpID0+IHtcbiAgICBkZWZhdWx0RGlzcGF0Y2hlci5kaXNwYXRjaDxTZXRSaWdodFBhbmVsUGhhc2VQYXlsb2FkPih7XG4gICAgICAgIGFjdGlvbjogQWN0aW9uLlNldFJpZ2h0UGFuZWxQaGFzZSxcbiAgICAgICAgcGhhc2U6IFJpZ2h0UGFuZWxQaGFzZXMuRmlsZVBhbmVsLFxuICAgICAgICBhbGxvd0Nsb3NlLFxuICAgIH0pO1xufTtcblxuY29uc3Qgb25Sb29tU2V0dGluZ3NDbGljayA9ICgpID0+IHtcbiAgICBkZWZhdWx0RGlzcGF0Y2hlci5kaXNwYXRjaCh7IGFjdGlvbjogXCJvcGVuX3Jvb21fc2V0dGluZ3NcIiB9KTtcbn07XG5cbmNvbnN0IFJvb21TdW1tYXJ5Q2FyZDogUmVhY3QuRkM8SVByb3BzPiA9ICh7IHJvb20sIG9uQ2xvc2UgfSkgPT4ge1xuICAgIGNvbnN0IGNsaSA9IHVzZUNvbnRleHQoTWF0cml4Q2xpZW50Q29udGV4dCk7XG5cbiAgICBjb25zdCBvblNoYXJlUm9vbUNsaWNrID0gKCkgPT4ge1xuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdzaGFyZSByb29tIGRpYWxvZycsICcnLCBTaGFyZURpYWxvZywge1xuICAgICAgICAgICAgdGFyZ2V0OiByb29tLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25Sb29tRXhwb3J0Q2xpY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ2V4cG9ydCByb29tIGRpYWxvZycsICcnLCBFeHBvcnREaWFsb2csIHtcbiAgICAgICAgICAgIHJvb20sXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjb25zdCBpc1Jvb21FbmNyeXB0ZWQgPSB1c2VJc0VuY3J5cHRlZChjbGksIHJvb20pO1xuICAgIGNvbnN0IHJvb21Db250ZXh0ID0gdXNlQ29udGV4dChSb29tQ29udGV4dCk7XG4gICAgY29uc3QgZTJlU3RhdHVzID0gcm9vbUNvbnRleHQuZTJlU3RhdHVzO1xuXG4gICAgY29uc3QgYWxpYXMgPSByb29tLmdldENhbm9uaWNhbEFsaWFzKCkgfHwgcm9vbS5nZXRBbHRBbGlhc2VzKClbMF0gfHwgXCJcIjtcbiAgICBjb25zdCBoZWFkZXIgPSA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUm9vbVN1bW1hcnlDYXJkX2F2YXRhclwiIHJvbGU9XCJwcmVzZW50YXRpb25cIj5cbiAgICAgICAgICAgIDxSb29tQXZhdGFyIHJvb209e3Jvb219IGhlaWdodD17NTR9IHdpZHRoPXs1NH0gdmlld0F2YXRhck9uQ2xpY2sgLz5cbiAgICAgICAgICAgIDxUZXh0V2l0aFRvb2x0aXBcbiAgICAgICAgICAgICAgICB0b29sdGlwPXtpc1Jvb21FbmNyeXB0ZWQgPyBfdChcIkVuY3J5cHRlZFwiKSA6IF90KFwiTm90IGVuY3J5cHRlZFwiKX1cbiAgICAgICAgICAgICAgICBjbGFzcz17Y2xhc3NOYW1lcyhcIm14X1Jvb21TdW1tYXJ5Q2FyZF9lMmVlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgbXhfUm9vbVN1bW1hcnlDYXJkX2UyZWVfbm9ybWFsOiBpc1Jvb21FbmNyeXB0ZWQsXG4gICAgICAgICAgICAgICAgICAgIG14X1Jvb21TdW1tYXJ5Q2FyZF9lMmVlX3dhcm5pbmc6IGlzUm9vbUVuY3J5cHRlZCAmJiBlMmVTdGF0dXMgPT09IEUyRVN0YXR1cy5XYXJuaW5nLFxuICAgICAgICAgICAgICAgICAgICBteF9Sb29tU3VtbWFyeUNhcmRfZTJlZV92ZXJpZmllZDogaXNSb29tRW5jcnlwdGVkICYmIGUyZVN0YXR1cyA9PT0gRTJFU3RhdHVzLlZlcmlmaWVkLFxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPFJvb21OYW1lIHJvb209e3Jvb219PlxuICAgICAgICAgICAgeyBuYW1lID0+IChcbiAgICAgICAgICAgICAgICA8aDIgdGl0bGU9e25hbWV9PlxuICAgICAgICAgICAgICAgICAgICB7IG5hbWUgfVxuICAgICAgICAgICAgICAgIDwvaDI+XG4gICAgICAgICAgICApIH1cbiAgICAgICAgPC9Sb29tTmFtZT5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tU3VtbWFyeUNhcmRfYWxpYXNcIiB0aXRsZT17YWxpYXN9PlxuICAgICAgICAgICAgeyBhbGlhcyB9XG4gICAgICAgIDwvZGl2PlxuICAgIDwvUmVhY3QuRnJhZ21lbnQ+O1xuXG4gICAgY29uc3QgbWVtYmVyQ291bnQgPSB1c2VSb29tTWVtYmVyQ291bnQocm9vbSk7XG5cbiAgICByZXR1cm4gPEJhc2VDYXJkIGhlYWRlcj17aGVhZGVyfSBjbGFzc05hbWU9XCJteF9Sb29tU3VtbWFyeUNhcmRcIiBvbkNsb3NlPXtvbkNsb3NlfT5cbiAgICAgICAgPEdyb3VwIHRpdGxlPXtfdChcIkFib3V0XCIpfSBjbGFzc05hbWU9XCJteF9Sb29tU3VtbWFyeUNhcmRfYWJvdXRHcm91cFwiPlxuICAgICAgICAgICAgPEJ1dHRvbiBjbGFzc05hbWU9XCJteF9Sb29tU3VtbWFyeUNhcmRfaWNvbl9wZW9wbGVcIiBvbkNsaWNrPXtvblJvb21NZW1iZXJzQ2xpY2t9PlxuICAgICAgICAgICAgICAgIHsgX3QoXCJQZW9wbGVcIikgfVxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X0Jhc2VDYXJkX0J1dHRvbl9zdWJsYWJlbFwiPlxuICAgICAgICAgICAgICAgICAgICB7IG1lbWJlckNvdW50IH1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgIDxCdXR0b24gY2xhc3NOYW1lPVwibXhfUm9vbVN1bW1hcnlDYXJkX2ljb25fZmlsZXNcIiBvbkNsaWNrPXtvblJvb21GaWxlc0NsaWNrfT5cbiAgICAgICAgICAgICAgICB7IF90KFwiRmlsZXNcIikgfVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICA8QnV0dG9uIGNsYXNzTmFtZT1cIm14X1Jvb21TdW1tYXJ5Q2FyZF9pY29uX2V4cG9ydFwiIG9uQ2xpY2s9e29uUm9vbUV4cG9ydENsaWNrfT5cbiAgICAgICAgICAgICAgICB7IF90KFwiRXhwb3J0IGNoYXRcIikgfVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICA8QnV0dG9uIGNsYXNzTmFtZT1cIm14X1Jvb21TdW1tYXJ5Q2FyZF9pY29uX3NoYXJlXCIgb25DbGljaz17b25TaGFyZVJvb21DbGlja30+XG4gICAgICAgICAgICAgICAgeyBfdChcIlNoYXJlIHJvb21cIikgfVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICA8QnV0dG9uIGNsYXNzTmFtZT1cIm14X1Jvb21TdW1tYXJ5Q2FyZF9pY29uX3NldHRpbmdzXCIgb25DbGljaz17b25Sb29tU2V0dGluZ3NDbGlja30+XG4gICAgICAgICAgICAgICAgeyBfdChcIlJvb20gc2V0dGluZ3NcIikgfVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvR3JvdXA+XG5cbiAgICAgICAgeyBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKFVJRmVhdHVyZS5XaWRnZXRzKSAmJiA8QXBwc1NlY3Rpb24gcm9vbT17cm9vbX0gLz4gfVxuICAgIDwvQmFzZUNhcmQ+O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgUm9vbVN1bW1hcnlDYXJkO1xuIl19