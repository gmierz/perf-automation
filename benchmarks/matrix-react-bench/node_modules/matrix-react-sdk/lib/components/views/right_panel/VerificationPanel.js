"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _crypto = require("matrix-js-sdk/src/crypto");

var _QRCode = require("matrix-js-sdk/src/crypto/verification/QRCode");

var _VerificationQRCode = _interopRequireDefault(require("../elements/crypto/VerificationQRCode"));

var _languageHandler = require("../../../languageHandler");

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _E2EIcon = _interopRequireWildcard(require("../rooms/E2EIcon"));

var _VerificationRequest = require("matrix-js-sdk/src/crypto/verification/request/VerificationRequest");

var _Spinner = _interopRequireDefault(require("../elements/Spinner"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _VerificationShowSas = _interopRequireDefault(require("../verification/VerificationShowSas"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let VerificationPanel = (_dec = (0, _replaceableComponent.replaceableComponent)("views.right_panel.VerificationPanel"), _dec(_class = class VerificationPanel extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "hasVerifier", void 0);
    (0, _defineProperty2.default)(this, "onReciprocateYesClick", () => {
      this.setState({
        reciprocateButtonClicked: true
      });
      this.state.reciprocateQREvent.confirm();
    });
    (0, _defineProperty2.default)(this, "onReciprocateNoClick", () => {
      this.setState({
        reciprocateButtonClicked: true
      });
      this.state.reciprocateQREvent.cancel();
    });
    (0, _defineProperty2.default)(this, "startSAS", async () => {
      this.setState({
        emojiButtonClicked: true
      });
      const verifier = this.props.request.beginKeyVerification(_crypto.verificationMethods.SAS);

      try {
        await verifier.verify();
      } catch (err) {
        _logger.logger.error(err);
      }
    });
    (0, _defineProperty2.default)(this, "onSasMatchesClick", () => {
      this.state.sasEvent.confirm();
    });
    (0, _defineProperty2.default)(this, "onSasMismatchesClick", () => {
      this.state.sasEvent.mismatch();
    });
    (0, _defineProperty2.default)(this, "updateVerifierState", () => {
      const {
        request
      } = this.props;
      const sasEvent = request.verifier.sasEvent;
      const reciprocateQREvent = request.verifier.reciprocateQREvent;
      request.verifier.off('show_sas', this.updateVerifierState);
      request.verifier.off('show_reciprocate_qr', this.updateVerifierState);
      this.setState({
        sasEvent,
        reciprocateQREvent
      });
    });
    (0, _defineProperty2.default)(this, "onRequestChange", async () => {
      const {
        request
      } = this.props;
      const hadVerifier = this.hasVerifier;
      this.hasVerifier = !!request.verifier;

      if (!hadVerifier && this.hasVerifier) {
        request.verifier.on('show_sas', this.updateVerifierState);
        request.verifier.on('show_reciprocate_qr', this.updateVerifierState);

        try {
          // on the requester side, this is also awaited in startSAS,
          // but that's ok as verify should return the same promise.
          await request.verifier.verify();
        } catch (err) {
          _logger.logger.error("error verify", err);
        }
      }
    });
    this.state = {};
    this.hasVerifier = false;
  }

  renderQRPhase() {
    const {
      member,
      request
    } = this.props;
    const showSAS = request.otherPartySupportsMethod(_crypto.verificationMethods.SAS);
    const showQR = request.otherPartySupportsMethod(_QRCode.SCAN_QR_CODE_METHOD);

    const brand = _SdkConfig.default.get().brand;

    const noCommonMethodError = !showSAS && !showQR ? /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("The session you are trying to verify doesn't support scanning a " + "QR code or emoji verification, which is what %(brand)s supports. Try " + "with a different client.", {
      brand
    })) : null;

    if (this.props.layout === 'dialog') {
      // HACK: This is a terrible idea.
      let qrBlockDialog;
      let sasBlockDialog;

      if (showQR) {
        qrBlockDialog = /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_VerificationPanel_QRPhase_startOption"
        }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Scan this unique code")), /*#__PURE__*/_react.default.createElement(_VerificationQRCode.default, {
          qrCodeData: request.qrCodeData
        }));
      }

      if (showSAS) {
        sasBlockDialog = /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_VerificationPanel_QRPhase_startOption"
        }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Compare unique emoji")), /*#__PURE__*/_react.default.createElement("span", {
          className: "mx_VerificationPanel_QRPhase_helpText"
        }, (0, _languageHandler._t)("Compare a unique set of emoji if you don't have a camera on either device")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
          disabled: this.state.emojiButtonClicked,
          onClick: this.startSAS,
          kind: "primary"
        }, (0, _languageHandler._t)("Start")));
      }

      const or = qrBlockDialog && sasBlockDialog ? /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_VerificationPanel_QRPhase_betweenText"
      }, (0, _languageHandler._t)("or")) : null;
      return /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Verify this session by completing one of the following:"), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_VerificationPanel_QRPhase_startOptions"
      }, qrBlockDialog, or, sasBlockDialog, noCommonMethodError));
    }

    let qrBlock;

    if (showQR) {
      qrBlock = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_UserInfo_container"
      }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Verify by scanning")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Ask %(displayName)s to scan your code:", {
        displayName: member.displayName || member.name || member.userId
      })), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_VerificationPanel_qrCode"
      }, /*#__PURE__*/_react.default.createElement(_VerificationQRCode.default, {
        qrCodeData: request.qrCodeData
      })));
    }

    let sasBlock;

    if (showSAS) {
      const disabled = this.state.emojiButtonClicked;
      const sasLabel = showQR ? (0, _languageHandler._t)("If you can't scan the code above, verify by comparing unique emoji.") : (0, _languageHandler._t)("Verify by comparing unique emoji."); // Note: mx_VerificationPanel_verifyByEmojiButton is for the end-to-end tests

      sasBlock = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_UserInfo_container"
      }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Verify by emoji")), /*#__PURE__*/_react.default.createElement("p", null, sasLabel), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        disabled: disabled,
        kind: "primary",
        className: "mx_UserInfo_wideButton mx_VerificationPanel_verifyByEmojiButton",
        onClick: this.startSAS
      }, (0, _languageHandler._t)("Verify by emoji")));
    }

    const noCommonMethodBlock = noCommonMethodError ? /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_UserInfo_container"
    }, noCommonMethodError) : null; // TODO: add way to open camera to scan a QR code

    return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, qrBlock, sasBlock, noCommonMethodBlock);
  }

  getDevice() {
    const deviceId = this.props.request && this.props.request.channel.deviceId;
    return _MatrixClientPeg.MatrixClientPeg.get().getStoredDevice(_MatrixClientPeg.MatrixClientPeg.get().getUserId(), deviceId);
  }

  renderQRReciprocatePhase() {
    const {
      member,
      request
    } = this.props;
    const description = request.isSelfVerification ? (0, _languageHandler._t)("Almost there! Is your other session showing the same shield?") : (0, _languageHandler._t)("Almost there! Is %(displayName)s showing the same shield?", {
      displayName: member.displayName || member.name || member.userId
    });
    let body;

    if (this.state.reciprocateQREvent) {
      // Element Web doesn't support scanning yet, so assume here we're the client being scanned.
      body = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("p", null, description), /*#__PURE__*/_react.default.createElement(_E2EIcon.default, {
        isUser: true,
        status: _E2EIcon.E2EState.Verified,
        size: 128,
        hideTooltip: true
      }), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_VerificationPanel_reciprocateButtons"
      }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        kind: "danger",
        disabled: this.state.reciprocateButtonClicked,
        onClick: this.onReciprocateNoClick
      }, (0, _languageHandler._t)("No")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        kind: "primary",
        disabled: this.state.reciprocateButtonClicked,
        onClick: this.onReciprocateYesClick
      }, (0, _languageHandler._t)("Yes"))));
    } else {
      body = /*#__PURE__*/_react.default.createElement("p", null, /*#__PURE__*/_react.default.createElement(_Spinner.default, null));
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_UserInfo_container mx_VerificationPanel_reciprocate_section"
    }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Verify by scanning")), body);
  }

  renderVerifiedPhase() {
    const {
      member,
      request
    } = this.props;
    let text;

    if (!request.isSelfVerification) {
      if (this.props.isRoomEncrypted) {
        text = (0, _languageHandler._t)("Verify all users in a room to ensure it's secure.");
      } else {
        text = (0, _languageHandler._t)("In encrypted rooms, verify all users to ensure it's secure.");
      }
    }

    let description;

    if (request.isSelfVerification) {
      const device = this.getDevice();

      if (!device) {
        // This can happen if the device is logged out while we're still showing verification
        // UI for it.
        _logger.logger.warn("Verified device we don't know about: " + this.props.request.channel.deviceId);

        description = (0, _languageHandler._t)("You've successfully verified your device!");
      } else {
        description = (0, _languageHandler._t)("You've successfully verified %(deviceName)s (%(deviceId)s)!", {
          deviceName: device ? device.getDisplayName() : '',
          deviceId: this.props.request.channel.deviceId
        });
      }
    } else {
      description = (0, _languageHandler._t)("You've successfully verified %(displayName)s!", {
        displayName: member.displayName || member.name || member.userId
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_UserInfo_container mx_VerificationPanel_verified_section"
    }, /*#__PURE__*/_react.default.createElement("p", null, description), /*#__PURE__*/_react.default.createElement(_E2EIcon.default, {
      isUser: true,
      status: _E2EIcon.E2EState.Verified,
      size: 128,
      hideTooltip: true
    }), text ? /*#__PURE__*/_react.default.createElement("p", null, text) : null, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "primary",
      className: "mx_UserInfo_wideButton",
      onClick: this.props.onClose
    }, (0, _languageHandler._t)("Got it")));
  }

  renderCancelledPhase() {
    const {
      member,
      request
    } = this.props;
    let startAgainInstruction;

    if (request.isSelfVerification) {
      startAgainInstruction = (0, _languageHandler._t)("Start verification again from the notification.");
    } else {
      startAgainInstruction = (0, _languageHandler._t)("Start verification again from their profile.");
    }

    let text;

    if (request.cancellationCode === "m.timeout") {
      text = (0, _languageHandler._t)("Verification timed out.") + ` ${startAgainInstruction}`;
    } else if (request.cancellingUserId === request.otherUserId) {
      if (request.isSelfVerification) {
        text = (0, _languageHandler._t)("You cancelled verification on your other session.");
      } else {
        text = (0, _languageHandler._t)("%(displayName)s cancelled verification.", {
          displayName: member.displayName || member.name || member.userId
        });
      }

      text = `${text} ${startAgainInstruction}`;
    } else {
      text = (0, _languageHandler._t)("You cancelled verification.") + ` ${startAgainInstruction}`;
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_UserInfo_container"
    }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Verification cancelled")), /*#__PURE__*/_react.default.createElement("p", null, text), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "primary",
      className: "mx_UserInfo_wideButton",
      onClick: this.props.onClose
    }, (0, _languageHandler._t)("Got it")));
  }

  render() {
    const {
      member,
      phase,
      request
    } = this.props;
    const displayName = member.displayName || member.name || member.userId;

    switch (phase) {
      case _VerificationRequest.Phase.Ready:
        return this.renderQRPhase();

      case _VerificationRequest.Phase.Started:
        switch (request.chosenMethod) {
          case _crypto.verificationMethods.RECIPROCATE_QR_CODE:
            return this.renderQRReciprocatePhase();

          case _crypto.verificationMethods.SAS:
            {
              const emojis = this.state.sasEvent ? /*#__PURE__*/_react.default.createElement(_VerificationShowSas.default, {
                displayName: displayName,
                device: this.getDevice(),
                sas: this.state.sasEvent.sas,
                onCancel: this.onSasMismatchesClick,
                onDone: this.onSasMatchesClick,
                inDialog: this.props.inDialog,
                isSelf: request.isSelfVerification
              }) : /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
              return /*#__PURE__*/_react.default.createElement("div", {
                className: "mx_UserInfo_container"
              }, emojis);
            }

          default:
            return null;
        }

      case _VerificationRequest.Phase.Done:
        return this.renderVerifiedPhase();

      case _VerificationRequest.Phase.Cancelled:
        return this.renderCancelledPhase();
    }

    _logger.logger.error("VerificationPanel unhandled phase:", phase);

    return null;
  }

  componentDidMount() {
    const {
      request
    } = this.props;
    request.on("change", this.onRequestChange);

    if (request.verifier) {
      const sasEvent = request.verifier.sasEvent;
      const reciprocateQREvent = request.verifier.reciprocateQREvent;
      this.setState({
        sasEvent,
        reciprocateQREvent
      });
    }

    this.onRequestChange();
  }

  componentWillUnmount() {
    const {
      request
    } = this.props;

    if (request.verifier) {
      request.verifier.off('show_sas', this.updateVerifierState);
      request.verifier.off('show_reciprocate_qr', this.updateVerifierState);
    }

    request.off("change", this.onRequestChange);
  }

}) || _class);
exports.default = VerificationPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3JpZ2h0X3BhbmVsL1ZlcmlmaWNhdGlvblBhbmVsLnRzeCJdLCJuYW1lcyI6WyJWZXJpZmljYXRpb25QYW5lbCIsIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzZXRTdGF0ZSIsInJlY2lwcm9jYXRlQnV0dG9uQ2xpY2tlZCIsInN0YXRlIiwicmVjaXByb2NhdGVRUkV2ZW50IiwiY29uZmlybSIsImNhbmNlbCIsImVtb2ppQnV0dG9uQ2xpY2tlZCIsInZlcmlmaWVyIiwicmVxdWVzdCIsImJlZ2luS2V5VmVyaWZpY2F0aW9uIiwidmVyaWZpY2F0aW9uTWV0aG9kcyIsIlNBUyIsInZlcmlmeSIsImVyciIsImxvZ2dlciIsImVycm9yIiwic2FzRXZlbnQiLCJtaXNtYXRjaCIsIm9mZiIsInVwZGF0ZVZlcmlmaWVyU3RhdGUiLCJoYWRWZXJpZmllciIsImhhc1ZlcmlmaWVyIiwib24iLCJyZW5kZXJRUlBoYXNlIiwibWVtYmVyIiwic2hvd1NBUyIsIm90aGVyUGFydHlTdXBwb3J0c01ldGhvZCIsInNob3dRUiIsIlNDQU5fUVJfQ09ERV9NRVRIT0QiLCJicmFuZCIsIlNka0NvbmZpZyIsImdldCIsIm5vQ29tbW9uTWV0aG9kRXJyb3IiLCJsYXlvdXQiLCJxckJsb2NrRGlhbG9nIiwic2FzQmxvY2tEaWFsb2ciLCJxckNvZGVEYXRhIiwic3RhcnRTQVMiLCJvciIsInFyQmxvY2siLCJkaXNwbGF5TmFtZSIsIm5hbWUiLCJ1c2VySWQiLCJzYXNCbG9jayIsImRpc2FibGVkIiwic2FzTGFiZWwiLCJub0NvbW1vbk1ldGhvZEJsb2NrIiwiZ2V0RGV2aWNlIiwiZGV2aWNlSWQiLCJjaGFubmVsIiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0U3RvcmVkRGV2aWNlIiwiZ2V0VXNlcklkIiwicmVuZGVyUVJSZWNpcHJvY2F0ZVBoYXNlIiwiZGVzY3JpcHRpb24iLCJpc1NlbGZWZXJpZmljYXRpb24iLCJib2R5IiwiRTJFU3RhdGUiLCJWZXJpZmllZCIsIm9uUmVjaXByb2NhdGVOb0NsaWNrIiwib25SZWNpcHJvY2F0ZVllc0NsaWNrIiwicmVuZGVyVmVyaWZpZWRQaGFzZSIsInRleHQiLCJpc1Jvb21FbmNyeXB0ZWQiLCJkZXZpY2UiLCJ3YXJuIiwiZGV2aWNlTmFtZSIsImdldERpc3BsYXlOYW1lIiwib25DbG9zZSIsInJlbmRlckNhbmNlbGxlZFBoYXNlIiwic3RhcnRBZ2Fpbkluc3RydWN0aW9uIiwiY2FuY2VsbGF0aW9uQ29kZSIsImNhbmNlbGxpbmdVc2VySWQiLCJvdGhlclVzZXJJZCIsInJlbmRlciIsInBoYXNlIiwiUGhhc2UiLCJSZWFkeSIsIlN0YXJ0ZWQiLCJjaG9zZW5NZXRob2QiLCJSRUNJUFJPQ0FURV9RUl9DT0RFIiwiZW1vamlzIiwic2FzIiwib25TYXNNaXNtYXRjaGVzQ2xpY2siLCJvblNhc01hdGNoZXNDbGljayIsImluRGlhbG9nIiwiRG9uZSIsIkNhbmNlbGxlZCIsImNvbXBvbmVudERpZE1vdW50Iiwib25SZXF1ZXN0Q2hhbmdlIiwiY29tcG9uZW50V2lsbFVubW91bnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUVBOztBQUNBOztBQUNBOztBQU9BOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7Ozs7OztJQW9CcUJBLGlCLFdBRHBCLGdEQUFxQixxQ0FBckIsQyxnQkFBRCxNQUNxQkEsaUJBRHJCLFNBQytDQyxlQUFNQyxhQURyRCxDQUNtRjtBQUcvRUMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0FBQ3ZCLFVBQU1BLEtBQU47QUFEdUI7QUFBQSxpRUEwR0ssTUFBTTtBQUNsQyxXQUFLQyxRQUFMLENBQWM7QUFBRUMsUUFBQUEsd0JBQXdCLEVBQUU7QUFBNUIsT0FBZDtBQUNBLFdBQUtDLEtBQUwsQ0FBV0Msa0JBQVgsQ0FBOEJDLE9BQTlCO0FBQ0gsS0E3RzBCO0FB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O0FBQ0FYLE1BQUFBLE9BQU8sQ0FBQ0QsUUFBUixDQUFpQlcsR0FBakIsQ0FBcUIscUJBQXJCLEVBQTRDLEtBQUtDLG1CQUFqRDtBQUNIOztBQUNEWCxJQUFBQSxPQUFPLENBQUNVLEdBQVIsQ0FBWSxRQUFaLEVBQXNCLEtBQUt1RSxlQUEzQjtBQUNIOztBQTFWOEUsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOSwgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IHsgdmVyaWZpY2F0aW9uTWV0aG9kcyB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL2NyeXB0byc7XG5pbXBvcnQgeyBTQ0FOX1FSX0NPREVfTUVUSE9EIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NyeXB0by92ZXJpZmljYXRpb24vUVJDb2RlXCI7XG5pbXBvcnQgeyBWZXJpZmljYXRpb25SZXF1ZXN0IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NyeXB0by92ZXJpZmljYXRpb24vcmVxdWVzdC9WZXJpZmljYXRpb25SZXF1ZXN0XCI7XG5pbXBvcnQgeyBSb29tTWVtYmVyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tLW1lbWJlclwiO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvdXNlclwiO1xuaW1wb3J0IHsgUmVjaXByb2NhdGVRUkNvZGUgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvY3J5cHRvL3ZlcmlmaWNhdGlvbi9RUkNvZGVcIjtcbmltcG9ydCB7IFNBUyB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9jcnlwdG8vdmVyaWZpY2F0aW9uL1NBU1wiO1xuXG5pbXBvcnQgVmVyaWZpY2F0aW9uUVJDb2RlIGZyb20gXCIuLi9lbGVtZW50cy9jcnlwdG8vVmVyaWZpY2F0aW9uUVJDb2RlXCI7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBTZGtDb25maWcgZnJvbSBcIi4uLy4uLy4uL1Nka0NvbmZpZ1wiO1xuaW1wb3J0IEUyRUljb24sIHsgRTJFU3RhdGUgfSBmcm9tIFwiLi4vcm9vbXMvRTJFSWNvblwiO1xuaW1wb3J0IHsgUGhhc2UgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvY3J5cHRvL3ZlcmlmaWNhdGlvbi9yZXF1ZXN0L1ZlcmlmaWNhdGlvblJlcXVlc3RcIjtcbmltcG9ydCBTcGlubmVyIGZyb20gXCIuLi9lbGVtZW50cy9TcGlubmVyXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCBWZXJpZmljYXRpb25TaG93U2FzIGZyb20gXCIuLi92ZXJpZmljYXRpb24vVmVyaWZpY2F0aW9uU2hvd1Nhc1wiO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGxheW91dDogc3RyaW5nO1xuICAgIHJlcXVlc3Q6IFZlcmlmaWNhdGlvblJlcXVlc3Q7XG4gICAgbWVtYmVyOiBSb29tTWVtYmVyIHwgVXNlcjtcbiAgICBwaGFzZTogUGhhc2U7XG4gICAgb25DbG9zZTogKCkgPT4gdm9pZDtcbiAgICBpc1Jvb21FbmNyeXB0ZWQ6IGJvb2xlYW47XG4gICAgaW5EaWFsb2c6IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHNhc0V2ZW50PzogU0FTW1wic2FzRXZlbnRcIl07XG4gICAgZW1vamlCdXR0b25DbGlja2VkPzogYm9vbGVhbjtcbiAgICByZWNpcHJvY2F0ZUJ1dHRvbkNsaWNrZWQ/OiBib29sZWFuO1xuICAgIHJlY2lwcm9jYXRlUVJFdmVudD86IFJlY2lwcm9jYXRlUVJDb2RlW1wicmVjaXByb2NhdGVRUkV2ZW50XCJdO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5yaWdodF9wYW5lbC5WZXJpZmljYXRpb25QYW5lbFwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmVyaWZpY2F0aW9uUGFuZWwgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBoYXNWZXJpZmllcjogYm9vbGVhbjtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge307XG4gICAgICAgIHRoaXMuaGFzVmVyaWZpZXIgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclFSUGhhc2UoKSB7XG4gICAgICAgIGNvbnN0IHsgbWVtYmVyLCByZXF1ZXN0IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBzaG93U0FTOiBib29sZWFuID0gcmVxdWVzdC5vdGhlclBhcnR5U3VwcG9ydHNNZXRob2QodmVyaWZpY2F0aW9uTWV0aG9kcy5TQVMpO1xuICAgICAgICBjb25zdCBzaG93UVI6IGJvb2xlYW4gPSByZXF1ZXN0Lm90aGVyUGFydHlTdXBwb3J0c01ldGhvZChTQ0FOX1FSX0NPREVfTUVUSE9EKTtcbiAgICAgICAgY29uc3QgYnJhbmQgPSBTZGtDb25maWcuZ2V0KCkuYnJhbmQ7XG5cbiAgICAgICAgY29uc3Qgbm9Db21tb25NZXRob2RFcnJvcjogSlNYLkVsZW1lbnQgPSAhc2hvd1NBUyAmJiAhc2hvd1FSID9cbiAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgXCJUaGUgc2Vzc2lvbiB5b3UgYXJlIHRyeWluZyB0byB2ZXJpZnkgZG9lc24ndCBzdXBwb3J0IHNjYW5uaW5nIGEgXCIgK1xuICAgICAgICAgICAgICAgIFwiUVIgY29kZSBvciBlbW9qaSB2ZXJpZmljYXRpb24sIHdoaWNoIGlzIHdoYXQgJShicmFuZClzIHN1cHBvcnRzLiBUcnkgXCIgK1xuICAgICAgICAgICAgICAgIFwid2l0aCBhIGRpZmZlcmVudCBjbGllbnQuXCIsXG4gICAgICAgICAgICAgICAgeyBicmFuZCB9LFxuICAgICAgICAgICAgKSB9PC9wPiA6XG4gICAgICAgICAgICBudWxsO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmxheW91dCA9PT0gJ2RpYWxvZycpIHtcbiAgICAgICAgICAgIC8vIEhBQ0s6IFRoaXMgaXMgYSB0ZXJyaWJsZSBpZGVhLlxuICAgICAgICAgICAgbGV0IHFyQmxvY2tEaWFsb2c6IEpTWC5FbGVtZW50O1xuICAgICAgICAgICAgbGV0IHNhc0Jsb2NrRGlhbG9nOiBKU1guRWxlbWVudDtcbiAgICAgICAgICAgIGlmIChzaG93UVIpIHtcbiAgICAgICAgICAgICAgICBxckJsb2NrRGlhbG9nID1cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1ZlcmlmaWNhdGlvblBhbmVsX1FSUGhhc2Vfc3RhcnRPcHRpb24nPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHA+eyBfdChcIlNjYW4gdGhpcyB1bmlxdWUgY29kZVwiKSB9PC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgPFZlcmlmaWNhdGlvblFSQ29kZSBxckNvZGVEYXRhPXtyZXF1ZXN0LnFyQ29kZURhdGF9IC8+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzaG93U0FTKSB7XG4gICAgICAgICAgICAgICAgc2FzQmxvY2tEaWFsb2cgPSA8ZGl2IGNsYXNzTmFtZT0nbXhfVmVyaWZpY2F0aW9uUGFuZWxfUVJQaGFzZV9zdGFydE9wdGlvbic+XG4gICAgICAgICAgICAgICAgICAgIDxwPnsgX3QoXCJDb21wYXJlIHVuaXF1ZSBlbW9qaVwiKSB9PC9wPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J214X1ZlcmlmaWNhdGlvblBhbmVsX1FSUGhhc2VfaGVscFRleHQnPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkNvbXBhcmUgYSB1bmlxdWUgc2V0IG9mIGVtb2ppIGlmIHlvdSBkb24ndCBoYXZlIGEgY2FtZXJhIG9uIGVpdGhlciBkZXZpY2VcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGRpc2FibGVkPXt0aGlzLnN0YXRlLmVtb2ppQnV0dG9uQ2xpY2tlZH0gb25DbGljaz17dGhpcy5zdGFydFNBU30ga2luZD0ncHJpbWFyeSc+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiU3RhcnRcIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgb3IgPSBxckJsb2NrRGlhbG9nICYmIHNhc0Jsb2NrRGlhbG9nID9cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbXhfVmVyaWZpY2F0aW9uUGFuZWxfUVJQaGFzZV9iZXR3ZWVuVGV4dCc+eyBfdChcIm9yXCIpIH08L2Rpdj4gOiBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiVmVyaWZ5IHRoaXMgc2Vzc2lvbiBieSBjb21wbGV0aW5nIG9uZSBvZiB0aGUgZm9sbG93aW5nOlwiKSB9XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9WZXJpZmljYXRpb25QYW5lbF9RUlBoYXNlX3N0YXJ0T3B0aW9ucyc+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHFyQmxvY2tEaWFsb2cgfVxuICAgICAgICAgICAgICAgICAgICAgICAgeyBvciB9XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHNhc0Jsb2NrRGlhbG9nIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbm9Db21tb25NZXRob2RFcnJvciB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBxckJsb2NrOiBKU1guRWxlbWVudDtcbiAgICAgICAgaWYgKHNob3dRUikge1xuICAgICAgICAgICAgcXJCbG9jayA9IDxkaXYgY2xhc3NOYW1lPVwibXhfVXNlckluZm9fY29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICAgPGgzPnsgX3QoXCJWZXJpZnkgYnkgc2Nhbm5pbmdcIikgfTwvaDM+XG4gICAgICAgICAgICAgICAgPHA+eyBfdChcIkFzayAlKGRpc3BsYXlOYW1lKXMgdG8gc2NhbiB5b3VyIGNvZGU6XCIsIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IChtZW1iZXIgYXMgVXNlcikuZGlzcGxheU5hbWUgfHwgKG1lbWJlciBhcyBSb29tTWVtYmVyKS5uYW1lIHx8IG1lbWJlci51c2VySWQsXG4gICAgICAgICAgICAgICAgfSkgfTwvcD5cblxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfVmVyaWZpY2F0aW9uUGFuZWxfcXJDb2RlXCI+XG4gICAgICAgICAgICAgICAgICAgIDxWZXJpZmljYXRpb25RUkNvZGUgcXJDb2RlRGF0YT17cmVxdWVzdC5xckNvZGVEYXRhfSAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHNhc0Jsb2NrOiBKU1guRWxlbWVudDtcbiAgICAgICAgaWYgKHNob3dTQVMpIHtcbiAgICAgICAgICAgIGNvbnN0IGRpc2FibGVkID0gdGhpcy5zdGF0ZS5lbW9qaUJ1dHRvbkNsaWNrZWQ7XG4gICAgICAgICAgICBjb25zdCBzYXNMYWJlbCA9IHNob3dRUiA/XG4gICAgICAgICAgICAgICAgX3QoXCJJZiB5b3UgY2FuJ3Qgc2NhbiB0aGUgY29kZSBhYm92ZSwgdmVyaWZ5IGJ5IGNvbXBhcmluZyB1bmlxdWUgZW1vamkuXCIpIDpcbiAgICAgICAgICAgICAgICBfdChcIlZlcmlmeSBieSBjb21wYXJpbmcgdW5pcXVlIGVtb2ppLlwiKTtcblxuICAgICAgICAgICAgLy8gTm90ZTogbXhfVmVyaWZpY2F0aW9uUGFuZWxfdmVyaWZ5QnlFbW9qaUJ1dHRvbiBpcyBmb3IgdGhlIGVuZC10by1lbmQgdGVzdHNcbiAgICAgICAgICAgIHNhc0Jsb2NrID0gPGRpdiBjbGFzc05hbWU9XCJteF9Vc2VySW5mb19jb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICA8aDM+eyBfdChcIlZlcmlmeSBieSBlbW9qaVwiKSB9PC9oMz5cbiAgICAgICAgICAgICAgICA8cD57IHNhc0xhYmVsIH08L3A+XG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICAgICAgICAgICAgICBraW5kPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1VzZXJJbmZvX3dpZGVCdXR0b24gbXhfVmVyaWZpY2F0aW9uUGFuZWxfdmVyaWZ5QnlFbW9qaUJ1dHRvblwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuc3RhcnRTQVN9XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiVmVyaWZ5IGJ5IGVtb2ppXCIpIH1cbiAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub0NvbW1vbk1ldGhvZEJsb2NrID0gbm9Db21tb25NZXRob2RFcnJvciA/XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1VzZXJJbmZvX2NvbnRhaW5lclwiPnsgbm9Db21tb25NZXRob2RFcnJvciB9PC9kaXY+IDpcbiAgICAgICAgICAgIG51bGw7XG5cbiAgICAgICAgLy8gVE9ETzogYWRkIHdheSB0byBvcGVuIGNhbWVyYSB0byBzY2FuIGEgUVIgY29kZVxuICAgICAgICByZXR1cm4gPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgeyBxckJsb2NrIH1cbiAgICAgICAgICAgIHsgc2FzQmxvY2sgfVxuICAgICAgICAgICAgeyBub0NvbW1vbk1ldGhvZEJsb2NrIH1cbiAgICAgICAgPC9SZWFjdC5GcmFnbWVudD47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblJlY2lwcm9jYXRlWWVzQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyByZWNpcHJvY2F0ZUJ1dHRvbkNsaWNrZWQ6IHRydWUgfSk7XG4gICAgICAgIHRoaXMuc3RhdGUucmVjaXByb2NhdGVRUkV2ZW50LmNvbmZpcm0oKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblJlY2lwcm9jYXRlTm9DbGljayA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHJlY2lwcm9jYXRlQnV0dG9uQ2xpY2tlZDogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZWNpcHJvY2F0ZVFSRXZlbnQuY2FuY2VsKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgZ2V0RGV2aWNlKCkge1xuICAgICAgICBjb25zdCBkZXZpY2VJZCA9IHRoaXMucHJvcHMucmVxdWVzdCAmJiB0aGlzLnByb3BzLnJlcXVlc3QuY2hhbm5lbC5kZXZpY2VJZDtcbiAgICAgICAgcmV0dXJuIE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRTdG9yZWREZXZpY2UoTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFVzZXJJZCgpLCBkZXZpY2VJZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJRUlJlY2lwcm9jYXRlUGhhc2UoKSB7XG4gICAgICAgIGNvbnN0IHsgbWVtYmVyLCByZXF1ZXN0IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IHJlcXVlc3QuaXNTZWxmVmVyaWZpY2F0aW9uID9cbiAgICAgICAgICAgIF90KFwiQWxtb3N0IHRoZXJlISBJcyB5b3VyIG90aGVyIHNlc3Npb24gc2hvd2luZyB0aGUgc2FtZSBzaGllbGQ/XCIpIDpcbiAgICAgICAgICAgIF90KFwiQWxtb3N0IHRoZXJlISBJcyAlKGRpc3BsYXlOYW1lKXMgc2hvd2luZyB0aGUgc2FtZSBzaGllbGQ/XCIsIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogKG1lbWJlciBhcyBVc2VyKS5kaXNwbGF5TmFtZSB8fCAobWVtYmVyIGFzIFJvb21NZW1iZXIpLm5hbWUgfHwgbWVtYmVyLnVzZXJJZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBsZXQgYm9keTogSlNYLkVsZW1lbnQ7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnJlY2lwcm9jYXRlUVJFdmVudCkge1xuICAgICAgICAgICAgLy8gRWxlbWVudCBXZWIgZG9lc24ndCBzdXBwb3J0IHNjYW5uaW5nIHlldCwgc28gYXNzdW1lIGhlcmUgd2UncmUgdGhlIGNsaWVudCBiZWluZyBzY2FubmVkLlxuICAgICAgICAgICAgYm9keSA9IDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgICA8cD57IGRlc2NyaXB0aW9uIH08L3A+XG4gICAgICAgICAgICAgICAgPEUyRUljb24gaXNVc2VyPXt0cnVlfSBzdGF0dXM9e0UyRVN0YXRlLlZlcmlmaWVkfSBzaXplPXsxMjh9IGhpZGVUb29sdGlwPXt0cnVlfSAvPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfVmVyaWZpY2F0aW9uUGFuZWxfcmVjaXByb2NhdGVCdXR0b25zXCI+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICBraW5kPVwiZGFuZ2VyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLnJlY2lwcm9jYXRlQnV0dG9uQ2xpY2tlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25SZWNpcHJvY2F0ZU5vQ2xpY2t9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJOb1wiKSB9XG4gICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLnJlY2lwcm9jYXRlQnV0dG9uQ2xpY2tlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25SZWNpcHJvY2F0ZVllc0NsaWNrfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiWWVzXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9SZWFjdC5GcmFnbWVudD47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBib2R5ID0gPHA+PFNwaW5uZXIgLz48L3A+O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X1VzZXJJbmZvX2NvbnRhaW5lciBteF9WZXJpZmljYXRpb25QYW5lbF9yZWNpcHJvY2F0ZV9zZWN0aW9uXCI+XG4gICAgICAgICAgICA8aDM+eyBfdChcIlZlcmlmeSBieSBzY2FubmluZ1wiKSB9PC9oMz5cbiAgICAgICAgICAgIHsgYm9keSB9XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclZlcmlmaWVkUGhhc2UoKSB7XG4gICAgICAgIGNvbnN0IHsgbWVtYmVyLCByZXF1ZXN0IH0gPSB0aGlzLnByb3BzO1xuXG4gICAgICAgIGxldCB0ZXh0OiBzdHJpbmc7XG4gICAgICAgIGlmICghcmVxdWVzdC5pc1NlbGZWZXJpZmljYXRpb24pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmlzUm9vbUVuY3J5cHRlZCkge1xuICAgICAgICAgICAgICAgIHRleHQgPSBfdChcIlZlcmlmeSBhbGwgdXNlcnMgaW4gYSByb29tIHRvIGVuc3VyZSBpdCdzIHNlY3VyZS5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRleHQgPSBfdChcIkluIGVuY3J5cHRlZCByb29tcywgdmVyaWZ5IGFsbCB1c2VycyB0byBlbnN1cmUgaXQncyBzZWN1cmUuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICAgIGlmIChyZXF1ZXN0LmlzU2VsZlZlcmlmaWNhdGlvbikge1xuICAgICAgICAgICAgY29uc3QgZGV2aWNlID0gdGhpcy5nZXREZXZpY2UoKTtcbiAgICAgICAgICAgIGlmICghZGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBjYW4gaGFwcGVuIGlmIHRoZSBkZXZpY2UgaXMgbG9nZ2VkIG91dCB3aGlsZSB3ZSdyZSBzdGlsbCBzaG93aW5nIHZlcmlmaWNhdGlvblxuICAgICAgICAgICAgICAgIC8vIFVJIGZvciBpdC5cbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybihcIlZlcmlmaWVkIGRldmljZSB3ZSBkb24ndCBrbm93IGFib3V0OiBcIiArIHRoaXMucHJvcHMucmVxdWVzdC5jaGFubmVsLmRldmljZUlkKTtcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IF90KFwiWW91J3ZlIHN1Y2Nlc3NmdWxseSB2ZXJpZmllZCB5b3VyIGRldmljZSFcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gX3QoXCJZb3UndmUgc3VjY2Vzc2Z1bGx5IHZlcmlmaWVkICUoZGV2aWNlTmFtZSlzICglKGRldmljZUlkKXMpIVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGRldmljZU5hbWU6IGRldmljZSA/IGRldmljZS5nZXREaXNwbGF5TmFtZSgpIDogJycsXG4gICAgICAgICAgICAgICAgICAgIGRldmljZUlkOiB0aGlzLnByb3BzLnJlcXVlc3QuY2hhbm5lbC5kZXZpY2VJZCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gX3QoXCJZb3UndmUgc3VjY2Vzc2Z1bGx5IHZlcmlmaWVkICUoZGlzcGxheU5hbWUpcyFcIiwge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAobWVtYmVyIGFzIFVzZXIpLmRpc3BsYXlOYW1lIHx8IChtZW1iZXIgYXMgUm9vbU1lbWJlcikubmFtZSB8fCBtZW1iZXIudXNlcklkLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Vc2VySW5mb19jb250YWluZXIgbXhfVmVyaWZpY2F0aW9uUGFuZWxfdmVyaWZpZWRfc2VjdGlvblwiPlxuICAgICAgICAgICAgICAgIDxwPnsgZGVzY3JpcHRpb24gfTwvcD5cbiAgICAgICAgICAgICAgICA8RTJFSWNvbiBpc1VzZXI9e3RydWV9IHN0YXR1cz17RTJFU3RhdGUuVmVyaWZpZWR9IHNpemU9ezEyOH0gaGlkZVRvb2x0aXA9e3RydWV9IC8+XG4gICAgICAgICAgICAgICAgeyB0ZXh0ID8gPHA+eyB0ZXh0IH08L3A+IDogbnVsbCB9XG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24ga2luZD1cInByaW1hcnlcIiBjbGFzc05hbWU9XCJteF9Vc2VySW5mb193aWRlQnV0dG9uXCIgb25DbGljaz17dGhpcy5wcm9wcy5vbkNsb3NlfT5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcIkdvdCBpdFwiKSB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJDYW5jZWxsZWRQaGFzZSgpIHtcbiAgICAgICAgY29uc3QgeyBtZW1iZXIsIHJlcXVlc3QgfSA9IHRoaXMucHJvcHM7XG5cbiAgICAgICAgbGV0IHN0YXJ0QWdhaW5JbnN0cnVjdGlvbjogc3RyaW5nO1xuICAgICAgICBpZiAocmVxdWVzdC5pc1NlbGZWZXJpZmljYXRpb24pIHtcbiAgICAgICAgICAgIHN0YXJ0QWdhaW5JbnN0cnVjdGlvbiA9IF90KFwiU3RhcnQgdmVyaWZpY2F0aW9uIGFnYWluIGZyb20gdGhlIG5vdGlmaWNhdGlvbi5cIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGFydEFnYWluSW5zdHJ1Y3Rpb24gPSBfdChcIlN0YXJ0IHZlcmlmaWNhdGlvbiBhZ2FpbiBmcm9tIHRoZWlyIHByb2ZpbGUuXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRleHQ6IHN0cmluZztcbiAgICAgICAgaWYgKHJlcXVlc3QuY2FuY2VsbGF0aW9uQ29kZSA9PT0gXCJtLnRpbWVvdXRcIikge1xuICAgICAgICAgICAgdGV4dCA9IF90KFwiVmVyaWZpY2F0aW9uIHRpbWVkIG91dC5cIikgKyBgICR7c3RhcnRBZ2Fpbkluc3RydWN0aW9ufWA7XG4gICAgICAgIH0gZWxzZSBpZiAocmVxdWVzdC5jYW5jZWxsaW5nVXNlcklkID09PSByZXF1ZXN0Lm90aGVyVXNlcklkKSB7XG4gICAgICAgICAgICBpZiAocmVxdWVzdC5pc1NlbGZWZXJpZmljYXRpb24pIHtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gX3QoXCJZb3UgY2FuY2VsbGVkIHZlcmlmaWNhdGlvbiBvbiB5b3VyIG90aGVyIHNlc3Npb24uXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gX3QoXCIlKGRpc3BsYXlOYW1lKXMgY2FuY2VsbGVkIHZlcmlmaWNhdGlvbi5cIiwge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogKG1lbWJlciBhcyBVc2VyKS5kaXNwbGF5TmFtZSB8fCAobWVtYmVyIGFzIFJvb21NZW1iZXIpLm5hbWUgfHwgbWVtYmVyLnVzZXJJZCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRleHQgPSBgJHt0ZXh0fSAke3N0YXJ0QWdhaW5JbnN0cnVjdGlvbn1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGV4dCA9IF90KFwiWW91IGNhbmNlbGxlZCB2ZXJpZmljYXRpb24uXCIpICsgYCAke3N0YXJ0QWdhaW5JbnN0cnVjdGlvbn1gO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfVXNlckluZm9fY29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICAgPGgzPnsgX3QoXCJWZXJpZmljYXRpb24gY2FuY2VsbGVkXCIpIH08L2gzPlxuICAgICAgICAgICAgICAgIDxwPnsgdGV4dCB9PC9wPlxuXG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24ga2luZD1cInByaW1hcnlcIiBjbGFzc05hbWU9XCJteF9Vc2VySW5mb193aWRlQnV0dG9uXCIgb25DbGljaz17dGhpcy5wcm9wcy5vbkNsb3NlfT5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcIkdvdCBpdFwiKSB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBtZW1iZXIsIHBoYXNlLCByZXF1ZXN0IH0gPSB0aGlzLnByb3BzO1xuXG4gICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gKG1lbWJlciBhcyBVc2VyKS5kaXNwbGF5TmFtZSB8fCAobWVtYmVyIGFzIFJvb21NZW1iZXIpLm5hbWUgfHwgbWVtYmVyLnVzZXJJZDtcblxuICAgICAgICBzd2l0Y2ggKHBoYXNlKSB7XG4gICAgICAgICAgICBjYXNlIFBoYXNlLlJlYWR5OlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlclFSUGhhc2UoKTtcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuU3RhcnRlZDpcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlcXVlc3QuY2hvc2VuTWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgdmVyaWZpY2F0aW9uTWV0aG9kcy5SRUNJUFJPQ0FURV9RUl9DT0RFOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyUVJSZWNpcHJvY2F0ZVBoYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgdmVyaWZpY2F0aW9uTWV0aG9kcy5TQVM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVtb2ppcyA9IHRoaXMuc3RhdGUuc2FzRXZlbnQgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxWZXJpZmljYXRpb25TaG93U2FzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lPXtkaXNwbGF5TmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlPXt0aGlzLmdldERldmljZSgpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXM9e3RoaXMuc3RhdGUuc2FzRXZlbnQuc2FzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbD17dGhpcy5vblNhc01pc21hdGNoZXNDbGlja31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Eb25lPXt0aGlzLm9uU2FzTWF0Y2hlc0NsaWNrfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbkRpYWxvZz17dGhpcy5wcm9wcy5pbkRpYWxvZ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNTZWxmPXtyZXF1ZXN0LmlzU2VsZlZlcmlmaWNhdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPiA6IDxTcGlubmVyIC8+O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfVXNlckluZm9fY29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBlbW9qaXMgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFBoYXNlLkRvbmU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyVmVyaWZpZWRQaGFzZSgpO1xuICAgICAgICAgICAgY2FzZSBQaGFzZS5DYW5jZWxsZWQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyQ2FuY2VsbGVkUGhhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBsb2dnZXIuZXJyb3IoXCJWZXJpZmljYXRpb25QYW5lbCB1bmhhbmRsZWQgcGhhc2U6XCIsIHBoYXNlKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGFydFNBUyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVtb2ppQnV0dG9uQ2xpY2tlZDogdHJ1ZSB9KTtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSB0aGlzLnByb3BzLnJlcXVlc3QuYmVnaW5LZXlWZXJpZmljYXRpb24odmVyaWZpY2F0aW9uTWV0aG9kcy5TQVMpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdmVyaWZpZXIudmVyaWZ5KCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblNhc01hdGNoZXNDbGljayA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zdGF0ZS5zYXNFdmVudC5jb25maXJtKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25TYXNNaXNtYXRjaGVzQ2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc3RhdGUuc2FzRXZlbnQubWlzbWF0Y2goKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSB1cGRhdGVWZXJpZmllclN0YXRlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IHJlcXVlc3QgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHNhc0V2ZW50ID0gKHJlcXVlc3QudmVyaWZpZXIgYXMgU0FTKS5zYXNFdmVudDtcbiAgICAgICAgY29uc3QgcmVjaXByb2NhdGVRUkV2ZW50ID0gKHJlcXVlc3QudmVyaWZpZXIgYXMgUmVjaXByb2NhdGVRUkNvZGUpLnJlY2lwcm9jYXRlUVJFdmVudDtcbiAgICAgICAgcmVxdWVzdC52ZXJpZmllci5vZmYoJ3Nob3dfc2FzJywgdGhpcy51cGRhdGVWZXJpZmllclN0YXRlKTtcbiAgICAgICAgcmVxdWVzdC52ZXJpZmllci5vZmYoJ3Nob3dfcmVjaXByb2NhdGVfcXInLCB0aGlzLnVwZGF0ZVZlcmlmaWVyU3RhdGUpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2FzRXZlbnQsIHJlY2lwcm9jYXRlUVJFdmVudCB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblJlcXVlc3RDaGFuZ2UgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcmVxdWVzdCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgaGFkVmVyaWZpZXIgPSB0aGlzLmhhc1ZlcmlmaWVyO1xuICAgICAgICB0aGlzLmhhc1ZlcmlmaWVyID0gISFyZXF1ZXN0LnZlcmlmaWVyO1xuICAgICAgICBpZiAoIWhhZFZlcmlmaWVyICYmIHRoaXMuaGFzVmVyaWZpZXIpIHtcbiAgICAgICAgICAgIHJlcXVlc3QudmVyaWZpZXIub24oJ3Nob3dfc2FzJywgdGhpcy51cGRhdGVWZXJpZmllclN0YXRlKTtcbiAgICAgICAgICAgIHJlcXVlc3QudmVyaWZpZXIub24oJ3Nob3dfcmVjaXByb2NhdGVfcXInLCB0aGlzLnVwZGF0ZVZlcmlmaWVyU3RhdGUpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAvLyBvbiB0aGUgcmVxdWVzdGVyIHNpZGUsIHRoaXMgaXMgYWxzbyBhd2FpdGVkIGluIHN0YXJ0U0FTLFxuICAgICAgICAgICAgICAgIC8vIGJ1dCB0aGF0J3Mgb2sgYXMgdmVyaWZ5IHNob3VsZCByZXR1cm4gdGhlIHNhbWUgcHJvbWlzZS5cbiAgICAgICAgICAgICAgICBhd2FpdCByZXF1ZXN0LnZlcmlmaWVyLnZlcmlmeSgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiZXJyb3IgdmVyaWZ5XCIsIGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IHJlcXVlc3QgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHJlcXVlc3Qub24oXCJjaGFuZ2VcIiwgdGhpcy5vblJlcXVlc3RDaGFuZ2UpO1xuICAgICAgICBpZiAocmVxdWVzdC52ZXJpZmllcikge1xuICAgICAgICAgICAgY29uc3Qgc2FzRXZlbnQgPSAocmVxdWVzdC52ZXJpZmllciBhcyBTQVMpLnNhc0V2ZW50O1xuICAgICAgICAgICAgY29uc3QgcmVjaXByb2NhdGVRUkV2ZW50ID0gKHJlcXVlc3QudmVyaWZpZXIgYXMgUmVjaXByb2NhdGVRUkNvZGUpLnJlY2lwcm9jYXRlUVJFdmVudDtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzYXNFdmVudCwgcmVjaXByb2NhdGVRUkV2ZW50IH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub25SZXF1ZXN0Q2hhbmdlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IHJlcXVlc3QgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChyZXF1ZXN0LnZlcmlmaWVyKSB7XG4gICAgICAgICAgICByZXF1ZXN0LnZlcmlmaWVyLm9mZignc2hvd19zYXMnLCB0aGlzLnVwZGF0ZVZlcmlmaWVyU3RhdGUpO1xuICAgICAgICAgICAgcmVxdWVzdC52ZXJpZmllci5vZmYoJ3Nob3dfcmVjaXByb2NhdGVfcXInLCB0aGlzLnVwZGF0ZVZlcmlmaWVyU3RhdGUpO1xuICAgICAgICB9XG4gICAgICAgIHJlcXVlc3Qub2ZmKFwiY2hhbmdlXCIsIHRoaXMub25SZXF1ZXN0Q2hhbmdlKTtcbiAgICB9XG59XG4iXX0=