"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var sdk = _interopRequireWildcard(require("../../../index"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _FlairStore = _interopRequireDefault(require("../../../stores/FlairStore"));

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Media = require("../../../customisations/Media");

var _languageHandler = require("../../../languageHandler");

var _TagOrderActions = _interopRequireDefault(require("../../../actions/TagOrderActions"));

var _GroupFilterOrderStore = _interopRequireDefault(require("../../../stores/GroupFilterOrderStore"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let GroupTile = (_dec = (0, _replaceableComponent.replaceableComponent)("views.groups.GroupTile"), _dec(_class = (_temp = _class2 = class GroupTile extends _react.default.Component {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "state", {
      profile: null
    });
    (0, _defineProperty2.default)(this, "onClick", e => {
      e.preventDefault();

      _dispatcher.default.dispatch({
        action: 'view_group',
        group_id: this.props.groupId
      });
    });
    (0, _defineProperty2.default)(this, "onPinClick", e => {
      e.preventDefault();
      e.stopPropagation();

      _dispatcher.default.dispatch(_TagOrderActions.default.moveTag(this.context, this.props.groupId, 0));
    });
    (0, _defineProperty2.default)(this, "onUnpinClick", e => {
      e.preventDefault();
      e.stopPropagation();

      _dispatcher.default.dispatch(_TagOrderActions.default.removeTag(this.context, this.props.groupId));
    });
  }

  componentDidMount() {
    _FlairStore.default.getGroupProfileCached(this.context, this.props.groupId).then(profile => {
      this.setState({
        profile
      });
    }).catch(err => {
      _logger.logger.error('Error whilst getting cached profile for GroupTile', err);
    });
  }

  render() {
    const BaseAvatar = sdk.getComponent('avatars.BaseAvatar');
    const AccessibleButton = sdk.getComponent('elements.AccessibleButton');
    const profile = this.state.profile || {};
    const name = profile.name || this.props.groupId;
    const avatarHeight = this.props.avatarHeight;
    const descElement = this.props.showDescription ? /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_desc"
    }, profile.shortDescription) : /*#__PURE__*/_react.default.createElement("div", null);
    const httpUrl = profile.avatarUrl ? (0, _Media.mediaFromMxc)(profile.avatarUrl).getSquareThumbnailHttp(avatarHeight) : null;

    const avatarElement = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_avatar"
    }, /*#__PURE__*/_react.default.createElement(BaseAvatar, {
      name: name,
      idName: this.props.groupId,
      url: httpUrl,
      width: avatarHeight,
      height: avatarHeight
    }));

    return /*#__PURE__*/_react.default.createElement(AccessibleButton, {
      className: "mx_GroupTile",
      onClick: this.onClick
    }, avatarElement, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_profile"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_name"
    }, name), descElement, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_groupId"
    }, this.props.groupId), !(_GroupFilterOrderStore.default.getOrderedTags() || []).includes(this.props.groupId) ? /*#__PURE__*/_react.default.createElement(AccessibleButton, {
      kind: "link",
      onClick: this.onPinClick
    }, (0, _languageHandler._t)("Pin")) : /*#__PURE__*/_react.default.createElement(AccessibleButton, {
      kind: "link",
      onClick: this.onUnpinClick
    }, (0, _languageHandler._t)("Unpin"))));
  }

}, (0, _defineProperty2.default)(_class2, "propTypes", {
  groupId: _propTypes.default.string.isRequired,
  // Whether to show the short description of the group on the tile
  showDescription: _propTypes.default.bool,
  // Height of the group avatar in pixels
  avatarHeight: _propTypes.default.number
}), (0, _defineProperty2.default)(_class2, "contextType", _MatrixClientContext.default), (0, _defineProperty2.default)(_class2, "defaultProps", {
  showDescription: true,
  avatarHeight: 50
}), _temp)) || _class);
var _default = GroupTile;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2dyb3Vwcy9Hcm91cFRpbGUuanMiXSwibmFtZXMiOlsiR3JvdXBUaWxlIiwiUmVhY3QiLCJDb21wb25lbnQiLCJwcm9maWxlIiwiZSIsInByZXZlbnREZWZhdWx0IiwiZGlzIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJncm91cF9pZCIsInByb3BzIiwiZ3JvdXBJZCIsInN0b3BQcm9wYWdhdGlvbiIsIlRhZ09yZGVyQWN0aW9ucyIsIm1vdmVUYWciLCJjb250ZXh0IiwicmVtb3ZlVGFnIiwiY29tcG9uZW50RGlkTW91bnQiLCJGbGFpclN0b3JlIiwiZ2V0R3JvdXBQcm9maWxlQ2FjaGVkIiwidGhlbiIsInNldFN0YXRlIiwiY2F0Y2giLCJlcnIiLCJsb2dnZXIiLCJlcnJvciIsInJlbmRlciIsIkJhc2VBdmF0YXIiLCJzZGsiLCJnZXRDb21wb25lbnQiLCJBY2Nlc3NpYmxlQnV0dG9uIiwic3RhdGUiLCJuYW1lIiwiYXZhdGFySGVpZ2h0IiwiZGVzY0VsZW1lbnQiLCJzaG93RGVzY3JpcHRpb24iLCJzaG9ydERlc2NyaXB0aW9uIiwiaHR0cFVybCIsImF2YXRhclVybCIsImdldFNxdWFyZVRodW1ibmFpbEh0dHAiLCJhdmF0YXJFbGVtZW50Iiwib25DbGljayIsIkdyb3VwRmlsdGVyT3JkZXJTdG9yZSIsImdldE9yZGVyZWRUYWdzIiwiaW5jbHVkZXMiLCJvblBpbkNsaWNrIiwib25VbnBpbkNsaWNrIiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsImJvb2wiLCJudW1iZXIiLCJNYXRyaXhDbGllbnRDb250ZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7Ozs7Ozs7SUFHTUEsUyxXQURMLGdEQUFxQix3QkFBckIsQyxtQ0FBRCxNQUNNQSxTQUROLFNB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O0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUFxQ1IsSUFBckMsQ0FESixFQUVNRSxXQUZOLGVBR0k7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQXdDLEtBQUt4QixLQUFMLENBQVdDLE9BQW5ELENBSEosRUFJTSxDQUFDLENBQUMrQiwrQkFBc0JDLGNBQXRCLE1BQTBDLEVBQTNDLEVBQStDQyxRQUEvQyxDQUF3RCxLQUFLbEMsS0FBTCxDQUFXQyxPQUFuRSxDQUFELGdCQUNJLDZCQUFDLGdCQUFEO0FBQWtCLE1BQUEsSUFBSSxFQUFDLE1BQXZCO0FBQThCLE1BQUEsT0FBTyxFQUFFLEtBQUtrQztBQUE1QyxPQUNJLHlCQUFHLEtBQUgsQ0FESixDQURKLGdCQUlJLDZCQUFDLGdCQUFEO0FBQWtCLE1BQUEsSUFBSSxFQUFDLE1BQXZCO0FBQThCLE1BQUEsT0FBTyxFQUFFLEtBQUtDO0FBQTVDLE9BQ0kseUJBQUcsT0FBSCxDQURKLENBUlYsQ0FGRyxDQUFQO0FBZ0JIOztBQXhGbUMsQyxzREFDakI7QUFDZm5DLEVBQUFBLE9BQU8sRUFBRW9DLG1CQUFVQyxNQUFWLENBQWlCQyxVQURYO0FBRWY7QUFDQWQsRUFBQUEsZUFBZSxFQUFFWSxtQkFBVUcsSUFIWjtBQUlmO0FBQ0FqQixFQUFBQSxZQUFZLEVBQUVjLG1CQUFVSTtBQUxULEMseURBUUVDLDRCLDBEQUVDO0FBQ2xCakIsRUFBQUEsZUFBZSxFQUFFLElBREM7QUFFbEJGLEVBQUFBLFlBQVksRUFBRTtBQUZJLEM7ZUFnRlhqQyxTIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE3IFZlY3RvciBDcmVhdGlvbnMgTHRkXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgKiBhcyBzZGsgZnJvbSAnLi4vLi4vLi4vaW5kZXgnO1xuaW1wb3J0IGRpcyBmcm9tICcuLi8uLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXInO1xuaW1wb3J0IEZsYWlyU3RvcmUgZnJvbSAnLi4vLi4vLi4vc3RvcmVzL0ZsYWlyU3RvcmUnO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBtZWRpYUZyb21NeGMgfSBmcm9tIFwiLi4vLi4vLi4vY3VzdG9taXNhdGlvbnMvTWVkaWFcIjtcbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IFRhZ09yZGVyQWN0aW9ucyBmcm9tIFwiLi4vLi4vLi4vYWN0aW9ucy9UYWdPcmRlckFjdGlvbnNcIjtcbmltcG9ydCBHcm91cEZpbHRlck9yZGVyU3RvcmUgZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9Hcm91cEZpbHRlck9yZGVyU3RvcmVcIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5ncm91cHMuR3JvdXBUaWxlXCIpXG5jbGFzcyBHcm91cFRpbGUgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICAgIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgICAgIGdyb3VwSWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgLy8gV2hldGhlciB0byBzaG93IHRoZSBzaG9ydCBkZXNjcmlwdGlvbiBvZiB0aGUgZ3JvdXAgb24gdGhlIHRpbGVcbiAgICAgICAgc2hvd0Rlc2NyaXB0aW9uOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgLy8gSGVpZ2h0IG9mIHRoZSBncm91cCBhdmF0YXIgaW4gcGl4ZWxzXG4gICAgICAgIGF2YXRhckhlaWdodDogUHJvcFR5cGVzLm51bWJlcixcbiAgICB9O1xuXG4gICAgc3RhdGljIGNvbnRleHRUeXBlID0gTWF0cml4Q2xpZW50Q29udGV4dDtcblxuICAgIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgICAgIHNob3dEZXNjcmlwdGlvbjogdHJ1ZSxcbiAgICAgICAgYXZhdGFySGVpZ2h0OiA1MCxcbiAgICB9O1xuXG4gICAgc3RhdGUgPSB7XG4gICAgICAgIHByb2ZpbGU6IG51bGwsXG4gICAgfTtcblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBGbGFpclN0b3JlLmdldEdyb3VwUHJvZmlsZUNhY2hlZCh0aGlzLmNvbnRleHQsIHRoaXMucHJvcHMuZ3JvdXBJZCkudGhlbigocHJvZmlsZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHByb2ZpbGUgfSk7XG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRXJyb3Igd2hpbHN0IGdldHRpbmcgY2FjaGVkIHByb2ZpbGUgZm9yIEdyb3VwVGlsZScsIGVycik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uQ2xpY2sgPSBlID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgYWN0aW9uOiAndmlld19ncm91cCcsXG4gICAgICAgICAgICBncm91cF9pZDogdGhpcy5wcm9wcy5ncm91cElkLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgb25QaW5DbGljayA9IGUgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGRpcy5kaXNwYXRjaChUYWdPcmRlckFjdGlvbnMubW92ZVRhZyh0aGlzLmNvbnRleHQsIHRoaXMucHJvcHMuZ3JvdXBJZCwgMCkpO1xuICAgIH07XG5cbiAgICBvblVucGluQ2xpY2sgPSBlID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBkaXMuZGlzcGF0Y2goVGFnT3JkZXJBY3Rpb25zLnJlbW92ZVRhZyh0aGlzLmNvbnRleHQsIHRoaXMucHJvcHMuZ3JvdXBJZCkpO1xuICAgIH07XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IEJhc2VBdmF0YXIgPSBzZGsuZ2V0Q29tcG9uZW50KCdhdmF0YXJzLkJhc2VBdmF0YXInKTtcbiAgICAgICAgY29uc3QgQWNjZXNzaWJsZUJ1dHRvbiA9IHNkay5nZXRDb21wb25lbnQoJ2VsZW1lbnRzLkFjY2Vzc2libGVCdXR0b24nKTtcbiAgICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvZmlsZSB8fCB7fTtcbiAgICAgICAgY29uc3QgbmFtZSA9IHByb2ZpbGUubmFtZSB8fCB0aGlzLnByb3BzLmdyb3VwSWQ7XG4gICAgICAgIGNvbnN0IGF2YXRhckhlaWdodCA9IHRoaXMucHJvcHMuYXZhdGFySGVpZ2h0O1xuICAgICAgICBjb25zdCBkZXNjRWxlbWVudCA9IHRoaXMucHJvcHMuc2hvd0Rlc2NyaXB0aW9uID9cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfR3JvdXBUaWxlX2Rlc2NcIj57IHByb2ZpbGUuc2hvcnREZXNjcmlwdGlvbiB9PC9kaXY+IDpcbiAgICAgICAgICAgIDxkaXYgLz47XG4gICAgICAgIGNvbnN0IGh0dHBVcmwgPSBwcm9maWxlLmF2YXRhclVybFxuICAgICAgICAgICAgPyBtZWRpYUZyb21NeGMocHJvZmlsZS5hdmF0YXJVcmwpLmdldFNxdWFyZVRodW1ibmFpbEh0dHAoYXZhdGFySGVpZ2h0KVxuICAgICAgICAgICAgOiBudWxsO1xuXG4gICAgICAgIGNvbnN0IGF2YXRhckVsZW1lbnQgPSAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0dyb3VwVGlsZV9hdmF0YXJcIj5cbiAgICAgICAgICAgICAgICA8QmFzZUF2YXRhclxuICAgICAgICAgICAgICAgICAgICBuYW1lPXtuYW1lfVxuICAgICAgICAgICAgICAgICAgICBpZE5hbWU9e3RoaXMucHJvcHMuZ3JvdXBJZH1cbiAgICAgICAgICAgICAgICAgICAgdXJsPXtodHRwVXJsfVxuICAgICAgICAgICAgICAgICAgICB3aWR0aD17YXZhdGFySGVpZ2h0fVxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ9e2F2YXRhckhlaWdodH0gLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9XCJteF9Hcm91cFRpbGVcIiBvbkNsaWNrPXt0aGlzLm9uQ2xpY2t9PlxuICAgICAgICAgICAgeyBhdmF0YXJFbGVtZW50IH1cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfR3JvdXBUaWxlX3Byb2ZpbGVcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0dyb3VwVGlsZV9uYW1lXCI+eyBuYW1lIH08L2Rpdj5cbiAgICAgICAgICAgICAgICB7IGRlc2NFbGVtZW50IH1cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0dyb3VwVGlsZV9ncm91cElkXCI+eyB0aGlzLnByb3BzLmdyb3VwSWQgfTwvZGl2PlxuICAgICAgICAgICAgICAgIHsgIShHcm91cEZpbHRlck9yZGVyU3RvcmUuZ2V0T3JkZXJlZFRhZ3MoKSB8fCBbXSkuaW5jbHVkZXModGhpcy5wcm9wcy5ncm91cElkKVxuICAgICAgICAgICAgICAgICAgICA/IDxBY2Nlc3NpYmxlQnV0dG9uIGtpbmQ9XCJsaW5rXCIgb25DbGljaz17dGhpcy5vblBpbkNsaWNrfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJQaW5cIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDogPEFjY2Vzc2libGVCdXR0b24ga2luZD1cImxpbmtcIiBvbkNsaWNrPXt0aGlzLm9uVW5waW5DbGlja30+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiVW5waW5cIikgfVxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj47XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBHcm91cFRpbGU7XG4iXX0=