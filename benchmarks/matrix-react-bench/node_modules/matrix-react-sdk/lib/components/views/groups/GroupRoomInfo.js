"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var sdk = _interopRequireWildcard(require("../../../index"));

var _languageHandler = require("../../../languageHandler");

var _GroupStore = _interopRequireDefault(require("../../../stores/GroupStore"));

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _AutoHideScrollbar = _interopRequireDefault(require("../../structures/AutoHideScrollbar"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Media = require("../../../customisations/Media");

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let GroupRoomInfo = (_dec = (0, _replaceableComponent.replaceableComponent)("views.groups.GroupRoomInfo"), _dec(_class = (_temp = _class2 = class GroupRoomInfo extends _react.default.Component {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "state", {
      isUserPrivilegedInGroup: null,
      groupRoom: null,
      groupRoomPublicityLoading: false,
      groupRoomRemoveLoading: false
    });
    (0, _defineProperty2.default)(this, "onGroupStoreUpdated", () => {
      this.setState({
        isUserPrivilegedInGroup: _GroupStore.default.isUserPrivileged(this.props.groupId)
      });

      this._updateGroupRoom();
    });
    (0, _defineProperty2.default)(this, "_onRemove", e => {
      const groupId = this.props.groupId;
      const roomName = this.state.groupRoom.displayname;
      e.preventDefault();
      e.stopPropagation();
      const QuestionDialog = sdk.getComponent("dialogs.QuestionDialog");

      _Modal.default.createTrackedDialog('Confirm removal of group from room', '', QuestionDialog, {
        title: (0, _languageHandler._t)("Are you sure you want to remove '%(roomName)s' from %(groupId)s?", {
          roomName,
          groupId
        }),
        description: (0, _languageHandler._t)("Removing a room from the community will also remove it from the community page."),
        button: (0, _languageHandler._t)("Remove"),
        onFinished: proceed => {
          if (!proceed) return;
          this.setState({
            groupRoomRemoveLoading: true
          });
          const groupId = this.props.groupId;
          const roomId = this.props.groupRoomId;

          _GroupStore.default.removeRoomFromGroup(this.props.groupId, roomId).then(() => {
            _dispatcher.default.dispatch({
              action: "view_group_room_list"
            });
          }).catch(err => {
            _logger.logger.error(`Error whilst removing ${roomId} from ${groupId}`, err);

            const ErrorDialog = sdk.getComponent("dialogs.ErrorDialog");

            _Modal.default.createTrackedDialog('Failed to remove room from group', '', ErrorDialog, {
              title: (0, _languageHandler._t)("Failed to remove room from community"),
              description: (0, _languageHandler._t)("Failed to remove '%(roomName)s' from %(groupId)s", {
                groupId,
                roomName
              })
            });
          }).finally(() => {
            this.setState({
              groupRoomRemoveLoading: false
            });
          });
        }
      });
    });
    (0, _defineProperty2.default)(this, "_onCancel", e => {
      _dispatcher.default.dispatch({
        action: "view_group_room_list"
      });
    });
    (0, _defineProperty2.default)(this, "_changeGroupRoomPublicity", e => {
      const isPublic = e.target.value === "public";
      this.setState({
        groupRoomPublicityLoading: true
      });
      const groupId = this.props.groupId;
      const roomId = this.props.groupRoomId;
      const roomName = this.state.groupRoom.displayname;

      _GroupStore.default.updateGroupRoomVisibility(this.props.groupId, roomId, isPublic).catch(err => {
        _logger.logger.error(`Error whilst changing visibility of ${roomId} in ${groupId} to ${isPublic}`, err);

        const ErrorDialog = sdk.getComponent("dialogs.ErrorDialog");

        _Modal.default.createTrackedDialog('Failed to remove room from group', '', ErrorDialog, {
          title: (0, _languageHandler._t)("Something went wrong!"),
          description: (0, _languageHandler._t)("The visibility of '%(roomName)s' in %(groupId)s could not be updated.", {
            roomName,
            groupId
          })
        });
      }).finally(() => {
        this.setState({
          groupRoomPublicityLoading: false
        });
      });
    });
  }

  componentDidMount() {
    this._initGroupStore(this.props.groupId);
  } // TODO: [REACT-WARNING] Replace with appropriate lifecycle event
  // eslint-disable-next-line camelcase


  UNSAFE_componentWillReceiveProps(newProps) {
    if (newProps.groupId !== this.props.groupId) {
      this._unregisterGroupStore(this.props.groupId);

      this._initGroupStore(newProps.groupId);
    }
  }

  componentWillUnmount() {
    this._unregisterGroupStore(this.props.groupId);
  }

  _initGroupStore(groupId) {
    _GroupStore.default.registerListener(groupId, this.onGroupStoreUpdated);
  }

  _unregisterGroupStore(groupId) {
    _GroupStore.default.unregisterListener(this.onGroupStoreUpdated);
  }

  _updateGroupRoom() {
    this.setState({
      groupRoom: _GroupStore.default.getGroupRooms(this.props.groupId).find(r => r.roomId === this.props.groupRoomId)
    });
  }

  render() {
    const AccessibleButton = sdk.getComponent('elements.AccessibleButton');
    const InlineSpinner = sdk.getComponent('elements.InlineSpinner');

    if (this.state.groupRoomRemoveLoading || !this.state.groupRoom) {
      const Spinner = sdk.getComponent("elements.Spinner");
      return /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo"
      }, /*#__PURE__*/_react.default.createElement(Spinner, null));
    }

    let adminTools;

    if (this.state.isUserPrivilegedInGroup) {
      adminTools = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_adminTools"
      }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Admin Tools")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_buttons"
      }, /*#__PURE__*/_react.default.createElement(AccessibleButton, {
        className: "mx_MemberInfo_field",
        onClick: this._onRemove
      }, (0, _languageHandler._t)('Remove from community'))), /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)('Visibility in Room List'), this.state.groupRoomPublicityLoading ? /*#__PURE__*/_react.default.createElement(InlineSpinner, null) : /*#__PURE__*/_react.default.createElement("div", null)), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("label", null, /*#__PURE__*/_react.default.createElement("input", {
        type: "radio",
        value: "public",
        checked: this.state.groupRoom.isPublic,
        onChange: this._changeGroupRoomPublicity
      }), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_label_text"
      }, (0, _languageHandler._t)('Visible to everyone')))), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("label", null, /*#__PURE__*/_react.default.createElement("input", {
        type: "radio",
        value: "private",
        checked: !this.state.groupRoom.isPublic,
        onChange: this._changeGroupRoomPublicity
      }), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_label_text"
      }, (0, _languageHandler._t)('Only visible to community members')))));
    }

    const avatarUrl = this.state.groupRoom.avatarUrl;
    let avatarElement;

    if (avatarUrl) {
      const httpUrl = (0, _Media.mediaFromMxc)(avatarUrl).getSquareThumbnailHttp(800);
      avatarElement = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_avatar"
      }, /*#__PURE__*/_react.default.createElement("img", {
        src: httpUrl
      }));
    }

    const groupRoomName = this.state.groupRoom.displayname;
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo",
      role: "tabpanel"
    }, /*#__PURE__*/_react.default.createElement(_AutoHideScrollbar.default, null, /*#__PURE__*/_react.default.createElement(AccessibleButton, {
      className: "mx_MemberInfo_cancel",
      onClick: this._onCancel
    }, /*#__PURE__*/_react.default.createElement("img", {
      src: require("../../../../res/img/cancel.svg"),
      width: "18",
      height: "18",
      className: "mx_filterFlipColor"
    })), avatarElement, /*#__PURE__*/_react.default.createElement("h2", null, groupRoomName), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo_profile"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo_profileField"
    }, this.state.groupRoom.canonicalAlias)), adminTools));
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _MatrixClientContext.default), (0, _defineProperty2.default)(_class2, "propTypes", {
  groupId: _propTypes.default.string,
  groupRoomId: _propTypes.default.string
}), _temp)) || _class);
exports.default = GroupRoomInfo;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2dyb3Vwcy9Hcm91cFJvb21JbmZvLmpzIl0sIm5hbWVzIjpbIkdyb3VwUm9vbUluZm8iLCJSZWFjdCIsIkNvbXBvbmVudCIsImlzVXNlclByaXZpbGVnZWRJbkdyb3VwIiwiZ3JvdXBSb29tIiwiZ3JvdXBSb29tUHVibGljaXR5TG9hZGluZyIsImdyb3VwUm9vbVJlbW92ZUxvYWRpbmciLCJzZXRTdGF0ZSIsIkdyb3VwU3RvcmUiLCJpc1VzZXJQcml2aWxlZ2VkIiwicHJvcHMiLCJncm91cElkIiwiX3VwZGF0ZUdyb3VwUm9vbSIsImUiLCJyb29tTmFtZSIsInN0YXRlIiwiZGlzcGxheW5hbWUiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsIlF1ZXN0aW9uRGlhbG9nIiwic2RrIiwiZ2V0Q29tcG9uZW50IiwiTW9kYWwiLCJjcmVhdGVUcmFja2VkRGlhbG9nIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImJ1dHRvbiIsIm9uRmluaXNoZWQiLCJwcm9jZWVkIiwicm9vbUlkIiwiZ3JvdXBSb29tSWQiLCJyZW1vdmVSb29tRnJvbUdyb3VwIiwidGhlbiIsImRpcyIsImRpc3BhdGNoIiwiYWN0aW9uIiwiY2F0Y2giLCJlcnIiLCJsb2dnZXIiLCJlcnJvciIsIkVycm9yRGlhbG9nIiwiZmluYWxseSIsImlzUHVibGljIiwidGFyZ2V0IiwidmFsdWUiLCJ1cGRhdGVHcm91cFJvb21WaXNpYmlsaXR5IiwiY29tcG9uZW50RGlkTW91bnQiLCJfaW5pdEdyb3VwU3RvcmUiLCJVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsIm5ld1Byb3BzIiwiX3VucmVnaXN0ZXJHcm91cFN0b3JlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJyZWdpc3Rlckxpc3RlbmVyIiwib25Hcm91cFN0b3JlVXBkYXRlZCIsInVucmVnaXN0ZXJMaXN0ZW5lciIsImdldEdyb3VwUm9vbXMiLCJmaW5kIiwiciIsInJlbmRlciIsIkFjY2Vzc2libGVCdXR0b24iLCJJbmxpbmVTcGlubmVyIiwiU3Bpbm5lciIsImFkbWluVG9vbHMiLCJfb25SZW1vdmUiLCJfY2hhbmdlR3JvdXBSb29tUHVibGljaXR5IiwiYXZhdGFyVXJsIiwiYXZhdGFyRWxlbWVudCIsImh0dHBVcmwiLCJnZXRTcXVhcmVUaHVtYm5haWxIdHRwIiwiZ3JvdXBSb29tTmFtZSIsIl9vbkNhbmNlbCIsInJlcXVpcmUiLCJjYW5vbmljYWxBbGlhcyIsIk1hdHJpeENsaWVudENvbnRleHQiLCJQcm9wVHlwZXMiLCJzdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7Ozs7OztJQUdxQkEsYSxXQURwQixnREFBcUIsNEJBQXJCLEMsbUNBQUQsTUFDcUJBLGFBRHJCLFNBQzJDQyxlQUFNQyxTQURqRCxDQUMyRDtBQUFBO0FBQUE7QUFBQSxpREFRL0M7QUFDSkMsTUFBQUEsdUJBQXVCLEVBQUUsSUFEckI7QUFFSkMsTUFBQUEsU0FBUyxFQUFFLElBRlA7QUFHSkMsTUFBQUEseUJBQXlCLEVBQUUsS0FIdkI7QUFJSkMsTUFBQUEsc0JBQXNCLEVBQUU7QUFKcEIsS0FSK0M7QUFBQSwrREFnRGpDLE1BQU07QUFDeEIsV0FBS0MsUUFBTCxDQUFjO0FBQ1ZKLFFBQUFBLHVCQUF1QixFQUFFSyxvQkFBV0MsZ0JBQVgsQ0FBNEIsS0FBS0MsS0FBTCxDQUFXQyxPQUF2QztBQURmLE9BQWQ7O0FBR0EsV0FBS0MsZ0JBQUw7QUFDSCxLQXJEc0Q7QUFBQSxxREF1RDNDQyxDQUFDLElBQUk7QUFDYixZQUFNRixPQUFPLEdBQUcsS0FBS0QsS0FBTCxDQUFXQyxPQUEzQjtBQUNBLFlBQU1HLFFBQVEsR0FBRyxLQUFLQyxLQUFMLENBQVdYLFNBQVgsQ0FBcUJZLFdBQXRDO0FBQ0FILE1BQUFBLENBQUMsQ0FBQ0ksY0FBRjtBQUNBSixN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QWtCLE1BQUEsU0FBUyxFQUFDLHNCQUE1QjtBQUFtRCxNQUFBLE9BQU8sRUFBRSxLQUFLc0Q7QUFBakUsb0JBQ0k7QUFBSyxNQUFBLEdBQUcsRUFBRUMsT0FBTyxDQUFDLGdDQUFELENBQWpCO0FBQXFELE1BQUEsS0FBSyxFQUFDLElBQTNEO0FBQWdFLE1BQUEsTUFBTSxFQUFDLElBQXZFO0FBQTRFLE1BQUEsU0FBUyxFQUFDO0FBQXRGLE1BREosQ0FESixFQUlNTCxhQUpOLGVBTUkseUNBQU1HLGFBQU4sQ0FOSixlQVFJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FDTSxLQUFLdEQsS0FBTCxDQUFXWCxTQUFYLENBQXFCb0UsY0FEM0IsQ0FESixDQVJKLEVBY01WLFVBZE4sQ0FESixDQURKO0FBb0JIOztBQTFNc0QsQyx3REFDbENXLDRCLHVEQUVGO0FBQ2Y5RCxFQUFBQSxPQUFPLEVBQUUrRCxtQkFBVUMsTUFESjtBQUVmN0MsRUFBQUEsV0FBVyxFQUFFNEMsbUJBQVVDO0FBRlIsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxNyBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTkgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBkaXMgZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyJztcbmltcG9ydCBNb2RhbCBmcm9tICcuLi8uLi8uLi9Nb2RhbCc7XG5pbXBvcnQgKiBhcyBzZGsgZnJvbSAnLi4vLi4vLi4vaW5kZXgnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IEdyb3VwU3RvcmUgZnJvbSAnLi4vLi4vLi4vc3RvcmVzL0dyb3VwU3RvcmUnO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCBBdXRvSGlkZVNjcm9sbGJhciBmcm9tIFwiLi4vLi4vc3RydWN0dXJlcy9BdXRvSGlkZVNjcm9sbGJhclwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCB7IG1lZGlhRnJvbU14YyB9IGZyb20gXCIuLi8uLi8uLi9jdXN0b21pc2F0aW9ucy9NZWRpYVwiO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLmdyb3Vwcy5Hcm91cFJvb21JbmZvXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHcm91cFJvb21JbmZvIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBzdGF0aWMgY29udGV4dFR5cGUgPSBNYXRyaXhDbGllbnRDb250ZXh0O1xuXG4gICAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAgICAgZ3JvdXBJZDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgZ3JvdXBSb29tSWQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgfTtcblxuICAgIHN0YXRlID0ge1xuICAgICAgICBpc1VzZXJQcml2aWxlZ2VkSW5Hcm91cDogbnVsbCxcbiAgICAgICAgZ3JvdXBSb29tOiBudWxsLFxuICAgICAgICBncm91cFJvb21QdWJsaWNpdHlMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZ3JvdXBSb29tUmVtb3ZlTG9hZGluZzogZmFsc2UsXG4gICAgfTtcblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB0aGlzLl9pbml0R3JvdXBTdG9yZSh0aGlzLnByb3BzLmdyb3VwSWQpO1xuICAgIH1cblxuICAgIC8vIFRPRE86IFtSRUFDVC1XQVJOSU5HXSBSZXBsYWNlIHdpdGggYXBwcm9wcmlhdGUgbGlmZWN5Y2xlIGV2ZW50XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5ld1Byb3BzKSB7XG4gICAgICAgIGlmIChuZXdQcm9wcy5ncm91cElkICE9PSB0aGlzLnByb3BzLmdyb3VwSWQpIHtcbiAgICAgICAgICAgIHRoaXMuX3VucmVnaXN0ZXJHcm91cFN0b3JlKHRoaXMucHJvcHMuZ3JvdXBJZCk7XG4gICAgICAgICAgICB0aGlzLl9pbml0R3JvdXBTdG9yZShuZXdQcm9wcy5ncm91cElkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB0aGlzLl91bnJlZ2lzdGVyR3JvdXBTdG9yZSh0aGlzLnByb3BzLmdyb3VwSWQpO1xuICAgIH1cblxuICAgIF9pbml0R3JvdXBTdG9yZShncm91cElkKSB7XG4gICAgICAgIEdyb3VwU3RvcmUucmVnaXN0ZXJMaXN0ZW5lcihncm91cElkLCB0aGlzLm9uR3JvdXBTdG9yZVVwZGF0ZWQpO1xuICAgIH1cblxuICAgIF91bnJlZ2lzdGVyR3JvdXBTdG9yZShncm91cElkKSB7XG4gICAgICAgIEdyb3VwU3RvcmUudW5yZWdpc3Rlckxpc3RlbmVyKHRoaXMub25Hcm91cFN0b3JlVXBkYXRlZCk7XG4gICAgfVxuXG4gICAgX3VwZGF0ZUdyb3VwUm9vbSgpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBncm91cFJvb206IEdyb3VwU3RvcmUuZ2V0R3JvdXBSb29tcyh0aGlzLnByb3BzLmdyb3VwSWQpLmZpbmQoXG4gICAgICAgICAgICAgICAgKHIpID0+IHIucm9vbUlkID09PSB0aGlzLnByb3BzLmdyb3VwUm9vbUlkLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25Hcm91cFN0b3JlVXBkYXRlZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBpc1VzZXJQcml2aWxlZ2VkSW5Hcm91cDogR3JvdXBTdG9yZS5pc1VzZXJQcml2aWxlZ2VkKHRoaXMucHJvcHMuZ3JvdXBJZCksXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl91cGRhdGVHcm91cFJvb20oKTtcbiAgICB9O1xuXG4gICAgX29uUmVtb3ZlID0gZSA9PiB7XG4gICAgICAgIGNvbnN0IGdyb3VwSWQgPSB0aGlzLnByb3BzLmdyb3VwSWQ7XG4gICAgICAgIGNvbnN0IHJvb21OYW1lID0gdGhpcy5zdGF0ZS5ncm91cFJvb20uZGlzcGxheW5hbWU7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc3QgUXVlc3Rpb25EaWFsb2cgPSBzZGsuZ2V0Q29tcG9uZW50KFwiZGlhbG9ncy5RdWVzdGlvbkRpYWxvZ1wiKTtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnQ29uZmlybSByZW1vdmFsIG9mIGdyb3VwIGZyb20gcm9vbScsICcnLCBRdWVzdGlvbkRpYWxvZywge1xuICAgICAgICAgICAgdGl0bGU6IF90KFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHJlbW92ZSAnJShyb29tTmFtZSlzJyBmcm9tICUoZ3JvdXBJZClzP1wiLCB7IHJvb21OYW1lLCBncm91cElkIH0pLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KFwiUmVtb3ZpbmcgYSByb29tIGZyb20gdGhlIGNvbW11bml0eSB3aWxsIGFsc28gcmVtb3ZlIGl0IGZyb20gdGhlIGNvbW11bml0eSBwYWdlLlwiKSxcbiAgICAgICAgICAgIGJ1dHRvbjogX3QoXCJSZW1vdmVcIiksXG4gICAgICAgICAgICBvbkZpbmlzaGVkOiAocHJvY2VlZCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghcHJvY2VlZCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBncm91cFJvb21SZW1vdmVMb2FkaW5nOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwSWQgPSB0aGlzLnByb3BzLmdyb3VwSWQ7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vbUlkID0gdGhpcy5wcm9wcy5ncm91cFJvb21JZDtcbiAgICAgICAgICAgICAgICBHcm91cFN0b3JlLnJlbW92ZVJvb21Gcm9tR3JvdXAodGhpcy5wcm9wcy5ncm91cElkLCByb29tSWQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBcInZpZXdfZ3JvdXBfcm9vbV9saXN0XCIsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciB3aGlsc3QgcmVtb3ZpbmcgJHtyb29tSWR9IGZyb20gJHtncm91cElkfWAsIGVycik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IEVycm9yRGlhbG9nID0gc2RrLmdldENvbXBvbmVudChcImRpYWxvZ3MuRXJyb3JEaWFsb2dcIik7XG4gICAgICAgICAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0ZhaWxlZCB0byByZW1vdmUgcm9vbSBmcm9tIGdyb3VwJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogX3QoXCJGYWlsZWQgdG8gcmVtb3ZlIHJvb20gZnJvbSBjb21tdW5pdHlcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJGYWlsZWQgdG8gcmVtb3ZlICclKHJvb21OYW1lKXMnIGZyb20gJShncm91cElkKXNcIiwgeyBncm91cElkLCByb29tTmFtZSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBncm91cFJvb21SZW1vdmVMb2FkaW5nOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBfb25DYW5jZWwgPSBlID0+IHtcbiAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJ2aWV3X2dyb3VwX3Jvb21fbGlzdFwiLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgX2NoYW5nZUdyb3VwUm9vbVB1YmxpY2l0eSA9IGUgPT4ge1xuICAgICAgICBjb25zdCBpc1B1YmxpYyA9IGUudGFyZ2V0LnZhbHVlID09PSBcInB1YmxpY1wiO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGdyb3VwUm9vbVB1YmxpY2l0eUxvYWRpbmc6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBncm91cElkID0gdGhpcy5wcm9wcy5ncm91cElkO1xuICAgICAgICBjb25zdCByb29tSWQgPSB0aGlzLnByb3BzLmdyb3VwUm9vbUlkO1xuICAgICAgICBjb25zdCByb29tTmFtZSA9IHRoaXMuc3RhdGUuZ3JvdXBSb29tLmRpc3BsYXluYW1lO1xuICAgICAgICBHcm91cFN0b3JlLnVwZGF0ZUdyb3VwUm9vbVZpc2liaWxpdHkodGhpcy5wcm9wcy5ncm91cElkLCByb29tSWQsIGlzUHVibGljKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIHdoaWxzdCBjaGFuZ2luZyB2aXNpYmlsaXR5IG9mICR7cm9vbUlkfSBpbiAke2dyb3VwSWR9IHRvICR7aXNQdWJsaWN9YCwgZXJyKTtcbiAgICAgICAgICAgIGNvbnN0IEVycm9yRGlhbG9nID0gc2RrLmdldENvbXBvbmVudChcImRpYWxvZ3MuRXJyb3JEaWFsb2dcIik7XG4gICAgICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdGYWlsZWQgdG8gcmVtb3ZlIHJvb20gZnJvbSBncm91cCcsICcnLCBFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBfdChcIlNvbWV0aGluZyB3ZW50IHdyb25nIVwiKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiVGhlIHZpc2liaWxpdHkgb2YgJyUocm9vbU5hbWUpcycgaW4gJShncm91cElkKXMgY291bGQgbm90IGJlIHVwZGF0ZWQuXCIsXG4gICAgICAgICAgICAgICAgICAgIHsgcm9vbU5hbWUsIGdyb3VwSWQgfSxcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgZ3JvdXBSb29tUHVibGljaXR5TG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgQWNjZXNzaWJsZUJ1dHRvbiA9IHNkay5nZXRDb21wb25lbnQoJ2VsZW1lbnRzLkFjY2Vzc2libGVCdXR0b24nKTtcbiAgICAgICAgY29uc3QgSW5saW5lU3Bpbm5lciA9IHNkay5nZXRDb21wb25lbnQoJ2VsZW1lbnRzLklubGluZVNwaW5uZXInKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuZ3JvdXBSb29tUmVtb3ZlTG9hZGluZyB8fCAhdGhpcy5zdGF0ZS5ncm91cFJvb20pIHtcbiAgICAgICAgICAgIGNvbnN0IFNwaW5uZXIgPSBzZGsuZ2V0Q29tcG9uZW50KFwiZWxlbWVudHMuU3Bpbm5lclwiKTtcbiAgICAgICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9cIj5cbiAgICAgICAgICAgICAgICA8U3Bpbm5lciAvPlxuICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGFkbWluVG9vbHM7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmlzVXNlclByaXZpbGVnZWRJbkdyb3VwKSB7XG4gICAgICAgICAgICBhZG1pblRvb2xzID1cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fYWRtaW5Ub29sc1wiPlxuICAgICAgICAgICAgICAgICAgICA8aDM+eyBfdChcIkFkbWluIFRvb2xzXCIpIH08L2gzPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fYnV0dG9uc1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19maWVsZFwiIG9uQ2xpY2s9e3RoaXMuX29uUmVtb3ZlfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KCdSZW1vdmUgZnJvbSBjb21tdW5pdHknKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8aDM+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KCdWaXNpYmlsaXR5IGluIFJvb20gTGlzdCcpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS5ncm91cFJvb21QdWJsaWNpdHlMb2FkaW5nID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW5saW5lU3Bpbm5lciAvPiA6IDxkaXYgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgPC9oMz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9XCJwdWJsaWNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXt0aGlzLnN0YXRlLmdyb3VwUm9vbS5pc1B1YmxpY31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuX2NoYW5nZUdyb3VwUm9vbVB1YmxpY2l0eX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19sYWJlbF90ZXh0XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoJ1Zpc2libGUgdG8gZXZlcnlvbmUnKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9XCJwcml2YXRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17IXRoaXMuc3RhdGUuZ3JvdXBSb29tLmlzUHVibGljfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5fY2hhbmdlR3JvdXBSb29tUHVibGljaXR5fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZW1iZXJJbmZvX2xhYmVsX3RleHRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdCgnT25seSB2aXNpYmxlIHRvIGNvbW11bml0eSBtZW1iZXJzJykgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyVXJsID0gdGhpcy5zdGF0ZS5ncm91cFJvb20uYXZhdGFyVXJsO1xuICAgICAgICBsZXQgYXZhdGFyRWxlbWVudDtcbiAgICAgICAgaWYgKGF2YXRhclVybCkge1xuICAgICAgICAgICAgY29uc3QgaHR0cFVybCA9IG1lZGlhRnJvbU14YyhhdmF0YXJVcmwpLmdldFNxdWFyZVRodW1ibmFpbEh0dHAoODAwKTtcbiAgICAgICAgICAgIGF2YXRhckVsZW1lbnQgPSA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fYXZhdGFyXCI+PGltZyBzcmM9e2h0dHBVcmx9IC8+PC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZ3JvdXBSb29tTmFtZSA9IHRoaXMuc3RhdGUuZ3JvdXBSb29tLmRpc3BsYXluYW1lO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZW1iZXJJbmZvXCIgcm9sZT1cInRhYnBhbmVsXCI+XG4gICAgICAgICAgICAgICAgPEF1dG9IaWRlU2Nyb2xsYmFyPlxuICAgICAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9XCJteF9NZW1iZXJJbmZvX2NhbmNlbFwiIG9uQ2xpY2s9e3RoaXMuX29uQ2FuY2VsfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbWcgc3JjPXtyZXF1aXJlKFwiLi4vLi4vLi4vLi4vcmVzL2ltZy9jYW5jZWwuc3ZnXCIpfSB3aWR0aD1cIjE4XCIgaGVpZ2h0PVwiMThcIiBjbGFzc05hbWU9XCJteF9maWx0ZXJGbGlwQ29sb3JcIiAvPlxuICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIHsgYXZhdGFyRWxlbWVudCB9XG5cbiAgICAgICAgICAgICAgICAgICAgPGgyPnsgZ3JvdXBSb29tTmFtZSB9PC9oMj5cblxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fcHJvZmlsZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZW1iZXJJbmZvX3Byb2ZpbGVGaWVsZFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS5ncm91cFJvb20uY2Fub25pY2FsQWxpYXMgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgIHsgYWRtaW5Ub29scyB9XG4gICAgICAgICAgICAgICAgPC9BdXRvSGlkZVNjcm9sbGJhcj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==