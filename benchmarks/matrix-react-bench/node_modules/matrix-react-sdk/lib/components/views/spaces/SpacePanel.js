"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _reactBeautifulDnd = require("react-beautiful-dnd");

var _classnames = _interopRequireDefault(require("classnames"));

var _languageHandler = require("../../../languageHandler");

var _ContextMenu = require("../../structures/ContextMenu");

var _SpaceCreateMenu = _interopRequireDefault(require("./SpaceCreateMenu"));

var _SpaceTreeLevel = require("./SpaceTreeLevel");

var _AccessibleTooltipButton = _interopRequireDefault(require("../elements/AccessibleTooltipButton"));

var _useEventEmitter = require("../../../hooks/useEventEmitter");

var _SpaceStore = _interopRequireDefault(require("../../../stores/spaces/SpaceStore"));

var _spaces = require("../../../stores/spaces");

var _AutoHideScrollbar = _interopRequireDefault(require("../../structures/AutoHideScrollbar"));

var _RovingTabIndex = require("../../../accessibility/RovingTabIndex");

var _RoomNotificationStateStore = require("../../../stores/notifications/RoomNotificationStateStore");

var _IconizedContextMenu = _interopRequireWildcard(require("../context_menus/IconizedContextMenu"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _SettingLevel = require("../../../settings/SettingLevel");

var _UIStore = _interopRequireDefault(require("../../../stores/UIStore"));

var _QuickSettingsButton = _interopRequireDefault(require("./QuickSettingsButton"));

var _useSettings = require("../../../hooks/useSettings");

const _excluded = ["onFinished"],
      _excluded2 = ["selected", "isPanelCollapsed"];

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const useSpaces = () => {
  const invites = (0, _useEventEmitter.useEventEmitterState)(_SpaceStore.default.instance, _spaces.UPDATE_INVITED_SPACES, () => {
    return _SpaceStore.default.instance.invitedSpaces;
  });
  const [metaSpaces, actualSpaces] = (0, _useEventEmitter.useEventEmitterState)(_SpaceStore.default.instance, _spaces.UPDATE_TOP_LEVEL_SPACES, () => [_SpaceStore.default.instance.enabledMetaSpaces, _SpaceStore.default.instance.spacePanelSpaces]);
  const activeSpace = (0, _useEventEmitter.useEventEmitterState)(_SpaceStore.default.instance, _spaces.UPDATE_SELECTED_SPACE, () => {
    return _SpaceStore.default.instance.activeSpace;
  });
  return [invites, metaSpaces, actualSpaces, activeSpace];
};

const HomeButtonContextMenu = _ref => {
  let {
    onFinished
  } = _ref,
      props = (0, _objectWithoutProperties2.default)(_ref, _excluded);
  const allRoomsInHome = (0, _useEventEmitter.useEventEmitterState)(_SpaceStore.default.instance, _spaces.UPDATE_HOME_BEHAVIOUR, () => {
    return _SpaceStore.default.instance.allRoomsInHome;
  });
  return /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.default, (0, _extends2.default)({}, props, {
    onFinished: onFinished,
    className: "mx_SpacePanel_contextMenu",
    compact: true
  }), /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SpacePanel_contextMenu_header"
  }, (0, _languageHandler._t)("Home")), /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOptionList, {
    first: true
  }, /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuCheckbox, {
    iconClassName: "mx_SpacePanel_noIcon",
    label: (0, _languageHandler._t)("Show all rooms"),
    active: allRoomsInHome,
    onClick: () => {
      _SettingsStore.default.setValue("Spaces.allRoomsInHome", null, _SettingLevel.SettingLevel.ACCOUNT, !allRoomsInHome);
    }
  })));
};

const MetaSpaceButton = _ref2 => {
  let {
    selected,
    isPanelCollapsed
  } = _ref2,
      props = (0, _objectWithoutProperties2.default)(_ref2, _excluded2);
  return /*#__PURE__*/_react.default.createElement("li", {
    className: (0, _classnames.default)("mx_SpaceItem", {
      "collapsed": isPanelCollapsed
    }),
    role: "treeitem"
  }, /*#__PURE__*/_react.default.createElement(_SpaceTreeLevel.SpaceButton, (0, _extends2.default)({}, props, {
    selected: selected,
    isNarrow: isPanelCollapsed
  })));
};

const HomeButton = ({
  selected,
  isPanelCollapsed
}) => {
  const allRoomsInHome = (0, _useEventEmitter.useEventEmitterState)(_SpaceStore.default.instance, _spaces.UPDATE_HOME_BEHAVIOUR, () => {
    return _SpaceStore.default.instance.allRoomsInHome;
  });
  return /*#__PURE__*/_react.default.createElement(MetaSpaceButton, {
    spaceKey: _spaces.MetaSpace.Home,
    className: "mx_SpaceButton_home",
    selected: selected,
    isPanelCollapsed: isPanelCollapsed,
    label: allRoomsInHome ? (0, _languageHandler._t)("All rooms") : (0, _languageHandler._t)("Home"),
    notificationState: allRoomsInHome ? _RoomNotificationStateStore.RoomNotificationStateStore.instance.globalState : _SpaceStore.default.instance.getNotificationState(_spaces.MetaSpace.Home),
    ContextMenuComponent: HomeButtonContextMenu,
    contextMenuTooltip: (0, _languageHandler._t)("Options")
  });
};

const FavouritesButton = ({
  selected,
  isPanelCollapsed
}) => {
  return /*#__PURE__*/_react.default.createElement(MetaSpaceButton, {
    spaceKey: _spaces.MetaSpace.Favourites,
    className: "mx_SpaceButton_favourites",
    selected: selected,
    isPanelCollapsed: isPanelCollapsed,
    label: (0, _languageHandler._t)("Favourites"),
    notificationState: _SpaceStore.default.instance.getNotificationState(_spaces.MetaSpace.Favourites)
  });
};

const PeopleButton = ({
  selected,
  isPanelCollapsed
}) => {
  return /*#__PURE__*/_react.default.createElement(MetaSpaceButton, {
    spaceKey: _spaces.MetaSpace.People,
    className: "mx_SpaceButton_people",
    selected: selected,
    isPanelCollapsed: isPanelCollapsed,
    label: (0, _languageHandler._t)("People"),
    notificationState: _SpaceStore.default.instance.getNotificationState(_spaces.MetaSpace.People)
  });
};

const OrphansButton = ({
  selected,
  isPanelCollapsed
}) => {
  return /*#__PURE__*/_react.default.createElement(MetaSpaceButton, {
    spaceKey: _spaces.MetaSpace.Orphans,
    className: "mx_SpaceButton_orphans",
    selected: selected,
    isPanelCollapsed: isPanelCollapsed,
    label: (0, _languageHandler._t)("Other rooms"),
    notificationState: _SpaceStore.default.instance.getNotificationState(_spaces.MetaSpace.Orphans)
  });
};

const CreateSpaceButton = ({
  isPanelCollapsed,
  setPanelCollapsed
}) => {
  // We don't need the handle as we position the menu in a constant location
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const [menuDisplayed, handle, openMenu, closeMenu] = (0, _ContextMenu.useContextMenu)();
  (0, _react.useEffect)(() => {
    if (!isPanelCollapsed && menuDisplayed) {
      closeMenu();
    }
  }, [isPanelCollapsed]); // eslint-disable-line react-hooks/exhaustive-deps

  let contextMenu = null;

  if (menuDisplayed) {
    contextMenu = /*#__PURE__*/_react.default.createElement(_SpaceCreateMenu.default, {
      onFinished: closeMenu
    });
  }

  const onNewClick = menuDisplayed ? closeMenu : () => {
    // persist that the user has interacted with this, use it to dismiss the beta dot
    localStorage.setItem("mx_seenSpaces", "1");
    if (!isPanelCollapsed) setPanelCollapsed(true);
    openMenu();
  };
  let betaDot;

  if (!localStorage.getItem("mx_seenSpaces") && !_SpaceStore.default.instance.spacePanelSpaces.length) {
    betaDot = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_BetaDot"
    });
  }

  return /*#__PURE__*/_react.default.createElement("li", {
    className: (0, _classnames.default)("mx_SpaceItem mx_SpaceItem_new", {
      "collapsed": isPanelCollapsed
    }),
    role: "treeitem"
  }, /*#__PURE__*/_react.default.createElement(_SpaceTreeLevel.SpaceButton, {
    className: (0, _classnames.default)("mx_SpaceButton_new", {
      mx_SpaceButton_newCancel: menuDisplayed
    }),
    label: menuDisplayed ? (0, _languageHandler._t)("Cancel") : (0, _languageHandler._t)("Create a space"),
    onClick: onNewClick,
    isNarrow: isPanelCollapsed
  }), betaDot, contextMenu);
};

const metaSpaceComponentMap = {
  [_spaces.MetaSpace.Home]: HomeButton,
  [_spaces.MetaSpace.Favourites]: FavouritesButton,
  [_spaces.MetaSpace.People]: PeopleButton,
  [_spaces.MetaSpace.Orphans]: OrphansButton
}; // Optimisation based on https://github.com/atlassian/react-beautiful-dnd/blob/master/docs/api/droppable.md#recommended-droppable--performance-optimisation

const InnerSpacePanel = /*#__PURE__*/_react.default.memo(({
  children,
  isPanelCollapsed,
  setPanelCollapsed
}) => {
  const [invites, metaSpaces, actualSpaces, activeSpace] = useSpaces();
  const activeSpaces = activeSpace ? [activeSpace] : [];
  const metaSpacesSection = metaSpaces.map(key => {
    const Component = metaSpaceComponentMap[key];
    return /*#__PURE__*/_react.default.createElement(Component, {
      key: key,
      selected: activeSpace === key,
      isPanelCollapsed: isPanelCollapsed
    });
  });
  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SpaceTreeLevel"
  }, metaSpacesSection, invites.map(s => /*#__PURE__*/_react.default.createElement(_SpaceTreeLevel.SpaceItem, {
    key: s.roomId,
    space: s,
    activeSpaces: activeSpaces,
    isPanelCollapsed: isPanelCollapsed,
    onExpand: () => setPanelCollapsed(false)
  })), actualSpaces.map((s, i) => /*#__PURE__*/_react.default.createElement(_reactBeautifulDnd.Draggable, {
    key: s.roomId,
    draggableId: s.roomId,
    index: i
  }, (provided, snapshot) => /*#__PURE__*/_react.default.createElement(_SpaceTreeLevel.SpaceItem, (0, _extends2.default)({}, provided.draggableProps, {
    dragHandleProps: provided.dragHandleProps,
    key: s.roomId,
    innerRef: provided.innerRef,
    className: snapshot.isDragging ? "mx_SpaceItem_dragging" : undefined,
    space: s,
    activeSpaces: activeSpaces,
    isPanelCollapsed: isPanelCollapsed,
    onExpand: () => setPanelCollapsed(false)
  })))), children, /*#__PURE__*/_react.default.createElement(CreateSpaceButton, {
    isPanelCollapsed: isPanelCollapsed,
    setPanelCollapsed: setPanelCollapsed
  }));
});

const SpacePanel = () => {
  const metaSpacesEnabled = (0, _useSettings.useSettingValue)("feature_spaces_metaspaces");
  const [isPanelCollapsed, setPanelCollapsed] = (0, _react.useState)(true);
  const ref = (0, _react.useRef)();
  (0, _react.useLayoutEffect)(() => {
    _UIStore.default.instance.trackElementDimensions("SpacePanel", ref.current);

    return () => _UIStore.default.instance.stopTrackingElementDimensions("SpacePanel");
  }, []);
  return /*#__PURE__*/_react.default.createElement(_reactBeautifulDnd.DragDropContext, {
    onDragEnd: result => {
      if (!result.destination) return; // dropped outside the list

      _SpaceStore.default.instance.moveRootSpace(result.source.index, result.destination.index);
    }
  }, /*#__PURE__*/_react.default.createElement(_RovingTabIndex.RovingTabIndexProvider, {
    handleHomeEnd: true,
    handleUpDown: true
  }, ({
    onKeyDownHandler
  }) => /*#__PURE__*/_react.default.createElement("ul", {
    className: (0, _classnames.default)("mx_SpacePanel", {
      collapsed: isPanelCollapsed
    }),
    onKeyDown: onKeyDownHandler,
    role: "tree",
    "aria-label": (0, _languageHandler._t)("Spaces"),
    ref: ref
  }, /*#__PURE__*/_react.default.createElement(_reactBeautifulDnd.Droppable, {
    droppableId: "top-level-spaces"
  }, (provided, snapshot) => /*#__PURE__*/_react.default.createElement(_AutoHideScrollbar.default, (0, _extends2.default)({}, provided.droppableProps, {
    wrappedRef: provided.innerRef,
    className: "mx_SpacePanel_spaceTreeWrapper",
    style: snapshot.isDraggingOver ? {
      pointerEvents: "none"
    } : undefined
  }), /*#__PURE__*/_react.default.createElement(InnerSpacePanel, {
    isPanelCollapsed: isPanelCollapsed,
    setPanelCollapsed: setPanelCollapsed
  }, provided.placeholder))), /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
    className: (0, _classnames.default)("mx_SpacePanel_toggleCollapse", {
      expanded: !isPanelCollapsed
    }),
    onClick: () => setPanelCollapsed(!isPanelCollapsed),
    title: isPanelCollapsed ? (0, _languageHandler._t)("Expand space panel") : (0, _languageHandler._t)("Collapse space panel"),
    forceHide: !isPanelCollapsed
  }, !isPanelCollapsed ? (0, _languageHandler._t)("Collapse") : null), metaSpacesEnabled && /*#__PURE__*/_react.default.createElement(_QuickSettingsButton.default, {
    isPanelCollapsed: isPanelCollapsed
  }))));
};

var _default = SpacePanel;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NwYWNlcy9TcGFjZVBhbmVsLnRzeCJdLCJuYW1lcyI6WyJ1c2VTcGFjZXMiLCJpbnZpdGVzIiwiU3BhY2VTdG9yZSIsImluc3RhbmNlIiwiVVBEQVRFX0lOVklURURfU1BBQ0VTIiwiaW52aXRlZFNwYWNlcyIsIm1ldGFTcGFjZXMiLCJhY3R1YWxTcGFjZXMiLCJVUERBVEVfVE9QX0xFVkVMX1NQQUNFUyIsImVuYWJsZWRNZXRhU3BhY2VzIiwic3BhY2VQYW5lbFNwYWNlcyIsImFjdGl2ZVNwYWNlIiwiVVBEQVRFX1NFTEVDVEVEX1NQQUNFIiwiSG9tZUJ1dHRvbkNvbnRleHRNZW51Iiwib25GaW5pc2hlZCIsInByb3BzIiwiYWxsUm9vbXNJbkhvbWUiLCJVUERBVEVfSE9NRV9CRUhBVklPVVIiLCJTZXR0aW5nc1N0b3JlIiwic2V0VmFsdWUiLCJTZXR0aW5nTGV2ZWwiLCJBQ0NPVU5UIiwiTWV0YVNwYWNlQnV0dG9uIiwic2VsZWN0ZWQiLCJpc1BhbmVsQ29sbGFwc2VkIiwiSG9tZUJ1dHRvbiIsIk1ldGFTcGFjZSIsIkhvbWUiLCJSb29tTm90aWZpY2F0aW9uU3RhdGVTdG9yZSIsImdsb2JhbFN0YXRlIiwiZ2V0Tm90aWZpY2F0aW9uU3RhdGUiLCJGYXZvdXJpdGVzQnV0dG9uIiwiRmF2b3VyaXRlcyIsIlBlb3BsZUJ1dHRvbiIsIlBlb3BsZSIsIk9ycGhhbnNCdXR0b24iLCJPcnBoYW5zIiwiQ3JlYXRlU3BhY2VCdXR0b24iLCJzZXRQYW5lbENvbGxhcHNlZCIsIm1lbnVEaXNwbGF5ZWQiLCJoYW5kbGUiLCJvcGVuTWVudSIsImNsb3NlTWVudSIsImNvbnRleHRNZW51Iiwib25OZXdDbGljayIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJiZXRhRG90IiwiZ2V0SXRlbSIsImxlbmd0aCIsIm14X1NwYWNlQnV0dG9uX25ld0NhbmNlbCIsIm1ldGFTcGFjZUNvbXBvbmVudE1hcCIsIklubmVyU3BhY2VQYW5lbCIsIlJlYWN0IiwibWVtbyIsImNoaWxkcmVuIiwiYWN0aXZlU3BhY2VzIiwibWV0YVNwYWNlc1NlY3Rpb24iLCJtYXAiLCJrZXkiLCJDb21wb25lbnQiLCJzIiwicm9vbUlkIiwiaSIsInByb3ZpZGVkIiwic25hcHNob3QiLCJkcmFnZ2FibGVQcm9wcyIsImRyYWdIYW5kbGVQcm9wcyIsImlubmVyUmVmIiwiaXNEcmFnZ2luZyIsInVuZGVmaW5lZCIsIlNwYWNlUGFuZWwiLCJtZXRhU3BhY2VzRW5hYmxlZCIsInJlZiIsIlVJU3RvcmUiLCJ0cmFja0VsZW1lbnREaW1lbnNpb25zIiwiY3VycmVudCIsInN0b3BUcmFja2luZ0VsZW1lbnREaW1lbnNpb25zIiwicmVzdWx0IiwiZGVzdGluYXRpb24iLCJtb3ZlUm9vdFNwYWNlIiwic291cmNlIiwiaW5kZXgiLCJvbktleURvd25IYW5kbGVyIiwiY29sbGFwc2VkIiwiZHJvcHBhYmxlUHJvcHMiLCJpc0RyYWdnaW5nT3ZlciIsInBvaW50ZXJFdmVudHMiLCJwbGFjZWhvbGRlciIsImV4cGFuZGVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBZ0JBOztBQVVBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQVFBOztBQUNBOztBQUNBOztBQUVBOztBQUlBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7QUFFQSxNQUFNQSxTQUFTLEdBQUcsTUFBK0M7QUFDN0QsUUFBTUMsT0FBTyxHQUFHLDJDQUE2QkMsb0JBQVdDLFFBQXhDLEVBQWtEQyw2QkFBbEQsRUFBeUUsTUFBTTtBQUMzRixXQUFPRixvQkFBV0MsUUFBWCxDQUFvQkUsYUFBM0I7QUFDSCxHQUZlLENBQWhCO0FBR0EsUUFBTSxDQUFDQyxVQUFELEVBQWFDLFlBQWIsSUFBNkIsMkNBQy9CTCxvQkFBV0MsUUFEb0IsRUFDVkssK0JBRFUsRUFFL0IsTUFBTSxDQUNGTixvQkFBV0MsUUFBWCxDQUFvQk0saUJBRGxC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QkosRUFrQ01nRCxpQkFBaUIsaUJBQUksNkJBQUMsNEJBQUQ7QUFBcUIsSUFBQSxnQkFBZ0IsRUFBRWhEO0FBQXZDLElBbEMzQixDQUZSLENBSkosQ0FESjtBQStDSCxDQXhERDs7ZUEwRGUrQyxVIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7XG4gICAgQ29tcG9uZW50UHJvcHMsXG4gICAgRGlzcGF0Y2gsXG4gICAgUmVhY3ROb2RlLFxuICAgIFNldFN0YXRlQWN0aW9uLFxuICAgIHVzZUVmZmVjdCxcbiAgICB1c2VMYXlvdXRFZmZlY3QsXG4gICAgdXNlUmVmLFxuICAgIHVzZVN0YXRlLFxufSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IERyYWdEcm9wQ29udGV4dCwgRHJhZ2dhYmxlLCBEcm9wcGFibGUgfSBmcm9tIFwicmVhY3QtYmVhdXRpZnVsLWRuZFwiO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSBcImNsYXNzbmFtZXNcIjtcbmltcG9ydCB7IFJvb20gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb21cIjtcblxuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgeyB1c2VDb250ZXh0TWVudSB9IGZyb20gXCIuLi8uLi9zdHJ1Y3R1cmVzL0NvbnRleHRNZW51XCI7XG5pbXBvcnQgU3BhY2VDcmVhdGVNZW51IGZyb20gXCIuL1NwYWNlQ3JlYXRlTWVudVwiO1xuaW1wb3J0IHsgU3BhY2VCdXR0b24sIFNwYWNlSXRlbSB9IGZyb20gXCIuL1NwYWNlVHJlZUxldmVsXCI7XG5pbXBvcnQgQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVUb29sdGlwQnV0dG9uXCI7XG5pbXBvcnQgeyB1c2VFdmVudEVtaXR0ZXJTdGF0ZSB9IGZyb20gXCIuLi8uLi8uLi9ob29rcy91c2VFdmVudEVtaXR0ZXJcIjtcbmltcG9ydCBTcGFjZVN0b3JlIGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvc3BhY2VzL1NwYWNlU3RvcmVcIjtcbmltcG9ydCB7XG4gICAgTWV0YVNwYWNlLFxuICAgIFNwYWNlS2V5LFxuICAgIFVQREFURV9IT01FX0JFSEFWSU9VUixcbiAgICBVUERBVEVfSU5WSVRFRF9TUEFDRVMsXG4gICAgVVBEQVRFX1NFTEVDVEVEX1NQQUNFLFxuICAgIFVQREFURV9UT1BfTEVWRUxfU1BBQ0VTLFxufSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL3NwYWNlc1wiO1xuaW1wb3J0IEF1dG9IaWRlU2Nyb2xsYmFyIGZyb20gXCIuLi8uLi9zdHJ1Y3R1cmVzL0F1dG9IaWRlU2Nyb2xsYmFyXCI7XG5pbXBvcnQgeyBSb3ZpbmdUYWJJbmRleFByb3ZpZGVyIH0gZnJvbSBcIi4uLy4uLy4uL2FjY2Vzc2liaWxpdHkvUm92aW5nVGFiSW5kZXhcIjtcbmltcG9ydCB7IFJvb21Ob3RpZmljYXRpb25TdGF0ZVN0b3JlIH0gZnJvbSBcIi4uLy4uLy4uL3N0b3Jlcy9ub3RpZmljYXRpb25zL1Jvb21Ob3RpZmljYXRpb25TdGF0ZVN0b3JlXCI7XG5pbXBvcnQgU3BhY2VDb250ZXh0TWVudSBmcm9tIFwiLi4vY29udGV4dF9tZW51cy9TcGFjZUNvbnRleHRNZW51XCI7XG5pbXBvcnQgSWNvbml6ZWRDb250ZXh0TWVudSwge1xuICAgIEljb25pemVkQ29udGV4dE1lbnVDaGVja2JveCxcbiAgICBJY29uaXplZENvbnRleHRNZW51T3B0aW9uTGlzdCxcbn0gZnJvbSBcIi4uL2NvbnRleHRfbWVudXMvSWNvbml6ZWRDb250ZXh0TWVudVwiO1xuaW1wb3J0IFNldHRpbmdzU3RvcmUgZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdzU3RvcmVcIjtcbmltcG9ydCB7IFNldHRpbmdMZXZlbCB9IGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nTGV2ZWxcIjtcbmltcG9ydCBVSVN0b3JlIGZyb20gXCIuLi8uLi8uLi9zdG9yZXMvVUlTdG9yZVwiO1xuaW1wb3J0IFF1aWNrU2V0dGluZ3NCdXR0b24gZnJvbSBcIi4vUXVpY2tTZXR0aW5nc0J1dHRvblwiO1xuaW1wb3J0IHsgdXNlU2V0dGluZ1ZhbHVlIH0gZnJvbSBcIi4uLy4uLy4uL2hvb2tzL3VzZVNldHRpbmdzXCI7XG5cbmNvbnN0IHVzZVNwYWNlcyA9ICgpOiBbUm9vbVtdLCBNZXRhU3BhY2VbXSwgUm9vbVtdLCBTcGFjZUtleV0gPT4ge1xuICAgIGNvbnN0IGludml0ZXMgPSB1c2VFdmVudEVtaXR0ZXJTdGF0ZTxSb29tW10+KFNwYWNlU3RvcmUuaW5zdGFuY2UsIFVQREFURV9JTlZJVEVEX1NQQUNFUywgKCkgPT4ge1xuICAgICAgICByZXR1cm4gU3BhY2VTdG9yZS5pbnN0YW5jZS5pbnZpdGVkU3BhY2VzO1xuICAgIH0pO1xuICAgIGNvbnN0IFttZXRhU3BhY2VzLCBhY3R1YWxTcGFjZXNdID0gdXNlRXZlbnRFbWl0dGVyU3RhdGU8W01ldGFTcGFjZVtdLCBSb29tW11dPihcbiAgICAgICAgU3BhY2VTdG9yZS5pbnN0YW5jZSwgVVBEQVRFX1RPUF9MRVZFTF9TUEFDRVMsXG4gICAgICAgICgpID0+IFtcbiAgICAgICAgICAgIFNwYWNlU3RvcmUuaW5zdGFuY2UuZW5hYmxlZE1ldGFTcGFjZXMsXG4gICAgICAgICAgICBTcGFjZVN0b3JlLmluc3RhbmNlLnNwYWNlUGFuZWxTcGFjZXMsXG4gICAgICAgIF0sXG4gICAgKTtcbiAgICBjb25zdCBhY3RpdmVTcGFjZSA9IHVzZUV2ZW50RW1pdHRlclN0YXRlPFNwYWNlS2V5PihTcGFjZVN0b3JlLmluc3RhbmNlLCBVUERBVEVfU0VMRUNURURfU1BBQ0UsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIFNwYWNlU3RvcmUuaW5zdGFuY2UuYWN0aXZlU3BhY2U7XG4gICAgfSk7XG4gICAgcmV0dXJuIFtpbnZpdGVzLCBtZXRhU3BhY2VzLCBhY3R1YWxTcGFjZXMsIGFjdGl2ZVNwYWNlXTtcbn07XG5cbmludGVyZmFjZSBJSW5uZXJTcGFjZVBhbmVsUHJvcHMge1xuICAgIGNoaWxkcmVuPzogUmVhY3ROb2RlO1xuICAgIGlzUGFuZWxDb2xsYXBzZWQ6IGJvb2xlYW47XG4gICAgc2V0UGFuZWxDb2xsYXBzZWQ6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPGJvb2xlYW4+Pjtcbn1cblxuY29uc3QgSG9tZUJ1dHRvbkNvbnRleHRNZW51ID0gKHsgb25GaW5pc2hlZCwgLi4ucHJvcHMgfTogQ29tcG9uZW50UHJvcHM8dHlwZW9mIFNwYWNlQ29udGV4dE1lbnU+KSA9PiB7XG4gICAgY29uc3QgYWxsUm9vbXNJbkhvbWUgPSB1c2VFdmVudEVtaXR0ZXJTdGF0ZShTcGFjZVN0b3JlLmluc3RhbmNlLCBVUERBVEVfSE9NRV9CRUhBVklPVVIsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIFNwYWNlU3RvcmUuaW5zdGFuY2UuYWxsUm9vbXNJbkhvbWU7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gPEljb25pemVkQ29udGV4dE1lbnVcbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICBvbkZpbmlzaGVkPXtvbkZpbmlzaGVkfVxuICAgICAgICBjbGFzc05hbWU9XCJteF9TcGFjZVBhbmVsX2NvbnRleHRNZW51XCJcbiAgICAgICAgY29tcGFjdFxuICAgID5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TcGFjZVBhbmVsX2NvbnRleHRNZW51X2hlYWRlclwiPlxuICAgICAgICAgICAgeyBfdChcIkhvbWVcIikgfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVPcHRpb25MaXN0IGZpcnN0PlxuICAgICAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVDaGVja2JveFxuICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU9XCJteF9TcGFjZVBhbmVsX25vSWNvblwiXG4gICAgICAgICAgICAgICAgbGFiZWw9e190KFwiU2hvdyBhbGwgcm9vbXNcIil9XG4gICAgICAgICAgICAgICAgYWN0aXZlPXthbGxSb29tc0luSG9tZX1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIFNldHRpbmdzU3RvcmUuc2V0VmFsdWUoXCJTcGFjZXMuYWxsUm9vbXNJbkhvbWVcIiwgbnVsbCwgU2V0dGluZ0xldmVsLkFDQ09VTlQsICFhbGxSb29tc0luSG9tZSk7XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgIDwvSWNvbml6ZWRDb250ZXh0TWVudU9wdGlvbkxpc3Q+XG4gICAgPC9JY29uaXplZENvbnRleHRNZW51Pjtcbn07XG5cbmludGVyZmFjZSBJTWV0YVNwYWNlQnV0dG9uUHJvcHMgZXh0ZW5kcyBDb21wb25lbnRQcm9wczx0eXBlb2YgU3BhY2VCdXR0b24+IHtcbiAgICBzZWxlY3RlZDogYm9vbGVhbjtcbiAgICBpc1BhbmVsQ29sbGFwc2VkOiBib29sZWFuO1xufVxuXG50eXBlIE1ldGFTcGFjZUJ1dHRvblByb3BzID0gUGljazxJTWV0YVNwYWNlQnV0dG9uUHJvcHMsIFwic2VsZWN0ZWRcIiB8IFwiaXNQYW5lbENvbGxhcHNlZFwiPjtcblxuY29uc3QgTWV0YVNwYWNlQnV0dG9uID0gKHsgc2VsZWN0ZWQsIGlzUGFuZWxDb2xsYXBzZWQsIC4uLnByb3BzIH06IElNZXRhU3BhY2VCdXR0b25Qcm9wcykgPT4ge1xuICAgIHJldHVybiA8bGlcbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfU3BhY2VJdGVtXCIsIHtcbiAgICAgICAgICAgIFwiY29sbGFwc2VkXCI6IGlzUGFuZWxDb2xsYXBzZWQsXG4gICAgICAgIH0pfVxuICAgICAgICByb2xlPVwidHJlZWl0ZW1cIlxuICAgID5cbiAgICAgICAgPFNwYWNlQnV0dG9uIHsuLi5wcm9wc30gc2VsZWN0ZWQ9e3NlbGVjdGVkfSBpc05hcnJvdz17aXNQYW5lbENvbGxhcHNlZH0gLz5cbiAgICA8L2xpPjtcbn07XG5cbmNvbnN0IEhvbWVCdXR0b24gPSAoeyBzZWxlY3RlZCwgaXNQYW5lbENvbGxhcHNlZCB9OiBNZXRhU3BhY2VCdXR0b25Qcm9wcykgPT4ge1xuICAgIGNvbnN0IGFsbFJvb21zSW5Ib21lID0gdXNlRXZlbnRFbWl0dGVyU3RhdGUoU3BhY2VTdG9yZS5pbnN0YW5jZSwgVVBEQVRFX0hPTUVfQkVIQVZJT1VSLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBTcGFjZVN0b3JlLmluc3RhbmNlLmFsbFJvb21zSW5Ib21lO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIDxNZXRhU3BhY2VCdXR0b25cbiAgICAgICAgc3BhY2VLZXk9e01ldGFTcGFjZS5Ib21lfVxuICAgICAgICBjbGFzc05hbWU9XCJteF9TcGFjZUJ1dHRvbl9ob21lXCJcbiAgICAgICAgc2VsZWN0ZWQ9e3NlbGVjdGVkfVxuICAgICAgICBpc1BhbmVsQ29sbGFwc2VkPXtpc1BhbmVsQ29sbGFwc2VkfVxuICAgICAgICBsYWJlbD17YWxsUm9vbXNJbkhvbWUgPyBfdChcIkFsbCByb29tc1wiKSA6IF90KFwiSG9tZVwiKX1cbiAgICAgICAgbm90aWZpY2F0aW9uU3RhdGU9e2FsbFJvb21zSW5Ib21lXG4gICAgICAgICAgICA/IFJvb21Ob3RpZmljYXRpb25TdGF0ZVN0b3JlLmluc3RhbmNlLmdsb2JhbFN0YXRlXG4gICAgICAgICAgICA6IFNwYWNlU3RvcmUuaW5zdGFuY2UuZ2V0Tm90aWZpY2F0aW9uU3RhdGUoTWV0YVNwYWNlLkhvbWUpfVxuICAgICAgICBDb250ZXh0TWVudUNvbXBvbmVudD17SG9tZUJ1dHRvbkNvbnRleHRNZW51fVxuICAgICAgICBjb250ZXh0TWVudVRvb2x0aXA9e190KFwiT3B0aW9uc1wiKX1cbiAgICAvPjtcbn07XG5cbmNvbnN0IEZhdm91cml0ZXNCdXR0b24gPSAoeyBzZWxlY3RlZCwgaXNQYW5lbENvbGxhcHNlZCB9OiBNZXRhU3BhY2VCdXR0b25Qcm9wcykgPT4ge1xuICAgIHJldHVybiA8TWV0YVNwYWNlQnV0dG9uXG4gICAgICAgIHNwYWNlS2V5PXtNZXRhU3BhY2UuRmF2b3VyaXRlc31cbiAgICAgICAgY2xhc3NOYW1lPVwibXhfU3BhY2VCdXR0b25fZmF2b3VyaXRlc1wiXG4gICAgICAgIHNlbGVjdGVkPXtzZWxlY3RlZH1cbiAgICAgICAgaXNQYW5lbENvbGxhcHNlZD17aXNQYW5lbENvbGxhcHNlZH1cbiAgICAgICAgbGFiZWw9e190KFwiRmF2b3VyaXRlc1wiKX1cbiAgICAgICAgbm90aWZpY2F0aW9uU3RhdGU9e1NwYWNlU3RvcmUuaW5zdGFuY2UuZ2V0Tm90aWZpY2F0aW9uU3RhdGUoTWV0YVNwYWNlLkZhdm91cml0ZXMpfVxuICAgIC8+O1xufTtcblxuY29uc3QgUGVvcGxlQnV0dG9uID0gKHsgc2VsZWN0ZWQsIGlzUGFuZWxDb2xsYXBzZWQgfTogTWV0YVNwYWNlQnV0dG9uUHJvcHMpID0+IHtcbiAgICByZXR1cm4gPE1ldGFTcGFjZUJ1dHRvblxuICAgICAgICBzcGFjZUtleT17TWV0YVNwYWNlLlBlb3BsZX1cbiAgICAgICAgY2xhc3NOYW1lPVwibXhfU3BhY2VCdXR0b25fcGVvcGxlXCJcbiAgICAgICAgc2VsZWN0ZWQ9e3NlbGVjdGVkfVxuICAgICAgICBpc1BhbmVsQ29sbGFwc2VkPXtpc1BhbmVsQ29sbGFwc2VkfVxuICAgICAgICBsYWJlbD17X3QoXCJQZW9wbGVcIil9XG4gICAgICAgIG5vdGlmaWNhdGlvblN0YXRlPXtTcGFjZVN0b3JlLmluc3RhbmNlLmdldE5vdGlmaWNhdGlvblN0YXRlKE1ldGFTcGFjZS5QZW9wbGUpfVxuICAgIC8+O1xufTtcblxuY29uc3QgT3JwaGFuc0J1dHRvbiA9ICh7IHNlbGVjdGVkLCBpc1BhbmVsQ29sbGFwc2VkIH06IE1ldGFTcGFjZUJ1dHRvblByb3BzKSA9PiB7XG4gICAgcmV0dXJuIDxNZXRhU3BhY2VCdXR0b25cbiAgICAgICAgc3BhY2VLZXk9e01ldGFTcGFjZS5PcnBoYW5zfVxuICAgICAgICBjbGFzc05hbWU9XCJteF9TcGFjZUJ1dHRvbl9vcnBoYW5zXCJcbiAgICAgICAgc2VsZWN0ZWQ9e3NlbGVjdGVkfVxuICAgICAgICBpc1BhbmVsQ29sbGFwc2VkPXtpc1BhbmVsQ29sbGFwc2VkfVxuICAgICAgICBsYWJlbD17X3QoXCJPdGhlciByb29tc1wiKX1cbiAgICAgICAgbm90aWZpY2F0aW9uU3RhdGU9e1NwYWNlU3RvcmUuaW5zdGFuY2UuZ2V0Tm90aWZpY2F0aW9uU3RhdGUoTWV0YVNwYWNlLk9ycGhhbnMpfVxuICAgIC8+O1xufTtcblxuY29uc3QgQ3JlYXRlU3BhY2VCdXR0b24gPSAoe1xuICAgIGlzUGFuZWxDb2xsYXBzZWQsXG4gICAgc2V0UGFuZWxDb2xsYXBzZWQsXG59OiBQaWNrPElJbm5lclNwYWNlUGFuZWxQcm9wcywgXCJpc1BhbmVsQ29sbGFwc2VkXCIgfCBcInNldFBhbmVsQ29sbGFwc2VkXCI+KSA9PiB7XG4gICAgLy8gV2UgZG9uJ3QgbmVlZCB0aGUgaGFuZGxlIGFzIHdlIHBvc2l0aW9uIHRoZSBtZW51IGluIGEgY29uc3RhbnQgbG9jYXRpb25cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgY29uc3QgW21lbnVEaXNwbGF5ZWQsIGhhbmRsZSwgb3Blbk1lbnUsIGNsb3NlTWVudV0gPSB1c2VDb250ZXh0TWVudTx2b2lkPigpO1xuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFpc1BhbmVsQ29sbGFwc2VkICYmIG1lbnVEaXNwbGF5ZWQpIHtcbiAgICAgICAgICAgIGNsb3NlTWVudSgpO1xuICAgICAgICB9XG4gICAgfSwgW2lzUGFuZWxDb2xsYXBzZWRdKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcblxuICAgIGxldCBjb250ZXh0TWVudSA9IG51bGw7XG4gICAgaWYgKG1lbnVEaXNwbGF5ZWQpIHtcbiAgICAgICAgY29udGV4dE1lbnUgPSA8U3BhY2VDcmVhdGVNZW51IG9uRmluaXNoZWQ9e2Nsb3NlTWVudX0gLz47XG4gICAgfVxuXG4gICAgY29uc3Qgb25OZXdDbGljayA9IG1lbnVEaXNwbGF5ZWQgPyBjbG9zZU1lbnUgOiAoKSA9PiB7XG4gICAgICAgIC8vIHBlcnNpc3QgdGhhdCB0aGUgdXNlciBoYXMgaW50ZXJhY3RlZCB3aXRoIHRoaXMsIHVzZSBpdCB0byBkaXNtaXNzIHRoZSBiZXRhIGRvdFxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIm14X3NlZW5TcGFjZXNcIiwgXCIxXCIpO1xuICAgICAgICBpZiAoIWlzUGFuZWxDb2xsYXBzZWQpIHNldFBhbmVsQ29sbGFwc2VkKHRydWUpO1xuICAgICAgICBvcGVuTWVudSgpO1xuICAgIH07XG5cbiAgICBsZXQgYmV0YURvdDogSlNYLkVsZW1lbnQ7XG4gICAgaWYgKCFsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIm14X3NlZW5TcGFjZXNcIikgJiYgIVNwYWNlU3RvcmUuaW5zdGFuY2Uuc3BhY2VQYW5lbFNwYWNlcy5sZW5ndGgpIHtcbiAgICAgICAgYmV0YURvdCA9IDxkaXYgY2xhc3NOYW1lPVwibXhfQmV0YURvdFwiIC8+O1xuICAgIH1cblxuICAgIHJldHVybiA8bGlcbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfU3BhY2VJdGVtIG14X1NwYWNlSXRlbV9uZXdcIiwge1xuICAgICAgICAgICAgXCJjb2xsYXBzZWRcIjogaXNQYW5lbENvbGxhcHNlZCxcbiAgICAgICAgfSl9XG4gICAgICAgIHJvbGU9XCJ0cmVlaXRlbVwiXG4gICAgPlxuICAgICAgICA8U3BhY2VCdXR0b25cbiAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcIm14X1NwYWNlQnV0dG9uX25ld1wiLCB7XG4gICAgICAgICAgICAgICAgbXhfU3BhY2VCdXR0b25fbmV3Q2FuY2VsOiBtZW51RGlzcGxheWVkLFxuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICBsYWJlbD17bWVudURpc3BsYXllZCA/IF90KFwiQ2FuY2VsXCIpIDogX3QoXCJDcmVhdGUgYSBzcGFjZVwiKX1cbiAgICAgICAgICAgIG9uQ2xpY2s9e29uTmV3Q2xpY2t9XG4gICAgICAgICAgICBpc05hcnJvdz17aXNQYW5lbENvbGxhcHNlZH1cbiAgICAgICAgLz5cbiAgICAgICAgeyBiZXRhRG90IH1cblxuICAgICAgICB7IGNvbnRleHRNZW51IH1cbiAgICA8L2xpPjtcbn07XG5cbmNvbnN0IG1ldGFTcGFjZUNvbXBvbmVudE1hcDogUmVjb3JkPE1ldGFTcGFjZSwgdHlwZW9mIEhvbWVCdXR0b24+ID0ge1xuICAgIFtNZXRhU3BhY2UuSG9tZV06IEhvbWVCdXR0b24sXG4gICAgW01ldGFTcGFjZS5GYXZvdXJpdGVzXTogRmF2b3VyaXRlc0J1dHRvbixcbiAgICBbTWV0YVNwYWNlLlBlb3BsZV06IFBlb3BsZUJ1dHRvbixcbiAgICBbTWV0YVNwYWNlLk9ycGhhbnNdOiBPcnBoYW5zQnV0dG9uLFxufTtcblxuLy8gT3B0aW1pc2F0aW9uIGJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9hdGxhc3NpYW4vcmVhY3QtYmVhdXRpZnVsLWRuZC9ibG9iL21hc3Rlci9kb2NzL2FwaS9kcm9wcGFibGUubWQjcmVjb21tZW5kZWQtZHJvcHBhYmxlLS1wZXJmb3JtYW5jZS1vcHRpbWlzYXRpb25cbmNvbnN0IElubmVyU3BhY2VQYW5lbCA9IFJlYWN0Lm1lbW88SUlubmVyU3BhY2VQYW5lbFByb3BzPigoeyBjaGlsZHJlbiwgaXNQYW5lbENvbGxhcHNlZCwgc2V0UGFuZWxDb2xsYXBzZWQgfSkgPT4ge1xuICAgIGNvbnN0IFtpbnZpdGVzLCBtZXRhU3BhY2VzLCBhY3R1YWxTcGFjZXMsIGFjdGl2ZVNwYWNlXSA9IHVzZVNwYWNlcygpO1xuICAgIGNvbnN0IGFjdGl2ZVNwYWNlcyA9IGFjdGl2ZVNwYWNlID8gW2FjdGl2ZVNwYWNlXSA6IFtdO1xuXG4gICAgY29uc3QgbWV0YVNwYWNlc1NlY3Rpb24gPSBtZXRhU3BhY2VzLm1hcChrZXkgPT4ge1xuICAgICAgICBjb25zdCBDb21wb25lbnQgPSBtZXRhU3BhY2VDb21wb25lbnRNYXBba2V5XTtcbiAgICAgICAgcmV0dXJuIDxDb21wb25lbnQga2V5PXtrZXl9IHNlbGVjdGVkPXthY3RpdmVTcGFjZSA9PT0ga2V5fSBpc1BhbmVsQ29sbGFwc2VkPXtpc1BhbmVsQ29sbGFwc2VkfSAvPjtcbiAgICB9KTtcblxuICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X1NwYWNlVHJlZUxldmVsXCI+XG4gICAgICAgIHsgbWV0YVNwYWNlc1NlY3Rpb24gfVxuICAgICAgICB7IGludml0ZXMubWFwKHMgPT4gKFxuICAgICAgICAgICAgPFNwYWNlSXRlbVxuICAgICAgICAgICAgICAgIGtleT17cy5yb29tSWR9XG4gICAgICAgICAgICAgICAgc3BhY2U9e3N9XG4gICAgICAgICAgICAgICAgYWN0aXZlU3BhY2VzPXthY3RpdmVTcGFjZXN9XG4gICAgICAgICAgICAgICAgaXNQYW5lbENvbGxhcHNlZD17aXNQYW5lbENvbGxhcHNlZH1cbiAgICAgICAgICAgICAgICBvbkV4cGFuZD17KCkgPT4gc2V0UGFuZWxDb2xsYXBzZWQoZmFsc2UpfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKSkgfVxuICAgICAgICB7IGFjdHVhbFNwYWNlcy5tYXAoKHMsIGkpID0+IChcbiAgICAgICAgICAgIDxEcmFnZ2FibGUga2V5PXtzLnJvb21JZH0gZHJhZ2dhYmxlSWQ9e3Mucm9vbUlkfSBpbmRleD17aX0+XG4gICAgICAgICAgICAgICAgeyAocHJvdmlkZWQsIHNuYXBzaG90KSA9PiAoXG4gICAgICAgICAgICAgICAgICAgIDxTcGFjZUl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsuLi5wcm92aWRlZC5kcmFnZ2FibGVQcm9wc31cbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdIYW5kbGVQcm9wcz17cHJvdmlkZWQuZHJhZ0hhbmRsZVByb3BzfVxuICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtzLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlubmVyUmVmPXtwcm92aWRlZC5pbm5lclJlZn1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17c25hcHNob3QuaXNEcmFnZ2luZyA/IFwibXhfU3BhY2VJdGVtX2RyYWdnaW5nXCIgOiB1bmRlZmluZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICBzcGFjZT17c31cbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVNwYWNlcz17YWN0aXZlU3BhY2VzfVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNQYW5lbENvbGxhcHNlZD17aXNQYW5lbENvbGxhcHNlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRXhwYW5kPXsoKSA9PiBzZXRQYW5lbENvbGxhcHNlZChmYWxzZSl9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICA8L0RyYWdnYWJsZT5cbiAgICAgICAgKSkgfVxuICAgICAgICB7IGNoaWxkcmVuIH1cbiAgICAgICAgPENyZWF0ZVNwYWNlQnV0dG9uIGlzUGFuZWxDb2xsYXBzZWQ9e2lzUGFuZWxDb2xsYXBzZWR9IHNldFBhbmVsQ29sbGFwc2VkPXtzZXRQYW5lbENvbGxhcHNlZH0gLz5cbiAgICA8L2Rpdj47XG59KTtcblxuY29uc3QgU3BhY2VQYW5lbCA9ICgpID0+IHtcbiAgICBjb25zdCBtZXRhU3BhY2VzRW5hYmxlZCA9IHVzZVNldHRpbmdWYWx1ZShcImZlYXR1cmVfc3BhY2VzX21ldGFzcGFjZXNcIik7XG4gICAgY29uc3QgW2lzUGFuZWxDb2xsYXBzZWQsIHNldFBhbmVsQ29sbGFwc2VkXSA9IHVzZVN0YXRlKHRydWUpO1xuICAgIGNvbnN0IHJlZiA9IHVzZVJlZjxIVE1MVUxpc3RFbGVtZW50PigpO1xuICAgIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgICAgIFVJU3RvcmUuaW5zdGFuY2UudHJhY2tFbGVtZW50RGltZW5zaW9ucyhcIlNwYWNlUGFuZWxcIiwgcmVmLmN1cnJlbnQpO1xuICAgICAgICByZXR1cm4gKCkgPT4gVUlTdG9yZS5pbnN0YW5jZS5zdG9wVHJhY2tpbmdFbGVtZW50RGltZW5zaW9ucyhcIlNwYWNlUGFuZWxcIik7XG4gICAgfSwgW10pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgICAgPERyYWdEcm9wQ29udGV4dCBvbkRyYWdFbmQ9e3Jlc3VsdCA9PiB7XG4gICAgICAgICAgICBpZiAoIXJlc3VsdC5kZXN0aW5hdGlvbikgcmV0dXJuOyAvLyBkcm9wcGVkIG91dHNpZGUgdGhlIGxpc3RcbiAgICAgICAgICAgIFNwYWNlU3RvcmUuaW5zdGFuY2UubW92ZVJvb3RTcGFjZShyZXN1bHQuc291cmNlLmluZGV4LCByZXN1bHQuZGVzdGluYXRpb24uaW5kZXgpO1xuICAgICAgICB9fT5cbiAgICAgICAgICAgIDxSb3ZpbmdUYWJJbmRleFByb3ZpZGVyIGhhbmRsZUhvbWVFbmQgaGFuZGxlVXBEb3duPlxuICAgICAgICAgICAgICAgIHsgKHsgb25LZXlEb3duSGFuZGxlciB9KSA9PiAoXG4gICAgICAgICAgICAgICAgICAgIDx1bFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfU3BhY2VQYW5lbFwiLCB7IGNvbGxhcHNlZDogaXNQYW5lbENvbGxhcHNlZCB9KX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uS2V5RG93bj17b25LZXlEb3duSGFuZGxlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU9XCJ0cmVlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e190KFwiU3BhY2VzXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmPXtyZWZ9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxEcm9wcGFibGUgZHJvcHBhYmxlSWQ9XCJ0b3AtbGV2ZWwtc3BhY2VzXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAocHJvdmlkZWQsIHNuYXBzaG90KSA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxBdXRvSGlkZVNjcm9sbGJhclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey4uLnByb3ZpZGVkLmRyb3BwYWJsZVByb3BzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JhcHBlZFJlZj17cHJvdmlkZWQuaW5uZXJSZWZ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9TcGFjZVBhbmVsX3NwYWNlVHJlZVdyYXBwZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3NuYXBzaG90LmlzRHJhZ2dpbmdPdmVyID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ZXJFdmVudHM6IFwibm9uZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPElubmVyU3BhY2VQYW5lbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUGFuZWxDb2xsYXBzZWQ9e2lzUGFuZWxDb2xsYXBzZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0UGFuZWxDb2xsYXBzZWQ9e3NldFBhbmVsQ29sbGFwc2VkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgcHJvdmlkZWQucGxhY2Vob2xkZXIgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Jbm5lclNwYWNlUGFuZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQXV0b0hpZGVTY3JvbGxiYXI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0Ryb3BwYWJsZT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcIm14X1NwYWNlUGFuZWxfdG9nZ2xlQ29sbGFwc2VcIiwgeyBleHBhbmRlZDogIWlzUGFuZWxDb2xsYXBzZWQgfSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0UGFuZWxDb2xsYXBzZWQoIWlzUGFuZWxDb2xsYXBzZWQpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPXtpc1BhbmVsQ29sbGFwc2VkID8gX3QoXCJFeHBhbmQgc3BhY2UgcGFuZWxcIikgOiBfdChcIkNvbGxhcHNlIHNwYWNlIHBhbmVsXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlSGlkZT17IWlzUGFuZWxDb2xsYXBzZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAhaXNQYW5lbENvbGxhcHNlZCA/IF90KFwiQ29sbGFwc2VcIikgOiBudWxsIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IG1ldGFTcGFjZXNFbmFibGVkICYmIDxRdWlja1NldHRpbmdzQnV0dG9uIGlzUGFuZWxDb2xsYXBzZWQ9e2lzUGFuZWxDb2xsYXBzZWR9IC8+IH1cbiAgICAgICAgICAgICAgICAgICAgPC91bD5cbiAgICAgICAgICAgICAgICApIH1cbiAgICAgICAgICAgIDwvUm92aW5nVGFiSW5kZXhQcm92aWRlcj5cbiAgICAgICAgPC9EcmFnRHJvcENvbnRleHQ+XG4gICAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFNwYWNlUGFuZWw7XG4iXX0=