"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _languageHandler = require("../../../languageHandler");

var _StyledRadioGroup = _interopRequireDefault(require("../elements/StyledRadioGroup"));

var _QueryMatcher = _interopRequireDefault(require("../../../autocomplete/QueryMatcher"));

var _SearchBox = _interopRequireDefault(require("../../structures/SearchBox"));

var _AutoHideScrollbar = _interopRequireDefault(require("../../structures/AutoHideScrollbar"));

var _AddExistingToSpaceDialog = require("../dialogs/AddExistingToSpaceDialog");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
var Target;

(function (Target) {
  Target["All"] = "All";
  Target["Specific"] = "Specific";
  Target["None"] = "None";
})(Target || (Target = {}));

const SpecificChildrenPicker = ({
  filterPlaceholder,
  rooms,
  selected,
  onChange
}) => {
  const [query, setQuery] = (0, _react.useState)("");
  const lcQuery = query.toLowerCase().trim();
  const filteredRooms = (0, _react.useMemo)(() => {
    if (!lcQuery) {
      return rooms;
    }

    const matcher = new _QueryMatcher.default(rooms, {
      keys: ["name"],
      funcs: [r => [r.getCanonicalAlias(), ...r.getAltAliases()].filter(Boolean)],
      shouldMatchWordsOnly: false
    });
    return matcher.match(lcQuery);
  }, [rooms, lcQuery]);
  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SpaceChildrenPicker"
  }, /*#__PURE__*/_react.default.createElement(_SearchBox.default, {
    className: "mx_textinput_icon mx_textinput_search",
    placeholder: filterPlaceholder,
    onSearch: setQuery,
    autoFocus: true
  }), /*#__PURE__*/_react.default.createElement(_AutoHideScrollbar.default, null, filteredRooms.map(room => {
    return /*#__PURE__*/_react.default.createElement(_AddExistingToSpaceDialog.Entry, {
      key: room.roomId,
      room: room,
      checked: selected.has(room),
      onChange: checked => {
        onChange(checked, room);
      }
    });
  }), filteredRooms.length < 1 ? /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_SpaceChildrenPicker_noResults"
  }, (0, _languageHandler._t)("No results")) : undefined));
};

const SpaceChildrenPicker = ({
  space,
  spaceChildren,
  selected,
  onChange,
  noneLabel,
  allLabel,
  specificLabel
}) => {
  const [state, setState] = (0, _react.useState)(noneLabel ? Target.None : Target.All);
  (0, _react.useEffect)(() => {
    if (state === Target.All) {
      onChange(spaceChildren);
    } else {
      onChange([]);
    }
  }, [onChange, state, spaceChildren]);
  return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SpaceChildrenPicker"
  }, /*#__PURE__*/_react.default.createElement(_StyledRadioGroup.default, {
    name: "roomsToLeave",
    value: state,
    onChange: setState,
    definitions: [{
      value: Target.None,
      label: noneLabel
    }, {
      value: Target.All,
      label: allLabel
    }, {
      value: Target.Specific,
      label: specificLabel
    }].filter(d => d.label)
  })), state === Target.Specific && /*#__PURE__*/_react.default.createElement(SpecificChildrenPicker, {
    filterPlaceholder: (0, _languageHandler._t)("Search %(spaceName)s", {
      spaceName: space.name
    }),
    rooms: spaceChildren,
    selected: selected,
    onChange: (isSelected, room) => {
      if (isSelected) {
        onChange([room, ...selected]);
      } else {
        onChange([...selected].filter(r => r !== room));
      }
    }
  }));
};

var _default = SpaceChildrenPicker;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NwYWNlcy9TcGFjZUNoaWxkcmVuUGlja2VyLnRzeCJdLCJuYW1lcyI6WyJUYXJnZXQiLCJTcGVjaWZpY0NoaWxkcmVuUGlja2VyIiwiZmlsdGVyUGxhY2Vob2xkZXIiLCJyb29tcyIsInNlbGVjdGVkIiwib25DaGFuZ2UiLCJxdWVyeSIsInNldFF1ZXJ5IiwibGNRdWVyeSIsInRvTG93ZXJDYXNlIiwidHJpbSIsImZpbHRlcmVkUm9vbXMiLCJtYXRjaGVyIiwiUXVlcnlNYXRjaGVyIiwia2V5cyIsImZ1bmNzIiwiciIsImdldENhbm9uaWNhbEFsaWFzIiwiZ2V0QWx0QWxpYXNlcyIsImZpbHRlciIsIkJvb2xlYW4iLCJzaG91bGRNYXRjaFdvcmRzT25seSIsIm1hdGNoIiwibWFwIiwicm9vbSIsInJvb21JZCIsImhhcyIsImNoZWNrZWQiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJTcGFjZUNoaWxkcmVuUGlja2VyIiwic3BhY2UiLCJzcGFjZUNoaWxkcmVuIiwibm9uZUxhYmVsIiwiYWxsTGFiZWwiLCJzcGVjaWZpY0xhYmVsIiwic3RhdGUiLCJzZXRTdGF0ZSIsIk5vbmUiLCJBbGwiLCJ2YWx1ZSIsImxhYmVsIiwiU3BlY2lmaWMiLCJkIiwic3BhY2VOYW1lIiwibmFtZSIsImlzU2VsZWN0ZWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQWdCQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtJQVlLQSxNOztXQUFBQSxNO0FBQUFBLEVBQUFBLE07QUFBQUEsRUFBQUEsTTtBQUFBQSxFQUFBQSxNO0dBQUFBLE0sS0FBQUEsTTs7QUFhTCxNQUFNQyxzQkFBc0IsR0FBRyxDQUFDO0FBQUVDLEVBQUFBLGlCQUFGO0FBQXFCQyxFQUFBQSxL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TWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5cbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IFN0eWxlZFJhZGlvR3JvdXAgZnJvbSBcIi4uL2VsZW1lbnRzL1N0eWxlZFJhZGlvR3JvdXBcIjtcbmltcG9ydCBRdWVyeU1hdGNoZXIgZnJvbSBcIi4uLy4uLy4uL2F1dG9jb21wbGV0ZS9RdWVyeU1hdGNoZXJcIjtcbmltcG9ydCBTZWFyY2hCb3ggZnJvbSBcIi4uLy4uL3N0cnVjdHVyZXMvU2VhcmNoQm94XCI7XG5pbXBvcnQgQXV0b0hpZGVTY3JvbGxiYXIgZnJvbSBcIi4uLy4uL3N0cnVjdHVyZXMvQXV0b0hpZGVTY3JvbGxiYXJcIjtcbmltcG9ydCB7IEVudHJ5IH0gZnJvbSBcIi4uL2RpYWxvZ3MvQWRkRXhpc3RpbmdUb1NwYWNlRGlhbG9nXCI7XG5cbmVudW0gVGFyZ2V0IHtcbiAgICBBbGwgPSBcIkFsbFwiLFxuICAgIFNwZWNpZmljID0gXCJTcGVjaWZpY1wiLFxuICAgIE5vbmUgPSBcIk5vbmVcIixcbn1cblxuaW50ZXJmYWNlIElTcGVjaWZpY0NoaWxkcmVuUGlja2VyUHJvcHMge1xuICAgIGZpbHRlclBsYWNlaG9sZGVyOiBzdHJpbmc7XG4gICAgcm9vbXM6IFJvb21bXTtcbiAgICBzZWxlY3RlZDogU2V0PFJvb20+O1xuICAgIG9uQ2hhbmdlKHNlbGVjdGVkOiBib29sZWFuLCByb29tOiBSb29tKTogdm9pZDtcbn1cblxuY29uc3QgU3BlY2lmaWNDaGlsZHJlblBpY2tlciA9ICh7IGZpbHRlclBsYWNlaG9sZGVyLCByb29tcywgc2VsZWN0ZWQsIG9uQ2hhbmdlIH06IElTcGVjaWZpY0NoaWxkcmVuUGlja2VyUHJvcHMpID0+IHtcbiAgICBjb25zdCBbcXVlcnksIHNldFF1ZXJ5XSA9IHVzZVN0YXRlKFwiXCIpO1xuICAgIGNvbnN0IGxjUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcblxuICAgIGNvbnN0IGZpbHRlcmVkUm9vbXMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgICAgaWYgKCFsY1F1ZXJ5KSB7XG4gICAgICAgICAgICByZXR1cm4gcm9vbXM7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtYXRjaGVyID0gbmV3IFF1ZXJ5TWF0Y2hlcjxSb29tPihyb29tcywge1xuICAgICAgICAgICAga2V5czogW1wibmFtZVwiXSxcbiAgICAgICAgICAgIGZ1bmNzOiBbciA9PiBbci5nZXRDYW5vbmljYWxBbGlhcygpLCAuLi5yLmdldEFsdEFsaWFzZXMoKV0uZmlsdGVyKEJvb2xlYW4pXSxcbiAgICAgICAgICAgIHNob3VsZE1hdGNoV29yZHNPbmx5OiBmYWxzZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG1hdGNoZXIubWF0Y2gobGNRdWVyeSk7XG4gICAgfSwgW3Jvb21zLCBsY1F1ZXJ5XSk7XG5cbiAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJteF9TcGFjZUNoaWxkcmVuUGlja2VyXCI+XG4gICAgICAgIDxTZWFyY2hCb3hcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X3RleHRpbnB1dF9pY29uIG14X3RleHRpbnB1dF9zZWFyY2hcIlxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9e2ZpbHRlclBsYWNlaG9sZGVyfVxuICAgICAgICAgICAgb25TZWFyY2g9e3NldFF1ZXJ5fVxuICAgICAgICAgICAgYXV0b0ZvY3VzPXt0cnVlfVxuICAgICAgICAvPlxuICAgICAgICA8QXV0b0hpZGVTY3JvbGxiYXI+XG4gICAgICAgICAgICB7IGZpbHRlcmVkUm9vbXMubWFwKHJvb20gPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiA8RW50cnlcbiAgICAgICAgICAgICAgICAgICAga2V5PXtyb29tLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgcm9vbT17cm9vbX1cbiAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17c2VsZWN0ZWQuaGFzKHJvb20pfVxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGNoZWNrZWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlKGNoZWNrZWQsIHJvb20pO1xuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIC8+O1xuICAgICAgICAgICAgfSkgfVxuICAgICAgICAgICAgeyBmaWx0ZXJlZFJvb21zLmxlbmd0aCA8IDEgPyA8c3BhbiBjbGFzc05hbWU9XCJteF9TcGFjZUNoaWxkcmVuUGlja2VyX25vUmVzdWx0c1wiPlxuICAgICAgICAgICAgICAgIHsgX3QoXCJObyByZXN1bHRzXCIpIH1cbiAgICAgICAgICAgIDwvc3Bhbj4gOiB1bmRlZmluZWQgfVxuICAgICAgICA8L0F1dG9IaWRlU2Nyb2xsYmFyPlxuICAgIDwvZGl2Pjtcbn07XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHNwYWNlOiBSb29tO1xuICAgIHNwYWNlQ2hpbGRyZW46IFJvb21bXTtcbiAgICBzZWxlY3RlZDogU2V0PFJvb20+O1xuICAgIG5vbmVMYWJlbD86IHN0cmluZztcbiAgICBhbGxMYWJlbDogc3RyaW5nO1xuICAgIHNwZWNpZmljTGFiZWw6IHN0cmluZztcbiAgICBvbkNoYW5nZShyb29tczogUm9vbVtdKTogdm9pZDtcbn1cblxuY29uc3QgU3BhY2VDaGlsZHJlblBpY2tlciA9ICh7XG4gICAgc3BhY2UsXG4gICAgc3BhY2VDaGlsZHJlbixcbiAgICBzZWxlY3RlZCxcbiAgICBvbkNoYW5nZSxcbiAgICBub25lTGFiZWwsXG4gICAgYWxsTGFiZWwsXG4gICAgc3BlY2lmaWNMYWJlbCxcbn06IElQcm9wcykgPT4ge1xuICAgIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gdXNlU3RhdGU8c3RyaW5nPihub25lTGFiZWwgPyBUYXJnZXQuTm9uZSA6IFRhcmdldC5BbGwpO1xuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKHN0YXRlID09PSBUYXJnZXQuQWxsKSB7XG4gICAgICAgICAgICBvbkNoYW5nZShzcGFjZUNoaWxkcmVuKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKFtdKTtcbiAgICAgICAgfVxuICAgIH0sIFtvbkNoYW5nZSwgc3RhdGUsIHNwYWNlQ2hpbGRyZW5dKTtcblxuICAgIHJldHVybiA8PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NwYWNlQ2hpbGRyZW5QaWNrZXJcIj5cbiAgICAgICAgICAgIDxTdHlsZWRSYWRpb0dyb3VwXG4gICAgICAgICAgICAgICAgbmFtZT1cInJvb21zVG9MZWF2ZVwiXG4gICAgICAgICAgICAgICAgdmFsdWU9e3N0YXRlfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtzZXRTdGF0ZX1cbiAgICAgICAgICAgICAgICBkZWZpbml0aW9ucz17W1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogVGFyZ2V0Lk5vbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbm9uZUxhYmVsLFxuICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogVGFyZ2V0LkFsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBhbGxMYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFRhcmdldC5TcGVjaWZpYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBzcGVjaWZpY0xhYmVsLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0uZmlsdGVyKGQgPT4gZC5sYWJlbCl9XG4gICAgICAgICAgICAvPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICB7IHN0YXRlID09PSBUYXJnZXQuU3BlY2lmaWMgJiYgKFxuICAgICAgICAgICAgPFNwZWNpZmljQ2hpbGRyZW5QaWNrZXJcbiAgICAgICAgICAgICAgICBmaWx0ZXJQbGFjZWhvbGRlcj17X3QoXCJTZWFyY2ggJShzcGFjZU5hbWUpc1wiLCB7IHNwYWNlTmFtZTogc3BhY2UubmFtZSB9KX1cbiAgICAgICAgICAgICAgICByb29tcz17c3BhY2VDaGlsZHJlbn1cbiAgICAgICAgICAgICAgICBzZWxlY3RlZD17c2VsZWN0ZWR9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhpc1NlbGVjdGVkOiBib29sZWFuLCByb29tOiBSb29tKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZShbcm9vbSwgLi4uc2VsZWN0ZWRdKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlKFsuLi5zZWxlY3RlZF0uZmlsdGVyKHIgPT4gciAhPT0gcm9vbSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICkgfVxuICAgIDwvPjtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFNwYWNlQ2hpbGRyZW5QaWNrZXI7XG4iXX0=