"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SpaceAvatar = void 0;

var _react = _interopRequireWildcard(require("react"));

var _languageHandler = require("../../../languageHandler");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _Field = _interopRequireDefault(require("../elements/Field"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const SpaceAvatar = ({
  avatarUrl,
  avatarDisabled = false,
  setAvatar
}) => {
  const avatarUploadRef = (0, _react.useRef)();
  const [avatar, setAvatarDataUrl] = (0, _react.useState)(avatarUrl); // avatar data url cache

  let avatarSection;

  if (avatarDisabled) {
    if (avatar) {
      avatarSection = /*#__PURE__*/_react.default.createElement("img", {
        className: "mx_SpaceBasicSettings_avatar",
        src: avatar,
        alt: ""
      });
    } else {
      avatarSection = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SpaceBasicSettings_avatar"
      });
    }
  } else {
    if (avatar) {
      avatarSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        className: "mx_SpaceBasicSettings_avatar",
        onClick: () => {
          var _avatarUploadRef$curr;

          return (_avatarUploadRef$curr = avatarUploadRef.current) === null || _avatarUploadRef$curr === void 0 ? void 0 : _avatarUploadRef$curr.click();
        },
        element: "img",
        src: avatar,
        alt: ""
      }), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        onClick: () => {
          avatarUploadRef.current.value = "";
          setAvatarDataUrl(undefined);
          setAvatar(undefined);
        },
        kind: "link",
        className: "mx_SpaceBasicSettings_avatar_remove",
        "aria-label": (0, _languageHandler._t)("Delete avatar")
      }, (0, _languageHandler._t)("Delete")));
    } else {
      avatarSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_SpaceBasicSettings_avatar",
        onClick: () => {
          var _avatarUploadRef$curr2;

          return (_avatarUploadRef$curr2 = avatarUploadRef.current) === null || _avatarUploadRef$curr2 === void 0 ? void 0 : _avatarUploadRef$curr2.click();
        }
      }), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        onClick: () => {
          var _avatarUploadRef$curr3;

          return (_avatarUploadRef$curr3 = avatarUploadRef.current) === null || _avatarUploadRef$curr3 === void 0 ? void 0 : _avatarUploadRef$curr3.click();
        },
        kind: "link",
        "aria-label": (0, _languageHandler._t)("Upload avatar")
      }, (0, _languageHandler._t)("Upload")));
    }
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SpaceBasicSettings_avatarContainer"
  }, avatarSection, /*#__PURE__*/_react.default.createElement("input", {
    type: "file",
    ref: avatarUploadRef,
    onChange: e => {
      var _e$target$files;

      if (!((_e$target$files = e.target.files) !== null && _e$target$files !== void 0 && _e$target$files.length)) return;
      const file = e.target.files[0];
      setAvatar(file);
      const reader = new FileReader();

      reader.onload = ev => {
        setAvatarDataUrl(ev.target.result);
      };

      reader.readAsDataURL(file);
    },
    accept: "image/*"
  }));
};

exports.SpaceAvatar = SpaceAvatar;

const SpaceBasicSettings = ({
  avatarUrl,
  avatarDisabled = false,
  setAvatar,
  name = "",
  nameDisabled = false,
  setName,
  topic = "",
  topicDisabled = false,
  setTopic
}) => {
  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_SpaceBasicSettings"
  }, /*#__PURE__*/_react.default.createElement(SpaceAvatar, {
    avatarUrl: avatarUrl,
    avatarDisabled: avatarDisabled,
    setAvatar: setAvatar
  }), /*#__PURE__*/_react.default.createElement(_Field.default, {
    name: "spaceName",
    label: (0, _languageHandler._t)("Name"),
    autoFocus: true,
    value: name,
    onChange: ev => setName(ev.target.value),
    disabled: nameDisabled
  }), /*#__PURE__*/_react.default.createElement(_Field.default, {
    name: "spaceTopic",
    element: "textarea",
    label: (0, _languageHandler._t)("Description"),
    value: topic,
    onChange: ev => setTopic(ev.target.value),
    rows: 3,
    disabled: topicDisabled
  }));
};

var _default = SpaceBasicSettings;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NwYWNlcy9TcGFjZUJhc2ljU2V0dGluZ3MudHN4Il0sIm5hbWVzIjpbIlNwYWNlQXZhdGFyIiwiYXZhdGFyVXJsIiwiYXZhdGFyRGlzYWJsZWQiLCJzZXRBdmF0YXIiLCJhdmF0YXJVcGxvYWRSZWYiLCJhdmF0YXIiLCJzZXRBdmF0YXJEYXRhVXJsIiwiYXZhdGFyU2VjdGlvbiIsImN1cnJlbnQiLCJjbGljayIsInZhbHVlIiwidW5kZWZpbmVkIiwiZSIsInRhcmdldCIsImZpbGVzIiwibGVuZ3RoIiwiZmlsZSIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJldiIsInJlc3VsdCIsInJlYWRBc0RhdGFVUkwiLCJTcGFjZUJhc2ljU2V0dGluZ3MiLCJuYW1lIiwibmFtZURpc2FibGVkIiwic2V0TmFtZSIsInRvcGljIiwidG9waWNEaXNhYmxlZCIsInNldFRvcGljIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFnQkE7O0FBRUE7O0FBQ0E7O0FBQ0E7Ozs7OztBQXBCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFvQk8sTUFBTUEsV0FBVyxHQUFHLENBQUM7QUFDeEJDLEVBQUFBLFNBRHdCO0FBRXhCQyxFQUFBQSxjQUFjLEdBQUcsS0FGTztBQUd4QkMsRUFBQUE7QUFId0IsQ0FBRCxLQUl1QztBQUM5RCxRQUFNQyxlQUFlLEdBQUcsb0JBQXhCO0FBQ0EsUUFBTSxDQUFDQyxNQUFELEVBQVNDLGdCQUFULElBQTZCLHFCQUFTTCxTQUFULENBQW5DLENBRjhELENBRU47O0FBRXhELE1BQUlNLGFBQUo7O0FBQ0EsTUFBSUwsY0FBSixFQUFvQjtBQUNoQixRQUFJRyxNQUFKLEVBQVk7QUFDUkUsTUFBQUEsYUFBYSxnQkFBRztBQUFLLFFBQUEsU0FBUyxFQUFDLDhCQUFmO0FBQThDLFFBQUEsR0FBRyxFQUFF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LEdBQUcsS0FMUztBQU14QkMsRUFBQUEsT0FOd0I7QUFPeEJDLEVBQUFBLEtBQUssR0FBRyxFQVBnQjtBQVF4QkMsRUFBQUEsYUFBYSxHQUFHLEtBUlE7QUFTeEJDLEVBQUFBO0FBVHdCLENBQUQsS0FVYjtBQUNWLHNCQUFPO0FBQUssSUFBQSxTQUFTLEVBQUM7QUFBZixrQkFDSCw2QkFBQyxXQUFEO0FBQWEsSUFBQSxTQUFTLEVBQUU1QixTQUF4QjtBQUFtQyxJQUFBLGNBQWMsRUFBRUMsY0FBbkQ7QUFBbUUsSUFBQSxTQUFTLEVBQUVDO0FBQTlFLElBREcsZUFHSCw2QkFBQyxjQUFEO0FBQ0ksSUFBQSxJQUFJLEVBQUMsV0FEVDtBQUVJLElBQUEsS0FBSyxFQUFFLHlCQUFHLE1BQUgsQ0FGWDtBQUdJLElBQUEsU0FBUyxFQUFFLElBSGY7QUFJSSxJQUFBLEtBQUssRUFBRXFCLElBSlg7QUFLSSxJQUFBLFFBQVEsRUFBRUosRUFBRSxJQUFJTSxPQUFPLENBQUNOLEVBQUUsQ0FBQ1AsTUFBSCxDQUFVSCxLQUFYLENBTDNCO0FBTUksSUFBQSxRQUFRLEVBQUVlO0FBTmQsSUFIRyxlQVlILDZCQUFDLGNBQUQ7QUFDSSxJQUFBLElBQUksRUFBQyxZQURUO0FBRUksSUFBQSxPQUFPLEVBQUMsVUFGWjtBQUdJLElBQUEsS0FBSyxFQUFFLHlCQUFHLGFBQUgsQ0FIWDtBQUlJLElBQUEsS0FBSyxFQUFFRSxLQUpYO0FBS0ksSUFBQSxRQUFRLEVBQUVQLEVBQUUsSUFBSVMsUUFBUSxDQUFDVCxFQUFFLENBQUNQLE1BQUgsQ0FBVUgsS0FBWCxDQUw1QjtBQU1JLElBQUEsSUFBSSxFQUFFLENBTlY7QUFPSSxJQUFBLFFBQVEsRUFBRWtCO0FBUGQsSUFaRyxDQUFQO0FBc0JILENBakNEOztlQW1DZUwsa0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMjEgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuXG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcIi4uL2VsZW1lbnRzL0ZpZWxkXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGF2YXRhclVybD86IHN0cmluZztcbiAgICBhdmF0YXJEaXNhYmxlZD86IGJvb2xlYW47XG4gICAgbmFtZT86IHN0cmluZztcbiAgICBuYW1lRGlzYWJsZWQ/OiBib29sZWFuO1xuICAgIHRvcGljPzogc3RyaW5nO1xuICAgIHRvcGljRGlzYWJsZWQ/OiBib29sZWFuO1xuICAgIHNldEF2YXRhcihhdmF0YXI6IEZpbGUpOiB2b2lkO1xuICAgIHNldE5hbWUobmFtZTogc3RyaW5nKTogdm9pZDtcbiAgICBzZXRUb3BpYyh0b3BpYzogc3RyaW5nKTogdm9pZDtcbn1cblxuZXhwb3J0IGNvbnN0IFNwYWNlQXZhdGFyID0gKHtcbiAgICBhdmF0YXJVcmwsXG4gICAgYXZhdGFyRGlzYWJsZWQgPSBmYWxzZSxcbiAgICBzZXRBdmF0YXIsXG59OiBQaWNrPElQcm9wcywgXCJhdmF0YXJVcmxcIiB8IFwiYXZhdGFyRGlzYWJsZWRcIiB8IFwic2V0QXZhdGFyXCI+KSA9PiB7XG4gICAgY29uc3QgYXZhdGFyVXBsb2FkUmVmID0gdXNlUmVmPEhUTUxJbnB1dEVsZW1lbnQ+KCk7XG4gICAgY29uc3QgW2F2YXRhciwgc2V0QXZhdGFyRGF0YVVybF0gPSB1c2VTdGF0ZShhdmF0YXJVcmwpOyAvLyBhdmF0YXIgZGF0YSB1cmwgY2FjaGVcblxuICAgIGxldCBhdmF0YXJTZWN0aW9uO1xuICAgIGlmIChhdmF0YXJEaXNhYmxlZCkge1xuICAgICAgICBpZiAoYXZhdGFyKSB7XG4gICAgICAgICAgICBhdmF0YXJTZWN0aW9uID0gPGltZyBjbGFzc05hbWU9XCJteF9TcGFjZUJhc2ljU2V0dGluZ3NfYXZhdGFyXCIgc3JjPXthdmF0YXJ9IGFsdD1cIlwiIC8+O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXZhdGFyU2VjdGlvbiA9IDxkaXYgY2xhc3NOYW1lPVwibXhfU3BhY2VCYXNpY1NldHRpbmdzX2F2YXRhclwiIC8+O1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGF2YXRhcikge1xuICAgICAgICAgICAgYXZhdGFyU2VjdGlvbiA9IDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9TcGFjZUJhc2ljU2V0dGluZ3NfYXZhdGFyXCJcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gYXZhdGFyVXBsb2FkUmVmLmN1cnJlbnQ/LmNsaWNrKCl9XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ9XCJpbWdcIlxuICAgICAgICAgICAgICAgICAgICBzcmM9e2F2YXRhcn1cbiAgICAgICAgICAgICAgICAgICAgYWx0PVwiXCJcbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhclVwbG9hZFJlZi5jdXJyZW50LnZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEF2YXRhckRhdGFVcmwodW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEF2YXRhcih1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICBraW5kPVwibGlua1wiXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1NwYWNlQmFzaWNTZXR0aW5nc19hdmF0YXJfcmVtb3ZlXCJcbiAgICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD17X3QoXCJEZWxldGUgYXZhdGFyXCIpfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcIkRlbGV0ZVwiKSB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgPC9SZWFjdC5GcmFnbWVudD47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhdmF0YXJTZWN0aW9uID0gPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU3BhY2VCYXNpY1NldHRpbmdzX2F2YXRhclwiIG9uQ2xpY2s9eygpID0+IGF2YXRhclVwbG9hZFJlZi5jdXJyZW50Py5jbGljaygpfSAvPlxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IGF2YXRhclVwbG9hZFJlZi5jdXJyZW50Py5jbGljaygpfVxuICAgICAgICAgICAgICAgICAgICBraW5kPVwibGlua1wiXG4gICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e190KFwiVXBsb2FkIGF2YXRhclwiKX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJVcGxvYWRcIikgfVxuICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfU3BhY2VCYXNpY1NldHRpbmdzX2F2YXRhckNvbnRhaW5lclwiPlxuICAgICAgICB7IGF2YXRhclNlY3Rpb24gfVxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgIHR5cGU9XCJmaWxlXCJcbiAgICAgICAgICAgIHJlZj17YXZhdGFyVXBsb2FkUmVmfVxuICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFlLnRhcmdldC5maWxlcz8ubGVuZ3RoKSByZXR1cm47XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdO1xuICAgICAgICAgICAgICAgIHNldEF2YXRhcihmaWxlKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXYpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2V0QXZhdGFyRGF0YVVybChldi50YXJnZXQucmVzdWx0IGFzIHN0cmluZyk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBhY2NlcHQ9XCJpbWFnZS8qXCJcbiAgICAgICAgLz5cbiAgICA8L2Rpdj47XG59O1xuXG5jb25zdCBTcGFjZUJhc2ljU2V0dGluZ3MgPSAoe1xuICAgIGF2YXRhclVybCxcbiAgICBhdmF0YXJEaXNhYmxlZCA9IGZhbHNlLFxuICAgIHNldEF2YXRhcixcbiAgICBuYW1lID0gXCJcIixcbiAgICBuYW1lRGlzYWJsZWQgPSBmYWxzZSxcbiAgICBzZXROYW1lLFxuICAgIHRvcGljID0gXCJcIixcbiAgICB0b3BpY0Rpc2FibGVkID0gZmFsc2UsXG4gICAgc2V0VG9waWMsXG59OiBJUHJvcHMpID0+IHtcbiAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJteF9TcGFjZUJhc2ljU2V0dGluZ3NcIj5cbiAgICAgICAgPFNwYWNlQXZhdGFyIGF2YXRhclVybD17YXZhdGFyVXJsfSBhdmF0YXJEaXNhYmxlZD17YXZhdGFyRGlzYWJsZWR9IHNldEF2YXRhcj17c2V0QXZhdGFyfSAvPlxuXG4gICAgICAgIDxGaWVsZFxuICAgICAgICAgICAgbmFtZT1cInNwYWNlTmFtZVwiXG4gICAgICAgICAgICBsYWJlbD17X3QoXCJOYW1lXCIpfVxuICAgICAgICAgICAgYXV0b0ZvY3VzPXt0cnVlfVxuICAgICAgICAgICAgdmFsdWU9e25hbWV9XG4gICAgICAgICAgICBvbkNoYW5nZT17ZXYgPT4gc2V0TmFtZShldi50YXJnZXQudmFsdWUpfVxuICAgICAgICAgICAgZGlzYWJsZWQ9e25hbWVEaXNhYmxlZH1cbiAgICAgICAgLz5cblxuICAgICAgICA8RmllbGRcbiAgICAgICAgICAgIG5hbWU9XCJzcGFjZVRvcGljXCJcbiAgICAgICAgICAgIGVsZW1lbnQ9XCJ0ZXh0YXJlYVwiXG4gICAgICAgICAgICBsYWJlbD17X3QoXCJEZXNjcmlwdGlvblwiKX1cbiAgICAgICAgICAgIHZhbHVlPXt0b3BpY31cbiAgICAgICAgICAgIG9uQ2hhbmdlPXtldiA9PiBzZXRUb3BpYyhldi50YXJnZXQudmFsdWUpfVxuICAgICAgICAgICAgcm93cz17M31cbiAgICAgICAgICAgIGRpc2FibGVkPXt0b3BpY0Rpc2FibGVkfVxuICAgICAgICAvPlxuICAgIDwvZGl2Pjtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFNwYWNlQmFzaWNTZXR0aW5ncztcbiJdfQ==