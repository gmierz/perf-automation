"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var languageHandler = _interopRequireWildcard(require("../../../languageHandler"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Spinner = _interopRequireDefault(require("./Spinner"));

var _Dropdown = _interopRequireDefault(require("./Dropdown"));

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function languageMatchesSearchQuery(query, language) {
  if (language.label.toUpperCase().includes(query.toUpperCase())) return true;
  if (language.value.toUpperCase() === query.toUpperCase()) return true;
  return false;
}

let LanguageDropdown = (_dec = (0, _replaceableComponent.replaceableComponent)("views.elements.LanguageDropdown"), _dec(_class = class LanguageDropdown extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onSearchChange", search => {
      this.setState({
        searchQuery: search
      });
    });
    this.state = {
      searchQuery: '',
      langs: null
    };
  }

  componentDidMount() {
    languageHandler.getAllLanguagesFromJson().then(langs => {
      langs.sort(function (a, b) {
        if (a.label < b.label) return -1;
        if (a.label > b.label) return 1;
        return 0;
      });
      this.setState({
        langs
      });
    }).catch(() => {
      this.setState({
        langs: ['en']
      });
    });

    if (!this.props.value) {
      // If no value is given, we start with the first
      // country selected, but our parent component
      // doesn't know this, therefore we do this.
      const language = languageHandler.getUserLanguage();
      this.props.onOptionChange(language);
    }
  }

  render() {
    if (this.state.langs === null) {
      return /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
    }

    let displayedLanguages;

    if (this.state.searchQuery) {
      displayedLanguages = this.state.langs.filter(lang => {
        return languageMatchesSearchQuery(this.state.searchQuery, lang);
      });
    } else {
      displayedLanguages = this.state.langs;
    }

    const options = displayedLanguages.map(language => {
      return /*#__PURE__*/_react.default.createElement("div", {
        key: language.value
      }, language.label);
    }); // default value here too, otherwise we need to handle null / undefined
    // values between mounting and the initial value propgating

    let language = _SettingsStore.default.getValue("language", null,
    /*excludeDefault:*/
    true);

    let value = null;

    if (language) {
      value = this.props.value || language;
    } else {
      language = navigator.language || navigator.userLanguage;
      value = this.props.value || language;
    }

    return /*#__PURE__*/_react.default.createElement(_Dropdown.default, {
      id: "mx_LanguageDropdown",
      className: this.props.className,
      onOptionChange: this.props.onOptionChange,
      onSearchChange: this.onSearchChange,
      searchEnabled: true,
      value: value,
      label: (0, languageHandler._t)("Language Dropdown"),
      disabled: this.props.disabled
    }, options);
  }

}) || _class);
exports.default = LanguageDropdown;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL0xhbmd1YWdlRHJvcGRvd24udHN4Il0sIm5hbWVzIjpbImxhbmd1YWdlTWF0Y2hlc1NlYXJjaFF1ZXJ5IiwicXVlcnkiLCJsYW5ndWFnZSIsImxhYmVsIiwidG9VcHBlckNhc2UiLCJpbmNsdWRlcyIsInZhbHVlIiwiTGFuZ3VhZ2VEcm9wZG93biIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInNlYXJjaCIsInNldFN0YXRlIiwic2VhcmNoUXVlcnkiLCJzdGF0ZSIsImxhbmdzIiwiY29tcG9uZW50RGlkTW91bnQiLCJsYW5ndWFnZUhhbmRsZXIiLCJnZXRBbGxMYW5ndWFnZXNGcm9tSnNvbiIsInRoZW4iLCJzb3J0IiwiYSIsImIiLCJjYXRjaCIsImdldFVzZXJMYW5ndWFnZSIsIm9uT3B0aW9uQ2hhbmdlIiwicmVuZGVyIiwiZGlzcGxheWVkTGFuZ3VhZ2VzIiwiZmlsdGVyIiwibGFuZyIsIm9wdGlvbnMiLCJtYXAiLCJTZXR0aW5nc1N0b3JlIiwiZ2V0VmFsdWUiLCJuYXZpZ2F0b3IiLCJ1c2VyTGFuZ3VhZ2UiLCJjbGFzc05hbWUiLCJvblNlYXJjaENoYW5nZSIsImRpc2FibGVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWlCQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFFQSxTQUFTQSwwQkFBVCxDQUFvQ0MsS0FBcEMsRUFBMkNDLFFBQTNDLEVBQXFEO0FBQ2pELE1BQUlBLFFBQVEsQ0FBQ0MsS0FBVCxDQUFlQyxXQUFmLEdBQTZCQyxRQUE3QixDQUFzQ0osS0FBSyxDQUFDRyxXQUFOLEVBQXRDLENBQUosRUFBZ0UsT0FBTyxJQUFQO0FBQ2hFLE1BQUlGLFFBQVEsQ0FBQ0ksS0FBVCxDQUFlRixXQUFmLE9BQWlDSCxLQUFLLENBQUNHLFdBQU4sRUFBckMsRUFBMEQsT0FBTyxJQUFQO0FBQzFELFNBQU8sS0FB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QUFLSyxLQUFMLENBQVdMLEtBQVgsSUFBb0JKLFFBQTVCO0FBQ0g7O0FBRUQsd0JBQU8sNkJBQUMsaUJBQUQ7QUFDSCxNQUFBLEVBQUUsRUFBQyxxQkFEQTtBQUVILE1BQUEsU0FBUyxFQUFFLEtBQUtTLEtBQUwsQ0FBVzBCLFNBRm5CO0FBR0gsTUFBQSxjQUFjLEVBQUUsS0FBSzFCLEtBQUwsQ0FBV2UsY0FIeEI7QUFJSCxNQUFBLGNBQWMsRUFBRSxLQUFLWSxjQUpsQjtBQUtILE1BQUEsYUFBYSxFQUFFLElBTFo7QUFNSCxNQUFBLEtBQUssRUFBRWhDLEtBTko7QUFPSCxNQUFBLEtBQUssRUFBRSx3QkFBRyxtQkFBSCxDQVBKO0FBUUgsTUFBQSxRQUFRLEVBQUUsS0FBS0ssS0FBTCxDQUFXNEI7QUFSbEIsT0FVRFIsT0FWQyxDQUFQO0FBWUg7O0FBaEZ5RSxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE3IE1hcmNlbCBSYWR6aW8gKE1UUk5vcmQpXG5Db3B5cmlnaHQgMjAxNyBWZWN0b3IgQ3JlYXRpb25zIEx0ZC5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgKiBhcyBsYW5ndWFnZUhhbmRsZXIgZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgU3Bpbm5lciBmcm9tIFwiLi9TcGlubmVyXCI7XG5pbXBvcnQgRHJvcGRvd24gZnJvbSBcIi4vRHJvcGRvd25cIjtcblxuZnVuY3Rpb24gbGFuZ3VhZ2VNYXRjaGVzU2VhcmNoUXVlcnkocXVlcnksIGxhbmd1YWdlKSB7XG4gICAgaWYgKGxhbmd1YWdlLmxhYmVsLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkudG9VcHBlckNhc2UoKSkpIHJldHVybiB0cnVlO1xuICAgIGlmIChsYW5ndWFnZS52YWx1ZS50b1VwcGVyQ2FzZSgpID09PSBxdWVyeS50b1VwcGVyQ2FzZSgpKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGNsYXNzTmFtZT86IHN0cmluZztcbiAgICBvbk9wdGlvbkNoYW5nZTogKGxhbmd1YWdlOiBzdHJpbmcpID0+IHZvaWQ7XG4gICAgdmFsdWU/OiBzdHJpbmc7XG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBzZWFyY2hRdWVyeTogc3RyaW5nO1xuICAgIGxhbmdzOiBzdHJpbmdbXTtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuZWxlbWVudHMuTGFuZ3VhZ2VEcm9wZG93blwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGFuZ3VhZ2VEcm9wZG93biBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBzZWFyY2hRdWVyeTogJycsXG4gICAgICAgICAgICBsYW5nczogbnVsbCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkTW91bnQoKTogdm9pZCB7XG4gICAgICAgIGxhbmd1YWdlSGFuZGxlci5nZXRBbGxMYW5ndWFnZXNGcm9tSnNvbigpLnRoZW4oKGxhbmdzKSA9PiB7XG4gICAgICAgICAgICBsYW5ncy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICBpZiAoYS5sYWJlbCA8IGIubGFiZWwpIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICBpZiAoYS5sYWJlbCA+IGIubGFiZWwpIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgbGFuZ3MgfSk7XG4gICAgICAgIH0pLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsYW5nczogWydlbiddIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXRoaXMucHJvcHMudmFsdWUpIHtcbiAgICAgICAgICAgIC8vIElmIG5vIHZhbHVlIGlzIGdpdmVuLCB3ZSBzdGFydCB3aXRoIHRoZSBmaXJzdFxuICAgICAgICAgICAgLy8gY291bnRyeSBzZWxlY3RlZCwgYnV0IG91ciBwYXJlbnQgY29tcG9uZW50XG4gICAgICAgICAgICAvLyBkb2Vzbid0IGtub3cgdGhpcywgdGhlcmVmb3JlIHdlIGRvIHRoaXMuXG4gICAgICAgICAgICBjb25zdCBsYW5ndWFnZSA9IGxhbmd1YWdlSGFuZGxlci5nZXRVc2VyTGFuZ3VhZ2UoKTtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25PcHRpb25DaGFuZ2UobGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblNlYXJjaENoYW5nZSA9IChzZWFyY2g6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHNlYXJjaFF1ZXJ5OiBzZWFyY2gsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgcmVuZGVyKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUubGFuZ3MgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiA8U3Bpbm5lciAvPjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBkaXNwbGF5ZWRMYW5ndWFnZXM7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnNlYXJjaFF1ZXJ5KSB7XG4gICAgICAgICAgICBkaXNwbGF5ZWRMYW5ndWFnZXMgPSB0aGlzLnN0YXRlLmxhbmdzLmZpbHRlcigobGFuZykgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZU1hdGNoZXNTZWFyY2hRdWVyeSh0aGlzLnN0YXRlLnNlYXJjaFF1ZXJ5LCBsYW5nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlzcGxheWVkTGFuZ3VhZ2VzID0gdGhpcy5zdGF0ZS5sYW5ncztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBkaXNwbGF5ZWRMYW5ndWFnZXMubWFwKChsYW5ndWFnZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIDxkaXYga2V5PXtsYW5ndWFnZS52YWx1ZX0+XG4gICAgICAgICAgICAgICAgeyBsYW5ndWFnZS5sYWJlbCB9XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGRlZmF1bHQgdmFsdWUgaGVyZSB0b28sIG90aGVyd2lzZSB3ZSBuZWVkIHRvIGhhbmRsZSBudWxsIC8gdW5kZWZpbmVkXG4gICAgICAgIC8vIHZhbHVlcyBiZXR3ZWVuIG1vdW50aW5nIGFuZCB0aGUgaW5pdGlhbCB2YWx1ZSBwcm9wZ2F0aW5nXG4gICAgICAgIGxldCBsYW5ndWFnZSA9IFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJsYW5ndWFnZVwiLCBudWxsLCAvKmV4Y2x1ZGVEZWZhdWx0OiovdHJ1ZSk7XG4gICAgICAgIGxldCB2YWx1ZSA9IG51bGw7XG4gICAgICAgIGlmIChsYW5ndWFnZSkge1xuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLnByb3BzLnZhbHVlIHx8IGxhbmd1YWdlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGFuZ3VhZ2UgPSBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgbmF2aWdhdG9yLnVzZXJMYW5ndWFnZTtcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5wcm9wcy52YWx1ZSB8fCBsYW5ndWFnZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiA8RHJvcGRvd25cbiAgICAgICAgICAgIGlkPVwibXhfTGFuZ3VhZ2VEcm9wZG93blwiXG4gICAgICAgICAgICBjbGFzc05hbWU9e3RoaXMucHJvcHMuY2xhc3NOYW1lfVxuICAgICAgICAgICAgb25PcHRpb25DaGFuZ2U9e3RoaXMucHJvcHMub25PcHRpb25DaGFuZ2V9XG4gICAgICAgICAgICBvblNlYXJjaENoYW5nZT17dGhpcy5vblNlYXJjaENoYW5nZX1cbiAgICAgICAgICAgIHNlYXJjaEVuYWJsZWQ9e3RydWV9XG4gICAgICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgICAgICBsYWJlbD17X3QoXCJMYW5ndWFnZSBEcm9wZG93blwiKX1cbiAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnByb3BzLmRpc2FibGVkfVxuICAgICAgICA+XG4gICAgICAgICAgICB7IG9wdGlvbnMgfVxuICAgICAgICA8L0Ryb3Bkb3duPjtcbiAgICB9XG59XG5cbiJdfQ==