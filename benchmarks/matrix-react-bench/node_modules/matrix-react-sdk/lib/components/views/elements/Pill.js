"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var sdk = _interopRequireWildcard(require("../../../index"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _classnames = _interopRequireDefault(require("classnames"));

var _room = require("matrix-js-sdk/src/models/room");

var _roomMember = require("matrix-js-sdk/src/models/room-member");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _FlairStore = _interopRequireDefault(require("../../../stores/FlairStore"));

var _Permalinks = require("../../../utils/permalinks/Permalinks");

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _actions = require("../../../dispatcher/actions");

var _Media = require("../../../customisations/Media");

var _Tooltip = _interopRequireDefault(require("./Tooltip"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let Pill = (_dec = (0, _replaceableComponent.replaceableComponent)("views.elements.Pill"), _dec(_class = (_temp = _class2 = class Pill extends _react.default.Component {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "state", {
      // ID/alias of the room/user
      resourceId: null,
      // Type of pill
      pillType: null,
      // The member related to the user pill
      member: null,
      // The group related to the group pill
      group: null,
      // The room related to the room pill
      room: null,
      // Is the user hovering the pill
      hover: false
    });
    (0, _defineProperty2.default)(this, "onMouseOver", () => {
      this.setState({
        hover: true
      });
    });
    (0, _defineProperty2.default)(this, "onMouseLeave", () => {
      this.setState({
        hover: false
      });
    });
    (0, _defineProperty2.default)(this, "onUserPillClicked", e => {
      e.preventDefault();

      _dispatcher.default.dispatch({
        action: _actions.Action.ViewUser,
        member: this.state.member
      });
    });
  }

  static roomNotifPos(text) {
    return text.indexOf("@room");
  }

  static roomNotifLen() {
    return "@room".length;
  }

  // TODO: [REACT-WARNING] Replace with appropriate lifecycle event
  // eslint-disable-next-line camelcase
  async UNSAFE_componentWillReceiveProps(nextProps) {
    let resourceId;
    let prefix;

    if (nextProps.url) {
      if (nextProps.inMessage) {
        const parts = (0, _Permalinks.parseAppLocalLink)(nextProps.url);
        resourceId = parts.primaryEntityId; // The room/user ID

        prefix = parts.sigil; // The first character of prefix
      } else {
        resourceId = (0, _Permalinks.getPrimaryPermalinkEntity)(nextProps.url);
        prefix = resourceId ? resourceId[0] : undefined;
      }
    }

    const pillType = this.props.type || {
      '@': Pill.TYPE_USER_MENTION,
      '#': Pill.TYPE_ROOM_MENTION,
      '!': Pill.TYPE_ROOM_MENTION,
      '+': Pill.TYPE_GROUP_MENTION
    }[prefix];
    let member;
    let group;
    let room;

    switch (pillType) {
      case Pill.TYPE_AT_ROOM_MENTION:
        {
          room = nextProps.room;
        }
        break;

      case Pill.TYPE_USER_MENTION:
        {
          const localMember = nextProps.room ? nextProps.room.getMember(resourceId) : undefined;
          member = localMember;

          if (!localMember) {
            member = new _roomMember.RoomMember(null, resourceId);
            this.doProfileLookup(resourceId, member);
          }
        }
        break;

      case Pill.TYPE_ROOM_MENTION:
        {
          const localRoom = resourceId[0] === '#' ? _MatrixClientPeg.MatrixClientPeg.get().getRooms().find(r => {
            return r.getCanonicalAlias() === resourceId || r.getAltAliases().includes(resourceId);
          }) : _MatrixClientPeg.MatrixClientPeg.get().getRoom(resourceId);
          room = localRoom;

          if (!localRoom) {// TODO: This would require a new API to resolve a room alias to
            // a room avatar and name.
            // this.doRoomProfileLookup(resourceId, member);
          }
        }
        break;

      case Pill.TYPE_GROUP_MENTION:
        {
          const cli = _MatrixClientPeg.MatrixClientPeg.get();

          try {
            group = await _FlairStore.default.getGroupProfileCached(cli, resourceId);
          } catch (e) {
            // if FlairStore failed, fall back to just groupId
            group = {
              groupId: resourceId,
              avatarUrl: null,
              name: null
            };
          }
        }
    }

    this.setState({
      resourceId,
      pillType,
      member,
      group,
      room
    });
  }

  componentDidMount() {
    this._unmounted = false;
    this._matrixClient = _MatrixClientPeg.MatrixClientPeg.get(); // eslint-disable-next-line new-cap

    this.UNSAFE_componentWillReceiveProps(this.props); // HACK: We shouldn't be calling lifecycle functions ourselves.
  }

  componentWillUnmount() {
    this._unmounted = true;
  }

  doProfileLookup(userId, member) {
    _MatrixClientPeg.MatrixClientPeg.get().getProfileInfo(userId).then(resp => {
      if (this._unmounted) {
        return;
      }

      member.name = resp.displayname;
      member.rawDisplayName = resp.displayname;
      member.events.member = {
        getContent: () => {
          return {
            avatar_url: resp.avatar_url
          };
        },
        getDirectionalContent: function () {
          return this.getContent();
        }
      };
      this.setState({
        member
      });
    }).catch(err => {
      _logger.logger.error('Could not retrieve profile data for ' + userId + ':', err);
    });
  }

  render() {
    const BaseAvatar = sdk.getComponent('views.avatars.BaseAvatar');
    const MemberAvatar = sdk.getComponent('avatars.MemberAvatar');
    const RoomAvatar = sdk.getComponent('avatars.RoomAvatar');
    const resource = this.state.resourceId;
    let avatar = null;
    let linkText = resource;
    let pillClass;
    let userId;
    let href = this.props.url;
    let onClick;

    switch (this.state.pillType) {
      case Pill.TYPE_AT_ROOM_MENTION:
        {
          const room = this.props.room;

          if (room) {
            linkText = "@room";

            if (this.props.shouldShowPillAvatar) {
              avatar = /*#__PURE__*/_react.default.createElement(RoomAvatar, {
                room: room,
                width: 16,
                height: 16,
                "aria-hidden": "true"
              });
            }

            pillClass = 'mx_AtRoomPill';
          }
        }
        break;

      case Pill.TYPE_USER_MENTION:
        {
          // If this user is not a member of this room, default to the empty member
          const member = this.state.member;

          if (member) {
            userId = member.userId;
            member.rawDisplayName = member.rawDisplayName || '';
            linkText = member.rawDisplayName;

            if (this.props.shouldShowPillAvatar) {
              avatar = /*#__PURE__*/_react.default.createElement(MemberAvatar, {
                member: member,
                width: 16,
                height: 16,
                "aria-hidden": "true"
              });
            }

            pillClass = 'mx_UserPill';
            href = null;
            onClick = this.onUserPillClicked;
          }
        }
        break;

      case Pill.TYPE_ROOM_MENTION:
        {
          const room = this.state.room;

          if (room) {
            linkText = room.name || resource;

            if (this.props.shouldShowPillAvatar) {
              avatar = /*#__PURE__*/_react.default.createElement(RoomAvatar, {
                room: room,
                width: 16,
                height: 16,
                "aria-hidden": "true"
              });
            }
          }

          pillClass = 'mx_RoomPill';
        }
        break;

      case Pill.TYPE_GROUP_MENTION:
        {
          if (this.state.group) {
            const {
              avatarUrl,
              groupId,
              name
            } = this.state.group;
            linkText = groupId;

            if (this.props.shouldShowPillAvatar) {
              avatar = /*#__PURE__*/_react.default.createElement(BaseAvatar, {
                name: name || groupId,
                width: 16,
                height: 16,
                "aria-hidden": "true",
                url: avatarUrl ? (0, _Media.mediaFromMxc)(avatarUrl).getSquareThumbnailHttp(16) : null
              });
            }

            pillClass = 'mx_GroupPill';
          }
        }
        break;
    }

    const classes = (0, _classnames.default)("mx_Pill", pillClass, {
      "mx_UserPill_me": userId === _MatrixClientPeg.MatrixClientPeg.get().getUserId(),
      "mx_UserPill_selected": this.props.isSelected
    });

    if (this.state.pillType) {
      const {
        yOffset
      } = this.props;
      let tip;

      if (this.state.hover && resource) {
        tip = /*#__PURE__*/_react.default.createElement(_Tooltip.default, {
          label: resource,
          yOffset: yOffset
        });
      }

      return /*#__PURE__*/_react.default.createElement(_MatrixClientContext.default.Provider, {
        value: this._matrixClient
      }, this.props.inMessage ? /*#__PURE__*/_react.default.createElement("a", {
        className: classes,
        href: href,
        onClick: onClick,
        "data-offset-key": this.props.offsetKey,
        onMouseOver: this.onMouseOver,
        onMouseLeave: this.onMouseLeave
      }, avatar, linkText, tip) : /*#__PURE__*/_react.default.createElement("span", {
        className: classes,
        "data-offset-key": this.props.offsetKey,
        onMouseOver: this.onMouseOver,
        onMouseLeave: this.onMouseLeave
      }, avatar, linkText, tip));
    } else {
      // Deliberately render nothing if the URL isn't recognised
      return null;
    }
  }

}, (0, _defineProperty2.default)(_class2, "TYPE_USER_MENTION", 'TYPE_USER_MENTION'), (0, _defineProperty2.default)(_class2, "TYPE_ROOM_MENTION", 'TYPE_ROOM_MENTION'), (0, _defineProperty2.default)(_class2, "TYPE_GROUP_MENTION", 'TYPE_GROUP_MENTION'), (0, _defineProperty2.default)(_class2, "TYPE_AT_ROOM_MENTION", 'TYPE_AT_ROOM_MENTION'), (0, _defineProperty2.default)(_class2, "propTypes", {
  // The Type of this Pill. If url is given, this is auto-detected.
  type: _propTypes.default.string,
  // The URL to pillify (no validation is done)
  url: _propTypes.default.string,
  // Whether the pill is in a message
  inMessage: _propTypes.default.bool,
  // The room in which this pill is being rendered
  room: _propTypes.default.instanceOf(_room.Room),
  // Whether to include an avatar in the pill
  shouldShowPillAvatar: _propTypes.default.bool,
  // Whether to render this pill as if it were highlit by a selection
  isSelected: _propTypes.default.bool
}), _temp)) || _class);
var _default = Pill;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL1BpbGwuanMiXSwibmFtZXMiOlsiUGlsbCIsIlJlYWN0IiwiQ29tcG9uZW50IiwicmVzb3VyY2VJZCIsInBpbGxUeXBlIiwibWVtYmVyIiwiZ3JvdXAiLCJyb29tIiwiaG92ZXIiLCJzZXRTdGF0ZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImRpcyIsImRpc3BhdGNoIiwiYWN0aW9uIiwiQWN0aW9uIiwiVmlld1VzZXIiLCJzdGF0ZSIsInJvb21Ob3RpZlBvcyIsInRleHQiLCJpbmRleE9mIiwicm9vbU5vdGlmTGVuIiwibGVuZ3RoIiwiVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLCJuZXh0UHJvcHMiLCJwcmVmaXgiLCJ1cmwiLCJpbk1lc3NhZ2UiLCJwYXJ0cyIsInByaW1hcnlFbnRpdHlJZCIsInNpZ2lsIiwidW5kZWZpbmVkIiwicHJvcHMiLCJ0eXBlIiwiVFlQRV9VU0VSX01FTlRJT04iLCJUWVBFX1JPT01fTUVOVElPTiIsIlRZUEVfR1JPVVBfTUVOVElPTiIsIlRZUEVfQVRfUk9PTV9NRU5USU9OIiwibG9jYWxNZW1iZXIiLCJnZXRNZW1iZXIiLCJSb29tTWVtYmVyIiwiZG9Qcm9maWxlTG9va3VwIiwibG9jYWxSb29tIiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0IiwiZ2V0Um9vbXMiLCJmaW5kIiwiciIsImdldENhbm9uaWNhbEFsaWFzIiwiZ2V0QWx0QWxpYXNlcyIsImluY2x1ZGVzIiwiZ2V0Um9vbSIsImNsaSIsIkZsYWlyU3RvcmUiLCJnZXRHcm91cFByb2ZpbGVDYWNoZWQiLCJncm91cElkIiwiYXZhdGFyVXJsIiwibmFtZSIsImNvbXBvbmVudERpZE1vdW50IiwiX3VubW91bnRlZCIsIl9tYXRyaXhDbGllbnQiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInVzZXJJZCIsImdldFByb2ZpbGVJbmZvIiwidGhlbiIsInJlc3AiLCJkaXNwbGF5bmFtZSIsInJhd0Rpc3BsYXlOYW1lIiwiZXZlbnRzIiwiZ2V0Q29udGVudCIsImF2YXRhcl91cmwiLCJnZXREaXJlY3Rpb25hbENvbnRlbnQiLCJjYXRjaCIsImVyciIsImxvZ2dlciIsImVycm9yIiwicmVuZGVyIiwiQmFzZUF2YXRhciIsInNkayIsImdldENvbXBvbmVudCIsIk1lbWJlckF2YXRhciIsIlJvb21BdmF0YXIiLCJyZXNvdXJjZSIsImF2YXRhciIsImxpbmtUZXh0IiwicGlsbENsYXNzIiwiaHJlZiIsIm9uQ2xpY2siLCJzaG91bGRTaG93UGlsbEF2YXRhciIsIm9uVXNlclBpbGxDbGlja2VkIiwiZ2V0U3F1YXJlVGh1bWJuYWlsSHR0cCIsImNsYXNzZXMiLCJnZXRVc2VySWQiLCJpc1NlbGVjdGVkIiwieU9mZnNldCIsInRpcCIsIm9mZnNldEtleSIsIm9uTW91c2VPdmVyIiwib25Nb3VzZUxlYXZlIiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiYm9vbCIsImluc3RhbmNlT2YiLCJSb29tIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7Ozs7OztJQUdNQSxJLFdBREwsZ0RBQXFCLHFCQUFyQixDLG1DQUFELE1BQ01BLElBRE4sU0FDbUJDLGVBQU1DLFNBRHpCLENBQ21DO0FBQUE7QUFBQTtBQUFBLGlEQTZCdkI7QUFDSjtBQUNBQyxNQUFBQSxVQUFVLEVBQUUsSUFGUjtBQUdKO0FBQ0FDLE1BQUFBLFFBQVEsRUFBRSxJQUpOO0FBTUo7QUFDQUMsTUFBQUEsTUFBTSxFQUFFLElBUEo7QUFRSjtBQUNBQyxNQUFBQSxLQUFLLEVBQUUsSUFUSDtBQVVKO0FBQ0FDLE1BQUFBLElBQUksRUFBRSxJQVhGO0FBWUo7QUFDQUMsTUFBQUEsS0FBSyxFQUFFO0FBYkgsS0E3QnVCO0FBQUEsdURBaUlqQixNQUFNO0FBQ2hCLFdBQUtDLFFBQUws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QSxZQUFZLEVBQUUsS0FBS0M7QUFOdkIsU0FRTWYsTUFSTixFQVNNQyxRQVROLEVBVU1XLEdBVk4sQ0FERixnQkFhRTtBQUNJLFFBQUEsU0FBUyxFQUFFSixPQURmO0FBRUksMkJBQWlCLEtBQUszRCxLQUFMLENBQVdnRSxTQUZoQztBQUdJLFFBQUEsV0FBVyxFQUFFLEtBQUtDLFdBSHRCO0FBSUksUUFBQSxZQUFZLEVBQUUsS0FBS0M7QUFKdkIsU0FNTWYsTUFOTixFQU9NQyxRQVBOLEVBUU1XLEdBUk4sQ0FkRCxDQUFQO0FBeUJILEtBakNELE1BaUNPO0FBQ0g7QUFDQSxhQUFPLElBQVA7QUFDSDtBQUNKOztBQTNSOEIsQyw4REFTSixtQiwrREFDQSxtQixnRUFDQyxvQixrRUFDRSxzQix1REFFWDtBQUNmO0FBQ0E5RCxFQUFBQSxJQUFJLEVBQUVrRSxtQkFBVUMsTUFGRDtBQUdmO0FBQ0ExRSxFQUFBQSxHQUFHLEVBQUV5RSxtQkFBVUMsTUFKQTtBQUtmO0FBQ0F6RSxFQUFBQSxTQUFTLEVBQUV3RSxtQkFBVUUsSUFOTjtBQU9mO0FBQ0E5RixFQUFBQSxJQUFJLEVBQUU0RixtQkFBVUcsVUFBVixDQUFxQkMsVUFBckIsQ0FSUztBQVNmO0FBQ0FmLEVBQUFBLG9CQUFvQixFQUFFVyxtQkFBVUUsSUFWakI7QUFXZjtBQUNBUixFQUFBQSxVQUFVLEVBQUVNLG1CQUFVRTtBQVpQLEM7ZUFnUlJyRyxJIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE3IC0gMjAxOSwgMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0ICogYXMgc2RrIGZyb20gJy4uLy4uLy4uL2luZGV4JztcbmltcG9ydCBkaXMgZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tJztcbmltcG9ydCB7IFJvb21NZW1iZXIgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbS1tZW1iZXInO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gJy4uLy4uLy4uL01hdHJpeENsaWVudFBlZyc7XG5pbXBvcnQgRmxhaXJTdG9yZSBmcm9tIFwiLi4vLi4vLi4vc3RvcmVzL0ZsYWlyU3RvcmVcIjtcbmltcG9ydCB7IGdldFByaW1hcnlQZXJtYWxpbmtFbnRpdHksIHBhcnNlQXBwTG9jYWxMaW5rIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3Blcm1hbGlua3MvUGVybWFsaW5rc1wiO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCB7IG1lZGlhRnJvbU14YyB9IGZyb20gXCIuLi8uLi8uLi9jdXN0b21pc2F0aW9ucy9NZWRpYVwiO1xuaW1wb3J0IFRvb2x0aXAgZnJvbSAnLi9Ub29sdGlwJztcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuZWxlbWVudHMuUGlsbFwiKVxuY2xhc3MgUGlsbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgc3RhdGljIHJvb21Ob3RpZlBvcyh0ZXh0KSB7XG4gICAgICAgIHJldHVybiB0ZXh0LmluZGV4T2YoXCJAcm9vbVwiKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgcm9vbU5vdGlmTGVuKCkge1xuICAgICAgICByZXR1cm4gXCJAcm9vbVwiLmxlbmd0aDtcbiAgICB9XG5cbiAgICBzdGF0aWMgVFlQRV9VU0VSX01FTlRJT04gPSAnVFlQRV9VU0VSX01FTlRJT04nO1xuICAgIHN0YXRpYyBUWVBFX1JPT01fTUVOVElPTiA9ICdUWVBFX1JPT01fTUVOVElPTic7XG4gICAgc3RhdGljIFRZUEVfR1JPVVBfTUVOVElPTiA9ICdUWVBFX0dST1VQX01FTlRJT04nO1xuICAgIHN0YXRpYyBUWVBFX0FUX1JPT01fTUVOVElPTiA9ICdUWVBFX0FUX1JPT01fTUVOVElPTic7IC8vICdAcm9vbScgbWVudGlvblxuXG4gICAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAgICAgLy8gVGhlIFR5cGUgb2YgdGhpcyBQaWxsLiBJZiB1cmwgaXMgZ2l2ZW4sIHRoaXMgaXMgYXV0by1kZXRlY3RlZC5cbiAgICAgICAgdHlwZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgLy8gVGhlIFVSTCB0byBwaWxsaWZ5IChubyB2YWxpZGF0aW9uIGlzIGRvbmUpXG4gICAgICAgIHVybDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgLy8gV2hldGhlciB0aGUgcGlsbCBpcyBpbiBhIG1lc3NhZ2VcbiAgICAgICAgaW5NZXNzYWdlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgLy8gVGhlIHJvb20gaW4gd2hpY2ggdGhpcyBwaWxsIGlzIGJlaW5nIHJlbmRlcmVkXG4gICAgICAgIHJvb206IFByb3BUeXBlcy5pbnN0YW5jZU9mKFJvb20pLFxuICAgICAgICAvLyBXaGV0aGVyIHRvIGluY2x1ZGUgYW4gYXZhdGFyIGluIHRoZSBwaWxsXG4gICAgICAgIHNob3VsZFNob3dQaWxsQXZhdGFyOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAgICAgLy8gV2hldGhlciB0byByZW5kZXIgdGhpcyBwaWxsIGFzIGlmIGl0IHdlcmUgaGlnaGxpdCBieSBhIHNlbGVjdGlvblxuICAgICAgICBpc1NlbGVjdGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgICB9O1xuXG4gICAgc3RhdGUgPSB7XG4gICAgICAgIC8vIElEL2FsaWFzIG9mIHRoZSByb29tL3VzZXJcbiAgICAgICAgcmVzb3VyY2VJZDogbnVsbCxcbiAgICAgICAgLy8gVHlwZSBvZiBwaWxsXG4gICAgICAgIHBpbGxUeXBlOiBudWxsLFxuXG4gICAgICAgIC8vIFRoZSBtZW1iZXIgcmVsYXRlZCB0byB0aGUgdXNlciBwaWxsXG4gICAgICAgIG1lbWJlcjogbnVsbCxcbiAgICAgICAgLy8gVGhlIGdyb3VwIHJlbGF0ZWQgdG8gdGhlIGdyb3VwIHBpbGxcbiAgICAgICAgZ3JvdXA6IG51bGwsXG4gICAgICAgIC8vIFRoZSByb29tIHJlbGF0ZWQgdG8gdGhlIHJvb20gcGlsbFxuICAgICAgICByb29tOiBudWxsLFxuICAgICAgICAvLyBJcyB0aGUgdXNlciBob3ZlcmluZyB0aGUgcGlsbFxuICAgICAgICBob3ZlcjogZmFsc2UsXG4gICAgfTtcblxuICAgIC8vIFRPRE86IFtSRUFDVC1XQVJOSU5HXSBSZXBsYWNlIHdpdGggYXBwcm9wcmlhdGUgbGlmZWN5Y2xlIGV2ZW50XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuICAgIGFzeW5jIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICBsZXQgcmVzb3VyY2VJZDtcbiAgICAgICAgbGV0IHByZWZpeDtcblxuICAgICAgICBpZiAobmV4dFByb3BzLnVybCkge1xuICAgICAgICAgICAgaWYgKG5leHRQcm9wcy5pbk1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IHBhcnNlQXBwTG9jYWxMaW5rKG5leHRQcm9wcy51cmwpO1xuICAgICAgICAgICAgICAgIHJlc291cmNlSWQgPSBwYXJ0cy5wcmltYXJ5RW50aXR5SWQ7IC8vIFRoZSByb29tL3VzZXIgSURcbiAgICAgICAgICAgICAgICBwcmVmaXggPSBwYXJ0cy5zaWdpbDsgLy8gVGhlIGZpcnN0IGNoYXJhY3RlciBvZiBwcmVmaXhcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzb3VyY2VJZCA9IGdldFByaW1hcnlQZXJtYWxpbmtFbnRpdHkobmV4dFByb3BzLnVybCk7XG4gICAgICAgICAgICAgICAgcHJlZml4ID0gcmVzb3VyY2VJZCA/IHJlc291cmNlSWRbMF0gOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwaWxsVHlwZSA9IHRoaXMucHJvcHMudHlwZSB8fCB7XG4gICAgICAgICAgICAnQCc6IFBpbGwuVFlQRV9VU0VSX01FTlRJT04sXG4gICAgICAgICAgICAnIyc6IFBpbGwuVFlQRV9ST09NX01FTlRJT04sXG4gICAgICAgICAgICAnISc6IFBpbGwuVFlQRV9ST09NX01FTlRJT04sXG4gICAgICAgICAgICAnKyc6IFBpbGwuVFlQRV9HUk9VUF9NRU5USU9OLFxuICAgICAgICB9W3ByZWZpeF07XG5cbiAgICAgICAgbGV0IG1lbWJlcjtcbiAgICAgICAgbGV0IGdyb3VwO1xuICAgICAgICBsZXQgcm9vbTtcbiAgICAgICAgc3dpdGNoIChwaWxsVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBQaWxsLlRZUEVfQVRfUk9PTV9NRU5USU9OOiB7XG4gICAgICAgICAgICAgICAgcm9vbSA9IG5leHRQcm9wcy5yb29tO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQaWxsLlRZUEVfVVNFUl9NRU5USU9OOiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbG9jYWxNZW1iZXIgPSBuZXh0UHJvcHMucm9vbSA/IG5leHRQcm9wcy5yb29tLmdldE1lbWJlcihyZXNvdXJjZUlkKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBtZW1iZXIgPSBsb2NhbE1lbWJlcjtcbiAgICAgICAgICAgICAgICBpZiAoIWxvY2FsTWVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbWJlciA9IG5ldyBSb29tTWVtYmVyKG51bGwsIHJlc291cmNlSWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRvUHJvZmlsZUxvb2t1cChyZXNvdXJjZUlkLCBtZW1iZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUGlsbC5UWVBFX1JPT01fTUVOVElPTjoge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsUm9vbSA9IHJlc291cmNlSWRbMF0gPT09ICcjJyA/XG4gICAgICAgICAgICAgICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRSb29tcygpLmZpbmQoKHIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByLmdldENhbm9uaWNhbEFsaWFzKCkgPT09IHJlc291cmNlSWQgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByLmdldEFsdEFsaWFzZXMoKS5pbmNsdWRlcyhyZXNvdXJjZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSkgOiBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0Um9vbShyZXNvdXJjZUlkKTtcbiAgICAgICAgICAgICAgICByb29tID0gbG9jYWxSb29tO1xuICAgICAgICAgICAgICAgIGlmICghbG9jYWxSb29tKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgd291bGQgcmVxdWlyZSBhIG5ldyBBUEkgdG8gcmVzb2x2ZSBhIHJvb20gYWxpYXMgdG9cbiAgICAgICAgICAgICAgICAgICAgLy8gYSByb29tIGF2YXRhciBhbmQgbmFtZS5cbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5kb1Jvb21Qcm9maWxlTG9va3VwKHJlc291cmNlSWQsIG1lbWJlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQaWxsLlRZUEVfR1JPVVBfTUVOVElPTjoge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcblxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwID0gYXdhaXQgRmxhaXJTdG9yZS5nZXRHcm91cFByb2ZpbGVDYWNoZWQoY2xpLCByZXNvdXJjZUlkKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7IC8vIGlmIEZsYWlyU3RvcmUgZmFpbGVkLCBmYWxsIGJhY2sgdG8ganVzdCBncm91cElkXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBJZDogcmVzb3VyY2VJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhclVybDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyByZXNvdXJjZUlkLCBwaWxsVHlwZSwgbWVtYmVyLCBncm91cCwgcm9vbSB9KTtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy5fdW5tb3VudGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX21hdHJpeENsaWVudCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcblxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbmV3LWNhcFxuICAgICAgICB0aGlzLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHRoaXMucHJvcHMpOyAvLyBIQUNLOiBXZSBzaG91bGRuJ3QgYmUgY2FsbGluZyBsaWZlY3ljbGUgZnVuY3Rpb25zIG91cnNlbHZlcy5cbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgdGhpcy5fdW5tb3VudGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBvbk1vdXNlT3ZlciA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBob3ZlcjogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIG9uTW91c2VMZWF2ZSA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBob3ZlcjogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBkb1Byb2ZpbGVMb29rdXAodXNlcklkLCBtZW1iZXIpIHtcbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFByb2ZpbGVJbmZvKHVzZXJJZCkudGhlbigocmVzcCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3VubW91bnRlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1lbWJlci5uYW1lID0gcmVzcC5kaXNwbGF5bmFtZTtcbiAgICAgICAgICAgIG1lbWJlci5yYXdEaXNwbGF5TmFtZSA9IHJlc3AuZGlzcGxheW5hbWU7XG4gICAgICAgICAgICBtZW1iZXIuZXZlbnRzLm1lbWJlciA9IHtcbiAgICAgICAgICAgICAgICBnZXRDb250ZW50OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGF2YXRhcl91cmw6IHJlc3AuYXZhdGFyX3VybCB9O1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ2V0RGlyZWN0aW9uYWxDb250ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29udGVudCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG1lbWJlciB9KTtcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdDb3VsZCBub3QgcmV0cmlldmUgcHJvZmlsZSBkYXRhIGZvciAnICsgdXNlcklkICsgJzonLCBlcnIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvblVzZXJQaWxsQ2xpY2tlZCA9IChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdVc2VyLFxuICAgICAgICAgICAgbWVtYmVyOiB0aGlzLnN0YXRlLm1lbWJlcixcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgQmFzZUF2YXRhciA9IHNkay5nZXRDb21wb25lbnQoJ3ZpZXdzLmF2YXRhcnMuQmFzZUF2YXRhcicpO1xuICAgICAgICBjb25zdCBNZW1iZXJBdmF0YXIgPSBzZGsuZ2V0Q29tcG9uZW50KCdhdmF0YXJzLk1lbWJlckF2YXRhcicpO1xuICAgICAgICBjb25zdCBSb29tQXZhdGFyID0gc2RrLmdldENvbXBvbmVudCgnYXZhdGFycy5Sb29tQXZhdGFyJyk7XG5cbiAgICAgICAgY29uc3QgcmVzb3VyY2UgPSB0aGlzLnN0YXRlLnJlc291cmNlSWQ7XG5cbiAgICAgICAgbGV0IGF2YXRhciA9IG51bGw7XG4gICAgICAgIGxldCBsaW5rVGV4dCA9IHJlc291cmNlO1xuICAgICAgICBsZXQgcGlsbENsYXNzO1xuICAgICAgICBsZXQgdXNlcklkO1xuICAgICAgICBsZXQgaHJlZiA9IHRoaXMucHJvcHMudXJsO1xuICAgICAgICBsZXQgb25DbGljaztcbiAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlLnBpbGxUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIFBpbGwuVFlQRV9BVF9ST09NX01FTlRJT046IHtcbiAgICAgICAgICAgICAgICBjb25zdCByb29tID0gdGhpcy5wcm9wcy5yb29tO1xuICAgICAgICAgICAgICAgIGlmIChyb29tKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmtUZXh0ID0gXCJAcm9vbVwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5zaG91bGRTaG93UGlsbEF2YXRhcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyID0gPFJvb21BdmF0YXIgcm9vbT17cm9vbX0gd2lkdGg9ezE2fSBoZWlnaHQ9ezE2fSBhcmlhLWhpZGRlbj1cInRydWVcIiAvPjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBwaWxsQ2xhc3MgPSAnbXhfQXRSb29tUGlsbCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQaWxsLlRZUEVfVVNFUl9NRU5USU9OOiB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhpcyB1c2VyIGlzIG5vdCBhIG1lbWJlciBvZiB0aGlzIHJvb20sIGRlZmF1bHQgdG8gdGhlIGVtcHR5IG1lbWJlclxuICAgICAgICAgICAgICAgIGNvbnN0IG1lbWJlciA9IHRoaXMuc3RhdGUubWVtYmVyO1xuICAgICAgICAgICAgICAgIGlmIChtZW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkID0gbWVtYmVyLnVzZXJJZDtcbiAgICAgICAgICAgICAgICAgICAgbWVtYmVyLnJhd0Rpc3BsYXlOYW1lID0gbWVtYmVyLnJhd0Rpc3BsYXlOYW1lIHx8ICcnO1xuICAgICAgICAgICAgICAgICAgICBsaW5rVGV4dCA9IG1lbWJlci5yYXdEaXNwbGF5TmFtZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuc2hvdWxkU2hvd1BpbGxBdmF0YXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhciA9IDxNZW1iZXJBdmF0YXIgbWVtYmVyPXttZW1iZXJ9IHdpZHRoPXsxNn0gaGVpZ2h0PXsxNn0gYXJpYS1oaWRkZW49XCJ0cnVlXCIgLz47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcGlsbENsYXNzID0gJ214X1VzZXJQaWxsJztcbiAgICAgICAgICAgICAgICAgICAgaHJlZiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2sgPSB0aGlzLm9uVXNlclBpbGxDbGlja2VkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUGlsbC5UWVBFX1JPT01fTUVOVElPTjoge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb20gPSB0aGlzLnN0YXRlLnJvb207XG4gICAgICAgICAgICAgICAgaWYgKHJvb20pIHtcbiAgICAgICAgICAgICAgICAgICAgbGlua1RleHQgPSByb29tLm5hbWUgfHwgcmVzb3VyY2U7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLnNob3VsZFNob3dQaWxsQXZhdGFyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdmF0YXIgPSA8Um9vbUF2YXRhciByb29tPXtyb29tfSB3aWR0aD17MTZ9IGhlaWdodD17MTZ9IGFyaWEtaGlkZGVuPVwidHJ1ZVwiIC8+O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBpbGxDbGFzcyA9ICdteF9Sb29tUGlsbCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFBpbGwuVFlQRV9HUk9VUF9NRU5USU9OOiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuZ3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBhdmF0YXJVcmwsIGdyb3VwSWQsIG5hbWUgfSA9IHRoaXMuc3RhdGUuZ3JvdXA7XG5cbiAgICAgICAgICAgICAgICAgICAgbGlua1RleHQgPSBncm91cElkO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5zaG91bGRTaG93UGlsbEF2YXRhcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyID0gPEJhc2VBdmF0YXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPXtuYW1lIHx8IGdyb3VwSWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg9ezE2fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodD17MTZ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS1oaWRkZW49XCJ0cnVlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw9e2F2YXRhclVybCA/IG1lZGlhRnJvbU14YyhhdmF0YXJVcmwpLmdldFNxdWFyZVRodW1ibmFpbEh0dHAoMTYpIDogbnVsbH0gLz47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcGlsbENsYXNzID0gJ214X0dyb3VwUGlsbCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2xhc3NlcyA9IGNsYXNzTmFtZXMoXCJteF9QaWxsXCIsIHBpbGxDbGFzcywge1xuICAgICAgICAgICAgXCJteF9Vc2VyUGlsbF9tZVwiOiB1c2VySWQgPT09IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRVc2VySWQoKSxcbiAgICAgICAgICAgIFwibXhfVXNlclBpbGxfc2VsZWN0ZWRcIjogdGhpcy5wcm9wcy5pc1NlbGVjdGVkLFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5waWxsVHlwZSkge1xuICAgICAgICAgICAgY29uc3QgeyB5T2Zmc2V0IH0gPSB0aGlzLnByb3BzO1xuXG4gICAgICAgICAgICBsZXQgdGlwO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaG92ZXIgJiYgcmVzb3VyY2UpIHtcbiAgICAgICAgICAgICAgICB0aXAgPSA8VG9vbHRpcCBsYWJlbD17cmVzb3VyY2V9IHlPZmZzZXQ9e3lPZmZzZXR9IC8+O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gPE1hdHJpeENsaWVudENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3RoaXMuX21hdHJpeENsaWVudH0+XG4gICAgICAgICAgICAgICAgeyB0aGlzLnByb3BzLmluTWVzc2FnZSA/XG4gICAgICAgICAgICAgICAgICAgIDxhXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXN9XG4gICAgICAgICAgICAgICAgICAgICAgICBocmVmPXtocmVmfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17b25DbGlja31cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtb2Zmc2V0LWtleT17dGhpcy5wcm9wcy5vZmZzZXRLZXl9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlT3Zlcj17dGhpcy5vbk1vdXNlT3Zlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17dGhpcy5vbk1vdXNlTGVhdmV9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgYXZhdGFyIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGlua1RleHQgfVxuICAgICAgICAgICAgICAgICAgICAgICAgeyB0aXAgfVxuICAgICAgICAgICAgICAgICAgICA8L2E+IDpcbiAgICAgICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlc31cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtb2Zmc2V0LWtleT17dGhpcy5wcm9wcy5vZmZzZXRLZXl9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlT3Zlcj17dGhpcy5vbk1vdXNlT3Zlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17dGhpcy5vbk1vdXNlTGVhdmV9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgYXZhdGFyIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGlua1RleHQgfVxuICAgICAgICAgICAgICAgICAgICAgICAgeyB0aXAgfVxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+IH1cbiAgICAgICAgICAgIDwvTWF0cml4Q2xpZW50Q29udGV4dC5Qcm92aWRlcj47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBEZWxpYmVyYXRlbHkgcmVuZGVyIG5vdGhpbmcgaWYgdGhlIFVSTCBpc24ndCByZWNvZ25pc2VkXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGlsbDtcbiJdfQ==