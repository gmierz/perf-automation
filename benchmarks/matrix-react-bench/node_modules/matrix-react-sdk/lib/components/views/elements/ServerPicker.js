"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _AccessibleButton = _interopRequireDefault(require("./AccessibleButton"));

var _languageHandler = require("../../../languageHandler");

var _TextWithTooltip = _interopRequireDefault(require("./TextWithTooltip"));

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _ServerPickerDialog = _interopRequireDefault(require("../dialogs/ServerPickerDialog"));

var _InfoDialog = _interopRequireDefault(require("../dialogs/InfoDialog"));

/*
Copyright 2020-2021 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const showPickerDialog = (title, serverConfig, onFinished) => {
  _Modal.default.createTrackedDialog("Server Picker", "", _ServerPickerDialog.default, {
    title,
    serverConfig,
    onFinished
  });
};

const onHelpClick = () => {
  _Modal.default.createTrackedDialog('Custom Server Dialog', '', _InfoDialog.default, {
    title: (0, _languageHandler._t)("Server Options"),
    description: (0, _languageHandler._t)("You can use the custom server options to sign into other Matrix servers by specifying " + "a different homeserver URL. This allows you to use Element with an existing Matrix account on " + "a different homeserver."),
    button: (0, _languageHandler._t)("Dismiss"),
    hasCloseButton: false,
    fixedWidth: false
  }, "mx_ServerPicker_helpDialog");
};

const ServerPicker = ({
  title,
  dialogTitle,
  serverConfig,
  onServerConfigChange
}) => {
  const disableCustomUrls = _SdkConfig.default.get()["disable_custom_urls"];

  let editBtn;

  if (!disableCustomUrls && onServerConfigChange) {
    const onClick = () => {
      showPickerDialog(dialogTitle, serverConfig, config => {
        if (config) {
          onServerConfigChange(config);
        }
      });
    };

    editBtn = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      className: "mx_ServerPicker_change",
      kind: "link",
      onClick: onClick
    }, (0, _languageHandler._t)("Edit"));
  }

  let serverName = serverConfig.isNameResolvable ? serverConfig.hsName : serverConfig.hsUrl;

  if (serverConfig.hsNameIsDifferent) {
    serverName = /*#__PURE__*/_react.default.createElement(_TextWithTooltip.default, {
      class: "mx_Login_underlinedServerName",
      tooltip: serverConfig.hsUrl
    }, serverConfig.hsName);
  }

  let desc;

  if (serverConfig.hsName === "matrix.org") {
    desc = /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_ServerPicker_desc"
    }, (0, _languageHandler._t)("Join millions for free on the largest public server"));
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ServerPicker"
  }, /*#__PURE__*/_react.default.createElement("h3", null, title || (0, _languageHandler._t)("Homeserver")), !disableCustomUrls ? /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
    className: "mx_ServerPicker_help",
    onClick: onHelpClick
  }) : null, /*#__PURE__*/_react.default.createElement("span", {
    className: "mx_ServerPicker_server"
  }, serverName), editBtn, desc);
};

var _default = ServerPicker;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL1NlcnZlclBpY2tlci50c3giXSwibmFtZXMiOlsic2hvd1BpY2tlckRpYWxvZyIsInRpdGxlIiwic2VydmVyQ29uZmlnIiwib25GaW5pc2hlZCIsIk1vZGFsIiwiY3JlYXRlVHJhY2tlZERpYWxvZyIsIlNlcnZlclBpY2tlckRpYWxvZyIsIm9uSGVscENsaWNrIiwiSW5mb0RpYWxvZyIsImRlc2NyaXB0aW9uIiwiYnV0dG9uIiwiaGFzQ2xvc2VCdXR0b24iLCJmaXhlZFdpZHRoIiwiU2VydmVyUGlja2VyIiwiZGlhbG9nVGl0bGUiLCJvblNlcnZlckNvbmZpZ0NoYW5nZSIsImRpc2FibGVDdXN0b21VcmxzIiwiU2RrQ29uZmlnIiwiZ2V0IiwiZWRpdEJ0biIsIm9uQ2xpY2siLCJjb25maWciLCJzZXJ2ZXJOYW1lIiwiaXNOYW1lUmVzb2x2YWJsZSIsImhzTmFtZSIsImhzVXJsIiwiaHNOYW1lSXNEaWZmZXJlbnQiLCJkZXNjIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFnQkE7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW9CQSxNQUFNQSxnQkFBZ0IsR0FBRyxDQUNyQkMsS0FEcUIsRUFFckJDLFlBRnFCLEVBR3JCQyxVQUhxQixLQUlwQjtBQUNEQyxpQkFBTUMsbUJBQU4sQ0FBMEIsZUFBMUIsRUFBMkMsRUFBM0MsRUFBK0NDLDJCQUEvQyxFQUFtRTtBQUFFTCxJQUFBQSxLQUFGO0FBQVNDLElBQUFBLFlBQVQ7QUFBdUJDLElBQUFBO0FBQXZCLEdBQW5FO0FBQ0gsQ0FORDs7QUFRQSxNQUFNSSxXQUFXLEdBQUcsTUFBTTtBQUN0QkgsaUJBQU1DLG1CQUFOLENBQTBCLHNCQUExQixFQUFrRCxFQUFsRCxFQUFzREcsbUJBQXRELEVBQWtFO0FBQzlEUCxJQUFBQSxLQUFLLEVBQUUseUJBQUcsZ0JBQUgsQ0FEdUQ7QUFFOURRLElBQUFBLFdBQVcsRUFBRSx5QkFBRywyRkFDWixnR0FEWSxHQUVaLHlCQUZTLENBRmlEO0FBSzlEQyxJQUFBQSxNQUFNLEVBQUUseUJBQUcsU0FBSCxDQUxzRDtBQU05REMsSUFBQUEsY0FBYyxFQUFFLEtBTjhDO0FBTzlEQyxJQUFBQSxVQUFVLEVBQUU7QUFQa0QsR0FBbEUsRUFRRyw0QkFSSDtBQVNILENBVkQ7O0FBWUEsTUFBTUMsWUFBWSxHQUFHLENBQUM7QUFBRVosRUFBQUEsS0FBRjtBQUFTYSxFQUFBQSxXQUFUO0FBQXNCWixFQUFBQSxZQUF0QjtBQUFvQ2EsRUFBQUE7QUFBcEMsQ0FBRCxLQUF3RTtBQUN6RixRQUFNQyxpQkFBaUIsR0FBR0MsbUJBQVVDLEdBQVYsR0FBZ0IscUJBQWhCLENBQTFCOztBQUVBLE1BQUlDLE9BQUo7O0FBQ0EsTUFBSSxDQUFDSCxpQkFBRCxJQUFzQkQsb0JBQTFCLEVBQWdEO0FBQzVDLFVBQU1LLE9BQU8sR0FBRyxNQUFNO0FBQ2xCcEIsTUFBQUEsZ0JBQWdCLENBQUNjLFdBQUQsRUFBY1osWUFBZCxFQUE2Qm1CLE1BQUQsSUFBb0M7QUFDNUUsWUFBSUEsTUFBSixFQUFZO0FBQ1JOLFVBQUFBLG9CQUFvQixDQUFDTSxNQUFELENBQXBCO0FBQ0g7QUFDSixPQUplLENBQWhCO0FBS0gsS0FORDs7QUFPQUYsSUFBQUEsT0FBTyxnQkFBRyw2QkFBQyx5QkFBRDtBQUFrQixNQUFBLFNBQVMsRUFBQyx3QkFBNUI7QUFBcUQsTUFBQSxJQUFJLEVBQUMsTUFBMUQ7QUFBaUUsTUFBQSxPQUFPLEVBQUVDO0FBQTFFLE9BQ0oseUJBQUcsTUFBSCxDQURJLENBQVY7QUFHSDs7QUFFRCxNQUFJRSxVQUEyQixHQUFHcEIsWUFBWSxDQUFDcUIsZ0JBQWIsR0FBZ0NyQixZQUFZLENBQUNzQixNQUE3QyxHQUFzRHRCLFlBQVksQ0FBQ3VCLEtBQXJHOztBQUNBLE1BQUl2QixZQUFZLENBQUN3QixpQkFBakIsRUFBb0M7QUFDaENKLElBQUFBLFVBQVUsZ0JBQUcsNkJBQUMsd0JBQUQ7QUFBaUIsTUFBQSxLQUFLLEVBQUMsK0JBQXZCO0FBQXVELE1BQUEsT0FBTyxFQUFFcEIsWUFBWSxDQUFDdUI7QUFBN0UsT0FDUHZCLFlBQVksQ0FBQ3NCLE1BRE4sQ0FBYjtBQUdIOztBQUVELE1BQUlHLElBQUo7O0FBQ0EsTUFBSXpCLFlBQVksQ0FBQ3NCLE1BQWIsS0FBd0IsWUFBNUIsRUFBMEM7QUFDdENHLElBQUFBLElBQUksZ0JBQUc7QUFBTSxNQUFBLFNBQVMsRUFBQztBQUFoQixPQUNELHlCQUFHLHFEQUFILENBREMsQ0FBUDtBQUdIOztBQUVELHNCQUFPO0FBQUssSUFBQSxTQUFTLEVBQUM7QUFBZixrQkFDSCx5Q0FBTTFCLEtBQUssSUFBSSx5QkFBRyxZQUFILENBQWYsQ0FERyxFQUVELENBQUNlLGlCQUFELGdCQUFxQiw2QkFBQyx5QkFBRDtBQUFrQixJQUFBLFNBQVMsRUFBQyxzQkFBNUI7QUFBbUQsSUFBQSxPQUFPLEVBQUVUO0FBQTVELElBQXJCLEdBQW1HLElBRmxHLGVBR0g7QUFBTSxJQUFBLFNBQVMsRUFBQztBQUFoQixLQUEyQ2UsVUFBM0MsQ0FIRyxFQUlESCxPQUpDLEVBS0RRLElBTEMsQ0FBUDtBQU9ILENBdENEOztlQXdDZWQsWSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMC0yMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4vQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IHsgVmFsaWRhdGVkU2VydmVyQ29uZmlnIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL0F1dG9EaXNjb3ZlcnlVdGlsc1wiO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgVGV4dFdpdGhUb29sdGlwIGZyb20gXCIuL1RleHRXaXRoVG9vbHRpcFwiO1xuaW1wb3J0IFNka0NvbmZpZyBmcm9tIFwiLi4vLi4vLi4vU2RrQ29uZmlnXCI7XG5pbXBvcnQgTW9kYWwgZnJvbSBcIi4uLy4uLy4uL01vZGFsXCI7XG5pbXBvcnQgU2VydmVyUGlja2VyRGlhbG9nIGZyb20gXCIuLi9kaWFsb2dzL1NlcnZlclBpY2tlckRpYWxvZ1wiO1xuaW1wb3J0IEluZm9EaWFsb2cgZnJvbSBcIi4uL2RpYWxvZ3MvSW5mb0RpYWxvZ1wiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICB0aXRsZT86IHN0cmluZztcbiAgICBkaWFsb2dUaXRsZT86IHN0cmluZztcbiAgICBzZXJ2ZXJDb25maWc6IFZhbGlkYXRlZFNlcnZlckNvbmZpZztcbiAgICBvblNlcnZlckNvbmZpZ0NoYW5nZT8oY29uZmlnOiBWYWxpZGF0ZWRTZXJ2ZXJDb25maWcpOiB2b2lkO1xufVxuXG5jb25zdCBzaG93UGlja2VyRGlhbG9nID0gKFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgc2VydmVyQ29uZmlnOiBWYWxpZGF0ZWRTZXJ2ZXJDb25maWcsXG4gICAgb25GaW5pc2hlZDogKGNvbmZpZzogVmFsaWRhdGVkU2VydmVyQ29uZmlnKSA9PiB2b2lkLFxuKSA9PiB7XG4gICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZyhcIlNlcnZlciBQaWNrZXJcIiwgXCJcIiwgU2VydmVyUGlja2VyRGlhbG9nLCB7IHRpdGxlLCBzZXJ2ZXJDb25maWcsIG9uRmluaXNoZWQgfSk7XG59O1xuXG5jb25zdCBvbkhlbHBDbGljayA9ICgpID0+IHtcbiAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdDdXN0b20gU2VydmVyIERpYWxvZycsICcnLCBJbmZvRGlhbG9nLCB7XG4gICAgICAgIHRpdGxlOiBfdChcIlNlcnZlciBPcHRpb25zXCIpLFxuICAgICAgICBkZXNjcmlwdGlvbjogX3QoXCJZb3UgY2FuIHVzZSB0aGUgY3VzdG9tIHNlcnZlciBvcHRpb25zIHRvIHNpZ24gaW50byBvdGhlciBNYXRyaXggc2VydmVycyBieSBzcGVjaWZ5aW5nIFwiICtcbiAgICAgICAgICAgIFwiYSBkaWZmZXJlbnQgaG9tZXNlcnZlciBVUkwuIFRoaXMgYWxsb3dzIHlvdSB0byB1c2UgRWxlbWVudCB3aXRoIGFuIGV4aXN0aW5nIE1hdHJpeCBhY2NvdW50IG9uIFwiICtcbiAgICAgICAgICAgIFwiYSBkaWZmZXJlbnQgaG9tZXNlcnZlci5cIiksXG4gICAgICAgIGJ1dHRvbjogX3QoXCJEaXNtaXNzXCIpLFxuICAgICAgICBoYXNDbG9zZUJ1dHRvbjogZmFsc2UsXG4gICAgICAgIGZpeGVkV2lkdGg6IGZhbHNlLFxuICAgIH0sIFwibXhfU2VydmVyUGlja2VyX2hlbHBEaWFsb2dcIik7XG59O1xuXG5jb25zdCBTZXJ2ZXJQaWNrZXIgPSAoeyB0aXRsZSwgZGlhbG9nVGl0bGUsIHNlcnZlckNvbmZpZywgb25TZXJ2ZXJDb25maWdDaGFuZ2UgfTogSVByb3BzKSA9PiB7XG4gICAgY29uc3QgZGlzYWJsZUN1c3RvbVVybHMgPSBTZGtDb25maWcuZ2V0KClbXCJkaXNhYmxlX2N1c3RvbV91cmxzXCJdO1xuXG4gICAgbGV0IGVkaXRCdG47XG4gICAgaWYgKCFkaXNhYmxlQ3VzdG9tVXJscyAmJiBvblNlcnZlckNvbmZpZ0NoYW5nZSkge1xuICAgICAgICBjb25zdCBvbkNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgc2hvd1BpY2tlckRpYWxvZyhkaWFsb2dUaXRsZSwgc2VydmVyQ29uZmlnLCAoY29uZmlnPzogVmFsaWRhdGVkU2VydmVyQ29uZmlnKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBvblNlcnZlckNvbmZpZ0NoYW5nZShjb25maWcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBlZGl0QnRuID0gPEFjY2Vzc2libGVCdXR0b24gY2xhc3NOYW1lPVwibXhfU2VydmVyUGlja2VyX2NoYW5nZVwiIGtpbmQ9XCJsaW5rXCIgb25DbGljaz17b25DbGlja30+XG4gICAgICAgICAgICB7IF90KFwiRWRpdFwiKSB9XG4gICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj47XG4gICAgfVxuXG4gICAgbGV0IHNlcnZlck5hbWU6IFJlYWN0LlJlYWN0Tm9kZSA9IHNlcnZlckNvbmZpZy5pc05hbWVSZXNvbHZhYmxlID8gc2VydmVyQ29uZmlnLmhzTmFtZSA6IHNlcnZlckNvbmZpZy5oc1VybDtcbiAgICBpZiAoc2VydmVyQ29uZmlnLmhzTmFtZUlzRGlmZmVyZW50KSB7XG4gICAgICAgIHNlcnZlck5hbWUgPSA8VGV4dFdpdGhUb29sdGlwIGNsYXNzPVwibXhfTG9naW5fdW5kZXJsaW5lZFNlcnZlck5hbWVcIiB0b29sdGlwPXtzZXJ2ZXJDb25maWcuaHNVcmx9PlxuICAgICAgICAgICAgeyBzZXJ2ZXJDb25maWcuaHNOYW1lIH1cbiAgICAgICAgPC9UZXh0V2l0aFRvb2x0aXA+O1xuICAgIH1cblxuICAgIGxldCBkZXNjO1xuICAgIGlmIChzZXJ2ZXJDb25maWcuaHNOYW1lID09PSBcIm1hdHJpeC5vcmdcIikge1xuICAgICAgICBkZXNjID0gPHNwYW4gY2xhc3NOYW1lPVwibXhfU2VydmVyUGlja2VyX2Rlc2NcIj5cbiAgICAgICAgICAgIHsgX3QoXCJKb2luIG1pbGxpb25zIGZvciBmcmVlIG9uIHRoZSBsYXJnZXN0IHB1YmxpYyBzZXJ2ZXJcIikgfVxuICAgICAgICA8L3NwYW4+O1xuICAgIH1cblxuICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X1NlcnZlclBpY2tlclwiPlxuICAgICAgICA8aDM+eyB0aXRsZSB8fCBfdChcIkhvbWVzZXJ2ZXJcIikgfTwvaDM+XG4gICAgICAgIHsgIWRpc2FibGVDdXN0b21VcmxzID8gPEFjY2Vzc2libGVCdXR0b24gY2xhc3NOYW1lPVwibXhfU2VydmVyUGlja2VyX2hlbHBcIiBvbkNsaWNrPXtvbkhlbHBDbGlja30gLz4gOiBudWxsIH1cbiAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2VydmVyUGlja2VyX3NlcnZlclwiPnsgc2VydmVyTmFtZSB9PC9zcGFuPlxuICAgICAgICB7IGVkaXRCdG4gfVxuICAgICAgICB7IGRlc2MgfVxuICAgIDwvZGl2Pjtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFNlcnZlclBpY2tlcjtcbiJdfQ==