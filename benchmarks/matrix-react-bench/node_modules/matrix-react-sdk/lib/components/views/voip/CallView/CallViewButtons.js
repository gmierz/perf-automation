"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _AccessibleTooltipButton = _interopRequireDefault(require("../../elements/AccessibleTooltipButton"));

var _CallContextMenu = _interopRequireDefault(require("../../context_menus/CallContextMenu"));

var _DialpadContextMenu = _interopRequireDefault(require("../../context_menus/DialpadContextMenu"));

var _Tooltip = require("../../elements/Tooltip");

var _ContextMenu = require("../../../structures/ContextMenu");

var _languageHandler = require("../../../../languageHandler");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2015, 2016 OpenMarket Ltd
Copyright 2019 - 2021 The Matrix.org Foundation C.I.C.
Copyright 2021 Å imon Brandner <simon.bra.ag@gmail.com>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
// Height of the header duplicated from CSS because we need to subtract it from our max
// height to get the max height of the video
const CONTEXT_MENU_VPADDING = 8; // How far the context menu sits above the button (px)

const TOOLTIP_Y_OFFSET = -24;
const CONTROLS_HIDE_DELAY = 2000;

const CallViewToggleButton = ({
  state: isOn,
  className,
  onLabel,
  offLabel,
  onClick
}) => {
  const classes = (0, _classnames.default)("mx_CallViewButtons_button", className, {
    mx_CallViewButtons_button_on: isOn,
    mx_CallViewButtons_button_off: !isOn
  });
  return /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
    className: classes,
    onClick: onClick,
    title: isOn ? onLabel : offLabel,
    alignment: _Tooltip.Alignment.Top,
    yOffset: TOOLTIP_Y_OFFSET
  });
};

class CallViewButtons extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dialpadButton", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "contextMenuButton", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "controlsHideTimer", null);
    (0, _defineProperty2.default)(this, "onControlsHideTimer", () => {
      if (this.state.hoveringControls || this.state.showDialpad || this.state.showMoreMenu) return;
      this.controlsHideTimer = null;
      this.setState({
        visible: false
      });
    });
    (0, _defineProperty2.default)(this, "onMouseEnter", () => {
      this.setState({
        hoveringControls: true
      });
    });
    (0, _defineProperty2.default)(this, "onMouseLeave", () => {
      this.setState({
        hoveringControls: false
      });
    });
    (0, _defineProperty2.default)(this, "onDialpadClick", () => {
      if (!this.state.showDialpad) {
        this.setState({
          showDialpad: true
        });
        this.showControls();
      } else {
        this.setState({
          showDialpad: false
        });
      }
    });
    (0, _defineProperty2.default)(this, "onMoreClick", () => {
      this.setState({
        showMoreMenu: true
      });
      this.showControls();
    });
    (0, _defineProperty2.default)(this, "closeDialpad", () => {
      this.setState({
        showDialpad: false
      });
    });
    (0, _defineProperty2.default)(this, "closeContextMenu", () => {
      this.setState({
        showMoreMenu: false
      });
    });
    this.state = {
      showDialpad: false,
      hoveringControls: false,
      showMoreMenu: false,
      visible: true
    };
  }

  componentDidMount() {
    this.showControls();
  }

  showControls() {
    if (this.state.showMoreMenu || this.state.showDialpad) return;

    if (!this.state.visible) {
      this.setState({
        visible: true
      });
    }

    if (this.controlsHideTimer !== null) {
      clearTimeout(this.controlsHideTimer);
    }

    this.controlsHideTimer = window.setTimeout(this.onControlsHideTimer, CONTROLS_HIDE_DELAY);
  }

  render() {
    const callControlsClasses = (0, _classnames.default)("mx_CallViewButtons", {
      mx_CallViewButtons_hidden: !this.state.visible
    });
    let dialPad;

    if (this.state.showDialpad) {
      dialPad = /*#__PURE__*/_react.default.createElement(_DialpadContextMenu.default, (0, _extends2.default)({}, (0, _ContextMenu.alwaysAboveRightOf)(this.dialpadButton.current.getBoundingClientRect(), _ContextMenu.ChevronFace.None, CONTEXT_MENU_VPADDING), {
        // We mount the context menus as a as a child typically in order to include the
        // context menus when fullscreening the call content.
        // However, this does not work as well when the call is embedded in a
        // picture-in-picture frame. Thus, only mount as child when we are *not* in PiP.
        mountAsChild: !this.props.pipMode,
        onFinished: this.closeDialpad,
        call: this.props.call
      }));
    }

    let contextMenu;

    if (this.state.showMoreMenu) {
      contextMenu = /*#__PURE__*/_react.default.createElement(_CallContextMenu.default, (0, _extends2.default)({}, (0, _ContextMenu.alwaysAboveLeftOf)(this.contextMenuButton.current.getBoundingClientRect(), _ContextMenu.ChevronFace.None, CONTEXT_MENU_VPADDING), {
        mountAsChild: !this.props.pipMode,
        onFinished: this.closeContextMenu,
        call: this.props.call
      }));
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: callControlsClasses,
      onMouseEnter: this.onMouseEnter,
      onMouseLeave: this.onMouseLeave
    }, dialPad, contextMenu, this.props.buttonsVisibility.dialpad && /*#__PURE__*/_react.default.createElement(_ContextMenu.ContextMenuTooltipButton, {
      className: "mx_CallViewButtons_button mx_CallViewButtons_dialpad",
      inputRef: this.dialpadButton,
      onClick: this.onDialpadClick,
      isExpanded: this.state.showDialpad,
      title: (0, _languageHandler._t)("Dialpad"),
      alignment: _Tooltip.Alignment.Top,
      yOffset: TOOLTIP_Y_OFFSET
    }), /*#__PURE__*/_react.default.createElement(CallViewToggleButton, {
      state: !this.props.buttonsState.micMuted,
      className: "mx_CallViewButtons_button_mic",
      onLabel: (0, _languageHandler._t)("Mute the microphone"),
      offLabel: (0, _languageHandler._t)("Unmute the microphone"),
      onClick: this.props.handlers.onMicMuteClick
    }), this.props.buttonsVisibility.vidMute && /*#__PURE__*/_react.default.createElement(CallViewToggleButton, {
      state: !this.props.buttonsState.vidMuted,
      className: "mx_CallViewButtons_button_vid",
      onLabel: (0, _languageHandler._t)("Stop the camera"),
      offLabel: (0, _languageHandler._t)("Start the camera"),
      onClick: this.props.handlers.onVidMuteClick
    }), this.props.buttonsVisibility.screensharing && /*#__PURE__*/_react.default.createElement(CallViewToggleButton, {
      state: this.props.buttonsState.screensharing,
      className: "mx_CallViewButtons_button_screensharing",
      onLabel: (0, _languageHandler._t)("Stop sharing your screen"),
      offLabel: (0, _languageHandler._t)("Start sharing your screen"),
      onClick: this.props.handlers.onScreenshareClick
    }), this.props.buttonsVisibility.sidebar && /*#__PURE__*/_react.default.createElement(CallViewToggleButton, {
      state: this.props.buttonsState.sidebarShown,
      className: "mx_CallViewButtons_button_sidebar",
      onLabel: (0, _languageHandler._t)("Hide sidebar"),
      offLabel: (0, _languageHandler._t)("Show sidebar"),
      onClick: this.props.handlers.onToggleSidebarClick
    }), this.props.buttonsVisibility.contextMenu && /*#__PURE__*/_react.default.createElement(_ContextMenu.ContextMenuTooltipButton, {
      className: "mx_CallViewButtons_button mx_CallViewButtons_button_more",
      onClick: this.onMoreClick,
      inputRef: this.contextMenuButton,
      isExpanded: this.state.showMoreMenu,
      title: (0, _languageHandler._t)("More"),
      alignment: _Tooltip.Alignment.Top,
      yOffset: TOOLTIP_Y_OFFSET
    }), /*#__PURE__*/_react.default.createElement(_AccessibleTooltipButton.default, {
      className: "mx_CallViewButtons_button mx_CallViewButtons_button_hangup",
      onClick: this.props.handlers.onHangupClick,
      title: (0, _languageHandler._t)("Hangup"),
      alignment: _Tooltip.Alignment.Top,
      yOffset: TOOLTIP_Y_OFFSET
    }));
  }

}

exports.default = CallViewButtons;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3ZvaXAvQ2FsbFZpZXcvQ2FsbFZpZXdCdXR0b25zLnRzeCJdLCJuYW1lcyI6WyJDT05URVhUX01FTlVfVlBBRERJTkciLCJUT09MVElQX1lfT0ZGU0VUIiwiQ09OVFJPTFNfSElERV9ERUxBWSIsIkNhbGxWaWV3VG9nZ2xlQnV0dG9uIiwic3RhdGUiLCJpc09uIiwiY2xhc3NOYW1lIiwib25MYWJlbCIsIm9mZkxhYmVsIiwib25DbGljayIsImNsYXNzZXMiLCJteF9DYWxsVmlld0J1dHRvbnNfYnV0dG9uX29uIiwibXhfQ2FsbFZpZXdCdXR0b25zX2J1dHRvbl9vZmYiLCJBbGlnbm1lbnQiLCJUb3AiLCJDYWxsVmlld0J1dHRvbnMiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJob3ZlcmluZ0NvbnRyb2xzIiwic2hvd0RpYWxwYWQiLCJzaG93TW9yZU1lbnUiLCJjb250cm9sc0hpZGVUaW1lciIsInNldFN0YXRlIiwidmlzaWJsZSIsInNob3dDb250cm9scyIsImNvbXBvbmVudERpZE1vdW50IiwiY2xlYXJUaW1lb3V0Iiwid2luZG93Iiwic2V0VGltZW91dCIsIm9uQ29udHJvbHNIaWRlVGltZXIiLCJyZW5kZXIiLCJjYWxsQ29udHJvbHNDbGFzc2VzIiwibXhfQ2FsbFZpZXdCdXR0b25zX2hpZGRlbiIsImRpYWxQYWQiLCJkaWFscGFkQnV0dG9uIiwiY3VycmVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsIkNoZXZyb25GYWNlIiwiTm9uZSIsInBpcE1vZGUiLCJjbG9zZURpYWxwYWQiLCJjYWxsIiwiY29udGV4dE1lbnUiLCJjb250ZXh0TWVudUJ1dHRvbiIsImNsb3NlQ29udGV4dE1lbnUiLCJvbk1vdXNlRW50ZXIiLCJvbk1vdXNlTGVhdmUiLCJidXR0b25zVmlzaWJpbGl0eSIsImRpYWxwYWQiLCJvbkRpYWxwYWRDbGljayIsImJ1dHRvbnNTdGF0ZSIsIm1pY011dGVkIiwiaGFuZGxlcnMiLCJvbk1pY011dGVDbGljayIsInZpZE11dGUiLCJ2aWRNdXRlZCIsIm9uVmlkTXV0ZUNsaWNrIiwic2NyZWVuc2hhcmluZyIsIm9uU2NyZWVuc2hhcmVDbGljayIsInNpZGViYXIiLCJzaWRlYmFyU2hvd24iLCJvblRvZ2dsZVNpZGViYXJDbGljayIsIm9uTW9yZUNsaWNrIiwib25IYW5ndXBDbGljayJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQWtCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFNQTs7Ozs7O0FBL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFpQkE7QUFDQTtBQUNBLE1BQU1BLHFCQUFxQixHQUFHLENBQTlCLEMsQ0FBaUM7O0FBRWpDLE1BQU1DLGdCQUFnQixHQUFHLENBQUMsRUFBMUI7QUFFQSxNQUFNQyxtQkFBbUIsR0FBRyxJQUE1Qjs7QUFVQSxNQUFNQyxvQkFBNEMsR0FBRyxDQUFDO0FBQUVDLEVBQUFBLEtBQUssRUFBRUMsSUFBVDtBQUFlQyxFQUFBQSxTQUFmO0FBQTBCQyxFQUFBQSxPQUExQjtBQUFtQ0MsRUFBQUEsUUFBbkM7QUFBNkNDLEVBQUFBO0FBQTdDLENBQUQsS0FBNEQ7QUFDN0csUUFBTUMsT0FBTyxHQUFHLHlCQUFXLDJCQUFYLEVBQXdDSixTQUF4QyxFQUFtRDtBQUMvREssSUFBQUEsNEJBQTRCLEVBQUVOLElBRGlDO0FBRS9ETyxJQUFBQSw2QkFBNkIsRUFBRSxDQUFDUDtBQUYrQixHQUFuRCxDQUFoQjtBQUtBLHNCQUNJLDZCQUFDLGdDQUFEO0FBQ0ksSUFBQSxTQUFTLEVBQUVLLE9BRGY7QUFFSSxJQUFBLE9BQU8sRUFBRUQsT0FGYjtBQUdJLElBQUEsS0FBSyxFQUFFSixJQUFJLEdBQUdFLE9BQUgsR0FBYUMsUUFINUI7QUFJSSxJQUFBLFNBQVMsRUFBRUssbUJBQVVDLEdBSnpCO0FBS0ksSUFBQSxPQUFPLEVBQUViO0FBTGIsSUFESjtBQVNILENBZkQ7O0FBaURlLE1BQU1jLGVBQU4sU0FBOEJDLGVBQU1DLFNBQXBDLENBQThEO0FBS3pFQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBZ0I7QUFDdkIsVUFBTUEsS0FBTjtBQUR1QixzRUFKSCx1QkFJRztBQUFBLDBFQUhDLHVCQUdEO0FBQUEsNkRBRlMsSUFFVDtBQUFBLCtEQTZCRyxNQUFZO0FBQ3RDLFVBQUksS0FBS2YsS0FBTCxDQUFXZ0IsZ0JBQVgsSUFBK0IsS0FBS2hCLEtBQUwsQ0FBV2lCLFdBQTFDLElBQXlELEtBQUtqQixLQUFMLENBQVdrQixZQUF4RSxFQUFzRjtBQUN0RixXQUFLQyxpQkFBTCxHQUF5QixJQUF6QjtBQUNBLFdBQUtDLFFBQUwsQ0FBYztBQUFFQyxRQUFBQSxPQUFPLEVBQUU7QUFBWCxPQUFkO0FBQ0gsS0FqQzBCO0FBQUEsd0RBbUNKLE1BQVk7QUFDL0IsV0FBS0QsUUFBTCxDQUFjO0FBQUVKLFFBQUFBLGdCQUFnQixFQUFFO0FBQXBCLE9BQWQ7QUFDSCxLQXJDMEI7QUFBQSx3REF1Q0osTUFBWTtBQUMvQixXQUFLSSxRQUFMLENBQWM7QUFBRUosUUFBQUEsZ0JBQWdCLEVBQUU7QUFBcEIsT0FBZDtBQUNILEtBekMwQjtBQUFBLDBEQTJDRixNQUFZO0FBQ2pDLFVBQUksQ0FBQyxLQUFLaEIsS0FBTCxDQUFXaUIsV0FBaEIsRUFBNkI7QUFDekIsYUFBS0csUUFBTCxDQUFjO0FBQUVILFVBQUFBLFdBQVcsRUFBRTtBQUFmLFNBQWQ7QUFDQSxhQUFLSyxZQUFMO0FBQ0gsT0FIRCxNQUdPO0FBQ0gsYUFBS0YsUUFBTCxDQUFjO0FBQUVILFVBQUFBLFdBQVcsRUFBRTtBQUFmLFNBQWQ7QUFDSDtBQUNKLEtBbEQwQjtBQUFBLHVEQW9ETCxNQUFZO0FBQzlCLFdBQUtHLFFBQUwsQ0FBYztBQUFFRixRQUFBQSxZQUFZLEVBQUU7QUFBaEIsT0FBZDtBQUNBLFdBQUtJLFlBQUw7QUFDSCxLQXZEMEI7QUFBQSx3REF5REosTUFBWTtBQUMvQixXQUFLRixRQUFMLENBQWM7QUFBRUgsUUFBQUEsV0FBVyxFQUFFO0FBQWYsT0FBZDtBQUNILEtBM0QwQjtBQUFBLDREQTZEQSxNQUFZO0FBQ25DLFdBQUtHLFFBQUwsQ0FBYztBQUFFRixRQUFBQSxZQUFZLEVBQUU7QUFBaEIsT0FBZDtBQUNILEtBL0QwQjtBQUd2QixTQUFLbEIsS0FBTCxHQUFhO0FBQ1RpQixNQUFBQSxXQUFXLEVBQUUsS0FESjtBQUVURCxNQUFBQSxnQkFBZ0IsRUFBRSxLQUZUO0FBR1RFLE1BQUFBLFlBQVksRUFBRSxLQUhMO0FBSVRHLE1BQUFBLE9BQU8sRUFBRTtBQUpBLEtBQWI7QUFNSDs7QUFFTUUsRUFBQUEsaUJBQWlCLEdBQVM7QUFDN0IsU0FBS0QsWUFBTDtBQUNIOztBQUVNQSxFQUFBQSxZQUFZLEdBQVM7QUFDeEIsUUFBSSxLQUFLdEIsS0FBTCxDQUFXa0IsWUFBWCxJQUEyQixLQUFLbEIsS0FBTCxDQUFXaUIsV0FBMUMsRUFBdUQ7O0FBRXZELFFBQUksQ0FBQyxLQUFLakIsS0FBTCxDQUFXcUIsT0FBaEIsRUFBeUI7QUFDckIsV0FBS0QsUUFBTCxDQUFjO0FBQ1ZDLFFBQUFBLE9BQU8sRUFBRTtBQURDLE9BQWQ7QUFHSDs7QUFDRCxRQUFJLEtBQUtGLGlCQUFMLEtBQTJCLElBQS9CLEVBQXFDO0FBQ2pDSyxNQUFBQSxZQUFZLENBQUMsS0FBS0wsaUJBQU4sQ0FBWjtBQUNIOztBQUNELFNBQUtBLGlCQUFMLEdBQXlCTSxNQUFNLENBQUNDLFVBQVAsQ0FBa0IsS0FBS0MsbUJBQXZCLEVBQTRDN0IsbUJBQTVDLENBQXpCO0FBQ0g7O0FBc0NNOEIsRUFBQUEsTUFBTSxHQUFnQjtBQUN6QixVQUFNQyxtQkFBbUIsR0FBRyx5QkFBVyxvQkFBWCxFQUFpQztBQUN6REMsTUFBQUEseUJBQXlCLEVBQUUsQ0FBQyxLQUFLOUIsS0FBTCxDQUFXcUI7QUFEa0IsS0FBakMsQ0FBNUI7QUFJQSxRQUFJVSxPQUFKOztBQUNBLFFBQUksS0FBSy9CLEtBQUwsQ0FBV2lCLFdBQWYsRUFBNEI7QUFDeEJjLE1BQUFBLE9BQU8sZ0JBQUcsNkJBQUMsMkJBQUQsNkJBQ0YscUNBQ0EsS0FBS0MsYUFBTCxDQUFtQkMsT0FBbkIsQ0FBMkJDLHFCQUEzQixFQURBLEVBRUFDLHlCQUFZQyxJQUZaLEVBR0F4QyxxQkFIQSxDQURFO0FBTU47QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFBLFlBQVksRUFBRSxDQUFDLEtBQUttQixLQUFMLENBQVdzQixPQVZwQjtBQVdOLFFBQUEsVUFBVSxFQUFFLEtBQUtDLFlBWFg7QUFZTixRQUFBLElBQUksRUFBRSxLQUFLdkIsS0FBTCxDQUFXd0I7QUFaWCxTQUFWO0FBY0g7O0FBRUQsUUFBSUMsV0FBSjs7QUFDQSxRQUFJLEtBQUt4QyxLQUFMLENBQVdrQixZQUFmLEVBQTZCO0FBQ3pCc0IsTUFBQUEsV0FBVyxnQkFBRyw2QkFBQyx3QkFBRCw2QkFDTixvQ0FDQSxLQUFLQyxpQkFBTCxDQUF1QlIsT0FBdkIsQ0FBK0JDLHFCQUEvQixFQURBLEVBRUFDLHlCQUFZQyxJQUZaLEVBR0F4QyxxQkFIQSxDQURNO0FBTVYsUUFBQSxZQUFZLEVBQUUsQ0FBQyxLQUFLbUIsS0FBTCxDQUFXc0IsT0FOaEI7QUFPVixRQUFBLFVBQVUsRUFBRSxLQUFLSyxnQkFQUDtBQVFWLFFBQUEsSUFBSSxFQUFFLEtBQUszQixLQUFMLENBQVd3QjtBQVJQLFNBQWQ7QUFVSDs7QUFFRCx3QkFDSTtBQUNJLE1BQUEsU0FBUyxFQUFFVixtQkFEZjtBQUVJLE1BQUEsWUFBWSxFQUFFLEtBQUtjLFlBRnZCO0FBR0ksTUFBQSxZQUFZLEVBQUUsS0FBS0M7QUFIdkIsT0FLTWIsT0FMTixFQU1NUyxXQU5OLEVBUU0sS0FBS3pCLEtBQUwsQ0FBVzhCLGlCQUFYLENBQTZCQyxPQUE3QixpQkFBd0MsNkJBQUMscUNBQUQ7QUFDdEMsTUFBQSxTQUFTLEVBQUMsc0RBRDRCO0FBRXRDLE1BQUEsUUFBUSxFQUFFLEtBQUtkLGFBRnVCO0FBR3RDLE1BQUEsT0FBTyxFQUFFLEtBQUtlLGNBSHdCO0FBSXRDLE1BQUEsVUFBVSxFQUFFLEtBQUsvQyxLQUFMLENBQVdpQixXQUplO0FBS3RDLE1BQUEsS0FBSyxFQUFFLHlCQUFHLFNBQUgsQ0FMK0I7QUFNdEMsTUFBQSxTQUFTLEVBQUVSLG1CQUFVQyxHQU5pQjtBQU90QyxNQUFBLE9BQU8sRUFBRWI7QUFQNkIsTUFSOUMsZUFpQkksNkJBQUMsb0JBQUQ7QUFDSSxNQUFBLEtBQUssRUFBRSxDQUFDLEtBQUtrQixLQUFMLENBQVdpQyxZQUFYLENBQXdCQyxRQURwQztBQUVJLE1BQUEsU0FBUyxFQUFDLCtCQUZkO0FBR0ksTUFBQSxPQUFPLEVBQUUseUJBQUcscUJBQUgsQ0FIYjtBQUlJLE1BQUEsUUFBUSxFQUFFLHlCQUFHLHVCQUFILENBSmQ7QUFLSSxNQUFBLE9BQU8sRUFBRSxLQUFLbEMsS0FBTCxDQUFXbUMsUUFBWCxDQUFvQkM7QUFMakMsTUFqQkosRUF3Qk0sS0FBS3BDLEtBQUwsQ0FBVzhCLGlCQUFYLENBQTZCTyxPQUE3QixpQkFBd0MsNkJBQUMsb0JBQUQ7QUFDdEMsTUFBQSxLQUFLLEVBQUUsQ0FBQyxLQUFLckMsS0FBTCxDQUFXaUMsWUFBWCxDQUF3QkssUUFETTtBQUV0QyxNQUFBLFNBQVMsRUFBQywrQkFGNEI7QUFHdEMsTUFBQSxPQUFPLEVBQUUseUJBQUcsaUJBQUgsQ0FINkI7QUFJdEMsTUFBQSxRQUFRLEVBQUUseUJBQUcsa0JBQUgsQ0FKNEI7QUFLdEMsTUFBQSxPQUFPLEVBQUUsS0FBS3RDLEtBQUwsQ0FBV21DLFFBQVgsQ0FBb0JJO0FBTFMsTUF4QjlDLEVBK0JNLEtBQUt2QyxLQUFMLENBQVc4QixpQkFBWCxDQUE2QlUsYUFBN0IsaUJBQThDLDZCQUFDLG9CQUFEO0FBQzVDLE1BQUEsS0FBSyxFQUFFLEtBQUt4QyxLQUFMLENBQVdpQyxZQUFYLENBQXdCTyxhQURhO0FBRTVDLE1BQUEsU0FBUyxFQUFDLHlDQUZrQztBQUc1QyxNQUFBLE9BQU8sRUFBRSx5QkFBRywwQkFBSCxDQUhtQztBQUk1QyxNQUFBLFFBQVEsRUFBRSx5QkFBRywyQkFBSCxDQUprQztBQUs1QyxNQUFBLE9BQU8sRUFBRSxLQUFLeEMsS0FBTCxDQUFXbUMsUUFBWCxDQUFvQk07QUFMZSxNQS9CcEQsRUFzQ00sS0FBS3pDLEtBQUwsQ0FBVzhCLGlCQUFYLENBQTZCWSxPQUE3QixpQkFBd0MsNkJBQUMsb0JBQUQ7QUFDdEMsTUFBQSxLQUFLLEVBQUUsS0FBSzFDLEtBQUwsQ0FBV2lDLFlBQVgsQ0FBd0JVLFlBRE87QUFFdEMsTUFBQSxTQUFTLEVBQUMsbUNBRjRCO0FBR3RDLE1BQUEsT0FBTyxFQUFFLHlCQUFHLGNBQUgsQ0FINkI7QUFJdEMsTUFBQSxRQUFRLEVBQUUseUJBQUcsY0FBSCxDQUo0QjtBQUt0QyxNQUFBLE9BQU8sRUFBRSxLQUFLM0MsS0FBTCxDQUFXbUMsUUFBWCxDQUFvQlM7QUFMUyxNQXRDOUMsRUE2Q00sS0FBSzVDLEtBQUwsQ0FBVzhCLGlCQUFYLENBQTZCTCxXQUE3QixpQkFBNEMsNkJBQUMscUNBQUQ7QUFDMUMsTUFBQSxTQUFTLEVBQUMsMERBRGdDO0FBRTFDLE1BQUEsT0FBTyxFQUFFLEtBQUtvQixXQUY0QjtBQUcxQyxNQUFBLFFBQVEsRUFBRSxLQUFLbkIsaUJBSDJCO0FBSTFDLE1BQUEsVUFBVSxFQUFFLEtBQUt6QyxLQUFMLENBQVdrQixZQUptQjtBQUsxQyxNQUFBLEtBQUssRUFBRSx5QkFBRyxNQUFILENBTG1DO0FBTTFDLE1BQUEsU0FBUyxFQUFFVCxtQkFBVUMsR0FOcUI7QUFPMUMsTUFBQSxPQUFPLEVBQUViO0FBUGlDLE1BN0NsRCxlQXNESSw2QkFBQyxnQ0FBRDtBQUNJLE1BQUEsU0FBUyxFQUFDLDREQURkO0FBRUksTUFBQSxPQUFPLEVBQUUsS0FBS2tCLEtBQUwsQ0FBV21DLFFBQVgsQ0FBb0JXLGFBRmpDO0FBR0ksTUFBQSxLQUFLLEVBQUUseUJBQUcsUUFBSCxDQUhYO0FBSUksTUFBQSxTQUFTLEVBQUVwRCxtQkFBVUMsR0FKekI7QUFLSSxNQUFBLE9BQU8sRUFBRWI7QUFMYixNQXRESixDQURKO0FBZ0VIOztBQTNLd0UiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUsIDIwMTYgT3Blbk1hcmtldCBMdGRcbkNvcHlyaWdodCAyMDE5IC0gMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuQ29weXJpZ2h0IDIwMjEgxaBpbW9uIEJyYW5kbmVyIDxzaW1vbi5icmEuYWdAZ21haWwuY29tPlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwgeyBjcmVhdGVSZWYgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCI7XG5pbXBvcnQgQWNjZXNzaWJsZVRvb2x0aXBCdXR0b24gZnJvbSBcIi4uLy4uL2VsZW1lbnRzL0FjY2Vzc2libGVUb29sdGlwQnV0dG9uXCI7XG5pbXBvcnQgQ2FsbENvbnRleHRNZW51IGZyb20gXCIuLi8uLi9jb250ZXh0X21lbnVzL0NhbGxDb250ZXh0TWVudVwiO1xuaW1wb3J0IERpYWxwYWRDb250ZXh0TWVudSBmcm9tIFwiLi4vLi4vY29udGV4dF9tZW51cy9EaWFscGFkQ29udGV4dE1lbnVcIjtcbmltcG9ydCB7IE1hdHJpeENhbGwgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvd2VicnRjL2NhbGxcIjtcbmltcG9ydCB7IEFsaWdubWVudCB9IGZyb20gXCIuLi8uLi9lbGVtZW50cy9Ub29sdGlwXCI7XG5pbXBvcnQge1xuICAgIGFsd2F5c0Fib3ZlTGVmdE9mLFxuICAgIGFsd2F5c0Fib3ZlUmlnaHRPZixcbiAgICBDaGV2cm9uRmFjZSxcbiAgICBDb250ZXh0TWVudVRvb2x0aXBCdXR0b24sXG59IGZyb20gJy4uLy4uLy4uL3N0cnVjdHVyZXMvQ29udGV4dE1lbnUnO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5cbi8vIEhlaWdodCBvZiB0aGUgaGVhZGVyIGR1cGxpY2F0ZWQgZnJvbSBDU1MgYmVjYXVzZSB3ZSBuZWVkIHRvIHN1YnRyYWN0IGl0IGZyb20gb3VyIG1heFxuLy8gaGVpZ2h0IHRvIGdldCB0aGUgbWF4IGhlaWdodCBvZiB0aGUgdmlkZW9cbmNvbnN0IENPTlRFWFRfTUVOVV9WUEFERElORyA9IDg7IC8vIEhvdyBmYXIgdGhlIGNvbnRleHQgbWVudSBzaXRzIGFib3ZlIHRoZSBidXR0b24gKHB4KVxuXG5jb25zdCBUT09MVElQX1lfT0ZGU0VUID0gLTI0O1xuXG5jb25zdCBDT05UUk9MU19ISURFX0RFTEFZID0gMjAwMDtcblxuaW50ZXJmYWNlIElCdXR0b25Qcm9wcyB7XG4gICAgc3RhdGU6IGJvb2xlYW47XG4gICAgY2xhc3NOYW1lOiBzdHJpbmc7XG4gICAgb25MYWJlbDogc3RyaW5nO1xuICAgIG9mZkxhYmVsOiBzdHJpbmc7XG4gICAgb25DbGljazogKCkgPT4gdm9pZDtcbn1cblxuY29uc3QgQ2FsbFZpZXdUb2dnbGVCdXR0b246IFJlYWN0LkZDPElCdXR0b25Qcm9wcz4gPSAoeyBzdGF0ZTogaXNPbiwgY2xhc3NOYW1lLCBvbkxhYmVsLCBvZmZMYWJlbCwgb25DbGljayB9KSA9PiB7XG4gICAgY29uc3QgY2xhc3NlcyA9IGNsYXNzTmFtZXMoXCJteF9DYWxsVmlld0J1dHRvbnNfYnV0dG9uXCIsIGNsYXNzTmFtZSwge1xuICAgICAgICBteF9DYWxsVmlld0J1dHRvbnNfYnV0dG9uX29uOiBpc09uLFxuICAgICAgICBteF9DYWxsVmlld0J1dHRvbnNfYnV0dG9uX29mZjogIWlzT24sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlc31cbiAgICAgICAgICAgIG9uQ2xpY2s9e29uQ2xpY2t9XG4gICAgICAgICAgICB0aXRsZT17aXNPbiA/IG9uTGFiZWwgOiBvZmZMYWJlbH1cbiAgICAgICAgICAgIGFsaWdubWVudD17QWxpZ25tZW50LlRvcH1cbiAgICAgICAgICAgIHlPZmZzZXQ9e1RPT0xUSVBfWV9PRkZTRVR9XG4gICAgICAgIC8+XG4gICAgKTtcbn07XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGNhbGw6IE1hdHJpeENhbGw7XG4gICAgcGlwTW9kZTogYm9vbGVhbjtcbiAgICBoYW5kbGVyczoge1xuICAgICAgICBvbkhhbmd1cENsaWNrOiAoKSA9PiB2b2lkO1xuICAgICAgICBvblNjcmVlbnNoYXJlQ2xpY2s6ICgpID0+IHZvaWQ7XG4gICAgICAgIG9uVG9nZ2xlU2lkZWJhckNsaWNrOiAoKSA9PiB2b2lkO1xuICAgICAgICBvbk1pY011dGVDbGljazogKCkgPT4gdm9pZDtcbiAgICAgICAgb25WaWRNdXRlQ2xpY2s6ICgpID0+IHZvaWQ7XG4gICAgfTtcbiAgICBidXR0b25zU3RhdGU6IHtcbiAgICAgICAgbWljTXV0ZWQ6IGJvb2xlYW47XG4gICAgICAgIHZpZE11dGVkOiBib29sZWFuO1xuICAgICAgICBzaWRlYmFyU2hvd246IGJvb2xlYW47XG4gICAgICAgIHNjcmVlbnNoYXJpbmc6IGJvb2xlYW47XG4gICAgfTtcbiAgICBidXR0b25zVmlzaWJpbGl0eToge1xuICAgICAgICBzY3JlZW5zaGFyaW5nOiBib29sZWFuO1xuICAgICAgICB2aWRNdXRlOiBib29sZWFuO1xuICAgICAgICBzaWRlYmFyOiBib29sZWFuO1xuICAgICAgICBkaWFscGFkOiBib29sZWFuO1xuICAgICAgICBjb250ZXh0TWVudTogYm9vbGVhbjtcbiAgICB9O1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICB2aXNpYmxlOiBib29sZWFuO1xuICAgIHNob3dEaWFscGFkOiBib29sZWFuO1xuICAgIGhvdmVyaW5nQ29udHJvbHM6IGJvb2xlYW47XG4gICAgc2hvd01vcmVNZW51OiBib29sZWFuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYWxsVmlld0J1dHRvbnMgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIGRpYWxwYWRCdXR0b24gPSBjcmVhdGVSZWY8SFRNTERpdkVsZW1lbnQ+KCk7XG4gICAgcHJpdmF0ZSBjb250ZXh0TWVudUJ1dHRvbiA9IGNyZWF0ZVJlZjxIVE1MRGl2RWxlbWVudD4oKTtcbiAgICBwcml2YXRlIGNvbnRyb2xzSGlkZVRpbWVyOiBudW1iZXIgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHNob3dEaWFscGFkOiBmYWxzZSxcbiAgICAgICAgICAgIGhvdmVyaW5nQ29udHJvbHM6IGZhbHNlLFxuICAgICAgICAgICAgc2hvd01vcmVNZW51OiBmYWxzZSxcbiAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNob3dDb250cm9scygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzaG93Q29udHJvbHMoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnNob3dNb3JlTWVudSB8fCB0aGlzLnN0YXRlLnNob3dEaWFscGFkKSByZXR1cm47XG5cbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLnZpc2libGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb250cm9sc0hpZGVUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY29udHJvbHNIaWRlVGltZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udHJvbHNIaWRlVGltZXIgPSB3aW5kb3cuc2V0VGltZW91dCh0aGlzLm9uQ29udHJvbHNIaWRlVGltZXIsIENPTlRST0xTX0hJREVfREVMQVkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25Db250cm9sc0hpZGVUaW1lciA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaG92ZXJpbmdDb250cm9scyB8fCB0aGlzLnN0YXRlLnNob3dEaWFscGFkIHx8IHRoaXMuc3RhdGUuc2hvd01vcmVNZW51KSByZXR1cm47XG4gICAgICAgIHRoaXMuY29udHJvbHNIaWRlVGltZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmlzaWJsZTogZmFsc2UgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Nb3VzZUVudGVyID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaG92ZXJpbmdDb250cm9sczogdHJ1ZSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbk1vdXNlTGVhdmUgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBob3ZlcmluZ0NvbnRyb2xzOiBmYWxzZSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkRpYWxwYWRDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLnNob3dEaWFscGFkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd0RpYWxwYWQ6IHRydWUgfSk7XG4gICAgICAgICAgICB0aGlzLnNob3dDb250cm9scygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dEaWFscGFkOiBmYWxzZSB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uTW9yZUNsaWNrID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd01vcmVNZW51OiB0cnVlIH0pO1xuICAgICAgICB0aGlzLnNob3dDb250cm9scygpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGNsb3NlRGlhbHBhZCA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dEaWFscGFkOiBmYWxzZSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjbG9zZUNvbnRleHRNZW51ID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd01vcmVNZW51OiBmYWxzZSB9KTtcbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGNvbnN0IGNhbGxDb250cm9sc0NsYXNzZXMgPSBjbGFzc05hbWVzKFwibXhfQ2FsbFZpZXdCdXR0b25zXCIsIHtcbiAgICAgICAgICAgIG14X0NhbGxWaWV3QnV0dG9uc19oaWRkZW46ICF0aGlzLnN0YXRlLnZpc2libGUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBkaWFsUGFkO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5zaG93RGlhbHBhZCkge1xuICAgICAgICAgICAgZGlhbFBhZCA9IDxEaWFscGFkQ29udGV4dE1lbnVcbiAgICAgICAgICAgICAgICB7Li4uYWx3YXlzQWJvdmVSaWdodE9mKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpYWxwYWRCdXR0b24uY3VycmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgICAgICAgICAgQ2hldnJvbkZhY2UuTm9uZSxcbiAgICAgICAgICAgICAgICAgICAgQ09OVEVYVF9NRU5VX1ZQQURESU5HLFxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgLy8gV2UgbW91bnQgdGhlIGNvbnRleHQgbWVudXMgYXMgYSBhcyBhIGNoaWxkIHR5cGljYWxseSBpbiBvcmRlciB0byBpbmNsdWRlIHRoZVxuICAgICAgICAgICAgICAgIC8vIGNvbnRleHQgbWVudXMgd2hlbiBmdWxsc2NyZWVuaW5nIHRoZSBjYWxsIGNvbnRlbnQuXG4gICAgICAgICAgICAgICAgLy8gSG93ZXZlciwgdGhpcyBkb2VzIG5vdCB3b3JrIGFzIHdlbGwgd2hlbiB0aGUgY2FsbCBpcyBlbWJlZGRlZCBpbiBhXG4gICAgICAgICAgICAgICAgLy8gcGljdHVyZS1pbi1waWN0dXJlIGZyYW1lLiBUaHVzLCBvbmx5IG1vdW50IGFzIGNoaWxkIHdoZW4gd2UgYXJlICpub3QqIGluIFBpUC5cbiAgICAgICAgICAgICAgICBtb3VudEFzQ2hpbGQ9eyF0aGlzLnByb3BzLnBpcE1vZGV9XG4gICAgICAgICAgICAgICAgb25GaW5pc2hlZD17dGhpcy5jbG9zZURpYWxwYWR9XG4gICAgICAgICAgICAgICAgY2FsbD17dGhpcy5wcm9wcy5jYWxsfVxuICAgICAgICAgICAgLz47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgY29udGV4dE1lbnU7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnNob3dNb3JlTWVudSkge1xuICAgICAgICAgICAgY29udGV4dE1lbnUgPSA8Q2FsbENvbnRleHRNZW51XG4gICAgICAgICAgICAgICAgey4uLmFsd2F5c0Fib3ZlTGVmdE9mKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHRNZW51QnV0dG9uLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICAgICAgICAgIENoZXZyb25GYWNlLk5vbmUsXG4gICAgICAgICAgICAgICAgICAgIENPTlRFWFRfTUVOVV9WUEFERElORyxcbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgIG1vdW50QXNDaGlsZD17IXRoaXMucHJvcHMucGlwTW9kZX1cbiAgICAgICAgICAgICAgICBvbkZpbmlzaGVkPXt0aGlzLmNsb3NlQ29udGV4dE1lbnV9XG4gICAgICAgICAgICAgICAgY2FsbD17dGhpcy5wcm9wcy5jYWxsfVxuICAgICAgICAgICAgLz47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2FsbENvbnRyb2xzQ2xhc3Nlc31cbiAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI9e3RoaXMub25Nb3VzZUVudGVyfVxuICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17dGhpcy5vbk1vdXNlTGVhdmV9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgeyBkaWFsUGFkIH1cbiAgICAgICAgICAgICAgICB7IGNvbnRleHRNZW51IH1cblxuICAgICAgICAgICAgICAgIHsgdGhpcy5wcm9wcy5idXR0b25zVmlzaWJpbGl0eS5kaWFscGFkICYmIDxDb250ZXh0TWVudVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfQ2FsbFZpZXdCdXR0b25zX2J1dHRvbiBteF9DYWxsVmlld0J1dHRvbnNfZGlhbHBhZFwiXG4gICAgICAgICAgICAgICAgICAgIGlucHV0UmVmPXt0aGlzLmRpYWxwYWRCdXR0b259XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25EaWFscGFkQ2xpY2t9XG4gICAgICAgICAgICAgICAgICAgIGlzRXhwYW5kZWQ9e3RoaXMuc3RhdGUuc2hvd0RpYWxwYWR9XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlPXtfdChcIkRpYWxwYWRcIil9XG4gICAgICAgICAgICAgICAgICAgIGFsaWdubWVudD17QWxpZ25tZW50LlRvcH1cbiAgICAgICAgICAgICAgICAgICAgeU9mZnNldD17VE9PTFRJUF9ZX09GRlNFVH1cbiAgICAgICAgICAgICAgICAvPiB9XG4gICAgICAgICAgICAgICAgPENhbGxWaWV3VG9nZ2xlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlPXshdGhpcy5wcm9wcy5idXR0b25zU3RhdGUubWljTXV0ZWR9XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0NhbGxWaWV3QnV0dG9uc19idXR0b25fbWljXCJcbiAgICAgICAgICAgICAgICAgICAgb25MYWJlbD17X3QoXCJNdXRlIHRoZSBtaWNyb3Bob25lXCIpfVxuICAgICAgICAgICAgICAgICAgICBvZmZMYWJlbD17X3QoXCJVbm11dGUgdGhlIG1pY3JvcGhvbmVcIil9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMucHJvcHMuaGFuZGxlcnMub25NaWNNdXRlQ2xpY2t9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMuYnV0dG9uc1Zpc2liaWxpdHkudmlkTXV0ZSAmJiA8Q2FsbFZpZXdUb2dnbGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgc3RhdGU9eyF0aGlzLnByb3BzLmJ1dHRvbnNTdGF0ZS52aWRNdXRlZH1cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfQ2FsbFZpZXdCdXR0b25zX2J1dHRvbl92aWRcIlxuICAgICAgICAgICAgICAgICAgICBvbkxhYmVsPXtfdChcIlN0b3AgdGhlIGNhbWVyYVwiKX1cbiAgICAgICAgICAgICAgICAgICAgb2ZmTGFiZWw9e190KFwiU3RhcnQgdGhlIGNhbWVyYVwiKX1cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5wcm9wcy5oYW5kbGVycy5vblZpZE11dGVDbGlja31cbiAgICAgICAgICAgICAgICAvPiB9XG4gICAgICAgICAgICAgICAgeyB0aGlzLnByb3BzLmJ1dHRvbnNWaXNpYmlsaXR5LnNjcmVlbnNoYXJpbmcgJiYgPENhbGxWaWV3VG9nZ2xlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlPXt0aGlzLnByb3BzLmJ1dHRvbnNTdGF0ZS5zY3JlZW5zaGFyaW5nfVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9DYWxsVmlld0J1dHRvbnNfYnV0dG9uX3NjcmVlbnNoYXJpbmdcIlxuICAgICAgICAgICAgICAgICAgICBvbkxhYmVsPXtfdChcIlN0b3Agc2hhcmluZyB5b3VyIHNjcmVlblwiKX1cbiAgICAgICAgICAgICAgICAgICAgb2ZmTGFiZWw9e190KFwiU3RhcnQgc2hhcmluZyB5b3VyIHNjcmVlblwiKX1cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5wcm9wcy5oYW5kbGVycy5vblNjcmVlbnNoYXJlQ2xpY2t9XG4gICAgICAgICAgICAgICAgLz4gfVxuICAgICAgICAgICAgICAgIHsgdGhpcy5wcm9wcy5idXR0b25zVmlzaWJpbGl0eS5zaWRlYmFyICYmIDxDYWxsVmlld1RvZ2dsZUJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBzdGF0ZT17dGhpcy5wcm9wcy5idXR0b25zU3RhdGUuc2lkZWJhclNob3dufVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9DYWxsVmlld0J1dHRvbnNfYnV0dG9uX3NpZGViYXJcIlxuICAgICAgICAgICAgICAgICAgICBvbkxhYmVsPXtfdChcIkhpZGUgc2lkZWJhclwiKX1cbiAgICAgICAgICAgICAgICAgICAgb2ZmTGFiZWw9e190KFwiU2hvdyBzaWRlYmFyXCIpfVxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnByb3BzLmhhbmRsZXJzLm9uVG9nZ2xlU2lkZWJhckNsaWNrfVxuICAgICAgICAgICAgICAgIC8+IH1cbiAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMuYnV0dG9uc1Zpc2liaWxpdHkuY29udGV4dE1lbnUgJiYgPENvbnRleHRNZW51VG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9DYWxsVmlld0J1dHRvbnNfYnV0dG9uIG14X0NhbGxWaWV3QnV0dG9uc19idXR0b25fbW9yZVwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25Nb3JlQ2xpY2t9XG4gICAgICAgICAgICAgICAgICAgIGlucHV0UmVmPXt0aGlzLmNvbnRleHRNZW51QnV0dG9ufVxuICAgICAgICAgICAgICAgICAgICBpc0V4cGFuZGVkPXt0aGlzLnN0YXRlLnNob3dNb3JlTWVudX1cbiAgICAgICAgICAgICAgICAgICAgdGl0bGU9e190KFwiTW9yZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgYWxpZ25tZW50PXtBbGlnbm1lbnQuVG9wfVxuICAgICAgICAgICAgICAgICAgICB5T2Zmc2V0PXtUT09MVElQX1lfT0ZGU0VUfVxuICAgICAgICAgICAgICAgIC8+IH1cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfQ2FsbFZpZXdCdXR0b25zX2J1dHRvbiBteF9DYWxsVmlld0J1dHRvbnNfYnV0dG9uX2hhbmd1cFwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMucHJvcHMuaGFuZGxlcnMub25IYW5ndXBDbGlja31cbiAgICAgICAgICAgICAgICAgICAgdGl0bGU9e190KFwiSGFuZ3VwXCIpfVxuICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQ9e0FsaWdubWVudC5Ub3B9XG4gICAgICAgICAgICAgICAgICAgIHlPZmZzZXQ9e1RPT0xUSVBfWV9PRkZTRVR9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==