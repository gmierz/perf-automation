"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireDefault(require("react"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _callFeed = require("matrix-js-sdk/src/webrtc/callFeed");

var _logger = require("matrix-js-sdk/src/logger");

var _MemberAvatar = _interopRequireDefault(require("../avatars/MemberAvatar"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _callEventTypes = require("matrix-js-sdk/src/webrtc/callEventTypes");

var _dec, _class;

let VideoFeed = (_dec = (0, _replaceableComponent.replaceableComponent)("views.voip.VideoFeed"), _dec(_class = class VideoFeed extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "element", void 0);
    (0, _defineProperty2.default)(this, "setElementRef", element => {
      if (!element) {
        var _this$element;

        (_this$element = this.element) === null || _this$element === void 0 ? void 0 : _this$element.removeEventListener('resize', this.onResize);
        return;
      }

      this.element = element;
      element.addEventListener('resize', this.onResize);
    });
    (0, _defineProperty2.default)(this, "onNewStream", () => {
      this.setState({
        audioMuted: this.props.feed.isAudioMuted(),
        videoMuted: this.props.feed.isVideoMuted()
      });
    });
    (0, _defineProperty2.default)(this, "onMuteStateChanged", () => {
      this.setState({
        audioMuted: this.props.feed.isAudioMuted(),
        videoMuted: this.props.feed.isVideoMuted()
      });
    });
    (0, _defineProperty2.default)(this, "onResize", e => {
      if (this.props.onResize && !this.props.feed.isLocal()) {
        this.props.onResize(e);
      }
    });
    this.state = {
      audioMuted: this.props.feed.isAudioMuted(),
      videoMuted: this.props.feed.isVideoMuted()
    };
  }

  componentDidMount() {
    this.updateFeed(null, this.props.feed);
    this.playMedia();
  }

  componentWillUnmount() {
    this.updateFeed(this.props.feed, null);
  }

  componentDidUpdate(prevProps, prevState) {
    this.updateFeed(prevProps.feed, this.props.feed); // If the mutes state has changed, we try to playMedia()

    if (prevState.videoMuted !== this.state.videoMuted || prevProps.feed.stream !== this.props.feed.stream) {
      this.playMedia();
    }
  }

  static getDerivedStateFromProps(props) {
    return {
      audioMuted: props.feed.isAudioMuted(),
      videoMuted: props.feed.isVideoMuted()
    };
  }

  updateFeed(oldFeed, newFeed) {
    if (oldFeed === newFeed) return;

    if (oldFeed) {
      this.props.feed.removeListener(_callFeed.CallFeedEvent.NewStream, this.onNewStream);
      this.props.feed.removeListener(_callFeed.CallFeedEvent.MuteStateChanged, this.onMuteStateChanged);

      if (this.props.feed.purpose === _callEventTypes.SDPStreamMetadataPurpose.Usermedia) {
        this.props.feed.measureVolumeActivity(false);
      }

      this.stopMedia();
    }

    if (newFeed) {
      this.props.feed.addListener(_callFeed.CallFeedEvent.NewStream, this.onNewStream);
      this.props.feed.addListener(_callFeed.CallFeedEvent.MuteStateChanged, this.onMuteStateChanged);

      if (this.props.feed.purpose === _callEventTypes.SDPStreamMetadataPurpose.Usermedia) {
        this.props.feed.measureVolumeActivity(true);
      }

      this.playMedia();
    }
  }

  async playMedia() {
    const element = this.element;
    if (!element) return; // We play audio in AudioFeed, not here

    element.muted = true;
    element.srcObject = this.props.feed.stream;
    element.autoplay = true;

    try {
      // A note on calling methods on media elements:
      // We used to have queues per media element to serialise all calls on those elements.
      // The reason given for this was that load() and play() were racing. However, we now
      // never call load() explicitly so this seems unnecessary. However, serialising every
      // operation was causing bugs where video would not resume because some play command
      // had got stuck and all media operations were queued up behind it. If necessary, we
      // should serialise the ones that need to be serialised but then be able to interrupt
      // them with another load() which will cancel the pending one, but since we don't call
      // load() explicitly, it shouldn't be a problem. - Dave
      await element.play();
    } catch (e) {
      _logger.logger.info("Failed to play media element with feed", this.props.feed, e);
    }
  }

  stopMedia() {
    const element = this.element;
    if (!element) return;
    element.pause();
    element.src = null; // As per comment in componentDidMount, setting the sink ID back to the
    // default once the call is over makes setSinkId work reliably. - Dave
    // Since we are not using the same element anymore, the above doesn't
    // seem to be necessary - Å imon
  }

  render() {
    const {
      pipMode,
      primary,
      feed
    } = this.props;
    const wrapperClasses = (0, _classnames.default)("mx_VideoFeed", {
      mx_VideoFeed_voice: this.state.videoMuted
    });
    const micIconClasses = (0, _classnames.default)("mx_VideoFeed_mic", {
      mx_VideoFeed_mic_muted: this.state.audioMuted,
      mx_VideoFeed_mic_unmuted: !this.state.audioMuted
    });
    let micIcon;

    if (feed.purpose !== _callEventTypes.SDPStreamMetadataPurpose.Screenshare && !primary && !pipMode) {
      micIcon = /*#__PURE__*/_react.default.createElement("div", {
        className: micIconClasses
      });
    }

    let content;

    if (this.state.videoMuted) {
      const member = this.props.feed.getMember();
      let avatarSize;
      if (pipMode && primary) avatarSize = 76;else if (pipMode && !primary) avatarSize = 16;else if (!pipMode && primary) avatarSize = 160;else ; // TBD

      content = /*#__PURE__*/_react.default.createElement(_MemberAvatar.default, {
        member: member,
        height: avatarSize,
        width: avatarSize
      });
    } else {
      const videoClasses = (0, _classnames.default)("mx_VideoFeed_video", {
        mx_VideoFeed_video_mirror: this.props.feed.isLocal() && this.props.feed.purpose === _callEventTypes.SDPStreamMetadataPurpose.Usermedia && _SettingsStore.default.getValue('VideoView.flipVideoHorizontally')
      });
      content = /*#__PURE__*/_react.default.createElement("video", {
        className: videoClasses,
        ref: this.setElementRef
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: wrapperClasses
    }, micIcon, content);
  }

}) || _class);
exports.default = VideoFeed;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3ZvaXAvVmlkZW9GZWVkLnRzeCJdLCJuYW1lcyI6WyJWaWRlb0ZlZWQiLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiZWxlbWVudCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJvblJlc2l6ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzZXRTdGF0ZSIsImF1ZGlvTXV0ZWQiLCJmZWVkIiwiaXNBdWRpb011dGVkIiwidmlkZW9NdXRlZCIsImlzVmlkZW9NdXRlZCIsImUiLCJpc0xvY2FsIiwic3RhdGUiLCJjb21wb25lbnREaWRNb3VudCIsInVwZGF0ZUZlZWQiLCJwbGF5TWVkaWEiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInByZXZTdGF0ZSIsInN0cmVhbSIsImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsIm9sZEZlZWQiLCJuZXdGZWVkIiwicmVtb3ZlTGlzdGVuZXIiLCJDYWxsRmVlZEV2ZW50IiwiTmV3U3RyZWFtIiwib25OZXdTdHJlYW0iLCJNdXRlU3RhdGVDaGFuZ2VkIiwib25NdXRlU3RhdGVDaGFuZ2VkIiwicHVycG9zZSIsIlNEUFN0cmVhbU1ldGFkYXRhUHVycG9zZSIsIlVzZXJtZWRpYSIsIm1lYXN1cmVWb2x1bWVBY3Rpdml0eSIsInN0b3BNZWRpYSIsImFkZExpc3RlbmVyIiwibXV0ZWQiLCJzcmNPYmplY3QiLCJhdXRvcGxheSIsInBsYXkiLCJsb2dnZXIiLCJpbmZvIiwicGF1c2UiLCJzcmMiLCJyZW5kZXIiLCJwaXBNb2RlIiwicHJpbWFyeSIsIndyYXBwZXJDbGFzc2VzIiwibXhfVmlkZW9GZWVkX3ZvaWNlIiwibWljSWNvbkNsYXNzZXMiLCJteF9WaWRlb0ZlZWRfbWljX211dGVkIiwibXhfVmlkZW9GZWVkX21pY191bm11dGVkIiwibWljSWNvbiIsIlNjcmVlbnNoYXJlIiwiY29udGVudCIsIm1lbWJlciIsImdldE1lbWJlciIsImF2YXRhclNpemUiLCJ2aWRlb0NsYXNzZXMiLCJteF9WaWRlb0ZlZWRfdmlkZW9fbWlycm9yIiwiU2V0dGluZ3NTdG9yZSIsImdldFZhbHVlIiwic2V0RWxlbWVudFJlZiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7SUEwQnFCQSxTLFdBRHBCLGdEQUFxQixzQkFBckIsQyxnQkFBRCxNQUNxQkEsU0FEckIsU0FDdUNDLGVBQU1DLGFBRDdDLENBQzJFO0FBR3ZFQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBZ0I7QUFDdkIsVUFBTUEsS0FBTjtBQUR1QjtBQUFBLHlEQW9DRkMsT0FBRCxJQUFxQztBQUN6RCxVQUFJLENBQUNBLE9BQUwsRUFBYztBQUFBOztBQUNWLDhCQUFLQSxPQUFMLGdFQUFjQyxtQkFBZCxDQUFrQyxRQUFsQyxFQUE0QyxLQUFLQyxRQUFqRDtBQUNBO0FBQ0g7O0FBRUQsV0FBS0YsT0FBTCxHQUFlQSxPQUFmO0FBQ0FBLE1BQUFBLE9BQU8sQ0FBQ0csZ0JBQVIsQ0FBeUIsUUFBekIsRUFBbUMsS0FBS0QsUUFBeEM7QUFDSCxLQTVDMEI7QUFBQSx1REF1R0wsTUFBTTtBQUN4QixXQUFLRSxRQUFMLENBQWM7QUFDVkMsUUFBQUEsVUFBVSxFQUFFLEtBQUtOLEtBQUwsQ0FBV08sSUFBWCxDQUFnQkMsWUFBaEIsRUFERjtBQUVWQyxRQUFBQSxVQUFVLEVBQUUsS0FBS1QsS0FBTCxDQUFXTyxJQUFYLENBQWdCRyxZQUFoQjtBQUZGLE9BQWQ7QUFJSCxLQTVHMEI7QUFBQSw4REE4R0UsTUFBTTtBQUMvQixXQUFLTCxRQUFMLENBQWM7QUFDVkMsUUFBQUEsVUFBVSxFQUFFLEtBQUtOLEtBQUwsQ0FBV08sSUFBWCxDQUFnQkMsWUFBaEIsRUFERjtBQUVWQyxRQUFBQSxVQUFVLEVBQUUsS0FBS1QsS0FBTCxDQUFXTyxJQUFYLENBQWdCRyxZQUFo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QUF1QixpQ0FBdkI7QUFKOEMsT0FBakMsQ0FBckI7QUFRQVAsTUFBQUEsT0FBTyxnQkFDSDtBQUFPLFFBQUEsU0FBUyxFQUFFSSxZQUFsQjtBQUFnQyxRQUFBLEdBQUcsRUFBRSxLQUFLSTtBQUExQyxRQURKO0FBR0g7O0FBRUQsd0JBQ0k7QUFBSyxNQUFBLFNBQVMsRUFBRWY7QUFBaEIsT0FDTUssT0FETixFQUVNRSxPQUZOLENBREo7QUFNSDs7QUF6THNFLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUsIDIwMTYsIDIwMTkgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCB7IE1hdHJpeENhbGwgfSBmcm9tICdtYXRyaXgtanMtc2RrL3NyYy93ZWJydGMvY2FsbCc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFNldHRpbmdzU3RvcmUgZnJvbSBcIi4uLy4uLy4uL3NldHRpbmdzL1NldHRpbmdzU3RvcmVcIjtcbmltcG9ydCB7IENhbGxGZWVkLCBDYWxsRmVlZEV2ZW50IH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvd2VicnRjL2NhbGxGZWVkJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlcic7XG5pbXBvcnQgTWVtYmVyQXZhdGFyIGZyb20gXCIuLi9hdmF0YXJzL01lbWJlckF2YXRhclwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCB7IFNEUFN0cmVhbU1ldGFkYXRhUHVycG9zZSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL3dlYnJ0Yy9jYWxsRXZlbnRUeXBlcyc7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGNhbGw6IE1hdHJpeENhbGw7XG5cbiAgICBmZWVkOiBDYWxsRmVlZDtcblxuICAgIC8vIFdoZXRoZXIgdGhpcyBjYWxsIHZpZXcgaXMgZm9yIHBpY3R1cmUtaW4tcGljdHVyZSBtb2RlXG4gICAgLy8gb3RoZXJ3aXNlLCBpdCdzIHRoZSBsYXJnZXIgY2FsbCB2aWV3IHdoZW4gdmlld2luZyB0aGUgcm9vbSB0aGUgY2FsbCBpcyBpbi5cbiAgICAvLyBUaGlzIGlzIHNvcnQgb2YgYSBwcm94eSBmb3IgYSBudW1iZXIgb2YgdGhpbmdzIGJ1dCB3ZSBjdXJyZW50bHkgaGF2ZSBub1xuICAgIC8vIG5lZWQgdG8gY29udHJvbCB0aG9zZSB0aGluZ3Mgc2VwYXJhdGVseSwgc28gdGhpcyBpcyBzaW1wbGVyLlxuICAgIHBpcE1vZGU/OiBib29sZWFuO1xuXG4gICAgLy8gYSBjYWxsYmFjayB3aGljaCBpcyBjYWxsZWQgd2hlbiB0aGUgdmlkZW8gZWxlbWVudCBpcyByZXNpemVkXG4gICAgLy8gZHVlIHRvIGEgY2hhbmdlIGluIHZpZGVvIG1ldGFkYXRhXG4gICAgb25SZXNpemU/OiAoZTogRXZlbnQpID0+IHZvaWQ7XG5cbiAgICBwcmltYXJ5OiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBhdWRpb011dGVkOiBib29sZWFuO1xuICAgIHZpZGVvTXV0ZWQ6IGJvb2xlYW47XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLnZvaXAuVmlkZW9GZWVkXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWaWRlb0ZlZWQgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSBlbGVtZW50OiBIVE1MVmlkZW9FbGVtZW50O1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGF1ZGlvTXV0ZWQ6IHRoaXMucHJvcHMuZmVlZC5pc0F1ZGlvTXV0ZWQoKSxcbiAgICAgICAgICAgIHZpZGVvTXV0ZWQ6IHRoaXMucHJvcHMuZmVlZC5pc1ZpZGVvTXV0ZWQoKSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy51cGRhdGVGZWVkKG51bGwsIHRoaXMucHJvcHMuZmVlZCk7XG4gICAgICAgIHRoaXMucGxheU1lZGlhKCk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIHRoaXMudXBkYXRlRmVlZCh0aGlzLnByb3BzLmZlZWQsIG51bGwpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHM6IElQcm9wcywgcHJldlN0YXRlOiBJU3RhdGUpIHtcbiAgICAgICAgdGhpcy51cGRhdGVGZWVkKHByZXZQcm9wcy5mZWVkLCB0aGlzLnByb3BzLmZlZWQpO1xuICAgICAgICAvLyBJZiB0aGUgbXV0ZXMgc3RhdGUgaGFzIGNoYW5nZWQsIHdlIHRyeSB0byBwbGF5TWVkaWEoKVxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBwcmV2U3RhdGUudmlkZW9NdXRlZCAhPT0gdGhpcy5zdGF0ZS52aWRlb011dGVkIHx8XG4gICAgICAgICAgICBwcmV2UHJvcHMuZmVlZC5zdHJlYW0gIT09IHRoaXMucHJvcHMuZmVlZC5zdHJlYW1cbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXlNZWRpYSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhdWRpb011dGVkOiBwcm9wcy5mZWVkLmlzQXVkaW9NdXRlZCgpLFxuICAgICAgICAgICAgdmlkZW9NdXRlZDogcHJvcHMuZmVlZC5pc1ZpZGVvTXV0ZWQoKSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldEVsZW1lbnRSZWYgPSAoZWxlbWVudDogSFRNTFZpZGVvRWxlbWVudCk6IHZvaWQgPT4ge1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudD8ucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vblJlc2l6ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25SZXNpemUpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHVwZGF0ZUZlZWQob2xkRmVlZDogQ2FsbEZlZWQsIG5ld0ZlZWQ6IENhbGxGZWVkKSB7XG4gICAgICAgIGlmIChvbGRGZWVkID09PSBuZXdGZWVkKSByZXR1cm47XG5cbiAgICAgICAgaWYgKG9sZEZlZWQpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZmVlZC5yZW1vdmVMaXN0ZW5lcihDYWxsRmVlZEV2ZW50Lk5ld1N0cmVhbSwgdGhpcy5vbk5ld1N0cmVhbSk7XG4gICAgICAgICAgICB0aGlzLnByb3BzLmZlZWQucmVtb3ZlTGlzdGVuZXIoQ2FsbEZlZWRFdmVudC5NdXRlU3RhdGVDaGFuZ2VkLCB0aGlzLm9uTXV0ZVN0YXRlQ2hhbmdlZCk7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5mZWVkLnB1cnBvc2UgPT09IFNEUFN0cmVhbU1ldGFkYXRhUHVycG9zZS5Vc2VybWVkaWEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmZlZWQubWVhc3VyZVZvbHVtZUFjdGl2aXR5KGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc3RvcE1lZGlhKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld0ZlZWQpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMuZmVlZC5hZGRMaXN0ZW5lcihDYWxsRmVlZEV2ZW50Lk5ld1N0cmVhbSwgdGhpcy5vbk5ld1N0cmVhbSk7XG4gICAgICAgICAgICB0aGlzLnByb3BzLmZlZWQuYWRkTGlzdGVuZXIoQ2FsbEZlZWRFdmVudC5NdXRlU3RhdGVDaGFuZ2VkLCB0aGlzLm9uTXV0ZVN0YXRlQ2hhbmdlZCk7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5mZWVkLnB1cnBvc2UgPT09IFNEUFN0cmVhbU1ldGFkYXRhUHVycG9zZS5Vc2VybWVkaWEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmZlZWQubWVhc3VyZVZvbHVtZUFjdGl2aXR5KHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wbGF5TWVkaWEoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgcGxheU1lZGlhKCkge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHJldHVybjtcbiAgICAgICAgLy8gV2UgcGxheSBhdWRpbyBpbiBBdWRpb0ZlZWQsIG5vdCBoZXJlXG4gICAgICAgIGVsZW1lbnQubXV0ZWQgPSB0cnVlO1xuICAgICAgICBlbGVtZW50LnNyY09iamVjdCA9IHRoaXMucHJvcHMuZmVlZC5zdHJlYW07XG4gICAgICAgIGVsZW1lbnQuYXV0b3BsYXkgPSB0cnVlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQSBub3RlIG9uIGNhbGxpbmcgbWV0aG9kcyBvbiBtZWRpYSBlbGVtZW50czpcbiAgICAgICAgICAgIC8vIFdlIHVzZWQgdG8gaGF2ZSBxdWV1ZXMgcGVyIG1lZGlhIGVsZW1lbnQgdG8gc2VyaWFsaXNlIGFsbCBjYWxscyBvbiB0aG9zZSBlbGVtZW50cy5cbiAgICAgICAgICAgIC8vIFRoZSByZWFzb24gZ2l2ZW4gZm9yIHRoaXMgd2FzIHRoYXQgbG9hZCgpIGFuZCBwbGF5KCkgd2VyZSByYWNpbmcuIEhvd2V2ZXIsIHdlIG5vd1xuICAgICAgICAgICAgLy8gbmV2ZXIgY2FsbCBsb2FkKCkgZXhwbGljaXRseSBzbyB0aGlzIHNlZW1zIHVubmVjZXNzYXJ5LiBIb3dldmVyLCBzZXJpYWxpc2luZyBldmVyeVxuICAgICAgICAgICAgLy8gb3BlcmF0aW9uIHdhcyBjYXVzaW5nIGJ1Z3Mgd2hlcmUgdmlkZW8gd291bGQgbm90IHJlc3VtZSBiZWNhdXNlIHNvbWUgcGxheSBjb21tYW5kXG4gICAgICAgICAgICAvLyBoYWQgZ290IHN0dWNrIGFuZCBhbGwgbWVkaWEgb3BlcmF0aW9ucyB3ZXJlIHF1ZXVlZCB1cCBiZWhpbmQgaXQuIElmIG5lY2Vzc2FyeSwgd2VcbiAgICAgICAgICAgIC8vIHNob3VsZCBzZXJpYWxpc2UgdGhlIG9uZXMgdGhhdCBuZWVkIHRvIGJlIHNlcmlhbGlzZWQgYnV0IHRoZW4gYmUgYWJsZSB0byBpbnRlcnJ1cHRcbiAgICAgICAgICAgIC8vIHRoZW0gd2l0aCBhbm90aGVyIGxvYWQoKSB3aGljaCB3aWxsIGNhbmNlbCB0aGUgcGVuZGluZyBvbmUsIGJ1dCBzaW5jZSB3ZSBkb24ndCBjYWxsXG4gICAgICAgICAgICAvLyBsb2FkKCkgZXhwbGljaXRseSwgaXQgc2hvdWxkbid0IGJlIGEgcHJvYmxlbS4gLSBEYXZlXG4gICAgICAgICAgICBhd2FpdCBlbGVtZW50LnBsYXkoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oXCJGYWlsZWQgdG8gcGxheSBtZWRpYSBlbGVtZW50IHdpdGggZmVlZFwiLCB0aGlzLnByb3BzLmZlZWQsIGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdG9wTWVkaWEoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgIGlmICghZWxlbWVudCkgcmV0dXJuO1xuXG4gICAgICAgIGVsZW1lbnQucGF1c2UoKTtcbiAgICAgICAgZWxlbWVudC5zcmMgPSBudWxsO1xuXG4gICAgICAgIC8vIEFzIHBlciBjb21tZW50IGluIGNvbXBvbmVudERpZE1vdW50LCBzZXR0aW5nIHRoZSBzaW5rIElEIGJhY2sgdG8gdGhlXG4gICAgICAgIC8vIGRlZmF1bHQgb25jZSB0aGUgY2FsbCBpcyBvdmVyIG1ha2VzIHNldFNpbmtJZCB3b3JrIHJlbGlhYmx5LiAtIERhdmVcbiAgICAgICAgLy8gU2luY2Ugd2UgYXJlIG5vdCB1c2luZyB0aGUgc2FtZSBlbGVtZW50IGFueW1vcmUsIHRoZSBhYm92ZSBkb2Vzbid0XG4gICAgICAgIC8vIHNlZW0gdG8gYmUgbmVjZXNzYXJ5IC0gxaBpbW9uXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbk5ld1N0cmVhbSA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBhdWRpb011dGVkOiB0aGlzLnByb3BzLmZlZWQuaXNBdWRpb011dGVkKCksXG4gICAgICAgICAgICB2aWRlb011dGVkOiB0aGlzLnByb3BzLmZlZWQuaXNWaWRlb011dGVkKCksXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uTXV0ZVN0YXRlQ2hhbmdlZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBhdWRpb011dGVkOiB0aGlzLnByb3BzLmZlZWQuaXNBdWRpb011dGVkKCksXG4gICAgICAgICAgICB2aWRlb011dGVkOiB0aGlzLnByb3BzLmZlZWQuaXNWaWRlb011dGVkKCksXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUmVzaXplID0gKGUpID0+IHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25SZXNpemUgJiYgIXRoaXMucHJvcHMuZmVlZC5pc0xvY2FsKCkpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25SZXNpemUoZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHBpcE1vZGUsIHByaW1hcnksIGZlZWQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICAgICAgY29uc3Qgd3JhcHBlckNsYXNzZXMgPSBjbGFzc25hbWVzKFwibXhfVmlkZW9GZWVkXCIsIHtcbiAgICAgICAgICAgIG14X1ZpZGVvRmVlZF92b2ljZTogdGhpcy5zdGF0ZS52aWRlb011dGVkLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbWljSWNvbkNsYXNzZXMgPSBjbGFzc25hbWVzKFwibXhfVmlkZW9GZWVkX21pY1wiLCB7XG4gICAgICAgICAgICBteF9WaWRlb0ZlZWRfbWljX211dGVkOiB0aGlzLnN0YXRlLmF1ZGlvTXV0ZWQsXG4gICAgICAgICAgICBteF9WaWRlb0ZlZWRfbWljX3VubXV0ZWQ6ICF0aGlzLnN0YXRlLmF1ZGlvTXV0ZWQsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBtaWNJY29uO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICBmZWVkLnB1cnBvc2UgIT09IFNEUFN0cmVhbU1ldGFkYXRhUHVycG9zZS5TY3JlZW5zaGFyZSAmJlxuICAgICAgICAgICAgIXByaW1hcnkgJiZcbiAgICAgICAgICAgICFwaXBNb2RlXG4gICAgICAgICkge1xuICAgICAgICAgICAgbWljSWNvbiA9IChcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17bWljSWNvbkNsYXNzZXN9IC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGNvbnRlbnQ7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnZpZGVvTXV0ZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lbWJlciA9IHRoaXMucHJvcHMuZmVlZC5nZXRNZW1iZXIoKTtcblxuICAgICAgICAgICAgbGV0IGF2YXRhclNpemU7XG4gICAgICAgICAgICBpZiAocGlwTW9kZSAmJiBwcmltYXJ5KSBhdmF0YXJTaXplID0gNzY7XG4gICAgICAgICAgICBlbHNlIGlmIChwaXBNb2RlICYmICFwcmltYXJ5KSBhdmF0YXJTaXplID0gMTY7XG4gICAgICAgICAgICBlbHNlIGlmICghcGlwTW9kZSAmJiBwcmltYXJ5KSBhdmF0YXJTaXplID0gMTYwO1xuICAgICAgICAgICAgZWxzZTsgLy8gVEJEXG5cbiAgICAgICAgICAgIGNvbnRlbnQgPShcbiAgICAgICAgICAgICAgICA8TWVtYmVyQXZhdGFyXG4gICAgICAgICAgICAgICAgICAgIG1lbWJlcj17bWVtYmVyfVxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ9e2F2YXRhclNpemV9XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoPXthdmF0YXJTaXplfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgdmlkZW9DbGFzc2VzID0gY2xhc3NuYW1lcyhcIm14X1ZpZGVvRmVlZF92aWRlb1wiLCB7XG4gICAgICAgICAgICAgICAgbXhfVmlkZW9GZWVkX3ZpZGVvX21pcnJvcjogKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmZlZWQuaXNMb2NhbCgpICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuZmVlZC5wdXJwb3NlID09PSBTRFBTdHJlYW1NZXRhZGF0YVB1cnBvc2UuVXNlcm1lZGlhICYmXG4gICAgICAgICAgICAgICAgICAgIFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoJ1ZpZGVvVmlldy5mbGlwVmlkZW9Ib3Jpem9udGFsbHknKVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGVudD0gKFxuICAgICAgICAgICAgICAgIDx2aWRlbyBjbGFzc05hbWU9e3ZpZGVvQ2xhc3Nlc30gcmVmPXt0aGlzLnNldEVsZW1lbnRSZWZ9IC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXt3cmFwcGVyQ2xhc3Nlc30+XG4gICAgICAgICAgICAgICAgeyBtaWNJY29uIH1cbiAgICAgICAgICAgICAgICB7IGNvbnRlbnQgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19