"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _EditableItemList = _interopRequireDefault(require("../elements/EditableItemList"));

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _languageHandler = require("../../../languageHandler");

var _Field = _interopRequireDefault(require("../elements/Field"));

var _Spinner = _interopRequireDefault(require("../elements/Spinner"));

var _ErrorDialog = _interopRequireDefault(require("../dialogs/ErrorDialog"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _RoomPublishSetting = _interopRequireDefault(require("./RoomPublishSetting"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _RoomAliasField = _interopRequireDefault(require("../elements/RoomAliasField"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

class EditableAliasesList extends _EditableItemList.default {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "aliasField", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "onAliasAdded", async () => {
      await this.aliasField.current.validate({
        allowEmpty: false
      });

      if (this.aliasField.current.isValid) {
        if (this.props.onItemAdded) this.props.onItemAdded(this.props.newItem);
        return;
      }

      this.aliasField.current.focus();
      this.aliasField.current.validate({
        allowEmpty: false,
        focused: true
      });
    });
  }

  renderNewItemField() {
    // if we don't need the RoomAliasField,
    // we don't need to overriden version of renderNewItemField
    if (!this.props.domain) {
      return super.renderNewItemField();
    }

    const onChange = alias => this.onNewItemChanged({
      target: {
        value: alias
      }
    });

    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onAliasAdded,
      autoComplete: "off",
      noValidate: true,
      className: "mx_EditableItemList_newItem"
    }, /*#__PURE__*/_react.default.createElement(_RoomAliasField.default, {
      ref: this.aliasField,
      onChange: onChange,
      value: this.props.newItem || "",
      domain: this.props.domain
    }), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: this.onAliasAdded,
      kind: "primary"
    }, (0, _languageHandler._t)("Add")));
  }

}

let AliasSettings = (_dec = (0, _replaceableComponent.replaceableComponent)("views.room_settings.AliasSettings"), _dec(_class = (_temp = _class2 = class AliasSettings extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onNewAliasChanged", value => {
      this.setState({
        newAlias: value
      });
    });
    (0, _defineProperty2.default)(this, "onLocalAliasAdded", alias => {
      if (!alias || alias.length === 0) return; // ignore attempts to create blank aliases

      const localDomain = _MatrixClientPeg.MatrixClientPeg.get().getDomain();

      if (!alias.includes(':')) alias += ':' + localDomain;

      _MatrixClientPeg.MatrixClientPeg.get().createAlias(alias, this.props.roomId).then(() => {
        this.setState({
          localAliases: this.state.localAliases.concat(alias),
          newAlias: null
        });

        if (!this.state.canonicalAlias) {
          this.changeCanonicalAlias(alias);
        }
      }).catch(err => {
        _logger.logger.error(err);

        _Modal.default.createTrackedDialog('Error creating address', '', _ErrorDialog.default, {
          title: (0, _languageHandler._t)("Error creating address"),
          description: (0, _languageHandler._t)("There was an error creating that address. It may not be allowed by the server " + "or a temporary failure occurred.")
        });
      });
    });
    (0, _defineProperty2.default)(this, "onLocalAliasDeleted", index => {
      const alias = this.state.localAliases[index]; // TODO: In future, we should probably be making sure that the alias actually belongs
      // to this room. See https://github.com/vector-im/element-web/issues/7353

      _MatrixClientPeg.MatrixClientPeg.get().deleteAlias(alias).then(() => {
        const localAliases = this.state.localAliases.filter(a => a !== alias);
        this.setState({
          localAliases
        });

        if (this.state.canonicalAlias === alias) {
          this.changeCanonicalAlias(null);
        }
      }).catch(err => {
        _logger.logger.error(err);

        let description;

        if (err.errcode === "M_FORBIDDEN") {
          description = (0, _languageHandler._t)("You don't have permission to delete the address.");
        } else {
          description = (0, _languageHandler._t)("There was an error removing that address. It may no longer exist or a temporary " + "error occurred.");
        }

        _Modal.default.createTrackedDialog('Error removing address', '', _ErrorDialog.default, {
          title: (0, _languageHandler._t)("Error removing address"),
          description
        });
      });
    });
    (0, _defineProperty2.default)(this, "onLocalAliasesToggled", event => {
      // expanded
      if (event.target.open) {
        // if local aliases haven't been preloaded yet at component mount
        if (!this.props.canSetCanonicalAlias && this.state.localAliases.length === 0) {
          this.loadLocalAliases();
        }
      }

      this.setState({
        detailsOpen: event.currentTarget.open
      });
    });
    (0, _defineProperty2.default)(this, "onCanonicalAliasChange", event => {
      this.changeCanonicalAlias(event.target.value);
    });
    (0, _defineProperty2.default)(this, "onNewAltAliasChanged", value => {
      this.setState({
        newAltAlias: value
      });
    });
    (0, _defineProperty2.default)(this, "onAltAliasAdded", alias => {
      const altAliases = this.state.altAliases.slice();

      if (!altAliases.some(a => a.trim() === alias.trim())) {
        altAliases.push(alias.trim());
        this.changeAltAliases(altAliases);
        this.setState({
          newAltAlias: ""
        });
      }
    });
    (0, _defineProperty2.default)(this, "onAltAliasDeleted", index => {
      const altAliases = this.state.altAliases.slice();
      altAliases.splice(index, 1);
      this.changeAltAliases(altAliases);
    });
    const state = {
      altAliases: [],
      // [ #alias:domain.tld, ... ]
      localAliases: [],
      // [ #alias:my-hs.tld, ... ]
      canonicalAlias: null,
      // #canonical:domain.tld
      updatingCanonicalAlias: false,
      localAliasesLoading: false,
      detailsOpen: false
    };

    if (props.canonicalAliasEvent) {
      const content = props.canonicalAliasEvent.getContent();
      const altAliases = content.alt_aliases;

      if (Array.isArray(altAliases)) {
        state.altAliases = altAliases.slice();
      }

      state.canonicalAlias = content.alias;
    }

    this.state = state;
  }

  componentDidMount() {
    if (this.props.canSetCanonicalAlias) {
      // load local aliases for providing recommendations
      // for the canonical alias and alt_aliases
      this.loadLocalAliases();
    }
  }

  async loadLocalAliases() {
    this.setState({
      localAliasesLoading: true
    });

    try {
      const cli = _MatrixClientPeg.MatrixClientPeg.get();

      let localAliases = [];

      if (await cli.doesServerSupportUnstableFeature("org.matrix.msc2432")) {
        const response = await cli.unstableGetLocalAliases(this.props.roomId);

        if (Array.isArray(response.aliases)) {
          localAliases = response.aliases;
        }
      }

      this.setState({
        localAliases
      });

      if (localAliases.length === 0) {
        this.setState({
          detailsOpen: true
        });
      }
    } finally {
      this.setState({
        localAliasesLoading: false
      });
    }
  }

  changeCanonicalAlias(alias) {
    if (!this.props.canSetCanonicalAlias) return;
    const oldAlias = this.state.canonicalAlias;
    this.setState({
      canonicalAlias: alias,
      updatingCanonicalAlias: true
    });
    const eventContent = {
      alt_aliases: this.state.altAliases
    };
    if (alias) eventContent["alias"] = alias;

    _MatrixClientPeg.MatrixClientPeg.get().sendStateEvent(this.props.roomId, "m.room.canonical_alias", eventContent, "").catch(err => {
      _logger.logger.error(err);

      _Modal.default.createTrackedDialog('Error updating main address', '', _ErrorDialog.default, {
        title: (0, _languageHandler._t)("Error updating main address"),
        description: (0, _languageHandler._t)("There was an error updating the room's main address. It may not be allowed by the server " + "or a temporary failure occurred.")
      });

      this.setState({
        canonicalAlias: oldAlias
      });
    }).finally(() => {
      this.setState({
        updatingCanonicalAlias: false
      });
    });
  }

  changeAltAliases(altAliases) {
    if (!this.props.canSetCanonicalAlias) return;
    this.setState({
      updatingCanonicalAlias: true,
      altAliases
    });
    const eventContent = {};

    if (this.state.canonicalAlias) {
      eventContent["alias"] = this.state.canonicalAlias;
    }

    if (altAliases) {
      eventContent["alt_aliases"] = altAliases;
    }

    _MatrixClientPeg.MatrixClientPeg.get().sendStateEvent(this.props.roomId, "m.room.canonical_alias", eventContent, "").catch(err => {
      _logger.logger.error(err);

      _Modal.default.createTrackedDialog('Error updating alternative addresses', '', _ErrorDialog.default, {
        title: (0, _languageHandler._t)("Error updating main address"),
        description: (0, _languageHandler._t)("There was an error updating the room's alternative addresses. " + "It may not be allowed by the server or a temporary failure occurred.")
      });
    }).finally(() => {
      this.setState({
        updatingCanonicalAlias: false
      });
    });
  }

  getAliases() {
    return this.state.altAliases.concat(this.getLocalNonAltAliases());
  }

  getLocalNonAltAliases() {
    const {
      altAliases
    } = this.state;
    return this.state.localAliases.filter(alias => !altAliases.includes(alias));
  }

  render() {
    var _cli$getRoom;

    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const localDomain = cli.getDomain();
    const isSpaceRoom = (_cli$getRoom = cli.getRoom(this.props.roomId)) === null || _cli$getRoom === void 0 ? void 0 : _cli$getRoom.isSpaceRoom();
    let found = false;
    const canonicalValue = this.state.canonicalAlias || "";

    const canonicalAliasSection = /*#__PURE__*/_react.default.createElement(_Field.default, {
      onChange: this.onCanonicalAliasChange,
      value: canonicalValue,
      disabled: this.state.updatingCanonicalAlias || !this.props.canSetCanonicalAlias,
      element: "select",
      id: "canonicalAlias",
      label: (0, _languageHandler._t)('Main address')
    }, /*#__PURE__*/_react.default.createElement("option", {
      value: "",
      key: "unset"
    }, (0, _languageHandler._t)('not specified')), this.getAliases().map((alias, i) => {
      if (alias === this.state.canonicalAlias) found = true;
      return /*#__PURE__*/_react.default.createElement("option", {
        value: alias,
        key: i
      }, alias);
    }), found || !this.state.canonicalAlias ? '' : /*#__PURE__*/_react.default.createElement("option", {
      value: this.state.canonicalAlias,
      key: "arbitrary"
    }, this.state.canonicalAlias));

    let localAliasesList;

    if (this.state.localAliasesLoading) {
      localAliasesList = /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
    } else {
      localAliasesList = /*#__PURE__*/_react.default.createElement(EditableAliasesList, {
        id: "roomAliases",
        items: this.state.localAliases,
        newItem: this.state.newAlias,
        onNewItemChanged: this.onNewAliasChanged,
        canRemove: this.props.canSetAliases,
        canEdit: this.props.canSetAliases,
        onItemAdded: this.onLocalAliasAdded,
        onItemRemoved: this.onLocalAliasDeleted,
        noItemsLabel: isSpaceRoom ? (0, _languageHandler._t)("This space has no local addresses") : (0, _languageHandler._t)("This room has no local addresses"),
        placeholder: (0, _languageHandler._t)('Local address'),
        domain: localDomain
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AliasSettings"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Published Addresses")), /*#__PURE__*/_react.default.createElement("p", null, isSpaceRoom ? (0, _languageHandler._t)("Published addresses can be used by anyone on any server to join your space.") : (0, _languageHandler._t)("Published addresses can be used by anyone on any server to join your room."), "\xA0", (0, _languageHandler._t)("To publish an address, it needs to be set as a local address first.")), canonicalAliasSection, this.props.hidePublishSetting ? null : /*#__PURE__*/_react.default.createElement(_RoomPublishSetting.default, {
      roomId: this.props.roomId,
      canSetCanonicalAlias: this.props.canSetCanonicalAlias
    }), /*#__PURE__*/_react.default.createElement("datalist", {
      id: "mx_AliasSettings_altRecommendations"
    }, this.getLocalNonAltAliases().map(alias => {
      return /*#__PURE__*/_react.default.createElement("option", {
        value: alias,
        key: alias
      });
    }), ";"), /*#__PURE__*/_react.default.createElement(EditableAliasesList, {
      id: "roomAltAliases",
      items: this.state.altAliases,
      newItem: this.state.newAltAlias,
      onNewItemChanged: this.onNewAltAliasChanged,
      canRemove: this.props.canSetCanonicalAlias,
      canEdit: this.props.canSetCanonicalAlias,
      onItemAdded: this.onAltAliasAdded,
      onItemRemoved: this.onAltAliasDeleted,
      suggestionsListId: "mx_AliasSettings_altRecommendations",
      itemsLabel: (0, _languageHandler._t)('Other published addresses:'),
      noItemsLabel: (0, _languageHandler._t)('No other published addresses yet, add one below'),
      placeholder: (0, _languageHandler._t)('New published address (e.g. #alias:server)')
    }), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading mx_AliasSettings_localAliasHeader"
    }, (0, _languageHandler._t)("Local Addresses")), /*#__PURE__*/_react.default.createElement("p", null, isSpaceRoom ? (0, _languageHandler._t)("Set addresses for this space so users can find this space " + "through your homeserver (%(localDomain)s)", {
      localDomain
    }) : (0, _languageHandler._t)("Set addresses for this room so users can find this room " + "through your homeserver (%(localDomain)s)", {
      localDomain
    })), /*#__PURE__*/_react.default.createElement("details", {
      onToggle: this.onLocalAliasesToggled,
      open: this.state.detailsOpen
    }, /*#__PURE__*/_react.default.createElement("summary", null, this.state.detailsOpen ? (0, _languageHandler._t)('Show less') : (0, _languageHandler._t)("Show more")), localAliasesList));
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  canSetAliases: false,
  canSetCanonicalAlias: false
}), _temp)) || _class);
exports.default = AliasSettings;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21fc2V0dGluZ3MvQWxpYXNTZXR0aW5ncy50c3giXSwibmFtZXMiOlsiRWRpdGFibGVBbGlhc2VzTGlzdCIsIkVkaXRhYmxlSXRlbUxpc3QiLCJhbGlhc0ZpZWxkIiwiY3VycmVudCIsInZhbGlkYXRlIiwiYWxsb3dFbXB0eSIsImlzVmFsaWQiLCJwcm9wcyIsIm9uSXRlbUFkZGVkIiwibmV3SXRlbSIsImZvY3VzIiwiZm9jdXNlZCIsInJlbmRlck5ld0l0ZW1GaWVsZCIsImRvbWFpbiIsIm9uQ2hhbmdlIiwiYWxpYXMiLCJvbk5ld0l0ZW1DaGFuZ2VkIiwidGFyZ2V0IiwidmFsdWUiLCJvbkFsaWFzQWRkZWQiLCJBbGlhc1NldHRpbmdzIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInNldFN0YXRlIiwibmV3QWxpYXMiLCJsZW5ndGgiLCJsb2NhbERvbWFpbiIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsImdldERvbWFpbiIsImluY2x1ZGVzIiwiY3JlYXRlQWxpYXMiLCJyb29tSWQiLCJ0aGVuIiwibG9jYWxBbGlhc2VzIiwic3RhdGUiLCJjb25jYXQiLCJjYW5vbmljYWxBbGlhcyIsImNoYW5nZUNhbm9uaWNhbEFsaWFzIiwiY2F0Y2giLCJlcnIiLCJsb2dnZXIiLCJlcnJvciIsIk1vZGFsIiwiY3JlYXRlVHJhY2tlZERpYWxvZyIsIkVycm9yRGlhbG9nIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImluZGV4IiwiZGVsZXRlQWxpYXMiLCJmaWx0ZXIiLCJhIiwiZXJyY29kZSIsImV2ZW50Iiwib3BlbiIsImNhblNldENhbm9uaWNhbEFsaWFzIiwibG9hZExvY2FsQWxpYXNlcyIsImRldGFpbHNPcGVuIiwiY3VycmVudFRhcmdldCIsIm5ld0FsdEFsaWFzIiwiYWx0QWxpYXNlcyIsInNsaWNlIiwic29tZSIsInRyaW0iLCJwdXNoIiwiY2hhbmdlQWx0QWxpYXNlcyIsInNwbGljZSIsInVwZGF0aW5nQ2Fub25pY2FsQWxpYXMiLCJsb2NhbEFsaWFzZXNMb2FkaW5nIiwiY2Fub25pY2FsQWxpYXNFdmVudCIsImNvbnRlbnQiLCJnZXRDb250ZW50IiwiYWx0X2FsaWFzZXMiLCJBcnJheSIsImlzQXJyYXkiLCJjb21wb25lbnREaWRNb3VudCIsImNsaSIsImRvZXNTZXJ2ZXJTdXBwb3J0VW5zdGFibGVGZWF0dXJlIiwicmVzcG9uc2UiLCJ1bnN0YWJsZUdldExvY2FsQWxpYXNlcyIsImFsaWFzZXMiLCJvbGRBbGlhcyIsImV2ZW50Q29udGVudCIsInNlbmRTdGF0ZUV2ZW50IiwiZmluYWxseSIsImdldEFsaWFzZXMiLCJnZXRMb2NhbE5vbkFsdEFsaWFzZXMiLCJyZW5kZXIiLCJpc1NwYWNlUm9vbSIsImdldFJvb20iLCJmb3VuZCIsImNhbm9uaWNhbFZhbHVlIiwiY2Fub25pY2FsQWxpYXNTZWN0aW9uIiwib25DYW5vbmljYWxBbGlhc0NoYW5nZSIsIm1hcCIsImkiLCJsb2NhbEFsaWFzZXNMaXN0Iiwib25OZXdBbGlhc0NoYW5nZWQiLCJjYW5TZXRBbGlhc2VzIiwib25Mb2NhbEFsaWFzQWRkZWQiLCJvbkxvY2FsQWxpYXNEZWxldGVkIiwiaGlkZVB1Ymxpc2hTZXR0aW5nIiwib25OZXdBbHRBbGlhc0NoYW5nZWQiLCJvbkFsdEFsaWFzQWRkZWQiLCJvbkFsdEFsaWFzRGVsZXRlZCIsIm9uTG9jYWxBbGlhc2VzVG9nZ2xlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7Ozs7O0FBTUEsTUFBTUEsbUJBQU4sU0FBa0NDLHlCQUFsQyxDQUE4RTtBQUFBO0FBQUE7QUFBQSxtRUFDckQsdUJBRHFEO0FBQUEsd0RBR25ELFlBQVk7QUFDL0IsWUFBTSxLQUFLQyxVQUFMLENBQWdCQyxPQUFoQixDQUF3QkMsUUFBeEIsQ0FBaUM7QUFBRUMsUUFBQUEsVUFBVSxFQUFFO0FBQWQsT0FBakMsQ0FBTjs7QUFFQSxVQUFJLEtBQUtILFVBQUwsQ0FBZ0JDLE9BQWhCLENBQXdCRyxPQUE1QixFQUFxQztBQUNqQyxZQUFJLEtBQUtDLEtBQUwsQ0FBV0MsV0FBZixFQUE0QixLQUFLRCxLQUFMLENBQVdDLFdBQVgsQ0FBdUIsS0FBS0QsS0FBTCxDQUFXRSxPQUFsQztBQUM1QjtBQUNIOztBQUVELFdBQUtQLFVBQUwsQ0FBZ0JDLE9BQWhCLENBQXdCTyxLQUF4QjtBQUNBLFdBQUtSLFVBQUwsQ0FBZ0JDLE9BQWhCLENBQXdCQyxRQUF4QixDQUFpQztBQUFFQyxRQUFBQSxVQUFVLEVBQUUsS0FBZDtBQUFxQk0sUUFBQUEsT0FBTyxFQUFFO0FBQTlCLE9BQWpDO0FBQ0gsS0FieUU7QUFBQTs7QUFlaEVDLEVBQUFBLGtCQUFrQixHQUFHO0FBQzNCO0FBQ0E7QUFDQSxRQUFJLENBQUMsS0FBS0wsS0FBTCxDQUFXTSxNQUFoQixFQUF3QjtBQUNwQixhQUFPLE1BQU1ELGtCQUFOLEVBQVA7QUFDSDs7QUFDRCxVQUFNRSxRQUFRLEdBQUlDLEtBQUQsSUFBVyxLQUFLQyxnQkFBTCxDQUFzQjtBQUFFQyxNQUFBQSxNQUFNLEVBQUU7QUFBRUMsUUFBQUEsS0FBSyxFQUFFSDtBQUFUO0FBQVYsS0FBdEIsQ0FBNUI7O0FBQ0Esd0JBQ0k7QUFDSSxNQUFBLFFBQVEsRUFBRSxLQUFLSSxZQURuQjtBQUVJLE1BQUEsWUFBWSxFQUFDLEtBRmpCO0FBR0ksTUFBQSxVQUFVLEVBQUUsSUFIaEI7QUFJSSxNQUFBLFNBQVMsRUFBQztBQUpkLG9CQU1JLDZCQUFDLHVCQUFEO0FBQ0ksTUFBQSxHQUFHLEVBQUUsS0FBS2pCLFVBRGQ7QUFFSSxNQUFBLFFBQVEsRUFBRVksUUFGZDtBQUdJLE1BQUEsS0FBSyxFQUFFLEtBQUtQLEtBQUwsQ0FBV0UsT0FBWCxJQUFzQixFQUhqQztBQUlJLE1BQUEsTUFBTSxFQUFFLEtBQUtGLEtBQUwsQ0FBV007QUFKdkIsTUFOSixlQVdJLDZCQUFDLHlCQUFEO0FBQWtCLE1BQUEsT0FBTyxFQUFFLEtBQUtNLFlBQWhDO0FBQThDLE1BQUEsSUFBSSxFQUFDO0FBQW5ELE9BQ00seUJBQUcsS0FBSCxDQUROLENBWEosQ0FESjtBQWlCSDs7QUF2Q3lFOztJQThEekRDLGEsV0FEcEIsZ0RBQXFCLG1DQUFyQixDLG1DQUFELE1BQ3FCQSxhQURyQixTQUMyQ0MsZUFBTUMsU0FEakQsQ0FDMkU7QUFNdkVDLEVBQUFBLFdBQVcsQ0FBQ2hCLEtBQUQsRUFBUTtBQUNmLFVBQU1BLEtBQU47QUFEZSw2REFvSFVXLEtBQUQsSUFBbUI7QUFDM0MsV0FBS00sUUFBTCxDQUFjO0FBQUVDLFFBQUFBLFFBQVEsRUFBRVA7QUFBWixPQUFkO0FBQ0gsS0F0SGtCO0FBQUEsNkRBd0hVSCxLQUFELElBQW1CO0FBQzNDLFVBQUksQ0FBQ0EsS0FBRCxJQUFVQSxLQUFLLENBQUNXLE1BQU4sS0FBaUIsQ0FBL0IsRUFBa0MsT0FEUyxDQUNEOztBQUUxQyxZQUFNQyxXQUFXLEdBQUdDLGlDQUFnQkMsR0FBaEIsR0FBc0JDLFNBQXRCLEVBQXBCOztBQUNBLFVBQUksQ0FBQ2YsS0FBSyxDQUFDZ0IsUUFBTixDQUFlLEdBQWYsQ0FBTCxFQUEwQmhCLEtBQUssSUFBSSxNQUFNWSxXQUFmOztBQUUxQkMsdUNBQWdCQyxHQUFoQixHQUFzQkcsV0FBdEIsQ0FBa0NqQixLQUFsQyxFQUF5QyxLQUFLUixLQUFMLENBQVcwQixNQUFwRCxFQUE0REMsSUFBNUQsQ0FBaUUsTUFBTTtBQUNuRSxhQUFLVixRQUFMLENBQWM7QUFDVlcsVUFBQUEsWUFBWSxFQUFFLEtBQUtDLEtBQUwsQ0FBV0QsWUFBWCxDQUF3QkUsTUFBeEIsQ0FBK0J0QixLQUEvQixDQURKO0FBRVZVLFVBQUFBLFFBQVEsRUFBRTtBQUZBLFNBQWQ7O0FBSUEsWUFBSSxDQUFDLEtBQUtXLEtBQUwsQ0FBV0UsY0FBaEIsRUFBZ0M7QUFDNUIsZUFBS0Msb0JBQUwsQ0FBMEJ4QixLQUExQjtBQUNIO0FBQ0osT0FSRCxFQVFHeUIsS0FSSCxDQVFVQyxHQUFELElBQVM7QUFDZEMsdUJBQU9DLEtBQVAsQ0FBYUYsR0FBYjs7QUFDQUcsdUJBQU1DLG1CQUFOLENBQTBCLHdCQUExQixFQUFvRCxFQUFwRCxFQUF3REMsb0JBQXhELEVBQXFFO0FBQ2pFQyxVQUFBQSxLQUFLLEVBQUUseUJBQUcsd0JBQUgsQ0FEMEQ7QUFFakVDLFVBQUFBLFdBQVcsRUFBRSx5QkFDVCxtRkFDQSxrQ0FGUztBQUZvRCxTQUFyRTtBQU9ILE9BakJEO0FBa0JILEtBaEprQjtBQUFBLCtEQWtKWUMsS0FBRCxJQUFtQjtBQUM3QyxZQUFNbEMsS0FBSyxHQUFHLEtBQUtxQixLQUFMLENBQVdELFlBQVgsQ0FBd0JjLEtBQXhCLENBQWQsQ0FENkMsQ0FFN0M7QUFDQTs7QUFDQXJCLHVDQUFnQkMsR0FBaEIsR0FBc0JxQixXQUF0QixDQUFrQ25DLEtBQWxDLEVBQXlDbUIsSUFBekMsQ0FBOEMsTUFBTTtBQUNoRCxjQUFNQyxZQUFZLEdBQUcsS0FBS0MsS0FBTCxDQUFXRCxZQUFYLENBQXdCZ0IsTUFBeEIsQ0FBK0JDLENBQUMsSUFBSUEsQ0FBQyxLQUFLckMsS0FBMUMsQ0FBckI7QUFDQSxhQUFLUyxRQUFMLENBQWM7QUFBRVcsVUFBQUE7QUFBRixTQUFkOztBQUVBLFlBQUksS0FBS0MsS0FBTCxDQUFXRSxjQUFYLEtBQThCdkIsS0FBbEMsRUFBeUM7QUFDckMsZUFBS3dCLG9CQUFMLENBQTBCLElBQTFCO0FBQ0g7QUFDSixPQVBELEVBT0dDLEtBUEgsQ0FPVUMsR0FBRCxJQUFTO0FBQ2RDLHVCQUFPQyxLQUFQLENBQWFGLEdBQWI7O0FBQ0EsWUFBSU8sV0FBSjs7QUFDQSxZQUFJUCxHQUFHLENBQUNZLE9BQUosS0FBZ0IsYUFBcEIsRUFBbUM7QUFDL0JMLFVBQUFBLFdBQVcsR0FBRyx5QkFBRyxrREFBSCxDQUFkO0FBQ0gsU0FGRCxNQUVPO0FBQ0hBLFVBQUFBLFdBQVcsR0FBRyx5QkFDVixxRkFDQSxpQkFGVSxDQUFkO0FBSUg7O0FBQ0RKLHVCQUFNQyxtQkFBTixDQUEwQix3QkFBMUIsRUFBb0QsRUFBcEQsRUFBd0RDLG9CQUF4RCxFQUFxRTtBQUNqRUMsVUFBQUEsS0FBSyxFQUFFLHlCQUFHLHdCQUFILENBRDBEO0FBRWpFQyxVQUFBQTtBQUZpRSxTQUFyRTtBQUlILE9BdEJEO0FBdUJILEtBN0trQjtBQUFBLGlFQStLY00sS0FBRCxJQUE0QztBQUN4RTtBQUNBLFVBQUlBLEtBQUssQ0FBQ3JDLE1BQU4sQ0FBYXNDLElBQWpCLEVBQXVCO0FBQ25CO0FBQ0EsWUFBSSxDQUFDLEtBQUtoRCxLQUFMLENBQVdpRCxvQkFBWixJQUFvQyxLQUFLcEIsS0FBTCxDQUFXRCxZQUFYLENBQXdCVCxNQUF4QixLQUFtQyxDQUEzRSxFQUE4RTtBQUMxRSxlQUFLK0IsZ0JBQUw7QUFDSDtBQUNKOztBQUNELFdBQUtqQyxRQUFMLENBQWM7QUFBRWtDLFFBQUFBLFdBQVcsRUFBRUosS0FBSyxDQUFDSyxhQUFOLENBQW9CSjtBQUFuQyxPQUFkO0FBQ0gsS0F4TGtCO0FBQUEsa0VBMExlRCxLQUFELElBQTJDO0FBQ3hFLFdBQUtmLG9CQUFMLENBQTBCZSxLQUFLLENBQUNyQyxNQUFOLENBQWFDLEtBQXZDO0FBQ0gsS0E1TGtCO0FBQUEsZ0VBOExhQSxLQUFELElBQW1CO0FBQzlDLFdBQUtNLFFBQUwsQ0FBYztBQUFFb0MsUUFBQUEsV0FBVyxFQUFFMUM7QUFBZixPQUFkO0FBQ0gsS0FoTWtCO0FBQUEsMkRBa01RSCxLQUFELElBQW1CO0FBQ3pDLFlBQU04QyxVQUFVLEdBQUcsS0FBS3pCLEtBQUwsQ0FBV3lCLFVBQVgsQ0FBc0JDLEtBQXRCLEVBQW5COztBQUNBLFVBQUksQ0FBQ0QsVUFBVSxDQUFDRSxJQUFYLENBQWdCWCxDQUFDLElBQUlBLENBQUMsQ0FBQ1ksSUFBRixPQUFhakQsS0FBSyxDQUFDaUQsSUFBTixFQUFsQyxDQUFMLEVBQXNEO0FBQ2xESCxRQUFBQSxVQUFVLENBQUNJLElBQVgsQ0FBZ0JsRCxLQUFLLENBQUNpRCxJQUFOLEVBQWhCO0FBQ0EsYUFBS0UsZ0JBQUwsQ0FBc0JMLFVBQXRCO0FBQ0EsYUFBS3JDLFFBQUwsQ0FBYztBQUFFb0MsVUFBQUEsV0FBVyxFQUFFO0FBQWYsU0FBZDtBQUNIO0FBQ0osS0F6TWtCO0FBQUEsNkRBMk1VWCxLQUFELElBQW1CO0FBQzNDLFlBQU1ZLFVBQVUsR0FBRyxLQUFLekIsS0FBTCxDQUFXeUIsVUFBWCxDQUFzQkMsS0FBdEIsRUFBbkI7QUFDQUQsTUFBQUEsVUFBVSxDQUFDTSxNQUFYLENBQWtCbEIsS0FBbEIsRUFBeUIsQ0FBekI7QUFDQSxXQUFLaUIsZ0JBQUwsQ0FBc0JMLFVBQXRCO0FBQ0gsS0EvTWtCO0FBR2YsVUFBTXpCLEtBQUssR0FBRztBQUNWeUIsTUFBQUEsVUFBVSxFQUFFLEVBREY7QUFDTTtBQUNoQjFCLE1BQUFBLFlBQVksRUFBRSxFQUZKO0FBRVE7QUFDbEJHLE1BQUFBLGNBQWMsRUFBRSxJQUhOO0FBR1k7QUFDdEI4QixNQUFBQSxzQkFBc0IsRUFBRSxLQUpkO0FBS1ZDLE1BQUFBLG1CQUFtQixFQUFFLEtBTFg7QUFNVlgsTUFBQUEsV0FBVyxFQUFFO0FBTkgsS0FBZDs7QUFTQSxRQUFJbkQsS0FBSyxDQUFDK0QsbUJBQVYsRUFBK0I7QUFDM0IsWUFBTUMsT0FBTyxHQUFHaEUsS0FBSyxDQUFDK0QsbUJBQU4sQ0FBMEJFLFVBQTFCLEVBQWhCO0FBQ0EsWUFBTVgsVUFBVSxHQUFHVSxPQUFPLENBQUNFLFdBQTNCOztBQUNBLFVBQUlDLEtBQUssQ0FBQ0MsT0FBTixDQUFjZCxVQUFkLENBQUosRUFBK0I7QUFDM0J6QixRQUFBQSxLQUFLLENBQUN5QixVQUFOLEdBQW1CQSxVQUFVLENBQUNDLEtBQVgsRUFBbkI7QUFDSDs7QUFDRDFCLE1BQUFBLEtBQUssQ0FBQ0UsY0FBTixHQUF1QmlDLE9BQU8sQ0FBQ3hELEtBQS9CO0FBQ0g7O0FBRUQsU0FBS3FCLEtBQUwsR0FBYUEsS0FBYjtBQUNIOztBQUVEd0MsRUFBQUEsaUJBQWlCLEdBQUc7QUFDaEIsUUFBSSxLQUFLckUsS0FBTCxDQUFXaUQsb0JBQWYsRUFBcUM7QUFDakM7QUFDQTtBQUNBLFdBQUtDLGdCQUFMO0FBQ0g7QUFDSjs7QUFFNkIsUUFBaEJBLGdCQUFnQixHQUFHO0FBQzdCLFNBQUtqQyxRQUFMLENBQWM7QUFBRTZDLE1BQUFBLG1CQUFtQixFQUFFO0FBQXZCLEtBQWQ7O0FBQ0EsUUFBSTtBQUNBLFlBQU1RLEdBQUcsR0FBR2pELGlDQUFnQkMsR0FBaEIsRUFBWjs7QUFDQSxVQUFJTSxZQUFZLEdBQUcsRUFBbkI7O0FBQ0EsVUFBSSxNQUFNMEMsR0FBRyxDQUFDQyxnQ0FBSixDQUFxQyxvQkFBckMsQ0FBVixFQUFzRTtBQUNsRSxjQUFNQyxRQUFRLEdBQUcsTUFBTUYsR0FBRyxDQUFDRyx1QkFBSixDQUE0QixLQUFLekUsS0FBTCxDQUFXMEIsTUFBdkMsQ0FBdkI7O0FBQ0EsWUFBSXlDLEtBQUssQ0FBQ0MsT0FBTixDQUFjSSxRQUFRLENBQUNFLE9BQXZCLENBQUosRUFBcUM7QUFDakM5QyxVQUFBQSxZQUFZLEdBQUc0QyxRQUFRLENBQUNFLE9BQXhCO0FBQ0g7QUFDSjs7QUFDRCxXQUFLekQsUUFBTCxDQUFjO0FBQUVXLFFBQUFBO0FBQUYsT0FBZDs7QUFFQSxVQUFJQSxZQUFZLENBQUNULE1BQWIsS0FBd0IsQ0FBNUIsRUFBK0I7QUFDM0IsYUFBS0YsUUFBTCxDQUFjO0FBQUVrQyxVQUFBQSxXQUFXLEVBQUU7QUFBZixTQUFkO0FBQ0g7QUFDSixLQWRELFNBY1U7QUFDTixXQUFLbEMsUUFBTCxDQUFjO0FBQUU2QyxRQUFBQSxtQkFBbUIsRUFBRTtBQUF2QixPQUFkO0FBQ0g7QUFDSjs7QUFFTzlCLEVBQUFBLG9CQUFvQixDQUFDeEIsS0FBRCxFQUFnQjtBQUN4QyxRQUFJLENBQUMsS0FBS1IsS0FBTCxDQUFXaUQsb0JBQWhCLEVBQXNDO0FBRXRDLFVBQU0wQixRQUFRLEdBQUcsS0FBSzlDLEtBQUwsQ0FBV0UsY0FBNUI7QUFDQSxTQUFLZCxRQUFMLENBQWM7QUFDVmMsTUFBQUEsY0FBYyxFQUFFdkIsS0FETjtBQUVWcUQsTUFBQUEsc0JBQXNCLEVBQUU7QUFGZCxLQUFkO0FBS0EsVUFBTWUsWUFBWSxHQUFHO0FBQ2pCVixNQUFBQSxXQUFXLEVBQUUsS0FBS3JDLEtBQUwsQ0FBV3lCO0FBRFAsS0FBckI7QUFJQSxRQUFJOUMsS0FBSixFQUFXb0UsWUFBWSxDQUFDLE9BQUQsQ0FBWixHQUF3QnBFLEtBQXhCOztBQUVYYSxxQ0FBZ0JDLEdBQWhCLEdBQXNCdUQsY0FBdEIsQ0FBcUMsS0FBSzdFLEtBQUwsQ0FBVzBCLE1BQWhELEVBQXdELHdCQUF4RCxFQUNJa0QsWUFESixFQUNrQixFQURsQixFQUNzQjNDLEtBRHRCLENBQzZCQyxHQUFELElBQVM7QUFDakNDLHFCQUFPQyxLQUFQLENBQWFGLEdBQWI7O0FBQ0FHLHFCQUFNQyxtQkFBTixDQUEwQiw2QkFBMUIsRUFBeUQsRUFBekQsRUFBNkRDLG9CQUE3RCxFQUEwRTtBQUN0RUMsUUFBQUEsS0FBSyxFQUFFLHlCQUFHLDZCQUFILENBRCtEO0FBRXRFQyxRQUFBQSxXQUFXLEVBQUUseUJBQ1QsOEZBQ0Esa0NBRlM7QUFGeUQsT0FBMUU7O0FBT0EsV0FBS3hCLFFBQUwsQ0FBYztBQUFFYyxRQUFBQSxjQUFjLEVBQUU0QztBQUFsQixPQUFkO0FBQ0gsS0FYRCxFQVdHRyxPQVhILENBV1csTUFBTTtBQUNiLFdBQUs3RCxRQUFMLENBQWM7QUFBRTRDLFFBQUFBLHNCQUFzQixFQUFFO0FBQTFCLE9BQWQ7QUFDSCxLQWJEO0FBY0g7O0FBRU9GLEVBQUFBLGdCQUFnQixDQUFDTCxVQUFELEVBQXVCO0FBQzNDLFFBQUksQ0FBQyxLQUFLdEQsS0FBTCxDQUFXaUQsb0JBQWhCLEVBQXNDO0FBRXRDLFNBQUtoQyxRQUFMLENBQWM7QUFDVjRDLE1BQUFBLHNCQUFzQixFQUFFLElBRGQ7QUFFVlAsTUFBQUE7QUFGVSxLQUFkO0FBS0EsVUFBTXNCLFlBQVksR0FBRyxFQUFyQjs7QUFFQSxRQUFJLEtBQUsvQyxLQUFMLENBQVdFLGNBQWYsRUFBK0I7QUFDM0I2QyxNQUFBQSxZQUFZLENBQUMsT0FBRCxDQUFaLEdBQXdCLEtBQUsvQyxLQUFMLENBQVdFLGNBQW5DO0FBQ0g7O0FBQ0QsUUFBSXVCLFVBQUosRUFBZ0I7QUFDWnNCLE1BQUFBLFlBQVksQ0FBQyxhQUFELENBQVosR0FBOEJ0QixVQUE5QjtBQUNIOztBQUVEakMscUNBQWdCQyxHQUFoQixHQUFzQnVELGNBQXRCLENBQXFDLEtBQUs3RSxLQUFMLENBQVcwQixNQUFoRCxFQUF3RCx3QkFBeEQsRUFDSWtELFlBREosRUFDa0IsRUFEbEIsRUFDc0IzQyxLQUR0QixDQUM2QkMsR0FBRCxJQUFTO0FBQ2pDQyxxQkFBT0MsS0FBUCxDQUFhRixHQUFiOztBQUNBRyxxQkFBTUMsbUJBQU4sQ0FBMEIsc0NBQTFCLEVBQWtFLEVBQWxFLEVBQXNFQyxvQkFBdEUsRUFBbUY7QUFDL0VDLFFBQUFBLEtBQUssRUFBRSx5QkFBRyw2QkFBSCxDQUR3RTtBQUUvRUMsUUFBQUEsV0FBVyxFQUFFLHlCQUNULG1FQUNBLHNFQUZTO0FBRmtFLE9BQW5GO0FBT0gsS0FWRCxFQVVHcUMsT0FWSCxDQVVXLE1BQU07QUFDYixXQUFLN0QsUUFBTCxDQUFjO0FBQUU0QyxRQUFBQSxzQkFBc0IsRUFBRTtBQUExQixPQUFkO0FBQ0gsS0FaRDtBQWFIOztBQStGT2tCLEVBQUFBLFVBQVUsR0FBRztBQUNqQixXQUFPLEtBQUtsRCxLQUFMLENBQVd5QixVQUFYLENBQXNCeEIsTUFBdEIsQ0FBNkIsS0FBS2tELHFCQUFMLEVBQTdCLENBQVA7QUFDSDs7QUFFT0EsRUFBQUEscUJBQXFCLEdBQUc7QUFDNUIsVUFBTTtBQUFFMUIsTUFBQUE7QUFBRixRQUFpQixLQUFLekIsS0FBNUI7QUFDQSxXQUFPLEtBQUtBLEtBQUwsQ0FBV0QsWUFBWCxDQUF3QmdCLE1BQXhCLENBQStCcEMsS0FBSyxJQUFJLENBQUM4QyxVQUFVLENBQUM5QixRQUFYLENBQW9CaEIsS0FBcEIsQ0FBekMsQ0FBUDtBQUNIOztBQUVEeUUsRUFBQUEsTUFBTSxHQUFHO0FBQUE7O0FBQ0wsVUFBTVgsR0FBRyxHQUFHakQsaUNBQWdCQyxHQUFoQixFQUFaOztBQUNBLFVBQU1GLFdBQVcsR0FBR2tELEdBQUcsQ0FBQy9DLFNBQUosRUFBcEI7QUFDQSxVQUFNMkQsV0FBVyxtQkFBR1osR0FBRyxDQUFDYSxPQUFKLENBQVksS0FBS25GLEtBQUwsQ0FBVzBCLE1BQXZCLENBQUgsaURBQUcsYUFBZ0N3RCxXQUFoQyxFQUFwQjtBQUVBLFFBQUlFLEtBQUssR0FBRyxLQUFaO0FBQ0EsVUFBTUMsY0FBYyxHQUFHLEtBQUt4RCxLQUFMLENBQVdFLGNBQVgsSUFBNkIsRUFBcEQ7O0FBQ0EsVUFBTXVELHFCQUFxQixnQkFDdkIsNkJBQUMsY0FBRDtBQUNJLE1BQUEsUUFBUSxFQUFFLEtBQUtDLHNCQURuQjtBQUVJLE1BQUEsS0FBSyxFQUFFRixjQUZYO0FBR0ksTUFBQSxRQUFRLEVBQUUsS0FBS3hELEtBQUwsQ0FBV2dDLHNCQUFYLElBQXFDLENBQUMsS0FBSzdELEtBQUwsQ0FBV2lELG9CQUgvRDtBQUlJLE1BQUEsT0FBTyxFQUFDLFFBSlo7QUFLSSxNQUFBLEVBQUUsRUFBQyxnQkFMUDtBQU1JLE1BQUEsS0FBSyxFQUFFLHlCQUFHLGNBQUg7QUFOWCxvQkFRSTtBQUFRLE1BQUEsS0FBSyxFQUFDLEVBQWQ7QUFBaUIsTUFBQSxHQUFHLEVBQUM7QUFBckIsT0FBK0IseUJBQUcsZUFBSCxDQUEvQixDQVJKLEVBVVEsS0FBSzhCLFVBQUwsR0FBa0JTLEdBQWxCLENBQXNCLENBQUNoRixLQUFELEVBQVFpRixDQUFSLEtBQWM7QUFDaEMsVUFBSWpGLEtBQUssS0FBSyxLQUFLcUIsS0FBTCxDQUFXRSxjQUF6QixFQUF5Q3FELEtBQUssR0FBRyxJQUFSO0FBQ3pDLDBCQUNJO0FBQVEsUUFBQSxLQUFLLEVBQUU1RSxLQUFmO0FBQXNCLFFBQUEsR0FBRyxFQUFFaUY7QUFBM0IsU0FDTWpGLEtBRE4sQ0FESjtBQUtILEtBUEQsQ0FWUixFQW9CUTRFLEtBQUssSUFBSSxDQUFDLEtBQUt2RCxLQUFMLENBQVdFLGNBQXJCLEdBQXNDLEVBQXRDLGdCQUNJO0FBQVEsTUFBQSxLQUFLLEVBQUUsS0FBS0YsS0FBTCxDQUFXRSxjQUExQjtBQUEwQyxNQUFBLEdBQUcsRUFBQztBQUE5QyxPQUNNLEtBQUtGLEtBQUwsQ0FBV0UsY0FEakIsQ0FyQlosQ0FESjs7QUE2QkEsUUFBSTJELGdCQUFKOztBQUNBLFFBQUksS0FBSzdELEtBQUwsQ0FBV2lDLG1CQUFmLEVBQW9DO0FBQ2hDNEIsTUFBQUEsZ0JBQWdCLGdCQUFHLDZCQUFDLGdCQUFELE9BQW5CO0FBQ0gsS0FGRCxNQUVPO0FBQ0hBLE1BQUFBLGdCQUFnQixnQkFBSSw2QkFBQyxtQkFBRDtBQUNoQixRQUFBLEVBQUUsRUFBQyxhQURhO0FBRWhCLFFBQUEsS0FBSyxFQUFFLEtBQUs3RCxLQUFMLENBQVdELFlBRkY7QUFHaEIsUUFBQSxPQUFPLEVBQUUsS0FBS0MsS0FBTCxDQUFXWCxRQUhKO0FBSWhCLFFBQUEsZ0JBQWdCLEVBQUUsS0FBS3lFLGlCQUpQO0FBS2hCLFFBQUEsU0FBUyxFQUFFLEtBQUszRixLQUFMLENBQVc0RixhQUxOO0FBTWhCLFFBQUEsT0FBTyxFQUFFLEtBQUs1RixLQUFMLENBQVc0RixhQU5KO0FBT2hCLFFBQUEsV0FBVyxFQUFFLEtBQUtDLGlCQVBGO0FBUWhCLFFBQUEsYUFBYSxFQUFFLEtBQUtDLG1CQVJKO0FBU2hCLFFBQUEsWUFBWSxFQUFFWixXQUFXLEdBQ25CLHlCQUFHLG1DQUFILENBRG1CLEdBRW5CLHlCQUFHLGtDQUFILENBWFU7QUFZaEIsUUFBQSxXQUFXLEVBQUUseUJBQUcsZUFBSCxDQVpHO0FBYWhCLFFBQUEsTUFBTSxFQUFFOUQ7QUFiUSxRQUFwQjtBQWVIOztBQUVELHdCQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSTtBQUFNLE1BQUEsU0FBUyxFQUFDO0FBQWhCLE9BQThDLHlCQUFHLHFCQUFILENBQTlDLENBREosZUFFSSx3Q0FDTThELFdBQVcsR0FDUCx5QkFBRyw2RUFBSCxDQURPLEdBRVAseUJBQUcsNEVBQUgsQ0FIVixVQUtNLHlCQUFHLHFFQUFILENBTE4sQ0FGSixFQVNNSSxxQkFUTixFQVVNLEtBQUt0RixLQUFMLENBQVcrRixrQkFBWCxHQUNJLElBREosZ0JBRUksNkJBQUMsMkJBQUQ7QUFDRSxNQUFBLE1BQU0sRUFBRSxLQUFLL0YsS0FBTCxDQUFXMEIsTUFEckI7QUFFRSxNQUFBLG9CQUFvQixFQUFFLEtBQUsxQixLQUFMLENBQVdpRDtBQUZuQyxNQVpWLGVBZ0JJO0FBQVUsTUFBQSxFQUFFLEVBQUM7QUFBYixPQUNNLEtBQUsrQixxQkFBTCxHQUE2QlEsR0FBN0IsQ0FBaUNoRixLQUFLLElBQUk7QUFDeEMsMEJBQU87QUFBUSxRQUFBLEtBQUssRUFBRUEsS0FBZjtBQUFzQixRQUFBLEdBQUcsRUFBRUE7QUFBM0IsUUFBUDtBQUNILEtBRkMsQ0FETixNQWhCSixlQXFCSSw2QkFBQyxtQkFBRDtBQUNJLE1BQUEsRUFBRSxFQUFDLGdCQURQO0FBRUksTUFBQSxLQUFLLEVBQUUsS0FBS3FCLEtBQUwsQ0FBV3lCLFVBRnRCO0FBR0ksTUFBQSxPQUFPLEVBQUUsS0FBS3pCLEtBQUwsQ0FBV3dCLFdBSHhCO0FBSUksTUFBQSxnQkFBZ0IsRUFBRSxLQUFLMkMsb0JBSjNCO0FBS0ksTUFBQSxTQUFTLEVBQUUsS0FBS2hHLEtBQUwsQ0FBV2lELG9CQUwxQjtBQU1JLE1BQUEsT0FBTyxFQUFFLEtBQUtqRCxLQUFMLENBQVdpRCxvQkFOeEI7QUFPSSxNQUFBLFdBQVcsRUFBRSxLQUFLZ0QsZUFQdEI7QUFRSSxNQUFBLGFBQWEsRUFBRSxLQUFLQyxpQkFSeEI7QUFTSSxNQUFBLGlCQUFpQixFQUFDLHFDQVR0QjtBQVVJLE1BQUEsVUFBVSxFQUFFLHlCQUFHLDRCQUFILENBVmhCO0FBV0ksTUFBQSxZQUFZLEVBQUUseUJBQUcsaURBQUgsQ0FYbEI7QUFZSSxNQUFBLFdBQVcsRUFBRSx5QkFBRyw0Q0FBSDtBQVpqQixNQXJCSixlQW1DSTtBQUFNLE1BQUEsU0FBUyxFQUFDO0FBQWhCLE9BQ00seUJBQUcsaUJBQUgsQ0FETixDQW5DSixlQXNDSSx3Q0FDTWhCLFdBQVcsR0FDUCx5QkFBRywrREFDRCwyQ0FERixFQUMrQztBQUFFOUQsTUFBQUE7QUFBRixLQUQvQyxDQURPLEdBR1AseUJBQUcsNkRBQ0wsMkNBREUsRUFDMkM7QUFBRUEsTUFBQUE7QUFBRixLQUQzQyxDQUpWLENBdENKLGVBNkNJO0FBQVMsTUFBQSxRQUFRLEVBQUUsS0FBSytFLHFCQUF4QjtBQUErQyxNQUFBLElBQUksRUFBRSxLQUFLdEUsS0FBTCxDQUFXc0I7QUFBaEUsb0JBQ0ksOENBQVcsS0FBS3RCLEtBQUwsQ0FBV3NCLFdBQVgsR0FBeUIseUJBQUcsV0FBSCxDQUF6QixHQUEyQyx5QkFBRyxXQUFILENBQXRELENBREosRUFFTXVDLGdCQUZOLENBN0NKLENBREo7QUFvREg7O0FBN1VzRSxDLHlEQUNqRDtBQUNsQkUsRUFBQUEsYUFBYSxFQUFFLEtBREc7QUFFbEIzQyxFQUFBQSxvQkFBb0IsRUFBRTtBQUZKLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTYgLSAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IENoYW5nZUV2ZW50LCBjcmVhdGVSZWYgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudFwiO1xuXG5pbXBvcnQgRWRpdGFibGVJdGVtTGlzdCBmcm9tIFwiLi4vZWxlbWVudHMvRWRpdGFibGVJdGVtTGlzdFwiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IEZpZWxkIGZyb20gXCIuLi9lbGVtZW50cy9GaWVsZFwiO1xuaW1wb3J0IFNwaW5uZXIgZnJvbSBcIi4uL2VsZW1lbnRzL1NwaW5uZXJcIjtcbmltcG9ydCBFcnJvckRpYWxvZyBmcm9tIFwiLi4vZGlhbG9ncy9FcnJvckRpYWxvZ1wiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCBNb2RhbCBmcm9tIFwiLi4vLi4vLi4vTW9kYWxcIjtcbmltcG9ydCBSb29tUHVibGlzaFNldHRpbmcgZnJvbSBcIi4vUm9vbVB1Ymxpc2hTZXR0aW5nXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IFJvb21BbGlhc0ZpZWxkIGZyb20gXCIuLi9lbGVtZW50cy9Sb29tQWxpYXNGaWVsZFwiO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbmludGVyZmFjZSBJRWRpdGFibGVBbGlhc2VzTGlzdFByb3BzIHtcbiAgICBkb21haW4/OiBzdHJpbmc7XG59XG5cbmNsYXNzIEVkaXRhYmxlQWxpYXNlc0xpc3QgZXh0ZW5kcyBFZGl0YWJsZUl0ZW1MaXN0PElFZGl0YWJsZUFsaWFzZXNMaXN0UHJvcHM+IHtcbiAgICBwcml2YXRlIGFsaWFzRmllbGQgPSBjcmVhdGVSZWY8Um9vbUFsaWFzRmllbGQ+KCk7XG5cbiAgICBwcml2YXRlIG9uQWxpYXNBZGRlZCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5hbGlhc0ZpZWxkLmN1cnJlbnQudmFsaWRhdGUoeyBhbGxvd0VtcHR5OiBmYWxzZSB9KTtcblxuICAgICAgICBpZiAodGhpcy5hbGlhc0ZpZWxkLmN1cnJlbnQuaXNWYWxpZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMub25JdGVtQWRkZWQpIHRoaXMucHJvcHMub25JdGVtQWRkZWQodGhpcy5wcm9wcy5uZXdJdGVtKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYWxpYXNGaWVsZC5jdXJyZW50LmZvY3VzKCk7XG4gICAgICAgIHRoaXMuYWxpYXNGaWVsZC5jdXJyZW50LnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogZmFsc2UsIGZvY3VzZWQ6IHRydWUgfSk7XG4gICAgfTtcblxuICAgIHByb3RlY3RlZCByZW5kZXJOZXdJdGVtRmllbGQoKSB7XG4gICAgICAgIC8vIGlmIHdlIGRvbid0IG5lZWQgdGhlIFJvb21BbGlhc0ZpZWxkLFxuICAgICAgICAvLyB3ZSBkb24ndCBuZWVkIHRvIG92ZXJyaWRlbiB2ZXJzaW9uIG9mIHJlbmRlck5ld0l0ZW1GaWVsZFxuICAgICAgICBpZiAoIXRoaXMucHJvcHMuZG9tYWluKSB7XG4gICAgICAgICAgICByZXR1cm4gc3VwZXIucmVuZGVyTmV3SXRlbUZpZWxkKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb25DaGFuZ2UgPSAoYWxpYXMpID0+IHRoaXMub25OZXdJdGVtQ2hhbmdlZCh7IHRhcmdldDogeyB2YWx1ZTogYWxpYXMgfSB9KTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxmb3JtXG4gICAgICAgICAgICAgICAgb25TdWJtaXQ9e3RoaXMub25BbGlhc0FkZGVkfVxuICAgICAgICAgICAgICAgIGF1dG9Db21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICAgICAgbm9WYWxpZGF0ZT17dHJ1ZX1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9FZGl0YWJsZUl0ZW1MaXN0X25ld0l0ZW1cIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxSb29tQWxpYXNGaWVsZFxuICAgICAgICAgICAgICAgICAgICByZWY9e3RoaXMuYWxpYXNGaWVsZH1cbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e29uQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5wcm9wcy5uZXdJdGVtIHx8IFwiXCJ9XG4gICAgICAgICAgICAgICAgICAgIGRvbWFpbj17dGhpcy5wcm9wcy5kb21haW59IC8+XG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17dGhpcy5vbkFsaWFzQWRkZWR9IGtpbmQ9XCJwcmltYXJ5XCI+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJBZGRcIikgfVxuICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgKTtcbiAgICB9XG59XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHJvb21JZDogc3RyaW5nO1xuICAgIGNhblNldENhbm9uaWNhbEFsaWFzOiBib29sZWFuO1xuICAgIGNhblNldEFsaWFzZXM6IGJvb2xlYW47XG4gICAgY2Fub25pY2FsQWxpYXNFdmVudD86IE1hdHJpeEV2ZW50O1xuICAgIGhpZGVQdWJsaXNoU2V0dGluZz86IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIGFsdEFsaWFzZXM6IHN0cmluZ1tdO1xuICAgIGxvY2FsQWxpYXNlczogc3RyaW5nW107XG4gICAgY2Fub25pY2FsQWxpYXM/OiBzdHJpbmc7XG4gICAgdXBkYXRpbmdDYW5vbmljYWxBbGlhczogYm9vbGVhbjtcbiAgICBsb2NhbEFsaWFzZXNMb2FkaW5nOiBib29sZWFuO1xuICAgIGRldGFpbHNPcGVuOiBib29sZWFuO1xuICAgIG5ld0FsaWFzPzogc3RyaW5nO1xuICAgIG5ld0FsdEFsaWFzPzogc3RyaW5nO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5yb29tX3NldHRpbmdzLkFsaWFzU2V0dGluZ3NcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFsaWFzU2V0dGluZ3MgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgICBjYW5TZXRBbGlhc2VzOiBmYWxzZSxcbiAgICAgICAgY2FuU2V0Q2Fub25pY2FsQWxpYXM6IGZhbHNlLFxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgY29uc3Qgc3RhdGUgPSB7XG4gICAgICAgICAgICBhbHRBbGlhc2VzOiBbXSwgLy8gWyAjYWxpYXM6ZG9tYWluLnRsZCwgLi4uIF1cbiAgICAgICAgICAgIGxvY2FsQWxpYXNlczogW10sIC8vIFsgI2FsaWFzOm15LWhzLnRsZCwgLi4uIF1cbiAgICAgICAgICAgIGNhbm9uaWNhbEFsaWFzOiBudWxsLCAvLyAjY2Fub25pY2FsOmRvbWFpbi50bGRcbiAgICAgICAgICAgIHVwZGF0aW5nQ2Fub25pY2FsQWxpYXM6IGZhbHNlLFxuICAgICAgICAgICAgbG9jYWxBbGlhc2VzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICBkZXRhaWxzT3BlbjogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHByb3BzLmNhbm9uaWNhbEFsaWFzRXZlbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBwcm9wcy5jYW5vbmljYWxBbGlhc0V2ZW50LmdldENvbnRlbnQoKTtcbiAgICAgICAgICAgIGNvbnN0IGFsdEFsaWFzZXMgPSBjb250ZW50LmFsdF9hbGlhc2VzO1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYWx0QWxpYXNlcykpIHtcbiAgICAgICAgICAgICAgICBzdGF0ZS5hbHRBbGlhc2VzID0gYWx0QWxpYXNlcy5zbGljZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RhdGUuY2Fub25pY2FsQWxpYXMgPSBjb250ZW50LmFsaWFzO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5jYW5TZXRDYW5vbmljYWxBbGlhcykge1xuICAgICAgICAgICAgLy8gbG9hZCBsb2NhbCBhbGlhc2VzIGZvciBwcm92aWRpbmcgcmVjb21tZW5kYXRpb25zXG4gICAgICAgICAgICAvLyBmb3IgdGhlIGNhbm9uaWNhbCBhbGlhcyBhbmQgYWx0X2FsaWFzZXNcbiAgICAgICAgICAgIHRoaXMubG9hZExvY2FsQWxpYXNlcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBsb2FkTG9jYWxBbGlhc2VzKCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgbG9jYWxBbGlhc2VzTG9hZGluZzogdHJ1ZSB9KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgICAgIGxldCBsb2NhbEFsaWFzZXMgPSBbXTtcbiAgICAgICAgICAgIGlmIChhd2FpdCBjbGkuZG9lc1NlcnZlclN1cHBvcnRVbnN0YWJsZUZlYXR1cmUoXCJvcmcubWF0cml4Lm1zYzI0MzJcIikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaS51bnN0YWJsZUdldExvY2FsQWxpYXNlcyh0aGlzLnByb3BzLnJvb21JZCk7XG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYWxpYXNlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxBbGlhc2VzID0gcmVzcG9uc2UuYWxpYXNlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgbG9jYWxBbGlhc2VzIH0pO1xuXG4gICAgICAgICAgICBpZiAobG9jYWxBbGlhc2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBkZXRhaWxzT3BlbjogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBsb2NhbEFsaWFzZXNMb2FkaW5nOiBmYWxzZSB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY2hhbmdlQ2Fub25pY2FsQWxpYXMoYWxpYXM6IHN0cmluZykge1xuICAgICAgICBpZiAoIXRoaXMucHJvcHMuY2FuU2V0Q2Fub25pY2FsQWxpYXMpIHJldHVybjtcblxuICAgICAgICBjb25zdCBvbGRBbGlhcyA9IHRoaXMuc3RhdGUuY2Fub25pY2FsQWxpYXM7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgY2Fub25pY2FsQWxpYXM6IGFsaWFzLFxuICAgICAgICAgICAgdXBkYXRpbmdDYW5vbmljYWxBbGlhczogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgZXZlbnRDb250ZW50ID0ge1xuICAgICAgICAgICAgYWx0X2FsaWFzZXM6IHRoaXMuc3RhdGUuYWx0QWxpYXNlcyxcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoYWxpYXMpIGV2ZW50Q29udGVudFtcImFsaWFzXCJdID0gYWxpYXM7XG5cbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLnNlbmRTdGF0ZUV2ZW50KHRoaXMucHJvcHMucm9vbUlkLCBcIm0ucm9vbS5jYW5vbmljYWxfYWxpYXNcIixcbiAgICAgICAgICAgIGV2ZW50Q29udGVudCwgXCJcIikuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycik7XG4gICAgICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdFcnJvciB1cGRhdGluZyBtYWluIGFkZHJlc3MnLCAnJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogX3QoXCJFcnJvciB1cGRhdGluZyBtYWluIGFkZHJlc3NcIiksXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KFxuICAgICAgICAgICAgICAgICAgICBcIlRoZXJlIHdhcyBhbiBlcnJvciB1cGRhdGluZyB0aGUgcm9vbSdzIG1haW4gYWRkcmVzcy4gSXQgbWF5IG5vdCBiZSBhbGxvd2VkIGJ5IHRoZSBzZXJ2ZXIgXCIgK1xuICAgICAgICAgICAgICAgICAgICBcIm9yIGEgdGVtcG9yYXJ5IGZhaWx1cmUgb2NjdXJyZWQuXCIsXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGNhbm9uaWNhbEFsaWFzOiBvbGRBbGlhcyB9KTtcbiAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgdXBkYXRpbmdDYW5vbmljYWxBbGlhczogZmFsc2UgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hhbmdlQWx0QWxpYXNlcyhhbHRBbGlhc2VzOiBzdHJpbmdbXSkge1xuICAgICAgICBpZiAoIXRoaXMucHJvcHMuY2FuU2V0Q2Fub25pY2FsQWxpYXMpIHJldHVybjtcblxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHVwZGF0aW5nQ2Fub25pY2FsQWxpYXM6IHRydWUsXG4gICAgICAgICAgICBhbHRBbGlhc2VzLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBldmVudENvbnRlbnQgPSB7fTtcblxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jYW5vbmljYWxBbGlhcykge1xuICAgICAgICAgICAgZXZlbnRDb250ZW50W1wiYWxpYXNcIl0gPSB0aGlzLnN0YXRlLmNhbm9uaWNhbEFsaWFzO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhbHRBbGlhc2VzKSB7XG4gICAgICAgICAgICBldmVudENvbnRlbnRbXCJhbHRfYWxpYXNlc1wiXSA9IGFsdEFsaWFzZXM7XG4gICAgICAgIH1cblxuICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuc2VuZFN0YXRlRXZlbnQodGhpcy5wcm9wcy5yb29tSWQsIFwibS5yb29tLmNhbm9uaWNhbF9hbGlhc1wiLFxuICAgICAgICAgICAgZXZlbnRDb250ZW50LCBcIlwiKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0Vycm9yIHVwZGF0aW5nIGFsdGVybmF0aXZlIGFkZHJlc3NlcycsICcnLCBFcnJvckRpYWxvZywge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBfdChcIkVycm9yIHVwZGF0aW5nIG1haW4gYWRkcmVzc1wiKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiVGhlcmUgd2FzIGFuIGVycm9yIHVwZGF0aW5nIHRoZSByb29tJ3MgYWx0ZXJuYXRpdmUgYWRkcmVzc2VzLiBcIiArXG4gICAgICAgICAgICAgICAgICAgIFwiSXQgbWF5IG5vdCBiZSBhbGxvd2VkIGJ5IHRoZSBzZXJ2ZXIgb3IgYSB0ZW1wb3JhcnkgZmFpbHVyZSBvY2N1cnJlZC5cIixcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHVwZGF0aW5nQ2Fub25pY2FsQWxpYXM6IGZhbHNlIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uTmV3QWxpYXNDaGFuZ2VkID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG5ld0FsaWFzOiB2YWx1ZSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkxvY2FsQWxpYXNBZGRlZCA9IChhbGlhczogc3RyaW5nKSA9PiB7XG4gICAgICAgIGlmICghYWxpYXMgfHwgYWxpYXMubGVuZ3RoID09PSAwKSByZXR1cm47IC8vIGlnbm9yZSBhdHRlbXB0cyB0byBjcmVhdGUgYmxhbmsgYWxpYXNlc1xuXG4gICAgICAgIGNvbnN0IGxvY2FsRG9tYWluID0gTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldERvbWFpbigpO1xuICAgICAgICBpZiAoIWFsaWFzLmluY2x1ZGVzKCc6JykpIGFsaWFzICs9ICc6JyArIGxvY2FsRG9tYWluO1xuXG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5jcmVhdGVBbGlhcyhhbGlhcywgdGhpcy5wcm9wcy5yb29tSWQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgbG9jYWxBbGlhc2VzOiB0aGlzLnN0YXRlLmxvY2FsQWxpYXNlcy5jb25jYXQoYWxpYXMpLFxuICAgICAgICAgICAgICAgIG5ld0FsaWFzOiBudWxsLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUuY2Fub25pY2FsQWxpYXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZUNhbm9uaWNhbEFsaWFzKGFsaWFzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycik7XG4gICAgICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdFcnJvciBjcmVhdGluZyBhZGRyZXNzJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IF90KFwiRXJyb3IgY3JlYXRpbmcgYWRkcmVzc1wiKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiVGhlcmUgd2FzIGFuIGVycm9yIGNyZWF0aW5nIHRoYXQgYWRkcmVzcy4gSXQgbWF5IG5vdCBiZSBhbGxvd2VkIGJ5IHRoZSBzZXJ2ZXIgXCIgK1xuICAgICAgICAgICAgICAgICAgICBcIm9yIGEgdGVtcG9yYXJ5IGZhaWx1cmUgb2NjdXJyZWQuXCIsXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkxvY2FsQWxpYXNEZWxldGVkID0gKGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgYWxpYXMgPSB0aGlzLnN0YXRlLmxvY2FsQWxpYXNlc1tpbmRleF07XG4gICAgICAgIC8vIFRPRE86IEluIGZ1dHVyZSwgd2Ugc2hvdWxkIHByb2JhYmx5IGJlIG1ha2luZyBzdXJlIHRoYXQgdGhlIGFsaWFzIGFjdHVhbGx5IGJlbG9uZ3NcbiAgICAgICAgLy8gdG8gdGhpcyByb29tLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3ZlY3Rvci1pbS9lbGVtZW50LXdlYi9pc3N1ZXMvNzM1M1xuICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZGVsZXRlQWxpYXMoYWxpYXMpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbG9jYWxBbGlhc2VzID0gdGhpcy5zdGF0ZS5sb2NhbEFsaWFzZXMuZmlsdGVyKGEgPT4gYSAhPT0gYWxpYXMpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGxvY2FsQWxpYXNlcyB9KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuY2Fub25pY2FsQWxpYXMgPT09IGFsaWFzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VDYW5vbmljYWxBbGlhcyhudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycik7XG4gICAgICAgICAgICBsZXQgZGVzY3JpcHRpb247XG4gICAgICAgICAgICBpZiAoZXJyLmVycmNvZGUgPT09IFwiTV9GT1JCSURERU5cIikge1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gX3QoXCJZb3UgZG9uJ3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGRlbGV0ZSB0aGUgYWRkcmVzcy5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiVGhlcmUgd2FzIGFuIGVycm9yIHJlbW92aW5nIHRoYXQgYWRkcmVzcy4gSXQgbWF5IG5vIGxvbmdlciBleGlzdCBvciBhIHRlbXBvcmFyeSBcIiArXG4gICAgICAgICAgICAgICAgICAgIFwiZXJyb3Igb2NjdXJyZWQuXCIsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coJ0Vycm9yIHJlbW92aW5nIGFkZHJlc3MnLCAnJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogX3QoXCJFcnJvciByZW1vdmluZyBhZGRyZXNzXCIpLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uTG9jYWxBbGlhc2VzVG9nZ2xlZCA9IChldmVudDogQ2hhbmdlRXZlbnQ8SFRNTERldGFpbHNFbGVtZW50PikgPT4ge1xuICAgICAgICAvLyBleHBhbmRlZFxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Lm9wZW4pIHtcbiAgICAgICAgICAgIC8vIGlmIGxvY2FsIGFsaWFzZXMgaGF2ZW4ndCBiZWVuIHByZWxvYWRlZCB5ZXQgYXQgY29tcG9uZW50IG1vdW50XG4gICAgICAgICAgICBpZiAoIXRoaXMucHJvcHMuY2FuU2V0Q2Fub25pY2FsQWxpYXMgJiYgdGhpcy5zdGF0ZS5sb2NhbEFsaWFzZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkTG9jYWxBbGlhc2VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGRldGFpbHNPcGVuOiBldmVudC5jdXJyZW50VGFyZ2V0Lm9wZW4gfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25DYW5vbmljYWxBbGlhc0NoYW5nZSA9IChldmVudDogQ2hhbmdlRXZlbnQ8SFRNTFNlbGVjdEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIHRoaXMuY2hhbmdlQ2Fub25pY2FsQWxpYXMoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbk5ld0FsdEFsaWFzQ2hhbmdlZCA9ICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBuZXdBbHRBbGlhczogdmFsdWUgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25BbHRBbGlhc0FkZGVkID0gKGFsaWFzOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgYWx0QWxpYXNlcyA9IHRoaXMuc3RhdGUuYWx0QWxpYXNlcy5zbGljZSgpO1xuICAgICAgICBpZiAoIWFsdEFsaWFzZXMuc29tZShhID0+IGEudHJpbSgpID09PSBhbGlhcy50cmltKCkpKSB7XG4gICAgICAgICAgICBhbHRBbGlhc2VzLnB1c2goYWxpYXMudHJpbSgpKTtcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQWx0QWxpYXNlcyhhbHRBbGlhc2VzKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBuZXdBbHRBbGlhczogXCJcIiB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQWx0QWxpYXNEZWxldGVkID0gKGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgYWx0QWxpYXNlcyA9IHRoaXMuc3RhdGUuYWx0QWxpYXNlcy5zbGljZSgpO1xuICAgICAgICBhbHRBbGlhc2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHRoaXMuY2hhbmdlQWx0QWxpYXNlcyhhbHRBbGlhc2VzKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBnZXRBbGlhc2VzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5hbHRBbGlhc2VzLmNvbmNhdCh0aGlzLmdldExvY2FsTm9uQWx0QWxpYXNlcygpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldExvY2FsTm9uQWx0QWxpYXNlcygpIHtcbiAgICAgICAgY29uc3QgeyBhbHRBbGlhc2VzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5sb2NhbEFsaWFzZXMuZmlsdGVyKGFsaWFzID0+ICFhbHRBbGlhc2VzLmluY2x1ZGVzKGFsaWFzKSk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBjbGkgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGNvbnN0IGxvY2FsRG9tYWluID0gY2xpLmdldERvbWFpbigpO1xuICAgICAgICBjb25zdCBpc1NwYWNlUm9vbSA9IGNsaS5nZXRSb29tKHRoaXMucHJvcHMucm9vbUlkKT8uaXNTcGFjZVJvb20oKTtcblxuICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgY2Fub25pY2FsVmFsdWUgPSB0aGlzLnN0YXRlLmNhbm9uaWNhbEFsaWFzIHx8IFwiXCI7XG4gICAgICAgIGNvbnN0IGNhbm9uaWNhbEFsaWFzU2VjdGlvbiA9IChcbiAgICAgICAgICAgIDxGaWVsZFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uQ2Fub25pY2FsQWxpYXNDaGFuZ2V9XG4gICAgICAgICAgICAgICAgdmFsdWU9e2Nhbm9uaWNhbFZhbHVlfVxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLnVwZGF0aW5nQ2Fub25pY2FsQWxpYXMgfHwgIXRoaXMucHJvcHMuY2FuU2V0Q2Fub25pY2FsQWxpYXN9XG4gICAgICAgICAgICAgICAgZWxlbWVudD0nc2VsZWN0J1xuICAgICAgICAgICAgICAgIGlkPSdjYW5vbmljYWxBbGlhcydcbiAgICAgICAgICAgICAgICBsYWJlbD17X3QoJ01haW4gYWRkcmVzcycpfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIiBrZXk9XCJ1bnNldFwiPnsgX3QoJ25vdCBzcGVjaWZpZWQnKSB9PC9vcHRpb24+XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEFsaWFzZXMoKS5tYXAoKGFsaWFzLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxpYXMgPT09IHRoaXMuc3RhdGUuY2Fub25pY2FsQWxpYXMpIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT17YWxpYXN9IGtleT17aX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgYWxpYXMgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvb3B0aW9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCB8fCAhdGhpcy5zdGF0ZS5jYW5vbmljYWxBbGlhcyA/ICcnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9e3RoaXMuc3RhdGUuY2Fub25pY2FsQWxpYXN9IGtleT0nYXJiaXRyYXJ5Jz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHRoaXMuc3RhdGUuY2Fub25pY2FsQWxpYXMgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9vcHRpb24+XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9GaWVsZD5cbiAgICAgICAgKTtcblxuICAgICAgICBsZXQgbG9jYWxBbGlhc2VzTGlzdDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUubG9jYWxBbGlhc2VzTG9hZGluZykge1xuICAgICAgICAgICAgbG9jYWxBbGlhc2VzTGlzdCA9IDxTcGlubmVyIC8+O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbG9jYWxBbGlhc2VzTGlzdCA9ICg8RWRpdGFibGVBbGlhc2VzTGlzdFxuICAgICAgICAgICAgICAgIGlkPVwicm9vbUFsaWFzZXNcIlxuICAgICAgICAgICAgICAgIGl0ZW1zPXt0aGlzLnN0YXRlLmxvY2FsQWxpYXNlc31cbiAgICAgICAgICAgICAgICBuZXdJdGVtPXt0aGlzLnN0YXRlLm5ld0FsaWFzfVxuICAgICAgICAgICAgICAgIG9uTmV3SXRlbUNoYW5nZWQ9e3RoaXMub25OZXdBbGlhc0NoYW5nZWR9XG4gICAgICAgICAgICAgICAgY2FuUmVtb3ZlPXt0aGlzLnByb3BzLmNhblNldEFsaWFzZXN9XG4gICAgICAgICAgICAgICAgY2FuRWRpdD17dGhpcy5wcm9wcy5jYW5TZXRBbGlhc2VzfVxuICAgICAgICAgICAgICAgIG9uSXRlbUFkZGVkPXt0aGlzLm9uTG9jYWxBbGlhc0FkZGVkfVxuICAgICAgICAgICAgICAgIG9uSXRlbVJlbW92ZWQ9e3RoaXMub25Mb2NhbEFsaWFzRGVsZXRlZH1cbiAgICAgICAgICAgICAgICBub0l0ZW1zTGFiZWw9e2lzU3BhY2VSb29tXG4gICAgICAgICAgICAgICAgICAgID8gX3QoXCJUaGlzIHNwYWNlIGhhcyBubyBsb2NhbCBhZGRyZXNzZXNcIilcbiAgICAgICAgICAgICAgICAgICAgOiBfdChcIlRoaXMgcm9vbSBoYXMgbm8gbG9jYWwgYWRkcmVzc2VzXCIpfVxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtfdCgnTG9jYWwgYWRkcmVzcycpfVxuICAgICAgICAgICAgICAgIGRvbWFpbj17bG9jYWxEb21haW59XG4gICAgICAgICAgICAvPik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X0FsaWFzU2V0dGluZ3MnPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0nbXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZyc+eyBfdChcIlB1Ymxpc2hlZCBBZGRyZXNzZXNcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAgICAgICAgeyBpc1NwYWNlUm9vbVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBfdChcIlB1Ymxpc2hlZCBhZGRyZXNzZXMgY2FuIGJlIHVzZWQgYnkgYW55b25lIG9uIGFueSBzZXJ2ZXIgdG8gam9pbiB5b3VyIHNwYWNlLlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBfdChcIlB1Ymxpc2hlZCBhZGRyZXNzZXMgY2FuIGJlIHVzZWQgYnkgYW55b25lIG9uIGFueSBzZXJ2ZXIgdG8gam9pbiB5b3VyIHJvb20uXCIpIH1cbiAgICAgICAgICAgICAgICAgICAgJm5ic3A7XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJUbyBwdWJsaXNoIGFuIGFkZHJlc3MsIGl0IG5lZWRzIHRvIGJlIHNldCBhcyBhIGxvY2FsIGFkZHJlc3MgZmlyc3QuXCIpIH1cbiAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgeyBjYW5vbmljYWxBbGlhc1NlY3Rpb24gfVxuICAgICAgICAgICAgICAgIHsgdGhpcy5wcm9wcy5oaWRlUHVibGlzaFNldHRpbmdcbiAgICAgICAgICAgICAgICAgICAgPyBudWxsXG4gICAgICAgICAgICAgICAgICAgIDogPFJvb21QdWJsaXNoU2V0dGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbUlkPXt0aGlzLnByb3BzLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhblNldENhbm9uaWNhbEFsaWFzPXt0aGlzLnByb3BzLmNhblNldENhbm9uaWNhbEFsaWFzfVxuICAgICAgICAgICAgICAgICAgICAvPiB9XG4gICAgICAgICAgICAgICAgPGRhdGFsaXN0IGlkPVwibXhfQWxpYXNTZXR0aW5nc19hbHRSZWNvbW1lbmRhdGlvbnNcIj5cbiAgICAgICAgICAgICAgICAgICAgeyB0aGlzLmdldExvY2FsTm9uQWx0QWxpYXNlcygpLm1hcChhbGlhcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gPG9wdGlvbiB2YWx1ZT17YWxpYXN9IGtleT17YWxpYXN9IC8+O1xuICAgICAgICAgICAgICAgICAgICB9KSB9O1xuICAgICAgICAgICAgICAgIDwvZGF0YWxpc3Q+XG4gICAgICAgICAgICAgICAgPEVkaXRhYmxlQWxpYXNlc0xpc3RcbiAgICAgICAgICAgICAgICAgICAgaWQ9XCJyb29tQWx0QWxpYXNlc1wiXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zPXt0aGlzLnN0YXRlLmFsdEFsaWFzZXN9XG4gICAgICAgICAgICAgICAgICAgIG5ld0l0ZW09e3RoaXMuc3RhdGUubmV3QWx0QWxpYXN9XG4gICAgICAgICAgICAgICAgICAgIG9uTmV3SXRlbUNoYW5nZWQ9e3RoaXMub25OZXdBbHRBbGlhc0NoYW5nZWR9XG4gICAgICAgICAgICAgICAgICAgIGNhblJlbW92ZT17dGhpcy5wcm9wcy5jYW5TZXRDYW5vbmljYWxBbGlhc31cbiAgICAgICAgICAgICAgICAgICAgY2FuRWRpdD17dGhpcy5wcm9wcy5jYW5TZXRDYW5vbmljYWxBbGlhc31cbiAgICAgICAgICAgICAgICAgICAgb25JdGVtQWRkZWQ9e3RoaXMub25BbHRBbGlhc0FkZGVkfVxuICAgICAgICAgICAgICAgICAgICBvbkl0ZW1SZW1vdmVkPXt0aGlzLm9uQWx0QWxpYXNEZWxldGVkfVxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0aW9uc0xpc3RJZD1cIm14X0FsaWFzU2V0dGluZ3NfYWx0UmVjb21tZW5kYXRpb25zXCJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNMYWJlbD17X3QoJ090aGVyIHB1Ymxpc2hlZCBhZGRyZXNzZXM6Jyl9XG4gICAgICAgICAgICAgICAgICAgIG5vSXRlbXNMYWJlbD17X3QoJ05vIG90aGVyIHB1Ymxpc2hlZCBhZGRyZXNzZXMgeWV0LCBhZGQgb25lIGJlbG93Jyl9XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtfdCgnTmV3IHB1Ymxpc2hlZCBhZGRyZXNzIChlLmcuICNhbGlhczpzZXJ2ZXIpJyl9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J214X1NldHRpbmdzVGFiX3N1YmhlYWRpbmcgbXhfQWxpYXNTZXR0aW5nc19sb2NhbEFsaWFzSGVhZGVyJz5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcIkxvY2FsIEFkZHJlc3Nlc1wiKSB9XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgICB7IGlzU3BhY2VSb29tXG4gICAgICAgICAgICAgICAgICAgICAgICA/IF90KFwiU2V0IGFkZHJlc3NlcyBmb3IgdGhpcyBzcGFjZSBzbyB1c2VycyBjYW4gZmluZCB0aGlzIHNwYWNlIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRocm91Z2ggeW91ciBob21lc2VydmVyICglKGxvY2FsRG9tYWluKXMpXCIsIHsgbG9jYWxEb21haW4gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogX3QoXCJTZXQgYWRkcmVzc2VzIGZvciB0aGlzIHJvb20gc28gdXNlcnMgY2FuIGZpbmQgdGhpcyByb29tIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGhyb3VnaCB5b3VyIGhvbWVzZXJ2ZXIgKCUobG9jYWxEb21haW4pcylcIiwgeyBsb2NhbERvbWFpbiB9KSB9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICAgIDxkZXRhaWxzIG9uVG9nZ2xlPXt0aGlzLm9uTG9jYWxBbGlhc2VzVG9nZ2xlZH0gb3Blbj17dGhpcy5zdGF0ZS5kZXRhaWxzT3Blbn0+XG4gICAgICAgICAgICAgICAgICAgIDxzdW1tYXJ5PnsgdGhpcy5zdGF0ZS5kZXRhaWxzT3BlbiA/IF90KCdTaG93IGxlc3MnKSA6IF90KFwiU2hvdyBtb3JlXCIpIH08L3N1bW1hcnk+XG4gICAgICAgICAgICAgICAgICAgIHsgbG9jYWxBbGlhc2VzTGlzdCB9XG4gICAgICAgICAgICAgICAgPC9kZXRhaWxzPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19