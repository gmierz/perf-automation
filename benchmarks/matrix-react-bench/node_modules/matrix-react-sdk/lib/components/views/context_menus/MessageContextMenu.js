"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.canCancel = canCancel;
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _event = require("matrix-js-sdk/src/models/event");

var _event2 = require("matrix-js-sdk/src/@types/event");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _languageHandler = require("../../../languageHandler");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _Resend = _interopRequireDefault(require("../../../Resend"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _HtmlUtils = require("../../../HtmlUtils");

var _EventUtils = require("../../../utils/EventUtils");

var _IconizedContextMenu = _interopRequireWildcard(require("./IconizedContextMenu"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _PinnedMessagesCard = require("../right_panel/PinnedMessagesCard");

var _ForwardDialog = _interopRequireDefault(require("../dialogs/ForwardDialog"));

var _actions = require("../../../dispatcher/actions");

var _ReportEventDialog = _interopRequireDefault(require("../dialogs/ReportEventDialog"));

var _ViewSource = _interopRequireDefault(require("../../structures/ViewSource"));

var _ConfirmRedactDialog = require("../dialogs/ConfirmRedactDialog");

var _ShareDialog = _interopRequireDefault(require("../dialogs/ShareDialog"));

var _RoomContext = _interopRequireWildcard(require("../../../contexts/RoomContext"));

var _WidgetLayoutStore = require("../../../stores/widgets/WidgetLayoutStore");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function canCancel(eventStatus) {
  return eventStatus === _event.EventStatus.QUEUED || eventStatus === _event.EventStatus.NOT_SENT;
}

let MessageContextMenu = (_dec = (0, _replaceableComponent.replaceableComponent)("views.context_menus.MessageContextMenu"), _dec(_class = (_temp = _class2 = class MessageContextMenu extends _react.default.Component {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "context", void 0);
    (0, _defineProperty2.default)(this, "state", {
      canRedact: false,
      canPin: false
    });
    (0, _defineProperty2.default)(this, "checkPermissions", () => {
      const cli = _MatrixClientPeg.MatrixClientPeg.get();

      const room = cli.getRoom(this.props.mxEvent.getRoomId()); // We explicitly decline to show the redact option on ACL events as it has a potential
      // to obliterate the room - https://github.com/matrix-org/synapse/issues/4042
      // Similarly for encryption events, since redacting them "breaks everything"

      const canRedact = room.currentState.maySendRedactionForEvent(this.props.mxEvent, cli.credentials.userId) && this.props.mxEvent.getType() !== _event2.EventType.RoomServerAcl && this.props.mxEvent.getType() !== _event2.EventType.RoomEncryption;

      let canPin = room.currentState.mayClientSendStateEvent(_event2.EventType.RoomPinnedEvents, cli); // HACK: Intentionally say we can't pin if the user doesn't want to use the functionality

      if (!_SettingsStore.default.getValue("feature_pinning")) canPin = false;
      this.setState({
        canRedact,
        canPin
      });
    });
    (0, _defineProperty2.default)(this, "onResendReactionsClick", () => {
      for (const reaction of this.getUnsentReactions()) {
        _Resend.default.resend(reaction);
      }

      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "onReportEventClick", () => {
      _Modal.default.createTrackedDialog('Report Event', '', _ReportEventDialog.default, {
        mxEvent: this.props.mxEvent
      }, 'mx_Dialog_reportEvent');

      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "onViewSourceClick", () => {
      _Modal.default.createTrackedDialog('View Event Source', '', _ViewSource.default, {
        mxEvent: this.props.mxEvent
      }, 'mx_Dialog_viewsource');

      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "onRedactClick", () => {
      const {
        mxEvent,
        onCloseDialog
      } = this.props;
      (0, _ConfirmRedactDialog.createRedactEventDialog)({
        mxEvent,
        onCloseDialog
      });
      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "onForwardClick", () => {
      _Modal.default.createTrackedDialog('Forward Message', '', _ForwardDialog.default, {
        matrixClient: _MatrixClientPeg.MatrixClientPeg.get(),
        event: this.props.mxEvent,
        permalinkCreator: this.props.permalinkCreator
      });

      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "onPinClick", () => {
      var _room$currentState, _room$currentState$ge;

      const cli = _MatrixClientPeg.MatrixClientPeg.get();

      const room = cli.getRoom(this.props.mxEvent.getRoomId());
      const eventId = this.props.mxEvent.getId();
      const pinnedIds = (room === null || room === void 0 ? void 0 : (_room$currentState = room.currentState) === null || _room$currentState === void 0 ? void 0 : (_room$currentState$ge = _room$currentState.getStateEvents(_event2.EventType.RoomPinnedEvents, "")) === null || _room$currentState$ge === void 0 ? void 0 : _room$currentState$ge.getContent().pinned) || [];

      if (pinnedIds.includes(eventId)) {
        pinnedIds.splice(pinnedIds.indexOf(eventId), 1);
      } else {
        var _room$getAccountData, _room$getAccountData$;

        pinnedIds.push(eventId);
        cli.setRoomAccountData(room.roomId, _PinnedMessagesCard.ReadPinsEventId, {
          event_ids: [...(((_room$getAccountData = room.getAccountData(_PinnedMessagesCard.ReadPinsEventId)) === null || _room$getAccountData === void 0 ? void 0 : (_room$getAccountData$ = _room$getAccountData.getContent()) === null || _room$getAccountData$ === void 0 ? void 0 : _room$getAccountData$.event_ids) || []), eventId]
        });
      }

      cli.sendStateEvent(this.props.mxEvent.getRoomId(), _event2.EventType.RoomPinnedEvents, {
        pinned: pinnedIds
      }, "");
      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "closeMenu", () => {
      this.props.onFinished();
    });
    (0, _defineProperty2.default)(this, "onUnhidePreviewClick", () => {
      var _this$props$eventTile;

      (_this$props$eventTile = this.props.eventTileOps) === null || _this$props$eventTile === void 0 ? void 0 : _this$props$eventTile.unhideWidget();
      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "onQuoteClick", () => {
      _dispatcher.default.dispatch({
        action: _actions.Action.ComposerInsert,
        event: this.props.mxEvent,
        timelineRenderingType: this.context.timelineRenderingType
      });

      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "onPermalinkClick", e => {
      e.preventDefault();

      _Modal.default.createTrackedDialog('share room message dialog', '', _ShareDialog.default, {
        target: this.props.mxEvent,
        permalinkCreator: this.props.permalinkCreator
      });

      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "onCollapseReplyChainClick", () => {
      this.props.collapseReplyChain();
      this.closeMenu();
    });
    (0, _defineProperty2.default)(this, "viewInRoom", () => {
      _dispatcher.default.dispatch({
        action: _actions.Action.ViewRoom,
        event_id: this.props.mxEvent.getId(),
        highlighted: true,
        room_id: this.props.mxEvent.getRoomId()
      });

      this.closeMenu();
    });
  }

  componentDidMount() {
    _MatrixClientPeg.MatrixClientPeg.get().on('RoomMember.powerLevel', this.checkPermissions);

    this.checkPermissions();
  }

  componentWillUnmount() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    if (cli) {
      cli.removeListener('RoomMember.powerLevel', this.checkPermissions);
    }
  }

  isPinned() {
    const room = _MatrixClientPeg.MatrixClientPeg.get().getRoom(this.props.mxEvent.getRoomId());

    const pinnedEvent = room.currentState.getStateEvents(_event2.EventType.RoomPinnedEvents, '');
    if (!pinnedEvent) return false;
    const content = pinnedEvent.getContent();
    return content.pinned && Array.isArray(content.pinned) && content.pinned.includes(this.props.mxEvent.getId());
  }

  getReactions(filter) {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const room = cli.getRoom(this.props.mxEvent.getRoomId());
    const eventId = this.props.mxEvent.getId();
    return room.getPendingEvents().filter(e => {
      const relation = e.getRelation();
      return (relation === null || relation === void 0 ? void 0 : relation.rel_type) === _event2.RelationType.Annotation && relation.event_id === eventId && filter(e);
    });
  }

  getPendingReactions() {
    return this.getReactions(e => canCancel(e.status));
  }

  getUnsentReactions() {
    return this.getReactions(e => e.status === _event.EventStatus.NOT_SENT);
  }

  render() {
    var _this$props$mxEvent, _this$props$mxEvent$g;

    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const me = cli.getUserId();
    const mxEvent = this.props.mxEvent;
    const eventStatus = mxEvent.status;
    const unsentReactionsCount = this.getUnsentReactions().length;
    let resendReactionsButton;
    let redactButton;
    let forwardButton;
    let pinButton;
    let unhidePreviewButton;
    let externalURLButton;
    let quoteButton;
    let collapseReplyChain;
    let redactItemList; // status is SENT before remote-echo, null after

    const isSent = !eventStatus || eventStatus === _event.EventStatus.SENT;

    if (!mxEvent.isRedacted()) {
      if (unsentReactionsCount !== 0) {
        resendReactionsButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
          iconClassName: "mx_MessageContextMenu_iconResend",
          label: (0, _languageHandler._t)('Resend %(unsentCount)s reaction(s)', {
            unsentCount: unsentReactionsCount
          }),
          onClick: this.onResendReactionsClick
        });
      }
    }

    if (isSent && this.state.canRedact) {
      redactButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
        iconClassName: "mx_MessageContextMenu_iconRedact",
        label: (0, _languageHandler._t)("Remove"),
        onClick: this.onRedactClick
      });
    }

    if ((0, _EventUtils.isContentActionable)(mxEvent)) {
      forwardButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
        iconClassName: "mx_MessageContextMenu_iconForward",
        label: (0, _languageHandler._t)("Forward"),
        onClick: this.onForwardClick
      });

      if (this.state.canPin) {
        pinButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
          iconClassName: "mx_MessageContextMenu_iconPin",
          label: this.isPinned() ? (0, _languageHandler._t)('Unpin') : (0, _languageHandler._t)('Pin'),
          onClick: this.onPinClick
        });
      }
    }

    const viewSourceButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
      iconClassName: "mx_MessageContextMenu_iconSource",
      label: (0, _languageHandler._t)("View source"),
      onClick: this.onViewSourceClick
    });

    if (this.props.eventTileOps) {
      if (this.props.eventTileOps.isWidgetHidden()) {
        unhidePreviewButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
          iconClassName: "mx_MessageContextMenu_iconUnhidePreview",
          label: (0, _languageHandler._t)("Show preview"),
          onClick: this.onUnhidePreviewClick
        });
      }
    }

    let permalink;

    if (this.props.permalinkCreator) {
      permalink = this.props.permalinkCreator.forEvent(this.props.mxEvent.getId());
    }

    const permalinkButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
      iconClassName: "mx_MessageContextMenu_iconPermalink",
      onClick: this.onPermalinkClick,
      label: (0, _languageHandler._t)('Share'),
      element: "a",
      href: permalink,
      target: "_blank",
      rel: "noreferrer noopener"
    });

    if (this.props.eventTileOps) {
      // this event is rendered using TextualBody
      quoteButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
        iconClassName: "mx_MessageContextMenu_iconQuote",
        label: (0, _languageHandler._t)("Quote"),
        onClick: this.onQuoteClick
      });
    } // Bridges can provide a 'external_url' to link back to the source.


    if (typeof mxEvent.getContent().external_url === "string" && (0, _HtmlUtils.isUrlPermitted)(mxEvent.getContent().external_url)) {
      externalURLButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
        iconClassName: "mx_MessageContextMenu_iconLink",
        onClick: this.closeMenu,
        label: (0, _languageHandler._t)('Source URL'),
        element: "a",
        target: "_blank",
        rel: "noreferrer noopener",
        href: mxEvent.getContent().external_url
      });
    }

    if (this.props.collapseReplyChain) {
      collapseReplyChain = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
        iconClassName: "mx_MessageContextMenu_iconCollapse",
        label: (0, _languageHandler._t)("Collapse reply thread"),
        onClick: this.onCollapseReplyChainClick
      });
    }

    let reportEventButton;

    if (mxEvent.getSender() !== me) {
      reportEventButton = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
        iconClassName: "mx_MessageContextMenu_iconReport",
        label: (0, _languageHandler._t)("Report"),
        onClick: this.onReportEventClick
      });
    }

    const {
      timelineRenderingType
    } = this.context;
    const isThread = timelineRenderingType === _RoomContext.TimelineRenderingType.Thread || timelineRenderingType === _RoomContext.TimelineRenderingType.ThreadsList;
    const isThreadRootEvent = isThread && ((_this$props$mxEvent = this.props.mxEvent) === null || _this$props$mxEvent === void 0 ? void 0 : (_this$props$mxEvent$g = _this$props$mxEvent.getThread()) === null || _this$props$mxEvent$g === void 0 ? void 0 : _this$props$mxEvent$g.rootEvent) === this.props.mxEvent;
    const isMainSplitTimelineShown = !_WidgetLayoutStore.WidgetLayoutStore.instance.hasMaximisedWidget(_MatrixClientPeg.MatrixClientPeg.get().getRoom(mxEvent.getRoomId()));

    const commonItemsList = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOptionList, null, isThreadRootEvent && isMainSplitTimelineShown && /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOption, {
      iconClassName: "mx_MessageContextMenu_iconViewInRoom",
      label: (0, _languageHandler._t)("View in room"),
      onClick: this.viewInRoom
    }), quoteButton, forwardButton, pinButton, permalinkButton, reportEventButton, externalURLButton, unhidePreviewButton, viewSourceButton, resendReactionsButton, collapseReplyChain);

    if (redactButton) {
      redactItemList = /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.IconizedContextMenuOptionList, {
        red: true
      }, redactButton);
    }

    return /*#__PURE__*/_react.default.createElement(_IconizedContextMenu.default, (0, _extends2.default)({}, this.props, {
      className: "mx_MessageContextMenu",
      compact: true
    }), commonItemsList, redactItemList);
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _RoomContext.default), _temp)) || _class);
exports.default = MessageContextMenu;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2NvbnRleHRfbWVudXMvTWVzc2FnZUNvbnRleHRNZW51LnRzeCJdLCJuYW1lcyI6WyJjYW5DYW5jZWwiLCJldmVudFN0YXR1cyIsIkV2ZW50U3RhdHVzIiwiUVVFVUVEIiwiTk9UX1NFTlQiLCJNZXNzYWdlQ29udGV4dE1lbnUiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNhblJlZGFjdCIsImNhblBpbiIsImNsaSIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsInJvb20iLCJnZXRSb29tIiwicHJvcHMiLCJteEV2ZW50IiwiZ2V0Um9vbUlkIiwiY3VycmVudFN0YXRlIiwibWF5U2VuZFJlZGFjdGlvbkZvckV2ZW50IiwiY3JlZGVudGlhbHMiLCJ1c2VySWQiLCJnZXRUeXBlIiwiRXZlbnRUeXBlIiwiUm9vbVNlcnZlckFjbCIsIlJvb21FbmNyeXB0aW9uIiwibWF5Q2xpZW50U2VuZFN0YXRlRXZlbnQiLCJSb29tUGlubmVkRXZlbnRzIiwiU2V0dGluZ3NTdG9yZSIsImdldFZhbHVlIiwic2V0U3RhdGUiLCJyZWFjdGlvbiIsImdldFVuc2VudFJlYWN0aW9ucyIsIlJlc2VuZCIsInJlc2VuZCIsImNsb3NlTWVudSIsIk1vZGFsIiwiY3JlYXRlVHJhY2tlZERpYWxvZyIsIlJlcG9ydEV2ZW50RGlhbG9nIiwiVmlld1NvdXJjZSIsIm9uQ2xvc2VEaWFsb2ciLCJGb3J3YXJkRGlhbG9nIiwibWF0cml4Q2xpZW50IiwiZXZlbnQiLCJwZXJtYWxpbmtDcmVhdG9yIiwiZXZlbnRJZCIsImdldElkIiwicGlubmVkSWRzIiwiZ2V0U3RhdGVFdmVudHMiLCJnZXRDb250ZW50IiwicGlubmVkIiwiaW5jbHVkZXMiLCJzcGxpY2UiLCJpbmRleE9mIiwicHVzaCIsInNldFJvb21BY2NvdW50RGF0YSIsInJvb21JZCIsIlJlYWRQaW5zRXZlbnRJZCIsImV2ZW50X2lkcyIsImdldEFjY291bnREYXRhIiwic2VuZFN0YXRlRXZlbnQiLCJvbkZpbmlzaGVkIiwiZXZlbnRUaWxlT3BzIiwidW5oaWRlV2lkZ2V0IiwiZGlzIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJBY3Rpb24iLCJDb21wb3Nlckluc2VydCIsInRpbWVsaW5lUmVuZGVyaW5nVHlwZSIsImNvbnRleHQiLCJlIiwicHJldmVudERlZmF1bHQiLCJTaGFyZURpYWxvZyIsInRhcmdldCIsImNvbGxhcHNlUmVwbHlDaGFpbiIsIlZpZXdSb29tIiwiZXZlbnRfaWQiLCJoaWdobGlnaHRlZCIsInJvb21faWQiLCJjb21wb25lbnREaWRNb3VudCIsIm9uIiwiY2hlY2tQZXJtaXNzaW9ucyIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlTGlzdGVuZXIiLCJpc1Bpbm5lZCIsInBpbm5lZEV2ZW50IiwiY29udGVudCIsIkFycmF5IiwiaXNBcnJheSIsImdldFJlYWN0aW9ucyIsImZpbHRlciIsImdldFBlbmRpbmdFdmVudHMiLCJyZWxhdGlvbiIsImdldFJlbGF0aW9uIiwicmVsX3R5cGUiLCJSZWxhdGlvblR5cGUiLCJBbm5vdGF0aW9uIiwiZ2V0UGVuZGluZ1JlYWN0aW9ucyIsInN0YXR1cyIsInJlbmRlciIsIm1lIiwiZ2V0VXNlcklkIiwidW5zZW50UmVhY3Rpb25zQ291bnQiLCJsZW5ndGgiLCJyZXNlbmRSZWFjdGlvbnNCdXR0b24iLCJyZWRhY3RCdXR0b24iLCJmb3J3YXJkQnV0dG9uIiwicGluQnV0dG9uIiwidW5oaWRlUHJldmlld0J1dHRvbiIsImV4dGVybmFsVVJMQnV0dG9uIiwicXVvdGVCdXR0b24iLCJyZWRhY3RJdGVtTGlzdCIsImlzU2VudCIsIlNFTlQiLCJpc1JlZGFjdGVkIiwidW5zZW50Q291bnQiLCJvblJlc2VuZFJlYWN0aW9uc0NsaWNrIiwic3RhdGUiLCJvblJlZGFjdENsaWNrIiwib25Gb3J3YXJkQ2xpY2siLCJvblBpbkNsaWNrIiwidmlld1NvdXJjZUJ1dHRvbiIsIm9uVmlld1NvdXJjZUNsaWNrIiwiaXNXaWRnZXRIaWRkZW4iLCJvblVuaGlkZVByZXZpZXdDbGljayIsInBlcm1hbGluayIsImZvckV2ZW50IiwicGVybWFsaW5rQnV0dG9uIiwib25QZXJtYWxpbmtDbGljayIsImhyZWYiLCJyZWwiLCJvblF1b3RlQ2xpY2siLCJleHRlcm5hbF91cmwiLCJvbkNvbGxhcHNlUmVwbHlDaGFpbkNsaWNrIiwicmVwb3J0RXZlbnRCdXR0b24iLCJnZXRTZW5kZXIiLCJvblJlcG9ydEV2ZW50Q2xpY2siLCJpc1RocmVhZCIsIlRpbWVsaW5lUmVuZGVyaW5nVHlwZSIsIlRocmVhZCIsIlRocmVhZHNMaXN0IiwiaXNUaHJlYWRSb290RXZlbnQiLCJnZXRUaHJlYWQiLCJyb290RXZlbnQiLCJpc01haW5TcGxpdFRpbWVsaW5lU2hvd24iLCJXaWRnZXRMYXlvdXRTdG9yZSIsImluc3RhbmNlIiwiaGFzTWF4aW1pc2VkV2lkZ2V0IiwiY29tbW9uSXRlbXNMaXN0Iiwidmlld0luUm9vbSIsIlJvb21Db250ZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQWlCQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFFQTs7Ozs7Ozs7QUFFTyxTQUFTQSxTQUFULENBQW1CQyxXQUFuQixFQUFzRDtBQUN6RCxTQUFPQSxXQUFXLEtBQUtDLG1CQUFZQyxNQUE1QixJQUFzQ0YsV0FBVyxLQUFLQyxtQkFBWUUsUUFBekU7QUFDSDs7SUFnQ29CQyxrQixXQURwQixnREFBcUIsd0NBQXJCLEMsbUNBQUQsTUFDcUJBLGtCQURyQixTQUNnREMsZUFBTUMsU0FEdEQsQ0FDZ0Y7QUFBQTtBQUFBO0FBQUE7QUFBQSxpREFJcEU7QUFDSkMsTUFBQUEsU0FBUyxFQUFFLEtBRFA7QUFFSkMsTUFBQUEsTUFBTSxFQUFFO0FBRkosS0FKb0U7QUFBQSw0REFxQmpELE1BQVk7QUFDbkMsWUFBTUMs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QkFDSSw2QkFBQyw0QkFBRCw2QkFDUSxLQUFLM0YsS0FEYjtBQUVJLE1BQUEsU0FBUyxFQUFDLHVCQUZkO0FBR0ksTUFBQSxPQUFPLEVBQUU7QUFIYixRQUtNc0ksZUFMTixFQU1NckMsY0FOTixDQURKO0FBVUg7O0FBalgyRSxDLHdEQUN2RHVDLG9CIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE1pY2hhZWwgVGVsYXR5bnNraSA8N3QzY2hndXlAZ21haWwuY29tPlxuQ29weXJpZ2h0IDIwMTUgLSAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEV2ZW50U3RhdHVzLCBNYXRyaXhFdmVudCB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudCc7XG5pbXBvcnQgeyBFdmVudFR5cGUsIFJlbGF0aW9uVHlwZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvZXZlbnRcIjtcblxuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSAnLi4vLi4vLi4vTWF0cml4Q2xpZW50UGVnJztcbmltcG9ydCBkaXMgZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyJztcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBNb2RhbCBmcm9tICcuLi8uLi8uLi9Nb2RhbCc7XG5pbXBvcnQgUmVzZW5kIGZyb20gJy4uLy4uLy4uL1Jlc2VuZCc7XG5pbXBvcnQgU2V0dGluZ3NTdG9yZSBmcm9tICcuLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlJztcbmltcG9ydCB7IGlzVXJsUGVybWl0dGVkIH0gZnJvbSAnLi4vLi4vLi4vSHRtbFV0aWxzJztcbmltcG9ydCB7IGlzQ29udGVudEFjdGlvbmFibGUgfSBmcm9tICcuLi8uLi8uLi91dGlscy9FdmVudFV0aWxzJztcbmltcG9ydCBJY29uaXplZENvbnRleHRNZW51LCB7IEljb25pemVkQ29udGV4dE1lbnVPcHRpb24sIEljb25pemVkQ29udGV4dE1lbnVPcHRpb25MaXN0IH0gZnJvbSAnLi9JY29uaXplZENvbnRleHRNZW51JztcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBSZWFkUGluc0V2ZW50SWQgfSBmcm9tIFwiLi4vcmlnaHRfcGFuZWwvUGlubmVkTWVzc2FnZXNDYXJkXCI7XG5pbXBvcnQgRm9yd2FyZERpYWxvZyBmcm9tIFwiLi4vZGlhbG9ncy9Gb3J3YXJkRGlhbG9nXCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zXCI7XG5pbXBvcnQgUmVwb3J0RXZlbnREaWFsb2cgZnJvbSAnLi4vZGlhbG9ncy9SZXBvcnRFdmVudERpYWxvZyc7XG5pbXBvcnQgVmlld1NvdXJjZSBmcm9tICcuLi8uLi9zdHJ1Y3R1cmVzL1ZpZXdTb3VyY2UnO1xuaW1wb3J0IHsgY3JlYXRlUmVkYWN0RXZlbnREaWFsb2cgfSBmcm9tICcuLi9kaWFsb2dzL0NvbmZpcm1SZWRhY3REaWFsb2cnO1xuaW1wb3J0IFNoYXJlRGlhbG9nIGZyb20gJy4uL2RpYWxvZ3MvU2hhcmVEaWFsb2cnO1xuaW1wb3J0IHsgUm9vbVBlcm1hbGlua0NyZWF0b3IgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvcGVybWFsaW5rcy9QZXJtYWxpbmtzXCI7XG5pbXBvcnQgeyBJUG9zaXRpb24sIENoZXZyb25GYWNlIH0gZnJvbSAnLi4vLi4vc3RydWN0dXJlcy9Db250ZXh0TWVudSc7XG5pbXBvcnQgUm9vbUNvbnRleHQsIHsgVGltZWxpbmVSZW5kZXJpbmdUeXBlIH0gZnJvbSAnLi4vLi4vLi4vY29udGV4dHMvUm9vbUNvbnRleHQnO1xuaW1wb3J0IHsgQ29tcG9zZXJJbnNlcnRQYXlsb2FkIH0gZnJvbSBcIi4uLy4uLy4uL2Rpc3BhdGNoZXIvcGF5bG9hZHMvQ29tcG9zZXJJbnNlcnRQYXlsb2FkXCI7XG5pbXBvcnQgeyBXaWRnZXRMYXlvdXRTdG9yZSB9IGZyb20gJy4uLy4uLy4uL3N0b3Jlcy93aWRnZXRzL1dpZGdldExheW91dFN0b3JlJztcblxuZXhwb3J0IGZ1bmN0aW9uIGNhbkNhbmNlbChldmVudFN0YXR1czogRXZlbnRTdGF0dXMpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZXZlbnRTdGF0dXMgPT09IEV2ZW50U3RhdHVzLlFVRVVFRCB8fCBldmVudFN0YXR1cyA9PT0gRXZlbnRTdGF0dXMuTk9UX1NFTlQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUV2ZW50VGlsZU9wcyB7XG4gICAgaXNXaWRnZXRIaWRkZW4oKTogYm9vbGVhbjtcbiAgICB1bmhpZGVXaWRnZXQoKTogdm9pZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJT3BlcmFibGVFdmVudFRpbGUge1xuICAgIGdldEV2ZW50VGlsZU9wcygpOiBJRXZlbnRUaWxlT3BzO1xufVxuXG5pbnRlcmZhY2UgSVByb3BzIGV4dGVuZHMgSVBvc2l0aW9uIHtcbiAgICBjaGV2cm9uRmFjZTogQ2hldnJvbkZhY2U7XG4gICAgLyogdGhlIE1hdHJpeEV2ZW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgY29udGV4dCBtZW51ICovXG4gICAgbXhFdmVudDogTWF0cml4RXZlbnQ7XG4gICAgLyogYW4gb3B0aW9uYWwgRXZlbnRUaWxlT3BzIGltcGxlbWVudGF0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gdW5oaWRlIHByZXZpZXcgd2lkZ2V0cyAqL1xuICAgIGV2ZW50VGlsZU9wcz86IElFdmVudFRpbGVPcHM7XG4gICAgcGVybWFsaW5rQ3JlYXRvcj86IFJvb21QZXJtYWxpbmtDcmVhdG9yO1xuICAgIC8qIGFuIG9wdGlvbmFsIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyBjb2xsYXBzZSB0aHJlYWQsIGlmIG5vdCBwcm92aWRlZCBoaWRlIGJ1dHRvbiAqL1xuICAgIGNvbGxhcHNlUmVwbHlDaGFpbj8oKTogdm9pZDtcbiAgICAvKiBjYWxsYmFjayBjYWxsZWQgd2hlbiB0aGUgbWVudSBpcyBkaXNtaXNzZWQgKi9cbiAgICBvbkZpbmlzaGVkKCk6IHZvaWQ7XG4gICAgLyogaWYgdGhlIG1lbnUgaXMgaW5zaWRlIGEgZGlhbG9nLCB3ZSBzb21ldGltZXMgbmVlZCB0byBjbG9zZSB0aGF0IGRpYWxvZyBhZnRlciBjbGljayAoZm9yd2FyZGluZykgKi9cbiAgICBvbkNsb3NlRGlhbG9nPygpOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBjYW5SZWRhY3Q6IGJvb2xlYW47XG4gICAgY2FuUGluOiBib29sZWFuO1xufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJ2aWV3cy5jb250ZXh0X21lbnVzLk1lc3NhZ2VDb250ZXh0TWVudVwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVzc2FnZUNvbnRleHRNZW51IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgc3RhdGljIGNvbnRleHRUeXBlID0gUm9vbUNvbnRleHQ7XG4gICAgcHVibGljIGNvbnRleHQhOiBSZWFjdC5Db250ZXh0VHlwZTx0eXBlb2YgUm9vbUNvbnRleHQ+O1xuXG4gICAgc3RhdGUgPSB7XG4gICAgICAgIGNhblJlZGFjdDogZmFsc2UsXG4gICAgICAgIGNhblBpbjogZmFsc2UsXG4gICAgfTtcblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkub24oJ1Jvb21NZW1iZXIucG93ZXJMZXZlbCcsIHRoaXMuY2hlY2tQZXJtaXNzaW9ucyk7XG4gICAgICAgIHRoaXMuY2hlY2tQZXJtaXNzaW9ucygpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCBjbGkgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGlmIChjbGkpIHtcbiAgICAgICAgICAgIGNsaS5yZW1vdmVMaXN0ZW5lcignUm9vbU1lbWJlci5wb3dlckxldmVsJywgdGhpcy5jaGVja1Blcm1pc3Npb25zKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tQZXJtaXNzaW9ucyA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCByb29tID0gY2xpLmdldFJvb20odGhpcy5wcm9wcy5teEV2ZW50LmdldFJvb21JZCgpKTtcblxuICAgICAgICAvLyBXZSBleHBsaWNpdGx5IGRlY2xpbmUgdG8gc2hvdyB0aGUgcmVkYWN0IG9wdGlvbiBvbiBBQ0wgZXZlbnRzIGFzIGl0IGhhcyBhIHBvdGVudGlhbFxuICAgICAgICAvLyB0byBvYmxpdGVyYXRlIHRoZSByb29tIC0gaHR0cHM6Ly9naXRodWIuY29tL21hdHJpeC1vcmcvc3luYXBzZS9pc3N1ZXMvNDA0MlxuICAgICAgICAvLyBTaW1pbGFybHkgZm9yIGVuY3J5cHRpb24gZXZlbnRzLCBzaW5jZSByZWRhY3RpbmcgdGhlbSBcImJyZWFrcyBldmVyeXRoaW5nXCJcbiAgICAgICAgY29uc3QgY2FuUmVkYWN0ID0gcm9vbS5jdXJyZW50U3RhdGUubWF5U2VuZFJlZGFjdGlvbkZvckV2ZW50KHRoaXMucHJvcHMubXhFdmVudCwgY2xpLmNyZWRlbnRpYWxzLnVzZXJJZClcbiAgICAgICAgICAgICYmIHRoaXMucHJvcHMubXhFdmVudC5nZXRUeXBlKCkgIT09IEV2ZW50VHlwZS5Sb29tU2VydmVyQWNsXG4gICAgICAgICAgICAmJiB0aGlzLnByb3BzLm14RXZlbnQuZ2V0VHlwZSgpICE9PSBFdmVudFR5cGUuUm9vbUVuY3J5cHRpb247XG4gICAgICAgIGxldCBjYW5QaW4gPSByb29tLmN1cnJlbnRTdGF0ZS5tYXlDbGllbnRTZW5kU3RhdGVFdmVudChFdmVudFR5cGUuUm9vbVBpbm5lZEV2ZW50cywgY2xpKTtcblxuICAgICAgICAvLyBIQUNLOiBJbnRlbnRpb25hbGx5IHNheSB3ZSBjYW4ndCBwaW4gaWYgdGhlIHVzZXIgZG9lc24ndCB3YW50IHRvIHVzZSB0aGUgZnVuY3Rpb25hbGl0eVxuICAgICAgICBpZiAoIVNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJmZWF0dXJlX3Bpbm5pbmdcIikpIGNhblBpbiA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjYW5SZWRhY3QsIGNhblBpbiB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBpc1Bpbm5lZCgpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3Qgcm9vbSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRSb29tKHRoaXMucHJvcHMubXhFdmVudC5nZXRSb29tSWQoKSk7XG4gICAgICAgIGNvbnN0IHBpbm5lZEV2ZW50ID0gcm9vbS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoRXZlbnRUeXBlLlJvb21QaW5uZWRFdmVudHMsICcnKTtcbiAgICAgICAgaWYgKCFwaW5uZWRFdmVudCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBjb25zdCBjb250ZW50ID0gcGlubmVkRXZlbnQuZ2V0Q29udGVudCgpO1xuICAgICAgICByZXR1cm4gY29udGVudC5waW5uZWQgJiYgQXJyYXkuaXNBcnJheShjb250ZW50LnBpbm5lZCkgJiYgY29udGVudC5waW5uZWQuaW5jbHVkZXModGhpcy5wcm9wcy5teEV2ZW50LmdldElkKCkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25SZXNlbmRSZWFjdGlvbnNDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgZm9yIChjb25zdCByZWFjdGlvbiBvZiB0aGlzLmdldFVuc2VudFJlYWN0aW9ucygpKSB7XG4gICAgICAgICAgICBSZXNlbmQucmVzZW5kKHJlYWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsb3NlTWVudSgpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUmVwb3J0RXZlbnRDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnUmVwb3J0IEV2ZW50JywgJycsIFJlcG9ydEV2ZW50RGlhbG9nLCB7XG4gICAgICAgICAgICBteEV2ZW50OiB0aGlzLnByb3BzLm14RXZlbnQsXG4gICAgICAgIH0sICdteF9EaWFsb2dfcmVwb3J0RXZlbnQnKTtcbiAgICAgICAgdGhpcy5jbG9zZU1lbnUoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblZpZXdTb3VyY2VDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnVmlldyBFdmVudCBTb3VyY2UnLCAnJywgVmlld1NvdXJjZSwge1xuICAgICAgICAgICAgbXhFdmVudDogdGhpcy5wcm9wcy5teEV2ZW50LFxuICAgICAgICB9LCAnbXhfRGlhbG9nX3ZpZXdzb3VyY2UnKTtcbiAgICAgICAgdGhpcy5jbG9zZU1lbnUoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblJlZGFjdENsaWNrID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICBjb25zdCB7IG14RXZlbnQsIG9uQ2xvc2VEaWFsb2cgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNyZWF0ZVJlZGFjdEV2ZW50RGlhbG9nKHtcbiAgICAgICAgICAgIG14RXZlbnQsXG4gICAgICAgICAgICBvbkNsb3NlRGlhbG9nLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jbG9zZU1lbnUoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkZvcndhcmRDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRm9yd2FyZCBNZXNzYWdlJywgJycsIEZvcndhcmREaWFsb2csIHtcbiAgICAgICAgICAgIG1hdHJpeENsaWVudDogTWF0cml4Q2xpZW50UGVnLmdldCgpLFxuICAgICAgICAgICAgZXZlbnQ6IHRoaXMucHJvcHMubXhFdmVudCxcbiAgICAgICAgICAgIHBlcm1hbGlua0NyZWF0b3I6IHRoaXMucHJvcHMucGVybWFsaW5rQ3JlYXRvcixcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2xvc2VNZW51KCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25QaW5DbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCByb29tID0gY2xpLmdldFJvb20odGhpcy5wcm9wcy5teEV2ZW50LmdldFJvb21JZCgpKTtcbiAgICAgICAgY29uc3QgZXZlbnRJZCA9IHRoaXMucHJvcHMubXhFdmVudC5nZXRJZCgpO1xuXG4gICAgICAgIGNvbnN0IHBpbm5lZElkcyA9IHJvb20/LmN1cnJlbnRTdGF0ZT8uZ2V0U3RhdGVFdmVudHMoRXZlbnRUeXBlLlJvb21QaW5uZWRFdmVudHMsIFwiXCIpPy5nZXRDb250ZW50KCkucGlubmVkIHx8IFtdO1xuICAgICAgICBpZiAocGlubmVkSWRzLmluY2x1ZGVzKGV2ZW50SWQpKSB7XG4gICAgICAgICAgICBwaW5uZWRJZHMuc3BsaWNlKHBpbm5lZElkcy5pbmRleE9mKGV2ZW50SWQpLCAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBpbm5lZElkcy5wdXNoKGV2ZW50SWQpO1xuICAgICAgICAgICAgY2xpLnNldFJvb21BY2NvdW50RGF0YShyb29tLnJvb21JZCwgUmVhZFBpbnNFdmVudElkLCB7XG4gICAgICAgICAgICAgICAgZXZlbnRfaWRzOiBbXG4gICAgICAgICAgICAgICAgICAgIC4uLihyb29tLmdldEFjY291bnREYXRhKFJlYWRQaW5zRXZlbnRJZCk/LmdldENvbnRlbnQoKT8uZXZlbnRfaWRzIHx8IFtdKSxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRJZCxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2xpLnNlbmRTdGF0ZUV2ZW50KHRoaXMucHJvcHMubXhFdmVudC5nZXRSb29tSWQoKSwgRXZlbnRUeXBlLlJvb21QaW5uZWRFdmVudHMsIHsgcGlubmVkOiBwaW5uZWRJZHMgfSwgXCJcIik7XG4gICAgICAgIHRoaXMuY2xvc2VNZW51KCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgY2xvc2VNZW51ID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLm9uRmluaXNoZWQoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblVuaGlkZVByZXZpZXdDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5ldmVudFRpbGVPcHM/LnVuaGlkZVdpZGdldCgpO1xuICAgICAgICB0aGlzLmNsb3NlTWVudSgpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUXVvdGVDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgZGlzLmRpc3BhdGNoPENvbXBvc2VySW5zZXJ0UGF5bG9hZD4oe1xuICAgICAgICAgICAgYWN0aW9uOiBBY3Rpb24uQ29tcG9zZXJJbnNlcnQsXG4gICAgICAgICAgICBldmVudDogdGhpcy5wcm9wcy5teEV2ZW50LFxuICAgICAgICAgICAgdGltZWxpbmVSZW5kZXJpbmdUeXBlOiB0aGlzLmNvbnRleHQudGltZWxpbmVSZW5kZXJpbmdUeXBlLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jbG9zZU1lbnUoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBlcm1hbGlua0NsaWNrID0gKGU6IFJlYWN0Lk1vdXNlRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdzaGFyZSByb29tIG1lc3NhZ2UgZGlhbG9nJywgJycsIFNoYXJlRGlhbG9nLCB7XG4gICAgICAgICAgICB0YXJnZXQ6IHRoaXMucHJvcHMubXhFdmVudCxcbiAgICAgICAgICAgIHBlcm1hbGlua0NyZWF0b3I6IHRoaXMucHJvcHMucGVybWFsaW5rQ3JlYXRvcixcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2xvc2VNZW51KCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Db2xsYXBzZVJlcGx5Q2hhaW5DbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5jb2xsYXBzZVJlcGx5Q2hhaW4oKTtcbiAgICAgICAgdGhpcy5jbG9zZU1lbnUoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBnZXRSZWFjdGlvbnMoZmlsdGVyOiAoZTogTWF0cml4RXZlbnQpID0+IGJvb2xlYW4pOiBNYXRyaXhFdmVudFtdIHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCByb29tID0gY2xpLmdldFJvb20odGhpcy5wcm9wcy5teEV2ZW50LmdldFJvb21JZCgpKTtcbiAgICAgICAgY29uc3QgZXZlbnRJZCA9IHRoaXMucHJvcHMubXhFdmVudC5nZXRJZCgpO1xuICAgICAgICByZXR1cm4gcm9vbS5nZXRQZW5kaW5nRXZlbnRzKCkuZmlsdGVyKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVsYXRpb24gPSBlLmdldFJlbGF0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm4gcmVsYXRpb24/LnJlbF90eXBlID09PSBSZWxhdGlvblR5cGUuQW5ub3RhdGlvbiAmJiByZWxhdGlvbi5ldmVudF9pZCA9PT0gZXZlbnRJZCAmJiBmaWx0ZXIoZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UGVuZGluZ1JlYWN0aW9ucygpOiBNYXRyaXhFdmVudFtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVhY3Rpb25zKGUgPT4gY2FuQ2FuY2VsKGUuc3RhdHVzKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRVbnNlbnRSZWFjdGlvbnMoKTogTWF0cml4RXZlbnRbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFJlYWN0aW9ucyhlID0+IGUuc3RhdHVzID09PSBFdmVudFN0YXR1cy5OT1RfU0VOVCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB2aWV3SW5Sb29tID0gKCkgPT4ge1xuICAgICAgICBkaXMuZGlzcGF0Y2goe1xuICAgICAgICAgICAgYWN0aW9uOiBBY3Rpb24uVmlld1Jvb20sXG4gICAgICAgICAgICBldmVudF9pZDogdGhpcy5wcm9wcy5teEV2ZW50LmdldElkKCksXG4gICAgICAgICAgICBoaWdobGlnaHRlZDogdHJ1ZSxcbiAgICAgICAgICAgIHJvb21faWQ6IHRoaXMucHJvcHMubXhFdmVudC5nZXRSb29tSWQoKSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2xvc2VNZW51KCk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgY2xpID0gTWF0cml4Q2xpZW50UGVnLmdldCgpO1xuICAgICAgICBjb25zdCBtZSA9IGNsaS5nZXRVc2VySWQoKTtcbiAgICAgICAgY29uc3QgbXhFdmVudCA9IHRoaXMucHJvcHMubXhFdmVudDtcbiAgICAgICAgY29uc3QgZXZlbnRTdGF0dXMgPSBteEV2ZW50LnN0YXR1cztcbiAgICAgICAgY29uc3QgdW5zZW50UmVhY3Rpb25zQ291bnQgPSB0aGlzLmdldFVuc2VudFJlYWN0aW9ucygpLmxlbmd0aDtcblxuICAgICAgICBsZXQgcmVzZW5kUmVhY3Rpb25zQnV0dG9uOiBKU1guRWxlbWVudDtcbiAgICAgICAgbGV0IHJlZGFjdEJ1dHRvbjogSlNYLkVsZW1lbnQ7XG4gICAgICAgIGxldCBmb3J3YXJkQnV0dG9uOiBKU1guRWxlbWVudDtcbiAgICAgICAgbGV0IHBpbkJ1dHRvbjogSlNYLkVsZW1lbnQ7XG4gICAgICAgIGxldCB1bmhpZGVQcmV2aWV3QnV0dG9uOiBKU1guRWxlbWVudDtcbiAgICAgICAgbGV0IGV4dGVybmFsVVJMQnV0dG9uOiBKU1guRWxlbWVudDtcbiAgICAgICAgbGV0IHF1b3RlQnV0dG9uOiBKU1guRWxlbWVudDtcbiAgICAgICAgbGV0IGNvbGxhcHNlUmVwbHlDaGFpbjogSlNYLkVsZW1lbnQ7XG4gICAgICAgIGxldCByZWRhY3RJdGVtTGlzdDogSlNYLkVsZW1lbnQ7XG5cbiAgICAgICAgLy8gc3RhdHVzIGlzIFNFTlQgYmVmb3JlIHJlbW90ZS1lY2hvLCBudWxsIGFmdGVyXG4gICAgICAgIGNvbnN0IGlzU2VudCA9ICFldmVudFN0YXR1cyB8fCBldmVudFN0YXR1cyA9PT0gRXZlbnRTdGF0dXMuU0VOVDtcbiAgICAgICAgaWYgKCFteEV2ZW50LmlzUmVkYWN0ZWQoKSkge1xuICAgICAgICAgICAgaWYgKHVuc2VudFJlYWN0aW9uc0NvdW50ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgcmVzZW5kUmVhY3Rpb25zQnV0dG9uID0gKFxuICAgICAgICAgICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb250ZXh0TWVudV9pY29uUmVzZW5kXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdCgnUmVzZW5kICUodW5zZW50Q291bnQpcyByZWFjdGlvbihzKScsIHsgdW5zZW50Q291bnQ6IHVuc2VudFJlYWN0aW9uc0NvdW50IH0pfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vblJlc2VuZFJlYWN0aW9uc0NsaWNrfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNTZW50ICYmIHRoaXMuc3RhdGUuY2FuUmVkYWN0KSB7XG4gICAgICAgICAgICByZWRhY3RCdXR0b24gPSAoXG4gICAgICAgICAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVPcHRpb25cbiAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb250ZXh0TWVudV9pY29uUmVkYWN0XCJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiUmVtb3ZlXCIpfVxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uUmVkYWN0Q2xpY2t9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNDb250ZW50QWN0aW9uYWJsZShteEV2ZW50KSkge1xuICAgICAgICAgICAgZm9yd2FyZEJ1dHRvbiA9IChcbiAgICAgICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbnRleHRNZW51X2ljb25Gb3J3YXJkXCJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiRm9yd2FyZFwiKX1cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkZvcndhcmRDbGlja31cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuY2FuUGluKSB7XG4gICAgICAgICAgICAgICAgcGluQnV0dG9uID0gKFxuICAgICAgICAgICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb250ZXh0TWVudV9pY29uUGluXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXt0aGlzLmlzUGlubmVkKCkgPyBfdCgnVW5waW4nKSA6IF90KCdQaW4nKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25QaW5DbGlja31cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgdmlld1NvdXJjZUJ1dHRvbiA9IChcbiAgICAgICAgICAgIDxJY29uaXplZENvbnRleHRNZW51T3B0aW9uXG4gICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb250ZXh0TWVudV9pY29uU291cmNlXCJcbiAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJWaWV3IHNvdXJjZVwiKX1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uVmlld1NvdXJjZUNsaWNrfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5ldmVudFRpbGVPcHMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLmV2ZW50VGlsZU9wcy5pc1dpZGdldEhpZGRlbigpKSB7XG4gICAgICAgICAgICAgICAgdW5oaWRlUHJldmlld0J1dHRvbiA9IChcbiAgICAgICAgICAgICAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVPcHRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU9XCJteF9NZXNzYWdlQ29udGV4dE1lbnVfaWNvblVuaGlkZVByZXZpZXdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiU2hvdyBwcmV2aWV3XCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vblVuaGlkZVByZXZpZXdDbGlja31cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHBlcm1hbGluaztcbiAgICAgICAgaWYgKHRoaXMucHJvcHMucGVybWFsaW5rQ3JlYXRvcikge1xuICAgICAgICAgICAgcGVybWFsaW5rID0gdGhpcy5wcm9wcy5wZXJtYWxpbmtDcmVhdG9yLmZvckV2ZW50KHRoaXMucHJvcHMubXhFdmVudC5nZXRJZCgpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwZXJtYWxpbmtCdXR0b24gPSAoXG4gICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgIGljb25DbGFzc05hbWU9XCJteF9NZXNzYWdlQ29udGV4dE1lbnVfaWNvblBlcm1hbGlua1wiXG4gICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vblBlcm1hbGlua0NsaWNrfVxuICAgICAgICAgICAgICAgIGxhYmVsPXtfdCgnU2hhcmUnKX1cbiAgICAgICAgICAgICAgICBlbGVtZW50PVwiYVwiXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IFR5cGVzY3JpcHQgc2lnbmF0dXJlIGZvciBBY2Nlc3NpYmxlQnV0dG9uIGRvZXNuJ3Qgd29yayBwcm9wZXJseSBmb3Igbm9uLWlucHV0cyBsaWtlIGBhYFxuICAgICAgICAgICAgICAgICAgICAuLi57XG4gICAgICAgICAgICAgICAgICAgICAgICBocmVmOiBwZXJtYWxpbmssXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IFwiX2JsYW5rXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWw6IFwibm9yZWZlcnJlciBub29wZW5lclwiLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5ldmVudFRpbGVPcHMpIHsgLy8gdGhpcyBldmVudCBpcyByZW5kZXJlZCB1c2luZyBUZXh0dWFsQm9keVxuICAgICAgICAgICAgcXVvdGVCdXR0b24gPSAoXG4gICAgICAgICAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVPcHRpb25cbiAgICAgICAgICAgICAgICAgICAgaWNvbkNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb250ZXh0TWVudV9pY29uUXVvdGVcIlxuICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJRdW90ZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vblF1b3RlQ2xpY2t9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCcmlkZ2VzIGNhbiBwcm92aWRlIGEgJ2V4dGVybmFsX3VybCcgdG8gbGluayBiYWNrIHRvIHRoZSBzb3VyY2UuXG4gICAgICAgIGlmICh0eXBlb2YgKG14RXZlbnQuZ2V0Q29udGVudCgpLmV4dGVybmFsX3VybCkgPT09IFwic3RyaW5nXCIgJiZcbiAgICAgICAgICAgIGlzVXJsUGVybWl0dGVkKG14RXZlbnQuZ2V0Q29udGVudCgpLmV4dGVybmFsX3VybClcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBleHRlcm5hbFVSTEJ1dHRvbiA9IChcbiAgICAgICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbnRleHRNZW51X2ljb25MaW5rXCJcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5jbG9zZU1lbnV9XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdCgnU291cmNlIFVSTCcpfVxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50PVwiYVwiXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogVHlwZXNjcmlwdCBzaWduYXR1cmUgZm9yIEFjY2Vzc2libGVCdXR0b24gZG9lc24ndCB3b3JrIHByb3Blcmx5IGZvciBub24taW5wdXRzIGxpa2UgYGFgXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBcIl9ibGFua1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbDogXCJub3JlZmVycmVyIG5vb3BlbmVyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJlZjogbXhFdmVudC5nZXRDb250ZW50KCkuZXh0ZXJuYWxfdXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5jb2xsYXBzZVJlcGx5Q2hhaW4pIHtcbiAgICAgICAgICAgIGNvbGxhcHNlUmVwbHlDaGFpbiA9IChcbiAgICAgICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbnRleHRNZW51X2ljb25Db2xsYXBzZVwiXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdChcIkNvbGxhcHNlIHJlcGx5IHRocmVhZFwiKX1cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkNvbGxhcHNlUmVwbHlDaGFpbkNsaWNrfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlcG9ydEV2ZW50QnV0dG9uOiBKU1guRWxlbWVudDtcbiAgICAgICAgaWYgKG14RXZlbnQuZ2V0U2VuZGVyKCkgIT09IG1lKSB7XG4gICAgICAgICAgICByZXBvcnRFdmVudEJ1dHRvbiA9IChcbiAgICAgICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbnRleHRNZW51X2ljb25SZXBvcnRcIlxuICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJSZXBvcnRcIil9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25SZXBvcnRFdmVudENsaWNrfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyB0aW1lbGluZVJlbmRlcmluZ1R5cGUgfSA9IHRoaXMuY29udGV4dDtcbiAgICAgICAgY29uc3QgaXNUaHJlYWQgPSAoXG4gICAgICAgICAgICB0aW1lbGluZVJlbmRlcmluZ1R5cGUgPT09IFRpbWVsaW5lUmVuZGVyaW5nVHlwZS5UaHJlYWQgfHxcbiAgICAgICAgICAgIHRpbWVsaW5lUmVuZGVyaW5nVHlwZSA9PT0gVGltZWxpbmVSZW5kZXJpbmdUeXBlLlRocmVhZHNMaXN0XG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGlzVGhyZWFkUm9vdEV2ZW50ID0gaXNUaHJlYWQgJiYgdGhpcy5wcm9wcy5teEV2ZW50Py5nZXRUaHJlYWQoKT8ucm9vdEV2ZW50ID09PSB0aGlzLnByb3BzLm14RXZlbnQ7XG5cbiAgICAgICAgY29uc3QgaXNNYWluU3BsaXRUaW1lbGluZVNob3duID0gIVdpZGdldExheW91dFN0b3JlLmluc3RhbmNlLmhhc01heGltaXNlZFdpZGdldChcbiAgICAgICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRSb29tKG14RXZlbnQuZ2V0Um9vbUlkKCkpLFxuICAgICAgICApO1xuICAgICAgICBjb25zdCBjb21tb25JdGVtc0xpc3QgPSAoXG4gICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvbkxpc3Q+XG4gICAgICAgICAgICAgICAgeyAoaXNUaHJlYWRSb290RXZlbnQgJiYgaXNNYWluU3BsaXRUaW1lbGluZVNob3duKSAmJiA8SWNvbml6ZWRDb250ZXh0TWVudU9wdGlvblxuICAgICAgICAgICAgICAgICAgICBpY29uQ2xhc3NOYW1lPVwibXhfTWVzc2FnZUNvbnRleHRNZW51X2ljb25WaWV3SW5Sb29tXCJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiVmlldyBpbiByb29tXCIpfVxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnZpZXdJblJvb219XG4gICAgICAgICAgICAgICAgLz4gfVxuICAgICAgICAgICAgICAgIHsgcXVvdGVCdXR0b24gfVxuICAgICAgICAgICAgICAgIHsgZm9yd2FyZEJ1dHRvbiB9XG4gICAgICAgICAgICAgICAgeyBwaW5CdXR0b24gfVxuICAgICAgICAgICAgICAgIHsgcGVybWFsaW5rQnV0dG9uIH1cbiAgICAgICAgICAgICAgICB7IHJlcG9ydEV2ZW50QnV0dG9uIH1cbiAgICAgICAgICAgICAgICB7IGV4dGVybmFsVVJMQnV0dG9uIH1cbiAgICAgICAgICAgICAgICB7IHVuaGlkZVByZXZpZXdCdXR0b24gfVxuICAgICAgICAgICAgICAgIHsgdmlld1NvdXJjZUJ1dHRvbiB9XG4gICAgICAgICAgICAgICAgeyByZXNlbmRSZWFjdGlvbnNCdXR0b24gfVxuICAgICAgICAgICAgICAgIHsgY29sbGFwc2VSZXBseUNoYWluIH1cbiAgICAgICAgICAgIDwvSWNvbml6ZWRDb250ZXh0TWVudU9wdGlvbkxpc3Q+XG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHJlZGFjdEJ1dHRvbikge1xuICAgICAgICAgICAgcmVkYWN0SXRlbUxpc3QgPSAoXG4gICAgICAgICAgICAgICAgPEljb25pemVkQ29udGV4dE1lbnVPcHRpb25MaXN0IHJlZD5cbiAgICAgICAgICAgICAgICAgICAgeyByZWRhY3RCdXR0b24gfVxuICAgICAgICAgICAgICAgIDwvSWNvbml6ZWRDb250ZXh0TWVudU9wdGlvbkxpc3Q+XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8SWNvbml6ZWRDb250ZXh0TWVudVxuICAgICAgICAgICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X01lc3NhZ2VDb250ZXh0TWVudVwiXG4gICAgICAgICAgICAgICAgY29tcGFjdD17dHJ1ZX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7IGNvbW1vbkl0ZW1zTGlzdCB9XG4gICAgICAgICAgICAgICAgeyByZWRhY3RJdGVtTGlzdCB9XG4gICAgICAgICAgICA8L0ljb25pemVkQ29udGV4dE1lbnU+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19