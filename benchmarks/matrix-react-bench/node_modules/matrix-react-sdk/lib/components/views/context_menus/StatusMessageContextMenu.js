"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Spinner = _interopRequireDefault(require("../elements/Spinner"));

var _dec, _class;

let StatusMessageContextMenu = (_dec = (0, _replaceableComponent.replaceableComponent)("views.context_menus.StatusMessageContextMenu"), _dec(_class = class StatusMessageContextMenu extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onStatusMessageCommitted", () => {
      // The `User` object has observed a status message change.
      this.setState({
        message: this.comittedStatusMessage,
        waiting: false
      });
    });
    (0, _defineProperty2.default)(this, "onClearClick", () => {
      _MatrixClientPeg.MatrixClientPeg.get()._unstable_setStatusMessage("");

      this.setState({
        waiting: true
      });
    });
    (0, _defineProperty2.default)(this, "onSubmit", e => {
      e.preventDefault();

      _MatrixClientPeg.MatrixClientPeg.get()._unstable_setStatusMessage(this.state.message);

      this.setState({
        waiting: true
      });
    });
    (0, _defineProperty2.default)(this, "onStatusChange", e => {
      // The input field's value was changed.
      this.setState({
        message: e.target.value
      });
    });
    this.state = {
      message: this.comittedStatusMessage,
      waiting: false
    };
  }

  componentDidMount() {
    const {
      user
    } = this.props;

    if (!user) {
      return;
    }

    user.on("User._unstable_statusMessage", this.onStatusMessageCommitted);
  }

  componentWillUnmount() {
    const {
      user
    } = this.props;

    if (!user) {
      return;
    }

    user.removeListener("User._unstable_statusMessage", this.onStatusMessageCommitted);
  }

  get comittedStatusMessage() {
    return this.props.user ? this.props.user.unstable_statusMessage : "";
  }

  render() {
    let actionButton;

    if (this.comittedStatusMessage) {
      if (this.state.message === this.comittedStatusMessage) {
        actionButton = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
          className: "mx_StatusMessageContextMenu_clear",
          onClick: this.onClearClick
        }, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Clear status")));
      } else {
        actionButton = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
          className: "mx_StatusMessageContextMenu_submit",
          onClick: this.onSubmit
        }, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Update status")));
      }
    } else {
      actionButton = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        className: "mx_StatusMessageContextMenu_submit",
        disabled: !this.state.message,
        onClick: this.onSubmit
      }, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Set status")));
    }

    let spinner = null;

    if (this.state.waiting) {
      spinner = /*#__PURE__*/_react.default.createElement(_Spinner.default, {
        w: 24,
        h: 24
      });
    }

    const form = /*#__PURE__*/_react.default.createElement("form", {
      className: "mx_StatusMessageContextMenu_form",
      autoComplete: "off",
      onSubmit: this.onSubmit
    }, /*#__PURE__*/_react.default.createElement("input", {
      type: "text",
      className: "mx_StatusMessageContextMenu_message",
      key: "message",
      placeholder: (0, _languageHandler._t)("Set a new status..."),
      autoFocus: true,
      maxLength: 60,
      value: this.state.message,
      onChange: this.onStatusChange
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_StatusMessageContextMenu_actionContainer"
    }, actionButton, spinner));

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_StatusMessageContextMenu"
    }, form);
  }

}) || _class);
exports.default = StatusMessageContextMenu;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2NvbnRleHRfbWVudXMvU3RhdHVzTWVzc2FnZUNvbnRleHRNZW51LnRzeCJdLCJuYW1lcyI6WyJTdGF0dXNNZXNzYWdlQ29udGV4dE1lbnUiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzZXRTdGF0ZSIsIm1lc3NhZ2UiLCJjb21pdHRlZFN0YXR1c01lc3NhZ2UiLCJ3YWl0aW5nIiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0IiwiX3Vuc3RhYmxlX3NldFN0YXR1c01lc3NhZ2UiLCJlIiwicHJldmVudERlZmF1bHQiLCJzdGF0ZSIsInRhcmdldCIsInZhbHVlIiwiY29tcG9uZW50RGlkTW91bnQiLCJ1c2VyIiwib24iLCJvblN0YXR1c01lc3NhZ2VDb21taXR0ZWQiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZUxpc3RlbmVyIiwidW5zdGFibGVfc3RhdHVzTWVzc2FnZSIsInJlbmRlciIsImFjdGlvbkJ1dHRvbiIsIm9uQ2xlYXJDbGljayIsIm9uU3VibWl0Iiwic3Bpbm5lciIsImZvcm0iLCJvblN0YXR1c0NoYW5nZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7SUFhcUJBLHdCLFdBRHBCLGdEQUFxQiw4Q0FBckIsQyxnQkFBRCxNQUNxQkEsd0JBRHJCLFNBQ3NEQyxlQUFNQyxTQUQ1RCxDQUNzRjtBQUNsRkMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0FBQ3ZCLFVBQU1BLEtBQU47QUFEdUIsb0VBZ0NRLE1BQVk7QUFDM0M7QUFDQSxXQUFLQyxRQUFMLENBQWM7QUFDVkMsUUFBQUEsT0FBTyxFQUFFLEtBQUtDLHFCQURKO0FBRVZDLFFBQUFBLE9BQU8sRUFBRTtBQUZDLE9BQWQ7QUFJSCxLQXRDMEI7QUFBQSx3REF3Q0osTUFBVztBQUM5QkMsdUNBQWdCQyxHQUFoQixHQUFz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TUFBQSxRQUFRLEVBQUUsS0FBS0Y7QUFITixvQkFLVDtBQUNJLE1BQUEsSUFBSSxFQUFDLE1BRFQ7QUFFSSxNQUFBLFNBQVMsRUFBQyxxQ0FGZDtBQUdJLE1BQUEsR0FBRyxFQUFDLFNBSFI7QUFJSSxNQUFBLFdBQVcsRUFBRSx5QkFBRyxxQkFBSCxDQUpqQjtBQUtJLE1BQUEsU0FBUyxFQUFFLElBTGY7QUFNSSxNQUFBLFNBQVMsRUFBRSxFQU5mO0FBT0ksTUFBQSxLQUFLLEVBQUUsS0FBS2IsS0FBTCxDQUFXUixPQVB0QjtBQVFJLE1BQUEsUUFBUSxFQUFFLEtBQUt3QjtBQVJuQixNQUxTLGVBZVQ7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQ01MLFlBRE4sRUFFTUcsT0FGTixDQWZTLENBQWI7O0FBcUJBLHdCQUFPO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNEQyxJQURDLENBQVA7QUFHSDs7QUF0SGlGLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTggTmV3IFZlY3RvciBMdGRcblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgQ2hhbmdlRXZlbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBfdCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tICcuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWcnO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24sIHsgQnV0dG9uRXZlbnQgfSBmcm9tICcuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uJztcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgeyBVc2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy91c2VyXCI7XG5pbXBvcnQgU3Bpbm5lciBmcm9tIFwiLi4vZWxlbWVudHMvU3Bpbm5lclwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICAvLyBqcy1zZGsgVXNlciBvYmplY3QuIE5vdCByZXF1aXJlZCBiZWNhdXNlIGl0IG1pZ2h0IG5vdCBleGlzdC5cbiAgICB1c2VyPzogVXNlcjtcbn1cblxuaW50ZXJmYWNlIElTdGF0ZSB7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHdhaXRpbmc6IGJvb2xlYW47XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInZpZXdzLmNvbnRleHRfbWVudXMuU3RhdHVzTWVzc2FnZUNvbnRleHRNZW51XCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdGF0dXNNZXNzYWdlQ29udGV4dE1lbnUgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5jb21pdHRlZFN0YXR1c01lc3NhZ2UsXG4gICAgICAgICAgICB3YWl0aW5nOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkTW91bnQoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgdXNlciB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdXNlci5vbihcIlVzZXIuX3Vuc3RhYmxlX3N0YXR1c01lc3NhZ2VcIiwgdGhpcy5vblN0YXR1c01lc3NhZ2VDb21taXR0ZWQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnRXaWxsVW5tb3VudCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyB1c2VyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB1c2VyLnJlbW92ZUxpc3RlbmVyKFxuICAgICAgICAgICAgXCJVc2VyLl91bnN0YWJsZV9zdGF0dXNNZXNzYWdlXCIsXG4gICAgICAgICAgICB0aGlzLm9uU3RhdHVzTWVzc2FnZUNvbW1pdHRlZCxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXQgY29taXR0ZWRTdGF0dXNNZXNzYWdlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLnVzZXIgPyB0aGlzLnByb3BzLnVzZXIudW5zdGFibGVfc3RhdHVzTWVzc2FnZSA6IFwiXCI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblN0YXR1c01lc3NhZ2VDb21taXR0ZWQgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIC8vIFRoZSBgVXNlcmAgb2JqZWN0IGhhcyBvYnNlcnZlZCBhIHN0YXR1cyBtZXNzYWdlIGNoYW5nZS5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBtZXNzYWdlOiB0aGlzLmNvbWl0dGVkU3RhdHVzTWVzc2FnZSxcbiAgICAgICAgICAgIHdhaXRpbmc6IGZhbHNlLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkNsZWFyQ2xpY2sgPSAoKTogdm9pZD0+IHtcbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLl91bnN0YWJsZV9zZXRTdGF0dXNNZXNzYWdlKFwiXCIpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHdhaXRpbmc6IHRydWUsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU3VibWl0ID0gKGU6IEJ1dHRvbkV2ZW50KTogdm9pZCA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLl91bnN0YWJsZV9zZXRTdGF0dXNNZXNzYWdlKHRoaXMuc3RhdGUubWVzc2FnZSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgd2FpdGluZzogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25TdGF0dXNDaGFuZ2UgPSAoZTogQ2hhbmdlRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgLy8gVGhlIGlucHV0IGZpZWxkJ3MgdmFsdWUgd2FzIGNoYW5nZWQuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgbWVzc2FnZTogKGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGxldCBhY3Rpb25CdXR0b247XG4gICAgICAgIGlmICh0aGlzLmNvbWl0dGVkU3RhdHVzTWVzc2FnZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUubWVzc2FnZSA9PT0gdGhpcy5jb21pdHRlZFN0YXR1c01lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gPSA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9XCJteF9TdGF0dXNNZXNzYWdlQ29udGV4dE1lbnVfY2xlYXJcIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uQ2xlYXJDbGlja31cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuPnsgX3QoXCJDbGVhciBzdGF0dXNcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gPSA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9XCJteF9TdGF0dXNNZXNzYWdlQ29udGV4dE1lbnVfc3VibWl0XCJcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vblN1Ym1pdH1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuPnsgX3QoXCJVcGRhdGUgc3RhdHVzXCIpIH08L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiA9IDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfU3RhdHVzTWVzc2FnZUNvbnRleHRNZW51X3N1Ym1pdFwiXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9eyF0aGlzLnN0YXRlLm1lc3NhZ2V9XG4gICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vblN1Ym1pdH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8c3Bhbj57IF90KFwiU2V0IHN0YXR1c1wiKSB9PC9zcGFuPlxuICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBzcGlubmVyID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUud2FpdGluZykge1xuICAgICAgICAgICAgc3Bpbm5lciA9IDxTcGlubmVyIHc9ezI0fSBoPXsyNH0gLz47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmb3JtID0gPGZvcm1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1N0YXR1c01lc3NhZ2VDb250ZXh0TWVudV9mb3JtXCJcbiAgICAgICAgICAgIGF1dG9Db21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICBvblN1Ym1pdD17dGhpcy5vblN1Ym1pdH1cbiAgICAgICAgPlxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1N0YXR1c01lc3NhZ2VDb250ZXh0TWVudV9tZXNzYWdlXCJcbiAgICAgICAgICAgICAgICBrZXk9XCJtZXNzYWdlXCJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj17X3QoXCJTZXQgYSBuZXcgc3RhdHVzLi4uXCIpfVxuICAgICAgICAgICAgICAgIGF1dG9Gb2N1cz17dHJ1ZX1cbiAgICAgICAgICAgICAgICBtYXhMZW5ndGg9ezYwfVxuICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLm1lc3NhZ2V9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25TdGF0dXNDaGFuZ2V9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TdGF0dXNNZXNzYWdlQ29udGV4dE1lbnVfYWN0aW9uQ29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICAgeyBhY3Rpb25CdXR0b24gfVxuICAgICAgICAgICAgICAgIHsgc3Bpbm5lciB9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9mb3JtPjtcblxuICAgICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJteF9TdGF0dXNNZXNzYWdlQ29udGV4dE1lbnVcIj5cbiAgICAgICAgICAgIHsgZm9ybSB9XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG59XG4iXX0=