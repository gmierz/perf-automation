"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _actions = require("../../../dispatcher/actions");

var _BaseAvatar = _interopRequireDefault(require("./BaseAvatar"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _Media = require("../../../customisations/Media");

var _logger = require("matrix-js-sdk/src/logger");

const _excluded = ["member", "fallbackUserId", "onClick", "viewUserOnClick"];

var _dec, _class, _class2, _temp;

let MemberAvatar = (_dec = (0, _replaceableComponent.replaceableComponent)("views.avatars.MemberAvatar"), _dec(_class = (_temp = _class2 = class MemberAvatar extends _react.default.Component {
  constructor(props) {
    super(props);
    this.state = MemberAvatar.getState(props);
  }

  static getDerivedStateFromProps(nextProps) {
    return MemberAvatar.getState(nextProps);
  }

  static getState(props) {
    var _props$member;

    if ((_props$member = props.member) !== null && _props$member !== void 0 && _props$member.name) {
      let imageUrl = null;

      if (props.member.getMxcAvatarUrl()) {
        imageUrl = (0, _Media.mediaFromMxc)(props.member.getMxcAvatarUrl()).getThumbnailOfSourceHttp(props.width, props.height, props.resizeMethod);
      }

      return {
        name: props.member.name,
        title: props.title || props.member.userId,
        imageUrl: imageUrl
      };
    } else if (props.fallbackUserId) {
      return {
        name: props.fallbackUserId,
        title: props.fallbackUserId
      };
    } else {
      _logger.logger.error("MemberAvatar called somehow with null member or fallbackUserId");
    }
  }

  render() {
    let _this$props = this.props,
        {
      member,
      fallbackUserId,
      onClick,
      viewUserOnClick
    } = _this$props,
        otherProps = (0, _objectWithoutProperties2.default)(_this$props, _excluded);
    const userId = member ? member.userId : fallbackUserId;

    if (viewUserOnClick) {
      onClick = () => {
        _dispatcher.default.dispatch({
          action: _actions.Action.ViewUser,
          member: this.props.member
        });
      };
    }

    return /*#__PURE__*/_react.default.createElement(_BaseAvatar.default, (0, _extends2.default)({}, otherProps, {
      name: this.state.name,
      title: this.state.title,
      idName: userId,
      url: this.state.imageUrl,
      onClick: onClick
    }));
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  width: 40,
  height: 40,
  resizeMethod: 'crop',
  viewUserOnClick: false
}), _temp)) || _class);
exports.default = MemberAvatar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2F2YXRhcnMvTWVtYmVyQXZhdGFyLnRzeCJdLCJuYW1lcyI6WyJNZW1iZXJBdmF0YXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzdGF0ZSIsImdldFN0YXRlIiwiZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIiwibmV4dFByb3BzIiwibWVtYmVyIiwibmFtZSIsImltYWdlVXJsIiwiZ2V0TXhjQXZhdGFyVXJsIiwiZ2V0VGh1bWJuYWlsT2ZTb3VyY2VIdHRwIiwid2lkdGgiLCJoZWlnaHQiLCJyZXNpemVNZXRob2QiLCJ0aXRsZSIsInVzZXJJZCIsImZhbGxiYWNrVXNlcklkIiwibG9nZ2VyIiwiZXJyb3IiLCJyZW5kZXIiLCJvbkNsaWNrIiwidmlld1VzZXJPbkNsaWNrIiwib3RoZXJQcm9wcyIsImRpcyIsImRpc3BhdGNoIiwiYWN0aW9uIiwiQWN0aW9uIiwiVmlld1VzZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQWlCQTs7QUFJQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7Ozs7O0lBdUJxQkEsWSxXQURwQixnREFBcUIsNEJBQXJCLEMsbUNBQUQsTUFDcUJBLFlBRHJCLFNBQzBDQyxlQUFNQyxTQURoRCxDQUMwRTtBQVF0RUMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0FBQ3ZCLFVBQU1BLEtBQU47QUFFQSxTQUFLQyxLQUFMLEdBQWFMLFlBQVksQ0FBQ00sUUFBYixDQUFzQkYsS0FBdEIsQ0FBYjtBQUNIOztBQUVxQyxTQUF4Qkcsd0JBQXdCLENBQUNDLFNBQUQsRUFBNEI7QUFDOUQsV0FBT1IsWUFBWSxDQUFDTSxRQUFiLENBQXNCRSxTQUF0QixDQUFQO0FBQ0g7O0FBRXNCLFNBQVJGLFFBQVEsQ0FBQ0YsS0FBRCxFQUF3QjtBQUFBOztBQUMzQyx5QkFBSUEsS0FBSyxDQUFDSyxNQUFWLDBDQUFJLGNBQWNDLElBQWxCLEVBQXdCO0FBQ3BCLFVBQUlDLFFBQVEsR0FBRyxJQUFmOztBQUNBLFVBQUlQLEtBQUssQ0FBQ0ssTUFBTixDQUFhRyxlQUFiLEVBQUosRUFBb0M7QUFDaENELFFBQUFBLFFBQVEsR0FBRyx5QkFBYVAsS0FBSyxDQUFDSyxNQUFOLENBQWFHLGVBQWIsRUFBYixFQUE2Q0Msd0JBQTdDLENBQ1BULEtBQUssQ0FBQ1UsS0FEQyxFQUVQVixLQUFLLENBQUNXLE1BRkMsRUFHUFgsS0FBSyxDQUFDWSxZQUhDLENBQVg7QUFLSDs7QUFDRCxhQUFPO0FBQ0hOLFFBQUFBLElBQUksRUFBRU4sS0FBSyxDQUFDSyxNQUFOLENBQWFDLElBRGhCO0FBRUhPLFFBQUFBLEtBQUssRUFBRWIsS0FBSyxDQUFDYSxLQUFOLElBQWViLEtBQUssQ0FBQ0ssTUFBTixDQUFhUyxNQUZoQztBQUdIUCxRQUFBQSxRQUFRLEVBQUVBO0FBSFAsT0FBUDtBQUtILEtBZEQsTUFjTyxJQUFJUCxLQUFLLENBQUNlLGNBQVYsRUFBMEI7QUFDN0IsYUFBTztBQUNIVCxRQUFBQSxJQUFJLEVBQUVOLEtBQUssQ0FBQ2UsY0FEVDtBQUVIRixRQUFBQSxLQUFLLEVBQUViLEtBQUssQ0FBQ2U7QUFGVixPQUFQO0FBSUgsS0FMTSxNQUtBO0FBQ0hDLHFCQUFPQyxLQUFQLENBQWEsZ0VBQWI7QUFDSDtBQUNKOztBQUVEQyxFQUFBQSxNQUFNLEdBQUc7QUFDTCxzQkFBMEUsS0FBS2xCLEtBQS9FO0FBQUEsUUFBSTtBQUFFSyxNQUFBQSxNQUFGO0FBQVVVLE1BQUFBLGNBQVY7QUFBMEJJLE1BQUFBLE9BQTFCO0FBQW1DQyxNQUFBQTtBQUFuQyxLQUFKO0FBQUEsUUFBMkRDLFVBQTNEO0FBQ0EsVUFBTVAsTUFBTSxHQUFHVCxNQUFNLEdBQUdBLE1BQU0sQ0FBQ1MsTUFBVixHQUFtQkMsY0FBeEM7O0FBRUEsUUFBSUssZUFBSixFQUFxQjtBQUNqQkQsTUFBQUEsT0FBTyxHQUFHLE1BQU07QUFDWkcsNEJBQUlDLFFBQUosQ0FBYTtBQUNUQyxVQUFBQSxNQUFNLEVBQUVDLGdCQUFPQyxRQUROO0FBRVRyQixVQUFBQSxNQUFNLEVBQUUsS0FBS0wsS0FBTCxDQUFXSztBQUZWLFNBQWI7QUFJSCxPQUxEO0FBTUg7O0FBRUQsd0JBQ0ksNkJBQUMsbUJBQUQsNkJBQWdCZ0IsVUFBaEI7QUFDSSxNQUFBLElBQUksRUFBRSxLQUFLcEIsS0FBTCxDQUFXSyxJQURyQjtBQUVJLE1BQUEsS0FBSyxFQUFFLEtBQUtMLEtBQUwsQ0FBV1ksS0FGdEI7QUFHSSxNQUFBLE1BQU0sRUFBRUMsTUFIWjtBQUlJLE1BQUEsR0FBRyxFQUFFLEtBQUtiLEtBQUwsQ0FBV00sUUFKcEI7QUFLSSxNQUFBLE9BQU8sRUFBRVk7QUFMYixPQURKO0FBUUg7O0FBaEVxRSxDLHlEQUN6QztBQUN6QlQsRUFBQUEsS0FBSyxFQUFFLEVBRGtCO0FBRXpCQyxFQUFBQSxNQUFNLEVBQUUsRUFGaUI7QUFHekJDLEVBQUFBLFlBQVksRUFBRSxNQUhXO0FBSXpCUSxFQUFBQSxlQUFlLEVBQUU7QUFKUSxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE1LCAyMDE2IE9wZW5NYXJrZXQgTHRkXG5Db3B5cmlnaHQgMjAxOSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBSb29tTWVtYmVyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tLW1lbWJlclwiO1xuaW1wb3J0IHsgUmVzaXplTWV0aG9kIH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvQHR5cGVzL3BhcnRpYWxzJztcblxuaW1wb3J0IGRpcyBmcm9tIFwiLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyXCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zXCI7XG5pbXBvcnQgQmFzZUF2YXRhciBmcm9tIFwiLi9CYXNlQXZhdGFyXCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IHsgbWVkaWFGcm9tTXhjIH0gZnJvbSBcIi4uLy4uLy4uL2N1c3RvbWlzYXRpb25zL01lZGlhXCI7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcblxuaW50ZXJmYWNlIElQcm9wcyBleHRlbmRzIE9taXQ8UmVhY3QuQ29tcG9uZW50UHJvcHM8dHlwZW9mIEJhc2VBdmF0YXI+LCBcIm5hbWVcIiB8IFwiaWROYW1lXCIgfCBcInVybFwiPiB7XG4gICAgbWVtYmVyOiBSb29tTWVtYmVyO1xuICAgIGZhbGxiYWNrVXNlcklkPzogc3RyaW5nO1xuICAgIHdpZHRoOiBudW1iZXI7XG4gICAgaGVpZ2h0OiBudW1iZXI7XG4gICAgcmVzaXplTWV0aG9kPzogUmVzaXplTWV0aG9kO1xuICAgIC8vIFRoZSBvbkNsaWNrIHRvIGdpdmUgdGhlIGF2YXRhclxuICAgIG9uQ2xpY2s/OiBSZWFjdC5Nb3VzZUV2ZW50SGFuZGxlcjtcbiAgICAvLyBXaGV0aGVyIHRoZSBvbkNsaWNrIG9mIHRoZSBhdmF0YXIgc2hvdWxkIGJlIG92ZXJyaWRkZW4gdG8gZGlzcGF0Y2ggYEFjdGlvbi5WaWV3VXNlcmBcbiAgICB2aWV3VXNlck9uQ2xpY2s/OiBib29sZWFuO1xuICAgIHRpdGxlPzogc3RyaW5nO1xuICAgIHN0eWxlPzogYW55O1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBpbWFnZVVybD86IHN0cmluZztcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwidmlld3MuYXZhdGFycy5NZW1iZXJBdmF0YXJcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lbWJlckF2YXRhciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHB1YmxpYyBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgICB3aWR0aDogNDAsXG4gICAgICAgIGhlaWdodDogNDAsXG4gICAgICAgIHJlc2l6ZU1ldGhvZDogJ2Nyb3AnLFxuICAgICAgICB2aWV3VXNlck9uQ2xpY2s6IGZhbHNlLFxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0gTWVtYmVyQXZhdGFyLmdldFN0YXRlKHByb3BzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhuZXh0UHJvcHM6IElQcm9wcyk6IElTdGF0ZSB7XG4gICAgICAgIHJldHVybiBNZW1iZXJBdmF0YXIuZ2V0U3RhdGUobmV4dFByb3BzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBnZXRTdGF0ZShwcm9wczogSVByb3BzKTogSVN0YXRlIHtcbiAgICAgICAgaWYgKHByb3BzLm1lbWJlcj8ubmFtZSkge1xuICAgICAgICAgICAgbGV0IGltYWdlVXJsID0gbnVsbDtcbiAgICAgICAgICAgIGlmIChwcm9wcy5tZW1iZXIuZ2V0TXhjQXZhdGFyVXJsKCkpIHtcbiAgICAgICAgICAgICAgICBpbWFnZVVybCA9IG1lZGlhRnJvbU14Yyhwcm9wcy5tZW1iZXIuZ2V0TXhjQXZhdGFyVXJsKCkpLmdldFRodW1ibmFpbE9mU291cmNlSHR0cChcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIHByb3BzLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgcHJvcHMucmVzaXplTWV0aG9kLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHByb3BzLm1lbWJlci5uYW1lLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBwcm9wcy50aXRsZSB8fCBwcm9wcy5tZW1iZXIudXNlcklkLFxuICAgICAgICAgICAgICAgIGltYWdlVXJsOiBpbWFnZVVybCxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSBpZiAocHJvcHMuZmFsbGJhY2tVc2VySWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbmFtZTogcHJvcHMuZmFsbGJhY2tVc2VySWQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHByb3BzLmZhbGxiYWNrVXNlcklkLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcIk1lbWJlckF2YXRhciBjYWxsZWQgc29tZWhvdyB3aXRoIG51bGwgbWVtYmVyIG9yIGZhbGxiYWNrVXNlcklkXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBsZXQgeyBtZW1iZXIsIGZhbGxiYWNrVXNlcklkLCBvbkNsaWNrLCB2aWV3VXNlck9uQ2xpY2ssIC4uLm90aGVyUHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHVzZXJJZCA9IG1lbWJlciA/IG1lbWJlci51c2VySWQgOiBmYWxsYmFja1VzZXJJZDtcblxuICAgICAgICBpZiAodmlld1VzZXJPbkNsaWNrKSB7XG4gICAgICAgICAgICBvbkNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdVc2VyLFxuICAgICAgICAgICAgICAgICAgICBtZW1iZXI6IHRoaXMucHJvcHMubWVtYmVyLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZUF2YXRhciB7Li4ub3RoZXJQcm9wc31cbiAgICAgICAgICAgICAgICBuYW1lPXt0aGlzLnN0YXRlLm5hbWV9XG4gICAgICAgICAgICAgICAgdGl0bGU9e3RoaXMuc3RhdGUudGl0bGV9XG4gICAgICAgICAgICAgICAgaWROYW1lPXt1c2VySWR9XG4gICAgICAgICAgICAgICAgdXJsPXt0aGlzLnN0YXRlLmltYWdlVXJsfVxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e29uQ2xpY2t9IC8+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19