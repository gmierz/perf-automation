"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var React = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _dispatcher = _interopRequireDefault(require("../../dispatcher/dispatcher"));

var _languageHandler = require("../../languageHandler");

var _AccessibleButton = _interopRequireDefault(require("../views/elements/AccessibleButton"));

var _actions = require("../../dispatcher/actions");

var _RoomListStore = _interopRequireDefault(require("../../stores/room-list/RoomListStore"));

var _NameFilterCondition = require("../../stores/room-list/filters/NameFilterCondition");

var _KeyBindingsManager = require("../../KeyBindingsManager");

var _replaceableComponent = require("../../utils/replaceableComponent");

var _SpaceStore = _interopRequireDefault(require("../../stores/spaces/SpaceStore"));

var _spaces = require("../../stores/spaces");

var _dec, _class;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let RoomSearch = (_dec = (0, _replaceableComponent.replaceableComponent)("structures.RoomSearch"), _dec(_class = class RoomSearch extends React.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "inputRef", /*#__PURE__*/(0, React.createRef)());
    (0, _defineProperty2.default)(this, "searchFilter", new _NameFilterCondition.NameFilterCondition());
    (0, _defineProperty2.default)(this, "onSpaces", spaces => {
      this.setState({
        inSpaces: spaces.length > 0
      });
    });
    (0, _defineProperty2.default)(this, "onAction", payload => {
      if (payload.action === _actions.Action.ViewRoom && payload.clear_search) {
        this.clearInput();
      } else if (payload.action === 'focus_room_filter' && this.inputRef.current) {
        this.inputRef.current.focus();
      }
    });
    (0, _defineProperty2.default)(this, "clearInput", () => {
      if (!this.inputRef.current) return;
      this.inputRef.current.value = "";
      this.onChange();
    });
    (0, _defineProperty2.default)(this, "openSearch", () => {
      _dispatcher.default.dispatch({
        action: "show_left_panel"
      });

      _dispatcher.default.dispatch({
        action: "focus_room_filter"
      });
    });
    (0, _defineProperty2.default)(this, "onChange", () => {
      if (!this.inputRef.current) return;
      this.setState({
        query: this.inputRef.current.value
      });
    });
    (0, _defineProperty2.default)(this, "onFocus", ev => {
      this.setState({
        focused: true
      });
      ev.target.select();
    });
    (0, _defineProperty2.default)(this, "onBlur", ev => {
      this.setState({
        focused: false
      });
    });
    (0, _defineProperty2.default)(this, "onKeyDown", ev => {
      const action = (0, _KeyBindingsManager.getKeyBindingsManager)().getRoomListAction(ev);

      switch (action) {
        case _KeyBindingsManager.RoomListAction.ClearSearch:
          this.clearInput();

          _dispatcher.default.fire(_actions.Action.FocusSendMessageComposer);

          break;

        case _KeyBindingsManager.RoomListAction.SelectRoom:
          {
            const shouldClear = this.props.onSelectRoom();

            if (shouldClear) {
              // wrap in set immediate to delay it so that we don't clear the filter & then change room
              setImmediate(() => {
                this.clearInput();
              });
            }

            break;
          }
      }
    });
    this.state = {
      query: "",
      focused: false,
      inSpaces: false
    };
    this.dispatcherRef = _dispatcher.default.register(this.onAction); // clear filter when changing spaces, in future we may wish to maintain a filter per-space

    _SpaceStore.default.instance.on(_spaces.UPDATE_SELECTED_SPACE, this.clearInput);

    _SpaceStore.default.instance.on(_spaces.UPDATE_TOP_LEVEL_SPACES, this.onSpaces);
  }

  componentDidUpdate(prevProps, prevState) {
    if (prevState.query !== this.state.query) {
      const hadSearch = !!this.searchFilter.search.trim();
      const haveSearch = !!this.state.query.trim();
      this.searchFilter.search = this.state.query;

      if (!hadSearch && haveSearch) {
        // started a new filter - add the condition
        _RoomListStore.default.instance.addFilter(this.searchFilter);
      } else if (hadSearch && !haveSearch) {
        // cleared a filter - remove the condition
        _RoomListStore.default.instance.removeFilter(this.searchFilter);
      } // else the filter hasn't changed enough for us to care here

    }
  }

  componentWillUnmount() {
    _dispatcher.default.unregister(this.dispatcherRef);

    _SpaceStore.default.instance.off(_spaces.UPDATE_SELECTED_SPACE, this.clearInput);

    _SpaceStore.default.instance.off(_spaces.UPDATE_TOP_LEVEL_SPACES, this.onSpaces);
  }

  focus() {
    var _this$inputRef$curren;

    (_this$inputRef$curren = this.inputRef.current) === null || _this$inputRef$curren === void 0 ? void 0 : _this$inputRef$curren.focus();
  }

  render() {
    const classes = (0, _classnames.default)({
      'mx_RoomSearch': true,
      'mx_RoomSearch_hasQuery': this.state.query,
      'mx_RoomSearch_focused': this.state.focused,
      'mx_RoomSearch_minimized': this.props.isMinimized
    });
    const inputClasses = (0, _classnames.default)({
      'mx_RoomSearch_input': true,
      'mx_RoomSearch_inputExpanded': this.state.query || this.state.focused
    });
    let placeholder = (0, _languageHandler._t)("Filter");

    if (this.state.inSpaces) {
      placeholder = (0, _languageHandler._t)("Filter all spaces");
    }

    let icon = /*#__PURE__*/React.createElement("div", {
      className: "mx_RoomSearch_icon"
    });
    let input = /*#__PURE__*/React.createElement("input", {
      type: "text",
      ref: this.inputRef,
      className: inputClasses,
      value: this.state.query,
      onFocus: this.onFocus,
      onBlur: this.onBlur,
      onChange: this.onChange,
      onKeyDown: this.onKeyDown,
      placeholder: placeholder,
      autoComplete: "off"
    });
    let clearButton = /*#__PURE__*/React.createElement(_AccessibleButton.default, {
      tabIndex: -1,
      title: (0, _languageHandler._t)("Clear filter"),
      className: "mx_RoomSearch_clearButton",
      onClick: this.clearInput
    });

    if (this.props.isMinimized) {
      icon = /*#__PURE__*/React.createElement(_AccessibleButton.default, {
        title: (0, _languageHandler._t)("Filter rooms and people"),
        className: "mx_RoomSearch_icon mx_RoomSearch_minimizedHandle",
        onClick: this.openSearch
      });
      input = null;
      clearButton = null;
    }

    return /*#__PURE__*/React.createElement("div", {
      className: classes
    }, icon, input, clearButton);
  }

  appendChar(char) {
    this.setState({
      query: this.state.query + char
    });
  }

  backspace() {
    this.setState({
      query: this.state.query.substring(0, this.state.query.length - 1)
    });
  }

}) || _class);
exports.default = RoomSearch;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvUm9vbVNlYXJjaC50c3giXSwibmFtZXMiOlsiUm9vbVNlYXJjaCIsIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJOYW1lRmlsdGVyQ29uZGl0aW9uIiwic3BhY2VzIiwic2V0U3RhdGUiLCJpblNwYWNlcyIsImxlbmd0aCIsInBheWxvYWQiLCJhY3Rpb24iLCJBY3Rpb24iLCJWaWV3Um9vbSIsImNsZWFyX3NlYXJjaCIsImNsZWFySW5wdXQiLCJpbnB1dFJlZiIsImN1cnJlbnQiLCJmb2N1cyIsInZhbHVlIiwib25DaGFuZ2UiLCJkZWZhdWx0RGlzcGF0Y2hlciIsImRpc3BhdGNoIiwicXVlcnkiLCJldiIsImZvY3VzZWQiLCJ0YXJnZXQiLCJzZWxlY3QiLCJnZXRSb29tTGlzdEFjdGlvbiIsIlJvb21MaXN0QWN0aW9uIiwiQ2xlYXJTZWFyY2giLCJmaXJlIiwiRm9jdXNTZW5kTWVzc2FnZUNvbXBvc2VyIiwiU2VsZWN0Um9vbSIsInNob3VsZENsZWFyIiwib25TZWxlY3RSb29tIiwic2V0SW1tZWRpYXRlIiwic3RhdGUiLCJkaXNwYXRjaGVyUmVmIiwicmVnaXN0ZXIiLCJvbkFjdGlvbiIsIlNwYWNlU3RvcmUiLCJpbnN0YW5jZSIsIm9uIiwiVVBEQVRFX1NFTEVDVEVEX1NQQUNFIiwiVVBEQVRFX1RPUF9MRVZFTF9TUEFDRVMiLCJvblNwYWNlcyIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInByZXZTdGF0ZSIsImhhZFNlYXJjaCIsInNlYXJjaEZpbHRlciIsInNlYXJjaCIsInRyaW0iLCJoYXZlU2VhcmNoIiwiUm9vbUxpc3RTdG9yZSIsImFkZEZpbHRlciIsInJlbW92ZUZpbHRlciIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwidW5yZWdpc3RlciIsIm9mZiIsInJlbmRlciIsImNsYXNzZXMiLCJpc01pbmltaXplZCIsImlucHV0Q2xhc3NlcyIsInBsYWNlaG9sZGVyIiwiaWNvbiIsImlucHV0Iiwib25Gb2N1cyIsIm9uQmx1ciIsIm9uS2V5RG93biIsImNsZWFyQnV0dG9uIiwib3BlblNlYXJjaCIsImFwcGVuZENoYXIiLCJjaGFyIiwiYmFja3NwYWNlIiwic3Vic3RyaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFFQTs7QUFHQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7SUFpQnFCQSxVLFdBRHBCLGdEQUFxQix1QkFBckIsQyxnQkFBRCxNQUNxQkEsVUFEckIsU0FDd0NDLEtBQUssQ0FBQ0MsYUFEOUMsQ0FDNEU7QUFLeEVDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFnQjtBQUN2QixVQUFNQSxLQUFOO0FBRHVCO0FBQUEsaUVBSDJCLHNCQUczQjtBQUFBLHdEQUZpQixJQUFJQyx3Q0FBSixFQUVqQjtBQUFBLG9EQW9DUEMsTUFBRCxJQUFvQjtBQUNuQyxXQUFLQyxRQUFMLENBQWM7QUFDVkMsUUFBQUEsUUFBUSxFQUFFRixNQUFNLENBQUNHLE1BQVAsR0FBZ0I7QUFEaEIsT0FBZDtBQUdILEtBeEMwQjtBQUFBLG9EQTBDUEMsT0FBRCxJQUE0QjtBQUMzQyxVQUFJQSxPQUFPLENBQUNDLE1BQVIsS0FBbUJDLGdCQUFPQyxRQUExQixJQUFzQ0gsT0FBTyxDQUFDSSxZQUFsRCxFQUFnRTtBQUM1RCxhQUFLQyxVQUFMO0FBQ0gsT0FGRCxNQUVPLElBQUlMLE9BQU8sQ0FBQ0MsTUFBUixLQUFtQixtQkFBbkIsSUFBMEMsS0FBS0ssUUFBTCxDQUFjQyxPQUE1RCxFQUFxRTtBQUN4RSxhQUFLRCxRQUFMLENBQWNDLE9BQWQsQ0FBc0JDLEtBQXRCO0FBQ0g7QUFDSixLQWhEMEI7QUFBQSxzREFrRE4sTUFBTTtBQUN2QixVQUFJLENBQUMsS0FBS0YsUUFBTCxDQUFjQyxPQUFuQixFQUE0QjtBQUM1QixXQUFLRCxRQUFMLENBQWNDLE9BQWQsQ0FBc0JF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LFFBQUwsQ0FBYztBQUNWZ0IsTUFBQUEsS0FBSyxFQUFFLEtBQUtjLEtBQUwsQ0FBV2QsS0FBWCxDQUFpQnFELFNBQWpCLENBQTJCLENBQTNCLEVBQThCLEtBQUt2QyxLQUFMLENBQVdkLEtBQVgsQ0FBaUJkLE1BQWpCLEdBQTBCLENBQXhEO0FBREcsS0FBZDtBQUdIOztBQW5MdUUsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMCwgMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgY3JlYXRlUmVmIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbVwiO1xuXG5pbXBvcnQgZGVmYXVsdERpc3BhdGNoZXIgZnJvbSBcIi4uLy4uL2Rpc3BhdGNoZXIvZGlzcGF0Y2hlclwiO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgeyBBY3Rpb25QYXlsb2FkIH0gZnJvbSBcIi4uLy4uL2Rpc3BhdGNoZXIvcGF5bG9hZHNcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi92aWV3cy9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zXCI7XG5pbXBvcnQgUm9vbUxpc3RTdG9yZSBmcm9tIFwiLi4vLi4vc3RvcmVzL3Jvb20tbGlzdC9Sb29tTGlzdFN0b3JlXCI7XG5pbXBvcnQgeyBOYW1lRmlsdGVyQ29uZGl0aW9uIH0gZnJvbSBcIi4uLy4uL3N0b3Jlcy9yb29tLWxpc3QvZmlsdGVycy9OYW1lRmlsdGVyQ29uZGl0aW9uXCI7XG5pbXBvcnQgeyBnZXRLZXlCaW5kaW5nc01hbmFnZXIsIFJvb21MaXN0QWN0aW9uIH0gZnJvbSBcIi4uLy4uL0tleUJpbmRpbmdzTWFuYWdlclwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCBTcGFjZVN0b3JlIGZyb20gXCIuLi8uLi9zdG9yZXMvc3BhY2VzL1NwYWNlU3RvcmVcIjtcbmltcG9ydCB7IFVQREFURV9TRUxFQ1RFRF9TUEFDRSwgVVBEQVRFX1RPUF9MRVZFTF9TUEFDRVMgfSBmcm9tIFwiLi4vLi4vc3RvcmVzL3NwYWNlc1wiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBpc01pbmltaXplZDogYm9vbGVhbjtcbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIGEgcm9vbSBoYXMgYmVlbiBzZWxlY3RlZCBhbmQgdGhlIHNlYXJjaCBmaWVsZCBzaG91bGQgYmUgY2xlYXJlZFxuICAgICAqL1xuICAgIG9uU2VsZWN0Um9vbSgpOiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBxdWVyeTogc3RyaW5nO1xuICAgIGZvY3VzZWQ6IGJvb2xlYW47XG4gICAgaW5TcGFjZXM6IGJvb2xlYW47XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInN0cnVjdHVyZXMuUm9vbVNlYXJjaFwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUm9vbVNlYXJjaCBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIGRpc3BhdGNoZXJSZWY6IHN0cmluZztcbiAgICBwcml2YXRlIGlucHV0UmVmOiBSZWFjdC5SZWZPYmplY3Q8SFRNTElucHV0RWxlbWVudD4gPSBjcmVhdGVSZWYoKTtcbiAgICBwcml2YXRlIHNlYXJjaEZpbHRlcjogTmFtZUZpbHRlckNvbmRpdGlvbiA9IG5ldyBOYW1lRmlsdGVyQ29uZGl0aW9uKCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgcXVlcnk6IFwiXCIsXG4gICAgICAgICAgICBmb2N1c2VkOiBmYWxzZSxcbiAgICAgICAgICAgIGluU3BhY2VzOiBmYWxzZSxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmRpc3BhdGNoZXJSZWYgPSBkZWZhdWx0RGlzcGF0Y2hlci5yZWdpc3Rlcih0aGlzLm9uQWN0aW9uKTtcbiAgICAgICAgLy8gY2xlYXIgZmlsdGVyIHdoZW4gY2hhbmdpbmcgc3BhY2VzLCBpbiBmdXR1cmUgd2UgbWF5IHdpc2ggdG8gbWFpbnRhaW4gYSBmaWx0ZXIgcGVyLXNwYWNlXG4gICAgICAgIFNwYWNlU3RvcmUuaW5zdGFuY2Uub24oVVBEQVRFX1NFTEVDVEVEX1NQQUNFLCB0aGlzLmNsZWFySW5wdXQpO1xuICAgICAgICBTcGFjZVN0b3JlLmluc3RhbmNlLm9uKFVQREFURV9UT1BfTEVWRUxfU1BBQ0VTLCB0aGlzLm9uU3BhY2VzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wczogUmVhZG9ubHk8SVByb3BzPiwgcHJldlN0YXRlOiBSZWFkb25seTxJU3RhdGU+KTogdm9pZCB7XG4gICAgICAgIGlmIChwcmV2U3RhdGUucXVlcnkgIT09IHRoaXMuc3RhdGUucXVlcnkpIHtcbiAgICAgICAgICAgIGNvbnN0IGhhZFNlYXJjaCA9ICEhdGhpcy5zZWFyY2hGaWx0ZXIuc2VhcmNoLnRyaW0oKTtcbiAgICAgICAgICAgIGNvbnN0IGhhdmVTZWFyY2ggPSAhIXRoaXMuc3RhdGUucXVlcnkudHJpbSgpO1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hGaWx0ZXIuc2VhcmNoID0gdGhpcy5zdGF0ZS5xdWVyeTtcbiAgICAgICAgICAgIGlmICghaGFkU2VhcmNoICYmIGhhdmVTZWFyY2gpIHtcbiAgICAgICAgICAgICAgICAvLyBzdGFydGVkIGEgbmV3IGZpbHRlciAtIGFkZCB0aGUgY29uZGl0aW9uXG4gICAgICAgICAgICAgICAgUm9vbUxpc3RTdG9yZS5pbnN0YW5jZS5hZGRGaWx0ZXIodGhpcy5zZWFyY2hGaWx0ZXIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoYWRTZWFyY2ggJiYgIWhhdmVTZWFyY2gpIHtcbiAgICAgICAgICAgICAgICAvLyBjbGVhcmVkIGEgZmlsdGVyIC0gcmVtb3ZlIHRoZSBjb25kaXRpb25cbiAgICAgICAgICAgICAgICBSb29tTGlzdFN0b3JlLmluc3RhbmNlLnJlbW92ZUZpbHRlcih0aGlzLnNlYXJjaEZpbHRlcik7XG4gICAgICAgICAgICB9IC8vIGVsc2UgdGhlIGZpbHRlciBoYXNuJ3QgY2hhbmdlZCBlbm91Z2ggZm9yIHVzIHRvIGNhcmUgaGVyZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBkZWZhdWx0RGlzcGF0Y2hlci51bnJlZ2lzdGVyKHRoaXMuZGlzcGF0Y2hlclJlZik7XG4gICAgICAgIFNwYWNlU3RvcmUuaW5zdGFuY2Uub2ZmKFVQREFURV9TRUxFQ1RFRF9TUEFDRSwgdGhpcy5jbGVhcklucHV0KTtcbiAgICAgICAgU3BhY2VTdG9yZS5pbnN0YW5jZS5vZmYoVVBEQVRFX1RPUF9MRVZFTF9TUEFDRVMsIHRoaXMub25TcGFjZXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25TcGFjZXMgPSAoc3BhY2VzOiBSb29tW10pID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBpblNwYWNlczogc3BhY2VzLmxlbmd0aCA+IDAsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQWN0aW9uID0gKHBheWxvYWQ6IEFjdGlvblBheWxvYWQpID0+IHtcbiAgICAgICAgaWYgKHBheWxvYWQuYWN0aW9uID09PSBBY3Rpb24uVmlld1Jvb20gJiYgcGF5bG9hZC5jbGVhcl9zZWFyY2gpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJJbnB1dCgpO1xuICAgICAgICB9IGVsc2UgaWYgKHBheWxvYWQuYWN0aW9uID09PSAnZm9jdXNfcm9vbV9maWx0ZXInICYmIHRoaXMuaW5wdXRSZWYuY3VycmVudCkge1xuICAgICAgICAgICAgdGhpcy5pbnB1dFJlZi5jdXJyZW50LmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjbGVhcklucHV0ID0gKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuaW5wdXRSZWYuY3VycmVudCkgcmV0dXJuO1xuICAgICAgICB0aGlzLmlucHV0UmVmLmN1cnJlbnQudmFsdWUgPSBcIlwiO1xuICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb3BlblNlYXJjaCA9ICgpID0+IHtcbiAgICAgICAgZGVmYXVsdERpc3BhdGNoZXIuZGlzcGF0Y2goeyBhY3Rpb246IFwic2hvd19sZWZ0X3BhbmVsXCIgfSk7XG4gICAgICAgIGRlZmF1bHREaXNwYXRjaGVyLmRpc3BhdGNoKHsgYWN0aW9uOiBcImZvY3VzX3Jvb21fZmlsdGVyXCIgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25DaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5pbnB1dFJlZi5jdXJyZW50KSByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBxdWVyeTogdGhpcy5pbnB1dFJlZi5jdXJyZW50LnZhbHVlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uRm9jdXMgPSAoZXY6IFJlYWN0LkZvY3VzRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGZvY3VzZWQ6IHRydWUgfSk7XG4gICAgICAgIGV2LnRhcmdldC5zZWxlY3QoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkJsdXIgPSAoZXY6IFJlYWN0LkZvY3VzRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGZvY3VzZWQ6IGZhbHNlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uS2V5RG93biA9IChldjogUmVhY3QuS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBnZXRLZXlCaW5kaW5nc01hbmFnZXIoKS5nZXRSb29tTGlzdEFjdGlvbihldik7XG4gICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIFJvb21MaXN0QWN0aW9uLkNsZWFyU2VhcmNoOlxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJJbnB1dCgpO1xuICAgICAgICAgICAgICAgIGRlZmF1bHREaXNwYXRjaGVyLmZpcmUoQWN0aW9uLkZvY3VzU2VuZE1lc3NhZ2VDb21wb3Nlcik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFJvb21MaXN0QWN0aW9uLlNlbGVjdFJvb206IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzaG91bGRDbGVhciA9IHRoaXMucHJvcHMub25TZWxlY3RSb29tKCk7XG4gICAgICAgICAgICAgICAgaWYgKHNob3VsZENsZWFyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHdyYXAgaW4gc2V0IGltbWVkaWF0ZSB0byBkZWxheSBpdCBzbyB0aGF0IHdlIGRvbid0IGNsZWFyIHRoZSBmaWx0ZXIgJiB0aGVuIGNoYW5nZSByb29tXG4gICAgICAgICAgICAgICAgICAgIHNldEltbWVkaWF0ZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFySW5wdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHB1YmxpYyBmb2N1cygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pbnB1dFJlZi5jdXJyZW50Py5mb2N1cygpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKTogUmVhY3QuUmVhY3ROb2RlIHtcbiAgICAgICAgY29uc3QgY2xhc3NlcyA9IGNsYXNzTmFtZXMoe1xuICAgICAgICAgICAgJ214X1Jvb21TZWFyY2gnOiB0cnVlLFxuICAgICAgICAgICAgJ214X1Jvb21TZWFyY2hfaGFzUXVlcnknOiB0aGlzLnN0YXRlLnF1ZXJ5LFxuICAgICAgICAgICAgJ214X1Jvb21TZWFyY2hfZm9jdXNlZCc6IHRoaXMuc3RhdGUuZm9jdXNlZCxcbiAgICAgICAgICAgICdteF9Sb29tU2VhcmNoX21pbmltaXplZCc6IHRoaXMucHJvcHMuaXNNaW5pbWl6ZWQsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGlucHV0Q2xhc3NlcyA9IGNsYXNzTmFtZXMoe1xuICAgICAgICAgICAgJ214X1Jvb21TZWFyY2hfaW5wdXQnOiB0cnVlLFxuICAgICAgICAgICAgJ214X1Jvb21TZWFyY2hfaW5wdXRFeHBhbmRlZCc6IHRoaXMuc3RhdGUucXVlcnkgfHwgdGhpcy5zdGF0ZS5mb2N1c2VkLFxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgcGxhY2Vob2xkZXIgPSBfdChcIkZpbHRlclwiKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaW5TcGFjZXMpIHtcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gX3QoXCJGaWx0ZXIgYWxsIHNwYWNlc1wiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpY29uID0gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J214X1Jvb21TZWFyY2hfaWNvbicgLz5cbiAgICAgICAgKTtcbiAgICAgICAgbGV0IGlucHV0ID0gKFxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIHJlZj17dGhpcy5pbnB1dFJlZn1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2lucHV0Q2xhc3Nlc31cbiAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5xdWVyeX1cbiAgICAgICAgICAgICAgICBvbkZvY3VzPXt0aGlzLm9uRm9jdXN9XG4gICAgICAgICAgICAgICAgb25CbHVyPXt0aGlzLm9uQmx1cn1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbkNoYW5nZX1cbiAgICAgICAgICAgICAgICBvbktleURvd249e3RoaXMub25LZXlEb3dufVxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn1cbiAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICAgICAgbGV0IGNsZWFyQnV0dG9uID0gKFxuICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICB0YWJJbmRleD17LTF9XG4gICAgICAgICAgICAgICAgdGl0bGU9e190KFwiQ2xlYXIgZmlsdGVyXCIpfVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1Jvb21TZWFyY2hfY2xlYXJCdXR0b25cIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuY2xlYXJJbnB1dH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaXNNaW5pbWl6ZWQpIHtcbiAgICAgICAgICAgIGljb24gPSAoXG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgdGl0bGU9e190KFwiRmlsdGVyIHJvb21zIGFuZCBwZW9wbGVcIil9XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X1Jvb21TZWFyY2hfaWNvbiBteF9Sb29tU2VhcmNoX21pbmltaXplZEhhbmRsZVwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub3BlblNlYXJjaH1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlucHV0ID0gbnVsbDtcbiAgICAgICAgICAgIGNsZWFyQnV0dG9uID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlc30+XG4gICAgICAgICAgICAgICAgeyBpY29uIH1cbiAgICAgICAgICAgICAgICB7IGlucHV0IH1cbiAgICAgICAgICAgICAgICB7IGNsZWFyQnV0dG9uIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBhcHBlbmRDaGFyKGNoYXI6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHF1ZXJ5OiB0aGlzLnN0YXRlLnF1ZXJ5ICsgY2hhcixcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGJhY2tzcGFjZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBxdWVyeTogdGhpcy5zdGF0ZS5xdWVyeS5zdWJzdHJpbmcoMCwgdGhpcy5zdGF0ZS5xdWVyeS5sZW5ndGggLSAxKSxcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19