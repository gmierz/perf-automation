"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _AutoHideScrollbar = _interopRequireDefault(require("./AutoHideScrollbar"));

var _pages = require("../../utils/pages");

var _languageHandler = require("../../languageHandler");

var _SdkConfig = _interopRequireDefault(require("../../SdkConfig"));

var sdk = _interopRequireWildcard(require("../../index"));

var _dispatcher = _interopRequireDefault(require("../../dispatcher/dispatcher"));

var _actions = require("../../dispatcher/actions");

var _BaseAvatar = _interopRequireDefault(require("../views/avatars/BaseAvatar"));

var _OwnProfileStore = require("../../stores/OwnProfileStore");

var _AccessibleButton = _interopRequireDefault(require("../views/elements/AccessibleButton"));

var _AsyncStore = require("../../stores/AsyncStore");

var _useEventEmitter = require("../../hooks/useEventEmitter");

var _MatrixClientContext = _interopRequireDefault(require("../../contexts/MatrixClientContext"));

var _MiniAvatarUploader = _interopRequireWildcard(require("../views/elements/MiniAvatarUploader"));

var _Analytics = _interopRequireDefault(require("../../Analytics"));

var _CountlyAnalytics = _interopRequireDefault(require("../../CountlyAnalytics"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const onClickSendDm = () => {
  _Analytics.default.trackEvent('home_page', 'button', 'dm');

  _CountlyAnalytics.default.instance.track("home_page_button", {
    button: "dm"
  });

  _dispatcher.default.dispatch({
    action: 'view_create_chat'
  });
};

const onClickExplore = () => {
  _Analytics.default.trackEvent('home_page', 'button', 'room_directory');

  _CountlyAnalytics.default.instance.track("home_page_button", {
    button: "room_directory"
  });

  _dispatcher.default.fire(_actions.Action.ViewRoomDirectory);
};

const onClickNewRoom = () => {
  _Analytics.default.trackEvent('home_page', 'button', 'create_room');

  _CountlyAnalytics.default.instance.track("home_page_button", {
    button: "create_room"
  });

  _dispatcher.default.dispatch({
    action: 'view_create_room'
  });
};

const getOwnProfile = userId => ({
  displayName: _OwnProfileStore.OwnProfileStore.instance.displayName || userId,
  avatarUrl: _OwnProfileStore.OwnProfileStore.instance.getHttpAvatarUrl(_MiniAvatarUploader.AVATAR_SIZE)
});

const UserWelcomeTop = () => {
  const cli = (0, React.useContext)(_MatrixClientContext.default);
  const userId = cli.getUserId();
  const [ownProfile, setOwnProfile] = (0, React.useState)(getOwnProfile(userId));
  (0, _useEventEmitter.useEventEmitter)(_OwnProfileStore.OwnProfileStore.instance, _AsyncStore.UPDATE_EVENT, () => {
    setOwnProfile(getOwnProfile(userId));
  });
  return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement(_MiniAvatarUploader.default, {
    hasAvatar: !!ownProfile.avatarUrl,
    hasAvatarLabel: (0, _languageHandler._t)("Great, that'll help people know it's you"),
    noAvatarLabel: (0, _languageHandler._t)("Add a photo so people know it's you."),
    setAvatarUrl: url => cli.setAvatarUrl(url)
  }, /*#__PURE__*/React.createElement(_BaseAvatar.default, {
    idName: userId,
    name: ownProfile.displayName,
    url: ownProfile.avatarUrl,
    width: _MiniAvatarUploader.AVATAR_SIZE,
    height: _MiniAvatarUploader.AVATAR_SIZE,
    resizeMethod: "crop"
  })), /*#__PURE__*/React.createElement("h1", null, (0, _languageHandler._t)("Welcome %(name)s", {
    name: ownProfile.displayName
  })), /*#__PURE__*/React.createElement("h4", null, (0, _languageHandler._t)("Now, let's help you get started")));
};

const HomePage = ({
  justRegistered = false
}) => {
  const config = _SdkConfig.default.get();

  const pageUrl = (0, _pages.getHomePageUrl)(config);

  if (pageUrl) {
    // FIXME: Using an import will result in wrench-element-tests failures
    const EmbeddedPage = sdk.getComponent('structures.EmbeddedPage');
    return /*#__PURE__*/React.createElement(EmbeddedPage, {
      className: "mx_HomePage",
      url: pageUrl,
      scrollbar: true
    });
  }

  let introSection;

  if (justRegistered) {
    introSection = /*#__PURE__*/React.createElement(UserWelcomeTop, null);
  } else {
    const brandingConfig = config.branding;
    let logoUrl = "themes/element/img/logos/element-logo.svg";

    if (brandingConfig && brandingConfig.authHeaderLogoUrl) {
      logoUrl = brandingConfig.authHeaderLogoUrl;
    }

    introSection = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("img", {
      src: logoUrl,
      alt: config.brand
    }), /*#__PURE__*/React.createElement("h1", null, (0, _languageHandler._t)("Welcome to %(appName)s", {
      appName: config.brand
    })), /*#__PURE__*/React.createElement("h4", null, (0, _languageHandler._t)("Own your conversations.")));
  }

  return /*#__PURE__*/React.createElement(_AutoHideScrollbar.default, {
    className: "mx_HomePage mx_HomePage_default"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mx_HomePage_default_wrapper"
  }, introSection, /*#__PURE__*/React.createElement("div", {
    className: "mx_HomePage_default_buttons"
  }, /*#__PURE__*/React.createElement(_AccessibleButton.default, {
    onClick: onClickSendDm,
    className: "mx_HomePage_button_sendDm"
  }, (0, _languageHandler._t)("Send a Direct Message")), /*#__PURE__*/React.createElement(_AccessibleButton.default, {
    onClick: onClickExplore,
    className: "mx_HomePage_button_explore"
  }, (0, _languageHandler._t)("Explore Public Rooms")), /*#__PURE__*/React.createElement(_AccessibleButton.default, {
    onClick: onClickNewRoom,
    className: "mx_HomePage_button_createGroup"
  }, (0, _languageHandler._t)("Create a Group Chat")))));
};

var _default = HomePage;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvSG9tZVBhZ2UudHN4Il0sIm5hbWVzIjpbIm9uQ2xpY2tTZW5kRG0iLCJBbmFseXRpY3MiLCJ0cmFja0V2ZW50IiwiQ291bnRseUFuYWx5dGljcyIsImluc3RhbmNlIiwidHJhY2siLCJidXR0b24iLCJkaXMiLCJkaXNwYXRjaCIsImFjdGlvbiIsIm9uQ2xpY2tFeHBsb3JlIiwiZmlyZSIsIkFjdGlvbiIsIlZpZXdSb29tRGlyZWN0b3J5Iiwib25DbGlja05ld1Jvb20iLCJnZXRPd25Qcm9maWxlIiwidXNlcklkIiwiZGlzcGxheU5hbWUiLCJPd25Qcm9maWxlU3RvcmUiLCJhdmF0YXJVcmwiLCJnZXRIdHRwQXZhdGFyVXJsIiwiQVZBVEFSX1NJWkUiLCJVc2VyV2VsY29tZVRvcCIsImNsaSIsIk1hdHJpeENsaWVudENvbnRleHQiLCJnZXRVc2VySWQiLCJvd25Qcm9maWxlIiwic2V0T3duUHJvZmlsZSIsIlVQREFURV9FVkVOVCIsInVybCIsInNldEF2YXRhclVybCIsIm5hbWUiLCJIb21lUGFnZSIsImp1c3RSZWdpc3RlcmVkIiwiY29uZmlnIiwiU2RrQ29uZmlnIiwiZ2V0IiwicGFnZVVybCIsIkVtYmVkZGVkUGFnZSIsInNkayIsImdldENvbXBvbmVudCIsImludHJvU2VjdGlvbiIsImJyYW5kaW5nQ29uZmlnIiwiYnJhbmRpbmciLCJsb2dvVXJsIiwiYXV0aEhlYWRlckxvZ29VcmwiLCJicmFuZCIsImFwcE5hbWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQWdCQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXNCQSxNQUFNQSxhQUFhLEdBQUcsTUFBTTtBQUN4QkMscUJBQVVDLFVBQVYsQ0FBcUIsV0FBckIsRUFBa0MsUUFBbEMsRUFBNEMsSUFBNUM7O0FBQ0FDLDRCQUFpQkMsUUFBakIsQ0FBMEJDLEtBQTFCLENBQWdDLGtCQUFoQyxFQUFvRDtBQUFFQyxJQUFBQSxNQUFNLEVBQUU7QUFBVixHQUFwRDs7QUFDQUMsc0JBQUlDLFFBQUosQ0FBYTtBQUFFQyxJQUFBQSxNQUFNLEVBQUU7QUFBVixHQUFiO0FBQ0gsQ0FKRDs7QUFNQSxNQUFNQyxjQUFjLEdBQUcsTUFBTTtBQUN6QlQscUJBQVVDLFVBQVYsQ0FBcUIsV0FBckIsRUFBa0MsUUFBbEMsRUFBNEMsZ0JBQTVDOztBQUNBQyw0QkFBaUJDLFFBQWpCLENBQTBCQyxLQUExQixDQUFnQyxrQkFBaEMsRUFBb0Q7QUFBRUMsSUFBQUEsTUFBTSxFQUFFO0FBQVYsR0FBcEQ7O0FBQ0FDLHNCQUFJSSxJQUFKLENBQVNDLGdCQUFPQyxpQkFBaEI7QUFDSCxDQUpEOztBQU1BLE1BQU1DLGNBQWMsR0FBRyxNQUFNO0FBQ3pCYixxQkFBVUMsVUFBVixDQUFxQixXQUFyQixFQUFrQyxRQUFsQyxFQUE0QyxhQUE1Qzs7QUFDQUMsNEJBQWlCQyxRQUFqQixDQUEwQkMsS0FBMUIsQ0FBZ0Msa0JBQWhDLEVBQW9EO0FBQUVDLElBQUFBLE1BQU0sRUFBRTtBQUFWLEdBQXBEOztBQUNBQyxzQkFBSUMsUUFBSixDQUFhO0FBQUVDLElBQUFBLE1BQU0sRUFBRTtBQUFWLEdBQWI7QUFDSCxDQUpEOztBQVVBLE1BQU1NLGFBQWEsR0FBSUMsTUFBRCxLQUFxQjtBQUN2Q0MsRUFBQUEsV0FBVyxFQUFFQyxpQ0FBZ0JkLFFBQWhCLENBQXlCYSxXQUF6QixJQUF3Q0QsTUFEZDtBQUV2Q0csRUFBQUEsU0FBUyxFQUFFRCxpQ0FBZ0JkLFFBQWhCLENBQXlCZ0IsZ0JBQXpCLENBQTBDQywrQkFBMUM7QUFGNEIsQ0FBckIsQ0FBdEI7O0FBS0EsTUFBTUMsY0FBYyxHQUFHLE1BQU07QUFDekIsUUFBTUMsR0FBRyxHQUFHLHNCQUFXQyw0QkFBWCxDQUFaO0FBQ0EsUUFBTVIsTUFBTSxHQUFHTyxHQUFHLENBQUNFLFNBQUosRUFBZjtBQUNBLFFBQU0sQ0FBQ0MsVUFBRCxFQUFhQyxhQUFiLElBQThCLG9CQUFTWixhQUFhLENBQUNDLE1BQUQsQ0FBdEIsQ0FBcEM7QUFDQSx3Q0FBZ0JFLGlDQUFnQmQsUUFBaEMsRUFBMEN3Qix3QkFBMUMsRUFBd0QsTUFBTTtBQUMxREQsSUFBQUEsYUFBYSxDQUFDWixhQUFhLENBQUNDLE1BQUQsQ0FBZCxDQUFiO0FBQ0gsR0FGRDtBQUlBLHNCQUFPLDhDQUNILG9CQUFDLDJCQUFEO0FBQ0ksSUFBQSxTQUFTLEVBQUUsQ0FBQyxDQUFDVSxVQUFVLENBQUNQLFNBRDVCO0FBRUksSUFBQSxjQUFjLEVBQUUseUJBQUcsMENBQUgsQ0FGcEI7QUFHSSxJQUFBLGFBQWEsRUFBRSx5QkFBRyxzQ0FBSCxDQUhuQjtBQUlJLElBQUEsWUFBWSxFQUFFVSxHQUFHLElBQUlOLEdBQUcsQ0FBQ08sWUFBSixDQUFpQkQsR0FBakI7QUFKekIsa0JBTUksb0JBQUMsbUJBQUQ7QUFDSSxJQUFBLE1BQU0sRUFBRWIsTUFEWjtBQUVJLElBQUEsSUFBSSxFQUFFVSxVQUFVLENBQUNULFdBRnJCO0FBR0ksSUFBQSxHQUFHLEVBQUVTLFVBQVUsQ0FBQ1AsU0FIcEI7QUFJSSxJQUFBLEtBQUssRUFBRUUsK0JBSlg7QUFLSSxJQUFBLE1BQU0sRUFBRUEsK0JBTFo7QUFNSSxJQUFBLFlBQVksRUFBQztBQU5qQixJQU5KLENBREcsZUFpQkgsZ0NBQU0seUJBQUcsa0JBQUgsRUFBdUI7QUFBRVUsSUFBQUEsSUFBSSxFQUFFTCxVQUFVLENBQUNUO0FBQW5CLEdBQXZCLENBQU4sQ0FqQkcsZUFrQkgsZ0NBQU0seUJBQUcsaUNBQUgsQ0FBTixDQWxCRyxDQUFQO0FBb0JILENBNUJEOztBQThCQSxNQUFNZSxRQUEwQixHQUFHLENBQUM7QUFBRUMsRUFBQUEsY0FBYyxHQUFHO0FBQW5CLENBQUQsS0FBZ0M7QUFDL0QsUUFBTUMsTUFBTSxHQUFHQyxtQkFBVUMsR0FBVixFQUFmOztBQUNBLFFBQU1DLE9BQU8sR0FBRywyQkFBZUgsTUFBZixDQUFoQjs7QUFFQSxNQUFJRyxPQUFKLEVBQWE7QUFDVDtBQUNBLFVBQU1DLFlBQVksR0FBR0MsR0FBRyxDQUFDQyxZQUFKLENBQWlCLHlCQUFqQixDQUFyQjtBQUNBLHdCQUFPLG9CQUFDLFlBQUQ7QUFBYyxNQUFBLFNBQVMsRUFBQyxhQUF4QjtBQUFzQyxNQUFBLEdBQUcsRUFBRUgsT0FBM0M7QUFBb0QsTUFBQSxTQUFTLEVBQUU7QUFBL0QsTUFBUDtBQUNIOztBQUVELE1BQUlJLFlBQUo7O0FBQ0EsTUFBSVIsY0FBSixFQUFvQjtBQUNoQlEsSUFBQUEsWUFBWSxnQkFBRyxvQkFBQyxjQUFELE9BQWY7QUFDSCxHQUZELE1BRU87QUFDSCxVQUFNQyxjQUFjLEdBQUdSLE1BQU0sQ0FBQ1MsUUFBOUI7QUFDQSxRQUFJQyxPQUFPLEdBQUcsMkNBQWQ7O0FBQ0EsUUFBSUYsY0FBYyxJQUFJQSxjQUFjLENBQUNHLGlCQUFyQyxFQUF3RDtBQUNwREQsTUFBQUEsT0FBTyxHQUFHRixjQUFjLENBQUNHLGlCQUF6QjtBQUNIOztBQUVESixJQUFBQSxZQUFZLGdCQUFHLG9CQUFDLEtBQUQsQ0FBTyxRQUFQLHFCQUNYO0FBQUssTUFBQSxHQUFHLEVBQUVHLE9BQVY7QUFBbUIsTUFBQSxHQUFHLEVBQUVWLE1BQU0sQ0FBQ1k7QUFBL0IsTUFEVyxlQUVYLGdDQUFNLHlCQUFHLHdCQUFILEVBQTZCO0FBQUVDLE1BQUFBLE9BQU8sRUFBRWIsTUFBTSxDQUFDWTtBQUFsQixLQUE3QixDQUFOLENBRlcsZUFHWCxnQ0FBTSx5QkFBRyx5QkFBSCxDQUFOLENBSFcsQ0FBZjtBQUtIOztBQUVELHNCQUFPLG9CQUFDLDBCQUFEO0FBQW1CLElBQUEsU0FBUyxFQUFDO0FBQTdCLGtCQUNIO0FBQUssSUFBQSxTQUFTLEVBQUM7QUFBZixLQUNNTCxZQUROLGVBRUk7QUFBSyxJQUFBLFNBQVMsRUFBQztBQUFmLGtCQUNJLG9CQUFDLHlCQUFEO0FBQWtCLElBQUEsT0FBTyxFQUFFekMsYUFBM0I7QUFBMEMsSUFBQSxTQUFTLEVBQUM7QUFBcEQsS0FDTSx5QkFBRyx1QkFBSCxDQUROLENBREosZUFJSSxvQkFBQyx5QkFBRDtBQUFrQixJQUFBLE9BQU8sRUFBRVUsY0FBM0I7QUFBMkMsSUFBQSxTQUFTLEVBQUM7QUFBckQsS0FDTSx5QkFBRyxzQkFBSCxDQUROLENBSkosZUFPSSxvQkFBQyx5QkFBRDtBQUFrQixJQUFBLE9BQU8sRUFBRUksY0FBM0I7QUFBMkMsSUFBQSxTQUFTLEVBQUM7QUFBckQsS0FDTSx5QkFBRyxxQkFBSCxDQUROLENBUEosQ0FGSixDQURHLENBQVA7QUFnQkgsQ0EzQ0Q7O2VBNkNla0IsUSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlQ29udGV4dCwgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcblxuaW1wb3J0IEF1dG9IaWRlU2Nyb2xsYmFyIGZyb20gJy4vQXV0b0hpZGVTY3JvbGxiYXInO1xuaW1wb3J0IHsgZ2V0SG9tZVBhZ2VVcmwgfSBmcm9tIFwiLi4vLi4vdXRpbHMvcGFnZXNcIjtcbmltcG9ydCB7IF90IH0gZnJvbSBcIi4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IFNka0NvbmZpZyBmcm9tIFwiLi4vLi4vU2RrQ29uZmlnXCI7XG5pbXBvcnQgKiBhcyBzZGsgZnJvbSBcIi4uLy4uL2luZGV4XCI7XG5pbXBvcnQgZGlzIGZyb20gXCIuLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXJcIjtcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi8uLi9kaXNwYXRjaGVyL2FjdGlvbnNcIjtcbmltcG9ydCBCYXNlQXZhdGFyIGZyb20gXCIuLi92aWV3cy9hdmF0YXJzL0Jhc2VBdmF0YXJcIjtcbmltcG9ydCB7IE93blByb2ZpbGVTdG9yZSB9IGZyb20gXCIuLi8uLi9zdG9yZXMvT3duUHJvZmlsZVN0b3JlXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vdmlld3MvZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IHsgVVBEQVRFX0VWRU5UIH0gZnJvbSBcIi4uLy4uL3N0b3Jlcy9Bc3luY1N0b3JlXCI7XG5pbXBvcnQgeyB1c2VFdmVudEVtaXR0ZXIgfSBmcm9tIFwiLi4vLi4vaG9va3MvdXNlRXZlbnRFbWl0dGVyXCI7XG5pbXBvcnQgTWF0cml4Q2xpZW50Q29udGV4dCBmcm9tIFwiLi4vLi4vY29udGV4dHMvTWF0cml4Q2xpZW50Q29udGV4dFwiO1xuaW1wb3J0IE1pbmlBdmF0YXJVcGxvYWRlciwgeyBBVkFUQVJfU0laRSB9IGZyb20gXCIuLi92aWV3cy9lbGVtZW50cy9NaW5pQXZhdGFyVXBsb2FkZXJcIjtcbmltcG9ydCBBbmFseXRpY3MgZnJvbSBcIi4uLy4uL0FuYWx5dGljc1wiO1xuaW1wb3J0IENvdW50bHlBbmFseXRpY3MgZnJvbSBcIi4uLy4uL0NvdW50bHlBbmFseXRpY3NcIjtcblxuY29uc3Qgb25DbGlja1NlbmREbSA9ICgpID0+IHtcbiAgICBBbmFseXRpY3MudHJhY2tFdmVudCgnaG9tZV9wYWdlJywgJ2J1dHRvbicsICdkbScpO1xuICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJob21lX3BhZ2VfYnV0dG9uXCIsIHsgYnV0dG9uOiBcImRtXCIgfSk7XG4gICAgZGlzLmRpc3BhdGNoKHsgYWN0aW9uOiAndmlld19jcmVhdGVfY2hhdCcgfSk7XG59O1xuXG5jb25zdCBvbkNsaWNrRXhwbG9yZSA9ICgpID0+IHtcbiAgICBBbmFseXRpY3MudHJhY2tFdmVudCgnaG9tZV9wYWdlJywgJ2J1dHRvbicsICdyb29tX2RpcmVjdG9yeScpO1xuICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJob21lX3BhZ2VfYnV0dG9uXCIsIHsgYnV0dG9uOiBcInJvb21fZGlyZWN0b3J5XCIgfSk7XG4gICAgZGlzLmZpcmUoQWN0aW9uLlZpZXdSb29tRGlyZWN0b3J5KTtcbn07XG5cbmNvbnN0IG9uQ2xpY2tOZXdSb29tID0gKCkgPT4ge1xuICAgIEFuYWx5dGljcy50cmFja0V2ZW50KCdob21lX3BhZ2UnLCAnYnV0dG9uJywgJ2NyZWF0ZV9yb29tJyk7XG4gICAgQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFjayhcImhvbWVfcGFnZV9idXR0b25cIiwgeyBidXR0b246IFwiY3JlYXRlX3Jvb21cIiB9KTtcbiAgICBkaXMuZGlzcGF0Y2goeyBhY3Rpb246ICd2aWV3X2NyZWF0ZV9yb29tJyB9KTtcbn07XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIGp1c3RSZWdpc3RlcmVkPzogYm9vbGVhbjtcbn1cblxuY29uc3QgZ2V0T3duUHJvZmlsZSA9ICh1c2VySWQ6IHN0cmluZykgPT4gKHtcbiAgICBkaXNwbGF5TmFtZTogT3duUHJvZmlsZVN0b3JlLmluc3RhbmNlLmRpc3BsYXlOYW1lIHx8IHVzZXJJZCxcbiAgICBhdmF0YXJVcmw6IE93blByb2ZpbGVTdG9yZS5pbnN0YW5jZS5nZXRIdHRwQXZhdGFyVXJsKEFWQVRBUl9TSVpFKSxcbn0pO1xuXG5jb25zdCBVc2VyV2VsY29tZVRvcCA9ICgpID0+IHtcbiAgICBjb25zdCBjbGkgPSB1c2VDb250ZXh0KE1hdHJpeENsaWVudENvbnRleHQpO1xuICAgIGNvbnN0IHVzZXJJZCA9IGNsaS5nZXRVc2VySWQoKTtcbiAgICBjb25zdCBbb3duUHJvZmlsZSwgc2V0T3duUHJvZmlsZV0gPSB1c2VTdGF0ZShnZXRPd25Qcm9maWxlKHVzZXJJZCkpO1xuICAgIHVzZUV2ZW50RW1pdHRlcihPd25Qcm9maWxlU3RvcmUuaW5zdGFuY2UsIFVQREFURV9FVkVOVCwgKCkgPT4ge1xuICAgICAgICBzZXRPd25Qcm9maWxlKGdldE93blByb2ZpbGUodXNlcklkKSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gPGRpdj5cbiAgICAgICAgPE1pbmlBdmF0YXJVcGxvYWRlclxuICAgICAgICAgICAgaGFzQXZhdGFyPXshIW93blByb2ZpbGUuYXZhdGFyVXJsfVxuICAgICAgICAgICAgaGFzQXZhdGFyTGFiZWw9e190KFwiR3JlYXQsIHRoYXQnbGwgaGVscCBwZW9wbGUga25vdyBpdCdzIHlvdVwiKX1cbiAgICAgICAgICAgIG5vQXZhdGFyTGFiZWw9e190KFwiQWRkIGEgcGhvdG8gc28gcGVvcGxlIGtub3cgaXQncyB5b3UuXCIpfVxuICAgICAgICAgICAgc2V0QXZhdGFyVXJsPXt1cmwgPT4gY2xpLnNldEF2YXRhclVybCh1cmwpfVxuICAgICAgICA+XG4gICAgICAgICAgICA8QmFzZUF2YXRhclxuICAgICAgICAgICAgICAgIGlkTmFtZT17dXNlcklkfVxuICAgICAgICAgICAgICAgIG5hbWU9e293blByb2ZpbGUuZGlzcGxheU5hbWV9XG4gICAgICAgICAgICAgICAgdXJsPXtvd25Qcm9maWxlLmF2YXRhclVybH1cbiAgICAgICAgICAgICAgICB3aWR0aD17QVZBVEFSX1NJWkV9XG4gICAgICAgICAgICAgICAgaGVpZ2h0PXtBVkFUQVJfU0laRX1cbiAgICAgICAgICAgICAgICByZXNpemVNZXRob2Q9XCJjcm9wXCJcbiAgICAgICAgICAgIC8+XG4gICAgICAgIDwvTWluaUF2YXRhclVwbG9hZGVyPlxuXG4gICAgICAgIDxoMT57IF90KFwiV2VsY29tZSAlKG5hbWUpc1wiLCB7IG5hbWU6IG93blByb2ZpbGUuZGlzcGxheU5hbWUgfSkgfTwvaDE+XG4gICAgICAgIDxoND57IF90KFwiTm93LCBsZXQncyBoZWxwIHlvdSBnZXQgc3RhcnRlZFwiKSB9PC9oND5cbiAgICA8L2Rpdj47XG59O1xuXG5jb25zdCBIb21lUGFnZTogUmVhY3QuRkM8SVByb3BzPiA9ICh7IGp1c3RSZWdpc3RlcmVkID0gZmFsc2UgfSkgPT4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IFNka0NvbmZpZy5nZXQoKTtcbiAgICBjb25zdCBwYWdlVXJsID0gZ2V0SG9tZVBhZ2VVcmwoY29uZmlnKTtcblxuICAgIGlmIChwYWdlVXJsKSB7XG4gICAgICAgIC8vIEZJWE1FOiBVc2luZyBhbiBpbXBvcnQgd2lsbCByZXN1bHQgaW4gd3JlbmNoLWVsZW1lbnQtdGVzdHMgZmFpbHVyZXNcbiAgICAgICAgY29uc3QgRW1iZWRkZWRQYWdlID0gc2RrLmdldENvbXBvbmVudCgnc3RydWN0dXJlcy5FbWJlZGRlZFBhZ2UnKTtcbiAgICAgICAgcmV0dXJuIDxFbWJlZGRlZFBhZ2UgY2xhc3NOYW1lPVwibXhfSG9tZVBhZ2VcIiB1cmw9e3BhZ2VVcmx9IHNjcm9sbGJhcj17dHJ1ZX0gLz47XG4gICAgfVxuXG4gICAgbGV0IGludHJvU2VjdGlvbjtcbiAgICBpZiAoanVzdFJlZ2lzdGVyZWQpIHtcbiAgICAgICAgaW50cm9TZWN0aW9uID0gPFVzZXJXZWxjb21lVG9wIC8+O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGJyYW5kaW5nQ29uZmlnID0gY29uZmlnLmJyYW5kaW5nO1xuICAgICAgICBsZXQgbG9nb1VybCA9IFwidGhlbWVzL2VsZW1lbnQvaW1nL2xvZ29zL2VsZW1lbnQtbG9nby5zdmdcIjtcbiAgICAgICAgaWYgKGJyYW5kaW5nQ29uZmlnICYmIGJyYW5kaW5nQ29uZmlnLmF1dGhIZWFkZXJMb2dvVXJsKSB7XG4gICAgICAgICAgICBsb2dvVXJsID0gYnJhbmRpbmdDb25maWcuYXV0aEhlYWRlckxvZ29Vcmw7XG4gICAgICAgIH1cblxuICAgICAgICBpbnRyb1NlY3Rpb24gPSA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgICA8aW1nIHNyYz17bG9nb1VybH0gYWx0PXtjb25maWcuYnJhbmR9IC8+XG4gICAgICAgICAgICA8aDE+eyBfdChcIldlbGNvbWUgdG8gJShhcHBOYW1lKXNcIiwgeyBhcHBOYW1lOiBjb25maWcuYnJhbmQgfSkgfTwvaDE+XG4gICAgICAgICAgICA8aDQ+eyBfdChcIk93biB5b3VyIGNvbnZlcnNhdGlvbnMuXCIpIH08L2g0PlxuICAgICAgICA8L1JlYWN0LkZyYWdtZW50PjtcbiAgICB9XG5cbiAgICByZXR1cm4gPEF1dG9IaWRlU2Nyb2xsYmFyIGNsYXNzTmFtZT1cIm14X0hvbWVQYWdlIG14X0hvbWVQYWdlX2RlZmF1bHRcIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Ib21lUGFnZV9kZWZhdWx0X3dyYXBwZXJcIj5cbiAgICAgICAgICAgIHsgaW50cm9TZWN0aW9uIH1cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfSG9tZVBhZ2VfZGVmYXVsdF9idXR0b25zXCI+XG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17b25DbGlja1NlbmREbX0gY2xhc3NOYW1lPVwibXhfSG9tZVBhZ2VfYnV0dG9uX3NlbmREbVwiPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiU2VuZCBhIERpcmVjdCBNZXNzYWdlXCIpIH1cbiAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17b25DbGlja0V4cGxvcmV9IGNsYXNzTmFtZT1cIm14X0hvbWVQYWdlX2J1dHRvbl9leHBsb3JlXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJFeHBsb3JlIFB1YmxpYyBSb29tc1wiKSB9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIG9uQ2xpY2s9e29uQ2xpY2tOZXdSb29tfSBjbGFzc05hbWU9XCJteF9Ib21lUGFnZV9idXR0b25fY3JlYXRlR3JvdXBcIj5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcIkNyZWF0ZSBhIEdyb3VwIENoYXRcIikgfVxuICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICA8L0F1dG9IaWRlU2Nyb2xsYmFyPjtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEhvbWVQYWdlO1xuIl19