"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.TabLocation = exports.Tab = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var React = _interopRequireWildcard(require("react"));

var _languageHandler = require("../../languageHandler");

var _AutoHideScrollbar = _interopRequireDefault(require("./AutoHideScrollbar"));

var _replaceableComponent = require("../../utils/replaceableComponent");

var _classnames = _interopRequireDefault(require("classnames"));

var _AccessibleButton = _interopRequireDefault(require("../views/elements/AccessibleButton"));

var _logger = require("matrix-js-sdk/src/logger");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/**
 * Represents a tab for the TabbedView.
 */
class Tab {
  /**
   * Creates a new tab.
   * @param {string} id The tab's ID.
   * @param {string} label The untranslated tab label.
   * @param {string} icon The class for the tab icon. This should be a simple mask.
   * @param {React.ReactNode} body The JSX for the tab container.
   */
  constructor(id, label, icon, body) {
    this.id = id;
    this.label = label;
    this.icon = icon;
    this.body = body;
  }

}

exports.Tab = Tab;
let TabLocation;
exports.TabLocation = TabLocation;

(function (TabLocation) {
  TabLocation["LEFT"] = "left";
  TabLocation["TOP"] = "top";
})(TabLocation || (exports.TabLocation = TabLocation = {}));

let TabbedView = (_dec = (0, _replaceableComponent.replaceableComponent)("structures.TabbedView"), _dec(_class = (_temp = _class2 = class TabbedView extends React.Component {
  constructor(props) {
    super(props);
    let activeTabIndex = 0;

    if (props.initialTabId) {
      const tabIndex = props.tabs.findIndex(t => t.id === props.initialTabId);
      if (tabIndex >= 0) activeTabIndex = tabIndex;
    }

    this.state = {
      activeTabIndex
    };
  }

  getActiveTabIndex() {
    if (!this.state || !this.state.activeTabIndex) return 0;
    return this.state.activeTabIndex;
  }
  /**
   * Shows the given tab
   * @param {Tab} tab the tab to show
   * @private
   */


  setActiveTab(tab) {
    const idx = this.props.tabs.indexOf(tab);

    if (idx !== -1) {
      if (this.props.onChange) this.props.onChange(tab.id);
      this.setState({
        activeTabIndex: idx
      });
    } else {
      _logger.logger.error("Could not find tab " + tab.label + " in tabs");
    }
  }

  renderTabLabel(tab) {
    let classes = "mx_TabbedView_tabLabel ";
    const idx = this.props.tabs.indexOf(tab);
    if (idx === this.getActiveTabIndex()) classes += "mx_TabbedView_tabLabel_active";
    let tabIcon = null;

    if (tab.icon) {
      tabIcon = /*#__PURE__*/React.createElement("span", {
        className: `mx_TabbedView_maskedIcon ${tab.icon}`
      });
    }

    const onClickHandler = () => this.setActiveTab(tab);

    const label = (0, _languageHandler._t)(tab.label);
    return /*#__PURE__*/React.createElement(_AccessibleButton.default, {
      className: classes,
      key: "tab_label_" + tab.label,
      onClick: onClickHandler
    }, tabIcon, /*#__PURE__*/React.createElement("span", {
      className: "mx_TabbedView_tabLabel_text"
    }, label));
  }

  renderTabPanel(tab) {
    return /*#__PURE__*/React.createElement("div", {
      className: "mx_TabbedView_tabPanel",
      key: "mx_tabpanel_" + tab.label
    }, /*#__PURE__*/React.createElement(_AutoHideScrollbar.default, {
      className: "mx_TabbedView_tabPanelContent"
    }, tab.body));
  }

  render() {
    const labels = this.props.tabs.map(tab => this.renderTabLabel(tab));
    const panel = this.renderTabPanel(this.props.tabs[this.getActiveTabIndex()]);
    const tabbedViewClasses = (0, _classnames.default)({
      'mx_TabbedView': true,
      'mx_TabbedView_tabsOnLeft': this.props.tabLocation == TabLocation.LEFT,
      'mx_TabbedView_tabsOnTop': this.props.tabLocation == TabLocation.TOP
    });
    return /*#__PURE__*/React.createElement("div", {
      className: tabbedViewClasses
    }, /*#__PURE__*/React.createElement("div", {
      className: "mx_TabbedView_tabLabels"
    }, labels), panel);
  }

}, (0, _defineProperty2.default)(_class2, "defaultProps", {
  tabLocation: TabLocation.LEFT
}), _temp)) || _class);
exports.default = TabbedView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvVGFiYmVkVmlldy50c3giXSwibmFtZXMiOlsiVGFiIiwiY29uc3RydWN0b3IiLCJpZCIsImxhYmVsIiwiaWNvbiIsImJvZHkiLCJUYWJMb2NhdGlvbiIsIlRhYmJlZFZpZXciLCJSZWFjdCIsIkNvbXBvbmVudCIsInByb3BzIiwiYWN0aXZlVGFiSW5kZXgiLCJpbml0aWFsVGFiSWQiLCJ0YWJJbmRleCIsInRhYnMiLCJmaW5kSW5kZXgiLCJ0Iiwic3RhdGUiLCJnZXRBY3RpdmVUYWJJbmRleCIsInNldEFjdGl2ZVRhYiIsInRhYiIsImlkeCIsImluZGV4T2YiLCJvbkNoYW5nZSIsInNldFN0YXRlIiwibG9nZ2VyIiwiZXJyb3IiLCJyZW5kZXJUYWJMYWJlbCIsImNsYXNzZXMiLCJ0YWJJY29uIiwib25DbGlja0hhbmRsZXIiLCJyZW5kZXJUYWJQYW5lbCIsInJlbmRlciIsImxhYmVscyIsIm1hcCIsInBhbmVsIiwidGFiYmVkVmlld0NsYXNzZXMiLCJ0YWJMb2NhdGlvbiIsIkxFRlQiLCJUT1AiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBa0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNPLE1BQU1BLEdBQU4sQ0FBVTtBQUNiO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLFdBQVcsQ0FBUUMsRUFBUixFQUEyQkMsS0FBM0IsRUFBaURDLElBQWpELEVBQXNFQyxJQUF0RSxFQUE2RjtBQUFBLFNBQXJGSCxFQUFxRixHQUFyRkEsRUFBcUY7QUFBQSxTQUFsRUMsS0FBa0UsR0FBbEVBLEtBQWtFO0FBQUEsU0FBNUNDLElBQTRDLEdBQTVDQSxJQUE0QztBQUFBLFNBQXZCQyxJQUF1QixHQUF2QkEsSUFBdUI7QUFDdkc7O0FBVFk7OztJQVlMQyxXOzs7V0FBQUEsVztBQUFBQSxFQUFBQSxXO0FBQUFB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aUIsR0FBRyxDQUFDZixJQURWLENBREosQ0FESjtBQU9IOztBQUVNMkIsRUFBQUEsTUFBTSxHQUFvQjtBQUM3QixVQUFNQyxNQUFNLEdBQUcsS0FBS3ZCLEtBQUwsQ0FBV0ksSUFBWCxDQUFnQm9CLEdBQWhCLENBQW9CZCxHQUFHLElBQUksS0FBS08sY0FBTCxDQUFvQlAsR0FBcEIsQ0FBM0IsQ0FBZjtBQUNBLFVBQU1lLEtBQUssR0FBRyxLQUFLSixjQUFMLENBQW9CLEtBQUtyQixLQUFMLENBQVdJLElBQVgsQ0FBZ0IsS0FBS0ksaUJBQUwsRUFBaEIsQ0FBcEIsQ0FBZDtBQUVBLFVBQU1rQixpQkFBaUIsR0FBRyx5QkFBVztBQUNqQyx1QkFBaUIsSUFEZ0I7QUFFakMsa0NBQTRCLEtBQUsxQixLQUFMLENBQVcyQixXQUFYLElBQTBCL0IsV0FBVyxDQUFDZ0MsSUFGakM7QUFHakMsaUNBQTJCLEtBQUs1QixLQUFMLENBQVcyQixXQUFYLElBQTBCL0IsV0FBVyxDQUFDaUM7QUFIaEMsS0FBWCxDQUExQjtBQU1BLHdCQUNJO0FBQUssTUFBQSxTQUFTLEVBQUVIO0FBQWhCLG9CQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNNSCxNQUROLENBREosRUFJTUUsS0FKTixDQURKO0FBUUg7O0FBM0ZtRSxDLHlEQWU5QztBQUNsQkUsRUFBQUEsV0FBVyxFQUFFL0IsV0FBVyxDQUFDZ0M7QUFEUCxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE3IFRyYXZpcyBSYWxzdG9uXG5Db3B5cmlnaHQgMjAxOSBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTksIDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBBdXRvSGlkZVNjcm9sbGJhciBmcm9tICcuL0F1dG9IaWRlU2Nyb2xsYmFyJztcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uL3ZpZXdzL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgYSB0YWIgZm9yIHRoZSBUYWJiZWRWaWV3LlxuICovXG5leHBvcnQgY2xhc3MgVGFiIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRhYi5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaWQgVGhlIHRhYidzIElELlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBsYWJlbCBUaGUgdW50cmFuc2xhdGVkIHRhYiBsYWJlbC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaWNvbiBUaGUgY2xhc3MgZm9yIHRoZSB0YWIgaWNvbi4gVGhpcyBzaG91bGQgYmUgYSBzaW1wbGUgbWFzay5cbiAgICAgKiBAcGFyYW0ge1JlYWN0LlJlYWN0Tm9kZX0gYm9keSBUaGUgSlNYIGZvciB0aGUgdGFiIGNvbnRhaW5lci5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgaWQ6IHN0cmluZywgcHVibGljIGxhYmVsOiBzdHJpbmcsIHB1YmxpYyBpY29uOiBzdHJpbmcsIHB1YmxpYyBib2R5OiBSZWFjdC5SZWFjdE5vZGUpIHtcbiAgICB9XG59XG5cbmV4cG9ydCBlbnVtIFRhYkxvY2F0aW9uIHtcbiAgICBMRUZUID0gJ2xlZnQnLFxuICAgIFRPUCA9ICd0b3AnLFxufVxuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICB0YWJzOiBUYWJbXTtcbiAgICBpbml0aWFsVGFiSWQ/OiBzdHJpbmc7XG4gICAgdGFiTG9jYXRpb246IFRhYkxvY2F0aW9uO1xuICAgIG9uQ2hhbmdlPzogKHRhYklkOiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIGFjdGl2ZVRhYkluZGV4OiBudW1iZXI7XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInN0cnVjdHVyZXMuVGFiYmVkVmlld1wiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGFiYmVkVmlldyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIGxldCBhY3RpdmVUYWJJbmRleCA9IDA7XG4gICAgICAgIGlmIChwcm9wcy5pbml0aWFsVGFiSWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhYkluZGV4ID0gcHJvcHMudGFicy5maW5kSW5kZXgodCA9PiB0LmlkID09PSBwcm9wcy5pbml0aWFsVGFiSWQpO1xuICAgICAgICAgICAgaWYgKHRhYkluZGV4ID49IDApIGFjdGl2ZVRhYkluZGV4ID0gdGFiSW5kZXg7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgYWN0aXZlVGFiSW5kZXgsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICAgICAgdGFiTG9jYXRpb246IFRhYkxvY2F0aW9uLkxFRlQsXG4gICAgfTtcblxuICAgIHByaXZhdGUgZ2V0QWN0aXZlVGFiSW5kZXgoKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZSB8fCAhdGhpcy5zdGF0ZS5hY3RpdmVUYWJJbmRleCkgcmV0dXJuIDA7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmFjdGl2ZVRhYkluZGV4O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3dzIHRoZSBnaXZlbiB0YWJcbiAgICAgKiBAcGFyYW0ge1RhYn0gdGFiIHRoZSB0YWIgdG8gc2hvd1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzZXRBY3RpdmVUYWIodGFiOiBUYWIpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5wcm9wcy50YWJzLmluZGV4T2YodGFiKTtcbiAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3BzLm9uQ2hhbmdlKSB0aGlzLnByb3BzLm9uQ2hhbmdlKHRhYi5pZCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgYWN0aXZlVGFiSW5kZXg6IGlkeCB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcIkNvdWxkIG5vdCBmaW5kIHRhYiBcIiArIHRhYi5sYWJlbCArIFwiIGluIHRhYnNcIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclRhYkxhYmVsKHRhYjogVGFiKSB7XG4gICAgICAgIGxldCBjbGFzc2VzID0gXCJteF9UYWJiZWRWaWV3X3RhYkxhYmVsIFwiO1xuXG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMucHJvcHMudGFicy5pbmRleE9mKHRhYik7XG4gICAgICAgIGlmIChpZHggPT09IHRoaXMuZ2V0QWN0aXZlVGFiSW5kZXgoKSkgY2xhc3NlcyArPSBcIm14X1RhYmJlZFZpZXdfdGFiTGFiZWxfYWN0aXZlXCI7XG5cbiAgICAgICAgbGV0IHRhYkljb24gPSBudWxsO1xuICAgICAgICBpZiAodGFiLmljb24pIHtcbiAgICAgICAgICAgIHRhYkljb24gPSA8c3BhbiBjbGFzc05hbWU9e2BteF9UYWJiZWRWaWV3X21hc2tlZEljb24gJHt0YWIuaWNvbn1gfSAvPjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9uQ2xpY2tIYW5kbGVyID0gKCkgPT4gdGhpcy5zZXRBY3RpdmVUYWIodGFiKTtcblxuICAgICAgICBjb25zdCBsYWJlbCA9IF90KHRhYi5sYWJlbCk7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9e2NsYXNzZXN9IGtleT17XCJ0YWJfbGFiZWxfXCIgKyB0YWIubGFiZWx9IG9uQ2xpY2s9e29uQ2xpY2tIYW5kbGVyfT5cbiAgICAgICAgICAgICAgICB7IHRhYkljb24gfVxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1RhYmJlZFZpZXdfdGFiTGFiZWxfdGV4dFwiPlxuICAgICAgICAgICAgICAgICAgICB7IGxhYmVsIH1cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJUYWJQYW5lbCh0YWI6IFRhYik6IFJlYWN0LlJlYWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1RhYmJlZFZpZXdfdGFiUGFuZWxcIiBrZXk9e1wibXhfdGFicGFuZWxfXCIgKyB0YWIubGFiZWx9PlxuICAgICAgICAgICAgICAgIDxBdXRvSGlkZVNjcm9sbGJhciBjbGFzc05hbWU9J214X1RhYmJlZFZpZXdfdGFiUGFuZWxDb250ZW50Jz5cbiAgICAgICAgICAgICAgICAgICAgeyB0YWIuYm9keSB9XG4gICAgICAgICAgICAgICAgPC9BdXRvSGlkZVNjcm9sbGJhcj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKTogUmVhY3QuUmVhY3ROb2RlIHtcbiAgICAgICAgY29uc3QgbGFiZWxzID0gdGhpcy5wcm9wcy50YWJzLm1hcCh0YWIgPT4gdGhpcy5yZW5kZXJUYWJMYWJlbCh0YWIpKTtcbiAgICAgICAgY29uc3QgcGFuZWwgPSB0aGlzLnJlbmRlclRhYlBhbmVsKHRoaXMucHJvcHMudGFic1t0aGlzLmdldEFjdGl2ZVRhYkluZGV4KCldKTtcblxuICAgICAgICBjb25zdCB0YWJiZWRWaWV3Q2xhc3NlcyA9IGNsYXNzTmFtZXMoe1xuICAgICAgICAgICAgJ214X1RhYmJlZFZpZXcnOiB0cnVlLFxuICAgICAgICAgICAgJ214X1RhYmJlZFZpZXdfdGFic09uTGVmdCc6IHRoaXMucHJvcHMudGFiTG9jYXRpb24gPT0gVGFiTG9jYXRpb24uTEVGVCxcbiAgICAgICAgICAgICdteF9UYWJiZWRWaWV3X3RhYnNPblRvcCc6IHRoaXMucHJvcHMudGFiTG9jYXRpb24gPT0gVGFiTG9jYXRpb24uVE9QLFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3RhYmJlZFZpZXdDbGFzc2VzfT5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1RhYmJlZFZpZXdfdGFiTGFiZWxzXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgbGFiZWxzIH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICB7IHBhbmVsIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==