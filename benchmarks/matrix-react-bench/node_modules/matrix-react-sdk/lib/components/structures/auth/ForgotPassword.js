"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../languageHandler");

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _PasswordReset = _interopRequireDefault(require("../../../PasswordReset"));

var _AutoDiscoveryUtils = _interopRequireDefault(require("../../../utils/AutoDiscoveryUtils"));

var _classnames = _interopRequireDefault(require("classnames"));

var _AuthPage = _interopRequireDefault(require("../../views/auth/AuthPage"));

var _CountlyAnalytics = _interopRequireDefault(require("../../../CountlyAnalytics"));

var _ServerPicker = _interopRequireDefault(require("../../views/elements/ServerPicker"));

var _EmailField = _interopRequireDefault(require("../../views/auth/EmailField"));

var _PassphraseField = _interopRequireDefault(require("../../views/auth/PassphraseField"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _RegistrationForm = require("../../views/auth/RegistrationForm");

var _InlineSpinner = _interopRequireDefault(require("../../views/elements/InlineSpinner"));

var _logger = require("matrix-js-sdk/src/logger");

var _Spinner = _interopRequireDefault(require("../../views/elements/Spinner"));

var _QuestionDialog = _interopRequireDefault(require("../../views/dialogs/QuestionDialog"));

var _ErrorDialog = _interopRequireDefault(require("../../views/dialogs/ErrorDialog"));

var _AuthHeader = _interopRequireDefault(require("../../views/auth/AuthHeader"));

var _AuthBody = _interopRequireDefault(require("../../views/auth/AuthBody"));

var _PassphraseConfirmField = _interopRequireDefault(require("../../views/auth/PassphraseConfirmField"));

var _dec, _class;

var Phase;

(function (Phase) {
  Phase[Phase["Forgot"] = 1] = "Forgot";
  Phase[Phase["SendingEmail"] = 2] = "SendingEmail";
  Phase[Phase["EmailSent"] = 3] = "EmailSent";
  Phase[Phase["Done"] = 4] = "Done";
})(Phase || (Phase = {}));

var ForgotPasswordField;

(function (ForgotPasswordField) {
  ForgotPasswordField["Email"] = "field_email";
  ForgotPasswordField["Password"] = "field_password";
  ForgotPasswordField["PasswordConfirm"] = "field_password_confirm";
})(ForgotPasswordField || (ForgotPasswordField = {}));

let ForgotPassword = (_dec = (0, _replaceableComponent.replaceableComponent)("structures.auth.ForgotPassword"), _dec(_class = class ForgotPassword extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "reset", void 0);
    (0, _defineProperty2.default)(this, "state", {
      phase: Phase.Forgot,
      email: "",
      password: "",
      password2: "",
      errorText: null,
      // We perform liveliness checks later, but for now suppress the errors.
      // We also track the server dead errors independently of the regular errors so
      // that we can render it differently, and override any other error the user may
      // be seeing.
      serverIsAlive: true,
      serverErrorIsFatal: false,
      serverDeadError: ""
    });
    (0, _defineProperty2.default)(this, "onVerify", async ev => {
      ev.preventDefault();

      if (!this.reset) {
        _logger.logger.error("onVerify called before submitPasswordReset!");

        return;
      }

      if (this.state.currentHttpRequest) return;

      try {
        await this.handleHttpRequest(this.reset.checkEmailLinkClicked());
        this.setState({
          phase: Phase.Done
        });
      } catch (err) {
        this.showErrorDialog(err.message);
      }
    });
    (0, _defineProperty2.default)(this, "onSubmitForm", async ev => {
      ev.preventDefault();
      if (this.state.currentHttpRequest) return; // refresh the server errors, just in case the server came back online

      await this.handleHttpRequest(this.checkServerLiveliness(this.props.serverConfig));
      const allFieldsValid = await this.verifyFieldsBeforeSubmit();

      if (!allFieldsValid) {
        return;
      }

      _Modal.default.createTrackedDialog('Forgot Password Warning', '', _QuestionDialog.default, {
        title: (0, _languageHandler._t)('Warning!'),
        description: /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Changing your password will reset any end-to-end encryption keys " + "on all of your sessions, making encrypted chat history unreadable. Set up " + "Key Backup or export your room keys from another session before resetting your " + "password.")),
        button: (0, _languageHandler._t)('Continue'),
        onFinished: confirmed => {
          if (confirmed) {
            this.submitPasswordReset(this.state.email, this.state.password);
          }
        }
      });
    });
    (0, _defineProperty2.default)(this, "onInputChanged", (stateKey, ev) => {
      this.setState({
        [stateKey]: ev.currentTarget.value
      });
    });
    (0, _defineProperty2.default)(this, "onLoginClick", ev => {
      ev.preventDefault();
      ev.stopPropagation();
      this.props.onLoginClick();
    });

    _CountlyAnalytics.default.instance.track("onboarding_forgot_password_begin");
  }

  componentDidMount() {
    this.reset = null;
    this.checkServerLiveliness(this.props.serverConfig);
  } // TODO: [REACT-WARNING] Replace with appropriate lifecycle event
  // eslint-disable-next-line


  UNSAFE_componentWillReceiveProps(newProps) {
    if (newProps.serverConfig.hsUrl === this.props.serverConfig.hsUrl && newProps.serverConfig.isUrl === this.props.serverConfig.isUrl) return; // Do a liveliness check on the new URLs

    this.checkServerLiveliness(newProps.serverConfig);
  }

  async checkServerLiveliness(serverConfig) {
    try {
      await _AutoDiscoveryUtils.default.validateServerConfigWithStaticUrls(serverConfig.hsUrl, serverConfig.isUrl);
      this.setState({
        serverIsAlive: true
      });
    } catch (e) {
      this.setState(_AutoDiscoveryUtils.default.authComponentStateForError(e, "forgot_password"));
    }
  }

  submitPasswordReset(email, password) {
    this.setState({
      phase: Phase.SendingEmail
    });
    this.reset = new _PasswordReset.default(this.props.serverConfig.hsUrl, this.props.serverConfig.isUrl);
    this.reset.resetPassword(email, password).then(() => {
      this.setState({
        phase: Phase.EmailSent
      });
    }, err => {
      this.showErrorDialog((0, _languageHandler._t)('Failed to send email') + ": " + err.message);
      this.setState({
        phase: Phase.Forgot
      });
    });
  }

  async verifyFieldsBeforeSubmit() {
    const fieldIdsInDisplayOrder = [ForgotPasswordField.Email, ForgotPasswordField.Password, ForgotPasswordField.PasswordConfirm];
    const invalidFields = [];

    for (const fieldId of fieldIdsInDisplayOrder) {
      const valid = await this[fieldId].validate({
        allowEmpty: false
      });

      if (!valid) {
        invalidFields.push(this[fieldId]);
      }
    }

    if (invalidFields.length === 0) {
      return true;
    } // Focus on the first invalid field, then re-validate,
    // which will result in the error tooltip being displayed for that field.


    invalidFields[0].focus();
    invalidFields[0].validate({
      allowEmpty: false,
      focused: true
    });
    return false;
  }

  showErrorDialog(description, title) {
    _Modal.default.createTrackedDialog('Forgot Password Error', '', _ErrorDialog.default, {
      title,
      description
    });
  }

  handleHttpRequest(request) {
    this.setState({
      currentHttpRequest: request
    });
    return request.finally(() => {
      this.setState({
        currentHttpRequest: undefined
      });
    });
  }

  renderForgot() {
    let errorText = null;
    const err = this.state.errorText;

    if (err) {
      errorText = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_Login_error"
      }, err);
    }

    let serverDeadSection;

    if (!this.state.serverIsAlive) {
      const classes = (0, _classnames.default)({
        "mx_Login_error": true,
        "mx_Login_serverError": true,
        "mx_Login_serverErrorNonFatal": !this.state.serverErrorIsFatal
      });
      serverDeadSection = /*#__PURE__*/_react.default.createElement("div", {
        className: classes
      }, this.state.serverDeadError);
    }

    return /*#__PURE__*/_react.default.createElement("div", null, errorText, serverDeadSection, /*#__PURE__*/_react.default.createElement(_ServerPicker.default, {
      serverConfig: this.props.serverConfig,
      onServerConfigChange: this.props.onServerConfigChange
    }), /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onSubmitForm
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AuthBody_fieldRow"
    }, /*#__PURE__*/_react.default.createElement(_EmailField.default, {
      name: "reset_email" // define a name so browser's password autofill gets less confused
      ,
      labelRequired: (0, _languageHandler._t)('The email address linked to your account must be entered.'),
      labelInvalid: (0, _languageHandler._t)("The email address doesn't appear to be valid."),
      value: this.state.email,
      fieldRef: field => this[ForgotPasswordField.Email] = field,
      autoFocus: true,
      onChange: this.onInputChanged.bind(this, "email"),
      onFocus: () => _CountlyAnalytics.default.instance.track("onboarding_forgot_password_email_focus"),
      onBlur: () => _CountlyAnalytics.default.instance.track("onboarding_forgot_password_email_blur")
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_AuthBody_fieldRow"
    }, /*#__PURE__*/_react.default.createElement(_PassphraseField.default, {
      name: "reset_password",
      type: "password",
      label: (0, _languageHandler._td)('New Password'),
      value: this.state.password,
      minScore: _RegistrationForm.PASSWORD_MIN_SCORE,
      fieldRef: field => this[ForgotPasswordField.Password] = field,
      onChange: this.onInputChanged.bind(this, "password"),
      onFocus: () => _CountlyAnalytics.default.instance.track("onboarding_forgot_password_newPassword_focus"),
      onBlur: () => _CountlyAnalytics.default.instance.track("onboarding_forgot_password_newPassword_blur"),
      autoComplete: "new-password"
    }), /*#__PURE__*/_react.default.createElement(_PassphraseConfirmField.default, {
      name: "reset_password_confirm",
      label: (0, _languageHandler._t)('Confirm'),
      labelRequired: (0, _languageHandler._t)("A new password must be entered."),
      labelInvalid: (0, _languageHandler._t)("New passwords must match each other."),
      value: this.state.password2,
      password: this.state.password,
      fieldRef: field => this[ForgotPasswordField.PasswordConfirm] = field,
      onChange: this.onInputChanged.bind(this, "password2"),
      onFocus: () => _CountlyAnalytics.default.instance.track("onboarding_forgot_password_newPassword2_focus"),
      onBlur: () => _CountlyAnalytics.default.instance.track("onboarding_forgot_password_newPassword2_blur"),
      autoComplete: "new-password"
    })), /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)('A verification email will be sent to your inbox to confirm ' + 'setting your new password.')), /*#__PURE__*/_react.default.createElement("input", {
      className: "mx_Login_submit",
      type: "submit",
      value: (0, _languageHandler._t)('Send Reset Email')
    })), /*#__PURE__*/_react.default.createElement("a", {
      className: "mx_AuthBody_changeFlow",
      onClick: this.onLoginClick,
      href: "#"
    }, (0, _languageHandler._t)('Sign in instead')));
  }

  renderSendingEmail() {
    return /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
  }

  renderEmailSent() {
    return /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("An email has been sent to %(emailAddress)s. Once you've followed the " + "link it contains, click below.", {
      emailAddress: this.state.email
    }), /*#__PURE__*/_react.default.createElement("br", null), /*#__PURE__*/_react.default.createElement("input", {
      className: "mx_Login_submit",
      type: "button",
      onClick: this.onVerify,
      value: (0, _languageHandler._t)('I have verified my email address')
    }), this.state.currentHttpRequest && /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Login_spinner"
    }, /*#__PURE__*/_react.default.createElement(_InlineSpinner.default, {
      w: 64,
      h: 64
    })));
  }

  renderDone() {
    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Your password has been reset.")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You have been logged out of all sessions and will no longer receive " + "push notifications. To re-enable notifications, sign in again on each " + "device.")), /*#__PURE__*/_react.default.createElement("input", {
      className: "mx_Login_submit",
      type: "button",
      onClick: this.props.onComplete,
      value: (0, _languageHandler._t)('Return to login screen')
    }));
  }

  render() {
    let resetPasswordJsx;

    switch (this.state.phase) {
      case Phase.Forgot:
        resetPasswordJsx = this.renderForgot();
        break;

      case Phase.SendingEmail:
        resetPasswordJsx = this.renderSendingEmail();
        break;

      case Phase.EmailSent:
        resetPasswordJsx = this.renderEmailSent();
        break;

      case Phase.Done:
        resetPasswordJsx = this.renderDone();
        break;

      default:
        resetPasswordJsx = /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_Login_spinner"
        }, /*#__PURE__*/_react.default.createElement(_InlineSpinner.default, {
          w: 64,
          h: 64
        }));
    }

    return /*#__PURE__*/_react.default.createElement(_AuthPage.default, null, /*#__PURE__*/_react.default.createElement(_AuthHeader.default, null), /*#__PURE__*/_react.default.createElement(_AuthBody.default, null, /*#__PURE__*/_react.default.createElement("h2", null, " ", (0, _languageHandler._t)('Set a new password'), " "), resetPasswordJsx));
  }

}) || _class);
exports.default = ForgotPassword;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvYXV0aC9Gb3Jnb3RQYXNzd29yZC50c3giXSwibmFtZXMiOlsiUGhhc2UiLCJGb3Jnb3RQYXNzd29yZEZpZWxkIiwiRm9yZ290UGFzc3dvcmQiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJwaGFzZSIsIkZvcmdvdCIsImVtYWlsIiwicGFzc3dvcmQiLCJwYXNzd29yZDIiLCJlcnJvclRleHQiLCJzZXJ2ZXJJc0FsaXZlIiwic2VydmVyRXJyb3JJc0ZhdGFsIiwic2VydmVyRGVhZEVycm9yIiwiZXYiLCJwcmV2ZW50RGVmYXVsdCIsInJlc2V0IiwibG9nZ2VyIiwiZXJyb3IiLCJzdGF0ZSIsImN1cnJlbnRIdHRwUmVxdWVzdCIsImhhbmRsZUh0dHBSZXF1ZXN0IiwiY2hlY2tFbWFpbExpbmtDbGlja2VkIiwic2V0U3RhdGUiLCJEb25lIiwiZXJyIiwic2hvd0Vycm9yRGlhbG9nIiwibWVzc2FnZSIsImNoZWNrU2VydmVyTGl2ZWxpbmVzcyIsInNlcnZlckNvbmZpZyIsImFsbEZpZWxkc1ZhbGlkIiwidmVyaWZ5RmllbGRzQmVmb3JlU3VibWl0IiwiTW9kYWwiLCJjcmVhdGVUcmFja2VkRGlhbG9nIiwiUXVlc3Rpb25EaWFsb2ciLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiYnV0dG9uIiwib25GaW5pc2hlZCIsImNvbmZpcm1lZCIsInN1Ym1pdFBhc3N3b3JkUmVzZXQiLCJzdGF0ZUtleSIsImN1cnJlbnRUYXJnZXQiLCJ2YWx1ZSIsInN0b3BQcm9wYWdhdGlvbiIsIm9uTG9naW5DbGljayIsIkNvdW50bHlBbmFseXRpY3MiLCJpbnN0YW5jZSIsInRyYWNrIiwiY29tcG9uZW50RGlkTW91bnQiLCJVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsIm5ld1Byb3BzIiwiaHNVcmwiLCJpc1VybCIsIkF1dG9EaXNjb3ZlcnlVdGlscyIsInZhbGlkYXRlU2VydmVyQ29uZmlnV2l0aFN0YXRpY1VybHMiLCJlIiwiYXV0aENvbXBvbmVudFN0YXRlRm9yRXJyb3IiLCJTZW5kaW5nRW1haWwiLCJQYXNzd29yZFJlc2V0IiwicmVzZXRQYXNzd29yZCIsInRoZW4iLCJFbWFpbFNlbnQiLCJmaWVsZElkc0luRGlzcGxheU9yZGVyIiwiRW1haWwiLCJQYXNzd29yZCIsIlBhc3N3b3JkQ29uZmlybSIsImludmFsaWRGaWVsZHMiLCJmaWVsZElkIiwidmFsaWQiLCJ2YWxpZGF0ZSIsImFsbG93RW1wdHkiLCJwdXNoIiwibGVuZ3RoIiwiZm9jdXMiLCJmb2N1c2VkIiwiRXJyb3JEaWFsb2ciLCJyZXF1ZXN0IiwiZmluYWxseSIsInVuZGVmaW5lZCIsInJlbmRlckZvcmdvdCIsInNlcnZlckRlYWRTZWN0aW9uIiwiY2xhc3NlcyIsIm9uU2VydmVyQ29uZmlnQ2hhbmdlIiwib25TdWJtaXRGb3JtIiwiZmllbGQiLCJvbklucHV0Q2hhbmdlZCIsImJpbmQiLCJQQVNTV09SRF9NSU5fU0NPUkUiLCJyZW5kZXJTZW5kaW5nRW1haWwiLCJyZW5kZXJFbWFpbFNlbnQiLCJlbWFpbEFkZHJlc3MiLCJvblZlcmlmeSIsInJlbmRlckRvbmUiLCJvbkNvbXBsZXRlIiwicmVuZGVyIiwicmVzZXRQYXNzd29yZEpzeCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFrQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7SUFFS0EsSzs7V0FBQUEsSztBQUFBQSxFQUFBQSxLLENBQUFBLEs7QUFBQUEsRUFBQUEsSyxDQUFBQSxLO0FBQUFBLEVBQUFBLEssQ0FBQUEsSztBQUFBQSxFQUFBQSxLLENBQUFBLEs7R0FBQUEsSyxLQUFBQSxLOztJQW9DQUMsbUI7O1dBQUFBLG1CO0FBQUFBLEVBQUFBLG1CO0FBQUFBLEVB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c291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE1LCAyMDE2IE9wZW5NYXJrZXQgTHRkXG5Db3B5cmlnaHQgMjAxNywgMjAxOCwgMjAxOSBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTkgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgX3QsIF90ZCB9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQgTW9kYWwgZnJvbSBcIi4uLy4uLy4uL01vZGFsXCI7XG5pbXBvcnQgUGFzc3dvcmRSZXNldCBmcm9tIFwiLi4vLi4vLi4vUGFzc3dvcmRSZXNldFwiO1xuaW1wb3J0IEF1dG9EaXNjb3ZlcnlVdGlscywgeyBWYWxpZGF0ZWRTZXJ2ZXJDb25maWcgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvQXV0b0Rpc2NvdmVyeVV0aWxzXCI7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBBdXRoUGFnZSBmcm9tIFwiLi4vLi4vdmlld3MvYXV0aC9BdXRoUGFnZVwiO1xuaW1wb3J0IENvdW50bHlBbmFseXRpY3MgZnJvbSBcIi4uLy4uLy4uL0NvdW50bHlBbmFseXRpY3NcIjtcbmltcG9ydCBTZXJ2ZXJQaWNrZXIgZnJvbSBcIi4uLy4uL3ZpZXdzL2VsZW1lbnRzL1NlcnZlclBpY2tlclwiO1xuaW1wb3J0IEVtYWlsRmllbGQgZnJvbSBcIi4uLy4uL3ZpZXdzL2F1dGgvRW1haWxGaWVsZFwiO1xuaW1wb3J0IFBhc3NwaHJhc2VGaWVsZCBmcm9tICcuLi8uLi92aWV3cy9hdXRoL1Bhc3NwaHJhc2VGaWVsZCc7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IHsgUEFTU1dPUkRfTUlOX1NDT1JFIH0gZnJvbSAnLi4vLi4vdmlld3MvYXV0aC9SZWdpc3RyYXRpb25Gb3JtJztcbmltcG9ydCBJbmxpbmVTcGlubmVyIGZyb20gJy4uLy4uL3ZpZXdzL2VsZW1lbnRzL0lubGluZVNwaW5uZXInO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuaW1wb3J0IFNwaW5uZXIgZnJvbSBcIi4uLy4uL3ZpZXdzL2VsZW1lbnRzL1NwaW5uZXJcIjtcbmltcG9ydCBRdWVzdGlvbkRpYWxvZyBmcm9tIFwiLi4vLi4vdmlld3MvZGlhbG9ncy9RdWVzdGlvbkRpYWxvZ1wiO1xuaW1wb3J0IEVycm9yRGlhbG9nIGZyb20gXCIuLi8uLi92aWV3cy9kaWFsb2dzL0Vycm9yRGlhbG9nXCI7XG5pbXBvcnQgQXV0aEhlYWRlciBmcm9tIFwiLi4vLi4vdmlld3MvYXV0aC9BdXRoSGVhZGVyXCI7XG5pbXBvcnQgQXV0aEJvZHkgZnJvbSBcIi4uLy4uL3ZpZXdzL2F1dGgvQXV0aEJvZHlcIjtcbmltcG9ydCBQYXNzcGhyYXNlQ29uZmlybUZpZWxkIGZyb20gXCIuLi8uLi92aWV3cy9hdXRoL1Bhc3NwaHJhc2VDb25maXJtRmllbGRcIjtcblxuZW51bSBQaGFzZSB7XG4gICAgLy8gU2hvdyB0aGUgZm9yZ290IHBhc3N3b3JkIGlucHV0c1xuICAgIEZvcmdvdCA9IDEsXG4gICAgLy8gRW1haWwgaXMgaW4gdGhlIHByb2Nlc3Mgb2YgYmVpbmcgc2VudFxuICAgIFNlbmRpbmdFbWFpbCA9IDIsXG4gICAgLy8gRW1haWwgaGFzIGJlZW4gc2VudFxuICAgIEVtYWlsU2VudCA9IDMsXG4gICAgLy8gVXNlciBoYXMgY2xpY2tlZCB0aGUgbGluayBpbiBlbWFpbCBhbmQgY29tcGxldGVkIHJlc2V0XG4gICAgRG9uZSA9IDQsXG59XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHNlcnZlckNvbmZpZzogVmFsaWRhdGVkU2VydmVyQ29uZmlnO1xuICAgIG9uU2VydmVyQ29uZmlnQ2hhbmdlOiAoc2VydmVyQ29uZmlnOiBWYWxpZGF0ZWRTZXJ2ZXJDb25maWcpID0+IHZvaWQ7XG4gICAgb25Mb2dpbkNsaWNrPzogKCkgPT4gdm9pZDtcbiAgICBvbkNvbXBsZXRlOiAoKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBwaGFzZTogUGhhc2U7XG4gICAgZW1haWw6IHN0cmluZztcbiAgICBwYXNzd29yZDogc3RyaW5nO1xuICAgIHBhc3N3b3JkMjogc3RyaW5nO1xuICAgIGVycm9yVGV4dDogc3RyaW5nO1xuXG4gICAgLy8gV2UgcGVyZm9ybSBsaXZlbGluZXNzIGNoZWNrcyBsYXRlciwgYnV0IGZvciBub3cgc3VwcHJlc3MgdGhlIGVycm9ycy5cbiAgICAvLyBXZSBhbHNvIHRyYWNrIHRoZSBzZXJ2ZXIgZGVhZCBlcnJvcnMgaW5kZXBlbmRlbnRseSBvZiB0aGUgcmVndWxhciBlcnJvcnMgc29cbiAgICAvLyB0aGF0IHdlIGNhbiByZW5kZXIgaXQgZGlmZmVyZW50bHksIGFuZCBvdmVycmlkZSBhbnkgb3RoZXIgZXJyb3IgdGhlIHVzZXIgbWF5XG4gICAgLy8gYmUgc2VlaW5nLlxuICAgIHNlcnZlcklzQWxpdmU6IGJvb2xlYW47XG4gICAgc2VydmVyRXJyb3JJc0ZhdGFsOiBib29sZWFuO1xuICAgIHNlcnZlckRlYWRFcnJvcjogc3RyaW5nO1xuXG4gICAgY3VycmVudEh0dHBSZXF1ZXN0PzogUHJvbWlzZTxhbnk+O1xufVxuXG5lbnVtIEZvcmdvdFBhc3N3b3JkRmllbGQge1xuICAgIEVtYWlsID0gJ2ZpZWxkX2VtYWlsJyxcbiAgICBQYXNzd29yZCA9ICdmaWVsZF9wYXNzd29yZCcsXG4gICAgUGFzc3dvcmRDb25maXJtID0gJ2ZpZWxkX3Bhc3N3b3JkX2NvbmZpcm0nLFxufVxuXG5AcmVwbGFjZWFibGVDb21wb25lbnQoXCJzdHJ1Y3R1cmVzLmF1dGguRm9yZ290UGFzc3dvcmRcIilcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcmdvdFBhc3N3b3JkIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgcHJpdmF0ZSByZXNldDogUGFzc3dvcmRSZXNldDtcblxuICAgIHN0YXRlOiBJU3RhdGUgPSB7XG4gICAgICAgIHBoYXNlOiBQaGFzZS5Gb3Jnb3QsXG4gICAgICAgIGVtYWlsOiBcIlwiLFxuICAgICAgICBwYXNzd29yZDogXCJcIixcbiAgICAgICAgcGFzc3dvcmQyOiBcIlwiLFxuICAgICAgICBlcnJvclRleHQ6IG51bGwsXG5cbiAgICAgICAgLy8gV2UgcGVyZm9ybSBsaXZlbGluZXNzIGNoZWNrcyBsYXRlciwgYnV0IGZvciBub3cgc3VwcHJlc3MgdGhlIGVycm9ycy5cbiAgICAgICAgLy8gV2UgYWxzbyB0cmFjayB0aGUgc2VydmVyIGRlYWQgZXJyb3JzIGluZGVwZW5kZW50bHkgb2YgdGhlIHJlZ3VsYXIgZXJyb3JzIHNvXG4gICAgICAgIC8vIHRoYXQgd2UgY2FuIHJlbmRlciBpdCBkaWZmZXJlbnRseSwgYW5kIG92ZXJyaWRlIGFueSBvdGhlciBlcnJvciB0aGUgdXNlciBtYXlcbiAgICAgICAgLy8gYmUgc2VlaW5nLlxuICAgICAgICBzZXJ2ZXJJc0FsaXZlOiB0cnVlLFxuICAgICAgICBzZXJ2ZXJFcnJvcklzRmF0YWw6IGZhbHNlLFxuICAgICAgICBzZXJ2ZXJEZWFkRXJyb3I6IFwiXCIsXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX2ZvcmdvdF9wYXNzd29yZF9iZWdpblwiKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHRoaXMucmVzZXQgPSBudWxsO1xuICAgICAgICB0aGlzLmNoZWNrU2VydmVyTGl2ZWxpbmVzcyh0aGlzLnByb3BzLnNlcnZlckNvbmZpZyk7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogW1JFQUNULVdBUk5JTkddIFJlcGxhY2Ugd2l0aCBhcHByb3ByaWF0ZSBsaWZlY3ljbGUgZXZlbnRcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICBwdWJsaWMgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV3UHJvcHM6IElQcm9wcyk6IHZvaWQge1xuICAgICAgICBpZiAobmV3UHJvcHMuc2VydmVyQ29uZmlnLmhzVXJsID09PSB0aGlzLnByb3BzLnNlcnZlckNvbmZpZy5oc1VybCAmJlxuICAgICAgICAgICAgbmV3UHJvcHMuc2VydmVyQ29uZmlnLmlzVXJsID09PSB0aGlzLnByb3BzLnNlcnZlckNvbmZpZy5pc1VybCkgcmV0dXJuO1xuXG4gICAgICAgIC8vIERvIGEgbGl2ZWxpbmVzcyBjaGVjayBvbiB0aGUgbmV3IFVSTHNcbiAgICAgICAgdGhpcy5jaGVja1NlcnZlckxpdmVsaW5lc3MobmV3UHJvcHMuc2VydmVyQ29uZmlnKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGNoZWNrU2VydmVyTGl2ZWxpbmVzcyhzZXJ2ZXJDb25maWcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IEF1dG9EaXNjb3ZlcnlVdGlscy52YWxpZGF0ZVNlcnZlckNvbmZpZ1dpdGhTdGF0aWNVcmxzKFxuICAgICAgICAgICAgICAgIHNlcnZlckNvbmZpZy5oc1VybCxcbiAgICAgICAgICAgICAgICBzZXJ2ZXJDb25maWcuaXNVcmwsXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJJc0FsaXZlOiB0cnVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoQXV0b0Rpc2NvdmVyeVV0aWxzLmF1dGhDb21wb25lbnRTdGF0ZUZvckVycm9yKGUsIFwiZm9yZ290X3Bhc3N3b3JkXCIpIGFzIElTdGF0ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3VibWl0UGFzc3dvcmRSZXNldChlbWFpbDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcGhhc2U6IFBoYXNlLlNlbmRpbmdFbWFpbCxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVzZXQgPSBuZXcgUGFzc3dvcmRSZXNldCh0aGlzLnByb3BzLnNlcnZlckNvbmZpZy5oc1VybCwgdGhpcy5wcm9wcy5zZXJ2ZXJDb25maWcuaXNVcmwpO1xuICAgICAgICB0aGlzLnJlc2V0LnJlc2V0UGFzc3dvcmQoZW1haWwsIHBhc3N3b3JkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHBoYXNlOiBQaGFzZS5FbWFpbFNlbnQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgKGVycikgPT4ge1xuICAgICAgICAgICAgdGhpcy5zaG93RXJyb3JEaWFsb2coX3QoJ0ZhaWxlZCB0byBzZW5kIGVtYWlsJykgKyBcIjogXCIgKyBlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBwaGFzZTogUGhhc2UuRm9yZ290LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25WZXJpZnkgPSBhc3luYyAoZXY6IFJlYWN0Lk1vdXNlRXZlbnQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKCF0aGlzLnJlc2V0KSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJvblZlcmlmeSBjYWxsZWQgYmVmb3JlIHN1Ym1pdFBhc3N3b3JkUmVzZXQhXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmN1cnJlbnRIdHRwUmVxdWVzdCkgcmV0dXJuO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZUh0dHBSZXF1ZXN0KHRoaXMucmVzZXQuY2hlY2tFbWFpbExpbmtDbGlja2VkKCkpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHBoYXNlOiBQaGFzZS5Eb25lIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd0Vycm9yRGlhbG9nKGVyci5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU3VibWl0Rm9ybSA9IGFzeW5jIChldjogUmVhY3QuRm9ybUV2ZW50KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmN1cnJlbnRIdHRwUmVxdWVzdCkgcmV0dXJuO1xuXG4gICAgICAgIC8vIHJlZnJlc2ggdGhlIHNlcnZlciBlcnJvcnMsIGp1c3QgaW4gY2FzZSB0aGUgc2VydmVyIGNhbWUgYmFjayBvbmxpbmVcbiAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVIdHRwUmVxdWVzdCh0aGlzLmNoZWNrU2VydmVyTGl2ZWxpbmVzcyh0aGlzLnByb3BzLnNlcnZlckNvbmZpZykpO1xuXG4gICAgICAgIGNvbnN0IGFsbEZpZWxkc1ZhbGlkID0gYXdhaXQgdGhpcy52ZXJpZnlGaWVsZHNCZWZvcmVTdWJtaXQoKTtcbiAgICAgICAgaWYgKCFhbGxGaWVsZHNWYWxpZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRm9yZ290IFBhc3N3b3JkIFdhcm5pbmcnLCAnJywgUXVlc3Rpb25EaWFsb2csIHtcbiAgICAgICAgICAgIHRpdGxlOiBfdCgnV2FybmluZyEnKSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkNoYW5naW5nIHlvdXIgcGFzc3dvcmQgd2lsbCByZXNldCBhbnkgZW5kLXRvLWVuZCBlbmNyeXB0aW9uIGtleXMgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJvbiBhbGwgb2YgeW91ciBzZXNzaW9ucywgbWFraW5nIGVuY3J5cHRlZCBjaGF0IGhpc3RvcnkgdW5yZWFkYWJsZS4gU2V0IHVwIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiS2V5IEJhY2t1cCBvciBleHBvcnQgeW91ciByb29tIGtleXMgZnJvbSBhbm90aGVyIHNlc3Npb24gYmVmb3JlIHJlc2V0dGluZyB5b3VyIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmQuXCIsXG4gICAgICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgIDwvZGl2PixcbiAgICAgICAgICAgIGJ1dHRvbjogX3QoJ0NvbnRpbnVlJyksXG4gICAgICAgICAgICBvbkZpbmlzaGVkOiAoY29uZmlybWVkKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdFBhc3N3b3JkUmVzZXQodGhpcy5zdGF0ZS5lbWFpbCwgdGhpcy5zdGF0ZS5wYXNzd29yZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYXN5bmMgdmVyaWZ5RmllbGRzQmVmb3JlU3VibWl0KCkge1xuICAgICAgICBjb25zdCBmaWVsZElkc0luRGlzcGxheU9yZGVyID0gW1xuICAgICAgICAgICAgRm9yZ290UGFzc3dvcmRGaWVsZC5FbWFpbCxcbiAgICAgICAgICAgIEZvcmdvdFBhc3N3b3JkRmllbGQuUGFzc3dvcmQsXG4gICAgICAgICAgICBGb3Jnb3RQYXNzd29yZEZpZWxkLlBhc3N3b3JkQ29uZmlybSxcbiAgICAgICAgXTtcblxuICAgICAgICBjb25zdCBpbnZhbGlkRmllbGRzID0gW107XG4gICAgICAgIGZvciAoY29uc3QgZmllbGRJZCBvZiBmaWVsZElkc0luRGlzcGxheU9yZGVyKSB7XG4gICAgICAgICAgICBjb25zdCB2YWxpZCA9IGF3YWl0IHRoaXNbZmllbGRJZF0udmFsaWRhdGUoeyBhbGxvd0VtcHR5OiBmYWxzZSB9KTtcbiAgICAgICAgICAgIGlmICghdmFsaWQpIHtcbiAgICAgICAgICAgICAgICBpbnZhbGlkRmllbGRzLnB1c2godGhpc1tmaWVsZElkXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW52YWxpZEZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRm9jdXMgb24gdGhlIGZpcnN0IGludmFsaWQgZmllbGQsIHRoZW4gcmUtdmFsaWRhdGUsXG4gICAgICAgIC8vIHdoaWNoIHdpbGwgcmVzdWx0IGluIHRoZSBlcnJvciB0b29sdGlwIGJlaW5nIGRpc3BsYXllZCBmb3IgdGhhdCBmaWVsZC5cbiAgICAgICAgaW52YWxpZEZpZWxkc1swXS5mb2N1cygpO1xuICAgICAgICBpbnZhbGlkRmllbGRzWzBdLnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogZmFsc2UsIGZvY3VzZWQ6IHRydWUgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25JbnB1dENoYW5nZWQgPSAoc3RhdGVLZXk6IHN0cmluZywgZXY6IFJlYWN0LkZvcm1FdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIFtzdGF0ZUtleV06IGV2LmN1cnJlbnRUYXJnZXQudmFsdWUsXG4gICAgICAgIH0gYXMgYW55KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkxvZ2luQ2xpY2sgPSAoZXY6IFJlYWN0Lk1vdXNlRXZlbnQpOiB2b2lkID0+IHtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMucHJvcHMub25Mb2dpbkNsaWNrKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzaG93RXJyb3JEaWFsb2coZGVzY3JpcHRpb246IHN0cmluZywgdGl0bGU/OiBzdHJpbmcpIHtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRm9yZ290IFBhc3N3b3JkIEVycm9yJywgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUh0dHBSZXF1ZXN0PFQgPSB1bmtub3duPihyZXF1ZXN0OiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgY3VycmVudEh0dHBSZXF1ZXN0OiByZXF1ZXN0LFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlcXVlc3QuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBjdXJyZW50SHR0cFJlcXVlc3Q6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZW5kZXJGb3Jnb3QoKSB7XG4gICAgICAgIGxldCBlcnJvclRleHQgPSBudWxsO1xuICAgICAgICBjb25zdCBlcnIgPSB0aGlzLnN0YXRlLmVycm9yVGV4dDtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgZXJyb3JUZXh0ID0gPGRpdiBjbGFzc05hbWU9XCJteF9Mb2dpbl9lcnJvclwiPnsgZXJyIH08L2Rpdj47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc2VydmVyRGVhZFNlY3Rpb247XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5zZXJ2ZXJJc0FsaXZlKSB7XG4gICAgICAgICAgICBjb25zdCBjbGFzc2VzID0gY2xhc3NOYW1lcyh7XG4gICAgICAgICAgICAgICAgXCJteF9Mb2dpbl9lcnJvclwiOiB0cnVlLFxuICAgICAgICAgICAgICAgIFwibXhfTG9naW5fc2VydmVyRXJyb3JcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBcIm14X0xvZ2luX3NlcnZlckVycm9yTm9uRmF0YWxcIjogIXRoaXMuc3RhdGUuc2VydmVyRXJyb3JJc0ZhdGFsLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZXJ2ZXJEZWFkU2VjdGlvbiA9IChcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlc30+XG4gICAgICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS5zZXJ2ZXJEZWFkRXJyb3IgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgeyBlcnJvclRleHQgfVxuICAgICAgICAgICAgeyBzZXJ2ZXJEZWFkU2VjdGlvbiB9XG4gICAgICAgICAgICA8U2VydmVyUGlja2VyXG4gICAgICAgICAgICAgICAgc2VydmVyQ29uZmlnPXt0aGlzLnByb3BzLnNlcnZlckNvbmZpZ31cbiAgICAgICAgICAgICAgICBvblNlcnZlckNvbmZpZ0NoYW5nZT17dGhpcy5wcm9wcy5vblNlcnZlckNvbmZpZ0NoYW5nZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17dGhpcy5vblN1Ym1pdEZvcm19PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQXV0aEJvZHlfZmllbGRSb3dcIj5cbiAgICAgICAgICAgICAgICAgICAgPEVtYWlsRmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9XCJyZXNldF9lbWFpbFwiIC8vIGRlZmluZSBhIG5hbWUgc28gYnJvd3NlcidzIHBhc3N3b3JkIGF1dG9maWxsIGdldHMgbGVzcyBjb25mdXNlZFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxSZXF1aXJlZD17X3QoJ1RoZSBlbWFpbCBhZGRyZXNzIGxpbmtlZCB0byB5b3VyIGFjY291bnQgbXVzdCBiZSBlbnRlcmVkLicpfVxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxJbnZhbGlkPXtfdChcIlRoZSBlbWFpbCBhZGRyZXNzIGRvZXNuJ3QgYXBwZWFyIHRvIGJlIHZhbGlkLlwiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmVtYWlsfVxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRSZWY9e2ZpZWxkID0+IHRoaXNbRm9yZ290UGFzc3dvcmRGaWVsZC5FbWFpbF0gPSBmaWVsZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Gb2N1cz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uSW5wdXRDaGFuZ2VkLmJpbmQodGhpcywgXCJlbWFpbFwiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRm9jdXM9eygpID0+IENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX2ZvcmdvdF9wYXNzd29yZF9lbWFpbF9mb2N1c1wiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQmx1cj17KCkgPT4gQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFjayhcIm9uYm9hcmRpbmdfZm9yZ290X3Bhc3N3b3JkX2VtYWlsX2JsdXJcIil9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9BdXRoQm9keV9maWVsZFJvd1wiPlxuICAgICAgICAgICAgICAgICAgICA8UGFzc3BocmFzZUZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lPVwicmVzZXRfcGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdGQoJ05ldyBQYXNzd29yZCcpfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUucGFzc3dvcmR9XG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5TY29yZT17UEFTU1dPUkRfTUlOX1NDT1JFfVxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRSZWY9e2ZpZWxkID0+IHRoaXNbRm9yZ290UGFzc3dvcmRGaWVsZC5QYXNzd29yZF0gPSBmaWVsZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uSW5wdXRDaGFuZ2VkLmJpbmQodGhpcywgXCJwYXNzd29yZFwiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRm9jdXM9eygpID0+IENvdW50bHlBbmFseXRpY3MuaW5zdGFuY2UudHJhY2soXCJvbmJvYXJkaW5nX2ZvcmdvdF9wYXNzd29yZF9uZXdQYXNzd29yZF9mb2N1c1wiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQmx1cj17KCkgPT4gQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS50cmFjayhcIm9uYm9hcmRpbmdfZm9yZ290X3Bhc3N3b3JkX25ld1Bhc3N3b3JkX2JsdXJcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJuZXctcGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICA8UGFzc3BocmFzZUNvbmZpcm1GaWVsZFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1cInJlc2V0X3Bhc3N3b3JkX2NvbmZpcm1cIlxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KCdDb25maXJtJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbFJlcXVpcmVkPXtfdChcIkEgbmV3IHBhc3N3b3JkIG11c3QgYmUgZW50ZXJlZC5cIil9XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbEludmFsaWQ9e190KFwiTmV3IHBhc3N3b3JkcyBtdXN0IG1hdGNoIGVhY2ggb3RoZXIuXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUucGFzc3dvcmQyfVxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ9e3RoaXMuc3RhdGUucGFzc3dvcmR9XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZFJlZj17ZmllbGQgPT4gdGhpc1tGb3Jnb3RQYXNzd29yZEZpZWxkLlBhc3N3b3JkQ29uZmlybV0gPSBmaWVsZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uSW5wdXRDaGFuZ2VkLmJpbmQodGhpcywgXCJwYXNzd29yZDJcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkZvY3VzPXsoKSA9PiBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnRyYWNrKFwib25ib2FyZGluZ19mb3Jnb3RfcGFzc3dvcmRfbmV3UGFzc3dvcmQyX2ZvY3VzXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25CbHVyPXsoKSA9PiBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnRyYWNrKFwib25ib2FyZGluZ19mb3Jnb3RfcGFzc3dvcmRfbmV3UGFzc3dvcmQyX2JsdXJcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJuZXctcGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxzcGFuPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgICdBIHZlcmlmaWNhdGlvbiBlbWFpbCB3aWxsIGJlIHNlbnQgdG8geW91ciBpbmJveCB0byBjb25maXJtICcgK1xuICAgICAgICAgICAgICAgICAgICAnc2V0dGluZyB5b3VyIG5ldyBwYXNzd29yZC4nLFxuICAgICAgICAgICAgICAgICkgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfTG9naW5fc3VibWl0XCJcbiAgICAgICAgICAgICAgICAgICAgdHlwZT1cInN1Ym1pdFwiXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlPXtfdCgnU2VuZCBSZXNldCBFbWFpbCcpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgICAgICA8YSBjbGFzc05hbWU9XCJteF9BdXRoQm9keV9jaGFuZ2VGbG93XCIgb25DbGljaz17dGhpcy5vbkxvZ2luQ2xpY2t9IGhyZWY9XCIjXCI+XG4gICAgICAgICAgICAgICAgeyBfdCgnU2lnbiBpbiBpbnN0ZWFkJykgfVxuICAgICAgICAgICAgPC9hPlxuICAgICAgICA8L2Rpdj47XG4gICAgfVxuXG4gICAgcmVuZGVyU2VuZGluZ0VtYWlsKCkge1xuICAgICAgICByZXR1cm4gPFNwaW5uZXIgLz47XG4gICAgfVxuXG4gICAgcmVuZGVyRW1haWxTZW50KCkge1xuICAgICAgICByZXR1cm4gPGRpdj5cbiAgICAgICAgICAgIHsgX3QoXCJBbiBlbWFpbCBoYXMgYmVlbiBzZW50IHRvICUoZW1haWxBZGRyZXNzKXMuIE9uY2UgeW91J3ZlIGZvbGxvd2VkIHRoZSBcIiArXG4gICAgICAgICAgICAgICAgXCJsaW5rIGl0IGNvbnRhaW5zLCBjbGljayBiZWxvdy5cIiwgeyBlbWFpbEFkZHJlc3M6IHRoaXMuc3RhdGUuZW1haWwgfSkgfVxuICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Mb2dpbl9zdWJtaXRcIlxuICAgICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25WZXJpZnl9XG4gICAgICAgICAgICAgICAgdmFsdWU9e190KCdJIGhhdmUgdmVyaWZpZWQgbXkgZW1haWwgYWRkcmVzcycpfSAvPlxuICAgICAgICAgICAgeyB0aGlzLnN0YXRlLmN1cnJlbnRIdHRwUmVxdWVzdCAmJiAoXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Mb2dpbl9zcGlubmVyXCI+PElubGluZVNwaW5uZXIgdz17NjR9IGg9ezY0fSAvPjwvZGl2PilcbiAgICAgICAgICAgIH1cbiAgICAgICAgPC9kaXY+O1xuICAgIH1cblxuICAgIHJlbmRlckRvbmUoKSB7XG4gICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgPHA+eyBfdChcIllvdXIgcGFzc3dvcmQgaGFzIGJlZW4gcmVzZXQuXCIpIH08L3A+XG4gICAgICAgICAgICA8cD57IF90KFxuICAgICAgICAgICAgICAgIFwiWW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0IG9mIGFsbCBzZXNzaW9ucyBhbmQgd2lsbCBubyBsb25nZXIgcmVjZWl2ZSBcIiArXG4gICAgICAgICAgICAgICAgXCJwdXNoIG5vdGlmaWNhdGlvbnMuIFRvIHJlLWVuYWJsZSBub3RpZmljYXRpb25zLCBzaWduIGluIGFnYWluIG9uIGVhY2ggXCIgK1xuICAgICAgICAgICAgICAgIFwiZGV2aWNlLlwiLFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfTG9naW5fc3VibWl0XCJcbiAgICAgICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnByb3BzLm9uQ29tcGxldGV9XG4gICAgICAgICAgICAgICAgdmFsdWU9e190KCdSZXR1cm4gdG8gbG9naW4gc2NyZWVuJyl9IC8+XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGxldCByZXNldFBhc3N3b3JkSnN4O1xuICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUucGhhc2UpIHtcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuRm9yZ290OlxuICAgICAgICAgICAgICAgIHJlc2V0UGFzc3dvcmRKc3ggPSB0aGlzLnJlbmRlckZvcmdvdCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQaGFzZS5TZW5kaW5nRW1haWw6XG4gICAgICAgICAgICAgICAgcmVzZXRQYXNzd29yZEpzeCA9IHRoaXMucmVuZGVyU2VuZGluZ0VtYWlsKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFBoYXNlLkVtYWlsU2VudDpcbiAgICAgICAgICAgICAgICByZXNldFBhc3N3b3JkSnN4ID0gdGhpcy5yZW5kZXJFbWFpbFNlbnQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuRG9uZTpcbiAgICAgICAgICAgICAgICByZXNldFBhc3N3b3JkSnN4ID0gdGhpcy5yZW5kZXJEb25lKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJlc2V0UGFzc3dvcmRKc3ggPSA8ZGl2IGNsYXNzTmFtZT1cIm14X0xvZ2luX3NwaW5uZXJcIj48SW5saW5lU3Bpbm5lciB3PXs2NH0gaD17NjR9IC8+PC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxBdXRoUGFnZT5cbiAgICAgICAgICAgICAgICA8QXV0aEhlYWRlciAvPlxuICAgICAgICAgICAgICAgIDxBdXRoQm9keT5cbiAgICAgICAgICAgICAgICAgICAgPGgyPiB7IF90KCdTZXQgYSBuZXcgcGFzc3dvcmQnKSB9IDwvaDI+XG4gICAgICAgICAgICAgICAgICAgIHsgcmVzZXRQYXNzd29yZEpzeCB9XG4gICAgICAgICAgICAgICAgPC9BdXRoQm9keT5cbiAgICAgICAgICAgIDwvQXV0aFBhZ2U+XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19