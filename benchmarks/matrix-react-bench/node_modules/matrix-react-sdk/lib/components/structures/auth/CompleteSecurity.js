"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../languageHandler");

var _SetupEncryptionStore = require("../../../stores/SetupEncryptionStore");

var _SetupEncryptionBody = _interopRequireDefault(require("./SetupEncryptionBody"));

var _replaceableComponent = require("../../../utils/replaceableComponent");

var _AccessibleButton = _interopRequireDefault(require("../../views/elements/AccessibleButton"));

var _CompleteSecurityBody = _interopRequireDefault(require("../../views/auth/CompleteSecurityBody"));

var _AuthPage = _interopRequireDefault(require("../../views/auth/AuthPage"));

var _dec, _class;

let CompleteSecurity = (_dec = (0, _replaceableComponent.replaceableComponent)("structures.auth.CompleteSecurity"), _dec(_class = class CompleteSecurity extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "onStoreUpdate", () => {
      const store = _SetupEncryptionStore.SetupEncryptionStore.sharedInstance();

      this.setState({
        phase: store.phase,
        lostKeys: store.lostKeys()
      });
    });
    (0, _defineProperty2.default)(this, "onSkipClick", () => {
      const store = _SetupEncryptionStore.SetupEncryptionStore.sharedInstance();

      store.skip();
    });

    const _store = _SetupEncryptionStore.SetupEncryptionStore.sharedInstance();

    _store.on("update", this.onStoreUpdate);

    _store.start();

    this.state = {
      phase: _store.phase,
      lostKeys: _store.lostKeys()
    };
  }

  componentWillUnmount() {
    const store = _SetupEncryptionStore.SetupEncryptionStore.sharedInstance();

    store.off("update", this.onStoreUpdate);
    store.stop();
  }

  render() {
    const {
      phase,
      lostKeys
    } = this.state;
    let icon;
    let title;

    if (phase === _SetupEncryptionStore.Phase.Loading) {
      return null;
    } else if (phase === _SetupEncryptionStore.Phase.Intro) {
      if (lostKeys) {
        icon = /*#__PURE__*/_react.default.createElement("span", {
          className: "mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"
        });
        title = (0, _languageHandler._t)("Unable to verify this login");
      } else {
        icon = /*#__PURE__*/_react.default.createElement("span", {
          className: "mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"
        });
        title = (0, _languageHandler._t)("Verify this login");
      }
    } else if (phase === _SetupEncryptionStore.Phase.Done) {
      icon = /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_CompleteSecurity_headerIcon mx_E2EIcon_verified"
      });
      title = (0, _languageHandler._t)("Session verified");
    } else if (phase === _SetupEncryptionStore.Phase.ConfirmSkip) {
      icon = /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"
      });
      title = (0, _languageHandler._t)("Are you sure?");
    } else if (phase === _SetupEncryptionStore.Phase.Busy) {
      icon = /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"
      });
      title = (0, _languageHandler._t)("Verify this login");
    } else if (phase === _SetupEncryptionStore.Phase.ConfirmReset) {
      icon = /*#__PURE__*/_react.default.createElement("span", {
        className: "mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"
      });
      title = (0, _languageHandler._t)("Really reset verification keys?");
    } else if (phase === _SetupEncryptionStore.Phase.Finished) {// SetupEncryptionBody will take care of calling onFinished, we don't need to do anything
    } else {
      throw new Error(`Unknown phase ${phase}`);
    }

    let skipButton;

    if (phase === _SetupEncryptionStore.Phase.Intro || phase === _SetupEncryptionStore.Phase.ConfirmReset) {
      skipButton = /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        onClick: this.onSkipClick,
        className: "mx_CompleteSecurity_skip",
        "aria-label": (0, _languageHandler._t)("Skip verification for now")
      });
    }

    return /*#__PURE__*/_react.default.createElement(_AuthPage.default, null, /*#__PURE__*/_react.default.createElement(_CompleteSecurityBody.default, null, /*#__PURE__*/_react.default.createElement("h2", {
      className: "mx_CompleteSecurity_header"
    }, icon, title, skipButton), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CompleteSecurity_body"
    }, /*#__PURE__*/_react.default.createElement(_SetupEncryptionBody.default, {
      onFinished: this.props.onFinished
    }))));
  }

}) || _class);
exports.default = CompleteSecurity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvYXV0aC9Db21wbGV0ZVNlY3VyaXR5LnRzeCJdLCJuYW1lcyI6WyJDb21wbGV0ZVNlY3VyaXR5IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwic3RvcmUiLCJTZXR1cEVuY3J5cHRpb25TdG9yZSIsInNoYXJlZEluc3RhbmNlIiwic2V0U3RhdGUiLCJwaGFzZSIsImxvc3RLZXlzIiwic2tpcCIsIm9uIiwib25TdG9yZVVwZGF0ZSIsInN0YXJ0Iiwic3RhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsIm9mZiIsInN0b3AiLCJyZW5kZXIiLCJpY29uIiwidGl0bGUiLCJQaGFzZSIsIkxvYWRpbmciLCJJbnRybyIsIkRvbmUiLCJDb25maXJtU2tpcCIsIkJ1c3kiLCJDb25maXJtUmVzZXQiLCJGaW5pc2hlZCIsIkVycm9yIiwic2tpcEJ1dHRvbiIsIm9uU2tpcENsaWNrIiwib25GaW5pc2hlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7SUFZcUJBLGdCLFdBRHBCLGdEQUFxQixrQ0FBckIsQyxnQkFBRCxNQUNxQkEsZ0JBRHJCLFNBQzhDQyxlQUFNQyxTQURwRCxDQUM4RTtBQUMxRUMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0FBQ3ZCLFVBQU1BLEtBQU47QUFEdUIseURBUUgsTUFBWTtBQUNoQyxZQUFNQyxLQUFLLEdBQUdDLDJDQUFxQkMsY0FBckIsRUFBZDs7QUFDQSxXQUFLQyxRQUFMLENBQWM7QUFBRUMsUUFBQUEsS0FBSyxFQUFFSixLQUFLLENBQUNJLEtBQWY7QUFBc0JDLFFBQUFBLFFBQVEsRUFBRUwsS0FBSyxDQUFDSyxRQUFOO0FBQWhDLE9BQWQ7QUFDSCxLQVgwQjtBQUFBLHVEQWFMLE1BQVk7QUFDOUIsWUFBTUwsS0FBSyxHQUFHQywyQ0FBcUJDLGNBQXJCLEVBQWQ7O0FBQ0FGLE1BQUFBLEtBQUssQ0FBQ00sSUFBTjtBQUNILEtBaEIwQjs7QUFFdkIsVUFBTU4sTUFBSyxHQUFHQywyQ0FBcUJDLGNBQXJCLEVBQWQ7O0FBQ0FGLElBQUFBLE1BQUssQ0FBQ08sRUFBTixDQUFTLFFBQVQsRUFBbUIsS0FBS0MsYUFBeEI7O0FBQ0FSLElBQUFBLE1BQUssQ0FBQ1MsS0FBTjs7QUFDQSxTQUFLQyxLQUFMLEdBQWE7QUFBRU4sTUFBQUEsS0FBSyxFQUFFSixNQUFLLENBQUNJLEtBQWY7QUFBc0JDLE1BQUFBLFFBQVEsRUFBRUwsTUFBSyxDQUFDSyxRQUFOO0FBQWhDLEtBQWI7QUFDSDs7QUFZTU0sRUFBQUEsb0JBQW9CLEdBQVM7QUFDaEMsVUFBTVgsS0FBSyxHQUFHQywyQ0FBcUJDLGNBQXJCLEVBQWQ7O0FBQ0FGLElBQUFBLEtBQUssQ0FBQ1ksR0FBTixDQUFVLFFBQVYsRUFBb0IsS0FBS0osYUFBekI7QUFDQVIsSUFBQUEsS0FBSyxDQUFDYSxJQUFOO0FBQ0g7O0FBRU1DLEVBQUFBLE1BQU0sR0FBRztBQUNaLFVBQU07QUFBRVYsTUFBQUEsS0FBRjtBQUFTQyxNQUFBQTtBQUFULFFBQXNCLEtBQUtLLEtBQWpDO0FBQ0EsUUFBSUssSUFBSjtBQUNBLFFBQUlDLEtBQUo7O0FBRUEsUUFBSVosS0FBSyxLQUFLYSw0QkFBTUMsT0FBcEIsRUFBNkI7QUFDekIsYUFBTyxJQUFQO0FBQ0gsS0FGRCxNQUVPLElBQUlkLEtBQUssS0FBS2EsNEJBQU1FLEtBQXBCLEVBQTJCO0FBQzlCLFVBQUlkLFFBQUosRUFBYztBQUNWVSxRQUFBQSxJQUFJLGdCQUFHO0FBQU0sVUFBQSxTQUFTLEVBQUM7QUFBaEIsVUFBUDtBQUNBQyxRQUFBQSxLQUFLLEdBQUcseUJBQUcsNkJBQUgsQ0FBUjtBQUNILE9BSEQsTUFHTztBQUNIRCxRQUFBQSxJQUFJLGdCQUFHO0FBQU0sVUFBQSxTQUFTLEVBQUM7QUFBaEIsVUFBUDtBQUNBQyxRQUFBQSxLQUFLLEdBQUcseUJBQUcsbUJBQUgsQ0FBUjtBQUNIO0FBQ0osS0FSTSxNQVFBLElBQUlaLEtBQUssS0FBS2EsNEJBQU1HLElBQXBCLEVBQTBCO0FBQzdCTCxNQUFBQSxJQUFJLGdCQUFHO0FBQU0sUUFBQSxTQUFTLEVBQUM7QUFBaEIsUUFBUDtBQUNBQyxNQUFBQSxLQUFLLEdBQUcseUJBQUcsa0JBQUgsQ0FBUjtBQUNILEtBSE0sTUFHQSxJQUFJWixLQUFLLEtBQUthLDRCQUFNSSxXQUFwQixFQUFpQztBQUNwQ04sTUFBQUEsSUFBSSxnQkFBRztBQUFNLFFBQUEsU0FBUyxFQUFDO0FBQWhCLFFBQVA7QUFDQUMsTUFBQUEsS0FBSyxHQUFHLHlCQUFHLGVBQUgsQ0FBUjtBQUNILEtBSE0sTUFHQSxJQUFJWixLQUFLLEtBQUthLDRCQUFNSyxJQUFwQixFQUEwQjtBQUM3QlAsTUFBQUEsSUFBSSxnQkFBRztBQUFNLFFBQUEsU0FBUyxFQUFDO0FBQWhCLFFBQVA7QUFDQUMsTUFBQUEsS0FBSyxHQUFHLHlCQUFHLG1CQUFILENBQVI7QUFDSCxLQUhNLE1BR0EsSUFBSVosS0FBSyxLQUFLYSw0QkFBTU0sWUFBcEIsRUFBa0M7QUFDckNSLE1BQUFBLElBQUksZ0JBQUc7QUFBTSxRQUFBLFNBQVMsRUFBQztBQUFoQixRQUFQO0FBQ0FDLE1BQUFBLEtBQUssR0FBRyx5QkFBRyxpQ0FBSCxDQUFSO0FBQ0gsS0FITSxNQUdBLElBQUlaLEtBQUssS0FBS2EsNEJBQU1PLFFBQXBCLEVBQThCLENBQ2pDO0FBQ0gsS0FGTSxNQUVBO0FBQ0gsWUFBTSxJQUFJQyxLQUFKLENBQVcsaUJBQWdCckIsS0FBTSxFQUFqQyxDQUFOO0FBQ0g7O0FBRUQsUUFBSXNCLFVBQUo7O0FBQ0EsUUFBSXRCLEtBQUssS0FBS2EsNEJBQU1FLEtBQWhCLElBQXlCZixLQUFLLEtBQUthLDRCQUFNTSxZQUE3QyxFQUEyRDtBQUN2REcsTUFBQUEsVUFBVSxnQkFDTiw2QkFBQyx5QkFBRDtBQUFrQixRQUFBLE9BQU8sRUFBRSxLQUFLQyxXQUFoQztBQUE2QyxRQUFBLFNBQVMsRUFBQywwQkFBdkQ7QUFBa0Ysc0JBQVkseUJBQUcsMkJBQUg7QUFBOUYsUUFESjtBQUdIOztBQUVELHdCQUNJLDZCQUFDLGlCQUFELHFCQUNJLDZCQUFDLDZCQUFELHFCQUNJO0FBQUksTUFBQSxTQUFTLEVBQUM7QUFBZCxPQUNNWixJQUROLEVBRU1DLEtBRk4sRUFHTVUsVUFITixDQURKLGVBTUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLG9CQUNJLDZCQUFDLDRCQUFEO0FBQXFCLE1BQUEsVUFBVSxFQUFFLEtBQUszQixLQUFMLENBQVc2QjtBQUE1QyxNQURKLENBTkosQ0FESixDQURKO0FBY0g7O0FBL0V5RSxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIwIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCB7IFNldHVwRW5jcnlwdGlvblN0b3JlLCBQaGFzZSB9IGZyb20gJy4uLy4uLy4uL3N0b3Jlcy9TZXR1cEVuY3J5cHRpb25TdG9yZSc7XG5pbXBvcnQgU2V0dXBFbmNyeXB0aW9uQm9keSBmcm9tIFwiLi9TZXR1cEVuY3J5cHRpb25Cb2R5XCI7XG5pbXBvcnQgeyByZXBsYWNlYWJsZUNvbXBvbmVudCB9IGZyb20gXCIuLi8uLi8uLi91dGlscy9yZXBsYWNlYWJsZUNvbXBvbmVudFwiO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSAnLi4vLi4vdmlld3MvZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvbic7XG5pbXBvcnQgQ29tcGxldGVTZWN1cml0eUJvZHkgZnJvbSBcIi4uLy4uL3ZpZXdzL2F1dGgvQ29tcGxldGVTZWN1cml0eUJvZHlcIjtcbmltcG9ydCBBdXRoUGFnZSBmcm9tIFwiLi4vLi4vdmlld3MvYXV0aC9BdXRoUGFnZVwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBvbkZpbmlzaGVkOiAoKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBwaGFzZTogUGhhc2U7XG4gICAgbG9zdEtleXM6IGJvb2xlYW47XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInN0cnVjdHVyZXMuYXV0aC5Db21wbGV0ZVNlY3VyaXR5XCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21wbGV0ZVNlY3VyaXR5IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PElQcm9wcywgSVN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIGNvbnN0IHN0b3JlID0gU2V0dXBFbmNyeXB0aW9uU3RvcmUuc2hhcmVkSW5zdGFuY2UoKTtcbiAgICAgICAgc3RvcmUub24oXCJ1cGRhdGVcIiwgdGhpcy5vblN0b3JlVXBkYXRlKTtcbiAgICAgICAgc3RvcmUuc3RhcnQoKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHsgcGhhc2U6IHN0b3JlLnBoYXNlLCBsb3N0S2V5czogc3RvcmUubG9zdEtleXMoKSB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgb25TdG9yZVVwZGF0ZSA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3Qgc3RvcmUgPSBTZXR1cEVuY3J5cHRpb25TdG9yZS5zaGFyZWRJbnN0YW5jZSgpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgcGhhc2U6IHN0b3JlLnBoYXNlLCBsb3N0S2V5czogc3RvcmUubG9zdEtleXMoKSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblNraXBDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3Qgc3RvcmUgPSBTZXR1cEVuY3J5cHRpb25TdG9yZS5zaGFyZWRJbnN0YW5jZSgpO1xuICAgICAgICBzdG9yZS5za2lwKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBjb21wb25lbnRXaWxsVW5tb3VudCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgc3RvcmUgPSBTZXR1cEVuY3J5cHRpb25TdG9yZS5zaGFyZWRJbnN0YW5jZSgpO1xuICAgICAgICBzdG9yZS5vZmYoXCJ1cGRhdGVcIiwgdGhpcy5vblN0b3JlVXBkYXRlKTtcbiAgICAgICAgc3RvcmUuc3RvcCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgcGhhc2UsIGxvc3RLZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBsZXQgaWNvbjtcbiAgICAgICAgbGV0IHRpdGxlO1xuXG4gICAgICAgIGlmIChwaGFzZSA9PT0gUGhhc2UuTG9hZGluZykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gZWxzZSBpZiAocGhhc2UgPT09IFBoYXNlLkludHJvKSB7XG4gICAgICAgICAgICBpZiAobG9zdEtleXMpIHtcbiAgICAgICAgICAgICAgICBpY29uID0gPHNwYW4gY2xhc3NOYW1lPVwibXhfQ29tcGxldGVTZWN1cml0eV9oZWFkZXJJY29uIG14X0UyRUljb25fd2FybmluZ1wiIC8+O1xuICAgICAgICAgICAgICAgIHRpdGxlID0gX3QoXCJVbmFibGUgdG8gdmVyaWZ5IHRoaXMgbG9naW5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGljb24gPSA8c3BhbiBjbGFzc05hbWU9XCJteF9Db21wbGV0ZVNlY3VyaXR5X2hlYWRlckljb24gbXhfRTJFSWNvbl93YXJuaW5nXCIgLz47XG4gICAgICAgICAgICAgICAgdGl0bGUgPSBfdChcIlZlcmlmeSB0aGlzIGxvZ2luXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHBoYXNlID09PSBQaGFzZS5Eb25lKSB7XG4gICAgICAgICAgICBpY29uID0gPHNwYW4gY2xhc3NOYW1lPVwibXhfQ29tcGxldGVTZWN1cml0eV9oZWFkZXJJY29uIG14X0UyRUljb25fdmVyaWZpZWRcIiAvPjtcbiAgICAgICAgICAgIHRpdGxlID0gX3QoXCJTZXNzaW9uIHZlcmlmaWVkXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHBoYXNlID09PSBQaGFzZS5Db25maXJtU2tpcCkge1xuICAgICAgICAgICAgaWNvbiA9IDxzcGFuIGNsYXNzTmFtZT1cIm14X0NvbXBsZXRlU2VjdXJpdHlfaGVhZGVySWNvbiBteF9FMkVJY29uX3dhcm5pbmdcIiAvPjtcbiAgICAgICAgICAgIHRpdGxlID0gX3QoXCJBcmUgeW91IHN1cmU/XCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHBoYXNlID09PSBQaGFzZS5CdXN5KSB7XG4gICAgICAgICAgICBpY29uID0gPHNwYW4gY2xhc3NOYW1lPVwibXhfQ29tcGxldGVTZWN1cml0eV9oZWFkZXJJY29uIG14X0UyRUljb25fd2FybmluZ1wiIC8+O1xuICAgICAgICAgICAgdGl0bGUgPSBfdChcIlZlcmlmeSB0aGlzIGxvZ2luXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHBoYXNlID09PSBQaGFzZS5Db25maXJtUmVzZXQpIHtcbiAgICAgICAgICAgIGljb24gPSA8c3BhbiBjbGFzc05hbWU9XCJteF9Db21wbGV0ZVNlY3VyaXR5X2hlYWRlckljb24gbXhfRTJFSWNvbl93YXJuaW5nXCIgLz47XG4gICAgICAgICAgICB0aXRsZSA9IF90KFwiUmVhbGx5IHJlc2V0IHZlcmlmaWNhdGlvbiBrZXlzP1wiKTtcbiAgICAgICAgfSBlbHNlIGlmIChwaGFzZSA9PT0gUGhhc2UuRmluaXNoZWQpIHtcbiAgICAgICAgICAgIC8vIFNldHVwRW5jcnlwdGlvbkJvZHkgd2lsbCB0YWtlIGNhcmUgb2YgY2FsbGluZyBvbkZpbmlzaGVkLCB3ZSBkb24ndCBuZWVkIHRvIGRvIGFueXRoaW5nXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcGhhc2UgJHtwaGFzZX1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBza2lwQnV0dG9uO1xuICAgICAgICBpZiAocGhhc2UgPT09IFBoYXNlLkludHJvIHx8IHBoYXNlID09PSBQaGFzZS5Db25maXJtUmVzZXQpIHtcbiAgICAgICAgICAgIHNraXBCdXR0b24gPSAoXG4gICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gb25DbGljaz17dGhpcy5vblNraXBDbGlja30gY2xhc3NOYW1lPVwibXhfQ29tcGxldGVTZWN1cml0eV9za2lwXCIgYXJpYS1sYWJlbD17X3QoXCJTa2lwIHZlcmlmaWNhdGlvbiBmb3Igbm93XCIpfSAvPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QXV0aFBhZ2U+XG4gICAgICAgICAgICAgICAgPENvbXBsZXRlU2VjdXJpdHlCb2R5PlxuICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3NOYW1lPVwibXhfQ29tcGxldGVTZWN1cml0eV9oZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgaWNvbiB9XG4gICAgICAgICAgICAgICAgICAgICAgICB7IHRpdGxlIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgc2tpcEJ1dHRvbiB9XG4gICAgICAgICAgICAgICAgICAgIDwvaDI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ29tcGxldGVTZWN1cml0eV9ib2R5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8U2V0dXBFbmNyeXB0aW9uQm9keSBvbkZpbmlzaGVkPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9IC8+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvQ29tcGxldGVTZWN1cml0eUJvZHk+XG4gICAgICAgICAgICA8L0F1dGhQYWdlPlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==