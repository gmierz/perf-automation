"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _Keyboard = require("../../Keyboard");

var _PageTypes = _interopRequireDefault(require("../../PageTypes"));

var _MediaDeviceHandler = _interopRequireDefault(require("../../MediaDeviceHandler"));

var _FontManager = require("../../utils/FontManager");

var _dispatcher = _interopRequireDefault(require("../../dispatcher/dispatcher"));

var _SettingsStore = _interopRequireDefault(require("../../settings/SettingsStore"));

var _ResizeHandle = _interopRequireDefault(require("../views/elements/ResizeHandle"));

var _resizer = require("../../resizer");

var _MatrixClientContext = _interopRequireDefault(require("../../contexts/MatrixClientContext"));

var KeyboardShortcuts = _interopRequireWildcard(require("../../accessibility/KeyboardShortcuts"));

var _HomePage = _interopRequireDefault(require("./HomePage"));

var _PlatformPeg = _interopRequireDefault(require("../../PlatformPeg"));

var _models = require("../../stores/room-list/models");

var _ServerLimitToast = require("../../toasts/ServerLimitToast");

var _actions = require("../../dispatcher/actions");

var _LeftPanel = _interopRequireDefault(require("./LeftPanel"));

var _CallContainer = _interopRequireDefault(require("../views/voip/CallContainer"));

var _RoomListStore = _interopRequireDefault(require("../../stores/room-list/RoomListStore"));

var _NonUrgentToastContainer = _interopRequireDefault(require("./NonUrgentToastContainer"));

var _Modal = _interopRequireDefault(require("../../Modal"));

var _HostSignupContainer = _interopRequireDefault(require("../views/host_signup/HostSignupContainer"));

var _KeyBindingsManager = require("../../KeyBindingsManager");

var _SpacePanel = _interopRequireDefault(require("../views/spaces/SpacePanel"));

var _replaceableComponent = require("../../utils/replaceableComponent");

var _CallHandler = _interopRequireDefault(require("../../CallHandler"));

var _AudioFeedArrayForCall = _interopRequireDefault(require("../views/voip/AudioFeedArrayForCall"));

var _OwnProfileStore = require("../../stores/OwnProfileStore");

var _AsyncStore = require("../../stores/AsyncStore");

var _RoomView = _interopRequireDefault(require("./RoomView"));

var _ToastContainer = _interopRequireDefault(require("./ToastContainer"));

var _MyGroups = _interopRequireDefault(require("./MyGroups"));

var _UserView = _interopRequireDefault(require("./UserView"));

var _GroupView = _interopRequireDefault(require("./GroupView"));

var _BackdropPanel = _interopRequireDefault(require("./BackdropPanel"));

var _SpaceStore = _interopRequireDefault(require("../../stores/spaces/SpaceStore"));

var _classnames = _interopRequireDefault(require("classnames"));

var _GroupFilterPanel = _interopRequireDefault(require("./GroupFilterPanel"));

var _CustomRoomTagPanel = _interopRequireDefault(require("./CustomRoomTagPanel"));

var _Media = require("../../customisations/Media");

var _LegacyCommunityPreview = _interopRequireDefault(require("./LegacyCommunityPreview"));

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

// We need to fetch each pinned message individually (if we don't already have it)
// so each pinned message may trigger a request. Limit the number per room for sanity.
// NB. this is just for server notices rather than pinned messages in general.
const MAX_PINNED_NOTICES_PER_ROOM = 2;

function getInputableElement(el) {
  return el.closest("input, textarea, select, [contenteditable=true]");
}

/**
 * This is what our MatrixChat shows when we are logged in. The precise view is
 * determined by the page_type property.
 *
 * Currently it's very tightly coupled with MatrixChat. We should try to do
 * something about that.
 *
 * Components mounted below us can access the matrix client via the react context.
 */
let LoggedInView = (_dec = (0, _replaceableComponent.replaceableComponent)("structures.LoggedInView"), _dec(_class = (_temp = _class2 = class LoggedInView extends _react.default.Component {
  constructor(props, context) {
    super(props, context);
    (0, _defineProperty2.default)(this, "dispatcherRef", void 0);
    (0, _defineProperty2.default)(this, "_matrixClient", void 0);
    (0, _defineProperty2.default)(this, "_roomView", void 0);
    (0, _defineProperty2.default)(this, "_resizeContainer", void 0);
    (0, _defineProperty2.default)(this, "resizeHandler", void 0);
    (0, _defineProperty2.default)(this, "compactLayoutWatcherRef", void 0);
    (0, _defineProperty2.default)(this, "backgroundImageWatcherRef", void 0);
    (0, _defineProperty2.default)(this, "resizer", void 0);
    (0, _defineProperty2.default)(this, "refreshBackgroundImage", async () => {
      let backgroundImage = _SettingsStore.default.getValue("RoomList.backgroundImage");

      if (backgroundImage) {
        // convert to http before going much further
        backgroundImage = (0, _Media.mediaFromMxc)(backgroundImage).srcHttp;
      } else {
        backgroundImage = _OwnProfileStore.OwnProfileStore.instance.getHttpAvatarUrl();
      }

      this.setState({
        backgroundImage
      });
    });
    (0, _defineProperty2.default)(this, "onAction", payload => {
      switch (payload.action) {
        case 'call_state':
          {
            const activeCalls = _CallHandler.default.sharedInstance().getAllActiveCalls();

            if (activeCalls !== this.state.activeCalls) {
              this.setState({
                activeCalls
              });
            }

            break;
          }
      }
    });
    (0, _defineProperty2.default)(this, "canResetTimelineInRoom", roomId => {
      if (!this._roomView.current) {
        return true;
      }

      return this._roomView.current.canResetTimeline();
    });
    (0, _defineProperty2.default)(this, "onAccountData", event => {
      if (event.getType() === "m.ignored_user_list") {
        _dispatcher.default.dispatch({
          action: "ignore_state_changed"
        });
      }
    });
    (0, _defineProperty2.default)(this, "onCompactLayoutChanged", (setting, roomId, level, valueAtLevel, newValue) => {
      this.setState({
        useCompactLayout: valueAtLevel
      });
    });
    (0, _defineProperty2.default)(this, "onSync", (syncState, oldSyncState, data) => {
      const oldErrCode = this.state.syncErrorData && this.state.syncErrorData.error && this.state.syncErrorData.error.errcode;
      const newErrCode = data && data.error && data.error.errcode;
      if (syncState === oldSyncState && oldErrCode === newErrCode) return;

      if (syncState === 'ERROR') {
        this.setState({
          syncErrorData: data
        });
      } else {
        this.setState({
          syncErrorData: null
        });
      }

      if (oldSyncState === 'PREPARED' && syncState === 'SYNCING') {
        this.updateServerNoticeEvents();
      } else {
        this.calculateServerLimitToast(this.state.syncErrorData, this.state.usageLimitEventContent);
      }
    });
    (0, _defineProperty2.default)(this, "onRoomStateEvents", (ev, state) => {
      const serverNoticeList = _RoomListStore.default.instance.orderedLists[_models.DefaultTagID.ServerNotice];

      if (serverNoticeList && serverNoticeList.some(r => r.roomId === ev.getRoomId())) {
        this.updateServerNoticeEvents();
      }
    });
    (0, _defineProperty2.default)(this, "onUsageLimitDismissed", () => {
      this.setState({
        usageLimitDismissed: true
      });
    });
    (0, _defineProperty2.default)(this, "updateServerNoticeEvents", async () => {
      const serverNoticeList = _RoomListStore.default.instance.orderedLists[_models.DefaultTagID.ServerNotice];
      if (!serverNoticeList) return [];
      const events = [];
      let pinnedEventTs = 0;

      for (const room of serverNoticeList) {
        const pinStateEvent = room.currentState.getStateEvents("m.room.pinned_events", "");
        if (!pinStateEvent || !pinStateEvent.getContent().pinned) continue;
        pinnedEventTs = pinStateEvent.getTs();
        const pinnedEventIds = pinStateEvent.getContent().pinned.slice(0, MAX_PINNED_NOTICES_PER_ROOM);

        for (const eventId of pinnedEventIds) {
          const timeline = await this._matrixClient.getEventTimeline(room.getUnfilteredTimelineSet(), eventId);
          const event = timeline.getEvents().find(ev => ev.getId() === eventId);
          if (event) events.push(event);
        }
      }

      if (pinnedEventTs && this.state.usageLimitEventTs > pinnedEventTs) {
        // We've processed a newer event than this one, so ignore it.
        return;
      }

      const usageLimitEvent = events.find(e => {
        return e && e.getType() === 'm.room.message' && e.getContent()['server_notice_type'] === 'm.server_notice.usage_limit_reached';
      });
      const usageLimitEventContent = usageLimitEvent && usageLimitEvent.getContent();
      this.calculateServerLimitToast(this.state.syncErrorData, usageLimitEventContent);
      this.setState({
        usageLimitEventContent,
        usageLimitEventTs: pinnedEventTs,
        // This is a fresh toast, we can show toasts again
        usageLimitDismissed: false
      });
    });
    (0, _defineProperty2.default)(this, "onPaste", ev => {
      const element = ev.target;
      const inputableElement = getInputableElement(element);

      if (inputableElement) {
        inputableElement.focus();
      } else {
        // refocusing during a paste event will make the
        // paste end up in the newly focused element,
        // so dispatch synchronously before paste happens
        _dispatcher.default.fire(_actions.Action.FocusSendMessageComposer, true);
      }
    });
    (0, _defineProperty2.default)(this, "onReactKeyDown", ev => {
      // events caught while bubbling up on the root element
      // of this component, so something must be focused.
      this.onKeyDown(ev);
    });
    (0, _defineProperty2.default)(this, "onNativeKeyDown", ev => {
      // only pass this if there is no focused element.
      // if there is, onKeyDown will be called by the
      // react keydown handler that respects the react bubbling order.
      if (ev.target === document.body) {
        this.onKeyDown(ev);
      }
    });
    (0, _defineProperty2.default)(this, "onKeyDown", ev => {
      let handled = false;
      const roomAction = (0, _KeyBindingsManager.getKeyBindingsManager)().getRoomAction(ev);

      switch (roomAction) {
        case _KeyBindingsManager.RoomAction.ScrollUp:
        case _KeyBindingsManager.RoomAction.RoomScrollDown:
        case _KeyBindingsManager.RoomAction.JumpToFirstMessage:
        case _KeyBindingsManager.RoomAction.JumpToLatestMessage:
          // pass the event down to the scroll panel
          this.onScrollKeyPressed(ev);
          handled = true;
          break;

        case _KeyBindingsManager.RoomAction.FocusSearch:
          _dispatcher.default.dispatch({
            action: 'focus_search'
          });

          handled = true;
          break;
      }

      if (handled) {
        ev.stopPropagation();
        ev.preventDefault();
        return;
      }

      const navAction = (0, _KeyBindingsManager.getKeyBindingsManager)().getNavigationAction(ev);

      switch (navAction) {
        case _KeyBindingsManager.NavigationAction.FocusRoomSearch:
          _dispatcher.default.dispatch({
            action: 'focus_room_filter'
          });

          handled = true;
          break;

        case _KeyBindingsManager.NavigationAction.ToggleUserMenu:
          _dispatcher.default.fire(_actions.Action.ToggleUserMenu);

          handled = true;
          break;

        case _KeyBindingsManager.NavigationAction.ToggleShortCutDialog:
          KeyboardShortcuts.toggleDialog();
          handled = true;
          break;

        case _KeyBindingsManager.NavigationAction.GoToHome:
          _dispatcher.default.dispatch({
            action: 'view_home_page'
          });

          _Modal.default.closeCurrentModal("homeKeyboardShortcut");

          handled = true;
          break;

        case _KeyBindingsManager.NavigationAction.ToggleRoomSidePanel:
          if (this.props.page_type === "room_view" || this.props.page_type === "group_view") {
            _dispatcher.default.dispatch({
              action: _actions.Action.ToggleRightPanel,
              type: this.props.page_type === "room_view" ? "room" : "group"
            });

            handled = true;
          }

          break;

        case _KeyBindingsManager.NavigationAction.SelectPrevRoom:
          _dispatcher.default.dispatch({
            action: _actions.Action.ViewRoomDelta,
            delta: -1,
            unread: false
          });

          handled = true;
          break;

        case _KeyBindingsManager.NavigationAction.SelectNextRoom:
          _dispatcher.default.dispatch({
            action: _actions.Action.ViewRoomDelta,
            delta: 1,
            unread: false
          });

          handled = true;
          break;

        case _KeyBindingsManager.NavigationAction.SelectPrevUnreadRoom:
          _dispatcher.default.dispatch({
            action: _actions.Action.ViewRoomDelta,
            delta: -1,
            unread: true
          });

          break;

        case _KeyBindingsManager.NavigationAction.SelectNextUnreadRoom:
          _dispatcher.default.dispatch({
            action: _actions.Action.ViewRoomDelta,
            delta: 1,
            unread: true
          });

          break;

        default:
          // if we do not have a handler for it, pass it to the platform which might
          handled = _PlatformPeg.default.get().onKeyDown(ev);
      }

      if (handled) {
        ev.stopPropagation();
        ev.preventDefault();
        return;
      }

      const isModifier = ev.key === _Keyboard.Key.ALT || ev.key === _Keyboard.Key.CONTROL || ev.key === _Keyboard.Key.META || ev.key === _Keyboard.Key.SHIFT;

      if (!isModifier && !ev.ctrlKey && !ev.metaKey) {
        // The above condition is crafted to _allow_ characters with Shift
        // already pressed (but not the Shift key down itself).
        const isClickShortcut = ev.target !== document.body && (ev.key === _Keyboard.Key.SPACE || ev.key === _Keyboard.Key.ENTER); // We explicitly allow alt to be held due to it being a common accent modifier.
        // XXX: Forwarding Dead keys in this way does not work as intended but better to at least
        // move focus to the composer so the user can re-type the dead key correctly.

        const isPrintable = ev.key.length === 1 || ev.key === "Dead"; // If the user is entering a printable character outside of an input field
        // redirect it to the composer for them.

        if (!isClickShortcut && isPrintable && !getInputableElement(ev.target)) {
          // synchronous dispatch so we focus before key generates input
          _dispatcher.default.fire(_actions.Action.FocusSendMessageComposer, true);

          ev.stopPropagation(); // we should *not* preventDefault() here as that would prevent typing in the now-focused composer
        }
      }
    });
    (0, _defineProperty2.default)(this, "onScrollKeyPressed", ev => {
      if (this._roomView.current) {
        this._roomView.current.handleScrollKey(ev);
      }
    });
    this.state = {
      syncErrorData: undefined,
      // use compact timeline view
      useCompactLayout: _SettingsStore.default.getValue('useCompactLayout'),
      usageLimitDismissed: false,
      activeCalls: _CallHandler.default.sharedInstance().getAllActiveCalls()
    }; // stash the MatrixClient in case we log out before we are unmounted

    this._matrixClient = this.props.matrixClient;

    _MediaDeviceHandler.default.loadDevices();

    (0, _FontManager.fixupColorFonts)();
    this._roomView = /*#__PURE__*/_react.default.createRef();
    this._resizeContainer = /*#__PURE__*/_react.default.createRef();
    this.resizeHandler = /*#__PURE__*/_react.default.createRef();
  }

  componentDidMount() {
    document.addEventListener('keydown', this.onNativeKeyDown, false);
    this.dispatcherRef = _dispatcher.default.register(this.onAction);
    this.updateServerNoticeEvents();

    this._matrixClient.on("accountData", this.onAccountData);

    this._matrixClient.on("sync", this.onSync); // Call `onSync` with the current state as well


    this.onSync(this._matrixClient.getSyncState(), null, this._matrixClient.getSyncStateData());

    this._matrixClient.on("RoomState.events", this.onRoomStateEvents);

    this.compactLayoutWatcherRef = _SettingsStore.default.watchSetting("useCompactLayout", null, this.onCompactLayoutChanged);
    this.backgroundImageWatcherRef = _SettingsStore.default.watchSetting("RoomList.backgroundImage", null, this.refreshBackgroundImage);
    this.resizer = this.createResizer();
    this.resizer.attach();

    _OwnProfileStore.OwnProfileStore.instance.on(_AsyncStore.UPDATE_EVENT, this.refreshBackgroundImage);

    this.loadResizerPreferences();
    this.refreshBackgroundImage();
  }

  componentWillUnmount() {
    document.removeEventListener('keydown', this.onNativeKeyDown, false);

    _dispatcher.default.unregister(this.dispatcherRef);

    this._matrixClient.removeListener("accountData", this.onAccountData);

    this._matrixClient.removeListener("sync", this.onSync);

    this._matrixClient.removeListener("RoomState.events", this.onRoomStateEvents);

    _OwnProfileStore.OwnProfileStore.instance.off(_AsyncStore.UPDATE_EVENT, this.refreshBackgroundImage);

    _SettingsStore.default.unwatchSetting(this.compactLayoutWatcherRef);

    _SettingsStore.default.unwatchSetting(this.backgroundImageWatcherRef);

    this.resizer.detach();
  }

  createResizer() {
    let panelSize;
    let panelCollapsed;
    const collapseConfig = {
      // TODO decrease this once Spaces launches as it'll no longer need to include the 56px Community Panel
      toggleSize: 206 - 50,
      onCollapsed: collapsed => {
        panelCollapsed = collapsed;

        if (collapsed) {
          _dispatcher.default.dispatch({
            action: "hide_left_panel"
          });

          window.localStorage.setItem("mx_lhs_size", '0');
        } else {
          _dispatcher.default.dispatch({
            action: "show_left_panel"
          });
        }
      },
      onResized: size => {
        panelSize = size;
        this.props.resizeNotifier.notifyLeftHandleResized();
      },
      onResizeStart: () => {
        this.props.resizeNotifier.startResizing();
      },
      onResizeStop: () => {
        if (!panelCollapsed) window.localStorage.setItem("mx_lhs_size", '' + panelSize);
        this.props.resizeNotifier.stopResizing();
      },
      isItemCollapsed: domNode => {
        return domNode.classList.contains("mx_LeftPanel_minimized");
      },
      handler: this.resizeHandler.current
    };
    const resizer = new _resizer.Resizer(this._resizeContainer.current, _resizer.CollapseDistributor, collapseConfig);
    resizer.setClassNames({
      handle: "mx_ResizeHandle",
      vertical: "mx_ResizeHandle_vertical",
      reverse: "mx_ResizeHandle_reverse"
    });
    return resizer;
  }

  loadResizerPreferences() {
    let lhsSize = parseInt(window.localStorage.getItem("mx_lhs_size"), 10);

    if (isNaN(lhsSize)) {
      lhsSize = 350;
    }

    this.resizer.forHandleWithId('lp-resizer').resize(lhsSize);
  }

  calculateServerLimitToast(syncError, usageLimitEventContent) {
    const error = syncError && syncError.error && syncError.error.errcode === "M_RESOURCE_LIMIT_EXCEEDED";

    if (error) {
      usageLimitEventContent = syncError.error.data;
    } // usageLimitDismissed is true when the user has explicitly hidden the toast
    // and it will be reset to false if a *new* usage alert comes in.


    if (usageLimitEventContent && this.state.usageLimitDismissed) {
      (0, _ServerLimitToast.showToast)(usageLimitEventContent.limit_type, this.onUsageLimitDismissed, usageLimitEventContent.admin_contact, error);
    } else {
      (0, _ServerLimitToast.hideToast)();
    }
  }

  render() {
    let pageElement;

    switch (this.props.page_type) {
      case _PageTypes.default.RoomView:
        pageElement = /*#__PURE__*/_react.default.createElement(_RoomView.default, {
          ref: this._roomView,
          onRegistered: this.props.onRegistered,
          threepidInvite: this.props.threepidInvite,
          oobData: this.props.roomOobData,
          key: this.props.currentRoomId || 'roomview',
          resizeNotifier: this.props.resizeNotifier,
          justCreatedOpts: this.props.roomJustCreatedOpts,
          forceTimeline: this.props.forceTimeline
        });
        break;

      case _PageTypes.default.MyGroups:
        pageElement = /*#__PURE__*/_react.default.createElement(_MyGroups.default, null);
        break;

      case _PageTypes.default.RoomDirectory:
        // handled by MatrixChat for now
        break;

      case _PageTypes.default.HomePage:
        pageElement = /*#__PURE__*/_react.default.createElement(_HomePage.default, {
          justRegistered: this.props.justRegistered
        });
        break;

      case _PageTypes.default.UserView:
        pageElement = /*#__PURE__*/_react.default.createElement(_UserView.default, {
          userId: this.props.currentUserId,
          resizeNotifier: this.props.resizeNotifier
        });
        break;

      case _PageTypes.default.GroupView:
        if (_SpaceStore.default.spacesEnabled) {
          pageElement = /*#__PURE__*/_react.default.createElement(_LegacyCommunityPreview.default, {
            groupId: this.props.currentGroupId
          });
        } else {
          pageElement = /*#__PURE__*/_react.default.createElement(_GroupView.default, {
            groupId: this.props.currentGroupId,
            isNew: this.props.currentGroupIsNew,
            resizeNotifier: this.props.resizeNotifier
          });
        }

        break;
    }

    const wrapperClasses = (0, _classnames.default)({
      'mx_MatrixChat_wrapper': true,
      'mx_MatrixChat_useCompactLayout': this.state.useCompactLayout
    });
    const bodyClasses = (0, _classnames.default)({
      'mx_MatrixChat': true,
      'mx_MatrixChat--with-avatar': this.state.backgroundImage
    });
    const audioFeedArraysForCalls = this.state.activeCalls.map(call => {
      return /*#__PURE__*/_react.default.createElement(_AudioFeedArrayForCall.default, {
        call: call,
        key: call.callId
      });
    });
    return /*#__PURE__*/_react.default.createElement(_MatrixClientContext.default.Provider, {
      value: this._matrixClient
    }, /*#__PURE__*/_react.default.createElement("div", {
      onPaste: this.onPaste,
      onKeyDown: this.onReactKeyDown,
      className: wrapperClasses,
      "aria-hidden": this.props.hideToSRUsers
    }, /*#__PURE__*/_react.default.createElement(_ToastContainer.default, null), /*#__PURE__*/_react.default.createElement("div", {
      className: bodyClasses
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_LeftPanel_wrapper"
    }, _SettingsStore.default.getValue('TagPanel.enableTagPanel') && /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupFilterPanelContainer"
    }, /*#__PURE__*/_react.default.createElement(_BackdropPanel.default, {
      blurMultiplier: 0.5,
      backgroundImage: this.state.backgroundImage
    }), /*#__PURE__*/_react.default.createElement(_GroupFilterPanel.default, null), _SettingsStore.default.getValue("feature_custom_tags") ? /*#__PURE__*/_react.default.createElement(_CustomRoomTagPanel.default, null) : null), _SpaceStore.default.spacesEnabled ? /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_BackdropPanel.default, {
      blurMultiplier: 0.5,
      backgroundImage: this.state.backgroundImage
    }), /*#__PURE__*/_react.default.createElement(_SpacePanel.default, null)) : null, /*#__PURE__*/_react.default.createElement(_BackdropPanel.default, {
      backgroundImage: this.state.backgroundImage
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_LeftPanel_wrapper--user",
      ref: this._resizeContainer,
      "data-collapsed": this.props.collapseLhs ? true : undefined
    }, /*#__PURE__*/_react.default.createElement(_LeftPanel.default, {
      isMinimized: this.props.collapseLhs || false,
      resizeNotifier: this.props.resizeNotifier
    }))), /*#__PURE__*/_react.default.createElement(_ResizeHandle.default, {
      passRef: this.resizeHandler,
      id: "lp-resizer"
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_RoomView_wrapper"
    }, pageElement))), /*#__PURE__*/_react.default.createElement(_CallContainer.default, null), /*#__PURE__*/_react.default.createElement(_NonUrgentToastContainer.default, null), /*#__PURE__*/_react.default.createElement(_HostSignupContainer.default, null), audioFeedArraysForCalls);
  }

}, (0, _defineProperty2.default)(_class2, "displayName", 'LoggedInView'), _temp)) || _class);
var _default = LoggedInView;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvTG9nZ2VkSW5WaWV3LnRzeCJdLCJuYW1lcyI6WyJNQVhfUElOTkVEX05PVElDRVNfUEVSX1JPT00iLCJnZXRJbnB1dGFibGVFbGVtZW50IiwiZWwiLCJjbG9zZXN0IiwiTG9nZ2VkSW5WaWV3IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiY29udGV4dCIsImJhY2tncm91bmRJbWFnZSIsIlNldHRpbmdzU3RvcmUiLCJnZXRWYWx1ZSIsInNyY0h0dHAiLCJPd25Qcm9maWxlU3RvcmUiLCJpbnN0YW5jZSIsImdldEh0dHBBdmF0YXJVcmwiLCJzZXRTdGF0ZSIsInBheWxvYWQiLCJhY3Rpb24iLCJhY3RpdmVDYWxscyIsIkNhbGxIYW5kbGVyIiwic2hhcmVkSW5zdGFuY2UiLCJnZXRBbGxBY3RpdmVDYWxscyIsInN0YXRlIiwicm9vbUlkIiwiX3Jvb21WaWV3IiwiY3VycmVudCIsImNhblJlc2V0VGltZWxpbmUiLCJldmVudCIsImdldFR5cGUiLCJkaXMiLCJkaXNwYXRjaCIsInNldHRpbmciLCJsZXZlbCIsInZhbHVlQXRMZXZlbCIsIm5ld1ZhbHVlIiwidXNlQ29tcGFjdExheW91dCIsInN5bmNTdGF0ZSIsIm9sZFN5bmNTdGF0ZSIsImRhdGEiLCJvbGRFcnJDb2RlIiwic3luY0Vycm9yRGF0YSIsImVycm9yIiwiZXJyY29kZSIsIm5ld0VyckNvZGUiLCJ1cGRhdGVTZXJ2ZXJOb3RpY2VFdmVudHMiLCJjYWxjdWxhdGVTZXJ2ZXJMaW1pdFRvYXN0IiwidXNhZ2VMaW1pdEV2ZW50Q29udGVudCIsImV2Iiwic2VydmVyTm90aWNlTGlzdCIsIlJvb21MaXN0U3RvcmUiLCJvcmRlcmVkTGlzdHMiLCJEZWZhdWx0VGFnSUQiLCJTZXJ2ZXJOb3RpY2UiLCJzb21lIiwiciIsImdldFJvb21JZCIsInVzYWdlTGltaXREaXNtaXNzZWQiLCJldmVudHMiLCJwaW5uZWRFdmVudFRzIiwicm9vbSIsInBpblN0YXRlRXZlbnQiLCJjdXJyZW50U3RhdGUiLCJnZXRTdGF0ZUV2ZW50cyIsImdldENvbnRlbnQiLCJwaW5uZWQiLCJnZXRUcyIsInBpbm5lZEV2ZW50SWRzIiwic2xpY2UiLCJldmVudElkIiwidGltZWxpbmUiLCJfbWF0cml4Q2xpZW50IiwiZ2V0RXZlbnRUaW1lbGluZSIsImdldFVuZmlsdGVyZWRUaW1lbGluZVNldCIsImdldEV2ZW50cyIsImZpbmQiLCJnZXRJZCIsInB1c2giLCJ1c2FnZUxpbWl0RXZlbnRUcyIsInVzYWdlTGltaXRFdmVudCIsImUiLCJlbGVtZW50IiwidGFyZ2V0IiwiaW5wdXRhYmxlRWxlbWVudCIsImZvY3VzIiwiZmlyZSIsIkFjdGlvbiIsIkZvY3VzU2VuZE1lc3NhZ2VDb21wb3NlciIsIm9uS2V5RG93biIsImRvY3VtZW50IiwiYm9keSIsImhhbmRsZWQiLCJyb29tQWN0aW9uIiwiZ2V0Um9vbUFjdGlvbiIsIlJvb21BY3Rpb24iLCJTY3JvbGxVcCIsIlJvb21TY3JvbGxEb3duIiwiSnVtcFRvRmlyc3RNZXNzYWdlIiwiSnVtcFRvTGF0ZXN0TWVzc2FnZSIsIm9uU2Nyb2xsS2V5UHJlc3NlZCIsIkZvY3VzU2VhcmNoIiwic3RvcFByb3BhZ2F0aW9uIiwicHJldmVudERlZmF1bHQiLCJuYXZBY3Rpb24iLCJnZXROYXZpZ2F0aW9uQWN0aW9uIiwiTmF2aWdhdGlvbkFjdGlvbiIsIkZvY3VzUm9vbVNlYXJjaCIsIlRvZ2dsZVVzZXJNZW51IiwiVG9nZ2xlU2hvcnRDdXREaWFsb2ciLCJLZXlib2FyZFNob3J0Y3V0cyIsInRvZ2dsZURpYWxvZyIsIkdvVG9Ib21lIiwiTW9kYWwiLCJjbG9zZUN1cnJlbnRNb2RhbCIsIlRvZ2dsZVJvb21TaWRlUGFuZWwiLCJwYWdlX3R5cGUiLCJUb2dnbGVSaWdodFBhbmVsIiwidHlwZSIsIlNlbGVjdFByZXZSb29tIiwiVmlld1Jvb21EZWx0YSIsImRlbHRhIiwidW5yZWFkIiwiU2VsZWN0TmV4dFJvb20iLCJTZWxlY3RQcmV2VW5yZWFkUm9vbSIsIlNlbGVjdE5leHRVbnJlYWRSb29tIiwiUGxhdGZvcm1QZWciLCJnZXQiLCJpc01vZGlmaWVyIiwia2V5IiwiS2V5IiwiQUxUIiwiQ09OVFJPTCIsIk1FVEEiLCJTSElGVCIsImN0cmxLZXkiLCJtZXRhS2V5IiwiaXNDbGlja1Nob3J0Y3V0IiwiU1BBQ0UiLCJFTlRFUiIsImlzUHJpbnRhYmxlIiwibGVuZ3RoIiwiaGFuZGxlU2Nyb2xsS2V5IiwidW5kZWZpbmVkIiwibWF0cml4Q2xpZW50IiwiTWVkaWFEZXZpY2VIYW5kbGVyIiwibG9hZERldmljZXMiLCJjcmVhdGVSZWYiLCJfcmVzaXplQ29udGFpbmVyIiwicmVzaXplSGFuZGxlciIsImNvbXBvbmVudERpZE1vdW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uTmF0aXZlS2V5RG93biIsImRpc3BhdGNoZXJSZWYiLCJyZWdpc3RlciIsIm9uQWN0aW9uIiwib24iLCJvbkFjY291bnREYXRhIiwib25TeW5jIiwiZ2V0U3luY1N0YXRlIiwiZ2V0U3luY1N0YXRlRGF0YSIsIm9uUm9vbVN0YXRlRXZlbnRzIiwiY29tcGFjdExheW91dFdhdGNoZXJSZWYiLCJ3YXRjaFNldHRpbmciLCJvbkNvbXBhY3RMYXlvdXRDaGFuZ2VkIiwiYmFja2dyb3VuZEltYWdlV2F0Y2hlclJlZiIsInJlZnJlc2hCYWNrZ3JvdW5kSW1hZ2UiLCJyZXNpemVyIiwiY3JlYXRlUmVzaXplciIsImF0dGFjaCIsIlVQREFURV9FVkVOVCIsImxvYWRSZXNpemVyUHJlZmVyZW5jZXMiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJ1bnJlZ2lzdGVyIiwicmVtb3ZlTGlzdGVuZXIiLCJvZmYiLCJ1bndhdGNoU2V0dGluZyIsImRldGFjaCIsInBhbmVsU2l6ZSIsInBhbmVsQ29sbGFwc2VkIiwiY29sbGFwc2VDb25maWciLCJ0b2dnbGVTaXplIiwib25Db2xsYXBzZWQiLCJjb2xsYXBzZWQiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwib25SZXNpemVkIiwic2l6ZSIsInJlc2l6ZU5vdGlmaWVyIiwibm90aWZ5TGVmdEhhbmRsZVJlc2l6ZWQiLCJvblJlc2l6ZVN0YXJ0Iiwic3RhcnRSZXNpemluZyIsIm9uUmVzaXplU3RvcCIsInN0b3BSZXNpemluZyIsImlzSXRlbUNvbGxhcHNlZCIsImRvbU5vZGUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImhhbmRsZXIiLCJSZXNpemVyIiwiQ29sbGFwc2VEaXN0cmlidXRvciIsInNldENsYXNzTmFtZXMiLCJoYW5kbGUiLCJ2ZXJ0aWNhbCIsInJldmVyc2UiLCJsaHNTaXplIiwicGFyc2VJbnQiLCJnZXRJdGVtIiwiaXNOYU4iLCJmb3JIYW5kbGVXaXRoSWQiLCJyZXNpemUiLCJzeW5jRXJyb3IiLCJsaW1pdF90eXBlIiwib25Vc2FnZUxpbWl0RGlzbWlzc2VkIiwiYWRtaW5fY29udGFjdCIsInJlbmRlciIsInBhZ2VFbGVtZW50IiwiUGFnZVR5cGVzIiwiUm9vbVZpZXciLCJvblJlZ2lzdGVyZWQiLCJ0aHJlZXBpZEludml0ZSIsInJvb21Pb2JEYXRhIiwiY3VycmVudFJvb21JZCIsInJvb21KdXN0Q3JlYXRlZE9wdHMiLCJmb3JjZVRpbWVsaW5lIiwiTXlHcm91cHMiLCJSb29tRGlyZWN0b3J5IiwiSG9tZVBhZ2UiLCJqdXN0UmVnaXN0ZXJlZCIsIlVzZXJWaWV3IiwiY3VycmVudFVzZXJJZCIsIkdyb3VwVmlldyIsIlNwYWNlU3RvcmUiLCJzcGFjZXNFbmFibGVkIiwiY3VycmVudEdyb3VwSWQiLCJjdXJyZW50R3JvdXBJc05ldyIsIndyYXBwZXJDbGFzc2VzIiwiYm9keUNsYXNzZXMiLCJhdWRpb0ZlZWRBcnJheXNGb3JDYWxscyIsIm1hcCIsImNhbGwiLCJjYWxsSWQiLCJvblBhc3RlIiwib25SZWFjdEtleURvd24iLCJoaWRlVG9TUlVzZXJzIiwiY29sbGFwc2VMaHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUlBOztBQUNB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QkFBQyxzQkFBRDtBQUNJLE1BQUEsY0FBYyxFQUFFLEdBRHBCO0FBRUksTUFBQSxlQUFlLEVBQUUsS0FBS25OLEtBQUwsQ0FBV2Q7QUFGaEMsTUFEeUIsZUFLekIsNkJBQUMsbUJBQUQsT0FMeUIsQ0FBM0IsR0FNSSxJQWpCVixlQWtCSSw2QkFBQyxzQkFBRDtBQUNJLE1BQUEsZUFBZSxFQUFFLEtBQUtjLEtBQUwsQ0FBV2Q7QUFEaEMsTUFsQkosZUFxQkk7QUFDSSxNQUFBLFNBQVMsRUFBQyw0QkFEZDtBQUVJLE1BQUEsR0FBRyxFQUFFLEtBQUswSSxnQkFGZDtBQUdJLHdCQUFnQixLQUFLNUksS0FBTCxDQUFXK08sV0FBWCxHQUF5QixJQUF6QixHQUFnQ3hHO0FBSHBELG9CQUtJLDZCQUFDLGtCQUFEO0FBQ0ksTUFBQSxXQUFXLEVBQUUsS0FBS3ZJLEtBQUwsQ0FBVytPLFdBQVgsSUFBMEIsS0FEM0M7QUFFSSxNQUFBLGNBQWMsRUFBRSxLQUFLL08sS0FBTCxDQUFXc0w7QUFGL0IsTUFMSixDQXJCSixDQURKLGVBaUNJLDZCQUFDLHFCQUFEO0FBQWMsTUFBQSxPQUFPLEVBQUUsS0FBS3pDLGFBQTVCO0FBQTJDLE1BQUEsRUFBRSxFQUFDO0FBQTlDLE1BakNKLGVBa0NJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNNcUUsV0FETixDQWxDSixDQVBKLENBREosZUErQ0ksNkJBQUMsc0JBQUQsT0EvQ0osZUFnREksNkJBQUMsZ0NBQUQsT0FoREosZUFpREksNkJBQUMsNEJBQUQsT0FqREosRUFrRE1zQix1QkFsRE4sQ0FESjtBQXNESDs7QUFwakJzRCxDLHdEQUNsQyxjO2VBc2pCVjVPLFkiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUgLSAyMDIxIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7IENsaXBib2FyZEV2ZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50IH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvY2xpZW50JztcbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSAnbWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL2V2ZW50JztcblxuaW1wb3J0IHsgS2V5IH0gZnJvbSAnLi4vLi4vS2V5Ym9hcmQnO1xuaW1wb3J0IFBhZ2VUeXBlcyBmcm9tICcuLi8uLi9QYWdlVHlwZXMnO1xuaW1wb3J0IE1lZGlhRGV2aWNlSGFuZGxlciBmcm9tICcuLi8uLi9NZWRpYURldmljZUhhbmRsZXInO1xuaW1wb3J0IHsgZml4dXBDb2xvckZvbnRzIH0gZnJvbSAnLi4vLi4vdXRpbHMvRm9udE1hbmFnZXInO1xuaW1wb3J0IGRpcyBmcm9tICcuLi8uLi9kaXNwYXRjaGVyL2Rpc3BhdGNoZXInO1xuaW1wb3J0IHsgSU1hdHJpeENsaWVudENyZWRzIH0gZnJvbSAnLi4vLi4vTWF0cml4Q2xpZW50UGVnJztcbmltcG9ydCBTZXR0aW5nc1N0b3JlIGZyb20gXCIuLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5cbmltcG9ydCBSZXNpemVIYW5kbGUgZnJvbSAnLi4vdmlld3MvZWxlbWVudHMvUmVzaXplSGFuZGxlJztcbmltcG9ydCB7IFJlc2l6ZXIsIENvbGxhcHNlRGlzdHJpYnV0b3IgfSBmcm9tICcuLi8uLi9yZXNpemVyJztcbmltcG9ydCBNYXRyaXhDbGllbnRDb250ZXh0IGZyb20gXCIuLi8uLi9jb250ZXh0cy9NYXRyaXhDbGllbnRDb250ZXh0XCI7XG5pbXBvcnQgKiBhcyBLZXlib2FyZFNob3J0Y3V0cyBmcm9tIFwiLi4vLi4vYWNjZXNzaWJpbGl0eS9LZXlib2FyZFNob3J0Y3V0c1wiO1xuaW1wb3J0IEhvbWVQYWdlIGZyb20gXCIuL0hvbWVQYWdlXCI7XG5pbXBvcnQgUmVzaXplTm90aWZpZXIgZnJvbSBcIi4uLy4uL3V0aWxzL1Jlc2l6ZU5vdGlmaWVyXCI7XG5pbXBvcnQgUGxhdGZvcm1QZWcgZnJvbSBcIi4uLy4uL1BsYXRmb3JtUGVnXCI7XG5pbXBvcnQgeyBEZWZhdWx0VGFnSUQgfSBmcm9tIFwiLi4vLi4vc3RvcmVzL3Jvb20tbGlzdC9tb2RlbHNcIjtcbmltcG9ydCB7XG4gICAgc2hvd1RvYXN0IGFzIHNob3dTZXJ2ZXJMaW1pdFRvYXN0LFxuICAgIGhpZGVUb2FzdCBhcyBoaWRlU2VydmVyTGltaXRUb2FzdCxcbn0gZnJvbSBcIi4uLy4uL3RvYXN0cy9TZXJ2ZXJMaW1pdFRvYXN0XCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zXCI7XG5pbXBvcnQgTGVmdFBhbmVsIGZyb20gXCIuL0xlZnRQYW5lbFwiO1xuaW1wb3J0IENhbGxDb250YWluZXIgZnJvbSAnLi4vdmlld3Mvdm9pcC9DYWxsQ29udGFpbmVyJztcbmltcG9ydCB7IFZpZXdSb29tRGVsdGFQYXlsb2FkIH0gZnJvbSBcIi4uLy4uL2Rpc3BhdGNoZXIvcGF5bG9hZHMvVmlld1Jvb21EZWx0YVBheWxvYWRcIjtcbmltcG9ydCBSb29tTGlzdFN0b3JlIGZyb20gXCIuLi8uLi9zdG9yZXMvcm9vbS1saXN0L1Jvb21MaXN0U3RvcmVcIjtcbmltcG9ydCBOb25VcmdlbnRUb2FzdENvbnRhaW5lciBmcm9tIFwiLi9Ob25VcmdlbnRUb2FzdENvbnRhaW5lclwiO1xuaW1wb3J0IHsgVG9nZ2xlUmlnaHRQYW5lbFBheWxvYWQgfSBmcm9tIFwiLi4vLi4vZGlzcGF0Y2hlci9wYXlsb2Fkcy9Ub2dnbGVSaWdodFBhbmVsUGF5bG9hZFwiO1xuaW1wb3J0IHsgSU9PQkRhdGEsIElUaHJlZXBpZEludml0ZSB9IGZyb20gXCIuLi8uLi9zdG9yZXMvVGhyZWVwaWRJbnZpdGVTdG9yZVwiO1xuaW1wb3J0IE1vZGFsIGZyb20gXCIuLi8uLi9Nb2RhbFwiO1xuaW1wb3J0IHsgSUNvbGxhcHNlQ29uZmlnIH0gZnJvbSBcIi4uLy4uL3Jlc2l6ZXIvZGlzdHJpYnV0b3JzL2NvbGxhcHNlXCI7XG5pbXBvcnQgSG9zdFNpZ251cENvbnRhaW5lciBmcm9tICcuLi92aWV3cy9ob3N0X3NpZ251cC9Ib3N0U2lnbnVwQ29udGFpbmVyJztcbmltcG9ydCB7IGdldEtleUJpbmRpbmdzTWFuYWdlciwgTmF2aWdhdGlvbkFjdGlvbiwgUm9vbUFjdGlvbiB9IGZyb20gJy4uLy4uL0tleUJpbmRpbmdzTWFuYWdlcic7XG5pbXBvcnQgeyBJT3B0cyB9IGZyb20gXCIuLi8uLi9jcmVhdGVSb29tXCI7XG5pbXBvcnQgU3BhY2VQYW5lbCBmcm9tIFwiLi4vdmlld3Mvc3BhY2VzL1NwYWNlUGFuZWxcIjtcbmltcG9ydCB7IHJlcGxhY2VhYmxlQ29tcG9uZW50IH0gZnJvbSBcIi4uLy4uL3V0aWxzL3JlcGxhY2VhYmxlQ29tcG9uZW50XCI7XG5pbXBvcnQgQ2FsbEhhbmRsZXIgZnJvbSAnLi4vLi4vQ2FsbEhhbmRsZXInO1xuaW1wb3J0IHsgTWF0cml4Q2FsbCB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL3dlYnJ0Yy9jYWxsJztcbmltcG9ydCBBdWRpb0ZlZWRBcnJheUZvckNhbGwgZnJvbSAnLi4vdmlld3Mvdm9pcC9BdWRpb0ZlZWRBcnJheUZvckNhbGwnO1xuaW1wb3J0IHsgT3duUHJvZmlsZVN0b3JlIH0gZnJvbSAnLi4vLi4vc3RvcmVzL093blByb2ZpbGVTdG9yZSc7XG5pbXBvcnQgeyBVUERBVEVfRVZFTlQgfSBmcm9tIFwiLi4vLi4vc3RvcmVzL0FzeW5jU3RvcmVcIjtcbmltcG9ydCBSb29tVmlldyBmcm9tICcuL1Jvb21WaWV3JztcbmltcG9ydCBUb2FzdENvbnRhaW5lciBmcm9tICcuL1RvYXN0Q29udGFpbmVyJztcbmltcG9ydCBNeUdyb3VwcyBmcm9tIFwiLi9NeUdyb3Vwc1wiO1xuaW1wb3J0IFVzZXJWaWV3IGZyb20gXCIuL1VzZXJWaWV3XCI7XG5pbXBvcnQgR3JvdXBWaWV3IGZyb20gXCIuL0dyb3VwVmlld1wiO1xuaW1wb3J0IEJhY2tkcm9wUGFuZWwgZnJvbSBcIi4vQmFja2Ryb3BQYW5lbFwiO1xuaW1wb3J0IFNwYWNlU3RvcmUgZnJvbSBcIi4uLy4uL3N0b3Jlcy9zcGFjZXMvU3BhY2VTdG9yZVwiO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgR3JvdXBGaWx0ZXJQYW5lbCBmcm9tICcuL0dyb3VwRmlsdGVyUGFuZWwnO1xuaW1wb3J0IEN1c3RvbVJvb21UYWdQYW5lbCBmcm9tICcuL0N1c3RvbVJvb21UYWdQYW5lbCc7XG5pbXBvcnQgeyBtZWRpYUZyb21NeGMgfSBmcm9tIFwiLi4vLi4vY3VzdG9taXNhdGlvbnMvTWVkaWFcIjtcbmltcG9ydCBMZWdhY3lDb21tdW5pdHlQcmV2aWV3IGZyb20gXCIuL0xlZ2FjeUNvbW11bml0eVByZXZpZXdcIjtcblxuLy8gV2UgbmVlZCB0byBmZXRjaCBlYWNoIHBpbm5lZCBtZXNzYWdlIGluZGl2aWR1YWxseSAoaWYgd2UgZG9uJ3QgYWxyZWFkeSBoYXZlIGl0KVxuLy8gc28gZWFjaCBwaW5uZWQgbWVzc2FnZSBtYXkgdHJpZ2dlciBhIHJlcXVlc3QuIExpbWl0IHRoZSBudW1iZXIgcGVyIHJvb20gZm9yIHNhbml0eS5cbi8vIE5CLiB0aGlzIGlzIGp1c3QgZm9yIHNlcnZlciBub3RpY2VzIHJhdGhlciB0aGFuIHBpbm5lZCBtZXNzYWdlcyBpbiBnZW5lcmFsLlxuY29uc3QgTUFYX1BJTk5FRF9OT1RJQ0VTX1BFUl9ST09NID0gMjtcblxuZnVuY3Rpb24gZ2V0SW5wdXRhYmxlRWxlbWVudChlbDogSFRNTEVsZW1lbnQpOiBIVE1MRWxlbWVudCB8IG51bGwge1xuICAgIHJldHVybiBlbC5jbG9zZXN0KFwiaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QsIFtjb250ZW50ZWRpdGFibGU9dHJ1ZV1cIik7XG59XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIG1hdHJpeENsaWVudDogTWF0cml4Q2xpZW50O1xuICAgIC8vIENhbGxlZCB3aXRoIHRoZSBjcmVkZW50aWFscyBvZiBhIHJlZ2lzdGVyZWQgdXNlciAoaWYgdGhleSB3ZXJlIGEgUk9VIHRoYXRcbiAgICAvLyB0cmFuc2l0aW9uZWQgdG8gUFdMVSlcbiAgICBvblJlZ2lzdGVyZWQ6IChjcmVkZW50aWFsczogSU1hdHJpeENsaWVudENyZWRzKSA9PiBQcm9taXNlPE1hdHJpeENsaWVudD47XG4gICAgaGlkZVRvU1JVc2VyczogYm9vbGVhbjtcbiAgICByZXNpemVOb3RpZmllcjogUmVzaXplTm90aWZpZXI7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuICAgIHBhZ2VfdHlwZT86IHN0cmluZztcbiAgICBhdXRvSm9pbj86IGJvb2xlYW47XG4gICAgdGhyZWVwaWRJbnZpdGU/OiBJVGhyZWVwaWRJbnZpdGU7XG4gICAgcm9vbU9vYkRhdGE/OiBJT09CRGF0YTtcbiAgICBjdXJyZW50Um9vbUlkOiBzdHJpbmc7XG4gICAgY29sbGFwc2VMaHM6IGJvb2xlYW47XG4gICAgY29uZmlnOiB7XG4gICAgICAgIHBpd2lrOiB7XG4gICAgICAgICAgICBwb2xpY3lVcmw6IHN0cmluZztcbiAgICAgICAgfTtcbiAgICAgICAgW2tleTogc3RyaW5nXTogYW55O1xuICAgIH07XG4gICAgY3VycmVudFVzZXJJZD86IHN0cmluZztcbiAgICBjdXJyZW50R3JvdXBJZD86IHN0cmluZztcbiAgICBjdXJyZW50R3JvdXBJc05ldz86IGJvb2xlYW47XG4gICAganVzdFJlZ2lzdGVyZWQ/OiBib29sZWFuO1xuICAgIHJvb21KdXN0Q3JlYXRlZE9wdHM/OiBJT3B0cztcbiAgICBmb3JjZVRpbWVsaW5lPzogYm9vbGVhbjsgLy8gc2VlIHByb3BzIG9uIE1hdHJpeENoYXRcbn1cblxuaW50ZXJmYWNlIElVc2FnZUxpbWl0IHtcbiAgICAvLyBcImhzX2Rpc2FibGVkXCIgaXMgTk9UIGEgc3BlY2NlZCBzdHJpbmcsIGJ1dCBpcyB1c2VkIGluIFN5bmFwc2VcbiAgICAvLyBUaGlzIGlzIHRyYWNrZWQgb3ZlciBhdCBodHRwczovL2dpdGh1Yi5jb20vbWF0cml4LW9yZy9zeW5hcHNlL2lzc3Vlcy85MjM3XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuICAgIGxpbWl0X3R5cGU6IFwibW9udGhseV9hY3RpdmVfdXNlclwiIHwgXCJoc19kaXNhYmxlZFwiIHwgc3RyaW5nO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2VcbiAgICBhZG1pbl9jb250YWN0Pzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBzeW5jRXJyb3JEYXRhPzoge1xuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgLy8gVGhpcyBpcyBub3Qgc3BlY2NlZCwgYnV0IHVzZWQgaW4gU3luYXBzZS4gU2VlXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbWF0cml4LW9yZy9zeW5hcHNlL2lzc3Vlcy85MjM3I2lzc3VlY29tbWVudC03NjgyMzg5MjJcbiAgICAgICAgICAgIGRhdGE6IElVc2FnZUxpbWl0O1xuICAgICAgICAgICAgZXJyY29kZTogc3RyaW5nO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgdXNhZ2VMaW1pdERpc21pc3NlZDogYm9vbGVhbjtcbiAgICB1c2FnZUxpbWl0RXZlbnRDb250ZW50PzogSVVzYWdlTGltaXQ7XG4gICAgdXNhZ2VMaW1pdEV2ZW50VHM/OiBudW1iZXI7XG4gICAgdXNlQ29tcGFjdExheW91dDogYm9vbGVhbjtcbiAgICBhY3RpdmVDYWxsczogQXJyYXk8TWF0cml4Q2FsbD47XG4gICAgYmFja2dyb3VuZEltYWdlPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFRoaXMgaXMgd2hhdCBvdXIgTWF0cml4Q2hhdCBzaG93cyB3aGVuIHdlIGFyZSBsb2dnZWQgaW4uIFRoZSBwcmVjaXNlIHZpZXcgaXNcbiAqIGRldGVybWluZWQgYnkgdGhlIHBhZ2VfdHlwZSBwcm9wZXJ0eS5cbiAqXG4gKiBDdXJyZW50bHkgaXQncyB2ZXJ5IHRpZ2h0bHkgY291cGxlZCB3aXRoIE1hdHJpeENoYXQuIFdlIHNob3VsZCB0cnkgdG8gZG9cbiAqIHNvbWV0aGluZyBhYm91dCB0aGF0LlxuICpcbiAqIENvbXBvbmVudHMgbW91bnRlZCBiZWxvdyB1cyBjYW4gYWNjZXNzIHRoZSBtYXRyaXggY2xpZW50IHZpYSB0aGUgcmVhY3QgY29udGV4dC5cbiAqL1xuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwic3RydWN0dXJlcy5Mb2dnZWRJblZpZXdcIilcbmNsYXNzIExvZ2dlZEluVmlldyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJUHJvcHMsIElTdGF0ZT4ge1xuICAgIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdMb2dnZWRJblZpZXcnO1xuXG4gICAgcHJpdmF0ZSBkaXNwYXRjaGVyUmVmOiBzdHJpbmc7XG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IF9tYXRyaXhDbGllbnQ6IE1hdHJpeENsaWVudDtcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgX3Jvb21WaWV3OiBSZWFjdC5SZWZPYmplY3Q8YW55PjtcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgX3Jlc2l6ZUNvbnRhaW5lcjogUmVhY3QuUmVmT2JqZWN0PEhUTUxEaXZFbGVtZW50PjtcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgcmVzaXplSGFuZGxlcjogUmVhY3QuUmVmT2JqZWN0PEhUTUxEaXZFbGVtZW50PjtcbiAgICBwcm90ZWN0ZWQgY29tcGFjdExheW91dFdhdGNoZXJSZWY6IHN0cmluZztcbiAgICBwcm90ZWN0ZWQgYmFja2dyb3VuZEltYWdlV2F0Y2hlclJlZjogc3RyaW5nO1xuICAgIHByb3RlY3RlZCByZXNpemVyOiBSZXNpemVyO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBzeW5jRXJyb3JEYXRhOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAvLyB1c2UgY29tcGFjdCB0aW1lbGluZSB2aWV3XG4gICAgICAgICAgICB1c2VDb21wYWN0TGF5b3V0OiBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKCd1c2VDb21wYWN0TGF5b3V0JyksXG4gICAgICAgICAgICB1c2FnZUxpbWl0RGlzbWlzc2VkOiBmYWxzZSxcbiAgICAgICAgICAgIGFjdGl2ZUNhbGxzOiBDYWxsSGFuZGxlci5zaGFyZWRJbnN0YW5jZSgpLmdldEFsbEFjdGl2ZUNhbGxzKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3Rhc2ggdGhlIE1hdHJpeENsaWVudCBpbiBjYXNlIHdlIGxvZyBvdXQgYmVmb3JlIHdlIGFyZSB1bm1vdW50ZWRcbiAgICAgICAgdGhpcy5fbWF0cml4Q2xpZW50ID0gdGhpcy5wcm9wcy5tYXRyaXhDbGllbnQ7XG5cbiAgICAgICAgTWVkaWFEZXZpY2VIYW5kbGVyLmxvYWREZXZpY2VzKCk7XG5cbiAgICAgICAgZml4dXBDb2xvckZvbnRzKCk7XG5cbiAgICAgICAgdGhpcy5fcm9vbVZpZXcgPSBSZWFjdC5jcmVhdGVSZWYoKTtcbiAgICAgICAgdGhpcy5fcmVzaXplQ29udGFpbmVyID0gUmVhY3QuY3JlYXRlUmVmKCk7XG4gICAgICAgIHRoaXMucmVzaXplSGFuZGxlciA9IFJlYWN0LmNyZWF0ZVJlZigpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5vbk5hdGl2ZUtleURvd24sIGZhbHNlKTtcbiAgICAgICAgdGhpcy5kaXNwYXRjaGVyUmVmID0gZGlzLnJlZ2lzdGVyKHRoaXMub25BY3Rpb24pO1xuXG4gICAgICAgIHRoaXMudXBkYXRlU2VydmVyTm90aWNlRXZlbnRzKCk7XG5cbiAgICAgICAgdGhpcy5fbWF0cml4Q2xpZW50Lm9uKFwiYWNjb3VudERhdGFcIiwgdGhpcy5vbkFjY291bnREYXRhKTtcbiAgICAgICAgdGhpcy5fbWF0cml4Q2xpZW50Lm9uKFwic3luY1wiLCB0aGlzLm9uU3luYyk7XG4gICAgICAgIC8vIENhbGwgYG9uU3luY2Agd2l0aCB0aGUgY3VycmVudCBzdGF0ZSBhcyB3ZWxsXG4gICAgICAgIHRoaXMub25TeW5jKFxuICAgICAgICAgICAgdGhpcy5fbWF0cml4Q2xpZW50LmdldFN5bmNTdGF0ZSgpLFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgIHRoaXMuX21hdHJpeENsaWVudC5nZXRTeW5jU3RhdGVEYXRhKCksXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuX21hdHJpeENsaWVudC5vbihcIlJvb21TdGF0ZS5ldmVudHNcIiwgdGhpcy5vblJvb21TdGF0ZUV2ZW50cyk7XG5cbiAgICAgICAgdGhpcy5jb21wYWN0TGF5b3V0V2F0Y2hlclJlZiA9IFNldHRpbmdzU3RvcmUud2F0Y2hTZXR0aW5nKFxuICAgICAgICAgICAgXCJ1c2VDb21wYWN0TGF5b3V0XCIsIG51bGwsIHRoaXMub25Db21wYWN0TGF5b3V0Q2hhbmdlZCxcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2VXYXRjaGVyUmVmID0gU2V0dGluZ3NTdG9yZS53YXRjaFNldHRpbmcoXG4gICAgICAgICAgICBcIlJvb21MaXN0LmJhY2tncm91bmRJbWFnZVwiLCBudWxsLCB0aGlzLnJlZnJlc2hCYWNrZ3JvdW5kSW1hZ2UsXG4gICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5yZXNpemVyID0gdGhpcy5jcmVhdGVSZXNpemVyKCk7XG4gICAgICAgIHRoaXMucmVzaXplci5hdHRhY2goKTtcblxuICAgICAgICBPd25Qcm9maWxlU3RvcmUuaW5zdGFuY2Uub24oVVBEQVRFX0VWRU5ULCB0aGlzLnJlZnJlc2hCYWNrZ3JvdW5kSW1hZ2UpO1xuICAgICAgICB0aGlzLmxvYWRSZXNpemVyUHJlZmVyZW5jZXMoKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoQmFja2dyb3VuZEltYWdlKCk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLm9uTmF0aXZlS2V5RG93biwgZmFsc2UpO1xuICAgICAgICBkaXMudW5yZWdpc3Rlcih0aGlzLmRpc3BhdGNoZXJSZWYpO1xuICAgICAgICB0aGlzLl9tYXRyaXhDbGllbnQucmVtb3ZlTGlzdGVuZXIoXCJhY2NvdW50RGF0YVwiLCB0aGlzLm9uQWNjb3VudERhdGEpO1xuICAgICAgICB0aGlzLl9tYXRyaXhDbGllbnQucmVtb3ZlTGlzdGVuZXIoXCJzeW5jXCIsIHRoaXMub25TeW5jKTtcbiAgICAgICAgdGhpcy5fbWF0cml4Q2xpZW50LnJlbW92ZUxpc3RlbmVyKFwiUm9vbVN0YXRlLmV2ZW50c1wiLCB0aGlzLm9uUm9vbVN0YXRlRXZlbnRzKTtcbiAgICAgICAgT3duUHJvZmlsZVN0b3JlLmluc3RhbmNlLm9mZihVUERBVEVfRVZFTlQsIHRoaXMucmVmcmVzaEJhY2tncm91bmRJbWFnZSk7XG4gICAgICAgIFNldHRpbmdzU3RvcmUudW53YXRjaFNldHRpbmcodGhpcy5jb21wYWN0TGF5b3V0V2F0Y2hlclJlZik7XG4gICAgICAgIFNldHRpbmdzU3RvcmUudW53YXRjaFNldHRpbmcodGhpcy5iYWNrZ3JvdW5kSW1hZ2VXYXRjaGVyUmVmKTtcbiAgICAgICAgdGhpcy5yZXNpemVyLmRldGFjaCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVmcmVzaEJhY2tncm91bmRJbWFnZSA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgbGV0IGJhY2tncm91bmRJbWFnZSA9IFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJSb29tTGlzdC5iYWNrZ3JvdW5kSW1hZ2VcIik7XG4gICAgICAgIGlmIChiYWNrZ3JvdW5kSW1hZ2UpIHtcbiAgICAgICAgICAgIC8vIGNvbnZlcnQgdG8gaHR0cCBiZWZvcmUgZ29pbmcgbXVjaCBmdXJ0aGVyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2UgPSBtZWRpYUZyb21NeGMoYmFja2dyb3VuZEltYWdlKS5zcmNIdHRwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlID0gT3duUHJvZmlsZVN0b3JlLmluc3RhbmNlLmdldEh0dHBBdmF0YXJVcmwoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgYmFja2dyb3VuZEltYWdlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQWN0aW9uID0gKHBheWxvYWQpOiB2b2lkID0+IHtcbiAgICAgICAgc3dpdGNoIChwYXlsb2FkLmFjdGlvbikge1xuICAgICAgICAgICAgY2FzZSAnY2FsbF9zdGF0ZSc6IHtcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVDYWxscyA9IENhbGxIYW5kbGVyLnNoYXJlZEluc3RhbmNlKCkuZ2V0QWxsQWN0aXZlQ2FsbHMoKTtcbiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlQ2FsbHMgIT09IHRoaXMuc3RhdGUuYWN0aXZlQ2FsbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGFjdGl2ZUNhbGxzIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwdWJsaWMgY2FuUmVzZXRUaW1lbGluZUluUm9vbSA9IChyb29tSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuX3Jvb21WaWV3LmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9yb29tVmlldy5jdXJyZW50LmNhblJlc2V0VGltZWxpbmUoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjcmVhdGVSZXNpemVyKCkge1xuICAgICAgICBsZXQgcGFuZWxTaXplO1xuICAgICAgICBsZXQgcGFuZWxDb2xsYXBzZWQ7XG4gICAgICAgIGNvbnN0IGNvbGxhcHNlQ29uZmlnOiBJQ29sbGFwc2VDb25maWcgPSB7XG4gICAgICAgICAgICAvLyBUT0RPIGRlY3JlYXNlIHRoaXMgb25jZSBTcGFjZXMgbGF1bmNoZXMgYXMgaXQnbGwgbm8gbG9uZ2VyIG5lZWQgdG8gaW5jbHVkZSB0aGUgNTZweCBDb21tdW5pdHkgUGFuZWxcbiAgICAgICAgICAgIHRvZ2dsZVNpemU6IDIwNiAtIDUwLFxuICAgICAgICAgICAgb25Db2xsYXBzZWQ6IChjb2xsYXBzZWQpID0+IHtcbiAgICAgICAgICAgICAgICBwYW5lbENvbGxhcHNlZCA9IGNvbGxhcHNlZDtcbiAgICAgICAgICAgICAgICBpZiAoY29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7IGFjdGlvbjogXCJoaWRlX2xlZnRfcGFuZWxcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibXhfbGhzX3NpemVcIiwgJzAnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaXMuZGlzcGF0Y2goeyBhY3Rpb246IFwic2hvd19sZWZ0X3BhbmVsXCIgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uUmVzaXplZDogKHNpemUpID0+IHtcbiAgICAgICAgICAgICAgICBwYW5lbFNpemUgPSBzaXplO1xuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMucmVzaXplTm90aWZpZXIubm90aWZ5TGVmdEhhbmRsZVJlc2l6ZWQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblJlc2l6ZVN0YXJ0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9wcy5yZXNpemVOb3RpZmllci5zdGFydFJlc2l6aW5nKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25SZXNpemVTdG9wOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFwYW5lbENvbGxhcHNlZCkgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibXhfbGhzX3NpemVcIiwgJycgKyBwYW5lbFNpemUpO1xuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMucmVzaXplTm90aWZpZXIuc3RvcFJlc2l6aW5nKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNJdGVtQ29sbGFwc2VkOiBkb21Ob2RlID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9tTm9kZS5jbGFzc0xpc3QuY29udGFpbnMoXCJteF9MZWZ0UGFuZWxfbWluaW1pemVkXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhbmRsZXI6IHRoaXMucmVzaXplSGFuZGxlci5jdXJyZW50LFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXNpemVyID0gbmV3IFJlc2l6ZXIodGhpcy5fcmVzaXplQ29udGFpbmVyLmN1cnJlbnQsIENvbGxhcHNlRGlzdHJpYnV0b3IsIGNvbGxhcHNlQ29uZmlnKTtcbiAgICAgICAgcmVzaXplci5zZXRDbGFzc05hbWVzKHtcbiAgICAgICAgICAgIGhhbmRsZTogXCJteF9SZXNpemVIYW5kbGVcIixcbiAgICAgICAgICAgIHZlcnRpY2FsOiBcIm14X1Jlc2l6ZUhhbmRsZV92ZXJ0aWNhbFwiLFxuICAgICAgICAgICAgcmV2ZXJzZTogXCJteF9SZXNpemVIYW5kbGVfcmV2ZXJzZVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc2l6ZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBsb2FkUmVzaXplclByZWZlcmVuY2VzKCkge1xuICAgICAgICBsZXQgbGhzU2l6ZSA9IHBhcnNlSW50KHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIm14X2xoc19zaXplXCIpLCAxMCk7XG4gICAgICAgIGlmIChpc05hTihsaHNTaXplKSkge1xuICAgICAgICAgICAgbGhzU2l6ZSA9IDM1MDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc2l6ZXIuZm9ySGFuZGxlV2l0aElkKCdscC1yZXNpemVyJykucmVzaXplKGxoc1NpemUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25BY2NvdW50RGF0YSA9IChldmVudDogTWF0cml4RXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKSA9PT0gXCJtLmlnbm9yZWRfdXNlcl9saXN0XCIpIHtcbiAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7IGFjdGlvbjogXCJpZ25vcmVfc3RhdGVfY2hhbmdlZFwiIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIG9uQ29tcGFjdExheW91dENoYW5nZWQgPSAoc2V0dGluZywgcm9vbUlkLCBsZXZlbCwgdmFsdWVBdExldmVsLCBuZXdWYWx1ZSkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHVzZUNvbXBhY3RMYXlvdXQ6IHZhbHVlQXRMZXZlbCxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIG9uU3luYyA9IChzeW5jU3RhdGUsIG9sZFN5bmNTdGF0ZSwgZGF0YSkgPT4ge1xuICAgICAgICBjb25zdCBvbGRFcnJDb2RlID0gKFxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5zeW5jRXJyb3JEYXRhICYmXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnN5bmNFcnJvckRhdGEuZXJyb3IgJiZcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuc3luY0Vycm9yRGF0YS5lcnJvci5lcnJjb2RlXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IG5ld0VyckNvZGUgPSBkYXRhICYmIGRhdGEuZXJyb3IgJiYgZGF0YS5lcnJvci5lcnJjb2RlO1xuICAgICAgICBpZiAoc3luY1N0YXRlID09PSBvbGRTeW5jU3RhdGUgJiYgb2xkRXJyQ29kZSA9PT0gbmV3RXJyQ29kZSkgcmV0dXJuO1xuXG4gICAgICAgIGlmIChzeW5jU3RhdGUgPT09ICdFUlJPUicpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHN5bmNFcnJvckRhdGE6IGRhdGEsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHN5bmNFcnJvckRhdGE6IG51bGwsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvbGRTeW5jU3RhdGUgPT09ICdQUkVQQVJFRCcgJiYgc3luY1N0YXRlID09PSAnU1lOQ0lORycpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VydmVyTm90aWNlRXZlbnRzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVNlcnZlckxpbWl0VG9hc3QodGhpcy5zdGF0ZS5zeW5jRXJyb3JEYXRhLCB0aGlzLnN0YXRlLnVzYWdlTGltaXRFdmVudENvbnRlbnQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIG9uUm9vbVN0YXRlRXZlbnRzID0gKGV2LCBzdGF0ZSkgPT4ge1xuICAgICAgICBjb25zdCBzZXJ2ZXJOb3RpY2VMaXN0ID0gUm9vbUxpc3RTdG9yZS5pbnN0YW5jZS5vcmRlcmVkTGlzdHNbRGVmYXVsdFRhZ0lELlNlcnZlck5vdGljZV07XG4gICAgICAgIGlmIChzZXJ2ZXJOb3RpY2VMaXN0ICYmIHNlcnZlck5vdGljZUxpc3Quc29tZShyID0+IHIucm9vbUlkID09PSBldi5nZXRSb29tSWQoKSkpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VydmVyTm90aWNlRXZlbnRzKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblVzYWdlTGltaXREaXNtaXNzZWQgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdXNhZ2VMaW1pdERpc21pc3NlZDogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgY2FsY3VsYXRlU2VydmVyTGltaXRUb2FzdChzeW5jRXJyb3I6IElTdGF0ZVtcInN5bmNFcnJvckRhdGFcIl0sIHVzYWdlTGltaXRFdmVudENvbnRlbnQ/OiBJVXNhZ2VMaW1pdCkge1xuICAgICAgICBjb25zdCBlcnJvciA9IHN5bmNFcnJvciAmJiBzeW5jRXJyb3IuZXJyb3IgJiYgc3luY0Vycm9yLmVycm9yLmVycmNvZGUgPT09IFwiTV9SRVNPVVJDRV9MSU1JVF9FWENFRURFRFwiO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHVzYWdlTGltaXRFdmVudENvbnRlbnQgPSBzeW5jRXJyb3IuZXJyb3IuZGF0YTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHVzYWdlTGltaXREaXNtaXNzZWQgaXMgdHJ1ZSB3aGVuIHRoZSB1c2VyIGhhcyBleHBsaWNpdGx5IGhpZGRlbiB0aGUgdG9hc3RcbiAgICAgICAgLy8gYW5kIGl0IHdpbGwgYmUgcmVzZXQgdG8gZmFsc2UgaWYgYSAqbmV3KiB1c2FnZSBhbGVydCBjb21lcyBpbi5cbiAgICAgICAgaWYgKHVzYWdlTGltaXRFdmVudENvbnRlbnQgJiYgdGhpcy5zdGF0ZS51c2FnZUxpbWl0RGlzbWlzc2VkKSB7XG4gICAgICAgICAgICBzaG93U2VydmVyTGltaXRUb2FzdChcbiAgICAgICAgICAgICAgICB1c2FnZUxpbWl0RXZlbnRDb250ZW50LmxpbWl0X3R5cGUsXG4gICAgICAgICAgICAgICAgdGhpcy5vblVzYWdlTGltaXREaXNtaXNzZWQsXG4gICAgICAgICAgICAgICAgdXNhZ2VMaW1pdEV2ZW50Q29udGVudC5hZG1pbl9jb250YWN0LFxuICAgICAgICAgICAgICAgIGVycm9yLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhpZGVTZXJ2ZXJMaW1pdFRvYXN0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZVNlcnZlck5vdGljZUV2ZW50cyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgc2VydmVyTm90aWNlTGlzdCA9IFJvb21MaXN0U3RvcmUuaW5zdGFuY2Uub3JkZXJlZExpc3RzW0RlZmF1bHRUYWdJRC5TZXJ2ZXJOb3RpY2VdO1xuICAgICAgICBpZiAoIXNlcnZlck5vdGljZUxpc3QpIHJldHVybiBbXTtcblxuICAgICAgICBjb25zdCBldmVudHMgPSBbXTtcbiAgICAgICAgbGV0IHBpbm5lZEV2ZW50VHMgPSAwO1xuICAgICAgICBmb3IgKGNvbnN0IHJvb20gb2Ygc2VydmVyTm90aWNlTGlzdCkge1xuICAgICAgICAgICAgY29uc3QgcGluU3RhdGVFdmVudCA9IHJvb20uY3VycmVudFN0YXRlLmdldFN0YXRlRXZlbnRzKFwibS5yb29tLnBpbm5lZF9ldmVudHNcIiwgXCJcIik7XG5cbiAgICAgICAgICAgIGlmICghcGluU3RhdGVFdmVudCB8fCAhcGluU3RhdGVFdmVudC5nZXRDb250ZW50KCkucGlubmVkKSBjb250aW51ZTtcbiAgICAgICAgICAgIHBpbm5lZEV2ZW50VHMgPSBwaW5TdGF0ZUV2ZW50LmdldFRzKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHBpbm5lZEV2ZW50SWRzID0gcGluU3RhdGVFdmVudC5nZXRDb250ZW50KCkucGlubmVkLnNsaWNlKDAsIE1BWF9QSU5ORURfTk9USUNFU19QRVJfUk9PTSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGV2ZW50SWQgb2YgcGlubmVkRXZlbnRJZHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IGF3YWl0IHRoaXMuX21hdHJpeENsaWVudC5nZXRFdmVudFRpbWVsaW5lKHJvb20uZ2V0VW5maWx0ZXJlZFRpbWVsaW5lU2V0KCksIGV2ZW50SWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gdGltZWxpbmUuZ2V0RXZlbnRzKCkuZmluZChldiA9PiBldi5nZXRJZCgpID09PSBldmVudElkKTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQpIGV2ZW50cy5wdXNoKGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwaW5uZWRFdmVudFRzICYmIHRoaXMuc3RhdGUudXNhZ2VMaW1pdEV2ZW50VHMgPiBwaW5uZWRFdmVudFRzKSB7XG4gICAgICAgICAgICAvLyBXZSd2ZSBwcm9jZXNzZWQgYSBuZXdlciBldmVudCB0aGFuIHRoaXMgb25lLCBzbyBpZ25vcmUgaXQuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1c2FnZUxpbWl0RXZlbnQgPSBldmVudHMuZmluZCgoZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICBlICYmIGUuZ2V0VHlwZSgpID09PSAnbS5yb29tLm1lc3NhZ2UnICYmXG4gICAgICAgICAgICAgICAgZS5nZXRDb250ZW50KClbJ3NlcnZlcl9ub3RpY2VfdHlwZSddID09PSAnbS5zZXJ2ZXJfbm90aWNlLnVzYWdlX2xpbWl0X3JlYWNoZWQnXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdXNhZ2VMaW1pdEV2ZW50Q29udGVudCA9IHVzYWdlTGltaXRFdmVudCAmJiB1c2FnZUxpbWl0RXZlbnQuZ2V0Q29udGVudCgpO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZVNlcnZlckxpbWl0VG9hc3QodGhpcy5zdGF0ZS5zeW5jRXJyb3JEYXRhLCB1c2FnZUxpbWl0RXZlbnRDb250ZW50KTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICB1c2FnZUxpbWl0RXZlbnRDb250ZW50LFxuICAgICAgICAgICAgdXNhZ2VMaW1pdEV2ZW50VHM6IHBpbm5lZEV2ZW50VHMsXG4gICAgICAgICAgICAvLyBUaGlzIGlzIGEgZnJlc2ggdG9hc3QsIHdlIGNhbiBzaG93IHRvYXN0cyBhZ2FpblxuICAgICAgICAgICAgdXNhZ2VMaW1pdERpc21pc3NlZDogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUGFzdGUgPSAoZXY6IENsaXBib2FyZEV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBldi50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGlucHV0YWJsZUVsZW1lbnQgPSBnZXRJbnB1dGFibGVFbGVtZW50KGVsZW1lbnQpO1xuXG4gICAgICAgIGlmIChpbnB1dGFibGVFbGVtZW50KSB7XG4gICAgICAgICAgICBpbnB1dGFibGVFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyByZWZvY3VzaW5nIGR1cmluZyBhIHBhc3RlIGV2ZW50IHdpbGwgbWFrZSB0aGVcbiAgICAgICAgICAgIC8vIHBhc3RlIGVuZCB1cCBpbiB0aGUgbmV3bHkgZm9jdXNlZCBlbGVtZW50LFxuICAgICAgICAgICAgLy8gc28gZGlzcGF0Y2ggc3luY2hyb25vdXNseSBiZWZvcmUgcGFzdGUgaGFwcGVuc1xuICAgICAgICAgICAgZGlzLmZpcmUoQWN0aW9uLkZvY3VzU2VuZE1lc3NhZ2VDb21wb3NlciwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLypcbiAgICBTT01FIEhBQ0tFUlkgQkVMT1c6XG4gICAgUmVhY3Qgb3B0aW1pemVzIGV2ZW50IGhhbmRsZXJzLCBieSBhbHdheXMgYXR0YWNoaW5nIG9ubHkgMSBoYW5kbGVyIHRvIHRoZSBkb2N1bWVudCBmb3IgYSBnaXZlbiB0eXBlLlxuICAgIEl0IHRoZW4gaW50ZXJuYWxseSBkZXRlcm1pbmVzIHRoZSBvcmRlciBpbiB3aGljaCBSZWFjdCBldmVudCBoYW5kbGVycyBzaG91bGQgYmUgY2FsbGVkLFxuICAgIGVtdWxhdGluZyB0aGUgY2FwdHVyZSBhbmQgYnViYmxpbmcgcGhhc2VzIHRoZSBET00gYWxzbyBoYXMuXG5cbiAgICBCdXQsIGFzIHRoZSBuYXRpdmUgaGFuZGxlciBmb3IgUmVhY3QgaXMgYWx3YXlzIGF0dGFjaGVkIG9uIHRoZSBkb2N1bWVudCxcbiAgICBpdCB3aWxsIGFsd2F5cyBydW4gbGFzdCBmb3IgYnViYmxpbmcgKGZpcnN0IGZvciBjYXB0dXJpbmcpIGhhbmRsZXJzLFxuICAgIGFuZCB0aHVzIFJlYWN0IGJhc2ljYWxseSBoYXMgaXRzIG93biBldmVudCBwaGFzZXMsIGFuZCB3aWxsIGFsd2F5cyBydW5cbiAgICBhZnRlciAoYmVmb3JlIGZvciBjYXB0dXJpbmcpIGFueSBuYXRpdmUgb3RoZXIgZXZlbnQgaGFuZGxlcnMgKGFzIHRoZXkgdGVuZCB0byBiZSBhdHRhY2hlZCBsYXN0KS5cblxuICAgIFNvIGlkZWFsbHkgb25lIHdvdWxkbid0IG1peCBSZWFjdCBhbmQgbmF0aXZlIGV2ZW50IGhhbmRsZXJzIHRvIGhhdmUgYnViYmxpbmcgd29ya2luZyBhcyBleHBlY3RlZCxcbiAgICBidXQgd2UgZG8gbmVlZCBhIG5hdGl2ZSBldmVudCBoYW5kbGVyIGhlcmUgb24gdGhlIGRvY3VtZW50LFxuICAgIHRvIGdldCBrZXlkb3duIGV2ZW50cyB3aGVuIHRoZXJlIGlzIG5vIGZvY3VzZWQgZWxlbWVudCAodGFyZ2V0PWJvZHkpLlxuXG4gICAgV2UgYWxzbyBkbyBuZWVkIGJ1YmJsaW5nIGhlcmUgdG8gZ2l2ZSBjaGlsZCBjb21wb25lbnRzIGEgY2hhbmNlIHRvIGNhbGwgYHN0b3BQcm9wYWdhdGlvbigpYCxcbiAgICBmb3Iga2V5ZG93biBldmVudHMgaXQgY2FuIGhhbmRsZSBpdHNlbGYsIGFuZCBzaG91bGRuJ3QgYmUgcmVkaXJlY3RlZCB0byB0aGUgY29tcG9zZXIuXG5cbiAgICBTbyB3ZSBsaXN0ZW4gd2l0aCBSZWFjdCBvbiB0aGlzIGNvbXBvbmVudCB0byBnZXQgYW55IGV2ZW50cyBvbiBmb2N1c2VkIGVsZW1lbnRzLCBhbmQgZ2V0IGJ1YmJsaW5nIHdvcmtpbmcgYXMgZXhwZWN0ZWQuXG4gICAgV2UgYWxzbyBsaXN0ZW4gd2l0aCBhIG5hdGl2ZSBsaXN0ZW5lciBvbiB0aGUgZG9jdW1lbnQgdG8gZ2V0IGtleWRvd24gZXZlbnRzIHdoZW4gbm8gZWxlbWVudCBpcyBmb2N1c2VkLlxuICAgIEJ1YmJsaW5nIGlzIGlycmVsZXZhbnQgaGVyZSBhcyB0aGUgdGFyZ2V0IGlzIHRoZSBib2R5IGVsZW1lbnQuXG4gICAgKi9cbiAgICBwcml2YXRlIG9uUmVhY3RLZXlEb3duID0gKGV2KSA9PiB7XG4gICAgICAgIC8vIGV2ZW50cyBjYXVnaHQgd2hpbGUgYnViYmxpbmcgdXAgb24gdGhlIHJvb3QgZWxlbWVudFxuICAgICAgICAvLyBvZiB0aGlzIGNvbXBvbmVudCwgc28gc29tZXRoaW5nIG11c3QgYmUgZm9jdXNlZC5cbiAgICAgICAgdGhpcy5vbktleURvd24oZXYpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uTmF0aXZlS2V5RG93biA9IChldikgPT4ge1xuICAgICAgICAvLyBvbmx5IHBhc3MgdGhpcyBpZiB0aGVyZSBpcyBubyBmb2N1c2VkIGVsZW1lbnQuXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzLCBvbktleURvd24gd2lsbCBiZSBjYWxsZWQgYnkgdGhlXG4gICAgICAgIC8vIHJlYWN0IGtleWRvd24gaGFuZGxlciB0aGF0IHJlc3BlY3RzIHRoZSByZWFjdCBidWJibGluZyBvcmRlci5cbiAgICAgICAgaWYgKGV2LnRhcmdldCA9PT0gZG9jdW1lbnQuYm9keSkge1xuICAgICAgICAgICAgdGhpcy5vbktleURvd24oZXYpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25LZXlEb3duID0gKGV2KSA9PiB7XG4gICAgICAgIGxldCBoYW5kbGVkID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3Qgcm9vbUFjdGlvbiA9IGdldEtleUJpbmRpbmdzTWFuYWdlcigpLmdldFJvb21BY3Rpb24oZXYpO1xuICAgICAgICBzd2l0Y2ggKHJvb21BY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgUm9vbUFjdGlvbi5TY3JvbGxVcDpcbiAgICAgICAgICAgIGNhc2UgUm9vbUFjdGlvbi5Sb29tU2Nyb2xsRG93bjpcbiAgICAgICAgICAgIGNhc2UgUm9vbUFjdGlvbi5KdW1wVG9GaXJzdE1lc3NhZ2U6XG4gICAgICAgICAgICBjYXNlIFJvb21BY3Rpb24uSnVtcFRvTGF0ZXN0TWVzc2FnZTpcbiAgICAgICAgICAgICAgICAvLyBwYXNzIHRoZSBldmVudCBkb3duIHRvIHRoZSBzY3JvbGwgcGFuZWxcbiAgICAgICAgICAgICAgICB0aGlzLm9uU2Nyb2xsS2V5UHJlc3NlZChldik7XG4gICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFJvb21BY3Rpb24uRm9jdXNTZWFyY2g6XG4gICAgICAgICAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZm9jdXNfc2VhcmNoJyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFuZGxlZCkge1xuICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmF2QWN0aW9uID0gZ2V0S2V5QmluZGluZ3NNYW5hZ2VyKCkuZ2V0TmF2aWdhdGlvbkFjdGlvbihldik7XG4gICAgICAgIHN3aXRjaCAobmF2QWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIE5hdmlnYXRpb25BY3Rpb24uRm9jdXNSb29tU2VhcmNoOlxuICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2ZvY3VzX3Jvb21fZmlsdGVyJyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgTmF2aWdhdGlvbkFjdGlvbi5Ub2dnbGVVc2VyTWVudTpcbiAgICAgICAgICAgICAgICBkaXMuZmlyZShBY3Rpb24uVG9nZ2xlVXNlck1lbnUpO1xuICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBOYXZpZ2F0aW9uQWN0aW9uLlRvZ2dsZVNob3J0Q3V0RGlhbG9nOlxuICAgICAgICAgICAgICAgIEtleWJvYXJkU2hvcnRjdXRzLnRvZ2dsZURpYWxvZygpO1xuICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBOYXZpZ2F0aW9uQWN0aW9uLkdvVG9Ib21lOlxuICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3ZpZXdfaG9tZV9wYWdlJyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBNb2RhbC5jbG9zZUN1cnJlbnRNb2RhbChcImhvbWVLZXlib2FyZFNob3J0Y3V0XCIpO1xuICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBOYXZpZ2F0aW9uQWN0aW9uLlRvZ2dsZVJvb21TaWRlUGFuZWw6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMucGFnZV90eXBlID09PSBcInJvb21fdmlld1wiIHx8IHRoaXMucHJvcHMucGFnZV90eXBlID09PSBcImdyb3VwX3ZpZXdcIikge1xuICAgICAgICAgICAgICAgICAgICBkaXMuZGlzcGF0Y2g8VG9nZ2xlUmlnaHRQYW5lbFBheWxvYWQ+KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlRvZ2dsZVJpZ2h0UGFuZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLnByb3BzLnBhZ2VfdHlwZSA9PT0gXCJyb29tX3ZpZXdcIiA/IFwicm9vbVwiIDogXCJncm91cFwiLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBOYXZpZ2F0aW9uQWN0aW9uLlNlbGVjdFByZXZSb29tOlxuICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaDxWaWV3Um9vbURlbHRhUGF5bG9hZD4oe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3Um9vbURlbHRhLFxuICAgICAgICAgICAgICAgICAgICBkZWx0YTogLTEsXG4gICAgICAgICAgICAgICAgICAgIHVucmVhZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIE5hdmlnYXRpb25BY3Rpb24uU2VsZWN0TmV4dFJvb206XG4gICAgICAgICAgICAgICAgZGlzLmRpc3BhdGNoPFZpZXdSb29tRGVsdGFQYXlsb2FkPih7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogQWN0aW9uLlZpZXdSb29tRGVsdGEsXG4gICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxLFxuICAgICAgICAgICAgICAgICAgICB1bnJlYWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBOYXZpZ2F0aW9uQWN0aW9uLlNlbGVjdFByZXZVbnJlYWRSb29tOlxuICAgICAgICAgICAgICAgIGRpcy5kaXNwYXRjaDxWaWV3Um9vbURlbHRhUGF5bG9hZD4oe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3Um9vbURlbHRhLFxuICAgICAgICAgICAgICAgICAgICBkZWx0YTogLTEsXG4gICAgICAgICAgICAgICAgICAgIHVucmVhZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgTmF2aWdhdGlvbkFjdGlvbi5TZWxlY3ROZXh0VW5yZWFkUm9vbTpcbiAgICAgICAgICAgICAgICBkaXMuZGlzcGF0Y2g8Vmlld1Jvb21EZWx0YVBheWxvYWQ+KHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBBY3Rpb24uVmlld1Jvb21EZWx0YSxcbiAgICAgICAgICAgICAgICAgICAgZGVsdGE6IDEsXG4gICAgICAgICAgICAgICAgICAgIHVucmVhZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgLy8gaWYgd2UgZG8gbm90IGhhdmUgYSBoYW5kbGVyIGZvciBpdCwgcGFzcyBpdCB0byB0aGUgcGxhdGZvcm0gd2hpY2ggbWlnaHRcbiAgICAgICAgICAgICAgICBoYW5kbGVkID0gUGxhdGZvcm1QZWcuZ2V0KCkub25LZXlEb3duKGV2KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFuZGxlZCkge1xuICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNNb2RpZmllciA9IGV2LmtleSA9PT0gS2V5LkFMVCB8fCBldi5rZXkgPT09IEtleS5DT05UUk9MIHx8IGV2LmtleSA9PT0gS2V5Lk1FVEEgfHwgZXYua2V5ID09PSBLZXkuU0hJRlQ7XG4gICAgICAgIGlmICghaXNNb2RpZmllciAmJiAhZXYuY3RybEtleSAmJiAhZXYubWV0YUtleSkge1xuICAgICAgICAgICAgLy8gVGhlIGFib3ZlIGNvbmRpdGlvbiBpcyBjcmFmdGVkIHRvIF9hbGxvd18gY2hhcmFjdGVycyB3aXRoIFNoaWZ0XG4gICAgICAgICAgICAvLyBhbHJlYWR5IHByZXNzZWQgKGJ1dCBub3QgdGhlIFNoaWZ0IGtleSBkb3duIGl0c2VsZikuXG4gICAgICAgICAgICBjb25zdCBpc0NsaWNrU2hvcnRjdXQgPSBldi50YXJnZXQgIT09IGRvY3VtZW50LmJvZHkgJiZcbiAgICAgICAgICAgICAgICAoZXYua2V5ID09PSBLZXkuU1BBQ0UgfHwgZXYua2V5ID09PSBLZXkuRU5URVIpO1xuXG4gICAgICAgICAgICAvLyBXZSBleHBsaWNpdGx5IGFsbG93IGFsdCB0byBiZSBoZWxkIGR1ZSB0byBpdCBiZWluZyBhIGNvbW1vbiBhY2NlbnQgbW9kaWZpZXIuXG4gICAgICAgICAgICAvLyBYWFg6IEZvcndhcmRpbmcgRGVhZCBrZXlzIGluIHRoaXMgd2F5IGRvZXMgbm90IHdvcmsgYXMgaW50ZW5kZWQgYnV0IGJldHRlciB0byBhdCBsZWFzdFxuICAgICAgICAgICAgLy8gbW92ZSBmb2N1cyB0byB0aGUgY29tcG9zZXIgc28gdGhlIHVzZXIgY2FuIHJlLXR5cGUgdGhlIGRlYWQga2V5IGNvcnJlY3RseS5cbiAgICAgICAgICAgIGNvbnN0IGlzUHJpbnRhYmxlID0gZXYua2V5Lmxlbmd0aCA9PT0gMSB8fCBldi5rZXkgPT09IFwiRGVhZFwiO1xuXG4gICAgICAgICAgICAvLyBJZiB0aGUgdXNlciBpcyBlbnRlcmluZyBhIHByaW50YWJsZSBjaGFyYWN0ZXIgb3V0c2lkZSBvZiBhbiBpbnB1dCBmaWVsZFxuICAgICAgICAgICAgLy8gcmVkaXJlY3QgaXQgdG8gdGhlIGNvbXBvc2VyIGZvciB0aGVtLlxuICAgICAgICAgICAgaWYgKCFpc0NsaWNrU2hvcnRjdXQgJiYgaXNQcmludGFibGUgJiYgIWdldElucHV0YWJsZUVsZW1lbnQoZXYudGFyZ2V0IGFzIEhUTUxFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIC8vIHN5bmNocm9ub3VzIGRpc3BhdGNoIHNvIHdlIGZvY3VzIGJlZm9yZSBrZXkgZ2VuZXJhdGVzIGlucHV0XG4gICAgICAgICAgICAgICAgZGlzLmZpcmUoQWN0aW9uLkZvY3VzU2VuZE1lc3NhZ2VDb21wb3NlciwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgLy8gd2Ugc2hvdWxkICpub3QqIHByZXZlbnREZWZhdWx0KCkgaGVyZSBhcyB0aGF0IHdvdWxkIHByZXZlbnQgdHlwaW5nIGluIHRoZSBub3ctZm9jdXNlZCBjb21wb3NlclxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGRpc3BhdGNoIGEgcGFnZS11cC9wYWdlLWRvd24vZXRjIHRvIHRoZSBhcHByb3ByaWF0ZSBjb21wb25lbnRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZXYgVGhlIGtleSBldmVudFxuICAgICAqL1xuICAgIHByaXZhdGUgb25TY3JvbGxLZXlQcmVzc2VkID0gKGV2KSA9PiB7XG4gICAgICAgIGlmICh0aGlzLl9yb29tVmlldy5jdXJyZW50KSB7XG4gICAgICAgICAgICB0aGlzLl9yb29tVmlldy5jdXJyZW50LmhhbmRsZVNjcm9sbEtleShldik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBsZXQgcGFnZUVsZW1lbnQ7XG5cbiAgICAgICAgc3dpdGNoICh0aGlzLnByb3BzLnBhZ2VfdHlwZSkge1xuICAgICAgICAgICAgY2FzZSBQYWdlVHlwZXMuUm9vbVZpZXc6XG4gICAgICAgICAgICAgICAgcGFnZUVsZW1lbnQgPSA8Um9vbVZpZXdcbiAgICAgICAgICAgICAgICAgICAgcmVmPXt0aGlzLl9yb29tVmlld31cbiAgICAgICAgICAgICAgICAgICAgb25SZWdpc3RlcmVkPXt0aGlzLnByb3BzLm9uUmVnaXN0ZXJlZH1cbiAgICAgICAgICAgICAgICAgICAgdGhyZWVwaWRJbnZpdGU9e3RoaXMucHJvcHMudGhyZWVwaWRJbnZpdGV9XG4gICAgICAgICAgICAgICAgICAgIG9vYkRhdGE9e3RoaXMucHJvcHMucm9vbU9vYkRhdGF9XG4gICAgICAgICAgICAgICAgICAgIGtleT17dGhpcy5wcm9wcy5jdXJyZW50Um9vbUlkIHx8ICdyb29tdmlldyd9XG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZU5vdGlmaWVyPXt0aGlzLnByb3BzLnJlc2l6ZU5vdGlmaWVyfVxuICAgICAgICAgICAgICAgICAgICBqdXN0Q3JlYXRlZE9wdHM9e3RoaXMucHJvcHMucm9vbUp1c3RDcmVhdGVkT3B0c31cbiAgICAgICAgICAgICAgICAgICAgZm9yY2VUaW1lbGluZT17dGhpcy5wcm9wcy5mb3JjZVRpbWVsaW5lfVxuICAgICAgICAgICAgICAgIC8+O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFBhZ2VUeXBlcy5NeUdyb3VwczpcbiAgICAgICAgICAgICAgICBwYWdlRWxlbWVudCA9IDxNeUdyb3VwcyAvPjtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBQYWdlVHlwZXMuUm9vbURpcmVjdG9yeTpcbiAgICAgICAgICAgICAgICAvLyBoYW5kbGVkIGJ5IE1hdHJpeENoYXQgZm9yIG5vd1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFBhZ2VUeXBlcy5Ib21lUGFnZTpcbiAgICAgICAgICAgICAgICBwYWdlRWxlbWVudCA9IDxIb21lUGFnZSBqdXN0UmVnaXN0ZXJlZD17dGhpcy5wcm9wcy5qdXN0UmVnaXN0ZXJlZH0gLz47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgUGFnZVR5cGVzLlVzZXJWaWV3OlxuICAgICAgICAgICAgICAgIHBhZ2VFbGVtZW50ID0gPFVzZXJWaWV3IHVzZXJJZD17dGhpcy5wcm9wcy5jdXJyZW50VXNlcklkfSByZXNpemVOb3RpZmllcj17dGhpcy5wcm9wcy5yZXNpemVOb3RpZmllcn0gLz47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFBhZ2VUeXBlcy5Hcm91cFZpZXc6XG4gICAgICAgICAgICAgICAgaWYgKFNwYWNlU3RvcmUuc3BhY2VzRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBwYWdlRWxlbWVudCA9IDxMZWdhY3lDb21tdW5pdHlQcmV2aWV3IGdyb3VwSWQ9e3RoaXMucHJvcHMuY3VycmVudEdyb3VwSWR9IC8+O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VFbGVtZW50ID0gPEdyb3VwVmlld1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBJZD17dGhpcy5wcm9wcy5jdXJyZW50R3JvdXBJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlzTmV3PXt0aGlzLnByb3BzLmN1cnJlbnRHcm91cElzTmV3fVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplTm90aWZpZXI9e3RoaXMucHJvcHMucmVzaXplTm90aWZpZXJ9XG4gICAgICAgICAgICAgICAgICAgIC8+O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdyYXBwZXJDbGFzc2VzID0gY2xhc3NOYW1lcyh7XG4gICAgICAgICAgICAnbXhfTWF0cml4Q2hhdF93cmFwcGVyJzogdHJ1ZSxcbiAgICAgICAgICAgICdteF9NYXRyaXhDaGF0X3VzZUNvbXBhY3RMYXlvdXQnOiB0aGlzLnN0YXRlLnVzZUNvbXBhY3RMYXlvdXQsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBib2R5Q2xhc3NlcyA9IGNsYXNzTmFtZXMoe1xuICAgICAgICAgICAgJ214X01hdHJpeENoYXQnOiB0cnVlLFxuICAgICAgICAgICAgJ214X01hdHJpeENoYXQtLXdpdGgtYXZhdGFyJzogdGhpcy5zdGF0ZS5iYWNrZ3JvdW5kSW1hZ2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGF1ZGlvRmVlZEFycmF5c0ZvckNhbGxzID0gdGhpcy5zdGF0ZS5hY3RpdmVDYWxscy5tYXAoKGNhbGwpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPEF1ZGlvRmVlZEFycmF5Rm9yQ2FsbCBjYWxsPXtjYWxsfSBrZXk9e2NhbGwuY2FsbElkfSAvPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxNYXRyaXhDbGllbnRDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXt0aGlzLl9tYXRyaXhDbGllbnR9PlxuICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgb25QYXN0ZT17dGhpcy5vblBhc3RlfVxuICAgICAgICAgICAgICAgICAgICBvbktleURvd249e3RoaXMub25SZWFjdEtleURvd259XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17d3JhcHBlckNsYXNzZXN9XG4gICAgICAgICAgICAgICAgICAgIGFyaWEtaGlkZGVuPXt0aGlzLnByb3BzLmhpZGVUb1NSVXNlcnN9XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8VG9hc3RDb250YWluZXIgLz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2JvZHlDbGFzc2VzfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdteF9MZWZ0UGFuZWxfd3JhcHBlcic+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBTZXR0aW5nc1N0b3JlLmdldFZhbHVlKCdUYWdQYW5lbC5lbmFibGVUYWdQYW5lbCcpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg8ZGl2IGNsYXNzTmFtZT1cIm14X0dyb3VwRmlsdGVyUGFuZWxDb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCYWNrZHJvcFBhbmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmx1ck11bHRpcGxpZXI9ezAuNX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U9e3RoaXMuc3RhdGUuYmFja2dyb3VuZEltYWdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxHcm91cEZpbHRlclBhbmVsIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJmZWF0dXJlX2N1c3RvbV90YWdzXCIpID8gPEN1c3RvbVJvb21UYWdQYW5lbCAvPiA6IG51bGwgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgU3BhY2VTdG9yZS5zcGFjZXNFbmFibGVkID8gPD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJhY2tkcm9wUGFuZWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsdXJNdWx0aXBsaWVyPXswLjV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U9e3RoaXMuc3RhdGUuYmFja2dyb3VuZEltYWdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8U3BhY2VQYW5lbCAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvPiA6IG51bGwgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCYWNrZHJvcFBhbmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZT17dGhpcy5zdGF0ZS5iYWNrZ3JvdW5kSW1hZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0xlZnRQYW5lbF93cmFwcGVyLS11c2VyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmPXt0aGlzLl9yZXNpemVDb250YWluZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtY29sbGFwc2VkPXt0aGlzLnByb3BzLmNvbGxhcHNlTGhzID8gdHJ1ZSA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxMZWZ0UGFuZWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTWluaW1pemVkPXt0aGlzLnByb3BzLmNvbGxhcHNlTGhzIHx8IGZhbHNlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplTm90aWZpZXI9e3RoaXMucHJvcHMucmVzaXplTm90aWZpZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSZXNpemVIYW5kbGUgcGFzc1JlZj17dGhpcy5yZXNpemVIYW5kbGVyfSBpZD1cImxwLXJlc2l6ZXJcIiAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Sb29tVmlld193cmFwcGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBwYWdlRWxlbWVudCB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPENhbGxDb250YWluZXIgLz5cbiAgICAgICAgICAgICAgICA8Tm9uVXJnZW50VG9hc3RDb250YWluZXIgLz5cbiAgICAgICAgICAgICAgICA8SG9zdFNpZ251cENvbnRhaW5lciAvPlxuICAgICAgICAgICAgICAgIHsgYXVkaW9GZWVkQXJyYXlzRm9yQ2FsbHMgfVxuICAgICAgICAgICAgPC9NYXRyaXhDbGllbnRDb250ZXh0LlByb3ZpZGVyPlxuICAgICAgICApO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTG9nZ2VkSW5WaWV3O1xuIl19