"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ThreadPanelHeaderFilterOptionItem = exports.ThreadPanelHeader = exports.ThreadFilterType = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _thread = require("matrix-js-sdk/src/models/thread");

var _eventTimelineSet = require("matrix-js-sdk/src/models/event-timeline-set");

var _BaseCard = _interopRequireDefault(require("../views/right_panel/BaseCard"));

var _MatrixClientContext = _interopRequireDefault(require("../../contexts/MatrixClientContext"));

var _languageHandler = require("../../languageHandler");

var _ContextMenuButton = require("../../accessibility/context_menu/ContextMenuButton");

var _ContextMenu = _interopRequireWildcard(require("./ContextMenu"));

var _RoomContext = _interopRequireWildcard(require("../../contexts/RoomContext"));

var _TimelinePanel = _interopRequireDefault(require("./TimelinePanel"));

var _Layout = require("../../settings/enums/Layout");

var _useEventEmitter = require("../../hooks/useEventEmitter");

var _EventTile = require("../views/rooms/EventTile");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

let ThreadFilterType;
exports.ThreadFilterType = ThreadFilterType;

(function (ThreadFilterType) {
  ThreadFilterType[ThreadFilterType["My"] = 0] = "My";
  ThreadFilterType[ThreadFilterType["All"] = 1] = "All";
})(ThreadFilterType || (exports.ThreadFilterType = ThreadFilterType = {}));

const useFilteredThreadsTimelinePanel = ({
  threads,
  room,
  filterOption,
  userId,
  updateTimeline
}) => {
  const timelineSet = (0, _react.useMemo)(() => new _eventTimelineSet.EventTimelineSet(null, {
    timelineSupport: true,
    unstableClientRelationAggregation: true,
    pendingEvents: false
  }), []);
  const buildThreadList = (0, _react.useCallback)(function (timelineSet) {
    timelineSet.resetLiveTimeline("");
    Array.from(threads).forEach(([, thread]) => {
      if (filterOption !== ThreadFilterType.My || thread.hasCurrentUserParticipated) {
        timelineSet.addLiveEvent(thread.rootEvent);
      }
    });
    updateTimeline();
  }, [filterOption, threads, updateTimeline]);
  (0, _react.useEffect)(() => {
    buildThreadList(timelineSet);
  }, [timelineSet, buildThreadList]);
  (0, _useEventEmitter.useEventEmitter)(room, _thread.ThreadEvent.Update, () => {
    buildThreadList(timelineSet);
  });
  (0, _useEventEmitter.useEventEmitter)(room, _thread.ThreadEvent.New, () => {
    buildThreadList(timelineSet);
  });
  return timelineSet;
};

const ThreadPanelHeaderFilterOptionItem = ({
  label,
  description,
  onClick,
  isSelected
}) => {
  return /*#__PURE__*/_react.default.createElement(_ContextMenu.MenuItemRadio, {
    active: isSelected,
    className: "mx_ThreadPanel_Header_FilterOptionItem",
    onClick: onClick
  }, /*#__PURE__*/_react.default.createElement("span", null, label), /*#__PURE__*/_react.default.createElement("span", null, description));
};

exports.ThreadPanelHeaderFilterOptionItem = ThreadPanelHeaderFilterOptionItem;

const ThreadPanelHeader = ({
  filterOption,
  setFilterOption
}) => {
  const [menuDisplayed, button, openMenu, closeMenu] = (0, _ContextMenu.useContextMenu)();
  const options = [{
    label: (0, _languageHandler._t)("My threads"),
    description: (0, _languageHandler._t)("Shows all threads you've participated in"),
    key: ThreadFilterType.My
  }, {
    label: (0, _languageHandler._t)("All threads"),
    description: (0, _languageHandler._t)('Shows all threads from current room'),
    key: ThreadFilterType.All
  }];
  const value = options.find(option => option.key === filterOption);
  const contextMenuOptions = options.map(opt => /*#__PURE__*/_react.default.createElement(ThreadPanelHeaderFilterOptionItem, {
    key: opt.key,
    label: opt.label,
    description: opt.description,
    onClick: () => {
      setFilterOption(opt.key);
      closeMenu();
    },
    isSelected: opt === value
  }));
  const contextMenu = menuDisplayed ? /*#__PURE__*/_react.default.createElement(_ContextMenu.default, {
    top: 0,
    right: 25,
    onFinished: closeMenu,
    chevronFace: _ContextMenu.ChevronFace.Top,
    mountAsChild: true
  }, contextMenuOptions) : null;
  return /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ThreadPanel__header"
  }, /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("Threads")), /*#__PURE__*/_react.default.createElement(_ContextMenuButton.ContextMenuButton, {
    className: "mx_ThreadPanel_dropdown",
    inputRef: button,
    isExpanded: menuDisplayed,
    onClick: () => menuDisplayed ? closeMenu() : openMenu()
  }, `${(0, _languageHandler._t)('Show:')} ${value.label}`), contextMenu);
};

exports.ThreadPanelHeader = ThreadPanelHeader;

const EmptyThread = ({
  filterOption,
  showAllThreadsCallback
}) => {
  return /*#__PURE__*/_react.default.createElement("aside", {
    className: "mx_ThreadPanel_empty"
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: "mx_ThreadPanel_largeIcon"
  }), /*#__PURE__*/_react.default.createElement("h2", null, (0, _languageHandler._t)("Keep discussions organised with threads")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Threads help you keep conversations on-topic and easily " + "track them over time. Create the first one by using the " + "\"Reply in thread\" button on a message.")), /*#__PURE__*/_react.default.createElement("p", null, filterOption === ThreadFilterType.My ? /*#__PURE__*/_react.default.createElement("button", {
    onClick: showAllThreadsCallback
  }, (0, _languageHandler._t)("Show all threads")) : /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, "\xA0")));
};

const ThreadPanel = ({
  roomId,
  onClose,
  permalinkCreator
}) => {
  const mxClient = (0, _react.useContext)(_MatrixClientContext.default);
  const roomContext = (0, _react.useContext)(_RoomContext.default);
  const room = mxClient.getRoom(roomId);
  const [filterOption, setFilterOption] = (0, _react.useState)(ThreadFilterType.All);
  const ref = (0, _react.useRef)();
  const filteredTimelineSet = useFilteredThreadsTimelinePanel({
    threads: room.threads,
    room,
    filterOption,
    userId: mxClient.getUserId(),
    updateTimeline: () => {
      var _ref$current;

      return (_ref$current = ref.current) === null || _ref$current === void 0 ? void 0 : _ref$current.refreshTimeline();
    }
  });
  return /*#__PURE__*/_react.default.createElement(_RoomContext.default.Provider, {
    value: _objectSpread(_objectSpread({}, roomContext), {}, {
      timelineRenderingType: _RoomContext.TimelineRenderingType.ThreadsList,
      liveTimeline: filteredTimelineSet.getLiveTimeline(),
      showHiddenEventsInTimeline: true
    })
  }, /*#__PURE__*/_react.default.createElement(_BaseCard.default, {
    header: /*#__PURE__*/_react.default.createElement(ThreadPanelHeader, {
      filterOption: filterOption,
      setFilterOption: setFilterOption
    }),
    className: "mx_ThreadPanel",
    onClose: onClose,
    withoutScrollContainer: true
  }, /*#__PURE__*/_react.default.createElement(_TimelinePanel.default, {
    ref: ref,
    showReadReceipts: false // No RR support in thread's MVP
    ,
    manageReadReceipts: false // No RR support in thread's MVP
    ,
    manageReadMarkers: false // No RM support in thread's MVP
    ,
    sendReadReceiptOnLoad: false // No RR support in thread's MVP
    ,
    timelineSet: filteredTimelineSet,
    showUrlPreview: true,
    empty: /*#__PURE__*/_react.default.createElement(EmptyThread, {
      filterOption: filterOption,
      showAllThreadsCallback: () => setFilterOption(ThreadFilterType.All)
    }),
    alwaysShowTimestamps: true,
    layout: _Layout.Layout.Group,
    hideThreadedMessages: false,
    hidden: false,
    showReactions: true,
    className: "mx_RoomView_messagePanel mx_GroupLayout",
    membersLoaded: true,
    permalinkCreator: permalinkCreator,
    tileShape: _EventTile.TileShape.ThreadPanel,
    disableGrouping: true
  })));
};

var _default = ThreadPanel;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvVGhyZWFkUGFuZWwudHN4Il0sIm5hbWVzIjpbIlRocmVhZEZpbHRlclR5cGUiLCJ1c2VGaWx0ZXJlZFRocmVhZHNUaW1lbGluZVBhbmVsIiwidGhyZWFkcyIsInJvb20iLCJmaWx0ZXJPcHRpb24iLCJ1c2VySWQiLCJ1cGRhdGVUaW1lbGluZSIsInRpbWVsaW5lU2V0IiwiRXZlbnRUaW1lbGluZVNldCIsInRpbWVsaW5lU3VwcG9ydCIsInVuc3RhYmxlQ2xpZW50UmVsYXRpb25BZ2dyZWdhdGlvbiIsInBlbmRpbmdFdmVudHMiLCJidWlsZFRocmVhZExpc3QiLCJyZXNldExpdmVUaW1lbGluZSIsIkFycmF5IiwiZnJvbSIsImZvckVhY2giLCJ0aHJlYWQiLCJNeSIsImhhc0N1cnJlbnRVc2VyUGFydGljaXBhdGVkIiwiYWRkTGl2ZUV2ZW50Iiwicm9vdEV2ZW50IiwiVGhyZWFkRXZlbnQiLCJVcGRhdGUiLCJOZXciLCJUaHJlYWRQYW5lbEhlYWRlckZpbHRlck9wdGlvbkl0ZW0iLCJsYWJlbCIsImRlc2NyaXB0aW9uIiwib25DbGljayIsImlzU2VsZWN0ZWQiLCJUaHJlYWRQYW5lbEhlYWRlciIsInNldEZpbHRlck9wdGlvbiIsIm1lbnVEaXNwbGF5ZWQiLCJidXR0b24iLCJvcGVuTWVudSIsImNsb3NlTWVudSIsIm9wdGlvbnMiLCJrZXkiLCJBbGwiLCJ2YWx1ZSIsImZpbmQiLCJvcHRpb24iLCJjb250ZXh0TWVudU9wdGlvbnMiLCJtYXAiLCJvcHQiLCJjb250ZXh0TWVudSIsIkNoZXZyb25GYWNlIiwiVG9wIiwiRW1wdHlUaHJlYWQiLCJzaG93QWxsVGhyZWFkc0NhbGxiYWNrIiwiVGhyZWFkUGFuZWwiLCJyb29tSWQiLCJvbkNsb3NlIiwicGVybWFsaW5rQ3JlYXRvciIsIm14Q2xpZW50IiwiTWF0cml4Q2xpZW50Q29udGV4dCIsInJvb21Db250ZXh0IiwiUm9vbUNvbnRleHQiLCJnZXRSb29tIiwicmVmIiwiZmlsdGVyZWRUaW1lbGluZVNldCIsImdldFVzZXJJZCIsImN1cnJlbnQiLCJyZWZyZXNoVGltZWxpbmUiLCJ0aW1lbGluZVJlbmRlcmluZ1R5cGUiLCJUaW1lbGluZVJlbmRlcmluZ1R5cGUiLCJUaHJlYWRzTGlzdCIsImxpdmVUaW1lbGluZSIsImdldExpdmVUaW1lbGluZSIsInNob3dIaWRkZW5FdmVudHNJblRpbWVsaW5lIiwiTGF5b3V0IiwiR3JvdXAiLCJUaWxlU2hhcGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUNBOztBQUdBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7O0lBVVlBLGdCOzs7V0FBQUEsZ0I7QUFBQUEsRUFBQUEsZ0IsQ0FBQUEsZ0I7QUFBQUEsRUFBQUEsZ0IsQ0FBQUEsZ0I7R0FBQUEsZ0IsZ0NBQUFBLGdCOztBQVdaLE1BQU1DLCtCQUErQixHQUFHLENBQUM7QUFDckNDLEVBQUFBLE9BRHFDO0FBRXJDQyxFQUFBQSxJQUZxQztBQUdyQ0MsRUFBQUEsWUFIcUM7QUFJckNDLEVBQUFBLE1BSnFDO0FBS3JDQyxFQUFBQTtBQUxxQyxDQUFELEtBWWxDO0FBQ0YsUUFBTUMsV0FBVyxHQUFHLG9CQUFRLE1BQU0sSUFBSUMsa0NBQUosQ0FBcUIsSUFBckIsRUFBMkI7QUFDekRDLElBQUFBLGVBQWUsRUFBRSxJQUR3QztBQUV6REMsSUFBQUEsaUNBQWlDLEVBQUUsSUFGc0I7QUFHekRDLElBQUFBLGFBQWEsRUFBRTtBQUgwQyxHQUEzQixDQUFkLEVBSWhCLEVBSmdCLENBQXBCO0FBTUEsUUFBTUMsZUFBZSxHQUFHLHdCQUFZLFVBQVNMLFdBQVQsRUFBd0M7QUFDeEVBLElBQUFBLFdBQVcsQ0FBQ00saUJBQVosQ0FBOEIsRUFBOUI7QUFDQUMsSUFBQUEsS0FBSyxDQUFDQyxJQUFOLENBQVdiLE9BQVgsRUFDS2MsT0FETCxDQUNhLENBQUMsR0FBR0MsTUFBSCxDQUFE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QUo1QixrQkFNSSw2QkFBQyxzQkFBRDtBQUNJLElBQUEsR0FBRyxFQUFFTyxHQURUO0FBRUksSUFBQSxnQkFBZ0IsRUFBRSxLQUZ0QixDQUU2QjtBQUY3QjtBQUdJLElBQUEsa0JBQWtCLEVBQUUsS0FIeEIsQ0FHK0I7QUFIL0I7QUFJSSxJQUFBLGlCQUFpQixFQUFFLEtBSnZCLENBSThCO0FBSjlCO0FBS0ksSUFBQSxxQkFBcUIsRUFBRSxLQUwzQixDQUtrQztBQUxsQztBQU1JLElBQUEsV0FBVyxFQUFFQyxtQkFOakI7QUFPSSxJQUFBLGNBQWMsRUFBRSxJQVBwQjtBQVFJLElBQUEsS0FBSyxlQUFFLDZCQUFDLFdBQUQ7QUFDSCxNQUFBLFlBQVksRUFBRXhELFlBRFg7QUFFSCxNQUFBLHNCQUFzQixFQUFFLE1BQU0yQixlQUFlLENBQUMvQixnQkFBZ0IsQ0FBQ3NDLEdBQWxCO0FBRjFDLE1BUlg7QUFZSSxJQUFBLG9CQUFvQixFQUFFLElBWjFCO0FBYUksSUFBQSxNQUFNLEVBQUVnQyxlQUFPQyxLQWJuQjtBQWNJLElBQUEsb0JBQW9CLEVBQUUsS0FkMUI7QUFlSSxJQUFBLE1BQU0sRUFBRSxLQWZaO0FBZ0JJLElBQUEsYUFBYSxFQUFFLElBaEJuQjtBQWlCSSxJQUFBLFNBQVMsRUFBQyx5Q0FqQmQ7QUFrQkksSUFBQSxhQUFhLEVBQUUsSUFsQm5CO0FBbUJJLElBQUEsZ0JBQWdCLEVBQUVsQixnQkFuQnRCO0FBb0JJLElBQUEsU0FBUyxFQUFFbUIscUJBQVV0QixXQXBCekI7QUFxQkksSUFBQSxlQUFlLEVBQUU7QUFyQnJCLElBTkosQ0FOSixDQURKO0FBdUNILENBdEREOztlQXVEZUEsVyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAyMSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlQ29udGV4dCwgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgVGhyZWFkLCBUaHJlYWRFdmVudCB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy90aHJlYWQnO1xuaW1wb3J0IHsgRXZlbnRUaW1lbGluZVNldCB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudC10aW1lbGluZS1zZXQnO1xuaW1wb3J0IHsgUm9vbSB9IGZyb20gJ21hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tJztcblxuaW1wb3J0IEJhc2VDYXJkIGZyb20gXCIuLi92aWV3cy9yaWdodF9wYW5lbC9CYXNlQ2FyZFwiO1xuaW1wb3J0IFJlc2l6ZU5vdGlmaWVyIGZyb20gJy4uLy4uL3V0aWxzL1Jlc2l6ZU5vdGlmaWVyJztcbmltcG9ydCBNYXRyaXhDbGllbnRDb250ZXh0IGZyb20gJy4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHQnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IHsgQ29udGV4dE1lbnVCdXR0b24gfSBmcm9tICcuLi8uLi9hY2Nlc3NpYmlsaXR5L2NvbnRleHRfbWVudS9Db250ZXh0TWVudUJ1dHRvbic7XG5pbXBvcnQgQ29udGV4dE1lbnUsIHsgQ2hldnJvbkZhY2UsIE1lbnVJdGVtUmFkaW8sIHVzZUNvbnRleHRNZW51IH0gZnJvbSAnLi9Db250ZXh0TWVudSc7XG5pbXBvcnQgUm9vbUNvbnRleHQsIHsgVGltZWxpbmVSZW5kZXJpbmdUeXBlIH0gZnJvbSAnLi4vLi4vY29udGV4dHMvUm9vbUNvbnRleHQnO1xuaW1wb3J0IFRpbWVsaW5lUGFuZWwgZnJvbSAnLi9UaW1lbGluZVBhbmVsJztcbmltcG9ydCB7IExheW91dCB9IGZyb20gJy4uLy4uL3NldHRpbmdzL2VudW1zL0xheW91dCc7XG5pbXBvcnQgeyB1c2VFdmVudEVtaXR0ZXIgfSBmcm9tICcuLi8uLi9ob29rcy91c2VFdmVudEVtaXR0ZXInO1xuaW1wb3J0IHsgVGlsZVNoYXBlIH0gZnJvbSAnLi4vdmlld3Mvcm9vbXMvRXZlbnRUaWxlJztcbmltcG9ydCB7IFJvb21QZXJtYWxpbmtDcmVhdG9yIH0gZnJvbSAnLi4vLi4vdXRpbHMvcGVybWFsaW5rcy9QZXJtYWxpbmtzJztcblxuaW50ZXJmYWNlIElQcm9wcyB7XG4gICAgcm9vbUlkOiBzdHJpbmc7XG4gICAgb25DbG9zZTogKCkgPT4gdm9pZDtcbiAgICByZXNpemVOb3RpZmllcjogUmVzaXplTm90aWZpZXI7XG4gICAgcGVybWFsaW5rQ3JlYXRvcjogUm9vbVBlcm1hbGlua0NyZWF0b3I7XG59XG5cbmV4cG9ydCBlbnVtIFRocmVhZEZpbHRlclR5cGUge1xuICAgIFwiTXlcIixcbiAgICBcIkFsbFwiXG59XG5cbnR5cGUgVGhyZWFkUGFuZWxIZWFkZXJPcHRpb24gPSB7XG4gICAgbGFiZWw6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIGtleTogVGhyZWFkRmlsdGVyVHlwZTtcbn07XG5cbmNvbnN0IHVzZUZpbHRlcmVkVGhyZWFkc1RpbWVsaW5lUGFuZWwgPSAoe1xuICAgIHRocmVhZHMsXG4gICAgcm9vbSxcbiAgICBmaWx0ZXJPcHRpb24sXG4gICAgdXNlcklkLFxuICAgIHVwZGF0ZVRpbWVsaW5lLFxufToge1xuICAgIHRocmVhZHM6IE1hcDxzdHJpbmcsIFRocmVhZD47XG4gICAgcm9vbTogUm9vbTtcbiAgICB1c2VySWQ6IHN0cmluZztcbiAgICBmaWx0ZXJPcHRpb246IFRocmVhZEZpbHRlclR5cGU7XG4gICAgdXBkYXRlVGltZWxpbmU6ICgpID0+IHZvaWQ7XG59KSA9PiB7XG4gICAgY29uc3QgdGltZWxpbmVTZXQgPSB1c2VNZW1vKCgpID0+IG5ldyBFdmVudFRpbWVsaW5lU2V0KG51bGwsIHtcbiAgICAgICAgdGltZWxpbmVTdXBwb3J0OiB0cnVlLFxuICAgICAgICB1bnN0YWJsZUNsaWVudFJlbGF0aW9uQWdncmVnYXRpb246IHRydWUsXG4gICAgICAgIHBlbmRpbmdFdmVudHM6IGZhbHNlLFxuICAgIH0pLCBbXSk7XG5cbiAgICBjb25zdCBidWlsZFRocmVhZExpc3QgPSB1c2VDYWxsYmFjayhmdW5jdGlvbih0aW1lbGluZVNldDogRXZlbnRUaW1lbGluZVNldCkge1xuICAgICAgICB0aW1lbGluZVNldC5yZXNldExpdmVUaW1lbGluZShcIlwiKTtcbiAgICAgICAgQXJyYXkuZnJvbSh0aHJlYWRzKVxuICAgICAgICAgICAgLmZvckVhY2goKFssIHRocmVhZF0pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyT3B0aW9uICE9PSBUaHJlYWRGaWx0ZXJUeXBlLk15IHx8IHRocmVhZC5oYXNDdXJyZW50VXNlclBhcnRpY2lwYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aW1lbGluZVNldC5hZGRMaXZlRXZlbnQodGhyZWFkLnJvb3RFdmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIHVwZGF0ZVRpbWVsaW5lKCk7XG4gICAgfSwgW2ZpbHRlck9wdGlvbiwgdGhyZWFkcywgdXBkYXRlVGltZWxpbmVdKTtcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7IGJ1aWxkVGhyZWFkTGlzdCh0aW1lbGluZVNldCk7IH0sIFt0aW1lbGluZVNldCwgYnVpbGRUaHJlYWRMaXN0XSk7XG5cbiAgICB1c2VFdmVudEVtaXR0ZXIocm9vbSwgVGhyZWFkRXZlbnQuVXBkYXRlLCAoKSA9PiB7IGJ1aWxkVGhyZWFkTGlzdCh0aW1lbGluZVNldCk7IH0pO1xuICAgIHVzZUV2ZW50RW1pdHRlcihyb29tLCBUaHJlYWRFdmVudC5OZXcsICgpID0+IHsgYnVpbGRUaHJlYWRMaXN0KHRpbWVsaW5lU2V0KTsgfSk7XG5cbiAgICByZXR1cm4gdGltZWxpbmVTZXQ7XG59O1xuXG5leHBvcnQgY29uc3QgVGhyZWFkUGFuZWxIZWFkZXJGaWx0ZXJPcHRpb25JdGVtID0gKHtcbiAgICBsYWJlbCxcbiAgICBkZXNjcmlwdGlvbixcbiAgICBvbkNsaWNrLFxuICAgIGlzU2VsZWN0ZWQsXG59OiBUaHJlYWRQYW5lbEhlYWRlck9wdGlvbiAmIHtcbiAgICBvbkNsaWNrOiAoKSA9PiB2b2lkO1xuICAgIGlzU2VsZWN0ZWQ6IGJvb2xlYW47XG59KSA9PiB7XG4gICAgcmV0dXJuIDxNZW51SXRlbVJhZGlvXG4gICAgICAgIGFjdGl2ZT17aXNTZWxlY3RlZH1cbiAgICAgICAgY2xhc3NOYW1lPVwibXhfVGhyZWFkUGFuZWxfSGVhZGVyX0ZpbHRlck9wdGlvbkl0ZW1cIlxuICAgICAgICBvbkNsaWNrPXtvbkNsaWNrfVxuICAgID5cbiAgICAgICAgPHNwYW4+eyBsYWJlbCB9PC9zcGFuPlxuICAgICAgICA8c3Bhbj57IGRlc2NyaXB0aW9uIH08L3NwYW4+XG4gICAgPC9NZW51SXRlbVJhZGlvPjtcbn07XG5cbmV4cG9ydCBjb25zdCBUaHJlYWRQYW5lbEhlYWRlciA9ICh7IGZpbHRlck9wdGlvbiwgc2V0RmlsdGVyT3B0aW9uIH06IHtcbiAgICBmaWx0ZXJPcHRpb246IFRocmVhZEZpbHRlclR5cGU7XG4gICAgc2V0RmlsdGVyT3B0aW9uOiAoZmlsdGVyT3B0aW9uOiBUaHJlYWRGaWx0ZXJUeXBlKSA9PiB2b2lkO1xufSkgPT4ge1xuICAgIGNvbnN0IFttZW51RGlzcGxheWVkLCBidXR0b24sIG9wZW5NZW51LCBjbG9zZU1lbnVdID0gdXNlQ29udGV4dE1lbnU8SFRNTEVsZW1lbnQ+KCk7XG4gICAgY29uc3Qgb3B0aW9uczogcmVhZG9ubHkgVGhyZWFkUGFuZWxIZWFkZXJPcHRpb25bXSA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6IF90KFwiTXkgdGhyZWFkc1wiKSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBfdChcIlNob3dzIGFsbCB0aHJlYWRzIHlvdSd2ZSBwYXJ0aWNpcGF0ZWQgaW5cIiksXG4gICAgICAgICAgICBrZXk6IFRocmVhZEZpbHRlclR5cGUuTXksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiBfdChcIkFsbCB0aHJlYWRzXCIpLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KCdTaG93cyBhbGwgdGhyZWFkcyBmcm9tIGN1cnJlbnQgcm9vbScpLFxuICAgICAgICAgICAga2V5OiBUaHJlYWRGaWx0ZXJUeXBlLkFsbCxcbiAgICAgICAgfSxcbiAgICBdO1xuXG4gICAgY29uc3QgdmFsdWUgPSBvcHRpb25zLmZpbmQob3B0aW9uID0+IG9wdGlvbi5rZXkgPT09IGZpbHRlck9wdGlvbik7XG4gICAgY29uc3QgY29udGV4dE1lbnVPcHRpb25zID0gb3B0aW9ucy5tYXAob3B0ID0+IDxUaHJlYWRQYW5lbEhlYWRlckZpbHRlck9wdGlvbkl0ZW1cbiAgICAgICAga2V5PXtvcHQua2V5fVxuICAgICAgICBsYWJlbD17b3B0LmxhYmVsfVxuICAgICAgICBkZXNjcmlwdGlvbj17b3B0LmRlc2NyaXB0aW9ufVxuICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICBzZXRGaWx0ZXJPcHRpb24ob3B0LmtleSk7XG4gICAgICAgICAgICBjbG9zZU1lbnUoKTtcbiAgICAgICAgfX1cbiAgICAgICAgaXNTZWxlY3RlZD17b3B0ID09PSB2YWx1ZX1cbiAgICAvPik7XG4gICAgY29uc3QgY29udGV4dE1lbnUgPSBtZW51RGlzcGxheWVkID8gPENvbnRleHRNZW51XG4gICAgICAgIHRvcD17MH1cbiAgICAgICAgcmlnaHQ9ezI1fVxuICAgICAgICBvbkZpbmlzaGVkPXtjbG9zZU1lbnV9XG4gICAgICAgIGNoZXZyb25GYWNlPXtDaGV2cm9uRmFjZS5Ub3B9XG4gICAgICAgIG1vdW50QXNDaGlsZD17dHJ1ZX1cbiAgICA+XG4gICAgICAgIHsgY29udGV4dE1lbnVPcHRpb25zIH1cbiAgICA8L0NvbnRleHRNZW51PiA6IG51bGw7XG4gICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXhfVGhyZWFkUGFuZWxfX2hlYWRlclwiPlxuICAgICAgICA8c3Bhbj57IF90KFwiVGhyZWFkc1wiKSB9PC9zcGFuPlxuICAgICAgICA8Q29udGV4dE1lbnVCdXR0b24gY2xhc3NOYW1lPVwibXhfVGhyZWFkUGFuZWxfZHJvcGRvd25cIiBpbnB1dFJlZj17YnV0dG9ufSBpc0V4cGFuZGVkPXttZW51RGlzcGxheWVkfSBvbkNsaWNrPXsoKSA9PiBtZW51RGlzcGxheWVkID8gY2xvc2VNZW51KCkgOiBvcGVuTWVudSgpfT5cbiAgICAgICAgICAgIHsgYCR7X3QoJ1Nob3c6Jyl9ICR7dmFsdWUubGFiZWx9YCB9XG4gICAgICAgIDwvQ29udGV4dE1lbnVCdXR0b24+XG4gICAgICAgIHsgY29udGV4dE1lbnUgfVxuICAgIDwvZGl2Pjtcbn07XG5cbmludGVyZmFjZSBFbXB0eVRocmVhZElQcm9wcyB7XG4gICAgZmlsdGVyT3B0aW9uOiBUaHJlYWRGaWx0ZXJUeXBlO1xuICAgIHNob3dBbGxUaHJlYWRzQ2FsbGJhY2s6ICgpID0+IHZvaWQ7XG59XG5cbmNvbnN0IEVtcHR5VGhyZWFkOiBSZWFjdC5GQzxFbXB0eVRocmVhZElQcm9wcz4gPSAoeyBmaWx0ZXJPcHRpb24sIHNob3dBbGxUaHJlYWRzQ2FsbGJhY2sgfSkgPT4ge1xuICAgIHJldHVybiA8YXNpZGUgY2xhc3NOYW1lPVwibXhfVGhyZWFkUGFuZWxfZW1wdHlcIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9UaHJlYWRQYW5lbF9sYXJnZUljb25cIiAvPlxuICAgICAgICA8aDI+eyBfdChcIktlZXAgZGlzY3Vzc2lvbnMgb3JnYW5pc2VkIHdpdGggdGhyZWFkc1wiKSB9PC9oMj5cbiAgICAgICAgPHA+eyBfdChcIlRocmVhZHMgaGVscCB5b3Uga2VlcCBjb252ZXJzYXRpb25zIG9uLXRvcGljIGFuZCBlYXNpbHkgXCJcbiAgICAgICAgICAgICAgKyBcInRyYWNrIHRoZW0gb3ZlciB0aW1lLiBDcmVhdGUgdGhlIGZpcnN0IG9uZSBieSB1c2luZyB0aGUgXCJcbiAgICAgICAgICAgICAgKyBcIlxcXCJSZXBseSBpbiB0aHJlYWRcXFwiIGJ1dHRvbiBvbiBhIG1lc3NhZ2UuXCIpIH1cbiAgICAgICAgPC9wPlxuICAgICAgICA8cD5cbiAgICAgICAgICAgIHsgLyogQWx3YXlzIGRpc3BsYXkgdGhhdCBwYXJhZ3JhcGggdG8gcHJldmVudCBsYXlvdXQgc2hpZnRcbiAgICAgICAgICAgICAgICBXaGVuIGhpZGluZyB0aGUgYnV0dG9uICovIH1cbiAgICAgICAgICAgIHsgZmlsdGVyT3B0aW9uID09PSBUaHJlYWRGaWx0ZXJUeXBlLk15XG4gICAgICAgICAgICAgICAgPyA8YnV0dG9uIG9uQ2xpY2s9e3Nob3dBbGxUaHJlYWRzQ2FsbGJhY2t9PnsgX3QoXCJTaG93IGFsbCB0aHJlYWRzXCIpIH08L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA6IDw+Jm5ic3A7PC8+XG4gICAgICAgICAgICB9XG4gICAgICAgIDwvcD5cbiAgICA8L2FzaWRlPjtcbn07XG5cbmNvbnN0IFRocmVhZFBhbmVsOiBSZWFjdC5GQzxJUHJvcHM+ID0gKHsgcm9vbUlkLCBvbkNsb3NlLCBwZXJtYWxpbmtDcmVhdG9yIH0pID0+IHtcbiAgICBjb25zdCBteENsaWVudCA9IHVzZUNvbnRleHQoTWF0cml4Q2xpZW50Q29udGV4dCk7XG4gICAgY29uc3Qgcm9vbUNvbnRleHQgPSB1c2VDb250ZXh0KFJvb21Db250ZXh0KTtcbiAgICBjb25zdCByb29tID0gbXhDbGllbnQuZ2V0Um9vbShyb29tSWQpO1xuICAgIGNvbnN0IFtmaWx0ZXJPcHRpb24sIHNldEZpbHRlck9wdGlvbl0gPSB1c2VTdGF0ZTxUaHJlYWRGaWx0ZXJUeXBlPihUaHJlYWRGaWx0ZXJUeXBlLkFsbCk7XG4gICAgY29uc3QgcmVmID0gdXNlUmVmPFRpbWVsaW5lUGFuZWw+KCk7XG5cbiAgICBjb25zdCBmaWx0ZXJlZFRpbWVsaW5lU2V0ID0gdXNlRmlsdGVyZWRUaHJlYWRzVGltZWxpbmVQYW5lbCh7XG4gICAgICAgIHRocmVhZHM6IHJvb20udGhyZWFkcyxcbiAgICAgICAgcm9vbSxcbiAgICAgICAgZmlsdGVyT3B0aW9uLFxuICAgICAgICB1c2VySWQ6IG14Q2xpZW50LmdldFVzZXJJZCgpLFxuICAgICAgICB1cGRhdGVUaW1lbGluZTogKCkgPT4gcmVmLmN1cnJlbnQ/LnJlZnJlc2hUaW1lbGluZSgpLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgICAgPFJvb21Db250ZXh0LlByb3ZpZGVyIHZhbHVlPXt7XG4gICAgICAgICAgICAuLi5yb29tQ29udGV4dCxcbiAgICAgICAgICAgIHRpbWVsaW5lUmVuZGVyaW5nVHlwZTogVGltZWxpbmVSZW5kZXJpbmdUeXBlLlRocmVhZHNMaXN0LFxuICAgICAgICAgICAgbGl2ZVRpbWVsaW5lOiBmaWx0ZXJlZFRpbWVsaW5lU2V0LmdldExpdmVUaW1lbGluZSgpLFxuICAgICAgICAgICAgc2hvd0hpZGRlbkV2ZW50c0luVGltZWxpbmU6IHRydWUsXG4gICAgICAgIH19PlxuICAgICAgICAgICAgPEJhc2VDYXJkXG4gICAgICAgICAgICAgICAgaGVhZGVyPXs8VGhyZWFkUGFuZWxIZWFkZXIgZmlsdGVyT3B0aW9uPXtmaWx0ZXJPcHRpb259IHNldEZpbHRlck9wdGlvbj17c2V0RmlsdGVyT3B0aW9ufSAvPn1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9UaHJlYWRQYW5lbFwiXG4gICAgICAgICAgICAgICAgb25DbG9zZT17b25DbG9zZX1cbiAgICAgICAgICAgICAgICB3aXRob3V0U2Nyb2xsQ29udGFpbmVyPXt0cnVlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxUaW1lbGluZVBhbmVsXG4gICAgICAgICAgICAgICAgICAgIHJlZj17cmVmfVxuICAgICAgICAgICAgICAgICAgICBzaG93UmVhZFJlY2VpcHRzPXtmYWxzZX0gLy8gTm8gUlIgc3VwcG9ydCBpbiB0aHJlYWQncyBNVlBcbiAgICAgICAgICAgICAgICAgICAgbWFuYWdlUmVhZFJlY2VpcHRzPXtmYWxzZX0gLy8gTm8gUlIgc3VwcG9ydCBpbiB0aHJlYWQncyBNVlBcbiAgICAgICAgICAgICAgICAgICAgbWFuYWdlUmVhZE1hcmtlcnM9e2ZhbHNlfSAvLyBObyBSTSBzdXBwb3J0IGluIHRocmVhZCdzIE1WUFxuICAgICAgICAgICAgICAgICAgICBzZW5kUmVhZFJlY2VpcHRPbkxvYWQ9e2ZhbHNlfSAvLyBObyBSUiBzdXBwb3J0IGluIHRocmVhZCdzIE1WUFxuICAgICAgICAgICAgICAgICAgICB0aW1lbGluZVNldD17ZmlsdGVyZWRUaW1lbGluZVNldH1cbiAgICAgICAgICAgICAgICAgICAgc2hvd1VybFByZXZpZXc9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgIGVtcHR5PXs8RW1wdHlUaHJlYWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlck9wdGlvbj17ZmlsdGVyT3B0aW9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0FsbFRocmVhZHNDYWxsYmFjaz17KCkgPT4gc2V0RmlsdGVyT3B0aW9uKFRocmVhZEZpbHRlclR5cGUuQWxsKX1cbiAgICAgICAgICAgICAgICAgICAgLz59XG4gICAgICAgICAgICAgICAgICAgIGFsd2F5c1Nob3dUaW1lc3RhbXBzPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICBsYXlvdXQ9e0xheW91dC5Hcm91cH1cbiAgICAgICAgICAgICAgICAgICAgaGlkZVRocmVhZGVkTWVzc2FnZXM9e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICBoaWRkZW49e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICBzaG93UmVhY3Rpb25zPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9Sb29tVmlld19tZXNzYWdlUGFuZWwgbXhfR3JvdXBMYXlvdXRcIlxuICAgICAgICAgICAgICAgICAgICBtZW1iZXJzTG9hZGVkPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICBwZXJtYWxpbmtDcmVhdG9yPXtwZXJtYWxpbmtDcmVhdG9yfVxuICAgICAgICAgICAgICAgICAgICB0aWxlU2hhcGU9e1RpbGVTaGFwZS5UaHJlYWRQYW5lbH1cbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZUdyb3VwaW5nPXt0cnVlfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L0Jhc2VDYXJkPlxuICAgICAgICA8L1Jvb21Db250ZXh0LlByb3ZpZGVyPlxuICAgICk7XG59O1xuZXhwb3J0IGRlZmF1bHQgVGhyZWFkUGFuZWw7XG4iXX0=