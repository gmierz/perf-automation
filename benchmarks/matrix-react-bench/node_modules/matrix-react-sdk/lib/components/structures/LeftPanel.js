"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var React = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _dispatcher = _interopRequireDefault(require("../../dispatcher/dispatcher"));

var _languageHandler = require("../../languageHandler");

var _RoomList = _interopRequireDefault(require("../views/rooms/RoomList"));

var _CallHandler = _interopRequireDefault(require("../../CallHandler"));

var _RoomSublist = require("../views/rooms/RoomSublist");

var _actions = require("../../dispatcher/actions");

var _UserMenu = _interopRequireDefault(require("./UserMenu"));

var _RoomSearch = _interopRequireDefault(require("./RoomSearch"));

var _RoomBreadcrumbs = _interopRequireDefault(require("../views/rooms/RoomBreadcrumbs"));

var _BreadcrumbsStore = require("../../stores/BreadcrumbsStore");

var _AsyncStore = require("../../stores/AsyncStore");

var _RoomListStore = _interopRequireWildcard(require("../../stores/room-list/RoomListStore"));

var _IndicatorScrollbar = _interopRequireDefault(require("../structures/IndicatorScrollbar"));

var _AccessibleTooltipButton = _interopRequireDefault(require("../views/elements/AccessibleTooltipButton"));

var _RoomListNumResults = _interopRequireDefault(require("../views/rooms/RoomListNumResults"));

var _LeftPanelWidget = _interopRequireDefault(require("./LeftPanelWidget"));

var _replaceableComponent = require("../../utils/replaceableComponent");

var _SpaceStore = _interopRequireDefault(require("../../stores/spaces/SpaceStore"));

var _spaces = require("../../stores/spaces");

var _KeyBindingsManager = require("../../KeyBindingsManager");

var _UIStore = _interopRequireDefault(require("../../stores/UIStore"));

var _RovingTabIndex = require("../../accessibility/RovingTabIndex");

var _MatrixClientContext = _interopRequireDefault(require("../../contexts/MatrixClientContext"));

var _Keyboard = require("../../Keyboard");

var _dec, _class, _class2, _temp;

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let LeftPanel = (_dec = (0, _replaceableComponent.replaceableComponent)("structures.LeftPanel"), _dec(_class = (_temp = _class2 = class LeftPanel extends React.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "ref", /*#__PURE__*/(0, React.createRef)());
    (0, _defineProperty2.default)(this, "listContainerRef", /*#__PURE__*/(0, React.createRef)());
    (0, _defineProperty2.default)(this, "roomSearchRef", /*#__PURE__*/(0, React.createRef)());
    (0, _defineProperty2.default)(this, "roomListRef", /*#__PURE__*/(0, React.createRef)());
    (0, _defineProperty2.default)(this, "focusedElement", null);
    (0, _defineProperty2.default)(this, "isDoingStickyHeaders", false);
    (0, _defineProperty2.default)(this, "context", void 0);
    (0, _defineProperty2.default)(this, "updateActiveSpace", activeSpace => {
      this.setState({
        activeSpace
      });
    });
    (0, _defineProperty2.default)(this, "onDialPad", () => {
      _dispatcher.default.fire(_actions.Action.OpenDialPad);
    });
    (0, _defineProperty2.default)(this, "onExplore", () => {
      _dispatcher.default.fire(_actions.Action.ViewRoomDirectory);
    });
    (0, _defineProperty2.default)(this, "refreshStickyHeaders", () => {
      if (!this.listContainerRef.current) return; // ignore: no headers to sticky

      this.handleStickyHeaders(this.listContainerRef.current);
    });
    (0, _defineProperty2.default)(this, "onBreadcrumbsUpdate", () => {
      const newVal = _BreadcrumbsStore.BreadcrumbsStore.instance.visible;

      if (newVal !== this.state.showBreadcrumbs) {
        this.setState({
          showBreadcrumbs: newVal
        }); // Update the sticky headers too as the breadcrumbs will be popping in or out.

        if (!this.listContainerRef.current) return; // ignore: no headers to sticky

        this.handleStickyHeaders(this.listContainerRef.current);
      }
    });
    (0, _defineProperty2.default)(this, "onScroll", ev => {
      const list = ev.target;
      this.handleStickyHeaders(list);
    });
    (0, _defineProperty2.default)(this, "onFocus", ev => {
      this.focusedElement = ev.target;
    });
    (0, _defineProperty2.default)(this, "onBlur", () => {
      this.focusedElement = null;
    });
    (0, _defineProperty2.default)(this, "onKeyDown", (ev, state) => {
      if (!this.focusedElement) return;
      const action = (0, _KeyBindingsManager.getKeyBindingsManager)().getRoomListAction(ev);

      switch (action) {
        case _KeyBindingsManager.RoomListAction.NextRoom:
          if (!state) {
            var _this$roomListRef$cur;

            ev.stopPropagation();
            ev.preventDefault();
            (_this$roomListRef$cur = this.roomListRef.current) === null || _this$roomListRef$cur === void 0 ? void 0 : _this$roomListRef$cur.focus();
          }

          break;

        case _KeyBindingsManager.RoomListAction.PrevRoom:
          if (state && state.activeRef === (0, _RovingTabIndex.findSiblingElement)(state.refs, 0)) {
            var _this$roomSearchRef$c;

            ev.stopPropagation();
            ev.preventDefault();
            (_this$roomSearchRef$c = this.roomSearchRef.current) === null || _this$roomSearchRef$c === void 0 ? void 0 : _this$roomSearchRef$c.focus();
          }

          break;
      }
    });
    (0, _defineProperty2.default)(this, "onRoomListKeydown", ev => {
      if (ev.altKey || ev.ctrlKey || ev.metaKey) return; // we cannot handle Space as that is an activation key for all focusable elements in this widget

      if (ev.key.length === 1) {
        var _this$roomSearchRef$c2;

        ev.preventDefault();
        ev.stopPropagation();
        (_this$roomSearchRef$c2 = this.roomSearchRef.current) === null || _this$roomSearchRef$c2 === void 0 ? void 0 : _this$roomSearchRef$c2.appendChar(ev.key);
      } else if (ev.key === _Keyboard.Key.BACKSPACE) {
        var _this$roomSearchRef$c3;

        ev.preventDefault();
        ev.stopPropagation();
        (_this$roomSearchRef$c3 = this.roomSearchRef.current) === null || _this$roomSearchRef$c3 === void 0 ? void 0 : _this$roomSearchRef$c3.backspace();
      }
    });
    (0, _defineProperty2.default)(this, "selectRoom", () => {
      const firstRoom = this.listContainerRef.current.querySelector(".mx_RoomTile");

      if (firstRoom) {
        firstRoom.click();
        return true; // to get the field to clear
      }
    });
    this.state = {
      showBreadcrumbs: _BreadcrumbsStore.BreadcrumbsStore.instance.visible,
      activeSpace: _SpaceStore.default.instance.activeSpace
    };

    _BreadcrumbsStore.BreadcrumbsStore.instance.on(_AsyncStore.UPDATE_EVENT, this.onBreadcrumbsUpdate);

    _RoomListStore.default.instance.on(_RoomListStore.LISTS_UPDATE_EVENT, this.onBreadcrumbsUpdate);

    _SpaceStore.default.instance.on(_spaces.UPDATE_SELECTED_SPACE, this.updateActiveSpace);
  }

  componentDidMount() {
    var _this$listContainerRe;

    _UIStore.default.instance.trackElementDimensions("LeftPanel", this.ref.current);

    _UIStore.default.instance.trackElementDimensions("ListContainer", this.listContainerRef.current);

    _UIStore.default.instance.on("ListContainer", this.refreshStickyHeaders); // Using the passive option to not block the main thread
    // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#improving_scrolling_performance_with_passive_listeners


    (_this$listContainerRe = this.listContainerRef.current) === null || _this$listContainerRe === void 0 ? void 0 : _this$listContainerRe.addEventListener("scroll", this.onScroll, {
      passive: true
    });
  }

  componentWillUnmount() {
    var _this$listContainerRe2;

    _BreadcrumbsStore.BreadcrumbsStore.instance.off(_AsyncStore.UPDATE_EVENT, this.onBreadcrumbsUpdate);

    _RoomListStore.default.instance.off(_RoomListStore.LISTS_UPDATE_EVENT, this.onBreadcrumbsUpdate);

    _SpaceStore.default.instance.off(_spaces.UPDATE_SELECTED_SPACE, this.updateActiveSpace);

    _UIStore.default.instance.stopTrackingElementDimensions("ListContainer");

    _UIStore.default.instance.removeListener("ListContainer", this.refreshStickyHeaders);

    (_this$listContainerRe2 = this.listContainerRef.current) === null || _this$listContainerRe2 === void 0 ? void 0 : _this$listContainerRe2.removeEventListener("scroll", this.onScroll);
  }

  componentDidUpdate(prevProps, prevState) {
    if (prevState.activeSpace !== this.state.activeSpace) {
      this.refreshStickyHeaders();
    }
  }

  handleStickyHeaders(list) {
    if (this.isDoingStickyHeaders) return;
    this.isDoingStickyHeaders = true;
    window.requestAnimationFrame(() => {
      this.doStickyHeaders(list);
      this.isDoingStickyHeaders = false;
    });
  }

  doStickyHeaders(list) {
    const topEdge = list.scrollTop;
    const bottomEdge = list.offsetHeight + list.scrollTop;
    const sublists = list.querySelectorAll(".mx_RoomSublist:not(.mx_RoomSublist_hidden)"); // We track which styles we want on a target before making the changes to avoid
    // excessive layout updates.

    const targetStyles = new Map();
    let lastTopHeader;
    let firstBottomHeader;

    for (const sublist of sublists) {
      const header = sublist.querySelector(".mx_RoomSublist_stickable");
      header.style.removeProperty("display"); // always clear display:none first
      // When an element is <=40% off screen, make it take over

      const offScreenFactor = 0.4;
      const isOffTop = sublist.offsetTop + offScreenFactor * _RoomSublist.HEADER_HEIGHT <= topEdge;
      const isOffBottom = sublist.offsetTop + offScreenFactor * _RoomSublist.HEADER_HEIGHT >= bottomEdge;

      if (isOffTop || sublist === sublists[0]) {
        targetStyles.set(header, {
          stickyTop: true
        });

        if (lastTopHeader) {
          lastTopHeader.style.display = "none";
          targetStyles.set(lastTopHeader, {
            makeInvisible: true
          });
        }

        lastTopHeader = header;
      } else if (isOffBottom && !firstBottomHeader) {
        targetStyles.set(header, {
          stickyBottom: true
        });
        firstBottomHeader = header;
      } else {
        targetStyles.set(header, {}); // nothing == clear
      }
    } // Run over the style changes and make them reality. We check to see if we're about to
    // cause a no-op update, as adding/removing properties that are/aren't there cause
    // layout updates.


    for (const header of targetStyles.keys()) {
      const style = targetStyles.get(header);

      if (style.makeInvisible) {
        // we will have already removed the 'display: none', so add it back.
        header.style.display = "none";
        continue; // nothing else to do, even if sticky somehow
      }

      if (style.stickyTop) {
        if (!header.classList.contains("mx_RoomSublist_headerContainer_stickyTop")) {
          header.classList.add("mx_RoomSublist_headerContainer_stickyTop");
        }

        const newTop = `${list.parentElement.offsetTop}px`;

        if (header.style.top !== newTop) {
          header.style.top = newTop;
        }
      } else {
        if (header.classList.contains("mx_RoomSublist_headerContainer_stickyTop")) {
          header.classList.remove("mx_RoomSublist_headerContainer_stickyTop");
        }

        if (header.style.top) {
          header.style.removeProperty('top');
        }
      }

      if (style.stickyBottom) {
        if (!header.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")) {
          header.classList.add("mx_RoomSublist_headerContainer_stickyBottom");
        }

        const offset = _UIStore.default.instance.windowHeight - (list.parentElement.offsetTop + list.parentElement.offsetHeight);
        const newBottom = `${offset}px`;

        if (header.style.bottom !== newBottom) {
          header.style.bottom = newBottom;
        }
      } else {
        if (header.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")) {
          header.classList.remove("mx_RoomSublist_headerContainer_stickyBottom");
        }

        if (header.style.bottom) {
          header.style.removeProperty('bottom');
        }
      }

      if (style.stickyTop || style.stickyBottom) {
        if (!header.classList.contains("mx_RoomSublist_headerContainer_sticky")) {
          header.classList.add("mx_RoomSublist_headerContainer_sticky");
        }

        const listDimensions = _UIStore.default.instance.getElementDimensions("ListContainer");

        if (listDimensions) {
          const headerRightMargin = 15; // calculated from margins and widths to align with non-sticky tiles

          const headerStickyWidth = listDimensions.width - headerRightMargin;
          const newWidth = `${headerStickyWidth}px`;

          if (header.style.width !== newWidth) {
            header.style.width = newWidth;
          }
        }
      } else if (!style.stickyTop && !style.stickyBottom) {
        if (header.classList.contains("mx_RoomSublist_headerContainer_sticky")) {
          header.classList.remove("mx_RoomSublist_headerContainer_sticky");
        }

        if (header.style.width) {
          header.style.removeProperty('width');
        }
      }
    } // add appropriate sticky classes to wrapper so it has
    // the necessary top/bottom padding to put the sticky header in


    const listWrapper = list.parentElement; // .mx_LeftPanel_roomListWrapper

    if (lastTopHeader) {
      listWrapper.classList.add("mx_LeftPanel_roomListWrapper_stickyTop");
    } else {
      listWrapper.classList.remove("mx_LeftPanel_roomListWrapper_stickyTop");
    }

    if (firstBottomHeader) {
      listWrapper.classList.add("mx_LeftPanel_roomListWrapper_stickyBottom");
    } else {
      listWrapper.classList.remove("mx_LeftPanel_roomListWrapper_stickyBottom");
    }
  }

  renderHeader() {
    return /*#__PURE__*/React.createElement("div", {
      className: "mx_LeftPanel_userHeader"
    }, /*#__PURE__*/React.createElement(_UserMenu.default, {
      isMinimized: this.props.isMinimized
    }));
  }

  renderBreadcrumbs() {
    if (this.state.showBreadcrumbs && !this.props.isMinimized) {
      return /*#__PURE__*/React.createElement(_IndicatorScrollbar.default, {
        className: "mx_LeftPanel_breadcrumbsContainer mx_AutoHideScrollbar",
        verticalScrollsHorizontally: true
      }, /*#__PURE__*/React.createElement(_RoomBreadcrumbs.default, null));
    }
  }

  renderSearchDialExplore() {
    let dialPadButton = null; // If we have dialer support, show a button to bring up the dial pad
    // to start a new call

    if (_CallHandler.default.sharedInstance().getSupportsPstnProtocol()) {
      dialPadButton = /*#__PURE__*/React.createElement(_AccessibleTooltipButton.default, {
        className: (0, _classnames.default)("mx_LeftPanel_dialPadButton", {}),
        onClick: this.onDialPad,
        title: (0, _languageHandler._t)("Open dial pad")
      });
    }

    const space = this.state.activeSpace[0] === "!" ? this.context.getRoom(this.state.activeSpace) : null;
    return /*#__PURE__*/React.createElement("div", {
      className: "mx_LeftPanel_filterContainer",
      onFocus: this.onFocus,
      onBlur: this.onBlur,
      onKeyDown: this.onKeyDown
    }, /*#__PURE__*/React.createElement(_RoomSearch.default, {
      isMinimized: this.props.isMinimized,
      ref: this.roomSearchRef,
      onSelectRoom: this.selectRoom
    }), dialPadButton, /*#__PURE__*/React.createElement(_AccessibleTooltipButton.default, {
      className: (0, _classnames.default)("mx_LeftPanel_exploreButton", {
        mx_LeftPanel_exploreButton_space: !!this.state.activeSpace
      }),
      onClick: this.onExplore,
      title: space ? (0, _languageHandler._t)("Explore %(spaceName)s", {
        spaceName: space.name
      }) : (0, _languageHandler._t)("Explore rooms")
    }));
  }

  render() {
    const roomList = /*#__PURE__*/React.createElement(_RoomList.default, {
      onKeyDown: this.onKeyDown,
      resizeNotifier: this.props.resizeNotifier,
      onFocus: this.onFocus,
      onBlur: this.onBlur,
      isMinimized: this.props.isMinimized,
      activeSpace: this.state.activeSpace,
      onResize: this.refreshStickyHeaders,
      onListCollapse: this.refreshStickyHeaders,
      ref: this.roomListRef
    });
    const containerClasses = (0, _classnames.default)({
      "mx_LeftPanel": true,
      "mx_LeftPanel_minimized": this.props.isMinimized
    });
    const roomListClasses = (0, _classnames.default)("mx_LeftPanel_actualRoomListContainer", "mx_AutoHideScrollbar");
    return /*#__PURE__*/React.createElement("div", {
      className: containerClasses,
      ref: this.ref
    }, /*#__PURE__*/React.createElement("aside", {
      className: "mx_LeftPanel_roomListContainer"
    }, this.renderHeader(), this.renderSearchDialExplore(), this.renderBreadcrumbs(), /*#__PURE__*/React.createElement(_RoomListNumResults.default, {
      onVisibilityChange: this.refreshStickyHeaders
    }), /*#__PURE__*/React.createElement("div", {
      className: "mx_LeftPanel_roomListWrapper"
    }, /*#__PURE__*/React.createElement("div", {
      className: roomListClasses,
      ref: this.listContainerRef // Firefox sometimes makes this element focusable due to
      // overflow:scroll;, so force it out of tab order.
      ,
      tabIndex: -1,
      onKeyDown: this.onRoomListKeydown
    }, roomList)), !this.props.isMinimized && /*#__PURE__*/React.createElement(_LeftPanelWidget.default, null)));
  }

}, (0, _defineProperty2.default)(_class2, "contextType", _MatrixClientContext.default), _temp)) || _class);
exports.default = LeftPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvTGVmdFBhbmVsLnRzeCJdLCJuYW1lcyI6WyJMZWZ0UGFuZWwiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJhY3RpdmVTcGFjZSIsInNldFN0YXRlIiwiZGlzIiwiZmlyZSIsIkFjdGlvbiIsIk9wZW5EaWFsUGFkIiwiVmlld1Jvb21EaXJlY3RvcnkiLCJsaXN0Q29udGFpbmVyUmVmIiwiY3VycmVudCIsImhhbmRsZVN0aWNreUhlYWRlcnMiLCJuZXdWYWwiLCJCcmVhZGNydW1ic1N0b3JlIiwiaW5zdGFuY2UiLCJ2aXNpYmxlIiwic3RhdGUiLCJzaG93QnJlYWRjcnVtYnMiLCJldiIsImxpc3QiLCJ0YXJnZXQiLCJmb2N1c2VkRWxlbWVudCIsImFjdGlvbiIsImdldFJvb21MaXN0QWN0aW9uIiwiUm9vbUxpc3RBY3Rpb24iLCJOZXh0Um9vbSIsInN0b3BQcm9wYWdhdGlvbiIsInByZXZlbnREZWZhdWx0Iiwicm9vbUxpc3RSZWYiLCJmb2N1cyIsIlByZXZSb29tIiwiYWN0aXZlUmVmIiwicmVmcyIsInJvb21TZWFyY2hSZWYiLCJhbHRLZXkiLCJjdHJsS2V5IiwibWV0YUtleSIsImtleSIsImxlbmd0aCIsImFwcGVuZENoYXIiLCJLZXkiLCJCQUNLU1BBQ0UiLCJiYWNrc3BhY2UiLCJmaXJzdFJvb20iLCJxdWVyeVNlbGVjdG9yIiwiY2xpY2siLCJTcGFjZVN0b3JlIiwib24iLCJVUERBVEVfRVZFTlQiLCJvbkJyZWFkY3J1bWJzVXBkYXRlIiwiUm9vbUxpc3RTdG9yZSIsIkxJU1RTX1VQREFURV9FVkVOVCIsIlVQREFURV9TRUxFQ1RFRF9TUEFDRSIsInVwZGF0ZUFjdGl2ZVNwYWNlIiwiY29tcG9uZW50RGlkTW91bnQiLCJVSVN0b3JlIiwidHJhY2tFbGVtZW50RGltZW5zaW9ucyIsInJlZiIsInJlZnJlc2hTdGlja3lIZWFkZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uU2Nyb2xsIiwicGFzc2l2ZSIsImNvbXBvbmVudFdpbGxVbm1vdW50Iiwib2ZmIiwic3RvcFRyYWNraW5nRWxlbWVudERpbWVuc2lvbnMiLCJyZW1vdmVMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjb21wb25lbnREaWRVcGRhdGUiLCJwcmV2UHJvcHMiLCJwcmV2U3RhdGUiLCJpc0RvaW5nU3RpY2t5SGVhZGVycyIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImRvU3RpY2t5SGVhZGVycyIsInRvcEVkZ2UiLCJzY3JvbGxUb3AiLCJib3R0b21FZGdlIiwib2Zmc2V0SGVpZ2h0Iiwic3VibGlzdHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwidGFyZ2V0U3R5bGVzIiwiTWFwIiwibGFzdFRvcEhlYWRlciIsImZpcnN0Qm90dG9tSGVhZGVyIiwic3VibGlzdCIsImhlYWRlciIsInN0eWxlIiwicmVtb3ZlUHJvcGVydHkiLCJvZmZTY3JlZW5GYWN0b3IiLCJpc09mZlRvcCIsIm9mZnNldFRvcCIsIkhFQURFUl9IRUlHSFQiLCJpc09mZkJvdHRvbSIsInNldCIsInN0aWNreVRvcCIsImRpc3BsYXkiLCJtYWtlSW52aXNpYmxlIiwic3RpY2t5Qm90dG9tIiwia2V5cyIsImdldCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiYWRkIiwibmV3VG9wIiwicGFyZW50RWxlbWVudCIsInRvcCIsInJlbW92ZSIsIm9mZnNldCIsIndpbmRvd0hlaWdodCIsIm5ld0JvdHRvbSIsImJvdHRvbSIsImxpc3REaW1lbnNpb25zIiwiZ2V0RWxlbWVudERpbWVuc2lvbnMiLCJoZWFkZXJSaWdodE1hcmdpbiIsImhlYWRlclN0aWNreVdpZHRoIiwid2lkdGgiLCJuZXdXaWR0aCIsImxpc3RXcmFwcGVyIiwicmVuZGVySGVhZGVyIiwiaXNNaW5pbWl6ZWQiLCJyZW5kZXJCcmVhZGNydW1icyIsInJlbmRlclNlYXJjaERpYWxFeHBsb3JlIiwiZGlhbFBhZEJ1dHRvbiIsIkNhbGxIYW5kbGVyIiwic2hhcmVkSW5zdGFuY2UiLCJnZXRTdXBwb3J0c1BzdG5Qcm90b2NvbCIsIm9uRGlhbFBhZCIsInNwYWNlIiwiY29udGV4dCIsImdldFJvb20iLCJvbkZvY3VzIiwib25CbHVyIiwib25LZXlEb3duIiwic2VsZWN0Um9vbSIsIm14X0xlZnRQYW5lbF9leHBsb3JlQnV0dG9uX3NwYWNlIiwib25FeHBsb3JlIiwic3BhY2VOYW1lIiwibmFtZSIsInJlbmRlciIsInJvb21MaXN0IiwicmVzaXplTm90aWZpZXIiLCJjb250YWluZXJDbGFzc2VzIiwicm9vbUxpc3RDbGFzc2VzIiwib25Sb29tTGlzdEtleWRvd24iLCJNYXRyaXhDbGllbnRDb250ZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7SUFhcUJBLFMsV0FEcEIsZ0RBQXFCLHNCQUFyQixDLG1DQUFELE1BQ3FCQSxTQURyQixTQUN1Q0MsS0FBSyxDQUFDQyxTQUQ3QyxDQUN1RTtBQVduRUMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQWdCO0FBQ3ZCLFVBQU1BLEtBQU47QUFEdUIsNERBVmIsc0JBVWE7QUFBQSx5RUFUQSxzQkFTQTtBQUFBLHNFQVJILHNCQVFHO0FBQUEsb0VBUEwsc0JBT0s7QUFBQSwwREFORixJQU1FO0FBQUEsZ0VBTEksS0FLSjtBQUFBO0FBQUEsNkRBcUNFQyxXQUFELElBQTJCO0FBQ25ELFdBQUtDLFFBQUwsQ0FBYztBQUFFRCxRQUFBQTtBQUFGLE9BQWQ7QUFDSCxLQXZDMEI7QUFBQSxxREF5Q1AsTUFBTTtBQUN0QkUsMEJBQUlDLElBQUosQ0FBU0MsZ0JBQU9DLFdBQWhCO0FBQ0gsS0EzQzBCO0FBQUEscURBNkNQLE1BQU07QUFDdEJILDBCQUFJQyxJQUFKLENBQVNDLGdCQUFPRSxpQkFBaEI7QUFDSCxLQS9DMEI7QUFBQSxnRUFpREksTUFBTTtBQUNqQyxVQUFJLENBQUMsS0FBS0MsZ0JBQUwsQ0FBc0JDLE9BQTNCLEVBQW9DLE9BREgsQ0FDVzs7QUFDNUMsV0FBS0MsbUJBQUwsQ0FBeUIsS0FBS0YsZ0JBQUwsQ0FBc0JDLE9BQS9DO0FBQ0gsS0FwRDBCO0FBQUEsK0RBc0RHLE1BQU07QUFDaEMsWUFBTUUsTUFBTSxHQUFHQyxtQ0FBaUJDLFFBQWpCLENBQTBCQyxPQUF6Qzs7QUFDQSxVQUFJSCxNQUFNLEtBQUssS0FBS0ksS0FBTCxDQUFXQyxlQUExQixFQUEyQztBQUN2QyxhQUFLZCxRQUFMLENBQWM7QUFBRWMsVUFBQUEsZUFBZSxFQUFFTDtBQUFuQixTQUFkLEVBRHVDLENBR3ZDOztBQUNBLFlBQUksQ0FBQyxLQUFLSCxnQkFBTCxDQUFzQkMsT0FBM0IsRUFBb0MsT0FKRyxDQUlLOztBQUM1QyxhQUFLQyxtQkFBTCxDQUF5QixLQUFLRixnQkFBTCxDQUFzQkMsT0FBL0M7QUFDSDtBQUNKLEtBL0QwQjtBQUFBLG9EQTJNUFEsRUFBRCxJQUFlO0FBQzlCLFlBQU1DLElBQUksR0FBR0QsRUFBRSxDQUFDRSxNQUFoQjtBQUNBLFdBQUtULG1CQUFMLENBQXlCUSxJQUF6QjtBQUNILEtBOU0wQjtBQUFBLG1EQWdOUkQsRUFBRCxJQUEwQjtBQUN4QyxXQUFLRyxjQUFMLEdBQXNCSCxFQUFFLENBQUNFLE1BQXpCO0FBQ0gsS0FsTjBCO0FBQUEsa0RBb05WLE1BQU07QUFDbkIsV0FBS0MsY0FBTCxHQUFzQixJQUF0QjtBQUNILEtBdE4wQjtBQUFBLHFEQXdOUCxDQUFDSCxFQUFELEVBQTBCRixLQUExQixLQUEyRDtBQUMzRSxVQUFJLENBQUMsS0FBS0ssY0FBVixFQUEwQjtBQUUxQixZQUFNQyxNQUFNLEdBQUcsaURBQXdCQyxpQkFBeEIsQ0FBMENMLEVBQTFDLENBQWY7O0FBQ0EsY0FBUUksTUFBUjtBQUNJLGFBQUtFLG1DQUFlQyxRQUFwQjtBQUNJLGNBQUksQ0FBQ1QsS0FBTCxFQUFZO0FBQUE7O0FBQ1JFLFlBQUFBLEVBQUUsQ0FBQ1EsZUFBSDtBQUNBUixZQUFBQSxFQUFFLENBQUNTLGNBQUg7QUFDQSwwQ0FBS0MsV0FBTCxDQUFpQmxCLE9BQWpCLGdGQUEwQm1CLEtBQTFCO0FBQ0g7O0FBQ0Q7O0FBRUosYUFBS0wsbUNBQWVNLFFBQXBCO0FBQ0ksY0FBSWQsS0FBSyxJQUFJQSxLQUFLLENBQUNlLFNBQU4sS0FBb0Isd0NBQW1CZixLQUFLLENBQUNnQixJQUF6QixFQUErQixDQUEvQixDQUFqQyxFQUFvRTtBQUFBOztBQUNoRWQsWUFBQUEsRUFBRSxDQUFDUSxlQUFIO0FBQ0FSLFlBQUFBLEVBQUUsQ0FBQ1MsY0FBSDtBQUNBLDBDQUFLTSxhQUFMLENBQW1CdkIsT0FBbkIsZ0ZBQTRCbUIsS0FBNUI7QUFDSDs7QUFDRDtBQWZSO0FBaUJILEtBN08wQjtBQUFBLDZEQStPRVgsRUFBRCxJQUE2QjtBQUNyRCxVQUFJQSxFQUFFLENBQUNnQixNQUFILElBQWFoQixFQUFFLENBQUNpQixPQUFoQixJQUEyQmpCLEVBQUUsQ0FBQ2tCLE9BQWxDLEVBQTJDLE9BRFUsQ0FFckQ7O0FBQ0EsVUFBSWxCLEVBQUUsQ0FBQ21CLEdBQUgsQ0FBT0MsTUFBUCxLQUFrQixDQUF0QixFQUF5QjtBQUFBOztBQUNyQnBCLFFBQUFBLEVBQUUsQ0FBQ1MsY0FBSDtBQUNBVCxRQUFBQSxFQUFFLENBQUNRLGVBQUg7QUFDQSx1Q0FBS08sYUFBTCxDQUFtQnZCLE9BQW5CLGtGQUE0QjZCLFVBQTVCLENBQXVDckIsRUFBRSxDQUFDbUIsR0FBMUM7QUFDSCxPQUpELE1BSU8sSUFBSW5CLEVBQUUsQ0FBQ21CLEdBQUgsS0FBV0csY0FBSUMsU0FBbkIsRUFBOEI7QUFBQTs7QUFDakN2QixRQUFBQSxFQUFFLENBQUNTLGNBQUg7QUFDQVQsUUFBQUEsRUFBRSxDQUFDUSxlQUFIO0FBQ0EsdUNBQUtPLGFBQUwsQ0FBbUJ2QixPQUFuQixrRkFBNEJnQyxTQUE1QjtBQUNIO0FBQ0osS0EzUDBCO0FBQUEsc0RBNlBOLE1BQU07QUFDdkIsWUFBTUMsU0FBUyxHQUFHLEtBQUtsQyxnQkFBTCxDQUFzQkMsT0FBdEIsQ0FBOEJrQyxhQUE5QixDQUE0RCxjQUE1RCxDQUFsQjs7QUFDQSxVQUFJRCxTQUFKLEVBQWU7QUFDWEEsUUFBQUEsU0FBUyxDQUFDRSxLQUFWO0FBQ0EsZUFBTyxJQUFQLENBRlcsQ0FFRTtBQUNoQjtBQUNKLEtBblEwQjtBQUd2QixTQUFLN0IsS0FBTCxHQUFhO0FBQ1RDLE1BQUFBLGVBQWUsRUFBRUosbUNBQWlCQyxRQUFqQixDQUEwQkMsT0FEbEM7QUFFVGIsTUFBQUEsV0FBVyxFQUFFNEMsb0JBQVdoQyxRQUFYLENBQW9CWjtBQUZ4QixLQUFiOztBQUtBVyx1Q0FBaUJDLFFBQWpCLENBQTBCaUMsRUFBMUIsQ0FBNkJDLHdCQUE3QixFQUEyQyxLQUFLQyxtQkFBaEQ7O0FBQ0FDLDJCQUFjcEMsUUFBZCxDQUF1QmlDLEVBQXZCLENBQTBCSSxpQ0FBMUIsRUFBOEMsS0FBS0YsbUJBQW5EOztBQUNBSCx3QkFBV2hDLFFBQVgsQ0FBb0JpQyxFQUFwQixDQUF1QkssNkJBQXZCLEVBQThDLEtBQUtDLGlCQUFuRDtBQUNIOztBQUVNQyxFQUFBQSxpQkFBaUIsR0FBRztBQUFBOztBQUN2QkMscUJBQVF6QyxRQUFSLENBQWlCMEMsc0JBQWpCLENBQXdDLFdBQXhDLEVBQXFELEtBQUtDLEdBQUwsQ0FBUy9DLE9BQTlEOztBQUNBNkMscUJBQVF6QyxRQUFSLENBQWlCMEMsc0JBQWpCLENBQXdDLGVBQXhDLEVBQXlELEtBQUsvQyxnQkFBTCxDQUFzQkMsT0FBL0U7O0FBQ0E2QyxxQkFBUXpDLFFBQVIsQ0FBaUJpQyxFQUFqQixDQUFvQixlQUFwQixFQUFxQyxLQUFLVyxvQkFBMUMsRUFIdUIsQ0FJdkI7QUFDQTs7O0FBQ0Esa0NBQUtqRCxnQkFBTCxDQUFzQkMsT0FBdEIsZ0ZBQStCaUQsZ0JBQS9CLENBQWdELFFBQWhELEVBQTBELEtBQUtDLFFBQS9ELEVBQXlFO0FBQUVDLE1BQUFBLE9BQU8sRUFBRTtBQUFYLEtBQXpFO0FBQ0g7O0FBRU1DLEVBQUFBLG9CQUFvQixHQUFHO0FBQUE7O0FBQzFCakQsdUNBQWlCQyxRQUFqQixDQUEwQmlELEdBQTFCLENBQThCZix3QkFBOUIsRUFBNEMsS0FBS0MsbUJBQWpEOztBQUNBQywyQkFBY3BDLFFBQWQsQ0FBdUJpRCxHQUF2QixDQUEyQlosaUNBQTNCLEVBQStDLEtBQUtGLG1CQUFwRDs7QUFDQUgsd0JBQVdoQyxRQUFYLENBQW9CaUQsR0FBcEIsQ0FBd0JYLDZCQUF4QixFQUErQyxLQUFLQyxpQkFBcEQ7O0FBQ0FFLHFCQUFRekMsUUFBUixDQUFpQmtELDZCQUFqQixDQUErQyxlQUEvQzs7QUFDQVQscUJBQVF6QyxRQUFSLENBQWlCbUQsY0FBakIsQ0FBZ0MsZUFBaEMsRUFBaUQsS0FBS1Asb0JBQXREOztBQUNBLG1DQUFLakQsZ0JBQUwsQ0FBc0JDLE9BQXRCLGtGQUErQndELG1CQUEvQixDQUFtRCxRQUFuRCxFQUE2RCxLQUFLTixRQUFsRTtBQUNIOztBQUVNTyxFQUFBQSxrQkFBa0IsQ0FBQ0MsU0FBRCxFQUFvQkMsU0FBcEIsRUFBNkM7QUFDbEUsUUFBSUEsU0FBUyxDQUFDbkUsV0FBVixLQUEwQixLQUFLYyxLQUFMLENBQVdkLFdBQXpDLEVBQXNEO0FBQ2xELFdBQUt3RCxvQkFBTDtBQUNIO0FBQ0o7O0FBOEJPL0MsRUFBQUEsbUJBQW1CLENBQUNRLElBQUQsRUFBdUI7QUFDOUMsUUFBSSxLQUFLbUQsb0JBQVQsRUFBK0I7QUFDL0IsU0FBS0Esb0JBQUwsR0FBNEIsSUFBNUI7QUFDQUMsSUFBQUEsTUFBTSxDQUFDQyxxQkFBUCxDQUE2QixNQUFNO0FBQy9CLFdBQUtDLGVBQUwsQ0FBcUJ0RCxJQUFyQjtBQUNBLFdBQUttRCxvQkFBTCxHQUE0QixLQUE1QjtBQUNILEtBSEQ7QUFJSDs7QUFFT0csRUFBQUEsZUFBZSxDQUFDdEQsSUFBRCxFQUF1QjtBQUMxQyxVQUFNdUQsT0FBTyxHQUFHdkQsSUFBSSxDQUFDd0QsU0FBckI7QUFDQSxVQUFNQyxVQUFVLEdBQUd6RCxJQUFJLENBQUMwRCxZQUFMLEdBQW9CMUQsSUFBSSxDQUFDd0QsU0FBNUM7QUFDQSxVQUFNRyxRQUFRLEdBQUczRCxJQUFJLENBQUM0RCxnQkFBTCxDQUFzQyw2Q0FBdEMsQ0FBakIsQ0FIMEMsQ0FLMUM7QUFDQTs7QUFDQSxVQUFNQyxZQUFZLEdBQUcsSUFBSUMsR0FBSixFQUFyQjtBQU1BLFFBQUlDLGFBQUo7QUFDQSxRQUFJQyxpQkFBSjs7QUFDQSxTQUFLLE1BQU1DLE9BQVgsSUFBc0JOLFFBQXRCLEVBQWdDO0FBQzVCLFlBQU1PLE1BQU0sR0FBR0QsT0FBTyxDQUFDeEMsYUFBUixDQUFzQywyQkFBdEMsQ0FBZjtBQUNBeUMsTUFBQUEsTUFBTSxDQUFDQyxLQUFQLENBQWFDLGNBQWIsQ0FBNEIsU0FBNUIsRUFGNEIsQ0FFWTtBQUV4Qzs7QUFDQSxZQUFNQyxlQUFlLEdBQUcsR0FBeEI7QUFDQSxZQUFNQyxRQUFRLEdBQUlMLE9BQU8sQ0FBQ00sU0FBUixHQUFxQkYsZUFBZSxHQUFHRywwQkFBeEMsSUFBMkRqQixPQUE1RTtBQUNBLFlBQU1rQixXQUFXLEdBQUlSLE9BQU8sQ0FBQ00sU0FBUixHQUFxQkYsZUFBZSxHQUFHRywwQkFBeEMsSUFBMkRmLFVBQS9FOztBQUVBLFVBQUlhLFFBQVEsSUFBSUwsT0FBTyxLQUFLTixRQUFRLENBQUMsQ0FBRCxDQUFwQyxFQUF5QztBQUNyQ0UsUUFBQUEsWUFBWSxDQUFDYSxHQUFiLENBQWlCUixNQUFqQixFQUF5QjtBQUFFUyxVQUFBQSxTQUFTLEVBQUU7QUFBYixTQUF6Qjs7QUFDQSxZQUFJWixhQUFKLEVBQW1CO0FBQ2ZBLFVBQUFBLGFBQWEsQ0FBQ0ksS0FBZCxDQUFvQlMsT0FBcEIsR0FBOEIsTUFBOUI7QUFDQWYsVUFBQUEsWUFBWSxDQUFDYSxHQUFiLENBQWlCWCxhQUFqQixFQUFnQztBQUFFYyxZQUFBQSxhQUFhLEVBQUU7QUFBakIsV0FBaEM7QUFDSDs7QUFDRGQsUUFBQUEsYUFBYSxHQUFHRyxNQUFoQjtBQUNILE9BUEQsTUFPTyxJQUFJTyxXQUFXLElBQUksQ0FBQ1QsaUJBQXBCLEVBQXVDO0FBQzFDSCxRQUFBQSxZQUFZLENBQUNhLEdBQWIsQ0FBaUJSLE1BQWpCLEVBQXlCO0FBQUVZLFVBQUFBLFlBQVksRUFBRTtBQUFoQixTQUF6QjtBQUNBZCxRQUFBQSxpQkFBaUIsR0FBR0UsTUFBcEI7QUFDSCxPQUhNLE1BR0E7QUFDSEwsUUFBQUEsWUFBWSxDQUFDYSxHQUFiLENBQWlCUixNQUFqQixFQUF5QixFQUF6QixFQURHLENBQzJCO0FBQ2pDO0FBQ0osS0FyQ3lDLENBdUMxQztBQUNBO0FBQ0E7OztBQUNBLFNBQUssTUFBTUEsTUFBWCxJQUFxQkwsWUFBWSxDQUFDa0IsSUFBYixFQUFyQixFQUEwQztBQUN0QyxZQUFNWixLQUFLLEdBQUdOLFlBQVksQ0FBQ21CLEdBQWIsQ0FBaUJkLE1BQWpCLENBQWQ7O0FBRUEsVUFBSUMsS0FBSyxDQUFDVSxhQUFWLEVBQXlCO0FBQ3JCO0FBQ0FYLFFBQUFBLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhUyxPQUFiLEdBQXVCLE1BQXZCO0FBQ0EsaUJBSHFCLENBR1g7QUFDYjs7QUFFRCxVQUFJVCxLQUFLLENBQUNRLFNBQVYsRUFBcUI7QUFDakIsWUFBSSxDQUFDVCxNQUFNLENBQUNlLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCLDBDQUExQixDQUFMLEVBQTRFO0FBQ3hFaEIsVUFBQUEsTUFBTSxDQUFDZSxTQUFQLENBQWlCRSxHQUFqQixDQUFxQiwwQ0FBckI7QUFDSDs7QUFFRCxjQUFNQyxNQUFNLEdBQUksR0FBRXBGLElBQUksQ0FBQ3FGLGFBQUwsQ0FBbUJkLFNBQVUsSUFBL0M7O0FBQ0EsWUFBSUwsTUFBTSxDQUFDQyxLQUFQLENBQWFtQixHQUFiLEtBQXFCRixNQUF6QixFQUFpQztBQUM3QmxCLFVBQUFBLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhbUIsR0FBYixHQUFtQkYsTUFBbkI7QUFDSDtBQUNKLE9BVEQsTUFTTztBQUNILFlBQUlsQixNQUFNLENBQUNlLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCLDBDQUExQixDQUFKLEVBQTJFO0FBQ3ZFaEIsVUFBQUEsTUFBTSxDQUFDZSxTQUFQLENBQWlCTSxNQUFqQixDQUF3QiwwQ0FBeEI7QUFDSDs7QUFDRCxZQUFJckIsTUFBTSxDQUFDQyxLQUFQLENBQWFtQixHQUFqQixFQUFzQjtBQUNsQnBCLFVBQUFBLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhQyxjQUFiLENBQTRCLEtBQTVCO0FBQ0g7QUFDSjs7QUFFRCxVQUFJRCxLQUFLLENBQUNXLFlBQVYsRUFBd0I7QUFDcEIsWUFBSSxDQUFDWixNQUFNLENBQUNlLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCLDZDQUExQixDQUFMLEVBQStFO0FBQzNFaEIsVUFBQUEsTUFBTSxDQUFDZSxTQUFQLENBQWlCRSxHQUFqQixDQUFxQiw2Q0FBckI7QUFDSDs7QUFFRCxjQUFNSyxNQUFNLEdBQUdwRCxpQkFBUXpDLFFBQVIsQ0FBaUI4RixZQUFqQixJQUNWekYsSUFBSSxDQUFDcUYsYUFBTCxDQUFtQmQsU0FBbkIsR0FBK0J2RSxJQUFJLENBQUNxRixhQUFMLENBQW1CM0IsWUFEeEMsQ0FBZjtBQUVBLGNBQU1nQyxTQUFTLEdBQUksR0FBRUYsTUFBTyxJQUE1Qjs7QUFDQSxZQUFJdEIsTUFBTSxDQUFDQyxLQUFQLENBQWF3QixNQUFiLEtBQXdCRCxTQUE1QixFQUF1QztBQUNuQ3hCLFVBQUFBLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhd0IsTUFBYixHQUFzQkQsU0FBdEI7QUFDSDtBQUNKLE9BWEQsTUFXTztBQUNILFlBQUl4QixNQUFNLENBQUNlLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCLDZDQUExQixDQUFKLEVBQThFO0FBQzFFaEIsVUFBQUEsTUFBTSxDQUFDZSxTQUFQLENBQWlCTSxNQUFqQixDQUF3Qiw2Q0FBeEI7QUFDSDs7QUFDRCxZQUFJckIsTUFBTSxDQUFDQyxLQUFQLENBQWF3QixNQUFqQixFQUF5QjtBQUNyQnpCLFVBQUFBLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhQyxjQUFiLENBQTRCLFFBQTVCO0FBQ0g7QUFDSjs7QUFFRCxVQUFJRCxLQUFLLENBQUNRLFNBQU4sSUFBbUJSLEtBQUssQ0FBQ1csWUFBN0IsRUFBMkM7QUFDdkMsWUFBSSxDQUFDWixNQUFNLENBQUNlLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCLHVDQUExQixDQUFMLEVBQXlFO0FBQ3JFaEIsVUFBQUEsTUFBTSxDQUFDZSxTQUFQLENBQWlCRSxHQUFqQixDQUFxQix1Q0FBckI7QUFDSDs7QUFFRCxjQUFNUyxjQUFjLEdBQUd4RCxpQkFBUXpDLFFBQVIsQ0FBaUJrRyxvQkFBakIsQ0FBc0MsZUFBdEMsQ0FBdkI7O0FBQ0EsWUFBSUQsY0FBSixFQUFvQjtBQUNoQixnQkFBTUUsaUJBQWlCLEdBQUcsRUFBMUIsQ0FEZ0IsQ0FDYzs7QUFDOUIsZ0JBQU1DLGlCQUFpQixHQUFHSCxjQUFjLENBQUNJLEtBQWYsR0FBdUJGLGlCQUFqRDtBQUNBLGdCQUFNRyxRQUFRLEdBQUksR0FBRUYsaUJBQWtCLElBQXRDOztBQUNBLGNBQUk3QixNQUFNLENBQUNDLEtBQVAsQ0FBYTZCLEtBQWIsS0FBdUJDLFFBQTNCLEVBQXFDO0FBQ2pDL0IsWUFBQUEsTUFBTSxDQUFDQyxLQUFQLENBQWE2QixLQUFiLEdBQXFCQyxRQUFyQjtBQUNIO0FBQ0o7QUFDSixPQWRELE1BY08sSUFBSSxDQUFDOUIsS0FBSyxDQUFDUSxTQUFQLElBQW9CLENBQUNSLEtBQUssQ0FBQ1csWUFBL0IsRUFBNkM7QUFDaEQsWUFBSVosTUFBTSxDQUFDZSxTQUFQLENBQWlCQyxRQUFqQixDQUEwQix1Q0FBMUIsQ0FBSixFQUF3RTtBQUNwRWhCLFVBQUFBLE1BQU0sQ0FBQ2UsU0FBUCxDQUFpQk0sTUFBakIsQ0FBd0IsdUNBQXhCO0FBQ0g7O0FBRUQsWUFBSXJCLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhNkIsS0FBakIsRUFBd0I7QUFDcEI5QixVQUFBQSxNQUFNLENBQUNDLEtBQVAsQ0FBYUMsY0FBYixDQUE0QixPQUE1QjtBQUNIO0FBQ0o7QUFDSixLQWhIeUMsQ0FrSDFDO0FBQ0E7OztBQUNBLFVBQU04QixXQUFXLEdBQUdsRyxJQUFJLENBQUNxRixhQUF6QixDQXBIMEMsQ0FvSEY7O0FBQ3hDLFFBQUl0QixhQUFKLEVBQW1CO0FBQ2ZtQyxNQUFBQSxXQUFXLENBQUNqQixTQUFaLENBQXNCRSxHQUF0QixDQUEwQix3Q0FBMUI7QUFDSCxLQUZELE1BRU87QUFDSGUsTUFBQUEsV0FBVyxDQUFDakIsU0FBWixDQUFzQk0sTUFBdEIsQ0FBNkIsd0NBQTdCO0FBQ0g7O0FBQ0QsUUFBSXZCLGlCQUFKLEVBQXVCO0FBQ25Ca0MsTUFBQUEsV0FBVyxDQUFDakIsU0FBWixDQUFzQkUsR0FBdEIsQ0FBMEIsMkNBQTFCO0FBQ0gsS0FGRCxNQUVPO0FBQ0hlLE1BQUFBLFdBQVcsQ0FBQ2pCLFNBQVosQ0FBc0JNLE1BQXRCLENBQTZCLDJDQUE3QjtBQUNIO0FBQ0o7O0FBNERPWSxFQUFBQSxZQUFZLEdBQW9CO0FBQ3BDLHdCQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSSxvQkFBQyxpQkFBRDtBQUFVLE1BQUEsV0FBVyxFQUFFLEtBQUtySCxLQUFMLENBQVdzSDtBQUFsQyxNQURKLENBREo7QUFLSDs7QUFFT0MsRUFBQUEsaUJBQWlCLEdBQW9CO0FBQ3pDLFFBQUksS0FBS3hHLEtBQUwsQ0FBV0MsZUFBWCxJQUE4QixDQUFDLEtBQUtoQixLQUFMLENBQVdzSCxXQUE5QyxFQUEyRDtBQUN2RCwwQkFDSSxvQkFBQywyQkFBRDtBQUNJLFFBQUEsU0FBUyxFQUFDLHdEQURkO0FBRUksUUFBQSwyQkFBMkIsRUFBRTtBQUZqQyxzQkFJSSxvQkFBQyx3QkFBRCxPQUpKLENBREo7QUFRSDtBQUNKOztBQUVPRSxFQUFBQSx1QkFBdUIsR0FBb0I7QUFDL0MsUUFBSUMsYUFBYSxHQUFHLElBQXBCLENBRCtDLENBRy9DO0FBQ0E7O0FBQ0EsUUFBSUMscUJBQVlDLGNBQVosR0FBNkJDLHVCQUE3QixFQUFKLEVBQTREO0FBQ3hESCxNQUFBQSxhQUFhLGdCQUNULG9CQUFDLGdDQUFEO0FBQ0ksUUFBQSxTQUFTLEVBQUUseUJBQVcsNEJBQVgsRUFBeUMsRUFBekMsQ0FEZjtBQUVJLFFBQUEsT0FBTyxFQUFFLEtBQUtJLFNBRmxCO0FBR0ksUUFBQSxLQUFLLEVBQUUseUJBQUcsZUFBSDtBQUhYLFFBREo7QUFNSDs7QUFFRCxVQUFNQyxLQUFLLEdBQUcsS0FBSy9HLEtBQUwsQ0FBV2QsV0FBWCxDQUF1QixDQUF2QixNQUE4QixHQUE5QixHQUFvQyxLQUFLOEgsT0FBTCxDQUFhQyxPQUFiLENBQXFCLEtBQUtqSCxLQUFMLENBQVdkLFdBQWhDLENBQXBDLEdBQW1GLElBQWpHO0FBQ0Esd0JBQ0k7QUFDSSxNQUFBLFNBQVMsRUFBQyw4QkFEZDtBQUVJLE1BQUEsT0FBTyxFQUFFLEtBQUtnSSxPQUZsQjtBQUdJLE1BQUEsTUFBTSxFQUFFLEtBQUtDLE1BSGpCO0FBSUksTUFBQSxTQUFTLEVBQUUsS0FBS0M7QUFKcEIsb0JBTUksb0JBQUMsbUJBQUQ7QUFDSSxNQUFBLFdBQVcsRUFBRSxLQUFLbkksS0FBTCxDQUFXc0gsV0FENUI7QUFFSSxNQUFBLEdBQUcsRUFBRSxLQUFLdEYsYUFGZDtBQUdJLE1BQUEsWUFBWSxFQUFFLEtBQUtvRztBQUh2QixNQU5KLEVBWU1YLGFBWk4sZUFjSSxvQkFBQyxnQ0FBRDtBQUNJLE1BQUEsU0FBUyxFQUFFLHlCQUFXLDRCQUFYLEVBQXlDO0FBQ2hEWSxRQUFBQSxnQ0FBZ0MsRUFBRSxDQUFDLENBQUMsS0FBS3RILEtBQUwsQ0FBV2Q7QUFEQyxPQUF6QyxDQURmO0FBSUksTUFBQSxPQUFPLEVBQUUsS0FBS3FJLFNBSmxCO0FBS0ksTUFBQSxLQUFLLEVBQUVSLEtBQUssR0FBRyx5QkFBRyx1QkFBSCxFQUE0QjtBQUFFUyxRQUFBQSxTQUFTLEVBQUVULEtBQUssQ0FBQ1U7QUFBbkIsT0FBNUIsQ0FBSCxHQUE0RCx5QkFBRyxlQUFIO0FBTDVFLE1BZEosQ0FESjtBQXdCSDs7QUFFTUMsRUFBQUEsTUFBTSxHQUFvQjtBQUM3QixVQUFNQyxRQUFRLGdCQUFHLG9CQUFDLGlCQUFEO0FBQ2IsTUFBQSxTQUFTLEVBQUUsS0FBS1AsU0FESDtBQUViLE1BQUEsY0FBYyxFQUFFLEtBQUtuSSxLQUFMLENBQVcySSxjQUZkO0FBR2IsTUFBQSxPQUFPLEVBQUUsS0FBS1YsT0FIRDtBQUliLE1BQUEsTUFBTSxFQUFFLEtBQUtDLE1BSkE7QUFLYixNQUFBLFdBQVcsRUFBRSxLQUFLbEksS0FBTCxDQUFXc0gsV0FMWDtBQU1iLE1BQUEsV0FBVyxFQUFFLEtBQUt2RyxLQUFMLENBQVdkLFdBTlg7QUFPYixNQUFBLFFBQVEsRUFBRSxLQUFLd0Qsb0JBUEY7QUFRYixNQUFBLGNBQWMsRUFBRSxLQUFLQSxvQkFSUjtBQVNiLE1BQUEsR0FBRyxFQUFFLEtBQUs5QjtBQVRHLE1BQWpCO0FBWUEsVUFBTWlILGdCQUFnQixHQUFHLHlCQUFXO0FBQ2hDLHNCQUFnQixJQURnQjtBQUVoQyxnQ0FBMEIsS0FBSzVJLEtBQUwsQ0FBV3NIO0FBRkwsS0FBWCxDQUF6QjtBQUtBLFVBQU11QixlQUFlLEdBQUcseUJBQ3BCLHNDQURvQixFQUVwQixzQkFGb0IsQ0FBeEI7QUFLQSx3QkFDSTtBQUFLLE1BQUEsU0FBUyxFQUFFRCxnQkFBaEI7QUFBa0MsTUFBQSxHQUFHLEVBQUUsS0FBS3BGO0FBQTVDLG9CQUNJO0FBQU8sTUFBQSxTQUFTLEVBQUM7QUFBakIsT0FDTSxLQUFLNkQsWUFBTCxFQUROLEVBRU0sS0FBS0csdUJBQUwsRUFGTixFQUdNLEtBQUtELGlCQUFMLEVBSE4sZUFJSSxvQkFBQywyQkFBRDtBQUFvQixNQUFBLGtCQUFrQixFQUFFLEtBQUs5RDtBQUE3QyxNQUpKLGVBS0k7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLG9CQUNJO0FBQ0ksTUFBQSxTQUFTLEVBQUVvRixlQURmO0FBRUksTUFBQSxHQUFHLEVBQUUsS0FBS3JJLGdCQUZkLENBR0k7QUFDQTtBQUpKO0FBS0ksTUFBQSxRQUFRLEVBQUUsQ0FBQyxDQUxmO0FBTUksTUFBQSxTQUFTLEVBQUUsS0FBS3NJO0FBTnBCLE9BUU1KLFFBUk4sQ0FESixDQUxKLEVBaUJNLENBQUMsS0FBSzFJLEtBQUwsQ0FBV3NILFdBQVosaUJBQTJCLG9CQUFDLHdCQUFELE9BakJqQyxDQURKLENBREo7QUF1Qkg7O0FBNVhrRSxDLHdEQVE5Q3lCLDRCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDIwIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBjcmVhdGVSZWYgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCI7XG5cbmltcG9ydCBkaXMgZnJvbSBcIi4uLy4uL2Rpc3BhdGNoZXIvZGlzcGF0Y2hlclwiO1xuaW1wb3J0IHsgX3QgfSBmcm9tIFwiLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyXCI7XG5pbXBvcnQgUm9vbUxpc3QgZnJvbSBcIi4uL3ZpZXdzL3Jvb21zL1Jvb21MaXN0XCI7XG5pbXBvcnQgQ2FsbEhhbmRsZXIgZnJvbSBcIi4uLy4uL0NhbGxIYW5kbGVyXCI7XG5pbXBvcnQgeyBIRUFERVJfSEVJR0hUIH0gZnJvbSBcIi4uL3ZpZXdzL3Jvb21zL1Jvb21TdWJsaXN0XCI7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vLi4vZGlzcGF0Y2hlci9hY3Rpb25zXCI7XG5pbXBvcnQgVXNlck1lbnUgZnJvbSBcIi4vVXNlck1lbnVcIjtcbmltcG9ydCBSb29tU2VhcmNoIGZyb20gXCIuL1Jvb21TZWFyY2hcIjtcbmltcG9ydCBSb29tQnJlYWRjcnVtYnMgZnJvbSBcIi4uL3ZpZXdzL3Jvb21zL1Jvb21CcmVhZGNydW1ic1wiO1xuaW1wb3J0IHsgQnJlYWRjcnVtYnNTdG9yZSB9IGZyb20gXCIuLi8uLi9zdG9yZXMvQnJlYWRjcnVtYnNTdG9yZVwiO1xuaW1wb3J0IHsgVVBEQVRFX0VWRU5UIH0gZnJvbSBcIi4uLy4uL3N0b3Jlcy9Bc3luY1N0b3JlXCI7XG5pbXBvcnQgUmVzaXplTm90aWZpZXIgZnJvbSBcIi4uLy4uL3V0aWxzL1Jlc2l6ZU5vdGlmaWVyXCI7XG5pbXBvcnQgUm9vbUxpc3RTdG9yZSwgeyBMSVNUU19VUERBVEVfRVZFTlQgfSBmcm9tIFwiLi4vLi4vc3RvcmVzL3Jvb20tbGlzdC9Sb29tTGlzdFN0b3JlXCI7XG5pbXBvcnQgSW5kaWNhdG9yU2Nyb2xsYmFyIGZyb20gXCIuLi9zdHJ1Y3R1cmVzL0luZGljYXRvclNjcm9sbGJhclwiO1xuaW1wb3J0IEFjY2Vzc2libGVUb29sdGlwQnV0dG9uIGZyb20gXCIuLi92aWV3cy9lbGVtZW50cy9BY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblwiO1xuaW1wb3J0IFJvb21MaXN0TnVtUmVzdWx0cyBmcm9tIFwiLi4vdmlld3Mvcm9vbXMvUm9vbUxpc3ROdW1SZXN1bHRzXCI7XG5pbXBvcnQgTGVmdFBhbmVsV2lkZ2V0IGZyb20gXCIuL0xlZnRQYW5lbFdpZGdldFwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCBTcGFjZVN0b3JlIGZyb20gXCIuLi8uLi9zdG9yZXMvc3BhY2VzL1NwYWNlU3RvcmVcIjtcbmltcG9ydCB7IFNwYWNlS2V5LCBVUERBVEVfU0VMRUNURURfU1BBQ0UgfSBmcm9tIFwiLi4vLi4vc3RvcmVzL3NwYWNlc1wiO1xuaW1wb3J0IHsgZ2V0S2V5QmluZGluZ3NNYW5hZ2VyLCBSb29tTGlzdEFjdGlvbiB9IGZyb20gXCIuLi8uLi9LZXlCaW5kaW5nc01hbmFnZXJcIjtcbmltcG9ydCBVSVN0b3JlIGZyb20gXCIuLi8uLi9zdG9yZXMvVUlTdG9yZVwiO1xuaW1wb3J0IHsgZmluZFNpYmxpbmdFbGVtZW50LCBJU3RhdGUgYXMgSVJvdmluZ1RhYkluZGV4U3RhdGUgfSBmcm9tIFwiLi4vLi4vYWNjZXNzaWJpbGl0eS9Sb3ZpbmdUYWJJbmRleFwiO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCB7IEtleSB9IGZyb20gXCIuLi8uLi9LZXlib2FyZFwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIHtcbiAgICBpc01pbmltaXplZDogYm9vbGVhbjtcbiAgICByZXNpemVOb3RpZmllcjogUmVzaXplTm90aWZpZXI7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHNob3dCcmVhZGNydW1iczogYm9vbGVhbjtcbiAgICBhY3RpdmVTcGFjZTogU3BhY2VLZXk7XG59XG5cbkByZXBsYWNlYWJsZUNvbXBvbmVudChcInN0cnVjdHVyZXMuTGVmdFBhbmVsXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWZ0UGFuZWwgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIHJlZiA9IGNyZWF0ZVJlZjxIVE1MRGl2RWxlbWVudD4oKTtcbiAgICBwcml2YXRlIGxpc3RDb250YWluZXJSZWYgPSBjcmVhdGVSZWY8SFRNTERpdkVsZW1lbnQ+KCk7XG4gICAgcHJpdmF0ZSByb29tU2VhcmNoUmVmID0gY3JlYXRlUmVmPFJvb21TZWFyY2g+KCk7XG4gICAgcHJpdmF0ZSByb29tTGlzdFJlZiA9IGNyZWF0ZVJlZjxSb29tTGlzdD4oKTtcbiAgICBwcml2YXRlIGZvY3VzZWRFbGVtZW50ID0gbnVsbDtcbiAgICBwcml2YXRlIGlzRG9pbmdTdGlja3lIZWFkZXJzID0gZmFsc2U7XG5cbiAgICBzdGF0aWMgY29udGV4dFR5cGUgPSBNYXRyaXhDbGllbnRDb250ZXh0O1xuICAgIHB1YmxpYyBjb250ZXh0ITogUmVhY3QuQ29udGV4dFR5cGU8dHlwZW9mIE1hdHJpeENsaWVudENvbnRleHQ+O1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHNob3dCcmVhZGNydW1iczogQnJlYWRjcnVtYnNTdG9yZS5pbnN0YW5jZS52aXNpYmxlLFxuICAgICAgICAgICAgYWN0aXZlU3BhY2U6IFNwYWNlU3RvcmUuaW5zdGFuY2UuYWN0aXZlU3BhY2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgQnJlYWRjcnVtYnNTdG9yZS5pbnN0YW5jZS5vbihVUERBVEVfRVZFTlQsIHRoaXMub25CcmVhZGNydW1ic1VwZGF0ZSk7XG4gICAgICAgIFJvb21MaXN0U3RvcmUuaW5zdGFuY2Uub24oTElTVFNfVVBEQVRFX0VWRU5ULCB0aGlzLm9uQnJlYWRjcnVtYnNVcGRhdGUpO1xuICAgICAgICBTcGFjZVN0b3JlLmluc3RhbmNlLm9uKFVQREFURV9TRUxFQ1RFRF9TUEFDRSwgdGhpcy51cGRhdGVBY3RpdmVTcGFjZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBVSVN0b3JlLmluc3RhbmNlLnRyYWNrRWxlbWVudERpbWVuc2lvbnMoXCJMZWZ0UGFuZWxcIiwgdGhpcy5yZWYuY3VycmVudCk7XG4gICAgICAgIFVJU3RvcmUuaW5zdGFuY2UudHJhY2tFbGVtZW50RGltZW5zaW9ucyhcIkxpc3RDb250YWluZXJcIiwgdGhpcy5saXN0Q29udGFpbmVyUmVmLmN1cnJlbnQpO1xuICAgICAgICBVSVN0b3JlLmluc3RhbmNlLm9uKFwiTGlzdENvbnRhaW5lclwiLCB0aGlzLnJlZnJlc2hTdGlja3lIZWFkZXJzKTtcbiAgICAgICAgLy8gVXNpbmcgdGhlIHBhc3NpdmUgb3B0aW9uIHRvIG5vdCBibG9jayB0aGUgbWFpbiB0aHJlYWRcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0V2ZW50VGFyZ2V0L2FkZEV2ZW50TGlzdGVuZXIjaW1wcm92aW5nX3Njcm9sbGluZ19wZXJmb3JtYW5jZV93aXRoX3Bhc3NpdmVfbGlzdGVuZXJzXG4gICAgICAgIHRoaXMubGlzdENvbnRhaW5lclJlZi5jdXJyZW50Py5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMub25TY3JvbGwsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIEJyZWFkY3J1bWJzU3RvcmUuaW5zdGFuY2Uub2ZmKFVQREFURV9FVkVOVCwgdGhpcy5vbkJyZWFkY3J1bWJzVXBkYXRlKTtcbiAgICAgICAgUm9vbUxpc3RTdG9yZS5pbnN0YW5jZS5vZmYoTElTVFNfVVBEQVRFX0VWRU5ULCB0aGlzLm9uQnJlYWRjcnVtYnNVcGRhdGUpO1xuICAgICAgICBTcGFjZVN0b3JlLmluc3RhbmNlLm9mZihVUERBVEVfU0VMRUNURURfU1BBQ0UsIHRoaXMudXBkYXRlQWN0aXZlU3BhY2UpO1xuICAgICAgICBVSVN0b3JlLmluc3RhbmNlLnN0b3BUcmFja2luZ0VsZW1lbnREaW1lbnNpb25zKFwiTGlzdENvbnRhaW5lclwiKTtcbiAgICAgICAgVUlTdG9yZS5pbnN0YW5jZS5yZW1vdmVMaXN0ZW5lcihcIkxpc3RDb250YWluZXJcIiwgdGhpcy5yZWZyZXNoU3RpY2t5SGVhZGVycyk7XG4gICAgICAgIHRoaXMubGlzdENvbnRhaW5lclJlZi5jdXJyZW50Py5yZW1vdmVFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMub25TY3JvbGwpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBJUHJvcHMsIHByZXZTdGF0ZTogSVN0YXRlKTogdm9pZCB7XG4gICAgICAgIGlmIChwcmV2U3RhdGUuYWN0aXZlU3BhY2UgIT09IHRoaXMuc3RhdGUuYWN0aXZlU3BhY2UpIHtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaFN0aWNreUhlYWRlcnMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlQWN0aXZlU3BhY2UgPSAoYWN0aXZlU3BhY2U6IFNwYWNlS2V5KSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBhY3RpdmVTcGFjZSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkRpYWxQYWQgPSAoKSA9PiB7XG4gICAgICAgIGRpcy5maXJlKEFjdGlvbi5PcGVuRGlhbFBhZCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25FeHBsb3JlID0gKCkgPT4ge1xuICAgICAgICBkaXMuZmlyZShBY3Rpb24uVmlld1Jvb21EaXJlY3RvcnkpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHJlZnJlc2hTdGlja3lIZWFkZXJzID0gKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMubGlzdENvbnRhaW5lclJlZi5jdXJyZW50KSByZXR1cm47IC8vIGlnbm9yZTogbm8gaGVhZGVycyB0byBzdGlja3lcbiAgICAgICAgdGhpcy5oYW5kbGVTdGlja3lIZWFkZXJzKHRoaXMubGlzdENvbnRhaW5lclJlZi5jdXJyZW50KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkJyZWFkY3J1bWJzVXBkYXRlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBuZXdWYWwgPSBCcmVhZGNydW1ic1N0b3JlLmluc3RhbmNlLnZpc2libGU7XG4gICAgICAgIGlmIChuZXdWYWwgIT09IHRoaXMuc3RhdGUuc2hvd0JyZWFkY3J1bWJzKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd0JyZWFkY3J1bWJzOiBuZXdWYWwgfSk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgc3RpY2t5IGhlYWRlcnMgdG9vIGFzIHRoZSBicmVhZGNydW1icyB3aWxsIGJlIHBvcHBpbmcgaW4gb3Igb3V0LlxuICAgICAgICAgICAgaWYgKCF0aGlzLmxpc3RDb250YWluZXJSZWYuY3VycmVudCkgcmV0dXJuOyAvLyBpZ25vcmU6IG5vIGhlYWRlcnMgdG8gc3RpY2t5XG4gICAgICAgICAgICB0aGlzLmhhbmRsZVN0aWNreUhlYWRlcnModGhpcy5saXN0Q29udGFpbmVyUmVmLmN1cnJlbnQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHByaXZhdGUgaGFuZGxlU3RpY2t5SGVhZGVycyhsaXN0OiBIVE1MRGl2RWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5pc0RvaW5nU3RpY2t5SGVhZGVycykgcmV0dXJuO1xuICAgICAgICB0aGlzLmlzRG9pbmdTdGlja3lIZWFkZXJzID0gdHJ1ZTtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRvU3RpY2t5SGVhZGVycyhsaXN0KTtcbiAgICAgICAgICAgIHRoaXMuaXNEb2luZ1N0aWNreUhlYWRlcnMgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkb1N0aWNreUhlYWRlcnMobGlzdDogSFRNTERpdkVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgdG9wRWRnZSA9IGxpc3Quc2Nyb2xsVG9wO1xuICAgICAgICBjb25zdCBib3R0b21FZGdlID0gbGlzdC5vZmZzZXRIZWlnaHQgKyBsaXN0LnNjcm9sbFRvcDtcbiAgICAgICAgY29uc3Qgc3VibGlzdHMgPSBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGw8SFRNTERpdkVsZW1lbnQ+KFwiLm14X1Jvb21TdWJsaXN0Om5vdCgubXhfUm9vbVN1Ymxpc3RfaGlkZGVuKVwiKTtcblxuICAgICAgICAvLyBXZSB0cmFjayB3aGljaCBzdHlsZXMgd2Ugd2FudCBvbiBhIHRhcmdldCBiZWZvcmUgbWFraW5nIHRoZSBjaGFuZ2VzIHRvIGF2b2lkXG4gICAgICAgIC8vIGV4Y2Vzc2l2ZSBsYXlvdXQgdXBkYXRlcy5cbiAgICAgICAgY29uc3QgdGFyZ2V0U3R5bGVzID0gbmV3IE1hcDxIVE1MRGl2RWxlbWVudCwge1xuICAgICAgICAgICAgc3RpY2t5VG9wPzogYm9vbGVhbjtcbiAgICAgICAgICAgIHN0aWNreUJvdHRvbT86IGJvb2xlYW47XG4gICAgICAgICAgICBtYWtlSW52aXNpYmxlPzogYm9vbGVhbjtcbiAgICAgICAgfT4oKTtcblxuICAgICAgICBsZXQgbGFzdFRvcEhlYWRlcjtcbiAgICAgICAgbGV0IGZpcnN0Qm90dG9tSGVhZGVyO1xuICAgICAgICBmb3IgKGNvbnN0IHN1Ymxpc3Qgb2Ygc3VibGlzdHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlciA9IHN1Ymxpc3QucXVlcnlTZWxlY3RvcjxIVE1MRGl2RWxlbWVudD4oXCIubXhfUm9vbVN1Ymxpc3Rfc3RpY2thYmxlXCIpO1xuICAgICAgICAgICAgaGVhZGVyLnN0eWxlLnJlbW92ZVByb3BlcnR5KFwiZGlzcGxheVwiKTsgLy8gYWx3YXlzIGNsZWFyIGRpc3BsYXk6bm9uZSBmaXJzdFxuXG4gICAgICAgICAgICAvLyBXaGVuIGFuIGVsZW1lbnQgaXMgPD00MCUgb2ZmIHNjcmVlbiwgbWFrZSBpdCB0YWtlIG92ZXJcbiAgICAgICAgICAgIGNvbnN0IG9mZlNjcmVlbkZhY3RvciA9IDAuNDtcbiAgICAgICAgICAgIGNvbnN0IGlzT2ZmVG9wID0gKHN1Ymxpc3Qub2Zmc2V0VG9wICsgKG9mZlNjcmVlbkZhY3RvciAqIEhFQURFUl9IRUlHSFQpKSA8PSB0b3BFZGdlO1xuICAgICAgICAgICAgY29uc3QgaXNPZmZCb3R0b20gPSAoc3VibGlzdC5vZmZzZXRUb3AgKyAob2ZmU2NyZWVuRmFjdG9yICogSEVBREVSX0hFSUdIVCkpID49IGJvdHRvbUVkZ2U7XG5cbiAgICAgICAgICAgIGlmIChpc09mZlRvcCB8fCBzdWJsaXN0ID09PSBzdWJsaXN0c1swXSkge1xuICAgICAgICAgICAgICAgIHRhcmdldFN0eWxlcy5zZXQoaGVhZGVyLCB7IHN0aWNreVRvcDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICBpZiAobGFzdFRvcEhlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICBsYXN0VG9wSGVhZGVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0U3R5bGVzLnNldChsYXN0VG9wSGVhZGVyLCB7IG1ha2VJbnZpc2libGU6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxhc3RUb3BIZWFkZXIgPSBoZWFkZXI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzT2ZmQm90dG9tICYmICFmaXJzdEJvdHRvbUhlYWRlcikge1xuICAgICAgICAgICAgICAgIHRhcmdldFN0eWxlcy5zZXQoaGVhZGVyLCB7IHN0aWNreUJvdHRvbTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICBmaXJzdEJvdHRvbUhlYWRlciA9IGhlYWRlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0U3R5bGVzLnNldChoZWFkZXIsIHt9KTsgLy8gbm90aGluZyA9PSBjbGVhclxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUnVuIG92ZXIgdGhlIHN0eWxlIGNoYW5nZXMgYW5kIG1ha2UgdGhlbSByZWFsaXR5LiBXZSBjaGVjayB0byBzZWUgaWYgd2UncmUgYWJvdXQgdG9cbiAgICAgICAgLy8gY2F1c2UgYSBuby1vcCB1cGRhdGUsIGFzIGFkZGluZy9yZW1vdmluZyBwcm9wZXJ0aWVzIHRoYXQgYXJlL2FyZW4ndCB0aGVyZSBjYXVzZVxuICAgICAgICAvLyBsYXlvdXQgdXBkYXRlcy5cbiAgICAgICAgZm9yIChjb25zdCBoZWFkZXIgb2YgdGFyZ2V0U3R5bGVzLmtleXMoKSkge1xuICAgICAgICAgICAgY29uc3Qgc3R5bGUgPSB0YXJnZXRTdHlsZXMuZ2V0KGhlYWRlcik7XG5cbiAgICAgICAgICAgIGlmIChzdHlsZS5tYWtlSW52aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgLy8gd2Ugd2lsbCBoYXZlIGFscmVhZHkgcmVtb3ZlZCB0aGUgJ2Rpc3BsYXk6IG5vbmUnLCBzbyBhZGQgaXQgYmFjay5cbiAgICAgICAgICAgICAgICBoZWFkZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBub3RoaW5nIGVsc2UgdG8gZG8sIGV2ZW4gaWYgc3RpY2t5IHNvbWVob3dcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHN0eWxlLnN0aWNreVRvcCkge1xuICAgICAgICAgICAgICAgIGlmICghaGVhZGVyLmNsYXNzTGlzdC5jb250YWlucyhcIm14X1Jvb21TdWJsaXN0X2hlYWRlckNvbnRhaW5lcl9zdGlja3lUb3BcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLmNsYXNzTGlzdC5hZGQoXCJteF9Sb29tU3VibGlzdF9oZWFkZXJDb250YWluZXJfc3RpY2t5VG9wXCIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RvcCA9IGAke2xpc3QucGFyZW50RWxlbWVudC5vZmZzZXRUb3B9cHhgO1xuICAgICAgICAgICAgICAgIGlmIChoZWFkZXIuc3R5bGUudG9wICE9PSBuZXdUb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnN0eWxlLnRvcCA9IG5ld1RvcDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChoZWFkZXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwibXhfUm9vbVN1Ymxpc3RfaGVhZGVyQ29udGFpbmVyX3N0aWNreVRvcFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LnJlbW92ZShcIm14X1Jvb21TdWJsaXN0X2hlYWRlckNvbnRhaW5lcl9zdGlja3lUb3BcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChoZWFkZXIuc3R5bGUudG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlci5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgndG9wJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc3R5bGUuc3RpY2t5Qm90dG9tKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFoZWFkZXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwibXhfUm9vbVN1Ymxpc3RfaGVhZGVyQ29udGFpbmVyX3N0aWNreUJvdHRvbVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LmFkZChcIm14X1Jvb21TdWJsaXN0X2hlYWRlckNvbnRhaW5lcl9zdGlja3lCb3R0b21cIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gVUlTdG9yZS5pbnN0YW5jZS53aW5kb3dIZWlnaHQgLVxuICAgICAgICAgICAgICAgICAgICAobGlzdC5wYXJlbnRFbGVtZW50Lm9mZnNldFRvcCArIGxpc3QucGFyZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0JvdHRvbSA9IGAke29mZnNldH1weGA7XG4gICAgICAgICAgICAgICAgaWYgKGhlYWRlci5zdHlsZS5ib3R0b20gIT09IG5ld0JvdHRvbSkge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXIuc3R5bGUuYm90dG9tID0gbmV3Qm90dG9tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGhlYWRlci5jbGFzc0xpc3QuY29udGFpbnMoXCJteF9Sb29tU3VibGlzdF9oZWFkZXJDb250YWluZXJfc3RpY2t5Qm90dG9tXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlci5jbGFzc0xpc3QucmVtb3ZlKFwibXhfUm9vbVN1Ymxpc3RfaGVhZGVyQ29udGFpbmVyX3N0aWNreUJvdHRvbVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGhlYWRlci5zdHlsZS5ib3R0b20pIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdib3R0b20nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzdHlsZS5zdGlja3lUb3AgfHwgc3R5bGUuc3RpY2t5Qm90dG9tKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFoZWFkZXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwibXhfUm9vbVN1Ymxpc3RfaGVhZGVyQ29udGFpbmVyX3N0aWNreVwiKSkge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LmFkZChcIm14X1Jvb21TdWJsaXN0X2hlYWRlckNvbnRhaW5lcl9zdGlja3lcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdERpbWVuc2lvbnMgPSBVSVN0b3JlLmluc3RhbmNlLmdldEVsZW1lbnREaW1lbnNpb25zKFwiTGlzdENvbnRhaW5lclwiKTtcbiAgICAgICAgICAgICAgICBpZiAobGlzdERpbWVuc2lvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyUmlnaHRNYXJnaW4gPSAxNTsgLy8gY2FsY3VsYXRlZCBmcm9tIG1hcmdpbnMgYW5kIHdpZHRocyB0byBhbGlnbiB3aXRoIG5vbi1zdGlja3kgdGlsZXNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyU3RpY2t5V2lkdGggPSBsaXN0RGltZW5zaW9ucy53aWR0aCAtIGhlYWRlclJpZ2h0TWFyZ2luO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdXaWR0aCA9IGAke2hlYWRlclN0aWNreVdpZHRofXB4YDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhlYWRlci5zdHlsZS53aWR0aCAhPT0gbmV3V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlci5zdHlsZS53aWR0aCA9IG5ld1dpZHRoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICghc3R5bGUuc3RpY2t5VG9wICYmICFzdHlsZS5zdGlja3lCb3R0b20pIHtcbiAgICAgICAgICAgICAgICBpZiAoaGVhZGVyLmNsYXNzTGlzdC5jb250YWlucyhcIm14X1Jvb21TdWJsaXN0X2hlYWRlckNvbnRhaW5lcl9zdGlja3lcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLmNsYXNzTGlzdC5yZW1vdmUoXCJteF9Sb29tU3VibGlzdF9oZWFkZXJDb250YWluZXJfc3RpY2t5XCIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChoZWFkZXIuc3R5bGUud2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnN0eWxlLnJlbW92ZVByb3BlcnR5KCd3aWR0aCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCBhcHByb3ByaWF0ZSBzdGlja3kgY2xhc3NlcyB0byB3cmFwcGVyIHNvIGl0IGhhc1xuICAgICAgICAvLyB0aGUgbmVjZXNzYXJ5IHRvcC9ib3R0b20gcGFkZGluZyB0byBwdXQgdGhlIHN0aWNreSBoZWFkZXIgaW5cbiAgICAgICAgY29uc3QgbGlzdFdyYXBwZXIgPSBsaXN0LnBhcmVudEVsZW1lbnQ7IC8vIC5teF9MZWZ0UGFuZWxfcm9vbUxpc3RXcmFwcGVyXG4gICAgICAgIGlmIChsYXN0VG9wSGVhZGVyKSB7XG4gICAgICAgICAgICBsaXN0V3JhcHBlci5jbGFzc0xpc3QuYWRkKFwibXhfTGVmdFBhbmVsX3Jvb21MaXN0V3JhcHBlcl9zdGlja3lUb3BcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsaXN0V3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKFwibXhfTGVmdFBhbmVsX3Jvb21MaXN0V3JhcHBlcl9zdGlja3lUb3BcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpcnN0Qm90dG9tSGVhZGVyKSB7XG4gICAgICAgICAgICBsaXN0V3JhcHBlci5jbGFzc0xpc3QuYWRkKFwibXhfTGVmdFBhbmVsX3Jvb21MaXN0V3JhcHBlcl9zdGlja3lCb3R0b21cIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsaXN0V3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKFwibXhfTGVmdFBhbmVsX3Jvb21MaXN0V3JhcHBlcl9zdGlja3lCb3R0b21cIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG9uU2Nyb2xsID0gKGV2OiBFdmVudCkgPT4ge1xuICAgICAgICBjb25zdCBsaXN0ID0gZXYudGFyZ2V0IGFzIEhUTUxEaXZFbGVtZW50O1xuICAgICAgICB0aGlzLmhhbmRsZVN0aWNreUhlYWRlcnMobGlzdCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Gb2N1cyA9IChldjogUmVhY3QuRm9jdXNFdmVudCkgPT4ge1xuICAgICAgICB0aGlzLmZvY3VzZWRFbGVtZW50ID0gZXYudGFyZ2V0O1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQmx1ciA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5mb2N1c2VkRWxlbWVudCA9IG51bGw7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25LZXlEb3duID0gKGV2OiBSZWFjdC5LZXlib2FyZEV2ZW50LCBzdGF0ZT86IElSb3ZpbmdUYWJJbmRleFN0YXRlKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5mb2N1c2VkRWxlbWVudCkgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IGdldEtleUJpbmRpbmdzTWFuYWdlcigpLmdldFJvb21MaXN0QWN0aW9uKGV2KTtcbiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgUm9vbUxpc3RBY3Rpb24uTmV4dFJvb206XG4gICAgICAgICAgICAgICAgaWYgKCFzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tTGlzdFJlZi5jdXJyZW50Py5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBSb29tTGlzdEFjdGlvbi5QcmV2Um9vbTpcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgJiYgc3RhdGUuYWN0aXZlUmVmID09PSBmaW5kU2libGluZ0VsZW1lbnQoc3RhdGUucmVmcywgMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm9vbVNlYXJjaFJlZi5jdXJyZW50Py5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUm9vbUxpc3RLZXlkb3duID0gKGV2OiBSZWFjdC5LZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChldi5hbHRLZXkgfHwgZXYuY3RybEtleSB8fCBldi5tZXRhS2V5KSByZXR1cm47XG4gICAgICAgIC8vIHdlIGNhbm5vdCBoYW5kbGUgU3BhY2UgYXMgdGhhdCBpcyBhbiBhY3RpdmF0aW9uIGtleSBmb3IgYWxsIGZvY3VzYWJsZSBlbGVtZW50cyBpbiB0aGlzIHdpZGdldFxuICAgICAgICBpZiAoZXYua2V5Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5yb29tU2VhcmNoUmVmLmN1cnJlbnQ/LmFwcGVuZENoYXIoZXYua2V5KTtcbiAgICAgICAgfSBlbHNlIGlmIChldi5rZXkgPT09IEtleS5CQUNLU1BBQ0UpIHtcbiAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHRoaXMucm9vbVNlYXJjaFJlZi5jdXJyZW50Py5iYWNrc3BhY2UoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIHNlbGVjdFJvb20gPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpcnN0Um9vbSA9IHRoaXMubGlzdENvbnRhaW5lclJlZi5jdXJyZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTERpdkVsZW1lbnQ+KFwiLm14X1Jvb21UaWxlXCIpO1xuICAgICAgICBpZiAoZmlyc3RSb29tKSB7XG4gICAgICAgICAgICBmaXJzdFJvb20uY2xpY2soKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyB0byBnZXQgdGhlIGZpZWxkIHRvIGNsZWFyXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZW5kZXJIZWFkZXIoKTogUmVhY3QuUmVhY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTGVmdFBhbmVsX3VzZXJIZWFkZXJcIj5cbiAgICAgICAgICAgICAgICA8VXNlck1lbnUgaXNNaW5pbWl6ZWQ9e3RoaXMucHJvcHMuaXNNaW5pbWl6ZWR9IC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlckJyZWFkY3J1bWJzKCk6IFJlYWN0LlJlYWN0Tm9kZSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnNob3dCcmVhZGNydW1icyAmJiAhdGhpcy5wcm9wcy5pc01pbmltaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8SW5kaWNhdG9yU2Nyb2xsYmFyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0xlZnRQYW5lbF9icmVhZGNydW1ic0NvbnRhaW5lciBteF9BdXRvSGlkZVNjcm9sbGJhclwiXG4gICAgICAgICAgICAgICAgICAgIHZlcnRpY2FsU2Nyb2xsc0hvcml6b250YWxseT17dHJ1ZX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxSb29tQnJlYWRjcnVtYnMgLz5cbiAgICAgICAgICAgICAgICA8L0luZGljYXRvclNjcm9sbGJhcj5cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclNlYXJjaERpYWxFeHBsb3JlKCk6IFJlYWN0LlJlYWN0Tm9kZSB7XG4gICAgICAgIGxldCBkaWFsUGFkQnV0dG9uID0gbnVsbDtcblxuICAgICAgICAvLyBJZiB3ZSBoYXZlIGRpYWxlciBzdXBwb3J0LCBzaG93IGEgYnV0dG9uIHRvIGJyaW5nIHVwIHRoZSBkaWFsIHBhZFxuICAgICAgICAvLyB0byBzdGFydCBhIG5ldyBjYWxsXG4gICAgICAgIGlmIChDYWxsSGFuZGxlci5zaGFyZWRJbnN0YW5jZSgpLmdldFN1cHBvcnRzUHN0blByb3RvY29sKCkpIHtcbiAgICAgICAgICAgIGRpYWxQYWRCdXR0b24gPVxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlVG9vbHRpcEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJteF9MZWZ0UGFuZWxfZGlhbFBhZEJ1dHRvblwiLCB7fSl9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25EaWFsUGFkfVxuICAgICAgICAgICAgICAgICAgICB0aXRsZT17X3QoXCJPcGVuIGRpYWwgcGFkXCIpfVxuICAgICAgICAgICAgICAgIC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3BhY2UgPSB0aGlzLnN0YXRlLmFjdGl2ZVNwYWNlWzBdID09PSBcIiFcIiA/IHRoaXMuY29udGV4dC5nZXRSb29tKHRoaXMuc3RhdGUuYWN0aXZlU3BhY2UpIDogbnVsbDtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9MZWZ0UGFuZWxfZmlsdGVyQ29udGFpbmVyXCJcbiAgICAgICAgICAgICAgICBvbkZvY3VzPXt0aGlzLm9uRm9jdXN9XG4gICAgICAgICAgICAgICAgb25CbHVyPXt0aGlzLm9uQmx1cn1cbiAgICAgICAgICAgICAgICBvbktleURvd249e3RoaXMub25LZXlEb3dufVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxSb29tU2VhcmNoXG4gICAgICAgICAgICAgICAgICAgIGlzTWluaW1pemVkPXt0aGlzLnByb3BzLmlzTWluaW1pemVkfVxuICAgICAgICAgICAgICAgICAgICByZWY9e3RoaXMucm9vbVNlYXJjaFJlZn1cbiAgICAgICAgICAgICAgICAgICAgb25TZWxlY3RSb29tPXt0aGlzLnNlbGVjdFJvb219XG4gICAgICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgICAgIHsgZGlhbFBhZEJ1dHRvbiB9XG5cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZVRvb2x0aXBCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwibXhfTGVmdFBhbmVsX2V4cGxvcmVCdXR0b25cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXhfTGVmdFBhbmVsX2V4cGxvcmVCdXR0b25fc3BhY2U6ICEhdGhpcy5zdGF0ZS5hY3RpdmVTcGFjZSxcbiAgICAgICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25FeHBsb3JlfVxuICAgICAgICAgICAgICAgICAgICB0aXRsZT17c3BhY2UgPyBfdChcIkV4cGxvcmUgJShzcGFjZU5hbWUpc1wiLCB7IHNwYWNlTmFtZTogc3BhY2UubmFtZSB9KSA6IF90KFwiRXhwbG9yZSByb29tc1wiKX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlcigpOiBSZWFjdC5SZWFjdE5vZGUge1xuICAgICAgICBjb25zdCByb29tTGlzdCA9IDxSb29tTGlzdFxuICAgICAgICAgICAgb25LZXlEb3duPXt0aGlzLm9uS2V5RG93bn1cbiAgICAgICAgICAgIHJlc2l6ZU5vdGlmaWVyPXt0aGlzLnByb3BzLnJlc2l6ZU5vdGlmaWVyfVxuICAgICAgICAgICAgb25Gb2N1cz17dGhpcy5vbkZvY3VzfVxuICAgICAgICAgICAgb25CbHVyPXt0aGlzLm9uQmx1cn1cbiAgICAgICAgICAgIGlzTWluaW1pemVkPXt0aGlzLnByb3BzLmlzTWluaW1pemVkfVxuICAgICAgICAgICAgYWN0aXZlU3BhY2U9e3RoaXMuc3RhdGUuYWN0aXZlU3BhY2V9XG4gICAgICAgICAgICBvblJlc2l6ZT17dGhpcy5yZWZyZXNoU3RpY2t5SGVhZGVyc31cbiAgICAgICAgICAgIG9uTGlzdENvbGxhcHNlPXt0aGlzLnJlZnJlc2hTdGlja3lIZWFkZXJzfVxuICAgICAgICAgICAgcmVmPXt0aGlzLnJvb21MaXN0UmVmfVxuICAgICAgICAvPjtcblxuICAgICAgICBjb25zdCBjb250YWluZXJDbGFzc2VzID0gY2xhc3NOYW1lcyh7XG4gICAgICAgICAgICBcIm14X0xlZnRQYW5lbFwiOiB0cnVlLFxuICAgICAgICAgICAgXCJteF9MZWZ0UGFuZWxfbWluaW1pemVkXCI6IHRoaXMucHJvcHMuaXNNaW5pbWl6ZWQsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJvb21MaXN0Q2xhc3NlcyA9IGNsYXNzTmFtZXMoXG4gICAgICAgICAgICBcIm14X0xlZnRQYW5lbF9hY3R1YWxSb29tTGlzdENvbnRhaW5lclwiLFxuICAgICAgICAgICAgXCJteF9BdXRvSGlkZVNjcm9sbGJhclwiLFxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Y29udGFpbmVyQ2xhc3Nlc30gcmVmPXt0aGlzLnJlZn0+XG4gICAgICAgICAgICAgICAgPGFzaWRlIGNsYXNzTmFtZT1cIm14X0xlZnRQYW5lbF9yb29tTGlzdENvbnRhaW5lclwiPlxuICAgICAgICAgICAgICAgICAgICB7IHRoaXMucmVuZGVySGVhZGVyKCkgfVxuICAgICAgICAgICAgICAgICAgICB7IHRoaXMucmVuZGVyU2VhcmNoRGlhbEV4cGxvcmUoKSB9XG4gICAgICAgICAgICAgICAgICAgIHsgdGhpcy5yZW5kZXJCcmVhZGNydW1icygpIH1cbiAgICAgICAgICAgICAgICAgICAgPFJvb21MaXN0TnVtUmVzdWx0cyBvblZpc2liaWxpdHlDaGFuZ2U9e3RoaXMucmVmcmVzaFN0aWNreUhlYWRlcnN9IC8+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTGVmdFBhbmVsX3Jvb21MaXN0V3JhcHBlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17cm9vbUxpc3RDbGFzc2VzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZj17dGhpcy5saXN0Q29udGFpbmVyUmVmfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcmVmb3ggc29tZXRpbWVzIG1ha2VzIHRoaXMgZWxlbWVudCBmb2N1c2FibGUgZHVlIHRvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3ZlcmZsb3c6c2Nyb2xsOywgc28gZm9yY2UgaXQgb3V0IG9mIHRhYiBvcmRlci5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJJbmRleD17LTF9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25LZXlEb3duPXt0aGlzLm9uUm9vbUxpc3RLZXlkb3dufVxuICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgcm9vbUxpc3QgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICB7ICF0aGlzLnByb3BzLmlzTWluaW1pemVkICYmIDxMZWZ0UGFuZWxXaWRnZXQgLz4gfVxuICAgICAgICAgICAgICAgIDwvYXNpZGU+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=