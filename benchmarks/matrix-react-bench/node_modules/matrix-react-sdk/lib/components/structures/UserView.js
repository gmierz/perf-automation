"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _MatrixClientPeg = require("../../MatrixClientPeg");

var _Modal = _interopRequireDefault(require("../../Modal"));

var _languageHandler = require("../../languageHandler");

var _HomePage = _interopRequireDefault(require("./HomePage"));

var _replaceableComponent = require("../../utils/replaceableComponent");

var _event = require("matrix-js-sdk/src/models/event");

var _roomMember = require("matrix-js-sdk/src/models/room-member");

var _ErrorDialog = _interopRequireDefault(require("../views/dialogs/ErrorDialog"));

var _MainSplit = _interopRequireDefault(require("./MainSplit"));

var _RightPanel = _interopRequireDefault(require("./RightPanel"));

var _Spinner = _interopRequireDefault(require("../views/elements/Spinner"));

var _dec, _class;

let UserView = (_dec = (0, _replaceableComponent.replaceableComponent)("structures.UserView"), _dec(_class = class UserView extends _react.default.Component {
  constructor(props) {
    super(props);
    this.state = {
      loading: true
    };
  }

  componentDidMount() {
    if (this.props.userId) {
      this.loadProfileInfo();
    }
  }

  componentDidUpdate(prevProps) {
    // XXX: We shouldn't need to null check the userId here, but we declare
    // it as optional and MatrixChat sometimes fires in a way which results
    // in an NPE when we try to update the profile info.
    if (prevProps.userId !== this.props.userId && this.props.userId) {
      this.loadProfileInfo();
    }
  }

  async loadProfileInfo() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    this.setState({
      loading: true
    });
    let profileInfo;

    try {
      profileInfo = await cli.getProfileInfo(this.props.userId);
    } catch (err) {
      _Modal.default.createTrackedDialog((0, _languageHandler._t)('Could not load user profile'), '', _ErrorDialog.default, {
        title: (0, _languageHandler._t)('Could not load user profile'),
        description: err && err.message ? err.message : (0, _languageHandler._t)("Operation failed")
      });

      this.setState({
        loading: false
      });
      return;
    }

    const fakeEvent = new _event.MatrixEvent({
      type: "m.room.member",
      content: profileInfo
    });
    const member = new _roomMember.RoomMember(null, this.props.userId);
    member.setMembershipEvent(fakeEvent);
    this.setState({
      member,
      loading: false
    });
  }

  render() {
    if (this.state.loading) {
      return /*#__PURE__*/_react.default.createElement(_Spinner.default, null);
    } else if (this.state.member) {
      const panel = /*#__PURE__*/_react.default.createElement(_RightPanel.default, {
        member: this.state.member,
        resizeNotifier: this.props.resizeNotifier
      });

      return /*#__PURE__*/_react.default.createElement(_MainSplit.default, {
        panel: panel,
        resizeNotifier: this.props.resizeNotifier
      }, /*#__PURE__*/_react.default.createElement(_HomePage.default, null));
    } else {
      return /*#__PURE__*/_react.default.createElement("div", null);
    }
  }

}) || _class);
exports.default = UserView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvVXNlclZpZXcudHN4Il0sIm5hbWVzIjpbIlVzZXJWaWV3IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwic3RhdGUiLCJsb2FkaW5nIiwiY29tcG9uZW50RGlkTW91bnQiLCJ1c2VySWQiLCJsb2FkUHJvZmlsZUluZm8iLCJjb21wb25lbnREaWRVcGRhdGUiLCJwcmV2UHJvcHMiLCJjbGkiLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJzZXRTdGF0ZSIsInByb2ZpbGVJbmZvIiwiZ2V0UHJvZmlsZUluZm8iLCJlcnIiLCJNb2RhbCIsImNyZWF0ZVRyYWNrZWREaWFsb2ciLCJFcnJvckRpYWxvZyIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJtZXNzYWdlIiwiZmFrZUV2ZW50IiwiTWF0cml4RXZlbnQiLCJ0eXBlIiwiY29udGVudCIsIm1lbWJlciIsIlJvb21NZW1iZXIiLCJzZXRNZW1iZXJzaGlwRXZlbnQiLCJyZW5kZXIiLCJwYW5lbCIsInJlc2l6ZU5vdGlmaWVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFpQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7SUFjcUJBLFEsV0FEcEIsZ0RBQXFCLHFCQUFyQixDLGdCQUFELE1BQ3FCQSxRQURyQixTQUNzQ0MsZUFBTUMsU0FENUMsQ0FDc0U7QUFDbEVDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFnQjtBQUN2QixVQUFNQSxLQUFOO0FBQ0EsU0FBS0MsS0FBTCxHQUFhO0FBQ1RDLE1BQUFBLE9BQU8sRUFBRTtBQURBLEtBQWI7QUFHSDs7QUFFTUMsRUFBQUEsaUJBQWlCLEdBQVM7QUFDN0IsUUFBSSxLQUFLSCxLQUFMLENBQVdJLE1BQWYsRUFBdUI7QUFDbkIsV0FBS0MsZUFBTDtBQUNIO0FBQ0o7O0FBRU1DLEVBQUFBLGtCQUFrQixDQUFDQyxTQUFELEVBQTBCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBLFFBQUlBLFNBQVMsQ0FBQ0gsTUFBVixLQUFxQixLQUFLSixLQUFMLENBQVdJLE1BQWhDLElBQTBDLEtBQUtKLEtBQUwsQ0FBV0ksTUFBekQsRUFBaUU7QUFDN0QsV0FBS0MsZUFBTDtBQUNIO0FBQ0o7O0FBRTRCLFFBQWZBLGVBQWUsR0FBa0I7QUFDM0MsVUFBTUcsR0FBRyxHQUFHQyxpQ0FBZ0JDLEdBQWhCLEVBQVo7O0FBQ0EsU0FBS0MsUUFBTCxDQUFjO0FBQUVULE1BQUFBLE9BQU8sRUFBRTtBQUFYLEtBQWQ7QUFDQSxRQUFJVSxXQUFKOztBQUNBLFFBQUk7QUFDQUEsTUFBQUEsV0FBVyxHQUFHLE1BQU1KLEdBQUcsQ0FBQ0ssY0FBSixDQUFtQixLQUFLYixLQUFMLENBQVdJLE1BQTlCLENBQXBCO0FBQ0gsS0FGRCxDQUVFLE9BQU9VLEdBQVAsRUFBWTtBQUNWQyxxQkFBTUMsbUJBQU4sQ0FBMEIseUJBQUcsNkJBQUgsQ0FBMUIsRUFBNkQsRUFBN0QsRUFBaUVDLG9CQUFqRSxFQUE4RTtBQUMxRUMsUUFBQUEsS0FBSyxFQUFFLHlCQUFHLDZCQUFILENBRG1FO0FBRTFFQyxRQUFBQSxXQUFXLEVBQUlMLEdBQUcsSUFBSUEsR0FBRyxDQUFDTSxPQUFaLEdBQXVCTixHQUFHLENBQUNNLE9BQTNCLEdBQXFDLHlCQUFHLGtCQUFIO0FBRnVCLE9BQTlFOztBQUlBLFdBQUtULFFBQUwsQ0FBYztBQUFFVCxRQUFBQSxPQUFPLEVBQUU7QUFBWCxPQUFkO0FBQ0E7QUFDSDs7QUFDRCxVQUFNbUIsU0FBUyxHQUFHLElBQUlDLGtCQUFKLENBQWdCO0FBQUVDLE1BQUFBLElBQUksRUFBRSxlQUFSO0FBQXlCQyxNQUFBQSxPQUFPLEVBQUVaO0FBQWxDLEtBQWhCLENBQWxCO0FBQ0EsVUFBTWEsTUFBTSxHQUFHLElBQUlDLHNCQUFKLENBQWUsSUFBZixFQUFxQixLQUFLMUIsS0FBTCxDQUFXSSxNQUFoQyxDQUFmO0FBQ0FxQixJQUFBQSxNQUFNLENBQUNFLGtCQUFQLENBQTBCTixTQUExQjtBQUNBLFNBQUtWLFFBQUwsQ0FBYztBQUFFYyxNQUFBQSxNQUFGO0FBQVV2QixNQUFBQSxPQUFPLEVBQUU7QUFBbkIsS0FBZDtBQUNIOztBQUVNMEIsRUFBQUEsTUFBTSxHQUFnQjtBQUN6QixRQUFJLEtBQUszQixLQUFMLENBQVdDLE9BQWYsRUFBd0I7QUFDcEIsMEJBQU8sNkJBQUMsZ0JBQUQsT0FBUDtBQUNILEtBRkQsTUFFTyxJQUFJLEtBQUtELEtBQUwsQ0FBV3dCLE1BQWYsRUFBdUI7QUFDMUIsWUFBTUksS0FBSyxnQkFBRyw2QkFBQyxtQkFBRDtBQUFZLFFBQUEsTUFBTSxFQUFFLEtBQUs1QixLQUFMLENBQVd3QixNQUEvQjtBQUF1QyxRQUFBLGNBQWMsRUFBRSxLQUFLekIsS0FBTCxDQUFXOEI7QUFBbEUsUUFBZDs7QUFDQSwwQkFBUSw2QkFBQyxrQkFBRDtBQUFXLFFBQUEsS0FBSyxFQUFFRCxLQUFsQjtBQUF5QixRQUFBLGNBQWMsRUFBRSxLQUFLN0IsS0FBTCxDQUFXOEI7QUFBcEQsc0JBQ0osNkJBQUMsaUJBQUQsT0FESSxDQUFSO0FBR0gsS0FMTSxNQUtBO0FBQ0gsMEJBQVEseUNBQVI7QUFDSDtBQUNKOztBQXREaUUsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOSBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTkgTWljaGFlbCBUZWxhdHluc2tpIDw3dDNjaGd1eUBnbWFpbC5jb20+XG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgTWF0cml4Q2xpZW50UGVnIH0gZnJvbSBcIi4uLy4uL01hdHJpeENsaWVudFBlZ1wiO1xuaW1wb3J0IE1vZGFsIGZyb20gJy4uLy4uL01vZGFsJztcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBIb21lUGFnZSBmcm9tIFwiLi9Ib21lUGFnZVwiO1xuaW1wb3J0IHsgcmVwbGFjZWFibGVDb21wb25lbnQgfSBmcm9tIFwiLi4vLi4vdXRpbHMvcmVwbGFjZWFibGVDb21wb25lbnRcIjtcbmltcG9ydCB7IE1hdHJpeEV2ZW50IH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9ldmVudFwiO1xuaW1wb3J0IHsgUm9vbU1lbWJlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9tb2RlbHMvcm9vbS1tZW1iZXJcIjtcbmltcG9ydCBFcnJvckRpYWxvZyBmcm9tIFwiLi4vdmlld3MvZGlhbG9ncy9FcnJvckRpYWxvZ1wiO1xuaW1wb3J0IE1haW5TcGxpdCBmcm9tIFwiLi9NYWluU3BsaXRcIjtcbmltcG9ydCBSaWdodFBhbmVsIGZyb20gXCIuL1JpZ2h0UGFuZWxcIjtcbmltcG9ydCBTcGlubmVyIGZyb20gXCIuLi92aWV3cy9lbGVtZW50cy9TcGlubmVyXCI7XG5pbXBvcnQgUmVzaXplTm90aWZpZXIgZnJvbSBcIi4uLy4uL3V0aWxzL1Jlc2l6ZU5vdGlmaWVyXCI7XG5cbmludGVyZmFjZSBJUHJvcHMge1xuICAgIHVzZXJJZD86IHN0cmluZztcbiAgICByZXNpemVOb3RpZmllcjogUmVzaXplTm90aWZpZXI7XG59XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIGxvYWRpbmc6IGJvb2xlYW47XG4gICAgbWVtYmVyPzogUm9vbU1lbWJlcjtcbn1cblxuQHJlcGxhY2VhYmxlQ29tcG9uZW50KFwic3RydWN0dXJlcy5Vc2VyVmlld1wiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlclZpZXcgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGxvYWRpbmc6IHRydWUsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy51c2VySWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFByb2ZpbGVJbmZvKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wczogSVByb3BzKTogdm9pZCB7XG4gICAgICAgIC8vIFhYWDogV2Ugc2hvdWxkbid0IG5lZWQgdG8gbnVsbCBjaGVjayB0aGUgdXNlcklkIGhlcmUsIGJ1dCB3ZSBkZWNsYXJlXG4gICAgICAgIC8vIGl0IGFzIG9wdGlvbmFsIGFuZCBNYXRyaXhDaGF0IHNvbWV0aW1lcyBmaXJlcyBpbiBhIHdheSB3aGljaCByZXN1bHRzXG4gICAgICAgIC8vIGluIGFuIE5QRSB3aGVuIHdlIHRyeSB0byB1cGRhdGUgdGhlIHByb2ZpbGUgaW5mby5cbiAgICAgICAgaWYgKHByZXZQcm9wcy51c2VySWQgIT09IHRoaXMucHJvcHMudXNlcklkICYmIHRoaXMucHJvcHMudXNlcklkKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRQcm9maWxlSW5mbygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBsb2FkUHJvZmlsZUluZm8oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IHRydWUgfSk7XG4gICAgICAgIGxldCBwcm9maWxlSW5mbztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHByb2ZpbGVJbmZvID0gYXdhaXQgY2xpLmdldFByb2ZpbGVJbmZvKHRoaXMucHJvcHMudXNlcklkKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKF90KCdDb3VsZCBub3QgbG9hZCB1c2VyIHByb2ZpbGUnKSwgJycsIEVycm9yRGlhbG9nLCB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IF90KCdDb3VsZCBub3QgbG9hZCB1c2VyIHByb2ZpbGUnKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogKChlcnIgJiYgZXJyLm1lc3NhZ2UpID8gZXJyLm1lc3NhZ2UgOiBfdChcIk9wZXJhdGlvbiBmYWlsZWRcIikpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgbG9hZGluZzogZmFsc2UgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmFrZUV2ZW50ID0gbmV3IE1hdHJpeEV2ZW50KHsgdHlwZTogXCJtLnJvb20ubWVtYmVyXCIsIGNvbnRlbnQ6IHByb2ZpbGVJbmZvIH0pO1xuICAgICAgICBjb25zdCBtZW1iZXIgPSBuZXcgUm9vbU1lbWJlcihudWxsLCB0aGlzLnByb3BzLnVzZXJJZCk7XG4gICAgICAgIG1lbWJlci5zZXRNZW1iZXJzaGlwRXZlbnQoZmFrZUV2ZW50KTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG1lbWJlciwgbG9hZGluZzogZmFsc2UgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlcigpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiA8U3Bpbm5lciAvPjtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLm1lbWJlcikge1xuICAgICAgICAgICAgY29uc3QgcGFuZWwgPSA8UmlnaHRQYW5lbCBtZW1iZXI9e3RoaXMuc3RhdGUubWVtYmVyfSByZXNpemVOb3RpZmllcj17dGhpcy5wcm9wcy5yZXNpemVOb3RpZmllcn0gLz47XG4gICAgICAgICAgICByZXR1cm4gKDxNYWluU3BsaXQgcGFuZWw9e3BhbmVsfSByZXNpemVOb3RpZmllcj17dGhpcy5wcm9wcy5yZXNpemVOb3RpZmllcn0+XG4gICAgICAgICAgICAgICAgPEhvbWVQYWdlIC8+XG4gICAgICAgICAgICA8L01haW5TcGxpdD4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICg8ZGl2IC8+KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==