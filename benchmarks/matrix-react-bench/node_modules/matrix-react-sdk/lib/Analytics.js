"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Analytics = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("./languageHandler");

var _PlatformPeg = _interopRequireDefault(require("./PlatformPeg"));

var _SdkConfig = _interopRequireDefault(require("./SdkConfig"));

var _Modal = _interopRequireDefault(require("./Modal"));

var sdk = _interopRequireWildcard(require("./index"));

var _logger = require("matrix-js-sdk/src/logger");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

const hashRegex = /#\/(groups?|room|user|settings|register|login|forgot_password|home|directory)/;
const hashVarRegex = /#\/(group|room|user)\/.*$/; // Remove all but the first item in the hash path. Redact unexpected hashes.

function getRedactedHash(hash) {
  // Don't leak URLs we aren't expecting - they could contain tokens/PII
  const match = hashRegex.exec(hash);

  if (!match) {
    _logger.logger.warn(`Unexpected hash location "${hash}"`);

    return '#/<unexpected hash location>';
  }

  if (hashVarRegex.test(hash)) {
    return hash.replace(hashVarRegex, "#/$1/<redacted>");
  }

  return hash.replace(hashRegex, "#/$1");
} // Return the current origin, path and hash separated with a `/`. This does
// not include query parameters.


function getRedactedUrl() {
  const {
    origin,
    hash
  } = window.location;
  let {
    pathname
  } = window.location; // Redact paths which could contain unexpected PII

  if (origin.startsWith('file://')) {
    pathname = "/<redacted>/";
  }

  return origin + pathname + getRedactedHash(hash);
}

const customVariables = {
  // The Matomo installation at https://matomo.riot.im is currently configured
  // with a limit of 10 custom variables.
  'App Platform': {
    id: 1,
    expl: (0, _languageHandler._td)('The platform you\'re on'),
    example: 'Electron Platform'
  },
  'App Version': {
    id: 2,
    expl: (0, _languageHandler._td)('The version of %(brand)s'),
    getTextVariables: () => ({
      brand: _SdkConfig.default.get().brand
    }),
    example: '15.0.0'
  },
  'User Type': {
    id: 3,
    expl: (0, _languageHandler._td)('Whether or not you\'re logged in (we don\'t record your username)'),
    example: 'Logged In'
  },
  'Chosen Language': {
    id: 4,
    expl: (0, _languageHandler._td)('Your language of choice'),
    example: 'en'
  },
  'Instance': {
    id: 5,
    expl: (0, _languageHandler._td)('Which officially provided instance you are using, if any'),
    example: 'app'
  },
  'RTE: Uses Richtext Mode': {
    id: 6,
    expl: (0, _languageHandler._td)('Whether or not you\'re using the Richtext mode of the Rich Text Editor'),
    example: 'off'
  },
  'Homeserver URL': {
    id: 7,
    expl: (0, _languageHandler._td)('Your homeserver\'s URL'),
    example: 'https://matrix.org'
  },
  'Touch Input': {
    id: 8,
    expl: (0, _languageHandler._td)("Whether you're using %(brand)s on a device where touch is the primary input mechanism"),
    getTextVariables: () => ({
      brand: _SdkConfig.default.get().brand
    }),
    example: 'false'
  },
  'Breadcrumbs': {
    id: 9,
    expl: (0, _languageHandler._td)("Whether or not you're using the 'breadcrumbs' feature (avatars above the room list)"),
    example: 'disabled'
  },
  'Installed PWA': {
    id: 10,
    expl: (0, _languageHandler._td)("Whether you're using %(brand)s as an installed Progressive Web App"),
    getTextVariables: () => ({
      brand: _SdkConfig.default.get().brand
    }),
    example: 'false'
  }
};

function whitelistRedact(whitelist, str) {
  if (whitelist.includes(str)) return str;
  return '<redacted>';
}

const UID_KEY = "mx_Riot_Analytics_uid";
const CREATION_TS_KEY = "mx_Riot_Analytics_cts";
const VISIT_COUNT_KEY = "mx_Riot_Analytics_vc";
const LAST_VISIT_TS_KEY = "mx_Riot_Analytics_lvts";

function getUid() {
  try {
    let data = localStorage && localStorage.getItem(UID_KEY);

    if (!data && localStorage) {
      localStorage.setItem(UID_KEY, data = [...Array(16)].map(() => Math.random().toString(16)[2]).join(''));
    }

    return data;
  } catch (e) {
    _logger.logger.error("Analytics error: ", e);

    return "";
  }
}

const HEARTBEAT_INTERVAL = 30 * 1000; // seconds

class Analytics {
  // {[id: number]: [name: string, value: string]}
  constructor() {
    (0, _defineProperty2.default)(this, "baseUrl", null);
    (0, _defineProperty2.default)(this, "siteId", null);
    (0, _defineProperty2.default)(this, "visitVariables", {});
    (0, _defineProperty2.default)(this, "firstPage", true);
    (0, _defineProperty2.default)(this, "heartbeatIntervalID", null);
    (0, _defineProperty2.default)(this, "creationTs", void 0);
    (0, _defineProperty2.default)(this, "lastVisitTs", void 0);
    (0, _defineProperty2.default)(this, "visitCount", void 0);
    (0, _defineProperty2.default)(this, "showDetailsModal", () => {
      let rows = [];

      if (!this.disabled) {
        rows = Object.values(this.visitVariables);
      } else {
        rows = Object.keys(customVariables).map(k => [k, (0, _languageHandler._t)('e.g. %(exampleValue)s', {
          exampleValue: customVariables[k].example
        })]);
      }

      const resolution = `${window.screen.width}x${window.screen.height}`;
      const otherVariables = [{
        expl: (0, _languageHandler._td)('Every page you use in the app'),
        value: (0, _languageHandler._t)('e.g. <CurrentPageURL>', {}, {
          CurrentPageURL: getRedactedUrl
        })
      }, {
        expl: (0, _languageHandler._td)('Your user agent'),
        value: navigator.userAgent
      }, {
        expl: (0, _languageHandler._td)('Your device resolution'),
        value: resolution
      }]; // FIXME: Using an import will result in test failures

      const ErrorDialog = sdk.getComponent('dialogs.ErrorDialog');

      _Modal.default.createTrackedDialog('Analytics Details', '', ErrorDialog, {
        title: (0, _languageHandler._t)('Analytics'),
        description: /*#__PURE__*/_react.default.createElement("div", {
          className: "mx_AnalyticsModal"
        }, /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)('The information being sent to us to help make %(brand)s better includes:', {
          brand: _SdkConfig.default.get().brand
        })), /*#__PURE__*/_react.default.createElement("table", null, rows.map(row => /*#__PURE__*/_react.default.createElement("tr", {
          key: row[0]
        }, /*#__PURE__*/_react.default.createElement("td", null, (0, _languageHandler._t)(customVariables[row[0]].expl, customVariables[row[0]].getTextVariables ? customVariables[row[0]].getTextVariables() : null)), row[1] !== undefined && /*#__PURE__*/_react.default.createElement("td", null, /*#__PURE__*/_react.default.createElement("code", null, row[1])))), otherVariables.map((item, index) => /*#__PURE__*/_react.default.createElement("tr", {
          key: index
        }, /*#__PURE__*/_react.default.createElement("td", null, (0, _languageHandler._t)(item.expl)), /*#__PURE__*/_react.default.createElement("td", null, /*#__PURE__*/_react.default.createElement("code", null, item.value))))), /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)('Where this page includes identifiable information, such as a room, ' + 'user or group ID, that data is removed before being sent to the server.')))
      });
    });
    this.creationTs = localStorage && localStorage.getItem(CREATION_TS_KEY);

    if (!this.creationTs && localStorage) {
      localStorage.setItem(CREATION_TS_KEY, this.creationTs = String(new Date().getTime()));
    }

    this.lastVisitTs = localStorage && localStorage.getItem(LAST_VISIT_TS_KEY);
    this.visitCount = localStorage && localStorage.getItem(VISIT_COUNT_KEY) || "0";
    this.visitCount = String(parseInt(this.visitCount, 10) + 1); // increment

    if (localStorage) {
      localStorage.setItem(VISIT_COUNT_KEY, this.visitCount);
    }
  }

  get disabled() {
    return !this.baseUrl;
  }

  canEnable() {
    const config = _SdkConfig.default.get();

    return navigator.doNotTrack !== "1" && config && config.piwik && config.piwik.url && config.piwik.siteId;
  }
  /**
   * Enable Analytics if initialized but disabled
   * otherwise try and initalize, no-op if piwik config missing
   */


  async enable() {
    if (!this.disabled) return;
    if (!this.canEnable()) return;

    const config = _SdkConfig.default.get();

    this.baseUrl = new URL("piwik.php", config.piwik.url); // set constants

    this.baseUrl.searchParams.set("rec", "1"); // rec is required for tracking

    this.baseUrl.searchParams.set("idsite", config.piwik.siteId); // rec is required for tracking

    this.baseUrl.searchParams.set("apiv", "1"); // API version to use

    this.baseUrl.searchParams.set("send_image", "0"); // we want a 204, not a tiny GIF
    // set user parameters

    this.baseUrl.searchParams.set("_id", getUid()); // uuid

    this.baseUrl.searchParams.set("_idts", this.creationTs); // first ts

    this.baseUrl.searchParams.set("_idvc", this.visitCount); // visit count

    if (this.lastVisitTs) {
      this.baseUrl.searchParams.set("_viewts", this.lastVisitTs); // last visit ts
    }

    const platform = _PlatformPeg.default.get();

    this.setVisitVariable('App Platform', platform.getHumanReadableName());

    try {
      this.setVisitVariable('App Version', await platform.getAppVersion());
    } catch (e) {
      this.setVisitVariable('App Version', 'unknown');
    }

    this.setVisitVariable('Chosen Language', (0, _languageHandler.getCurrentLanguage)());
    const hostname = window.location.hostname;

    if (hostname === 'riot.im') {
      this.setVisitVariable('Instance', window.location.pathname);
    } else if (hostname.endsWith('.element.io')) {
      this.setVisitVariable('Instance', hostname.replace('.element.io', ''));
    }

    let installedPWA = "unknown";

    try {
      // Known to work at least for desktop Chrome
      installedPWA = String(window.matchMedia('(display-mode: standalone)').matches);
    } catch (e) {}

    this.setVisitVariable('Installed PWA', installedPWA);
    let touchInput = "unknown";

    try {
      // MDN claims broad support across browsers
      touchInput = String(window.matchMedia('(pointer: coarse)').matches);
    } catch (e) {}

    this.setVisitVariable('Touch Input', touchInput); // start heartbeat

    this.heartbeatIntervalID = window.setInterval(this.ping.bind(this), HEARTBEAT_INTERVAL);
  }
  /**
   * Disable Analytics, stop the heartbeat and clear identifiers from localStorage
   */


  disable() {
    if (this.disabled) return;
    this.trackEvent('Analytics', 'opt-out');
    window.clearInterval(this.heartbeatIntervalID);
    this.baseUrl = null;
    this.visitVariables = {};
    localStorage.removeItem(UID_KEY);
    localStorage.removeItem(CREATION_TS_KEY);
    localStorage.removeItem(VISIT_COUNT_KEY);
    localStorage.removeItem(LAST_VISIT_TS_KEY);
  }

  async track(data) {
    if (this.disabled) return;
    const now = new Date();

    const params = _objectSpread(_objectSpread({}, data), {}, {
      url: getRedactedUrl(),
      _cvar: JSON.stringify(this.visitVariables),
      // user custom vars
      res: `${window.screen.width}x${window.screen.height}`,
      // resolution as WWWWxHHHH
      rand: String(Math.random()).slice(2, 8),
      // random nonce to cache-bust
      h: now.getHours(),
      m: now.getMinutes(),
      s: now.getSeconds()
    });

    const url = new URL(this.baseUrl.toString()); // copy

    for (const key in params) {
      url.searchParams.set(key, params[key]);
    }

    try {
      await window.fetch(url.toString(), {
        method: "GET",
        mode: "no-cors",
        cache: "no-cache",
        redirect: "follow"
      });
    } catch (e) {
      _logger.logger.error("Analytics error: ", e);
    }
  }

  ping() {
    this.track({
      ping: "1"
    });
    localStorage.setItem(LAST_VISIT_TS_KEY, String(new Date().getTime())); // update last visit ts
  }

  trackPageChange(generationTimeMs) {
    if (this.disabled) return;

    if (this.firstPage) {
      // De-duplicate first page
      // router seems to hit the fn twice
      this.firstPage = false;
      return;
    }

    if (typeof generationTimeMs !== 'number') {
      _logger.logger.warn('Analytics.trackPageChange: expected generationTimeMs to be a number'); // But continue anyway because we still want to track the change

    }

    this.track({
      gt_ms: String(generationTimeMs)
    });
  }

  trackEvent(category, action, name, value) {
    if (this.disabled) return;
    this.track({
      e_c: category,
      e_a: action,
      e_n: name,
      e_v: value
    });
  }

  setVisitVariable(key, value) {
    if (this.disabled) return;
    this.visitVariables[customVariables[key].id] = [key, value];
  }

  setLoggedIn(isGuest, homeserverUrl) {
    if (this.disabled) return;

    const config = _SdkConfig.default.get();

    if (!config.piwik) return;
    const whitelistedHSUrls = config.piwik.whitelistedHSUrls || [];
    this.setVisitVariable('User Type', isGuest ? 'Guest' : 'Logged In');
    this.setVisitVariable('Homeserver URL', whitelistRedact(whitelistedHSUrls, homeserverUrl));
  }

  setBreadcrumbs(state) {
    if (this.disabled) return;
    this.setVisitVariable('Breadcrumbs', state ? 'enabled' : 'disabled');
  }

}

exports.Analytics = Analytics;

if (!window.mxAnalytics) {
  window.mxAnalytics = new Analytics();
}

var _default = window.mxAnalytics;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BbmFseXRpY3MudHN4Il0sIm5hbWVzIjpbImhhc2hSZWdleCIsImhhc2hWYXJSZWdleCIsImdldFJlZGFjdGVkSGFzaCIsImhhc2giLCJtYXRjaCIsImV4ZWMiLCJsb2dnZXIiLCJ3YXJuIiwidGVzdCIsInJlcGxhY2UiLCJnZXRSZWRhY3RlZFVybCIsIm9yaWdpbiIsIndpbmRvdyIsImxvY2F0aW9uIiwicGF0aG5hbWUiLCJzdGFydHNXaXRoIiwiY3VzdG9tVmFyaWFibGVzIiwiaWQiLCJleHBsIiwiZXhhbXBsZSIsImdldFRleHRWYXJpYWJsZXMiLCJicmFuZCIsIlNka0NvbmZpZyIsImdldCIsIndoaXRlbGlzdFJlZGFjdCIsIndoaXRlbGlzdCIsInN0ciIsImluY2x1ZGVzIiwiVUlEX0tFWSIsIkNSRUFUSU9OX1RTX0tFWSIsIlZJU0lUX0NPVU5UX0tFWSIsIkxBU1RfVklTSVRfVFNfS0VZIiwiZ2V0VWlkIiwiZGF0YSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRJdGVtIiwiQXJyYXkiLCJtYXAiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJqb2luIiwiZSIsImVycm9yIiwiSEVBUlRCRUFUX0lOVEVSVkFMIiwiQW5hbHl0aWNzIiwiY29uc3RydWN0b3IiLCJyb3dzIiwiZGlzYWJsZWQiLCJPYmplY3QiLCJ2YWx1ZXMiLCJ2aXNpdFZhcmlhYmxlcyIsImtleXMiLCJrIiwiZXhhbXBsZVZhbHVlIiwicmVzb2x1dGlvbiIsInNjcmVlbiIsIndpZHRoIiwiaGVpZ2h0Iiwib3RoZXJWYXJpYWJsZXMiLCJ2YWx1ZSIsIkN1cnJlbnRQYWdlVVJMIiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiRXJyb3JEaWFsb2ciLCJzZGsiLCJnZXRDb21wb25lbnQiLCJNb2RhbCIsImNyZWF0ZVRyYWNrZWREaWFsb2ciLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwicm93IiwidW5kZWZpbmVkIiwiaXRlbSIsImluZGV4IiwiY3JlYXRpb25UcyIsIlN0cmluZyIsIkRhdGUiLCJnZXRUaW1lIiwibGFzdFZpc2l0VHMiLCJ2aXNpdENvdW50IiwicGFyc2VJbnQiLCJiYXNlVXJsIiwiY2FuRW5hYmxlIiwiY29uZmlnIiwiZG9Ob3RUcmFjayIsInBpd2lrIiwidXJsIiwic2l0ZUlkIiwiZW5hYmxlIiwiVVJMIiwic2VhcmNoUGFyYW1zIiwic2V0IiwicGxhdGZvcm0iLCJQbGF0Zm9ybVBlZyIsInNldFZpc2l0VmFyaWFibGUiLCJnZXRIdW1hblJlYWRhYmxlTmFtZSIsImdldEFwcFZlcnNpb24iLCJob3N0bmFtZSIsImVuZHNXaXRoIiwiaW5zdGFsbGVkUFdBIiwibWF0Y2hNZWRpYSIsIm1hdGNoZXMiLCJ0b3VjaElucHV0IiwiaGVhcnRiZWF0SW50ZXJ2YWxJRCIsInNldEludGVydmFsIiwicGluZyIsImJpbmQiLCJkaXNhYmxlIiwidHJhY2tFdmVudCIsImNsZWFySW50ZXJ2YWwiLCJyZW1vdmVJdGVtIiwidHJhY2siLCJub3ciLCJwYXJhbXMiLCJfY3ZhciIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXMiLCJyYW5kIiwic2xpY2UiLCJoIiwiZ2V0SG91cnMiLCJtIiwiZ2V0TWludXRlcyIsInMiLCJnZXRTZWNvbmRzIiwia2V5IiwiZmV0Y2giLCJtZXRob2QiLCJtb2RlIiwiY2FjaGUiLCJyZWRpcmVjdCIsInRyYWNrUGFnZUNoYW5nZSIsImdlbmVyYXRpb25UaW1lTXMiLCJmaXJzdFBhZ2UiLCJndF9tcyIsImNhdGVnb3J5IiwiYWN0aW9uIiwibmFtZSIsImVfYyIsImVfYSIsImVfbiIsImVfdiIsInNldExvZ2dlZEluIiwiaXNHdWVzdCIsImhvbWVzZXJ2ZXJVcmwiLCJ3aGl0ZWxpc3RlZEhTVXJscyIsInNldEJyZWFkY3J1bWJzIiwic3RhdGUiLCJteEFuYWx5dGljcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpQkE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7Ozs7Ozs7QUFFQSxNQUFNQSxTQUFTLEdBQUcsK0VB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V0FBWixFQUF5QjtBQUNyQjNJLEVBQUFBLE1BQU0sQ0FBQzJJLFdBQVAsR0FBcUIsSUFBSXpHLFNBQUosRUFBckI7QUFDSDs7ZUFDY2xDLE1BQU0sQ0FBQzJJLFciLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTcgTWljaGFlbCBUZWxhdHluc2tpIDw3dDNjaGd1eUBnbWFpbC5jb20+XG5Db3B5cmlnaHQgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7IGdldEN1cnJlbnRMYW5ndWFnZSwgX3QsIF90ZCwgSVZhcmlhYmxlcyB9IGZyb20gJy4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBQbGF0Zm9ybVBlZyBmcm9tICcuL1BsYXRmb3JtUGVnJztcbmltcG9ydCBTZGtDb25maWcgZnJvbSAnLi9TZGtDb25maWcnO1xuaW1wb3J0IE1vZGFsIGZyb20gJy4vTW9kYWwnO1xuaW1wb3J0ICogYXMgc2RrIGZyb20gJy4vaW5kZXgnO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbG9nZ2VyXCI7XG5cbmNvbnN0IGhhc2hSZWdleCA9IC8jXFwvKGdyb3Vwcz98cm9vbXx1c2VyfHNldHRpbmdzfHJlZ2lzdGVyfGxvZ2lufGZvcmdvdF9wYXNzd29yZHxob21lfGRpcmVjdG9yeSkvO1xuY29uc3QgaGFzaFZhclJlZ2V4ID0gLyNcXC8oZ3JvdXB8cm9vbXx1c2VyKVxcLy4qJC87XG5cbi8vIFJlbW92ZSBhbGwgYnV0IHRoZSBmaXJzdCBpdGVtIGluIHRoZSBoYXNoIHBhdGguIFJlZGFjdCB1bmV4cGVjdGVkIGhhc2hlcy5cbmZ1bmN0aW9uIGdldFJlZGFjdGVkSGFzaChoYXNoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIERvbid0IGxlYWsgVVJMcyB3ZSBhcmVuJ3QgZXhwZWN0aW5nIC0gdGhleSBjb3VsZCBjb250YWluIHRva2Vucy9QSUlcbiAgICBjb25zdCBtYXRjaCA9IGhhc2hSZWdleC5leGVjKGhhc2gpO1xuICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oYFVuZXhwZWN0ZWQgaGFzaCBsb2NhdGlvbiBcIiR7aGFzaH1cImApO1xuICAgICAgICByZXR1cm4gJyMvPHVuZXhwZWN0ZWQgaGFzaCBsb2NhdGlvbj4nO1xuICAgIH1cblxuICAgIGlmIChoYXNoVmFyUmVnZXgudGVzdChoYXNoKSkge1xuICAgICAgICByZXR1cm4gaGFzaC5yZXBsYWNlKGhhc2hWYXJSZWdleCwgXCIjLyQxLzxyZWRhY3RlZD5cIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIGhhc2gucmVwbGFjZShoYXNoUmVnZXgsIFwiIy8kMVwiKTtcbn1cblxuLy8gUmV0dXJuIHRoZSBjdXJyZW50IG9yaWdpbiwgcGF0aCBhbmQgaGFzaCBzZXBhcmF0ZWQgd2l0aCBhIGAvYC4gVGhpcyBkb2VzXG4vLyBub3QgaW5jbHVkZSBxdWVyeSBwYXJhbWV0ZXJzLlxuZnVuY3Rpb24gZ2V0UmVkYWN0ZWRVcmwoKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IG9yaWdpbiwgaGFzaCB9ID0gd2luZG93LmxvY2F0aW9uO1xuICAgIGxldCB7IHBhdGhuYW1lIH0gPSB3aW5kb3cubG9jYXRpb247XG5cbiAgICAvLyBSZWRhY3QgcGF0aHMgd2hpY2ggY291bGQgY29udGFpbiB1bmV4cGVjdGVkIFBJSVxuICAgIGlmIChvcmlnaW4uc3RhcnRzV2l0aCgnZmlsZTovLycpKSB7XG4gICAgICAgIHBhdGhuYW1lID0gXCIvPHJlZGFjdGVkPi9cIjtcbiAgICB9XG5cbiAgICByZXR1cm4gb3JpZ2luICsgcGF0aG5hbWUgKyBnZXRSZWRhY3RlZEhhc2goaGFzaCk7XG59XG5cbmludGVyZmFjZSBJRGF0YSB7XG4gICAgLyogZXNsaW50LWRpc2FibGUgY2FtZWxjYXNlICovXG4gICAgZ3RfbXM/OiBzdHJpbmc7XG4gICAgZV9jPzogc3RyaW5nO1xuICAgIGVfYT86IHN0cmluZztcbiAgICBlX24/OiBzdHJpbmc7XG4gICAgZV92Pzogc3RyaW5nO1xuICAgIHBpbmc/OiBzdHJpbmc7XG4gICAgLyogZXNsaW50LWVuYWJsZSBjYW1lbGNhc2UgKi9cbn1cblxuaW50ZXJmYWNlIElWYXJpYWJsZSB7XG4gICAgaWQ6IG51bWJlcjtcbiAgICBleHBsOiBzdHJpbmc7IC8vIGV4cGxhbmF0aW9uXG4gICAgZXhhbXBsZTogc3RyaW5nOyAvLyBleGFtcGxlIHZhbHVlXG4gICAgZ2V0VGV4dFZhcmlhYmxlcz8oKTogSVZhcmlhYmxlczsgLy8gb2JqZWN0IHRvIHBhc3MgYXMgMm5kIGFyZ3VtZW50IHRvIGBfdGBcbn1cblxuY29uc3QgY3VzdG9tVmFyaWFibGVzOiBSZWNvcmQ8c3RyaW5nLCBJVmFyaWFibGU+ID0ge1xuICAgIC8vIFRoZSBNYXRvbW8gaW5zdGFsbGF0aW9uIGF0IGh0dHBzOi8vbWF0b21vLnJpb3QuaW0gaXMgY3VycmVudGx5IGNvbmZpZ3VyZWRcbiAgICAvLyB3aXRoIGEgbGltaXQgb2YgMTAgY3VzdG9tIHZhcmlhYmxlcy5cbiAgICAnQXBwIFBsYXRmb3JtJzoge1xuICAgICAgICBpZDogMSxcbiAgICAgICAgZXhwbDogX3RkKCdUaGUgcGxhdGZvcm0geW91XFwncmUgb24nKSxcbiAgICAgICAgZXhhbXBsZTogJ0VsZWN0cm9uIFBsYXRmb3JtJyxcbiAgICB9LFxuICAgICdBcHAgVmVyc2lvbic6IHtcbiAgICAgICAgaWQ6IDIsXG4gICAgICAgIGV4cGw6IF90ZCgnVGhlIHZlcnNpb24gb2YgJShicmFuZClzJyksXG4gICAgICAgIGdldFRleHRWYXJpYWJsZXM6ICgpID0+ICh7XG4gICAgICAgICAgICBicmFuZDogU2RrQ29uZmlnLmdldCgpLmJyYW5kLFxuICAgICAgICB9KSxcbiAgICAgICAgZXhhbXBsZTogJzE1LjAuMCcsXG4gICAgfSxcbiAgICAnVXNlciBUeXBlJzoge1xuICAgICAgICBpZDogMyxcbiAgICAgICAgZXhwbDogX3RkKCdXaGV0aGVyIG9yIG5vdCB5b3VcXCdyZSBsb2dnZWQgaW4gKHdlIGRvblxcJ3QgcmVjb3JkIHlvdXIgdXNlcm5hbWUpJyksXG4gICAgICAgIGV4YW1wbGU6ICdMb2dnZWQgSW4nLFxuICAgIH0sXG4gICAgJ0Nob3NlbiBMYW5ndWFnZSc6IHtcbiAgICAgICAgaWQ6IDQsXG4gICAgICAgIGV4cGw6IF90ZCgnWW91ciBsYW5ndWFnZSBvZiBjaG9pY2UnKSxcbiAgICAgICAgZXhhbXBsZTogJ2VuJyxcbiAgICB9LFxuICAgICdJbnN0YW5jZSc6IHtcbiAgICAgICAgaWQ6IDUsXG4gICAgICAgIGV4cGw6IF90ZCgnV2hpY2ggb2ZmaWNpYWxseSBwcm92aWRlZCBpbnN0YW5jZSB5b3UgYXJlIHVzaW5nLCBpZiBhbnknKSxcbiAgICAgICAgZXhhbXBsZTogJ2FwcCcsXG4gICAgfSxcbiAgICAnUlRFOiBVc2VzIFJpY2h0ZXh0IE1vZGUnOiB7XG4gICAgICAgIGlkOiA2LFxuICAgICAgICBleHBsOiBfdGQoJ1doZXRoZXIgb3Igbm90IHlvdVxcJ3JlIHVzaW5nIHRoZSBSaWNodGV4dCBtb2RlIG9mIHRoZSBSaWNoIFRleHQgRWRpdG9yJyksXG4gICAgICAgIGV4YW1wbGU6ICdvZmYnLFxuICAgIH0sXG4gICAgJ0hvbWVzZXJ2ZXIgVVJMJzoge1xuICAgICAgICBpZDogNyxcbiAgICAgICAgZXhwbDogX3RkKCdZb3VyIGhvbWVzZXJ2ZXJcXCdzIFVSTCcpLFxuICAgICAgICBleGFtcGxlOiAnaHR0cHM6Ly9tYXRyaXgub3JnJyxcbiAgICB9LFxuICAgICdUb3VjaCBJbnB1dCc6IHtcbiAgICAgICAgaWQ6IDgsXG4gICAgICAgIGV4cGw6IF90ZChcIldoZXRoZXIgeW91J3JlIHVzaW5nICUoYnJhbmQpcyBvbiBhIGRldmljZSB3aGVyZSB0b3VjaCBpcyB0aGUgcHJpbWFyeSBpbnB1dCBtZWNoYW5pc21cIiksXG4gICAgICAgIGdldFRleHRWYXJpYWJsZXM6ICgpID0+ICh7XG4gICAgICAgICAgICBicmFuZDogU2RrQ29uZmlnLmdldCgpLmJyYW5kLFxuICAgICAgICB9KSxcbiAgICAgICAgZXhhbXBsZTogJ2ZhbHNlJyxcbiAgICB9LFxuICAgICdCcmVhZGNydW1icyc6IHtcbiAgICAgICAgaWQ6IDksXG4gICAgICAgIGV4cGw6IF90ZChcIldoZXRoZXIgb3Igbm90IHlvdSdyZSB1c2luZyB0aGUgJ2JyZWFkY3J1bWJzJyBmZWF0dXJlIChhdmF0YXJzIGFib3ZlIHRoZSByb29tIGxpc3QpXCIpLFxuICAgICAgICBleGFtcGxlOiAnZGlzYWJsZWQnLFxuICAgIH0sXG4gICAgJ0luc3RhbGxlZCBQV0EnOiB7XG4gICAgICAgIGlkOiAxMCxcbiAgICAgICAgZXhwbDogX3RkKFwiV2hldGhlciB5b3UncmUgdXNpbmcgJShicmFuZClzIGFzIGFuIGluc3RhbGxlZCBQcm9ncmVzc2l2ZSBXZWIgQXBwXCIpLFxuICAgICAgICBnZXRUZXh0VmFyaWFibGVzOiAoKSA9PiAoe1xuICAgICAgICAgICAgYnJhbmQ6IFNka0NvbmZpZy5nZXQoKS5icmFuZCxcbiAgICAgICAgfSksXG4gICAgICAgIGV4YW1wbGU6ICdmYWxzZScsXG4gICAgfSxcbn07XG5cbmZ1bmN0aW9uIHdoaXRlbGlzdFJlZGFjdCh3aGl0ZWxpc3Q6IHN0cmluZ1tdLCBzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKHdoaXRlbGlzdC5pbmNsdWRlcyhzdHIpKSByZXR1cm4gc3RyO1xuICAgIHJldHVybiAnPHJlZGFjdGVkPic7XG59XG5cbmNvbnN0IFVJRF9LRVkgPSBcIm14X1Jpb3RfQW5hbHl0aWNzX3VpZFwiO1xuY29uc3QgQ1JFQVRJT05fVFNfS0VZID0gXCJteF9SaW90X0FuYWx5dGljc19jdHNcIjtcbmNvbnN0IFZJU0lUX0NPVU5UX0tFWSA9IFwibXhfUmlvdF9BbmFseXRpY3NfdmNcIjtcbmNvbnN0IExBU1RfVklTSVRfVFNfS0VZID0gXCJteF9SaW90X0FuYWx5dGljc19sdnRzXCI7XG5cbmZ1bmN0aW9uIGdldFVpZCgpOiBzdHJpbmcge1xuICAgIHRyeSB7XG4gICAgICAgIGxldCBkYXRhID0gbG9jYWxTdG9yYWdlICYmIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFVJRF9LRVkpO1xuICAgICAgICBpZiAoIWRhdGEgJiYgbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShVSURfS0VZLCBkYXRhID0gWy4uLkFycmF5KDE2KV0ubWFwKCgpID0+IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpWzJdKS5qb2luKCcnKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoXCJBbmFseXRpY3MgZXJyb3I6IFwiLCBlKTtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxufVxuXG5jb25zdCBIRUFSVEJFQVRfSU5URVJWQUwgPSAzMCAqIDEwMDA7IC8vIHNlY29uZHNcblxuZXhwb3J0IGNsYXNzIEFuYWx5dGljcyB7XG4gICAgcHJpdmF0ZSBiYXNlVXJsOiBVUkwgPSBudWxsO1xuICAgIHByaXZhdGUgc2l0ZUlkOiBzdHJpbmcgPSBudWxsO1xuICAgIHByaXZhdGUgdmlzaXRWYXJpYWJsZXM6IFJlY29yZDxudW1iZXIsIFtzdHJpbmcsIHN0cmluZ10+ID0ge307IC8vIHtbaWQ6IG51bWJlcl06IFtuYW1lOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmddfVxuICAgIHByaXZhdGUgZmlyc3RQYWdlID0gdHJ1ZTtcbiAgICBwcml2YXRlIGhlYXJ0YmVhdEludGVydmFsSUQ6IG51bWJlciA9IG51bGw7XG5cbiAgICBwcml2YXRlIHJlYWRvbmx5IGNyZWF0aW9uVHM6IHN0cmluZztcbiAgICBwcml2YXRlIHJlYWRvbmx5IGxhc3RWaXNpdFRzOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSByZWFkb25seSB2aXNpdENvdW50OiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5jcmVhdGlvblRzID0gbG9jYWxTdG9yYWdlICYmIGxvY2FsU3RvcmFnZS5nZXRJdGVtKENSRUFUSU9OX1RTX0tFWSk7XG4gICAgICAgIGlmICghdGhpcy5jcmVhdGlvblRzICYmIGxvY2FsU3RvcmFnZSkge1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oQ1JFQVRJT05fVFNfS0VZLCB0aGlzLmNyZWF0aW9uVHMgPSBTdHJpbmcobmV3IERhdGUoKS5nZXRUaW1lKCkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubGFzdFZpc2l0VHMgPSBsb2NhbFN0b3JhZ2UgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oTEFTVF9WSVNJVF9UU19LRVkpO1xuICAgICAgICB0aGlzLnZpc2l0Q291bnQgPSBsb2NhbFN0b3JhZ2UgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oVklTSVRfQ09VTlRfS0VZKSB8fCBcIjBcIjtcbiAgICAgICAgdGhpcy52aXNpdENvdW50ID0gU3RyaW5nKHBhcnNlSW50KHRoaXMudmlzaXRDb3VudCwgMTApICsgMSk7IC8vIGluY3JlbWVudFxuICAgICAgICBpZiAobG9jYWxTdG9yYWdlKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShWSVNJVF9DT1VOVF9LRVksIHRoaXMudmlzaXRDb3VudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGRpc2FibGVkKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuYmFzZVVybDtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2FuRW5hYmxlKCkge1xuICAgICAgICBjb25zdCBjb25maWcgPSBTZGtDb25maWcuZ2V0KCk7XG4gICAgICAgIHJldHVybiBuYXZpZ2F0b3IuZG9Ob3RUcmFjayAhPT0gXCIxXCIgJiYgY29uZmlnICYmIGNvbmZpZy5waXdpayAmJiBjb25maWcucGl3aWsudXJsICYmIGNvbmZpZy5waXdpay5zaXRlSWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5hYmxlIEFuYWx5dGljcyBpZiBpbml0aWFsaXplZCBidXQgZGlzYWJsZWRcbiAgICAgKiBvdGhlcndpc2UgdHJ5IGFuZCBpbml0YWxpemUsIG5vLW9wIGlmIHBpd2lrIGNvbmZpZyBtaXNzaW5nXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGVuYWJsZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSByZXR1cm47XG4gICAgICAgIGlmICghdGhpcy5jYW5FbmFibGUoKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBjb25maWcgPSBTZGtDb25maWcuZ2V0KCk7XG5cbiAgICAgICAgdGhpcy5iYXNlVXJsID0gbmV3IFVSTChcInBpd2lrLnBocFwiLCBjb25maWcucGl3aWsudXJsKTtcbiAgICAgICAgLy8gc2V0IGNvbnN0YW50c1xuICAgICAgICB0aGlzLmJhc2VVcmwuc2VhcmNoUGFyYW1zLnNldChcInJlY1wiLCBcIjFcIik7IC8vIHJlYyBpcyByZXF1aXJlZCBmb3IgdHJhY2tpbmdcbiAgICAgICAgdGhpcy5iYXNlVXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJpZHNpdGVcIiwgY29uZmlnLnBpd2lrLnNpdGVJZCk7IC8vIHJlYyBpcyByZXF1aXJlZCBmb3IgdHJhY2tpbmdcbiAgICAgICAgdGhpcy5iYXNlVXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJhcGl2XCIsIFwiMVwiKTsgLy8gQVBJIHZlcnNpb24gdG8gdXNlXG4gICAgICAgIHRoaXMuYmFzZVVybC5zZWFyY2hQYXJhbXMuc2V0KFwic2VuZF9pbWFnZVwiLCBcIjBcIik7IC8vIHdlIHdhbnQgYSAyMDQsIG5vdCBhIHRpbnkgR0lGXG4gICAgICAgIC8vIHNldCB1c2VyIHBhcmFtZXRlcnNcbiAgICAgICAgdGhpcy5iYXNlVXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJfaWRcIiwgZ2V0VWlkKCkpOyAvLyB1dWlkXG4gICAgICAgIHRoaXMuYmFzZVVybC5zZWFyY2hQYXJhbXMuc2V0KFwiX2lkdHNcIiwgdGhpcy5jcmVhdGlvblRzKTsgLy8gZmlyc3QgdHNcbiAgICAgICAgdGhpcy5iYXNlVXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJfaWR2Y1wiLCB0aGlzLnZpc2l0Q291bnQpOyAvLyB2aXNpdCBjb3VudFxuICAgICAgICBpZiAodGhpcy5sYXN0VmlzaXRUcykge1xuICAgICAgICAgICAgdGhpcy5iYXNlVXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJfdmlld3RzXCIsIHRoaXMubGFzdFZpc2l0VHMpOyAvLyBsYXN0IHZpc2l0IHRzXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwbGF0Zm9ybSA9IFBsYXRmb3JtUGVnLmdldCgpO1xuICAgICAgICB0aGlzLnNldFZpc2l0VmFyaWFibGUoJ0FwcCBQbGF0Zm9ybScsIHBsYXRmb3JtLmdldEh1bWFuUmVhZGFibGVOYW1lKCkpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5zZXRWaXNpdFZhcmlhYmxlKCdBcHAgVmVyc2lvbicsIGF3YWl0IHBsYXRmb3JtLmdldEFwcFZlcnNpb24oKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0VmlzaXRWYXJpYWJsZSgnQXBwIFZlcnNpb24nLCAndW5rbm93bicpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRWaXNpdFZhcmlhYmxlKCdDaG9zZW4gTGFuZ3VhZ2UnLCBnZXRDdXJyZW50TGFuZ3VhZ2UoKSk7XG5cbiAgICAgICAgY29uc3QgaG9zdG5hbWUgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7XG4gICAgICAgIGlmIChob3N0bmFtZSA9PT0gJ3Jpb3QuaW0nKSB7XG4gICAgICAgICAgICB0aGlzLnNldFZpc2l0VmFyaWFibGUoJ0luc3RhbmNlJywgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKTtcbiAgICAgICAgfSBlbHNlIGlmIChob3N0bmFtZS5lbmRzV2l0aCgnLmVsZW1lbnQuaW8nKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRWaXNpdFZhcmlhYmxlKCdJbnN0YW5jZScsIGhvc3RuYW1lLnJlcGxhY2UoJy5lbGVtZW50LmlvJywgJycpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpbnN0YWxsZWRQV0EgPSBcInVua25vd25cIjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEtub3duIHRvIHdvcmsgYXQgbGVhc3QgZm9yIGRlc2t0b3AgQ2hyb21lXG4gICAgICAgICAgICBpbnN0YWxsZWRQV0EgPSBTdHJpbmcod2luZG93Lm1hdGNoTWVkaWEoJyhkaXNwbGF5LW1vZGU6IHN0YW5kYWxvbmUpJykubWF0Y2hlcyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgICAgICB0aGlzLnNldFZpc2l0VmFyaWFibGUoJ0luc3RhbGxlZCBQV0EnLCBpbnN0YWxsZWRQV0EpO1xuXG4gICAgICAgIGxldCB0b3VjaElucHV0ID0gXCJ1bmtub3duXCI7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBNRE4gY2xhaW1zIGJyb2FkIHN1cHBvcnQgYWNyb3NzIGJyb3dzZXJzXG4gICAgICAgICAgICB0b3VjaElucHV0ID0gU3RyaW5nKHdpbmRvdy5tYXRjaE1lZGlhKCcocG9pbnRlcjogY29hcnNlKScpLm1hdGNoZXMpO1xuICAgICAgICB9IGNhdGNoIChlKSB7IH1cbiAgICAgICAgdGhpcy5zZXRWaXNpdFZhcmlhYmxlKCdUb3VjaCBJbnB1dCcsIHRvdWNoSW5wdXQpO1xuXG4gICAgICAgIC8vIHN0YXJ0IGhlYXJ0YmVhdFxuICAgICAgICB0aGlzLmhlYXJ0YmVhdEludGVydmFsSUQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwodGhpcy5waW5nLmJpbmQodGhpcyksIEhFQVJUQkVBVF9JTlRFUlZBTCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGlzYWJsZSBBbmFseXRpY3MsIHN0b3AgdGhlIGhlYXJ0YmVhdCBhbmQgY2xlYXIgaWRlbnRpZmllcnMgZnJvbSBsb2NhbFN0b3JhZ2VcbiAgICAgKi9cbiAgICBwdWJsaWMgZGlzYWJsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgdGhpcy50cmFja0V2ZW50KCdBbmFseXRpY3MnLCAnb3B0LW91dCcpO1xuICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLmhlYXJ0YmVhdEludGVydmFsSUQpO1xuICAgICAgICB0aGlzLmJhc2VVcmwgPSBudWxsO1xuICAgICAgICB0aGlzLnZpc2l0VmFyaWFibGVzID0ge307XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFVJRF9LRVkpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShDUkVBVElPTl9UU19LRVkpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShWSVNJVF9DT1VOVF9LRVkpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShMQVNUX1ZJU0lUX1RTX0tFWSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyB0cmFjayhkYXRhOiBJRGF0YSkge1xuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgICB1cmw6IGdldFJlZGFjdGVkVXJsKCksXG5cbiAgICAgICAgICAgIF9jdmFyOiBKU09OLnN0cmluZ2lmeSh0aGlzLnZpc2l0VmFyaWFibGVzKSwgLy8gdXNlciBjdXN0b20gdmFyc1xuICAgICAgICAgICAgcmVzOiBgJHt3aW5kb3cuc2NyZWVuLndpZHRofXgke3dpbmRvdy5zY3JlZW4uaGVpZ2h0fWAsIC8vIHJlc29sdXRpb24gYXMgV1dXV3hISEhIXG4gICAgICAgICAgICByYW5kOiBTdHJpbmcoTWF0aC5yYW5kb20oKSkuc2xpY2UoMiwgOCksIC8vIHJhbmRvbSBub25jZSB0byBjYWNoZS1idXN0XG4gICAgICAgICAgICBoOiBub3cuZ2V0SG91cnMoKSxcbiAgICAgICAgICAgIG06IG5vdy5nZXRNaW51dGVzKCksXG4gICAgICAgICAgICBzOiBub3cuZ2V0U2Vjb25kcygpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwodGhpcy5iYXNlVXJsLnRvU3RyaW5nKCkpOyAvLyBjb3B5XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHBhcmFtcykge1xuICAgICAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoa2V5LCBwYXJhbXNba2V5XSk7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgd2luZG93LmZldGNoKHVybC50b1N0cmluZygpLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgIG1vZGU6IFwibm8tY29yc1wiLFxuICAgICAgICAgICAgICAgIGNhY2hlOiBcIm5vLWNhY2hlXCIsXG4gICAgICAgICAgICAgICAgcmVkaXJlY3Q6IFwiZm9sbG93XCIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiQW5hbHl0aWNzIGVycm9yOiBcIiwgZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgcGluZygpIHtcbiAgICAgICAgdGhpcy50cmFjayh7XG4gICAgICAgICAgICBwaW5nOiBcIjFcIixcbiAgICAgICAgfSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKExBU1RfVklTSVRfVFNfS0VZLCBTdHJpbmcobmV3IERhdGUoKS5nZXRUaW1lKCkpKTsgLy8gdXBkYXRlIGxhc3QgdmlzaXQgdHNcbiAgICB9XG5cbiAgICBwdWJsaWMgdHJhY2tQYWdlQ2hhbmdlKGdlbmVyYXRpb25UaW1lTXM/OiBudW1iZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuZmlyc3RQYWdlKSB7XG4gICAgICAgICAgICAvLyBEZS1kdXBsaWNhdGUgZmlyc3QgcGFnZVxuICAgICAgICAgICAgLy8gcm91dGVyIHNlZW1zIHRvIGhpdCB0aGUgZm4gdHdpY2VcbiAgICAgICAgICAgIHRoaXMuZmlyc3RQYWdlID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGdlbmVyYXRpb25UaW1lTXMgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBsb2dnZXIud2FybignQW5hbHl0aWNzLnRyYWNrUGFnZUNoYW5nZTogZXhwZWN0ZWQgZ2VuZXJhdGlvblRpbWVNcyB0byBiZSBhIG51bWJlcicpO1xuICAgICAgICAgICAgLy8gQnV0IGNvbnRpbnVlIGFueXdheSBiZWNhdXNlIHdlIHN0aWxsIHdhbnQgdG8gdHJhY2sgdGhlIGNoYW5nZVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmFjayh7XG4gICAgICAgICAgICBndF9tczogU3RyaW5nKGdlbmVyYXRpb25UaW1lTXMpLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdHJhY2tFdmVudChjYXRlZ29yeTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgbmFtZT86IHN0cmluZywgdmFsdWU/OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgdGhpcy50cmFjayh7XG4gICAgICAgICAgICBlX2M6IGNhdGVnb3J5LFxuICAgICAgICAgICAgZV9hOiBhY3Rpb24sXG4gICAgICAgICAgICBlX246IG5hbWUsXG4gICAgICAgICAgICBlX3Y6IHZhbHVlLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFZpc2l0VmFyaWFibGUoa2V5OiBrZXlvZiB0eXBlb2YgY3VzdG9tVmFyaWFibGVzLCB2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSByZXR1cm47XG4gICAgICAgIHRoaXMudmlzaXRWYXJpYWJsZXNbY3VzdG9tVmFyaWFibGVzW2tleV0uaWRdID0gW2tleSwgdmFsdWVdO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRMb2dnZWRJbihpc0d1ZXN0OiBib29sZWFuLCBob21lc2VydmVyVXJsOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHJldHVybjtcblxuICAgICAgICBjb25zdCBjb25maWcgPSBTZGtDb25maWcuZ2V0KCk7XG4gICAgICAgIGlmICghY29uZmlnLnBpd2lrKSByZXR1cm47XG5cbiAgICAgICAgY29uc3Qgd2hpdGVsaXN0ZWRIU1VybHMgPSBjb25maWcucGl3aWsud2hpdGVsaXN0ZWRIU1VybHMgfHwgW107XG5cbiAgICAgICAgdGhpcy5zZXRWaXNpdFZhcmlhYmxlKCdVc2VyIFR5cGUnLCBpc0d1ZXN0ID8gJ0d1ZXN0JyA6ICdMb2dnZWQgSW4nKTtcbiAgICAgICAgdGhpcy5zZXRWaXNpdFZhcmlhYmxlKCdIb21lc2VydmVyIFVSTCcsIHdoaXRlbGlzdFJlZGFjdCh3aGl0ZWxpc3RlZEhTVXJscywgaG9tZXNlcnZlclVybCkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRCcmVhZGNydW1icyhzdGF0ZTogYm9vbGVhbikge1xuICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgcmV0dXJuO1xuICAgICAgICB0aGlzLnNldFZpc2l0VmFyaWFibGUoJ0JyZWFkY3J1bWJzJywgc3RhdGUgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2hvd0RldGFpbHNNb2RhbCA9ICgpID0+IHtcbiAgICAgICAgbGV0IHJvd3MgPSBbXTtcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICByb3dzID0gT2JqZWN0LnZhbHVlcyh0aGlzLnZpc2l0VmFyaWFibGVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJvd3MgPSBPYmplY3Qua2V5cyhjdXN0b21WYXJpYWJsZXMpLm1hcChcbiAgICAgICAgICAgICAgICAoaykgPT4gW1xuICAgICAgICAgICAgICAgICAgICBrLFxuICAgICAgICAgICAgICAgICAgICBfdCgnZS5nLiAlKGV4YW1wbGVWYWx1ZSlzJywgeyBleGFtcGxlVmFsdWU6IGN1c3RvbVZhcmlhYmxlc1trXS5leGFtcGxlIH0pLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzb2x1dGlvbiA9IGAke3dpbmRvdy5zY3JlZW4ud2lkdGh9eCR7d2luZG93LnNjcmVlbi5oZWlnaHR9YDtcbiAgICAgICAgY29uc3Qgb3RoZXJWYXJpYWJsZXMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZXhwbDogX3RkKCdFdmVyeSBwYWdlIHlvdSB1c2UgaW4gdGhlIGFwcCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBfdChcbiAgICAgICAgICAgICAgICAgICAgJ2UuZy4gPEN1cnJlbnRQYWdlVVJMPicsXG4gICAgICAgICAgICAgICAgICAgIHt9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50UGFnZVVSTDogZ2V0UmVkYWN0ZWRVcmwsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IGV4cGw6IF90ZCgnWW91ciB1c2VyIGFnZW50JyksIHZhbHVlOiBuYXZpZ2F0b3IudXNlckFnZW50IH0sXG4gICAgICAgICAgICB7IGV4cGw6IF90ZCgnWW91ciBkZXZpY2UgcmVzb2x1dGlvbicpLCB2YWx1ZTogcmVzb2x1dGlvbiB9LFxuICAgICAgICBdO1xuXG4gICAgICAgIC8vIEZJWE1FOiBVc2luZyBhbiBpbXBvcnQgd2lsbCByZXN1bHQgaW4gdGVzdCBmYWlsdXJlc1xuICAgICAgICBjb25zdCBFcnJvckRpYWxvZyA9IHNkay5nZXRDb21wb25lbnQoJ2RpYWxvZ3MuRXJyb3JEaWFsb2cnKTtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnQW5hbHl0aWNzIERldGFpbHMnLCAnJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgIHRpdGxlOiBfdCgnQW5hbHl0aWNzJyksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogPGRpdiBjbGFzc05hbWU9XCJteF9BbmFseXRpY3NNb2RhbFwiPlxuICAgICAgICAgICAgICAgIDxkaXY+eyBfdCgnVGhlIGluZm9ybWF0aW9uIGJlaW5nIHNlbnQgdG8gdXMgdG8gaGVscCBtYWtlICUoYnJhbmQpcyBiZXR0ZXIgaW5jbHVkZXM6Jywge1xuICAgICAgICAgICAgICAgICAgICBicmFuZDogU2RrQ29uZmlnLmdldCgpLmJyYW5kLFxuICAgICAgICAgICAgICAgIH0pIH08L2Rpdj5cbiAgICAgICAgICAgICAgICA8dGFibGU+XG4gICAgICAgICAgICAgICAgICAgIHsgcm93cy5tYXAoKHJvdykgPT4gPHRyIGtleT17cm93WzBdfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IF90KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbVZhcmlhYmxlc1tyb3dbMF1dLmV4cGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tVmFyaWFibGVzW3Jvd1swXV0uZ2V0VGV4dFZhcmlhYmxlcyA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbVZhcmlhYmxlc1tyb3dbMF1dLmdldFRleHRWYXJpYWJsZXMoKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICApIH08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgeyByb3dbMV0gIT09IHVuZGVmaW5lZCAmJiA8dGQ+PGNvZGU+eyByb3dbMV0gfTwvY29kZT48L3RkPiB9XG4gICAgICAgICAgICAgICAgICAgIDwvdHI+KSB9XG4gICAgICAgICAgICAgICAgICAgIHsgb3RoZXJWYXJpYWJsZXMubWFwKChpdGVtLCBpbmRleCkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBrZXk9e2luZGV4fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+eyBfdChpdGVtLmV4cGwpIH08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD48Y29kZT57IGl0ZW0udmFsdWUgfTwvY29kZT48L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4sXG4gICAgICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgeyBfdCgnV2hlcmUgdGhpcyBwYWdlIGluY2x1ZGVzIGlkZW50aWZpYWJsZSBpbmZvcm1hdGlvbiwgc3VjaCBhcyBhIHJvb20sICdcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJ3VzZXIgb3IgZ3JvdXAgSUQsIHRoYXQgZGF0YSBpcyByZW1vdmVkIGJlZm9yZSBiZWluZyBzZW50IHRvIHRoZSBzZXJ2ZXIuJykgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+LFxuICAgICAgICB9KTtcbiAgICB9O1xufVxuXG5pZiAoIXdpbmRvdy5teEFuYWx5dGljcykge1xuICAgIHdpbmRvdy5teEFuYWx5dGljcyA9IG5ldyBBbmFseXRpY3MoKTtcbn1cbmV4cG9ydCBkZWZhdWx0IHdpbmRvdy5teEFuYWx5dGljcztcbiJdfQ==