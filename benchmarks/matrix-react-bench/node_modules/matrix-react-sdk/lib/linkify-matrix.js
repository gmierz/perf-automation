"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _SpecPermalinkConstructor = require("./utils/permalinks/SpecPermalinkConstructor");

var _Permalinks = require("./utils/permalinks/Permalinks");

/*
Copyright 2015, 2016 OpenMarket Ltd
Copyright 2019 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
var Type;

(function (Type) {
  Type["URL"] = "url";
  Type["UserId"] = "userid";
  Type["RoomAlias"] = "roomalias";
  Type["GroupId"] = "groupid";
})(Type || (Type = {}));

function matrixLinkify(linkify) {
  // Text tokens
  const TT = linkify.scanner.TOKENS; // Multi tokens

  const MT = linkify.parser.TOKENS;
  const MultiToken = MT.Base;
  const S_START = linkify.parser.start;

  if (TT.UNDERSCORE === undefined) {
    throw new Error("linkify-matrix requires linkifyjs 2.1.1: this version is too old.");
  }

  const ROOMALIAS = function (value) {
    MultiToken.call(this, value);
    this.type = 'roomalias';
    this.isLink = true;
  };

  ROOMALIAS.prototype = new MultiToken();
  const S_HASH = S_START.jump(TT.POUND);
  const S_HASH_NAME = new linkify.parser.State();
  const S_HASH_NAME_COLON = new linkify.parser.State();
  const S_HASH_NAME_COLON_DOMAIN = new linkify.parser.State(ROOMALIAS);
  const S_HASH_NAME_COLON_DOMAIN_DOT = new linkify.parser.State();
  const S_ROOMALIAS = new linkify.parser.State(ROOMALIAS);
  const S_ROOMALIAS_COLON = new linkify.parser.State();
  const S_ROOMALIAS_COLON_NUM = new linkify.parser.State(ROOMALIAS);
  const roomnameTokens = [TT.DOT, TT.PLUS, TT.NUM, TT.DOMAIN, TT.TLD, TT.UNDERSCORE, TT.POUND, // because 'localhost' is tokenised to the localhost token,
  // usernames @localhost:foo.com are otherwise not matched!
  TT.LOCALHOST];
  S_HASH.on(roomnameTokens, S_HASH_NAME);
  S_HASH_NAME.on(roomnameTokens, S_HASH_NAME);
  S_HASH_NAME.on(TT.DOMAIN, S_HASH_NAME);
  S_HASH_NAME.on(TT.COLON, S_HASH_NAME_COLON);
  S_HASH_NAME_COLON.on(TT.DOMAIN, S_HASH_NAME_COLON_DOMAIN);
  S_HASH_NAME_COLON.on(TT.LOCALHOST, S_ROOMALIAS); // accept #foo:localhost

  S_HASH_NAME_COLON.on(TT.TLD, S_ROOMALIAS); // accept #foo:com (mostly for (TLD|DOMAIN)+ mixing)

  S_HASH_NAME_COLON_DOMAIN.on(TT.DOT, S_HASH_NAME_COLON_DOMAIN_DOT);
  S_HASH_NAME_COLON_DOMAIN_DOT.on(TT.DOMAIN, S_HASH_NAME_COLON_DOMAIN);
  S_HASH_NAME_COLON_DOMAIN_DOT.on(TT.TLD, S_ROOMALIAS);
  S_ROOMALIAS.on(TT.DOT, S_HASH_NAME_COLON_DOMAIN_DOT); // accept repeated TLDs (e.g .org.uk)

  S_ROOMALIAS.on(TT.COLON, S_ROOMALIAS_COLON); // do not accept trailing `:`

  S_ROOMALIAS_COLON.on(TT.NUM, S_ROOMALIAS_COLON_NUM); // but do accept :NUM (port specifier)

  const USERID = function (value) {
    MultiToken.call(this, value);
    this.type = 'userid';
    this.isLink = true;
  };

  USERID.prototype = new MultiToken();
  const S_AT = S_START.jump(TT.AT);
  const S_AT_NAME = new linkify.parser.State();
  const S_AT_NAME_COLON = new linkify.parser.State();
  const S_AT_NAME_COLON_DOMAIN = new linkify.parser.State(USERID);
  const S_AT_NAME_COLON_DOMAIN_DOT = new linkify.parser.State();
  const S_USERID = new linkify.parser.State(USERID);
  const S_USERID_COLON = new linkify.parser.State();
  const S_USERID_COLON_NUM = new linkify.parser.State(USERID);
  const usernameTokens = [TT.DOT, TT.UNDERSCORE, TT.PLUS, TT.NUM, TT.DOMAIN, TT.TLD, // as in roomnameTokens
  TT.LOCALHOST];
  S_AT.on(usernameTokens, S_AT_NAME);
  S_AT_NAME.on(usernameTokens, S_AT_NAME);
  S_AT_NAME.on(TT.DOMAIN, S_AT_NAME);
  S_AT_NAME.on(TT.COLON, S_AT_NAME_COLON);
  S_AT_NAME_COLON.on(TT.DOMAIN, S_AT_NAME_COLON_DOMAIN);
  S_AT_NAME_COLON.on(TT.LOCALHOST, S_USERID); // accept @foo:localhost

  S_AT_NAME_COLON.on(TT.TLD, S_USERID); // accept @foo:com (mostly for (TLD|DOMAIN)+ mixing)

  S_AT_NAME_COLON_DOMAIN.on(TT.DOT, S_AT_NAME_COLON_DOMAIN_DOT);
  S_AT_NAME_COLON_DOMAIN_DOT.on(TT.DOMAIN, S_AT_NAME_COLON_DOMAIN);
  S_AT_NAME_COLON_DOMAIN_DOT.on(TT.TLD, S_USERID);
  S_USERID.on(TT.DOT, S_AT_NAME_COLON_DOMAIN_DOT); // accept repeated TLDs (e.g .org.uk)

  S_USERID.on(TT.COLON, S_USERID_COLON); // do not accept trailing `:`

  S_USERID_COLON.on(TT.NUM, S_USERID_COLON_NUM); // but do accept :NUM (port specifier)

  const GROUPID = function (value) {
    MultiToken.call(this, value);
    this.type = 'groupid';
    this.isLink = true;
  };

  GROUPID.prototype = new MultiToken();
  const S_PLUS = S_START.jump(TT.PLUS);
  const S_PLUS_NAME = new linkify.parser.State();
  const S_PLUS_NAME_COLON = new linkify.parser.State();
  const S_PLUS_NAME_COLON_DOMAIN = new linkify.parser.State(GROUPID);
  const S_PLUS_NAME_COLON_DOMAIN_DOT = new linkify.parser.State();
  const S_GROUPID = new linkify.parser.State(GROUPID);
  const S_GROUPID_COLON = new linkify.parser.State();
  const S_GROUPID_COLON_NUM = new linkify.parser.State(GROUPID);
  const groupIdTokens = [TT.DOT, TT.UNDERSCORE, TT.PLUS, TT.NUM, TT.DOMAIN, TT.TLD, // as in roomnameTokens
  TT.LOCALHOST];
  S_PLUS.on(groupIdTokens, S_PLUS_NAME);
  S_PLUS_NAME.on(groupIdTokens, S_PLUS_NAME);
  S_PLUS_NAME.on(TT.DOMAIN, S_PLUS_NAME);
  S_PLUS_NAME.on(TT.COLON, S_PLUS_NAME_COLON);
  S_PLUS_NAME_COLON.on(TT.DOMAIN, S_PLUS_NAME_COLON_DOMAIN);
  S_PLUS_NAME_COLON.on(TT.LOCALHOST, S_GROUPID); // accept +foo:localhost

  S_PLUS_NAME_COLON.on(TT.TLD, S_GROUPID); // accept +foo:com (mostly for (TLD|DOMAIN)+ mixing)

  S_PLUS_NAME_COLON_DOMAIN.on(TT.DOT, S_PLUS_NAME_COLON_DOMAIN_DOT);
  S_PLUS_NAME_COLON_DOMAIN_DOT.on(TT.DOMAIN, S_PLUS_NAME_COLON_DOMAIN);
  S_PLUS_NAME_COLON_DOMAIN_DOT.on(TT.TLD, S_GROUPID);
  S_GROUPID.on(TT.DOT, S_PLUS_NAME_COLON_DOMAIN_DOT); // accept repeated TLDs (e.g .org.uk)

  S_GROUPID.on(TT.COLON, S_GROUPID_COLON); // do not accept trailing `:`

  S_GROUPID_COLON.on(TT.NUM, S_GROUPID_COLON_NUM); // but do accept :NUM (port specifier)
} // stubs, overwritten in MatrixChat's componentDidMount


matrixLinkify.onUserClick = function (e, userId) {
  e.preventDefault();
};

matrixLinkify.onAliasClick = function (e, roomAlias) {
  e.preventDefault();
};

matrixLinkify.onGroupClick = function (e, groupId) {
  e.preventDefault();
};

const escapeRegExp = function (string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}; // Recognise URLs from both our local and official Element deployments.
// Anyone else really should be using matrix.to.


matrixLinkify.ELEMENT_URL_PATTERN = "^(?:https?://)?(?:" + escapeRegExp(window.location.host + window.location.pathname) + "|" + "(?:www\\.)?(?:riot|vector)\\.im/(?:app|beta|staging|develop)/|" + "(?:app|beta|staging|develop)\\.element\\.io/" + ")(#.*)";
matrixLinkify.MATRIXTO_URL_PATTERN = "^(?:https?://)?(?:www\\.)?matrix\\.to/#/(([#@!+]).*)";
matrixLinkify.MATRIXTO_MD_LINK_PATTERN = '\\[([^\\]]*)\\]\\((?:https?://)?(?:www\\.)?matrix\\.to/#/([#@!+][^\\)]*)\\)';
matrixLinkify.MATRIXTO_BASE_URL = _SpecPermalinkConstructor.baseUrl;
matrixLinkify.options = {
  events: function (href, type) {
    switch (type) {
      case Type.URL:
        {
          // intercept local permalinks to users and show them like userids (in userinfo of current room)
          try {
            const permalink = (0, _Permalinks.parsePermalink)(href);

            if (permalink && permalink.userId) {
              return {
                // @ts-ignore see https://linkify.js.org/docs/options.html
                click: function (e) {
                  matrixLinkify.onUserClick(e, permalink.userId);
                }
              };
            }
          } catch (e) {// OK fine, it's not actually a permalink
          }

          break;
        }

      case Type.UserId:
        return {
          // @ts-ignore see https://linkify.js.org/docs/options.html
          click: function (e) {
            matrixLinkify.onUserClick(e, href);
          }
        };

      case Type.RoomAlias:
        return {
          // @ts-ignore see https://linkify.js.org/docs/options.html
          click: function (e) {
            matrixLinkify.onAliasClick(e, href);
          }
        };

      case Type.GroupId:
        return {
          // @ts-ignore see https://linkify.js.org/docs/options.html
          click: function (e) {
            matrixLinkify.onGroupClick(e, href);
          }
        };
    }
  },
  formatHref: function (href, type) {
    switch (type) {
      case Type.RoomAlias:
      case Type.UserId:
      case Type.GroupId:
      default:
        {
          return (0, _Permalinks.tryTransformEntityToPermalink)(href);
        }
    }
  },
  linkAttributes: {
    rel: 'noreferrer noopener'
  },
  target: function (href, type) {
    if (type === Type.URL) {
      try {
        const transformed = (0, _Permalinks.tryTransformPermalinkToLocalHref)(href);

        if (transformed !== href || decodeURIComponent(href).match(matrixLinkify.ELEMENT_URL_PATTERN)) {
          return null;
        } else {
          return '_blank';
        }
      } catch (e) {// malformed URI
      }
    }

    return null;
  }
};
var _default = matrixLinkify;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9saW5raWZ5LW1hdHJpeC50cyJdLCJuYW1lcyI6WyJUeXBlIiwibWF0cml4TGlua2lmeSIsImxpbmtpZnkiLCJUVCIsInNjYW5uZXIiLCJUT0tFTlMiLCJNVCIsInBhcnNlciIsIk11bHRpVG9rZW4iLCJCYXNlIiwiU19TVEFSVCIsInN0YXJ0IiwiVU5ERVJTQ09SRSIsInVuZGVmaW5lZCIsIkVycm9yIiwiUk9PTUFMSUFTIiwidmFsdWUiLCJjYWxsIiwidHlwZSIsImlzTGluayIsInByb3RvdHlwZSIsIlNfSEFTSCIsImp1bXAiLCJQT1VORCIsIlNfSEFTSF9OQU1FIiwiU3RhdGUiLCJTX0hBU0hfTkFNRV9DT0xPTiIsIlNfSEFTSF9OQU1FX0NPTE9OX0RPTUFJTiIsIlNfSEFTSF9OQU1FX0NPTE9OX0RPTUFJTl9ET1QiLCJTX1JPT01BTElBUyIsIlNfUk9PTUFMSUFTX0NPTE9OIiwiU19ST09NQUxJQVNfQ09MT05fTlVNIiwicm9vbW5hbWVUb2tlbnMiLCJET1QiLCJQTFVTIiwiTlVNIiwiRE9NQUlOIiwiVExEIiwiTE9DQUxIT1NUIiwib24iLCJDT0xPTiIsIlVTRVJJRCIsIlNfQVQiLCJBVCIsIlNfQVRfTkFNRSIsIlNfQVRfTkFNRV9DT0xPTiIsIlNfQVRfTkFNRV9DT0xPTl9ET01BSU4iLCJTX0FUX05BTUVfQ09MT05fRE9NQUlOX0RPVCIsIlNfVVNFUklEIiwiU19VU0VSSURfQ09MT04iLCJTX1VTRVJJRF9DT0xPTl9OVU0iLCJ1c2VybmFtZVRva2VucyIsIkdST1VQSUQiLCJTX1BMVVMiLCJTX1BMVVNfTkFNRSIsIlNfUExVU19OQU1FX0NPTE9OIiwiU19QTFVTX05BTUVfQ09MT05fRE9NQUlOIiwiU19QTFVTX05BTUVfQ09MT05fRE9NQUlOX0RPVCIsIlNfR1JPVVBJRCIsIlNfR1JPVVBJRF9DT0xPTiIsIlNfR1JPVVBJRF9DT0xPTl9OVU0iLCJncm91cElkVG9rZW5zIiwib25Vc2VyQ2xpY2siLCJlIiwidXNlcklkIiwicHJldmVudERlZmF1bHQiLCJvbkFsaWFzQ2xpY2siLCJyb29tQWxpYXMiLCJvbkdyb3VwQ2xpY2siLCJncm91cElkIiwiZXNjYXBlUmVnRXhwIiwic3RyaW5nIiwicmVwbGFjZSIsIkVMRU1FTlRfVVJMX1BBVFRFUk4iLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhvc3QiLCJwYXRobmFtZSIsIk1BVFJJWFRPX1VSTF9QQVRURVJOIiwiTUFUUklYVE9fTURfTElOS19QQVRURVJOIiwiTUFUUklYVE9fQkFTRV9VUkwiLCJiYXNlVXJsIiwib3B0aW9ucyIsImV2ZW50cyIsImhyZWYiLCJVUkwiLCJwZXJtYWxpbmsiLCJjbGljayIsIlVzZXJJZCIsIlJvb21BbGlhcyIsIkdyb3VwSWQiLCJmb3JtYXRIcmVmIiwibGlua0F0dHJpYnV0ZXMiLCJyZWwiLCJ0YXJnZXQiLCJ0cmFuc2Zvcm1lZCIsImRlY29kZVVSSUNvbXBvbmVudCIsIm1hdGNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBaUJBOztBQUNBOztBQWxCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtJQVNLQSxJOztXQUFBQSxJO0FBQUFBLEVBQUFBLEk7QUFBQUEsRUFBQUEsSTtBQUFBQSxFQUFBQSxJO0FBQUFBLEVBQUFBLEk7R0FBQUEsSSxLQUFBQSxJOztBQU9MLFNBQVNDLGFBQVQsQ0FBdUJDLE9BQXZCLEVBQXNDO0FBQ2xDO0FBQ0EsUUFBTUMsRUFBRSxHQUFHRCxPQUFPLENBQUNFLE9BQVIsQ0FBZ0JDLE1BQTNCLENBRmtDLENBR2xDOztBQUNBLFFBQU1DLEVBQUUsR0FBR0osT0FBTyxDQUFDSyxNQUFSLENBQWVGLE1BQTFCO0FBQ0EsUUFBTUcsVUFBVSxHQUFHRixFQUFFLENBQUNHLElBQXRCO0FBQ0EsUUFBTUMsT0FBTyxHQUFHUixPQUFPLENBQUNLLE1BQVIsQ0FBZUksS0FBL0I7O0FBRUEsTUFBSVIsRUFBRSxDQUFDUyxVQUFILEtBQWtCQyxTQUF0QixFQUFp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QUNKLE9BUEQsQ0FPRSxPQUFPVixDQUFQLEVBQVUsQ0FDUjtBQUNIO0FBQ0o7O0FBQ0QsV0FBTyxJQUFQO0FBQ0g7QUF6RW1CLENBQXhCO2VBNEVlOUQsYSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxNSwgMjAxNiBPcGVuTWFya2V0IEx0ZFxuQ29weXJpZ2h0IDIwMTkgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgeyBiYXNlVXJsIH0gZnJvbSBcIi4vdXRpbHMvcGVybWFsaW5rcy9TcGVjUGVybWFsaW5rQ29uc3RydWN0b3JcIjtcbmltcG9ydCB7XG4gICAgcGFyc2VQZXJtYWxpbmssXG4gICAgdHJ5VHJhbnNmb3JtRW50aXR5VG9QZXJtYWxpbmssXG4gICAgdHJ5VHJhbnNmb3JtUGVybWFsaW5rVG9Mb2NhbEhyZWYsXG59IGZyb20gXCIuL3V0aWxzL3Blcm1hbGlua3MvUGVybWFsaW5rc1wiO1xuXG5lbnVtIFR5cGUge1xuICAgIFVSTCA9IFwidXJsXCIsXG4gICAgVXNlcklkID0gXCJ1c2VyaWRcIixcbiAgICBSb29tQWxpYXMgPSBcInJvb21hbGlhc1wiLFxuICAgIEdyb3VwSWQgPSBcImdyb3VwaWRcIlxufVxuXG5mdW5jdGlvbiBtYXRyaXhMaW5raWZ5KGxpbmtpZnkpOiB2b2lkIHtcbiAgICAvLyBUZXh0IHRva2Vuc1xuICAgIGNvbnN0IFRUID0gbGlua2lmeS5zY2FubmVyLlRPS0VOUztcbiAgICAvLyBNdWx0aSB0b2tlbnNcbiAgICBjb25zdCBNVCA9IGxpbmtpZnkucGFyc2VyLlRPS0VOUztcbiAgICBjb25zdCBNdWx0aVRva2VuID0gTVQuQmFzZTtcbiAgICBjb25zdCBTX1NUQVJUID0gbGlua2lmeS5wYXJzZXIuc3RhcnQ7XG5cbiAgICBpZiAoVFQuVU5ERVJTQ09SRSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImxpbmtpZnktbWF0cml4IHJlcXVpcmVzIGxpbmtpZnlqcyAyLjEuMTogdGhpcyB2ZXJzaW9uIGlzIHRvbyBvbGQuXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IFJPT01BTElBUyA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIE11bHRpVG9rZW4uY2FsbCh0aGlzLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMudHlwZSA9ICdyb29tYWxpYXMnO1xuICAgICAgICB0aGlzLmlzTGluayA9IHRydWU7XG4gICAgfTtcbiAgICBST09NQUxJQVMucHJvdG90eXBlID0gbmV3IE11bHRpVG9rZW4oKTtcblxuICAgIGNvbnN0IFNfSEFTSCA9IFNfU1RBUlQuanVtcChUVC5QT1VORCk7XG4gICAgY29uc3QgU19IQVNIX05BTUUgPSBuZXcgbGlua2lmeS5wYXJzZXIuU3RhdGUoKTtcbiAgICBjb25zdCBTX0hBU0hfTkFNRV9DT0xPTiA9IG5ldyBsaW5raWZ5LnBhcnNlci5TdGF0ZSgpO1xuICAgIGNvbnN0IFNfSEFTSF9OQU1FX0NPTE9OX0RPTUFJTiA9IG5ldyBsaW5raWZ5LnBhcnNlci5TdGF0ZShST09NQUxJQVMpO1xuICAgIGNvbnN0IFNfSEFTSF9OQU1FX0NPTE9OX0RPTUFJTl9ET1QgPSBuZXcgbGlua2lmeS5wYXJzZXIuU3RhdGUoKTtcbiAgICBjb25zdCBTX1JPT01BTElBUyA9IG5ldyBsaW5raWZ5LnBhcnNlci5TdGF0ZShST09NQUxJQVMpO1xuICAgIGNvbnN0IFNfUk9PTUFMSUFTX0NPTE9OID0gbmV3IGxpbmtpZnkucGFyc2VyLlN0YXRlKCk7XG4gICAgY29uc3QgU19ST09NQUxJQVNfQ09MT05fTlVNID0gbmV3IGxpbmtpZnkucGFyc2VyLlN0YXRlKFJPT01BTElBUyk7XG5cbiAgICBjb25zdCByb29tbmFtZVRva2VucyA9IFtcbiAgICAgICAgVFQuRE9ULFxuICAgICAgICBUVC5QTFVTLFxuICAgICAgICBUVC5OVU0sXG4gICAgICAgIFRULkRPTUFJTixcbiAgICAgICAgVFQuVExELFxuICAgICAgICBUVC5VTkRFUlNDT1JFLFxuICAgICAgICBUVC5QT1VORCxcblxuICAgICAgICAvLyBiZWNhdXNlICdsb2NhbGhvc3QnIGlzIHRva2VuaXNlZCB0byB0aGUgbG9jYWxob3N0IHRva2VuLFxuICAgICAgICAvLyB1c2VybmFtZXMgQGxvY2FsaG9zdDpmb28uY29tIGFyZSBvdGhlcndpc2Ugbm90IG1hdGNoZWQhXG4gICAgICAgIFRULkxPQ0FMSE9TVCxcbiAgICBdO1xuXG4gICAgU19IQVNILm9uKHJvb21uYW1lVG9rZW5zLCBTX0hBU0hfTkFNRSk7XG4gICAgU19IQVNIX05BTUUub24ocm9vbW5hbWVUb2tlbnMsIFNfSEFTSF9OQU1FKTtcbiAgICBTX0hBU0hfTkFNRS5vbihUVC5ET01BSU4sIFNfSEFTSF9OQU1FKTtcblxuICAgIFNfSEFTSF9OQU1FLm9uKFRULkNPTE9OLCBTX0hBU0hfTkFNRV9DT0xPTik7XG5cbiAgICBTX0hBU0hfTkFNRV9DT0xPTi5vbihUVC5ET01BSU4sIFNfSEFTSF9OQU1FX0NPTE9OX0RPTUFJTik7XG4gICAgU19IQVNIX05BTUVfQ09MT04ub24oVFQuTE9DQUxIT1NULCBTX1JPT01BTElBUyk7IC8vIGFjY2VwdCAjZm9vOmxvY2FsaG9zdFxuICAgIFNfSEFTSF9OQU1FX0NPTE9OLm9uKFRULlRMRCwgU19ST09NQUxJQVMpOyAvLyBhY2NlcHQgI2Zvbzpjb20gKG1vc3RseSBmb3IgKFRMRHxET01BSU4pKyBtaXhpbmcpXG4gICAgU19IQVNIX05BTUVfQ09MT05fRE9NQUlOLm9uKFRULkRPVCwgU19IQVNIX05BTUVfQ09MT05fRE9NQUlOX0RPVCk7XG4gICAgU19IQVNIX05BTUVfQ09MT05fRE9NQUlOX0RPVC5vbihUVC5ET01BSU4sIFNfSEFTSF9OQU1FX0NPTE9OX0RPTUFJTik7XG4gICAgU19IQVNIX05BTUVfQ09MT05fRE9NQUlOX0RPVC5vbihUVC5UTEQsIFNfUk9PTUFMSUFTKTtcblxuICAgIFNfUk9PTUFMSUFTLm9uKFRULkRPVCwgU19IQVNIX05BTUVfQ09MT05fRE9NQUlOX0RPVCk7IC8vIGFjY2VwdCByZXBlYXRlZCBUTERzIChlLmcgLm9yZy51aylcbiAgICBTX1JPT01BTElBUy5vbihUVC5DT0xPTiwgU19ST09NQUxJQVNfQ09MT04pOyAvLyBkbyBub3QgYWNjZXB0IHRyYWlsaW5nIGA6YFxuICAgIFNfUk9PTUFMSUFTX0NPTE9OLm9uKFRULk5VTSwgU19ST09NQUxJQVNfQ09MT05fTlVNKTsgLy8gYnV0IGRvIGFjY2VwdCA6TlVNIChwb3J0IHNwZWNpZmllcilcblxuICAgIGNvbnN0IFVTRVJJRCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIE11bHRpVG9rZW4uY2FsbCh0aGlzLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMudHlwZSA9ICd1c2VyaWQnO1xuICAgICAgICB0aGlzLmlzTGluayA9IHRydWU7XG4gICAgfTtcbiAgICBVU0VSSUQucHJvdG90eXBlID0gbmV3IE11bHRpVG9rZW4oKTtcblxuICAgIGNvbnN0IFNfQVQgPSBTX1NUQVJULmp1bXAoVFQuQVQpO1xuICAgIGNvbnN0IFNfQVRfTkFNRSA9IG5ldyBsaW5raWZ5LnBhcnNlci5TdGF0ZSgpO1xuICAgIGNvbnN0IFNfQVRfTkFNRV9DT0xPTiA9IG5ldyBsaW5raWZ5LnBhcnNlci5TdGF0ZSgpO1xuICAgIGNvbnN0IFNfQVRfTkFNRV9DT0xPTl9ET01BSU4gPSBuZXcgbGlua2lmeS5wYXJzZXIuU3RhdGUoVVNFUklEKTtcbiAgICBjb25zdCBTX0FUX05BTUVfQ09MT05fRE9NQUlOX0RPVCA9IG5ldyBsaW5raWZ5LnBhcnNlci5TdGF0ZSgpO1xuICAgIGNvbnN0IFNfVVNFUklEID0gbmV3IGxpbmtpZnkucGFyc2VyLlN0YXRlKFVTRVJJRCk7XG4gICAgY29uc3QgU19VU0VSSURfQ09MT04gPSBuZXcgbGlua2lmeS5wYXJzZXIuU3RhdGUoKTtcbiAgICBjb25zdCBTX1VTRVJJRF9DT0xPTl9OVU0gPSBuZXcgbGlua2lmeS5wYXJzZXIuU3RhdGUoVVNFUklEKTtcblxuICAgIGNvbnN0IHVzZXJuYW1lVG9rZW5zID0gW1xuICAgICAgICBUVC5ET1QsXG4gICAgICAgIFRULlVOREVSU0NPUkUsXG4gICAgICAgIFRULlBMVVMsXG4gICAgICAgIFRULk5VTSxcbiAgICAgICAgVFQuRE9NQUlOLFxuICAgICAgICBUVC5UTEQsXG5cbiAgICAgICAgLy8gYXMgaW4gcm9vbW5hbWVUb2tlbnNcbiAgICAgICAgVFQuTE9DQUxIT1NULFxuICAgIF07XG5cbiAgICBTX0FULm9uKHVzZXJuYW1lVG9rZW5zLCBTX0FUX05BTUUpO1xuICAgIFNfQVRfTkFNRS5vbih1c2VybmFtZVRva2VucywgU19BVF9OQU1FKTtcbiAgICBTX0FUX05BTUUub24oVFQuRE9NQUlOLCBTX0FUX05BTUUpO1xuXG4gICAgU19BVF9OQU1FLm9uKFRULkNPTE9OLCBTX0FUX05BTUVfQ09MT04pO1xuXG4gICAgU19BVF9OQU1FX0NPTE9OLm9uKFRULkRPTUFJTiwgU19BVF9OQU1FX0NPTE9OX0RPTUFJTik7XG4gICAgU19BVF9OQU1FX0NPTE9OLm9uKFRULkxPQ0FMSE9TVCwgU19VU0VSSUQpOyAvLyBhY2NlcHQgQGZvbzpsb2NhbGhvc3RcbiAgICBTX0FUX05BTUVfQ09MT04ub24oVFQuVExELCBTX1VTRVJJRCk7IC8vIGFjY2VwdCBAZm9vOmNvbSAobW9zdGx5IGZvciAoVExEfERPTUFJTikrIG1peGluZylcbiAgICBTX0FUX05BTUVfQ09MT05fRE9NQUlOLm9uKFRULkRPVCwgU19BVF9OQU1FX0NPTE9OX0RPTUFJTl9ET1QpO1xuICAgIFNfQVRfTkFNRV9DT0xPTl9ET01BSU5fRE9ULm9uKFRULkRPTUFJTiwgU19BVF9OQU1FX0NPTE9OX0RPTUFJTik7XG4gICAgU19BVF9OQU1FX0NPTE9OX0RPTUFJTl9ET1Qub24oVFQuVExELCBTX1VTRVJJRCk7XG5cbiAgICBTX1VTRVJJRC5vbihUVC5ET1QsIFNfQVRfTkFNRV9DT0xPTl9ET01BSU5fRE9UKTsgLy8gYWNjZXB0IHJlcGVhdGVkIFRMRHMgKGUuZyAub3JnLnVrKVxuICAgIFNfVVNFUklELm9uKFRULkNPTE9OLCBTX1VTRVJJRF9DT0xPTik7IC8vIGRvIG5vdCBhY2NlcHQgdHJhaWxpbmcgYDpgXG4gICAgU19VU0VSSURfQ09MT04ub24oVFQuTlVNLCBTX1VTRVJJRF9DT0xPTl9OVU0pOyAvLyBidXQgZG8gYWNjZXB0IDpOVU0gKHBvcnQgc3BlY2lmaWVyKVxuXG4gICAgY29uc3QgR1JPVVBJRCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIE11bHRpVG9rZW4uY2FsbCh0aGlzLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMudHlwZSA9ICdncm91cGlkJztcbiAgICAgICAgdGhpcy5pc0xpbmsgPSB0cnVlO1xuICAgIH07XG4gICAgR1JPVVBJRC5wcm90b3R5cGUgPSBuZXcgTXVsdGlUb2tlbigpO1xuXG4gICAgY29uc3QgU19QTFVTID0gU19TVEFSVC5qdW1wKFRULlBMVVMpO1xuICAgIGNvbnN0IFNfUExVU19OQU1FID0gbmV3IGxpbmtpZnkucGFyc2VyLlN0YXRlKCk7XG4gICAgY29uc3QgU19QTFVTX05BTUVfQ09MT04gPSBuZXcgbGlua2lmeS5wYXJzZXIuU3RhdGUoKTtcbiAgICBjb25zdCBTX1BMVVNfTkFNRV9DT0xPTl9ET01BSU4gPSBuZXcgbGlua2lmeS5wYXJzZXIuU3RhdGUoR1JPVVBJRCk7XG4gICAgY29uc3QgU19QTFVTX05BTUVfQ09MT05fRE9NQUlOX0RPVCA9IG5ldyBsaW5raWZ5LnBhcnNlci5TdGF0ZSgpO1xuICAgIGNvbnN0IFNfR1JPVVBJRCA9IG5ldyBsaW5raWZ5LnBhcnNlci5TdGF0ZShHUk9VUElEKTtcbiAgICBjb25zdCBTX0dST1VQSURfQ09MT04gPSBuZXcgbGlua2lmeS5wYXJzZXIuU3RhdGUoKTtcbiAgICBjb25zdCBTX0dST1VQSURfQ09MT05fTlVNID0gbmV3IGxpbmtpZnkucGFyc2VyLlN0YXRlKEdST1VQSUQpO1xuXG4gICAgY29uc3QgZ3JvdXBJZFRva2VucyA9IFtcbiAgICAgICAgVFQuRE9ULFxuICAgICAgICBUVC5VTkRFUlNDT1JFLFxuICAgICAgICBUVC5QTFVTLFxuICAgICAgICBUVC5OVU0sXG4gICAgICAgIFRULkRPTUFJTixcbiAgICAgICAgVFQuVExELFxuXG4gICAgICAgIC8vIGFzIGluIHJvb21uYW1lVG9rZW5zXG4gICAgICAgIFRULkxPQ0FMSE9TVCxcbiAgICBdO1xuXG4gICAgU19QTFVTLm9uKGdyb3VwSWRUb2tlbnMsIFNfUExVU19OQU1FKTtcbiAgICBTX1BMVVNfTkFNRS5vbihncm91cElkVG9rZW5zLCBTX1BMVVNfTkFNRSk7XG4gICAgU19QTFVTX05BTUUub24oVFQuRE9NQUlOLCBTX1BMVVNfTkFNRSk7XG5cbiAgICBTX1BMVVNfTkFNRS5vbihUVC5DT0xPTiwgU19QTFVTX05BTUVfQ09MT04pO1xuXG4gICAgU19QTFVTX05BTUVfQ09MT04ub24oVFQuRE9NQUlOLCBTX1BMVVNfTkFNRV9DT0xPTl9ET01BSU4pO1xuICAgIFNfUExVU19OQU1FX0NPTE9OLm9uKFRULkxPQ0FMSE9TVCwgU19HUk9VUElEKTsgLy8gYWNjZXB0ICtmb286bG9jYWxob3N0XG4gICAgU19QTFVTX05BTUVfQ09MT04ub24oVFQuVExELCBTX0dST1VQSUQpOyAvLyBhY2NlcHQgK2Zvbzpjb20gKG1vc3RseSBmb3IgKFRMRHxET01BSU4pKyBtaXhpbmcpXG4gICAgU19QTFVTX05BTUVfQ09MT05fRE9NQUlOLm9uKFRULkRPVCwgU19QTFVTX05BTUVfQ09MT05fRE9NQUlOX0RPVCk7XG4gICAgU19QTFVTX05BTUVfQ09MT05fRE9NQUlOX0RPVC5vbihUVC5ET01BSU4sIFNfUExVU19OQU1FX0NPTE9OX0RPTUFJTik7XG4gICAgU19QTFVTX05BTUVfQ09MT05fRE9NQUlOX0RPVC5vbihUVC5UTEQsIFNfR1JPVVBJRCk7XG5cbiAgICBTX0dST1VQSUQub24oVFQuRE9ULCBTX1BMVVNfTkFNRV9DT0xPTl9ET01BSU5fRE9UKTsgLy8gYWNjZXB0IHJlcGVhdGVkIFRMRHMgKGUuZyAub3JnLnVrKVxuICAgIFNfR1JPVVBJRC5vbihUVC5DT0xPTiwgU19HUk9VUElEX0NPTE9OKTsgLy8gZG8gbm90IGFjY2VwdCB0cmFpbGluZyBgOmBcbiAgICBTX0dST1VQSURfQ09MT04ub24oVFQuTlVNLCBTX0dST1VQSURfQ09MT05fTlVNKTsgLy8gYnV0IGRvIGFjY2VwdCA6TlVNIChwb3J0IHNwZWNpZmllcilcbn1cblxuLy8gc3R1YnMsIG92ZXJ3cml0dGVuIGluIE1hdHJpeENoYXQncyBjb21wb25lbnREaWRNb3VudFxubWF0cml4TGlua2lmeS5vblVzZXJDbGljayA9IGZ1bmN0aW9uKGU6IE1vdXNlRXZlbnQsIHVzZXJJZDogc3RyaW5nKSB7IGUucHJldmVudERlZmF1bHQoKTsgfTtcbm1hdHJpeExpbmtpZnkub25BbGlhc0NsaWNrID0gZnVuY3Rpb24oZTogTW91c2VFdmVudCwgcm9vbUFsaWFzOiBzdHJpbmcpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9O1xubWF0cml4TGlua2lmeS5vbkdyb3VwQ2xpY2sgPSBmdW5jdGlvbihlOiBNb3VzZUV2ZW50LCBncm91cElkOiBzdHJpbmcpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9O1xuXG5jb25zdCBlc2NhcGVSZWdFeHAgPSBmdW5jdGlvbihzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csIFwiXFxcXCQmXCIpO1xufTtcblxuLy8gUmVjb2duaXNlIFVSTHMgZnJvbSBib3RoIG91ciBsb2NhbCBhbmQgb2ZmaWNpYWwgRWxlbWVudCBkZXBsb3ltZW50cy5cbi8vIEFueW9uZSBlbHNlIHJlYWxseSBzaG91bGQgYmUgdXNpbmcgbWF0cml4LnRvLlxubWF0cml4TGlua2lmeS5FTEVNRU5UX1VSTF9QQVRURVJOID1cbiAgICBcIl4oPzpodHRwcz86Ly8pPyg/OlwiICtcbiAgICAgICAgZXNjYXBlUmVnRXhwKHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKSArIFwifFwiICtcbiAgICAgICAgXCIoPzp3d3dcXFxcLik/KD86cmlvdHx2ZWN0b3IpXFxcXC5pbS8oPzphcHB8YmV0YXxzdGFnaW5nfGRldmVsb3ApL3xcIiArXG4gICAgICAgIFwiKD86YXBwfGJldGF8c3RhZ2luZ3xkZXZlbG9wKVxcXFwuZWxlbWVudFxcXFwuaW8vXCIgK1xuICAgIFwiKSgjLiopXCI7XG5cbm1hdHJpeExpbmtpZnkuTUFUUklYVE9fVVJMX1BBVFRFUk4gPSBcIl4oPzpodHRwcz86Ly8pPyg/Ond3d1xcXFwuKT9tYXRyaXhcXFxcLnRvLyMvKChbI0AhK10pLiopXCI7XG5tYXRyaXhMaW5raWZ5Lk1BVFJJWFRPX01EX0xJTktfUEFUVEVSTiA9XG4gICAgJ1xcXFxbKFteXFxcXF1dKilcXFxcXVxcXFwoKD86aHR0cHM/Oi8vKT8oPzp3d3dcXFxcLik/bWF0cml4XFxcXC50by8jLyhbI0AhK11bXlxcXFwpXSopXFxcXCknO1xubWF0cml4TGlua2lmeS5NQVRSSVhUT19CQVNFX1VSTD0gYmFzZVVybDtcblxubWF0cml4TGlua2lmeS5vcHRpb25zID0ge1xuICAgIGV2ZW50czogZnVuY3Rpb24oaHJlZjogc3RyaW5nLCB0eXBlOiBUeXBlIHwgc3RyaW5nKTogUGFydGlhbDxHbG9iYWxFdmVudEhhbmRsZXJzPiB7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSBUeXBlLlVSTDoge1xuICAgICAgICAgICAgICAgIC8vIGludGVyY2VwdCBsb2NhbCBwZXJtYWxpbmtzIHRvIHVzZXJzIGFuZCBzaG93IHRoZW0gbGlrZSB1c2VyaWRzIChpbiB1c2VyaW5mbyBvZiBjdXJyZW50IHJvb20pXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGVybWFsaW5rID0gcGFyc2VQZXJtYWxpbmsoaHJlZik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwZXJtYWxpbmsgJiYgcGVybWFsaW5rLnVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlIHNlZSBodHRwczovL2xpbmtpZnkuanMub3JnL2RvY3Mvb3B0aW9ucy5odG1sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4TGlua2lmeS5vblVzZXJDbGljayhlLCBwZXJtYWxpbmsudXNlcklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT0sgZmluZSwgaXQncyBub3QgYWN0dWFsbHkgYSBwZXJtYWxpbmtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFR5cGUuVXNlcklkOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgc2VlIGh0dHBzOi8vbGlua2lmeS5qcy5vcmcvZG9jcy9vcHRpb25zLmh0bWxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdHJpeExpbmtpZnkub25Vc2VyQ2xpY2soZSwgaHJlZik7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhc2UgVHlwZS5Sb29tQWxpYXM6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZSBzZWUgaHR0cHM6Ly9saW5raWZ5LmpzLm9yZy9kb2NzL29wdGlvbnMuaHRtbFxuICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4TGlua2lmeS5vbkFsaWFzQ2xpY2soZSwgaHJlZik7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhc2UgVHlwZS5Hcm91cElkOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgc2VlIGh0dHBzOi8vbGlua2lmeS5qcy5vcmcvZG9jcy9vcHRpb25zLmh0bWxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdHJpeExpbmtpZnkub25Hcm91cENsaWNrKGUsIGhyZWYpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZm9ybWF0SHJlZjogZnVuY3Rpb24oaHJlZjogc3RyaW5nLCB0eXBlOiBUeXBlIHwgc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFR5cGUuUm9vbUFsaWFzOlxuICAgICAgICAgICAgY2FzZSBUeXBlLlVzZXJJZDpcbiAgICAgICAgICAgIGNhc2UgVHlwZS5Hcm91cElkOlxuICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnlUcmFuc2Zvcm1FbnRpdHlUb1Blcm1hbGluayhocmVmKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBsaW5rQXR0cmlidXRlczoge1xuICAgICAgICByZWw6ICdub3JlZmVycmVyIG5vb3BlbmVyJyxcbiAgICB9LFxuXG4gICAgdGFyZ2V0OiBmdW5jdGlvbihocmVmOiBzdHJpbmcsIHR5cGU6IFR5cGUgfCBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBpZiAodHlwZSA9PT0gVHlwZS5VUkwpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtZWQgPSB0cnlUcmFuc2Zvcm1QZXJtYWxpbmtUb0xvY2FsSHJlZihocmVmKTtcbiAgICAgICAgICAgICAgICBpZiAodHJhbnNmb3JtZWQgIT09IGhyZWYgfHwgZGVjb2RlVVJJQ29tcG9uZW50KGhyZWYpLm1hdGNoKG1hdHJpeExpbmtpZnkuRUxFTUVOVF9VUkxfUEFUVEVSTikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdfYmxhbmsnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvLyBtYWxmb3JtZWQgVVJJXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IG1hdHJpeExpbmtpZnk7XG4iXX0=