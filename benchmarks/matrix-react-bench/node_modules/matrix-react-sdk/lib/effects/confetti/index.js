"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DefaultOptions = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

/*
 Copyright 2020 Nurjin Jafar
 Copyright 2020 Nordeck IT + Consulting GmbH.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 */
const DefaultOptions = {
  maxCount: 150,
  speed: 3,
  frameInterval: 15,
  alpha: 1.0,
  gradient: false
};
exports.DefaultOptions = DefaultOptions;

class Confetti {
  constructor(options) {
    (0, _defineProperty2.default)(this, "options", void 0);
    (0, _defineProperty2.default)(this, "context", null);
    (0, _defineProperty2.default)(this, "supportsAnimationFrame", window.requestAnimationFrame);
    (0, _defineProperty2.default)(this, "colors", ['rgba(30,144,255,', 'rgba(107,142,35,', 'rgba(255,215,0,', 'rgba(255,192,203,', 'rgba(106,90,205,', 'rgba(173,216,230,', 'rgba(238,130,238,', 'rgba(152,251,152,', 'rgba(70,130,180,', 'rgba(244,164,96,', 'rgba(210,105,30,', 'rgba(220,20,60,']);
    (0, _defineProperty2.default)(this, "lastFrameTime", Date.now());
    (0, _defineProperty2.default)(this, "particles", []);
    (0, _defineProperty2.default)(this, "waveAngle", 0);
    (0, _defineProperty2.default)(this, "isRunning", void 0);
    (0, _defineProperty2.default)(this, "start", async (canvas, timeout = 3000) => {
      if (!canvas) {
        return;
      }

      this.context = canvas.getContext('2d');
      this.particles = [];
      const count = this.options.maxCount;

      while (this.particles.length < count) {
        this.particles.push(this.resetParticle({}, canvas.width, canvas.height));
      }

      this.isRunning = true;
      this.runAnimation();

      if (timeout) {
        window.setTimeout(this.stop, timeout);
      }
    });
    (0, _defineProperty2.default)(this, "stop", async () => {
      this.isRunning = false;
    });
    (0, _defineProperty2.default)(this, "resetParticle", (particle, width, height) => {
      particle.color = this.colors[Math.random() * this.colors.length | 0] + (this.options.alpha + ')');

      if (this.options.gradient) {
        particle.color2 = this.colors[Math.random() * this.colors.length | 0] + (this.options.alpha + ')');
      } else {
        particle.color2 = particle.color;
      }

      particle.x = Math.random() * width;
      particle.y = Math.random() * -height;
      particle.diameter = Math.random() * 10 + 5;
      particle.tilt = Math.random() * -10;
      particle.tiltAngleIncrement = Math.random() * 0.07 + 0.05;
      particle.tiltAngle = Math.random() * Math.PI;
      return particle;
    });
    (0, _defineProperty2.default)(this, "runAnimation", () => {
      if (!this.context || !this.context.canvas) {
        return;
      }

      if (this.particles.length === 0) {
        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);
      } else {
        const now = Date.now();
        const delta = now - this.lastFrameTime;

        if (!this.supportsAnimationFrame || delta > this.options.frameInterval) {
          this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);
          this.updateParticles();
          this.drawParticles(this.context);
          this.lastFrameTime = now - delta % this.options.frameInterval;
        }

        requestAnimationFrame(this.runAnimation);
      }
    });
    (0, _defineProperty2.default)(this, "drawParticles", context => {
      if (!this.context || !this.context.canvas) {
        return;
      }

      let x;
      let x2;
      let y2;

      for (const particle of this.particles) {
        this.context.beginPath();
        context.lineWidth = particle.diameter;
        x2 = particle.x + particle.tilt;
        x = x2 + particle.diameter / 2;
        y2 = particle.y + particle.tilt + particle.diameter / 2;

        if (this.options.gradient) {
          const gradient = context.createLinearGradient(x, particle.y, x2, y2);
          gradient.addColorStop(0, particle.color);
          gradient.addColorStop(1.0, particle.color2);
          context.strokeStyle = gradient;
        } else {
          context.strokeStyle = particle.color;
        }

        context.moveTo(x, particle.y);
        context.lineTo(x2, y2);
        context.stroke();
      }
    });
    (0, _defineProperty2.default)(this, "updateParticles", () => {
      if (!this.context || !this.context.canvas) {
        return;
      }

      const width = this.context.canvas.width;
      const height = this.context.canvas.height;
      let particle;
      this.waveAngle += 0.01;

      for (let i = 0; i < this.particles.length; i++) {
        particle = this.particles[i];

        if (!this.isRunning && particle.y < -15) {
          particle.y = height + 100;
        } else {
          particle.tiltAngle += particle.tiltAngleIncrement;
          particle.x += Math.sin(this.waveAngle) - 0.5;
          particle.y += (Math.cos(this.waveAngle) + particle.diameter + this.options.speed) * 0.5;
          particle.tilt = Math.sin(particle.tiltAngle) * 15;
        }

        if (particle.x > width + 20 || particle.x < -20 || particle.y > height) {
          if (this.isRunning && this.particles.length <= this.options.maxCount) {
            this.resetParticle(particle, width, height);
          } else {
            this.particles.splice(i, 1);
            i--;
          }
        }
      }
    });
    this.options = _objectSpread(_objectSpread({}, DefaultOptions), options);
  }

}

exports.default = Confetti;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9lZmZlY3RzL2NvbmZldHRpL2luZGV4LnRzIl0sIm5hbWVzIjpbIkRlZmF1bHRPcHRpb25zIiwibWF4Q291bnQiLCJzcGVlZCIsImZyYW1lSW50ZXJ2YWwiLCJhbHBoYSIsImdyYWRpZW50IiwiQ29uZmV0dGkiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJ3aW5kb3ciLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJEYXRlIiwibm93IiwiY2FudmFzIiwidGltZW91dCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwicGFydGljbGVzIiwiY291bnQiLCJsZW5ndGgiLCJwdXNoIiwicmVzZXRQYXJ0aWNsZSIsIndpZHRoIiwiaGVpZ2h0IiwiaXNSdW5uaW5nIiwicnVuQW5pbWF0aW9uIiwic2V0VGltZW91dCIsInN0b3AiLCJwYXJ0aWNsZSIsImNvbG9yIiwiY29sb3JzIiwiTWF0aCIsInJhbmRvbSIsImNvbG9yMiIsIngiLCJ5IiwiZGlhbWV0ZXIiLCJ0aWx0IiwidGlsdEFuZ2xlSW5jcmVtZW50IiwidGlsdEFuZ2xlIiwiUEkiLCJjbGVhclJlY3QiLCJkZWx0YSIsImxhc3RGcmFtZVRpbWUiLCJzdXBwb3J0c0FuaW1hdGlvbkZyYW1lIiwidXBkYXRlUGFydGljbGVzIiwiZHJhd1BhcnRpY2xlcyIsIngyIiwieTIiLCJiZWdpblBhdGgiLCJsaW5lV2lkdGgiLCJjcmVhdGVMaW5lYXJHcmFkaWVudCIsImFkZENvbG9yU3RvcCIsInN0cm9rZVN0eWxlIiwibW92ZVRvIiwibGluZVRvIiwic3Ryb2tlIiwid2F2ZUFuZ2xlIiwiaSIsInNpbiIsImNvcyIsInNwbGljZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFxQ08sTUFBTUEsY0FBK0IsR0FBRztBQUMzQ0MsRUFBQUEsUUFBUSxFQUFF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QUM0QixHQUFMLENBQVMsS0FBS0YsU0FBZCxJQUEyQixHQUF6QztBQUNBN0IsVUFBQUEsUUFBUSxDQUFDTyxDQUFULElBQWMsQ0FBQ0osSUFBSSxDQUFDNkIsR0FBTCxDQUFTLEtBQUtILFNBQWQsSUFBMkI3QixRQUFRLENBQUNRLFFBQXBDLEdBQStDLEtBQUs1QixPQUFMLENBQWFOLEtBQTdELElBQXNFLEdBQXBGO0FBQ0EwQixVQUFBQSxRQUFRLENBQUNTLElBQVQsR0FBZ0JOLElBQUksQ0FBQzRCLEdBQUwsQ0FBUy9CLFFBQVEsQ0FBQ1csU0FBbEIsSUFBK0IsRUFBL0M7QUFDSDs7QUFDRCxZQUFJWCxRQUFRLENBQUNNLENBQVQsR0FBYVosS0FBSyxHQUFHLEVBQXJCLElBQTJCTSxRQUFRLENBQUNNLENBQVQsR0FBYSxDQUFDLEVBQXpDLElBQStDTixRQUFRLENBQUNPLENBQVQsR0FBYVosTUFBaEUsRUFBd0U7QUFDcEUsY0FBSSxLQUFLQyxTQUFMLElBQWtCLEtBQUtQLFNBQUwsQ0FBZUUsTUFBZixJQUF5QixLQUFLWCxPQUFMLENBQWFQLFFBQTVELEVBQXNFO0FBQ2xFLGlCQUFLb0IsYUFBTCxDQUFtQk8sUUFBbkIsRUFBNkJOLEtBQTdCLEVBQW9DQyxNQUFwQztBQUNILFdBRkQsTUFFTztBQUNILGlCQUFLTixTQUFMLENBQWU0QyxNQUFmLENBQXNCSCxDQUF0QixFQUF5QixDQUF6QjtBQUNBQSxZQUFBQSxDQUFDO0FBQ0o7QUFDSjtBQUNKO0FBQ0osS0E3SDRDO0FBQ3pDLFNBQUtsRCxPQUFMLG1DQUFvQlIsY0FBcEIsR0FBdUNRLE9BQXZDO0FBQ0g7O0FBTGtEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiBDb3B5cmlnaHQgMjAyMCBOdXJqaW4gSmFmYXJcbiBDb3B5cmlnaHQgMjAyMCBOb3JkZWNrIElUICsgQ29uc3VsdGluZyBHbWJILlxuXG4gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgSUNhbnZhc0VmZmVjdCBmcm9tICcuLi9JQ2FudmFzRWZmZWN0JztcblxuZXhwb3J0IHR5cGUgQ29uZmV0dGlPcHRpb25zID0ge1xuICAgIC8qKlxuICAgICAqIG1heCBjb25mZXR0aSBjb3VudFxuICAgICAqL1xuICAgIG1heENvdW50OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogcGFydGljbGUgYW5pbWF0aW9uIHNwZWVkXG4gICAgICovXG4gICAgc3BlZWQ6IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiB0aGUgY29uZmV0dGkgYW5pbWF0aW9uIGZyYW1lIGludGVydmFsIGluIG1pbGxpc2Vjb25kc1xuICAgICAqL1xuICAgIGZyYW1lSW50ZXJ2YWw6IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiB0aGUgYWxwaGEgb3BhY2l0eSBvZiB0aGUgY29uZmV0dGkgKGJldHdlZW4gMCBhbmQgMSwgd2hlcmUgMSBpcyBvcGFxdWUgYW5kIDAgaXMgaW52aXNpYmxlKVxuICAgICAqL1xuICAgIGFscGhhOiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogdXNlIGdyYWRpZW50IGluc3RlYWQgb2Ygc29saWQgcGFydGljbGUgY29sb3JcbiAgICAgKi9cbiAgICBncmFkaWVudDogYm9vbGVhbjtcbn07XG5cbnR5cGUgQ29uZmV0dGlQYXJ0aWNsZSA9IHtcbiAgICBjb2xvcjogc3RyaW5nO1xuICAgIGNvbG9yMjogc3RyaW5nO1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gICAgZGlhbWV0ZXI6IG51bWJlcjtcbiAgICB0aWx0OiBudW1iZXI7XG4gICAgdGlsdEFuZ2xlSW5jcmVtZW50OiBudW1iZXI7XG4gICAgdGlsdEFuZ2xlOiBudW1iZXI7XG59O1xuXG5leHBvcnQgY29uc3QgRGVmYXVsdE9wdGlvbnM6IENvbmZldHRpT3B0aW9ucyA9IHtcbiAgICBtYXhDb3VudDogMTUwLFxuICAgIHNwZWVkOiAzLFxuICAgIGZyYW1lSW50ZXJ2YWw6IDE1LFxuICAgIGFscGhhOiAxLjAsXG4gICAgZ3JhZGllbnQ6IGZhbHNlLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uZmV0dGkgaW1wbGVtZW50cyBJQ2FudmFzRWZmZWN0IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IG9wdGlvbnM6IENvbmZldHRpT3B0aW9ucztcblxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IHsgW2tleTogc3RyaW5nXTogYW55IH0pIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0geyAuLi5EZWZhdWx0T3B0aW9ucywgLi4ub3B0aW9ucyB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIHwgbnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSBzdXBwb3J0c0FuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTtcbiAgICBwcml2YXRlIGNvbG9ycyA9IFsncmdiYSgzMCwxNDQsMjU1LCcsICdyZ2JhKDEwNywxNDIsMzUsJywgJ3JnYmEoMjU1LDIxNSwwLCcsXG4gICAgICAgICdyZ2JhKDI1NSwxOTIsMjAzLCcsICdyZ2JhKDEwNiw5MCwyMDUsJywgJ3JnYmEoMTczLDIxNiwyMzAsJyxcbiAgICAgICAgJ3JnYmEoMjM4LDEzMCwyMzgsJywgJ3JnYmEoMTUyLDI1MSwxNTIsJywgJ3JnYmEoNzAsMTMwLDE4MCwnLFxuICAgICAgICAncmdiYSgyNDQsMTY0LDk2LCcsICdyZ2JhKDIxMCwxMDUsMzAsJywgJ3JnYmEoMjIwLDIwLDYwLCddO1xuXG4gICAgcHJpdmF0ZSBsYXN0RnJhbWVUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBwcml2YXRlIHBhcnRpY2xlczogQXJyYXk8Q29uZmV0dGlQYXJ0aWNsZT4gPSBbXTtcbiAgICBwcml2YXRlIHdhdmVBbmdsZSA9IDA7XG5cbiAgICBwdWJsaWMgaXNSdW5uaW5nOiBib29sZWFuO1xuXG4gICAgcHVibGljIHN0YXJ0ID0gYXN5bmMgKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsIHRpbWVvdXQgPSAzMDAwKSA9PiB7XG4gICAgICAgIGlmICghY2FudmFzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIHRoaXMucGFydGljbGVzID0gW107XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5vcHRpb25zLm1heENvdW50O1xuICAgICAgICB3aGlsZSAodGhpcy5wYXJ0aWNsZXMubGVuZ3RoIDwgY291bnQpIHtcbiAgICAgICAgICAgIHRoaXMucGFydGljbGVzLnB1c2godGhpcy5yZXNldFBhcnRpY2xlKHt9IGFzIENvbmZldHRpUGFydGljbGUsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNSdW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ydW5BbmltYXRpb24oKTtcbiAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KHRoaXMuc3RvcCwgdGltZW91dCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHVibGljIHN0b3AgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVzZXRQYXJ0aWNsZSA9IChwYXJ0aWNsZTogQ29uZmV0dGlQYXJ0aWNsZSwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBDb25mZXR0aVBhcnRpY2xlID0+IHtcbiAgICAgICAgcGFydGljbGUuY29sb3IgPSB0aGlzLmNvbG9yc1soTWF0aC5yYW5kb20oKSAqIHRoaXMuY29sb3JzLmxlbmd0aCkgfCAwXSArICh0aGlzLm9wdGlvbnMuYWxwaGEgKyAnKScpO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmdyYWRpZW50KSB7XG4gICAgICAgICAgICBwYXJ0aWNsZS5jb2xvcjIgPSB0aGlzLmNvbG9yc1soTWF0aC5yYW5kb20oKSAqIHRoaXMuY29sb3JzLmxlbmd0aCkgfCAwXSArICh0aGlzLm9wdGlvbnMuYWxwaGEgKyAnKScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFydGljbGUuY29sb3IyID0gcGFydGljbGUuY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgcGFydGljbGUueCA9IE1hdGgucmFuZG9tKCkgKiB3aWR0aDtcbiAgICAgICAgcGFydGljbGUueSA9IE1hdGgucmFuZG9tKCkgKiAtaGVpZ2h0O1xuICAgICAgICBwYXJ0aWNsZS5kaWFtZXRlciA9IE1hdGgucmFuZG9tKCkgKiAxMCArIDU7XG4gICAgICAgIHBhcnRpY2xlLnRpbHQgPSBNYXRoLnJhbmRvbSgpICogLTEwO1xuICAgICAgICBwYXJ0aWNsZS50aWx0QW5nbGVJbmNyZW1lbnQgPSBNYXRoLnJhbmRvbSgpICogMC4wNyArIDAuMDU7XG4gICAgICAgIHBhcnRpY2xlLnRpbHRBbmdsZSA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJO1xuICAgICAgICByZXR1cm4gcGFydGljbGU7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcnVuQW5pbWF0aW9uID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuY29udGV4dCB8fCAhdGhpcy5jb250ZXh0LmNhbnZhcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhcnRpY2xlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jb250ZXh0LmNhbnZhcy53aWR0aCwgdGhpcy5jb250ZXh0LmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gbm93IC0gdGhpcy5sYXN0RnJhbWVUaW1lO1xuICAgICAgICAgICAgaWYgKCF0aGlzLnN1cHBvcnRzQW5pbWF0aW9uRnJhbWUgfHwgZGVsdGEgPiB0aGlzLm9wdGlvbnMuZnJhbWVJbnRlcnZhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jb250ZXh0LmNhbnZhcy53aWR0aCwgdGhpcy5jb250ZXh0LmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUGFydGljbGVzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3UGFydGljbGVzKHRoaXMuY29udGV4dCk7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0RnJhbWVUaW1lID0gbm93IC0gKGRlbHRhICUgdGhpcy5vcHRpb25zLmZyYW1lSW50ZXJ2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucnVuQW5pbWF0aW9uKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGRyYXdQYXJ0aWNsZXMgPSAoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTogdm9pZCA9PiB7XG4gICAgICAgIGlmICghdGhpcy5jb250ZXh0IHx8ICF0aGlzLmNvbnRleHQuY2FudmFzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHg7IGxldCB4MjsgbGV0IHkyO1xuICAgICAgICBmb3IgKGNvbnN0IHBhcnRpY2xlIG9mIHRoaXMucGFydGljbGVzKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IHBhcnRpY2xlLmRpYW1ldGVyO1xuICAgICAgICAgICAgeDIgPSBwYXJ0aWNsZS54ICsgcGFydGljbGUudGlsdDtcbiAgICAgICAgICAgIHggPSB4MiArIHBhcnRpY2xlLmRpYW1ldGVyIC8gMjtcbiAgICAgICAgICAgIHkyID0gcGFydGljbGUueSArIHBhcnRpY2xlLnRpbHQgKyBwYXJ0aWNsZS5kaWFtZXRlciAvIDI7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmdyYWRpZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZ3JhZGllbnQgPSBjb250ZXh0LmNyZWF0ZUxpbmVhckdyYWRpZW50KHgsIHBhcnRpY2xlLnksIHgyLCB5Mik7XG4gICAgICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIHBhcnRpY2xlLmNvbG9yKTtcbiAgICAgICAgICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMS4wLCBwYXJ0aWNsZS5jb2xvcjIpO1xuICAgICAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBncmFkaWVudDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IHBhcnRpY2xlLmNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udGV4dC5tb3ZlVG8oeCwgcGFydGljbGUueSk7XG4gICAgICAgICAgICBjb250ZXh0LmxpbmVUbyh4MiwgeTIpO1xuICAgICAgICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIHVwZGF0ZVBhcnRpY2xlcyA9ICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRleHQgfHwgIXRoaXMuY29udGV4dC5jYW52YXMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuY29udGV4dC5jYW52YXMud2lkdGg7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuY29udGV4dC5jYW52YXMuaGVpZ2h0O1xuICAgICAgICBsZXQgcGFydGljbGU6IENvbmZldHRpUGFydGljbGU7XG4gICAgICAgIHRoaXMud2F2ZUFuZ2xlICs9IDAuMDE7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJ0aWNsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHBhcnRpY2xlID0gdGhpcy5wYXJ0aWNsZXNbaV07XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNSdW5uaW5nICYmIHBhcnRpY2xlLnkgPCAtMTUpIHtcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS55ID0gaGVpZ2h0ICsgMTAwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS50aWx0QW5nbGUgKz0gcGFydGljbGUudGlsdEFuZ2xlSW5jcmVtZW50O1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnggKz0gTWF0aC5zaW4odGhpcy53YXZlQW5nbGUpIC0gMC41O1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnkgKz0gKE1hdGguY29zKHRoaXMud2F2ZUFuZ2xlKSArIHBhcnRpY2xlLmRpYW1ldGVyICsgdGhpcy5vcHRpb25zLnNwZWVkKSAqIDAuNTtcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS50aWx0ID0gTWF0aC5zaW4ocGFydGljbGUudGlsdEFuZ2xlKSAqIDE1O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnggPiB3aWR0aCArIDIwIHx8IHBhcnRpY2xlLnggPCAtMjAgfHwgcGFydGljbGUueSA+IGhlaWdodCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUnVubmluZyAmJiB0aGlzLnBhcnRpY2xlcy5sZW5ndGggPD0gdGhpcy5vcHRpb25zLm1heENvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXRQYXJ0aWNsZShwYXJ0aWNsZSwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJ0aWNsZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICBpLS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn1cbiJdfQ==