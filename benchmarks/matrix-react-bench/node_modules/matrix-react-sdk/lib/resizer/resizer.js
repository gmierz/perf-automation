"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _lodash = require("lodash");

/*
Copyright 2018 - 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class Resizer {
  // TODO move vertical/horizontal to config option/container class
  // as it doesn't make sense to mix them within one container/Resizer
  constructor(container, distributorCtor, config) {
    this.container = container;
    this.distributorCtor = distributorCtor;
    this.config = config;
    (0, _defineProperty2.default)(this, "classNames", void 0);
    (0, _defineProperty2.default)(this, "onMouseDown", event => {
      var _this$config;

      // use closest in case the resize handle contains
      // child dom nodes that can be the target
      const resizeHandle = event.target && event.target.closest(`.${this.classNames.handle}`);
      const hasHandler = this === null || this === void 0 ? void 0 : (_this$config = this.config) === null || _this$config === void 0 ? void 0 : _this$config.handler; // prevent that stacked resizer's are both activated with one mouse event
      // (this is possible because the mouse events are connected to the containers not the handles)

      if (!resizeHandle || // if no resizeHandle exist / mouse event hit the container not the handle
      !hasHandler && resizeHandle.parentElement !== this.container || // no handler from config -> check if the containers match
      hasHandler && resizeHandle !== hasHandler) {
        // handler from config -> check if the handlers match
        return;
      } // prevent starting a drag operation


      event.preventDefault(); // mark as currently resizing

      if (this.classNames.resizing) {
        var _this$container, _this$container$class;

        (_this$container = this.container) === null || _this$container === void 0 ? void 0 : (_this$container$class = _this$container.classList) === null || _this$container$class === void 0 ? void 0 : _this$container$class.add(this.classNames.resizing);
      }

      if (this.config.onResizeStart) {
        this.config.onResizeStart();
      }

      const {
        sizer,
        distributor
      } = this.createSizerAndDistributor(resizeHandle);
      distributor.start();

      const onMouseMove = event => {
        const offset = sizer.offsetFromEvent(event);
        distributor.resizeFromContainerOffset(offset);
      };

      const body = document.body;

      const finishResize = () => {
        if (this.classNames.resizing) {
          var _this$container2, _this$container2$clas;

          (_this$container2 = this.container) === null || _this$container2 === void 0 ? void 0 : (_this$container2$clas = _this$container2.classList) === null || _this$container2$clas === void 0 ? void 0 : _this$container2$clas.remove(this.classNames.resizing);
        }

        distributor.finish();

        if (this.config.onResizeStop) {
          this.config.onResizeStop();
        }

        body.removeEventListener("mouseup", finishResize, false);
        document.removeEventListener("mouseleave", finishResize, false);
        body.removeEventListener("mousemove", onMouseMove, false);
      };

      body.addEventListener("mouseup", finishResize, false);
      document.addEventListener("mouseleave", finishResize, false);
      body.addEventListener("mousemove", onMouseMove, false);
    });
    (0, _defineProperty2.default)(this, "onResize", (0, _lodash.throttle)(() => {
      const distributors = this.getDistributors(); // relax all items if they had any overconstrained flexboxes

      distributors.forEach(d => d.start());
      distributors.forEach(d => d.finish());
    }, 100, {
      trailing: true,
      leading: true
    }));
    (0, _defineProperty2.default)(this, "getDistributors", () => {
      return this.getResizeHandles().map(handle => {
        const {
          distributor
        } = this.createSizerAndDistributor(handle);
        return distributor;
      });
    });
    this.classNames = {
      handle: "resizer-handle",
      reverse: "resizer-reverse",
      vertical: "resizer-vertical",
      resizing: "resizer-resizing"
    };
  }

  setClassNames(classNames) {
    this.classNames = classNames;
  }

  attach() {
    var _this$config2, _this$config2$handler;

    const attachment = (this === null || this === void 0 ? void 0 : (_this$config2 = this.config) === null || _this$config2 === void 0 ? void 0 : (_this$config2$handler = _this$config2.handler) === null || _this$config2$handler === void 0 ? void 0 : _this$config2$handler.parentElement) ?? this.container;
    attachment.addEventListener("mousedown", this.onMouseDown, false);
    window.addEventListener("resize", this.onResize);
  }

  detach() {
    var _this$config3, _this$config3$handler;

    const attachment = (this === null || this === void 0 ? void 0 : (_this$config3 = this.config) === null || _this$config3 === void 0 ? void 0 : (_this$config3$handler = _this$config3.handler) === null || _this$config3$handler === void 0 ? void 0 : _this$config3$handler.parentElement) ?? this.container;
    attachment.removeEventListener("mousedown", this.onMouseDown, false);
    window.removeEventListener("resize", this.onResize);
  }
  /**
  Gives the distributor for a specific resize handle, as if you would have started
  to drag that handle. Can be used to manipulate the size of an item programmatically.
  @param {number} handleIndex the index of the resize handle in the container
  @return {FixedDistributor} a new distributor for the given handle
  */


  forHandleAt(handleIndex) {
    const handles = this.getResizeHandles();
    const handle = handles[handleIndex];

    if (handle) {
      const {
        distributor
      } = this.createSizerAndDistributor(handle);
      return distributor;
    }
  }

  forHandleWithId(id) {
    const handles = this.getResizeHandles();
    const handle = handles.find(h => h.getAttribute("data-id") === id);

    if (handle) {
      const {
        distributor
      } = this.createSizerAndDistributor(handle);
      return distributor;
    }
  }

  isReverseResizeHandle(el) {
    return el && el.classList.contains(this.classNames.reverse);
  }

  isResizeHandle(el) {
    return el && el.classList.contains(this.classNames.handle);
  }

  createSizerAndDistributor(resizeHandle) {
    const vertical = resizeHandle.classList.contains(this.classNames.vertical);
    const reverse = this.isReverseResizeHandle(resizeHandle);
    const Distributor = this.distributorCtor;
    const useItemContainer = this.config && this.config.handler ? this.container : undefined;
    const sizer = Distributor.createSizer(this.container, vertical, reverse);
    const item = Distributor.createItem(resizeHandle, this, sizer, useItemContainer);
    const distributor = new Distributor(item);
    return {
      sizer,
      distributor
    };
  }

  getResizeHandles() {
    var _this$config4, _this$container3;

    if (this !== null && this !== void 0 && (_this$config4 = this.config) !== null && _this$config4 !== void 0 && _this$config4.handler) {
      return [this.config.handler];
    }

    if (!((_this$container3 = this.container) !== null && _this$container3 !== void 0 && _this$container3.children)) return [];
    return Array.from(this.container.querySelectorAll(`.${this.classNames.handle}`));
  }

}

exports.default = Resizer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZXNpemVyL3Jlc2l6ZXIudHMiXSwibmFtZXMiOlsiUmVzaXplciIsImNvbnN0cnVjdG9yIiwiY29udGFpbmVyIiwiZGlzdHJpYnV0b3JDdG9yIiwiY29uZmlnIiwiZXZlbnQiLCJyZXNpemVIYW5kbGUiLCJ0YXJnZXQiLCJjbG9zZXN0IiwiY2xhc3NOYW1lcyIsImhhbmRsZSIsImhhc0hhbmRsZXIiLCJoYW5kbGVyIiwicGFyZW50RWxlbWVudCIsInByZXZlbnREZWZhdWx0IiwicmVzaXppbmciLCJjbGFzc0xpc3QiLCJhZGQiLCJvblJlc2l6ZVN0YXJ0Iiwic2l6ZXIiLCJkaXN0cmlidXRvciIsImNyZWF0ZVNpemVyQW5kRGlzdHJpYnV0b3IiLCJzdGFydCIsIm9uTW91c2VNb3ZlIiwib2Zmc2V0Iiwib2Zmc2V0RnJvbUV2ZW50IiwicmVzaXplRnJvbUNvbnRhaW5lck9mZnNldCIsImJvZHkiLCJkb2N1bWVudCIsImZpbmlzaFJlc2l6ZSIsInJlbW92ZSIsImZpbmlzaCIsIm9uUmVzaXplU3RvcCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiZGlzdHJpYnV0b3JzIiwiZ2V0RGlzdHJpYnV0b3JzIiwiZm9yRWFjaCIsImQiLCJ0cmFpbGluZyIsImxlYWRpbmciLCJnZXRSZXNpemVIYW5kbGVzIiwibWFwIiwicmV2ZXJzZSIsInZlcnRpY2FsIiwic2V0Q2xhc3NOYW1lcyIsImF0dGFjaCIsImF0dGFjaG1lbnQiLCJvbk1vdXNlRG93biIsIndpbmRvdyIsIm9uUmVzaXplIiwiZGV0YWNoIiwiZm9ySGFuZGxlQXQiLCJoYW5kbGVJbmRleCIsImhhbmRsZXMiLCJmb3JIYW5kbGVXaXRoSWQiLCJpZCIsImZpbmQiLCJoIiwiZ2V0QXR0cmlidXRlIiwiaXNSZXZlcnNlUmVzaXplSGFuZGxlIiwiZWwiLCJjb250YWlucyIsImlzUmVzaXplSGFuZGxlIiwiRGlzdHJpYnV0b3IiLCJ1c2VJdGVtQ29udGFpbmVyIiwidW5kZWZpbmVkIiwiY3JlYXRlU2l6ZXIiLCJpdGVtIiwiY3JlYXRlSXRlbSIsImNoaWxkcmVuIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTBCZSxNQUFNQSxPQUFOLENBQTJDO0FBR3REO0FBQ0E7QUFDQUMsRUFBQUEsV0FBVyxDQUNBQyxTQURBLEVBRVVDLGVBRlYsRUFnQlNDLE1BaEJULEVBaUJUO0FBQUEsU0FoQlNGLFNBZ0JULEdBaEJTQSxTQWdCVDtBQUFBLFNBZm1CQyxlQWVuQixHQWZtQkEsZUFlbkI7QUFBQSxTQURrQkMsTUFDbEIsR0FEa0JBLE1BQ2xCO0FBQUE7QUFBQSx1REF5RHFCQyxLQUFELElBQXVCO0FBQUE7O0FBQ3pDO0FBQ0E7QUFDQSxZQUFNQyxZQUFZLEdBQUdELEtBQUssQ0FBQ0UsTUFBTixJQUFpQ0YsS0FBSyxDQUFDRSxNQUF2QixDQUErQkMsT0FBL0IsQ0FBd0MsSUFBRyxLQUFLQyxVQUFMLENBQWdCQyxNQUFPLEVBQWxFLENBQXJDO0FBQ0EsWUFBTUMsVUFBVSxHQUFHLElBQUgsYUFBRyxJQUFILHVDQUFHLEtBQU1QLE1BQVQsaURBQUcsYUFBY1EsT0FBakMsQ0FKeUMsQ0FLekM7QUFDQTs7QUFDQSxVQUFJLENBQUNOLFlBQUQsSUFBaUI7QUFDaEIsT0FBQ0ssVUFBRCxJQUFlTCxZQUFZLENBQUNPLGFBQWIsS0FBK0IsS0FBS1gsU0FEcEQsSUFDa0U7QUFDakVTLE1BQUFBLFVBQVUsSUFBSUwsWUFBWSxLQUFLSyxVQUZwQyxFQUVpRDtBQUFFO0FBQy9DO0FBQ0gsT0FYd0MsQ0FhekM7OztBQUNBTixNQUFBQSxLQUFLLENBQUNTLGNBQU4sR0FkeUMsQ0FnQnpDOztBQUNBLFVBQUksS0FBS0wsVUFBTCxDQUFnQk0sUUFBcEIsRUFBOEI7QUFBQTs7QUFDMUIs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QUFxQyxJQUFyQyxFQUEyQ2EsS0FBM0MsRUFBa0Q4QyxnQkFBbEQsQ0FBYjtBQUNBLFVBQU03QyxXQUFXLEdBQUcsSUFBSTRDLFdBQUosQ0FBZ0JJLElBQWhCLENBQXBCO0FBQ0EsV0FBTztBQUFFakQsTUFBQUEsS0FBRjtBQUFTQyxNQUFBQTtBQUFULEtBQVA7QUFDSDs7QUFFT3FCLEVBQUFBLGdCQUFnQixHQUFHO0FBQUE7O0FBQ3ZCLFFBQUksSUFBSixhQUFJLElBQUosZ0NBQUksS0FBTXJDLE1BQVYsMENBQUksY0FBY1EsT0FBbEIsRUFBMkI7QUFDdkIsYUFBTyxDQUFDLEtBQUtSLE1BQUwsQ0FBWVEsT0FBYixDQUFQO0FBQ0g7O0FBQ0QsUUFBSSxzQkFBQyxLQUFLVixTQUFOLDZDQUFDLGlCQUFnQm9FLFFBQWpCLENBQUosRUFBK0IsT0FBTyxFQUFQO0FBQy9CLFdBQU9DLEtBQUssQ0FBQ0MsSUFBTixDQUFXLEtBQUt0RSxTQUFMLENBQWV1RSxnQkFBZixDQUFpQyxJQUFHLEtBQUtoRSxVQUFMLENBQWdCQyxNQUFPLEVBQTNELENBQVgsQ0FBUDtBQUNIOztBQW5LcUQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTggLSAyMDIwIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHsgdGhyb3R0bGUgfSBmcm9tIFwibG9kYXNoXCI7XG5cbmltcG9ydCBGaXhlZERpc3RyaWJ1dG9yIGZyb20gXCIuL2Rpc3RyaWJ1dG9ycy9maXhlZFwiO1xuaW1wb3J0IFJlc2l6ZUl0ZW0gZnJvbSBcIi4vaXRlbVwiO1xuaW1wb3J0IFNpemVyIGZyb20gXCIuL3NpemVyXCI7XG5cbmludGVyZmFjZSBJQ2xhc3NOYW1lcyB7XG4gICAgLy8gY2xhc3Mgb24gcmVzaXplLWhhbmRsZVxuICAgIGhhbmRsZT86IHN0cmluZztcbiAgICAvLyBjbGFzcyBvbiByZXNpemUtaGFuZGxlXG4gICAgcmV2ZXJzZT86IHN0cmluZztcbiAgICAvLyBjbGFzcyBvbiByZXNpemUtaGFuZGxlXG4gICAgdmVydGljYWw/OiBzdHJpbmc7XG4gICAgLy8gY2xhc3Mgb24gY29udGFpbmVyXG4gICAgcmVzaXppbmc/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbmZpZyB7XG4gICAgb25SZXNpemVTdGFydD8oKTogdm9pZDtcbiAgICBvblJlc2l6ZVN0b3A/KCk6IHZvaWQ7XG4gICAgb25SZXNpemVkPyhzaXplOiBudW1iZXIsIGlkOiBzdHJpbmcsIGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogdm9pZDtcbiAgICBoYW5kbGVyPzogSFRNTERpdkVsZW1lbnQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlc2l6ZXI8QyBleHRlbmRzIElDb25maWcgPSBJQ29uZmlnPiB7XG4gICAgcHJpdmF0ZSBjbGFzc05hbWVzOiBJQ2xhc3NOYW1lcztcblxuICAgIC8vIFRPRE8gbW92ZSB2ZXJ0aWNhbC9ob3Jpem9udGFsIHRvIGNvbmZpZyBvcHRpb24vY29udGFpbmVyIGNsYXNzXG4gICAgLy8gYXMgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIG1peCB0aGVtIHdpdGhpbiBvbmUgY29udGFpbmVyL1Jlc2l6ZXJcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHVibGljIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgZGlzdHJpYnV0b3JDdG9yOiB7XG4gICAgICAgICAgICBuZXcoaXRlbTogUmVzaXplSXRlbSk6IEZpeGVkRGlzdHJpYnV0b3I8QywgYW55PjtcbiAgICAgICAgICAgIGNyZWF0ZUl0ZW0oXG4gICAgICAgICAgICAgICAgcmVzaXplSGFuZGxlOiBIVE1MRGl2RWxlbWVudCxcbiAgICAgICAgICAgICAgICByZXNpemVyOiBSZXNpemVyLFxuICAgICAgICAgICAgICAgIHNpemVyOiBTaXplcixcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IEhUTUxFbGVtZW50XG4gICAgICAgICAgICApOiBSZXNpemVJdGVtO1xuICAgICAgICAgICAgY3JlYXRlU2l6ZXIoXG4gICAgICAgICAgICAgICAgY29udGFpbmVyRWxlbWVudDogSFRNTEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgdmVydGljYWw6IGJvb2xlYW4sXG4gICAgICAgICAgICAgICAgcmV2ZXJzZTogYm9vbGVhblxuICAgICAgICAgICAgKTogU2l6ZXI7XG4gICAgICAgIH0sXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBjb25maWc/OiBDLFxuICAgICkge1xuICAgICAgICB0aGlzLmNsYXNzTmFtZXMgPSB7XG4gICAgICAgICAgICBoYW5kbGU6IFwicmVzaXplci1oYW5kbGVcIixcbiAgICAgICAgICAgIHJldmVyc2U6IFwicmVzaXplci1yZXZlcnNlXCIsXG4gICAgICAgICAgICB2ZXJ0aWNhbDogXCJyZXNpemVyLXZlcnRpY2FsXCIsXG4gICAgICAgICAgICByZXNpemluZzogXCJyZXNpemVyLXJlc2l6aW5nXCIsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIHNldENsYXNzTmFtZXMoY2xhc3NOYW1lczogSUNsYXNzTmFtZXMpIHtcbiAgICAgICAgdGhpcy5jbGFzc05hbWVzID0gY2xhc3NOYW1lcztcbiAgICB9XG5cbiAgICBwdWJsaWMgYXR0YWNoKCkge1xuICAgICAgICBjb25zdCBhdHRhY2htZW50ID0gdGhpcz8uY29uZmlnPy5oYW5kbGVyPy5wYXJlbnRFbGVtZW50ID8/IHRoaXMuY29udGFpbmVyO1xuICAgICAgICBhdHRhY2htZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5vbk1vdXNlRG93biwgZmFsc2UpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLm9uUmVzaXplKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZGV0YWNoKCkge1xuICAgICAgICBjb25zdCBhdHRhY2htZW50ID0gdGhpcz8uY29uZmlnPy5oYW5kbGVyPy5wYXJlbnRFbGVtZW50ID8/IHRoaXMuY29udGFpbmVyO1xuICAgICAgICBhdHRhY2htZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5vbk1vdXNlRG93biwgZmFsc2UpO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLm9uUmVzaXplKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICBHaXZlcyB0aGUgZGlzdHJpYnV0b3IgZm9yIGEgc3BlY2lmaWMgcmVzaXplIGhhbmRsZSwgYXMgaWYgeW91IHdvdWxkIGhhdmUgc3RhcnRlZFxuICAgIHRvIGRyYWcgdGhhdCBoYW5kbGUuIENhbiBiZSB1c2VkIHRvIG1hbmlwdWxhdGUgdGhlIHNpemUgb2YgYW4gaXRlbSBwcm9ncmFtbWF0aWNhbGx5LlxuICAgIEBwYXJhbSB7bnVtYmVyfSBoYW5kbGVJbmRleCB0aGUgaW5kZXggb2YgdGhlIHJlc2l6ZSBoYW5kbGUgaW4gdGhlIGNvbnRhaW5lclxuICAgIEByZXR1cm4ge0ZpeGVkRGlzdHJpYnV0b3J9IGEgbmV3IGRpc3RyaWJ1dG9yIGZvciB0aGUgZ2l2ZW4gaGFuZGxlXG4gICAgKi9cbiAgICBwdWJsaWMgZm9ySGFuZGxlQXQoaGFuZGxlSW5kZXg6IG51bWJlcik6IEZpeGVkRGlzdHJpYnV0b3I8Qz4ge1xuICAgICAgICBjb25zdCBoYW5kbGVzID0gdGhpcy5nZXRSZXNpemVIYW5kbGVzKCk7XG4gICAgICAgIGNvbnN0IGhhbmRsZSA9IGhhbmRsZXNbaGFuZGxlSW5kZXhdO1xuICAgICAgICBpZiAoaGFuZGxlKSB7XG4gICAgICAgICAgICBjb25zdCB7IGRpc3RyaWJ1dG9yIH0gPSB0aGlzLmNyZWF0ZVNpemVyQW5kRGlzdHJpYnV0b3IoPEhUTUxEaXZFbGVtZW50PmhhbmRsZSk7XG4gICAgICAgICAgICByZXR1cm4gZGlzdHJpYnV0b3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZm9ySGFuZGxlV2l0aElkKGlkOiBzdHJpbmcpOiBGaXhlZERpc3RyaWJ1dG9yPEM+IHtcbiAgICAgICAgY29uc3QgaGFuZGxlcyA9IHRoaXMuZ2V0UmVzaXplSGFuZGxlcygpO1xuICAgICAgICBjb25zdCBoYW5kbGUgPSBoYW5kbGVzLmZpbmQoKGgpID0+IGguZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKSA9PT0gaWQpO1xuICAgICAgICBpZiAoaGFuZGxlKSB7XG4gICAgICAgICAgICBjb25zdCB7IGRpc3RyaWJ1dG9yIH0gPSB0aGlzLmNyZWF0ZVNpemVyQW5kRGlzdHJpYnV0b3IoPEhUTUxEaXZFbGVtZW50PmhhbmRsZSk7XG4gICAgICAgICAgICByZXR1cm4gZGlzdHJpYnV0b3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgaXNSZXZlcnNlUmVzaXplSGFuZGxlKGVsOiBIVE1MRWxlbWVudCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gZWwgJiYgZWwuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuY2xhc3NOYW1lcy5yZXZlcnNlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNSZXNpemVIYW5kbGUoZWw6IEhUTUxFbGVtZW50KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBlbCAmJiBlbC5jbGFzc0xpc3QuY29udGFpbnModGhpcy5jbGFzc05hbWVzLmhhbmRsZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbk1vdXNlRG93biA9IChldmVudDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAvLyB1c2UgY2xvc2VzdCBpbiBjYXNlIHRoZSByZXNpemUgaGFuZGxlIGNvbnRhaW5zXG4gICAgICAgIC8vIGNoaWxkIGRvbSBub2RlcyB0aGF0IGNhbiBiZSB0aGUgdGFyZ2V0XG4gICAgICAgIGNvbnN0IHJlc2l6ZUhhbmRsZSA9IGV2ZW50LnRhcmdldCAmJiAoPEhUTUxEaXZFbGVtZW50PmV2ZW50LnRhcmdldCkuY2xvc2VzdChgLiR7dGhpcy5jbGFzc05hbWVzLmhhbmRsZX1gKTtcbiAgICAgICAgY29uc3QgaGFzSGFuZGxlciA9IHRoaXM/LmNvbmZpZz8uaGFuZGxlcjtcbiAgICAgICAgLy8gcHJldmVudCB0aGF0IHN0YWNrZWQgcmVzaXplcidzIGFyZSBib3RoIGFjdGl2YXRlZCB3aXRoIG9uZSBtb3VzZSBldmVudFxuICAgICAgICAvLyAodGhpcyBpcyBwb3NzaWJsZSBiZWNhdXNlIHRoZSBtb3VzZSBldmVudHMgYXJlIGNvbm5lY3RlZCB0byB0aGUgY29udGFpbmVycyBub3QgdGhlIGhhbmRsZXMpXG4gICAgICAgIGlmICghcmVzaXplSGFuZGxlIHx8IC8vIGlmIG5vIHJlc2l6ZUhhbmRsZSBleGlzdCAvIG1vdXNlIGV2ZW50IGhpdCB0aGUgY29udGFpbmVyIG5vdCB0aGUgaGFuZGxlXG4gICAgICAgICAgICAoIWhhc0hhbmRsZXIgJiYgcmVzaXplSGFuZGxlLnBhcmVudEVsZW1lbnQgIT09IHRoaXMuY29udGFpbmVyKSB8fCAvLyBubyBoYW5kbGVyIGZyb20gY29uZmlnIC0+IGNoZWNrIGlmIHRoZSBjb250YWluZXJzIG1hdGNoXG4gICAgICAgICAgICAoaGFzSGFuZGxlciAmJiByZXNpemVIYW5kbGUgIT09IGhhc0hhbmRsZXIpKSB7IC8vIGhhbmRsZXIgZnJvbSBjb25maWcgLT4gY2hlY2sgaWYgdGhlIGhhbmRsZXJzIG1hdGNoXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBwcmV2ZW50IHN0YXJ0aW5nIGEgZHJhZyBvcGVyYXRpb25cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAvLyBtYXJrIGFzIGN1cnJlbnRseSByZXNpemluZ1xuICAgICAgICBpZiAodGhpcy5jbGFzc05hbWVzLnJlc2l6aW5nKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lcj8uY2xhc3NMaXN0Py5hZGQodGhpcy5jbGFzc05hbWVzLnJlc2l6aW5nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb25maWcub25SZXNpemVTdGFydCkge1xuICAgICAgICAgICAgdGhpcy5jb25maWcub25SZXNpemVTdGFydCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBzaXplciwgZGlzdHJpYnV0b3IgfSA9IHRoaXMuY3JlYXRlU2l6ZXJBbmREaXN0cmlidXRvcig8SFRNTERpdkVsZW1lbnQ+cmVzaXplSGFuZGxlKTtcbiAgICAgICAgZGlzdHJpYnV0b3Iuc3RhcnQoKTtcblxuICAgICAgICBjb25zdCBvbk1vdXNlTW92ZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2l6ZXIub2Zmc2V0RnJvbUV2ZW50KGV2ZW50KTtcbiAgICAgICAgICAgIGRpc3RyaWJ1dG9yLnJlc2l6ZUZyb21Db250YWluZXJPZmZzZXQob2Zmc2V0KTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTtcbiAgICAgICAgY29uc3QgZmluaXNoUmVzaXplID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lcy5yZXNpemluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyPy5jbGFzc0xpc3Q/LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMucmVzaXppbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlzdHJpYnV0b3IuZmluaXNoKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5jb25maWcub25SZXNpemVTdG9wKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcub25SZXNpemVTdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGZpbmlzaFJlc2l6ZSwgZmFsc2UpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgZmluaXNoUmVzaXplLCBmYWxzZSk7XG4gICAgICAgICAgICBib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgb25Nb3VzZU1vdmUsIGZhbHNlKTtcbiAgICAgICAgfTtcbiAgICAgICAgYm9keS5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBmaW5pc2hSZXNpemUsIGZhbHNlKTtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgZmluaXNoUmVzaXplLCBmYWxzZSk7XG4gICAgICAgIGJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBvbk1vdXNlTW92ZSwgZmFsc2UpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUmVzaXplID0gdGhyb3R0bGUoKCkgPT4ge1xuICAgICAgICBjb25zdCBkaXN0cmlidXRvcnMgPSB0aGlzLmdldERpc3RyaWJ1dG9ycygpO1xuXG4gICAgICAgIC8vIHJlbGF4IGFsbCBpdGVtcyBpZiB0aGV5IGhhZCBhbnkgb3ZlcmNvbnN0cmFpbmVkIGZsZXhib3hlc1xuICAgICAgICBkaXN0cmlidXRvcnMuZm9yRWFjaChkID0+IGQuc3RhcnQoKSk7XG4gICAgICAgIGRpc3RyaWJ1dG9ycy5mb3JFYWNoKGQgPT4gZC5maW5pc2goKSk7XG4gICAgfSwgMTAwLCB7IHRyYWlsaW5nOiB0cnVlLCBsZWFkaW5nOiB0cnVlIH0pO1xuXG4gICAgcHVibGljIGdldERpc3RyaWJ1dG9ycyA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVzaXplSGFuZGxlcygpLm1hcChoYW5kbGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBkaXN0cmlidXRvciB9ID0gdGhpcy5jcmVhdGVTaXplckFuZERpc3RyaWJ1dG9yKDxIVE1MRGl2RWxlbWVudD5oYW5kbGUpO1xuICAgICAgICAgICAgcmV0dXJuIGRpc3RyaWJ1dG9yO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjcmVhdGVTaXplckFuZERpc3RyaWJ1dG9yKFxuICAgICAgICByZXNpemVIYW5kbGU6IEhUTUxEaXZFbGVtZW50LFxuICAgICk6IHtzaXplcjogU2l6ZXIsIGRpc3RyaWJ1dG9yOiBGaXhlZERpc3RyaWJ1dG9yPGFueT59IHtcbiAgICAgICAgY29uc3QgdmVydGljYWwgPSByZXNpemVIYW5kbGUuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuY2xhc3NOYW1lcy52ZXJ0aWNhbCk7XG4gICAgICAgIGNvbnN0IHJldmVyc2UgPSB0aGlzLmlzUmV2ZXJzZVJlc2l6ZUhhbmRsZShyZXNpemVIYW5kbGUpO1xuICAgICAgICBjb25zdCBEaXN0cmlidXRvciA9IHRoaXMuZGlzdHJpYnV0b3JDdG9yO1xuICAgICAgICBjb25zdCB1c2VJdGVtQ29udGFpbmVyID0gdGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcuaGFuZGxlciA/IHRoaXMuY29udGFpbmVyIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBzaXplciA9IERpc3RyaWJ1dG9yLmNyZWF0ZVNpemVyKHRoaXMuY29udGFpbmVyLCB2ZXJ0aWNhbCwgcmV2ZXJzZSk7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBEaXN0cmlidXRvci5jcmVhdGVJdGVtKHJlc2l6ZUhhbmRsZSwgdGhpcywgc2l6ZXIsIHVzZUl0ZW1Db250YWluZXIpO1xuICAgICAgICBjb25zdCBkaXN0cmlidXRvciA9IG5ldyBEaXN0cmlidXRvcihpdGVtKTtcbiAgICAgICAgcmV0dXJuIHsgc2l6ZXIsIGRpc3RyaWJ1dG9yIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRSZXNpemVIYW5kbGVzKCkge1xuICAgICAgICBpZiAodGhpcz8uY29uZmlnPy5oYW5kbGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gW3RoaXMuY29uZmlnLmhhbmRsZXJdO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5jb250YWluZXI/LmNoaWxkcmVuKSByZXR1cm4gW107XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke3RoaXMuY2xhc3NOYW1lcy5oYW5kbGV9YCkpIGFzIEhUTUxFbGVtZW50W107XG4gICAgfVxufVxuIl19