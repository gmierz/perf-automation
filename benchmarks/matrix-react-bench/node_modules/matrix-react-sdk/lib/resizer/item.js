"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

/*
Copyright 2019 - 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class ResizeItem {
  constructor(handle, resizer, sizer, container) {
    this.resizer = resizer;
    this.sizer = sizer;
    this.container = container;
    (0, _defineProperty2.default)(this, "domNode", void 0);
    (0, _defineProperty2.default)(this, "id", void 0);
    (0, _defineProperty2.default)(this, "reverse", void 0);
    this.reverse = resizer.isReverseResizeHandle(handle);

    if (container) {
      this.domNode = container;
    } else {
      this.domNode = this.reverse ? handle.nextElementSibling : handle.previousElementSibling;
    }

    this.id = handle.getAttribute("data-id");
  }

  copyWith(handle, resizer, sizer, container) {
    const Ctor = this.constructor;
    return new Ctor(handle, resizer, sizer, container);
  }

  advance(forwards) {
    // opposite direction from fromResizeHandle to get back to handle
    let handle = this.reverse ? this.domNode.previousElementSibling : this.domNode.nextElementSibling;
    const moveNext = forwards !== this.reverse; // xor
    // iterate at least once to avoid infinite loop

    do {
      if (moveNext) {
        handle = handle.nextElementSibling;
      } else {
        handle = handle.previousElementSibling;
      }
    } while (handle && !this.resizer.isResizeHandle(handle));

    if (handle) {
      const nextHandle = this.copyWith(handle, this.resizer, this.sizer);
      nextHandle.reverse = this.reverse;
      return nextHandle;
    }
  }

  next() {
    return this.advance(true);
  }

  previous() {
    return this.advance(false);
  }

  size() {
    return this.sizer.getItemSize(this.domNode);
  }

  offset() {
    return this.sizer.getItemOffset(this.domNode);
  }

  start() {
    this.sizer.start(this.domNode);
  }

  finish() {
    this.sizer.finish(this.domNode);
  }

  getSize() {
    return this.sizer.getDesiredItemSize(this.domNode);
  }

  setRawSize(size) {
    this.sizer.setItemSize(this.domNode, size);
  }

  setSize(size) {
    this.setRawSize(`${Math.round(size)}px`);
    const callback = this.resizer.config.onResized;

    if (callback) {
      callback(size, this.id, this.domNode);
    }
  }

  clearSize() {
    this.sizer.clearItemSize(this.domNode);
    const callback = this.resizer.config.onResized;

    if (callback) {
      callback(null, this.id, this.domNode);
    }
  }

  first() {
    const firstHandle = Array.from(this.domNode.parentElement.children).find(el => {
      return this.resizer.isResizeHandle(el);
    });

    if (firstHandle) {
      return this.copyWith(firstHandle, this.resizer, this.sizer);
    }
  }

  last() {
    const lastHandle = Array.from(this.domNode.parentElement.children).reverse().find(el => {
      return this.resizer.isResizeHandle(el);
    });

    if (lastHandle) {
      return this.copyWith(lastHandle, this.resizer, this.sizer);
    }
  }

}

exports.default = ResizeItem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZXNpemVyL2l0ZW0udHMiXSwibmFtZXMiOlsiUmVzaXplSXRlbSIsImNvbnN0cnVjdG9yIiwiaGFuZGxlIiwicmVzaXplciIsInNpemVyIiwiY29udGFpbmVyIiwicmV2ZXJzZSIsImlzUmV2ZXJzZVJlc2l6ZUhhbmRsZSIsImRvbU5vZGUiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwiaWQiLCJnZXRBdHRyaWJ1dGUiLCJjb3B5V2l0aCIsIkN0b3IiLCJhZHZhbmNlIiwiZm9yd2FyZHMiLCJtb3ZlTmV4dCIsImlzUmVzaXplSGFuZGxlIiwibmV4dEhhbmRsZSIsIm5leHQiLCJwcmV2aW91cyIsInNpemUiLCJnZXRJdGVtU2l6ZSIsIm9mZnNldCIsImdldEl0ZW1PZmZzZXQiLCJzdGFydCIsImZpbmlzaCIsImdldFNpemUiLCJnZXREZXNpcmVkSXRlbVNpemUiLCJzZXRSYXdTaXplIiwic2V0SXRlbVNpemUiLCJzZXRTaXplIiwiTWF0aCIsInJvdW5kIiwiY2FsbGJhY2siLCJjb25maWciLCJvblJlc2l6ZWQiLCJjbGVhclNpemUiLCJjbGVhckl0ZW1TaXplIiwiZmlyc3QiLCJmaXJzdEhhbmRsZSIsIkFycmF5IiwiZnJvbSIsInBhcmVudEVsZW1lbnQiLCJjaGlsZHJlbiIsImZpbmQiLCJlbCIsImxhc3QiLCJsYXN0SGFuZGxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtlLE1BQU1BLFVBQU4sQ0FBOEM7QUFLekRDLEVBQUFBLFdBQVcsQ0FDUEMsTUFETyxFQUVTQyxPQUZULEVBR1NDLEtBSFQsRUFJU0MsU0FKVCxFQUtUO0FBQUEsU0FIa0JGLE9BR2xCLEdBSGtCQSxPQUdsQjtBQUFBLFNBRmtCQyxLQUVsQixHQUZrQkEsS0FFbEI7QUFBQSxTQURrQkMs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ZSxjQUFiLENBQXlDNkIsRUFBekMsQ0FBUDtBQUNILEtBRmtCLENBQW5COztBQUdBLFFBQUlFLFVBQUosRUFBZ0I7QUFDWixhQUFPLEtBQUtwQyxRQUFMLENBQTJCb0MsVUFBM0IsRUFBdUMsS0FBSzlDLE9BQTVDLEVBQXFELEtBQUtDLEtBQTFELENBQVA7QUFDSDtBQUNKOztBQTdHd0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTkgLSAyMDIwIFRoZSBNYXRyaXgub3JnIEZvdW5kYXRpb24gQy5JLkMuXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlc2l6ZXIsIHsgSUNvbmZpZyB9IGZyb20gXCIuL3Jlc2l6ZXJcIjtcbmltcG9ydCBTaXplciBmcm9tIFwiLi9zaXplclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZXNpemVJdGVtPEMgZXh0ZW5kcyBJQ29uZmlnID0gSUNvbmZpZz4ge1xuICAgIHB1YmxpYyByZWFkb25seSBkb21Ob2RlOiBIVE1MRWxlbWVudDtcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgICBwcm90ZWN0ZWQgcmV2ZXJzZTogYm9vbGVhbjtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBoYW5kbGU6IEhUTUxFbGVtZW50LFxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgcmVzaXplcjogUmVzaXplcjxDPixcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IHNpemVyOiBTaXplcixcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGNvbnRhaW5lcj86IEhUTUxFbGVtZW50LFxuICAgICkge1xuICAgICAgICB0aGlzLnJldmVyc2UgPSByZXNpemVyLmlzUmV2ZXJzZVJlc2l6ZUhhbmRsZShoYW5kbGUpO1xuICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aGlzLmRvbU5vZGUgPSA8SFRNTEVsZW1lbnQ+KGNvbnRhaW5lcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRvbU5vZGUgPSA8SFRNTEVsZW1lbnQ+KHRoaXMucmV2ZXJzZSA/IGhhbmRsZS5uZXh0RWxlbWVudFNpYmxpbmcgOiBoYW5kbGUucHJldmlvdXNFbGVtZW50U2libGluZyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pZCA9IGhhbmRsZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY29weVdpdGgoaGFuZGxlOiBIVE1MRWxlbWVudCwgcmVzaXplcjogUmVzaXplciwgc2l6ZXI6IFNpemVyLCBjb250YWluZXI/OiBIVE1MRWxlbWVudCkge1xuICAgICAgICBjb25zdCBDdG9yID0gdGhpcy5jb25zdHJ1Y3RvciBhcyB0eXBlb2YgUmVzaXplSXRlbTtcbiAgICAgICAgcmV0dXJuIG5ldyBDdG9yKGhhbmRsZSwgcmVzaXplciwgc2l6ZXIsIGNvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZHZhbmNlKGZvcndhcmRzOiBib29sZWFuKSB7XG4gICAgICAgIC8vIG9wcG9zaXRlIGRpcmVjdGlvbiBmcm9tIGZyb21SZXNpemVIYW5kbGUgdG8gZ2V0IGJhY2sgdG8gaGFuZGxlXG4gICAgICAgIGxldCBoYW5kbGUgPSB0aGlzLnJldmVyc2UgPyB0aGlzLmRvbU5vZGUucHJldmlvdXNFbGVtZW50U2libGluZyA6IHRoaXMuZG9tTm9kZS5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgICAgIGNvbnN0IG1vdmVOZXh0ID0gZm9yd2FyZHMgIT09IHRoaXMucmV2ZXJzZTsgLy8geG9yXG4gICAgICAgIC8vIGl0ZXJhdGUgYXQgbGVhc3Qgb25jZSB0byBhdm9pZCBpbmZpbml0ZSBsb29wXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGlmIChtb3ZlTmV4dCkge1xuICAgICAgICAgICAgICAgIGhhbmRsZSA9IGhhbmRsZS5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZSA9IGhhbmRsZS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IHdoaWxlIChoYW5kbGUgJiYgIXRoaXMucmVzaXplci5pc1Jlc2l6ZUhhbmRsZSg8SFRNTEVsZW1lbnQ+aGFuZGxlKSk7XG5cbiAgICAgICAgaWYgKGhhbmRsZSkge1xuICAgICAgICAgICAgY29uc3QgbmV4dEhhbmRsZSA9IHRoaXMuY29weVdpdGgoPEhUTUxFbGVtZW50PmhhbmRsZSwgdGhpcy5yZXNpemVyLCB0aGlzLnNpemVyKTtcbiAgICAgICAgICAgIG5leHRIYW5kbGUucmV2ZXJzZSA9IHRoaXMucmV2ZXJzZTtcbiAgICAgICAgICAgIHJldHVybiBuZXh0SGFuZGxlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG5leHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkdmFuY2UodHJ1ZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHByZXZpb3VzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hZHZhbmNlKGZhbHNlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZXIuZ2V0SXRlbVNpemUodGhpcy5kb21Ob2RlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb2Zmc2V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zaXplci5nZXRJdGVtT2Zmc2V0KHRoaXMuZG9tTm9kZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLnNpemVyLnN0YXJ0KHRoaXMuZG9tTm9kZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGZpbmlzaCgpIHtcbiAgICAgICAgdGhpcy5zaXplci5maW5pc2godGhpcy5kb21Ob2RlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZXIuZ2V0RGVzaXJlZEl0ZW1TaXplKHRoaXMuZG9tTm9kZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFJhd1NpemUoc2l6ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc2l6ZXIuc2V0SXRlbVNpemUodGhpcy5kb21Ob2RlLCBzaXplKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0U2l6ZShzaXplOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5zZXRSYXdTaXplKGAke01hdGgucm91bmQoc2l6ZSl9cHhgKTtcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSB0aGlzLnJlc2l6ZXIuY29uZmlnLm9uUmVzaXplZDtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhzaXplLCB0aGlzLmlkLCB0aGlzLmRvbU5vZGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNsZWFyU2l6ZSgpIHtcbiAgICAgICAgdGhpcy5zaXplci5jbGVhckl0ZW1TaXplKHRoaXMuZG9tTm9kZSk7XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy5yZXNpemVyLmNvbmZpZy5vblJlc2l6ZWQ7XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdGhpcy5pZCwgdGhpcy5kb21Ob2RlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBmaXJzdCgpIHtcbiAgICAgICAgY29uc3QgZmlyc3RIYW5kbGUgPSBBcnJheS5mcm9tKHRoaXMuZG9tTm9kZS5wYXJlbnRFbGVtZW50LmNoaWxkcmVuKS5maW5kKGVsID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlc2l6ZXIuaXNSZXNpemVIYW5kbGUoPEhUTUxFbGVtZW50PmVsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChmaXJzdEhhbmRsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29weVdpdGgoPEhUTUxFbGVtZW50PmZpcnN0SGFuZGxlLCB0aGlzLnJlc2l6ZXIsIHRoaXMuc2l6ZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGxhc3QoKSB7XG4gICAgICAgIGNvbnN0IGxhc3RIYW5kbGUgPSBBcnJheS5mcm9tKHRoaXMuZG9tTm9kZS5wYXJlbnRFbGVtZW50LmNoaWxkcmVuKS5yZXZlcnNlKCkuZmluZChlbCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXNpemVyLmlzUmVzaXplSGFuZGxlKDxIVE1MRWxlbWVudD5lbCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAobGFzdEhhbmRsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29weVdpdGgoPEhUTUxFbGVtZW50Pmxhc3RIYW5kbGUsIHRoaXMucmVzaXplciwgdGhpcy5zaXplcik7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=