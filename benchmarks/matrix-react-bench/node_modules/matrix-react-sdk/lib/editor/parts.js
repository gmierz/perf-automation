"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Type = exports.PlainPart = exports.PillPart = exports.PartCreator = exports.CommandPartCreator = void 0;
exports.getAutoCompleteCreator = getAutoCompleteCreator;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _autocomplete = _interopRequireDefault(require("./autocomplete"));

var Avatar = _interopRequireWildcard(require("../Avatar"));

var _dispatcher = _interopRequireDefault(require("../dispatcher/dispatcher"));

var _actions = require("../dispatcher/actions");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2019 New Vector Ltd
Copyright 2019 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
let Type;
exports.Type = Type;

(function (Type) {
  Type["Plain"] = "plain";
  Type["Newline"] = "newline";
  Type["Command"] = "command";
  Type["UserPill"] = "user-pill";
  Type["RoomPill"] = "room-pill";
  Type["AtRoomPill"] = "at-room-pill";
  Type["PillCandidate"] = "pill-candidate";
})(Type || (exports.Type = Type = {}));

class BasePart {
  constructor(text = "") {
    (0, _defineProperty2.default)(this, "_text", void 0);
    this._text = text;
  }

  acceptsInsertion(chr, offset, inputType) {
    return true;
  }

  acceptsRemoval(position, chr) {
    return true;
  }

  merge(part) {
    return false;
  }

  split(offset) {
    const splitText = this.text.substr(offset);
    this._text = this.text.substr(0, offset);
    return new PlainPart(splitText);
  } // removes len chars, or returns the plain text this part should be replaced with
  // if the part would become invalid if it removed everything.


  remove(offset, len) {
    // validate
    const strWithRemoval = this.text.substr(0, offset) + this.text.substr(offset + len);

    for (let i = offset; i < len + offset; ++i) {
      const chr = this.text.charAt(i);

      if (!this.acceptsRemoval(i, chr)) {
        return strWithRemoval;
      }
    }

    this._text = strWithRemoval;
  } // append str, returns the remaining string if a character was rejected.


  appendUntilRejected(str, inputType) {
    const offset = this.text.length;

    for (let i = 0; i < str.length; ++i) {
      const chr = str.charAt(i);

      if (!this.acceptsInsertion(chr, offset + i, inputType)) {
        this._text = this._text + str.substr(0, i);
        return str.substr(i);
      }
    }

    this._text = this._text + str;
  } // inserts str at offset if all the characters in str were accepted, otherwise don't do anything
  // return whether the str was accepted or not.


  validateAndInsert(offset, str, inputType) {
    for (let i = 0; i < str.length; ++i) {
      const chr = str.charAt(i);

      if (!this.acceptsInsertion(chr, offset + i, inputType)) {
        return false;
      }
    }

    const beforeInsert = this._text.substr(0, offset);

    const afterInsert = this._text.substr(offset);

    this._text = beforeInsert + str + afterInsert;
    return true;
  }

  createAutoComplete(updateCallback) {}

  trim(len) {
    const remaining = this._text.substr(len);

    this._text = this._text.substr(0, len);
    return remaining;
  }

  get text() {
    return this._text;
  }

  get canEdit() {
    return true;
  }

  toString() {
    return `${this.type}(${this.text})`;
  }

  serialize() {
    return {
      type: this.type,
      text: this.text
    };
  }

}

class PlainBasePart extends BasePart {
  acceptsInsertion(chr, offset, inputType) {
    if (chr === "\n") {
      return false;
    } // when not pasting or dropping text, reject characters that should start a pill candidate


    if (inputType !== "insertFromPaste" && inputType !== "insertFromDrop") {
      if (chr !== "@" && chr !== "#" && chr !== ":" && chr !== "+") {
        return true;
      } // split if we are at the beginning of the part text


      if (offset === 0) {
        return false;
      } // or split if the previous character is a space
      // or if it is a + and this is a :


      return this._text[offset - 1] !== " " && (this._text[offset - 1] !== "+" || chr !== ":");
    }

    return true;
  }

  toDOMNode() {
    return document.createTextNode(this.text);
  }

  merge(part) {
    if (part.type === this.type) {
      this._text = this.text + part.text;
      return true;
    }

    return false;
  }

  updateDOMNode(node) {
    if (node.textContent !== this.text) {
      node.textContent = this.text;
    }
  }

  canUpdateDOMNode(node) {
    return node.nodeType === Node.TEXT_NODE;
  }

} // exported for unit tests, should otherwise only be used through PartCreator


class PlainPart extends PlainBasePart {
  get type() {
    return Type.Plain;
  }

}

exports.PlainPart = PlainPart;

class PillPart extends BasePart {
  constructor(resourceId, label) {
    super(label);
    this.resourceId = resourceId;
    (0, _defineProperty2.default)(this, "onClick", void 0);
  }

  acceptsInsertion(chr) {
    return chr !== " ";
  }

  acceptsRemoval(position, chr) {
    return position !== 0; //if you remove initial # or @, pill should become plain
  }

  toDOMNode() {
    const container = document.createElement("span");
    container.setAttribute("spellcheck", "false");
    container.setAttribute("contentEditable", "false");
    container.onclick = this.onClick;
    container.className = this.className;
    container.appendChild(document.createTextNode(this.text));
    this.setAvatar(container);
    return container;
  }

  updateDOMNode(node) {
    const textNode = node.childNodes[0];

    if (textNode.textContent !== this.text) {
      textNode.textContent = this.text;
    }

    if (node.className !== this.className) {
      node.className = this.className;
    }

    if (node.onclick !== this.onClick) {
      node.onclick = this.onClick;
    }

    this.setAvatar(node);
  }

  canUpdateDOMNode(node) {
    return node.nodeType === Node.ELEMENT_NODE && node.nodeName === "SPAN" && node.childNodes.length === 1 && node.childNodes[0].nodeType === Node.TEXT_NODE;
  } // helper method for subclasses


  setAvatarVars(node, avatarUrl, initialLetter) {
    const avatarBackground = `url('${avatarUrl}')`;
    const avatarLetter = `'${initialLetter}'`; // check if the value is changing,
    // otherwise the avatars flicker on every keystroke while updating.

    if (node.style.getPropertyValue("--avatar-background") !== avatarBackground) {
      node.style.setProperty("--avatar-background", avatarBackground);
    }

    if (node.style.getPropertyValue("--avatar-letter") !== avatarLetter) {
      node.style.setProperty("--avatar-letter", avatarLetter);
    }
  }

  serialize() {
    return {
      type: this.type,
      text: this.text,
      resourceId: this.resourceId
    };
  }

  get canEdit() {
    return false;
  }

}

exports.PillPart = PillPart;

class NewlinePart extends BasePart {
  acceptsInsertion(chr, offset) {
    return offset === 0 && chr === "\n";
  }

  acceptsRemoval(position, chr) {
    return true;
  }

  toDOMNode() {
    return document.createElement("br");
  }

  merge() {
    return false;
  }

  updateDOMNode() {}

  canUpdateDOMNode(node) {
    return node.tagName === "BR";
  }

  get type() {
    return Type.Newline;
  } // this makes the cursor skip this part when it is inserted
  // rather than trying to append to it, which is what we want.
  // As a newline can also be only one character, it makes sense
  // as it can only be one character long. This caused #9741.


  get canEdit() {
    return false;
  }

}

class RoomPillPart extends PillPart {
  constructor(resourceId, label, room) {
    super(resourceId, label);
    this.room = room;
  }

  setAvatar(node) {
    let initialLetter = "";
    let avatarUrl = Avatar.avatarUrlForRoom(this.room, 16, 16, "crop");

    if (!avatarUrl) {
      initialLetter = Avatar.getInitialLetter(this.room ? this.room.name : this.resourceId);
      avatarUrl = Avatar.defaultAvatarUrlForString(this.room ? this.room.roomId : this.resourceId);
    }

    this.setAvatarVars(node, avatarUrl, initialLetter);
  }

  get type() {
    return Type.RoomPill;
  }

  get className() {
    return "mx_RoomPill mx_Pill";
  }

}

class AtRoomPillPart extends RoomPillPart {
  constructor(text, room) {
    super(text, text, room);
  }

  get type() {
    return Type.AtRoomPill;
  }

  serialize() {
    return {
      type: this.type,
      text: this.text
    };
  }

}

class UserPillPart extends PillPart {
  constructor(userId, displayName, member) {
    super(userId, displayName);
    this.member = member;
    (0, _defineProperty2.default)(this, "onClick", () => {
      _dispatcher.default.dispatch({
        action: _actions.Action.ViewUser,
        member: this.member
      });
    });
  }

  get type() {
    return Type.UserPill;
  }

  get className() {
    return "mx_UserPill mx_Pill";
  }

  setAvatar(node) {
    if (!this.member) {
      return;
    }

    const name = this.member.name || this.member.userId;
    const defaultAvatarUrl = Avatar.defaultAvatarUrlForString(this.member.userId);
    const avatarUrl = Avatar.avatarUrlForMember(this.member, 16, 16, "crop");
    let initialLetter = "";

    if (avatarUrl === defaultAvatarUrl) {
      initialLetter = Avatar.getInitialLetter(name);
    }

    this.setAvatarVars(node, avatarUrl, initialLetter);
  }

}

class PillCandidatePart extends PlainBasePart {
  constructor(text, autoCompleteCreator) {
    super(text);
    this.autoCompleteCreator = autoCompleteCreator;
  }

  createAutoComplete(updateCallback) {
    return this.autoCompleteCreator.create(updateCallback);
  }

  acceptsInsertion(chr, offset, inputType) {
    if (offset === 0) {
      return true;
    } else {
      return super.acceptsInsertion(chr, offset, inputType);
    }
  }

  merge() {
    return false;
  }

  acceptsRemoval(position, chr) {
    return true;
  }

  get type() {
    return Type.PillCandidate;
  }

}

function getAutoCompleteCreator(getAutocompleterComponent, updateQuery) {
  return partCreator => {
    return updateCallback => {
      return new _autocomplete.default(updateCallback, getAutocompleterComponent, updateQuery, partCreator);
    };
  };
}

class PartCreator {
  constructor(room, client, autoCompleteCreator = null) {
    this.room = room;
    this.client = client;
    (0, _defineProperty2.default)(this, "autoCompleteCreator", void 0);
    // pre-create the creator as an object even without callback so it can already be passed
    // to PillCandidatePart (e.g. while deserializing) and set later on
    this.autoCompleteCreator = {
      create: autoCompleteCreator === null || autoCompleteCreator === void 0 ? void 0 : autoCompleteCreator(this)
    };
  }

  setAutoCompleteCreator(autoCompleteCreator) {
    this.autoCompleteCreator.create = autoCompleteCreator(this);
  }

  createPartForInput(input, partIndex, inputType) {
    switch (input[0]) {
      case "#":
      case "@":
      case ":":
      case "+":
        return this.pillCandidate("");

      case "\n":
        return new NewlinePart();

      default:
        return new PlainPart();
    }
  }

  createDefaultPart(text) {
    return this.plain(text);
  }

  deserializePart(part) {
    switch (part.type) {
      case Type.Plain:
        return this.plain(part.text);

      case Type.Newline:
        return this.newline();

      case Type.AtRoomPill:
        return this.atRoomPill(part.text);

      case Type.PillCandidate:
        return this.pillCandidate(part.text);

      case Type.RoomPill:
        return this.roomPill(part.resourceId);

      case Type.UserPill:
        return this.userPill(part.text, part.resourceId);
    }
  }

  plain(text) {
    return new PlainPart(text);
  }

  newline() {
    return new NewlinePart("\n");
  }

  pillCandidate(text) {
    return new PillCandidatePart(text, this.autoCompleteCreator);
  }

  roomPill(alias, roomId) {
    let room;

    if (roomId || alias[0] !== "#") {
      room = this.client.getRoom(roomId || alias);
    } else {
      room = this.client.getRooms().find(r => {
        return r.getCanonicalAlias() === alias || r.getAltAliases().includes(alias);
      });
    }

    return new RoomPillPart(alias, room ? room.name : alias, room);
  }

  atRoomPill(text) {
    return new AtRoomPillPart(text, this.room);
  }

  userPill(displayName, userId) {
    const member = this.room.getMember(userId);
    return new UserPillPart(userId, displayName, member);
  }

  createMentionParts(insertTrailingCharacter, displayName, userId) {
    const pill = this.userPill(displayName, userId);
    const postfix = this.plain(insertTrailingCharacter ? ": " : " ");
    return [pill, postfix];
  }

} // part creator that support auto complete for /commands,
// used in SendMessageComposer


exports.PartCreator = PartCreator;

class CommandPartCreator extends PartCreator {
  createPartForInput(text, partIndex) {
    // at beginning and starts with /? create
    if (partIndex === 0 && text[0] === "/") {
      // text will be inserted by model, so pass empty string
      return this.command("");
    } else {
      return super.createPartForInput(text, partIndex);
    }
  }

  command(text) {
    return new CommandPart(text, this.autoCompleteCreator);
  }

  deserializePart(part) {
    if (part.type === Type.Command) {
      return this.command(part.text);
    } else {
      return super.deserializePart(part);
    }
  }

}

exports.CommandPartCreator = CommandPartCreator;

class CommandPart extends PillCandidatePart {
  get type() {
    return Type.Command;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lZGl0b3IvcGFydHMudHMiXSwibmFtZXMiOlsiVHlwZSIsIkJhc2VQYXJ0IiwiY29uc3RydWN0b3IiLCJ0ZXh0IiwiX3RleHQiLCJhY2NlcHRzSW5zZXJ0aW9uIiwiY2hyIiwib2Zmc2V0IiwiaW5wdXRUeXBlIiwiYWNjZXB0c1JlbW92YWwiLCJwb3NpdGlvbiIsIm1lcmdlIiwicGFydCIsInNwbGl0Iiwic3BsaXRUZXh0Iiwic3Vic3RyIiwiUGxhaW5QYXJ0IiwicmVtb3ZlIiwibGVuIiwic3RyV2l0aFJlbW92YWwiLCJpIiwiY2hhckF0IiwiYXBwZW5kVW50aWxSZWplY3RlZCIsInN0ciIsImxlbmd0aCIsInZhbGlkYXRlQW5kSW5zZXJ0IiwiYmVmb3JlSW5zZXJ0IiwiYWZ0ZXJJbnNlcnQiLCJjcmVhdGVBdXRvQ29tcGxldGUiLCJ1cGRhdGVDYWxsYmFjayIsInRyaW0iLCJyZW1haW5pbmciLCJjYW5FZGl0IiwidG9TdHJpbmciLCJ0eXBlIiwic2VyaWFsaXplIiwiUGxhaW5CYXNlUGFydCIsInRvRE9NTm9kZSIsImRvY3VtZW50IiwiY3JlYXRlVGV4dE5vZGUiLCJ1cGRhdGVET01Ob2RlIiwibm9kZSIsInRleHRDb250ZW50IiwiY2FuVXBkYXRlRE9NTm9kZSIsIm5vZGVUeXBlIiwiTm9kZSIsIlRFWFRfTk9ERSIsIlBsYWluIiwiUGlsbFBhcnQiLCJyZXNvdXJjZUlkIiwibGFiZWwiLCJjb250YWluZXIiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwib25jbGljayIsIm9uQ2xpY2siLCJjbGFzc05hbWUiLCJhcHBlbmRDaGlsZCIsInNldEF2YXRhciIsInRleHROb2RlIiwiY2hpbGROb2RlcyIsIkVMRU1FTlRfTk9ERSIsIm5vZGVOYW1lIiwic2V0QXZhdGFyVmFycyIsImF2YXRhclVybCIsImluaXRpYWxMZXR0ZXIiLCJhdmF0YXJCYWNrZ3JvdW5kIiwiYXZhdGFyTGV0dGVyIiwic3R5bGUiLCJnZXRQcm9wZXJ0eVZhbHVlIiwic2V0UHJvcGVydHkiLCJOZXdsaW5lUGFydCIsInRhZ05hbWUiLCJOZXdsaW5lIiwiUm9vbVBpbGxQYXJ0Iiwicm9vbSIsIkF2YXRhciIsImF2YXRhclVybEZvclJvb20iLCJnZXRJbml0aWFsTGV0dGVyIiwibmFtZSIsImRlZmF1bHRBdmF0YXJVcmxGb3JTdHJpbmciLCJyb29tSWQiLCJSb29tUGlsbCIsIkF0Um9vbVBpbGxQYXJ0IiwiQXRSb29tUGlsbCIsIlVzZXJQaWxsUGFydCIsInVzZXJJZCIsImRpc3BsYXlOYW1lIiwibWVtYmVyIiwiZGVmYXVsdERpc3BhdGNoZXIiLCJkaXNwYXRjaCIsImFjdGlvbiIsIkFjdGlvbiIsIlZpZXdVc2VyIiwiVXNlclBpbGwiLCJkZWZhdWx0QXZhdGFyVXJsIiwiYXZhdGFyVXJsRm9yTWVtYmVyIiwiUGlsbENhbmRpZGF0ZVBhcnQiLCJhdXRvQ29tcGxldGVDcmVhdG9yIiwiY3JlYXRlIiwiUGlsbENhbmRpZGF0ZSIsImdldEF1dG9Db21wbGV0ZUNyZWF0b3IiLCJnZXRBdXRvY29tcGxldGVyQ29tcG9uZW50IiwidXBkYXRlUXVlcnkiLCJwYXJ0Q3JlYXRvciIsIkF1dG9jb21wbGV0ZVdyYXBwZXJNb2RlbCIsIlBhcnRDcmVhdG9yIiwiY2xpZW50Iiwic2V0QXV0b0NvbXBsZXRlQ3JlYXRvciIsImNyZWF0ZVBhcnRGb3JJbnB1dCIsImlucHV0IiwicGFydEluZGV4IiwicGlsbENhbmRpZGF0ZSIsImNyZWF0ZURlZmF1bHRQYXJ0IiwicGxhaW4iLCJkZXNlcmlhbGl6ZVBhcnQiLCJuZXdsaW5lIiwiYXRSb29tUGlsbCIsInJvb21QaWxsIiwidXNlclBpbGwiLCJhbGlhcyIsImdldFJvb20iLCJnZXRSb29tcyIsImZpbmQiLCJyIiwiZ2V0Q2Fub25pY2FsQWxpYXMiLCJnZXRBbHRBbGlhc2VzIiwiaW5jbHVkZXMiLCJnZXRNZW1iZXIiLCJjcmVhdGVNZW50aW9uUGFydHMiLCJpbnNlcnRUcmFpbGluZ0NoYXJhY3RlciIsInBpbGwiLCJwb3N0Zml4Iiwi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eUIxRyxJQUF6QixFQUErQjRHLFNBQS9CLENBQVA7QUFDSDtBQUNKOztBQUVNdUIsRUFBQUEsT0FBTyxDQUFDbkksSUFBRCxFQUE0QjtBQUN0QyxXQUFPLElBQUlvSSxXQUFKLENBQWdCcEksSUFBaEIsRUFBc0IsS0FBSytGLG1CQUEzQixDQUFQO0FBQ0g7O0FBRU1pQixFQUFBQSxlQUFlLENBQUN2RyxJQUFELEVBQTZCO0FBQy9DLFFBQUlBLElBQUksQ0FBQ3NCLElBQUwsS0FBY2xDLElBQUksQ0FBQ3dJLE9BQXZCLEVBQWdDO0FBQzVCLGFBQU8sS0FBS0YsT0FBTCxDQUFhMUgsSUFBSSxDQUFDVCxJQUFsQixDQUFQO0FBQ0gsS0FGRCxNQUVPO0FBQ0gsYUFBTyxNQUFNZ0gsZUFBTixDQUFzQnZHLElBQXRCLENBQVA7QUFDSDtBQUNKOztBQXJCK0M7Ozs7QUF3QnBELE1BQU0ySCxXQUFOLFNBQTBCdEMsaUJBQTFCLENBQTRDO0FBQ3pCLE1BQUovRCxJQUFJLEdBQStCO0FBQzFDLFdBQU9sQyxJQUFJLENBQUN3SSxPQUFaO0FBQ0g7O0FBSHVDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCB7IE1hdHJpeENsaWVudCB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9jbGllbnRcIjtcbmltcG9ydCB7IFJvb21NZW1iZXIgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvbW9kZWxzL3Jvb20tbWVtYmVyXCI7XG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL21vZGVscy9yb29tXCI7XG5cbmltcG9ydCBBdXRvY29tcGxldGVXcmFwcGVyTW9kZWwsIHtcbiAgICBHZXRBdXRvY29tcGxldGVyQ29tcG9uZW50LFxuICAgIFVwZGF0ZUNhbGxiYWNrLFxuICAgIFVwZGF0ZVF1ZXJ5LFxufSBmcm9tIFwiLi9hdXRvY29tcGxldGVcIjtcbmltcG9ydCAqIGFzIEF2YXRhciBmcm9tIFwiLi4vQXZhdGFyXCI7XG5pbXBvcnQgZGVmYXVsdERpc3BhdGNoZXIgZnJvbSBcIi4uL2Rpc3BhdGNoZXIvZGlzcGF0Y2hlclwiO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSBcIi4uL2Rpc3BhdGNoZXIvYWN0aW9uc1wiO1xuXG5pbnRlcmZhY2UgSVNlcmlhbGl6ZWRQYXJ0IHtcbiAgICB0eXBlOiBUeXBlLlBsYWluIHwgVHlwZS5OZXdsaW5lIHwgVHlwZS5Db21tYW5kIHwgVHlwZS5QaWxsQ2FuZGlkYXRlO1xuICAgIHRleHQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIElTZXJpYWxpemVkUGlsbFBhcnQge1xuICAgIHR5cGU6IFR5cGUuQXRSb29tUGlsbCB8IFR5cGUuUm9vbVBpbGwgfCBUeXBlLlVzZXJQaWxsO1xuICAgIHRleHQ6IHN0cmluZztcbiAgICByZXNvdXJjZUlkPzogc3RyaW5nO1xufVxuXG5leHBvcnQgdHlwZSBTZXJpYWxpemVkUGFydCA9IElTZXJpYWxpemVkUGFydCB8IElTZXJpYWxpemVkUGlsbFBhcnQ7XG5cbmV4cG9ydCBlbnVtIFR5cGUge1xuICAgIFBsYWluID0gXCJwbGFpblwiLFxuICAgIE5ld2xpbmUgPSBcIm5ld2xpbmVcIixcbiAgICBDb21tYW5kID0gXCJjb21tYW5kXCIsXG4gICAgVXNlclBpbGwgPSBcInVzZXItcGlsbFwiLFxuICAgIFJvb21QaWxsID0gXCJyb29tLXBpbGxcIixcbiAgICBBdFJvb21QaWxsID0gXCJhdC1yb29tLXBpbGxcIixcbiAgICBQaWxsQ2FuZGlkYXRlID0gXCJwaWxsLWNhbmRpZGF0ZVwiLFxufVxuXG5pbnRlcmZhY2UgSUJhc2VQYXJ0IHtcbiAgICB0ZXh0OiBzdHJpbmc7XG4gICAgdHlwZTogVHlwZS5QbGFpbiB8IFR5cGUuTmV3bGluZTtcbiAgICBjYW5FZGl0OiBib29sZWFuO1xuXG4gICAgY3JlYXRlQXV0b0NvbXBsZXRlKHVwZGF0ZUNhbGxiYWNrOiBVcGRhdGVDYWxsYmFjayk6IHZvaWQ7XG5cbiAgICBzZXJpYWxpemUoKTogU2VyaWFsaXplZFBhcnQ7XG4gICAgcmVtb3ZlKG9mZnNldDogbnVtYmVyLCBsZW46IG51bWJlcik6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBzcGxpdChvZmZzZXQ6IG51bWJlcik6IElCYXNlUGFydDtcbiAgICB2YWxpZGF0ZUFuZEluc2VydChvZmZzZXQ6IG51bWJlciwgc3RyOiBzdHJpbmcsIGlucHV0VHlwZTogc3RyaW5nKTogYm9vbGVhbjtcbiAgICBhcHBlbmRVbnRpbFJlamVjdGVkKHN0cjogc3RyaW5nLCBpbnB1dFR5cGU6IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICB1cGRhdGVET01Ob2RlKG5vZGU6IE5vZGUpOiB2b2lkO1xuICAgIGNhblVwZGF0ZURPTU5vZGUobm9kZTogTm9kZSk6IGJvb2xlYW47XG4gICAgdG9ET01Ob2RlKCk6IE5vZGU7XG59XG5cbmludGVyZmFjZSBJUGlsbENhbmRpZGF0ZVBhcnQgZXh0ZW5kcyBPbWl0PElCYXNlUGFydCwgXCJ0eXBlXCIgfCBcImNyZWF0ZUF1dG9Db21wbGV0ZVwiPiB7XG4gICAgdHlwZTogVHlwZS5QaWxsQ2FuZGlkYXRlIHwgVHlwZS5Db21tYW5kO1xuICAgIGNyZWF0ZUF1dG9Db21wbGV0ZSh1cGRhdGVDYWxsYmFjazogVXBkYXRlQ2FsbGJhY2spOiBBdXRvY29tcGxldGVXcmFwcGVyTW9kZWw7XG59XG5cbmludGVyZmFjZSBJUGlsbFBhcnQgZXh0ZW5kcyBPbWl0PElCYXNlUGFydCwgXCJ0eXBlXCIgfCBcInJlc291cmNlSWRcIj4ge1xuICAgIHR5cGU6IFR5cGUuQXRSb29tUGlsbCB8IFR5cGUuUm9vbVBpbGwgfCBUeXBlLlVzZXJQaWxsO1xuICAgIHJlc291cmNlSWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IHR5cGUgUGFydCA9IElCYXNlUGFydCB8IElQaWxsQ2FuZGlkYXRlUGFydCB8IElQaWxsUGFydDtcblxuYWJzdHJhY3QgY2xhc3MgQmFzZVBhcnQge1xuICAgIHByb3RlY3RlZCBfdGV4dDogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IodGV4dCA9IFwiXCIpIHtcbiAgICAgICAgdGhpcy5fdGV4dCA9IHRleHQ7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFjY2VwdHNJbnNlcnRpb24oY2hyOiBzdHJpbmcsIG9mZnNldDogbnVtYmVyLCBpbnB1dFR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYWNjZXB0c1JlbW92YWwocG9zaXRpb246IG51bWJlciwgY2hyOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHVibGljIG1lcmdlKHBhcnQ6IFBhcnQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzcGxpdChvZmZzZXQ6IG51bWJlcik6IElCYXNlUGFydCB7XG4gICAgICAgIGNvbnN0IHNwbGl0VGV4dCA9IHRoaXMudGV4dC5zdWJzdHIob2Zmc2V0KTtcbiAgICAgICAgdGhpcy5fdGV4dCA9IHRoaXMudGV4dC5zdWJzdHIoMCwgb2Zmc2V0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBQbGFpblBhcnQoc3BsaXRUZXh0KTtcbiAgICB9XG5cbiAgICAvLyByZW1vdmVzIGxlbiBjaGFycywgb3IgcmV0dXJucyB0aGUgcGxhaW4gdGV4dCB0aGlzIHBhcnQgc2hvdWxkIGJlIHJlcGxhY2VkIHdpdGhcbiAgICAvLyBpZiB0aGUgcGFydCB3b3VsZCBiZWNvbWUgaW52YWxpZCBpZiBpdCByZW1vdmVkIGV2ZXJ5dGhpbmcuXG4gICAgcHVibGljIHJlbW92ZShvZmZzZXQ6IG51bWJlciwgbGVuOiBudW1iZXIpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgICAgICAvLyB2YWxpZGF0ZVxuICAgICAgICBjb25zdCBzdHJXaXRoUmVtb3ZhbCA9IHRoaXMudGV4dC5zdWJzdHIoMCwgb2Zmc2V0KSArIHRoaXMudGV4dC5zdWJzdHIob2Zmc2V0ICsgbGVuKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IG9mZnNldDsgaSA8IChsZW4gKyBvZmZzZXQpOyArK2kpIHtcbiAgICAgICAgICAgIGNvbnN0IGNociA9IHRoaXMudGV4dC5jaGFyQXQoaSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYWNjZXB0c1JlbW92YWwoaSwgY2hyKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdHJXaXRoUmVtb3ZhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXh0ID0gc3RyV2l0aFJlbW92YWw7XG4gICAgfVxuXG4gICAgLy8gYXBwZW5kIHN0ciwgcmV0dXJucyB0aGUgcmVtYWluaW5nIHN0cmluZyBpZiBhIGNoYXJhY3RlciB3YXMgcmVqZWN0ZWQuXG4gICAgcHVibGljIGFwcGVuZFVudGlsUmVqZWN0ZWQoc3RyOiBzdHJpbmcsIGlucHV0VHlwZTogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gdGhpcy50ZXh0Lmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGNvbnN0IGNociA9IHN0ci5jaGFyQXQoaSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYWNjZXB0c0luc2VydGlvbihjaHIsIG9mZnNldCArIGksIGlucHV0VHlwZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0ID0gdGhpcy5fdGV4dCArIHN0ci5zdWJzdHIoMCwgaSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0ci5zdWJzdHIoaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGV4dCA9IHRoaXMuX3RleHQgKyBzdHI7XG4gICAgfVxuXG4gICAgLy8gaW5zZXJ0cyBzdHIgYXQgb2Zmc2V0IGlmIGFsbCB0aGUgY2hhcmFjdGVycyBpbiBzdHIgd2VyZSBhY2NlcHRlZCwgb3RoZXJ3aXNlIGRvbid0IGRvIGFueXRoaW5nXG4gICAgLy8gcmV0dXJuIHdoZXRoZXIgdGhlIHN0ciB3YXMgYWNjZXB0ZWQgb3Igbm90LlxuICAgIHB1YmxpYyB2YWxpZGF0ZUFuZEluc2VydChvZmZzZXQ6IG51bWJlciwgc3RyOiBzdHJpbmcsIGlucHV0VHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBjb25zdCBjaHIgPSBzdHIuY2hhckF0KGkpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmFjY2VwdHNJbnNlcnRpb24oY2hyLCBvZmZzZXQgKyBpLCBpbnB1dFR5cGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJlZm9yZUluc2VydCA9IHRoaXMuX3RleHQuc3Vic3RyKDAsIG9mZnNldCk7XG4gICAgICAgIGNvbnN0IGFmdGVySW5zZXJ0ID0gdGhpcy5fdGV4dC5zdWJzdHIob2Zmc2V0KTtcbiAgICAgICAgdGhpcy5fdGV4dCA9IGJlZm9yZUluc2VydCArIHN0ciArIGFmdGVySW5zZXJ0O1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlQXV0b0NvbXBsZXRlKHVwZGF0ZUNhbGxiYWNrOiBVcGRhdGVDYWxsYmFjayk6IHZvaWQge31cblxuICAgIHByb3RlY3RlZCB0cmltKGxlbjogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nID0gdGhpcy5fdGV4dC5zdWJzdHIobGVuKTtcbiAgICAgICAgdGhpcy5fdGV4dCA9IHRoaXMuX3RleHQuc3Vic3RyKDAsIGxlbik7XG4gICAgICAgIHJldHVybiByZW1haW5pbmc7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCB0ZXh0KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl90ZXh0O1xuICAgIH1cblxuICAgIHB1YmxpYyBhYnN0cmFjdCBnZXQgdHlwZSgpOiBUeXBlO1xuXG4gICAgcHVibGljIGdldCBjYW5FZGl0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMudHlwZX0oJHt0aGlzLnRleHR9KWA7XG4gICAgfVxuXG4gICAgcHVibGljIHNlcmlhbGl6ZSgpOiBTZXJpYWxpemVkUGFydCB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiB0aGlzLnR5cGUgYXMgSVNlcmlhbGl6ZWRQYXJ0W1widHlwZVwiXSxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMudGV4dCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWJzdHJhY3QgdXBkYXRlRE9NTm9kZShub2RlOiBOb2RlKTogdm9pZDtcbiAgICBwdWJsaWMgYWJzdHJhY3QgY2FuVXBkYXRlRE9NTm9kZShub2RlOiBOb2RlKTogYm9vbGVhbjtcbiAgICBwdWJsaWMgYWJzdHJhY3QgdG9ET01Ob2RlKCk6IE5vZGU7XG59XG5cbmFic3RyYWN0IGNsYXNzIFBsYWluQmFzZVBhcnQgZXh0ZW5kcyBCYXNlUGFydCB7XG4gICAgcHJvdGVjdGVkIGFjY2VwdHNJbnNlcnRpb24oY2hyOiBzdHJpbmcsIG9mZnNldDogbnVtYmVyLCBpbnB1dFR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoY2hyID09PSBcIlxcblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gd2hlbiBub3QgcGFzdGluZyBvciBkcm9wcGluZyB0ZXh0LCByZWplY3QgY2hhcmFjdGVycyB0aGF0IHNob3VsZCBzdGFydCBhIHBpbGwgY2FuZGlkYXRlXG4gICAgICAgIGlmIChpbnB1dFR5cGUgIT09IFwiaW5zZXJ0RnJvbVBhc3RlXCIgJiYgaW5wdXRUeXBlICE9PSBcImluc2VydEZyb21Ecm9wXCIpIHtcbiAgICAgICAgICAgIGlmIChjaHIgIT09IFwiQFwiICYmIGNociAhPT0gXCIjXCIgJiYgY2hyICE9PSBcIjpcIiAmJiBjaHIgIT09IFwiK1wiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNwbGl0IGlmIHdlIGFyZSBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBwYXJ0IHRleHRcbiAgICAgICAgICAgIGlmIChvZmZzZXQgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG9yIHNwbGl0IGlmIHRoZSBwcmV2aW91cyBjaGFyYWN0ZXIgaXMgYSBzcGFjZVxuICAgICAgICAgICAgLy8gb3IgaWYgaXQgaXMgYSArIGFuZCB0aGlzIGlzIGEgOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleHRbb2Zmc2V0IC0gMV0gIT09IFwiIFwiICYmXG4gICAgICAgICAgICAgICAgKHRoaXMuX3RleHRbb2Zmc2V0IC0gMV0gIT09IFwiK1wiIHx8IGNociAhPT0gXCI6XCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHB1YmxpYyB0b0RPTU5vZGUoKTogTm9kZSB7XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLnRleHQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBtZXJnZShwYXJ0KTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChwYXJ0LnR5cGUgPT09IHRoaXMudHlwZSkge1xuICAgICAgICAgICAgdGhpcy5fdGV4dCA9IHRoaXMudGV4dCArIHBhcnQudGV4dDtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlRE9NTm9kZShub2RlOiBOb2RlKTogdm9pZCB7XG4gICAgICAgIGlmIChub2RlLnRleHRDb250ZW50ICE9PSB0aGlzLnRleHQpIHtcbiAgICAgICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSB0aGlzLnRleHQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY2FuVXBkYXRlRE9NTm9kZShub2RlOiBOb2RlKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBub2RlLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERTtcbiAgICB9XG59XG5cbi8vIGV4cG9ydGVkIGZvciB1bml0IHRlc3RzLCBzaG91bGQgb3RoZXJ3aXNlIG9ubHkgYmUgdXNlZCB0aHJvdWdoIFBhcnRDcmVhdG9yXG5leHBvcnQgY2xhc3MgUGxhaW5QYXJ0IGV4dGVuZHMgUGxhaW5CYXNlUGFydCBpbXBsZW1lbnRzIElCYXNlUGFydCB7XG4gICAgcHVibGljIGdldCB0eXBlKCk6IElCYXNlUGFydFtcInR5cGVcIl0ge1xuICAgICAgICByZXR1cm4gVHlwZS5QbGFpbjtcbiAgICB9XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBQaWxsUGFydCBleHRlbmRzIEJhc2VQYXJ0IGltcGxlbWVudHMgSVBpbGxQYXJ0IHtcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgcmVzb3VyY2VJZDogc3RyaW5nLCBsYWJlbCkge1xuICAgICAgICBzdXBlcihsYWJlbCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFjY2VwdHNJbnNlcnRpb24oY2hyOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGNociAhPT0gXCIgXCI7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFjY2VwdHNSZW1vdmFsKHBvc2l0aW9uOiBudW1iZXIsIGNocjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBwb3NpdGlvbiAhPT0gMDsgIC8vaWYgeW91IHJlbW92ZSBpbml0aWFsICMgb3IgQCwgcGlsbCBzaG91bGQgYmVjb21lIHBsYWluXG4gICAgfVxuXG4gICAgcHVibGljIHRvRE9NTm9kZSgpOiBOb2RlIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoXCJzcGVsbGNoZWNrXCIsIFwiZmFsc2VcIik7XG4gICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoXCJjb250ZW50RWRpdGFibGVcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgY29udGFpbmVyLm9uY2xpY2sgPSB0aGlzLm9uQ2xpY2s7XG4gICAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMudGV4dCkpO1xuICAgICAgICB0aGlzLnNldEF2YXRhcihjb250YWluZXIpO1xuICAgICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgIH1cblxuICAgIHB1YmxpYyB1cGRhdGVET01Ob2RlKG5vZGU6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHRleHROb2RlID0gbm9kZS5jaGlsZE5vZGVzWzBdO1xuICAgICAgICBpZiAodGV4dE5vZGUudGV4dENvbnRlbnQgIT09IHRoaXMudGV4dCkge1xuICAgICAgICAgICAgdGV4dE5vZGUudGV4dENvbnRlbnQgPSB0aGlzLnRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUuY2xhc3NOYW1lICE9PSB0aGlzLmNsYXNzTmFtZSkge1xuICAgICAgICAgICAgbm9kZS5jbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZS5vbmNsaWNrICE9PSB0aGlzLm9uQ2xpY2spIHtcbiAgICAgICAgICAgIG5vZGUub25jbGljayA9IHRoaXMub25DbGljaztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldEF2YXRhcihub2RlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2FuVXBkYXRlRE9NTm9kZShub2RlOiBIVE1MRWxlbWVudCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUgJiZcbiAgICAgICAgICAgICAgIG5vZGUubm9kZU5hbWUgPT09IFwiU1BBTlwiICYmXG4gICAgICAgICAgICAgICBub2RlLmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICYmXG4gICAgICAgICAgICAgICBub2RlLmNoaWxkTm9kZXNbMF0ubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFO1xuICAgIH1cblxuICAgIC8vIGhlbHBlciBtZXRob2QgZm9yIHN1YmNsYXNzZXNcbiAgICBwcm90ZWN0ZWQgc2V0QXZhdGFyVmFycyhub2RlOiBIVE1MRWxlbWVudCwgYXZhdGFyVXJsOiBzdHJpbmcsIGluaXRpYWxMZXR0ZXI6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zdCBhdmF0YXJCYWNrZ3JvdW5kID0gYHVybCgnJHthdmF0YXJVcmx9JylgO1xuICAgICAgICBjb25zdCBhdmF0YXJMZXR0ZXIgPSBgJyR7aW5pdGlhbExldHRlcn0nYDtcbiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHZhbHVlIGlzIGNoYW5naW5nLFxuICAgICAgICAvLyBvdGhlcndpc2UgdGhlIGF2YXRhcnMgZmxpY2tlciBvbiBldmVyeSBrZXlzdHJva2Ugd2hpbGUgdXBkYXRpbmcuXG4gICAgICAgIGlmIChub2RlLnN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCItLWF2YXRhci1iYWNrZ3JvdW5kXCIpICE9PSBhdmF0YXJCYWNrZ3JvdW5kKSB7XG4gICAgICAgICAgICBub2RlLnN0eWxlLnNldFByb3BlcnR5KFwiLS1hdmF0YXItYmFja2dyb3VuZFwiLCBhdmF0YXJCYWNrZ3JvdW5kKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZS5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1hdmF0YXItbGV0dGVyXCIpICE9PSBhdmF0YXJMZXR0ZXIpIHtcbiAgICAgICAgICAgIG5vZGUuc3R5bGUuc2V0UHJvcGVydHkoXCItLWF2YXRhci1sZXR0ZXJcIiwgYXZhdGFyTGV0dGVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzZXJpYWxpemUoKTogSVNlcmlhbGl6ZWRQaWxsUGFydCB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiB0aGlzLnR5cGUsXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLnRleHQsXG4gICAgICAgICAgICByZXNvdXJjZUlkOiB0aGlzLnJlc291cmNlSWQsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBjYW5FZGl0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcHVibGljIGFic3RyYWN0IGdldCB0eXBlKCk6IElQaWxsUGFydFtcInR5cGVcIl07XG5cbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgZ2V0IGNsYXNzTmFtZSgpOiBzdHJpbmc7XG5cbiAgICBwcm90ZWN0ZWQgb25DbGljaz86ICgpID0+IHZvaWQ7XG5cbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgc2V0QXZhdGFyKG5vZGU6IEhUTUxFbGVtZW50KTogdm9pZDtcbn1cblxuY2xhc3MgTmV3bGluZVBhcnQgZXh0ZW5kcyBCYXNlUGFydCBpbXBsZW1lbnRzIElCYXNlUGFydCB7XG4gICAgcHJvdGVjdGVkIGFjY2VwdHNJbnNlcnRpb24oY2hyOiBzdHJpbmcsIG9mZnNldDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBvZmZzZXQgPT09IDAgJiYgY2hyID09PSBcIlxcblwiO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBhY2NlcHRzUmVtb3ZhbChwb3NpdGlvbjogbnVtYmVyLCBjaHI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdG9ET01Ob2RlKCk6IE5vZGUge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJyXCIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBtZXJnZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHB1YmxpYyB1cGRhdGVET01Ob2RlKCk6IHZvaWQge31cblxuICAgIHB1YmxpYyBjYW5VcGRhdGVET01Ob2RlKG5vZGU6IEhUTUxFbGVtZW50KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBub2RlLnRhZ05hbWUgPT09IFwiQlJcIjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IHR5cGUoKTogSUJhc2VQYXJ0W1widHlwZVwiXSB7XG4gICAgICAgIHJldHVybiBUeXBlLk5ld2xpbmU7XG4gICAgfVxuXG4gICAgLy8gdGhpcyBtYWtlcyB0aGUgY3Vyc29yIHNraXAgdGhpcyBwYXJ0IHdoZW4gaXQgaXMgaW5zZXJ0ZWRcbiAgICAvLyByYXRoZXIgdGhhbiB0cnlpbmcgdG8gYXBwZW5kIHRvIGl0LCB3aGljaCBpcyB3aGF0IHdlIHdhbnQuXG4gICAgLy8gQXMgYSBuZXdsaW5lIGNhbiBhbHNvIGJlIG9ubHkgb25lIGNoYXJhY3RlciwgaXQgbWFrZXMgc2Vuc2VcbiAgICAvLyBhcyBpdCBjYW4gb25seSBiZSBvbmUgY2hhcmFjdGVyIGxvbmcuIFRoaXMgY2F1c2VkICM5NzQxLlxuICAgIHB1YmxpYyBnZXQgY2FuRWRpdCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuY2xhc3MgUm9vbVBpbGxQYXJ0IGV4dGVuZHMgUGlsbFBhcnQge1xuICAgIGNvbnN0cnVjdG9yKHJlc291cmNlSWQ6IHN0cmluZywgbGFiZWw6IHN0cmluZywgcHJpdmF0ZSByb29tOiBSb29tKSB7XG4gICAgICAgIHN1cGVyKHJlc291cmNlSWQsIGxhYmVsKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2V0QXZhdGFyKG5vZGU6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgICAgIGxldCBpbml0aWFsTGV0dGVyID0gXCJcIjtcbiAgICAgICAgbGV0IGF2YXRhclVybCA9IEF2YXRhci5hdmF0YXJVcmxGb3JSb29tKHRoaXMucm9vbSwgMTYsIDE2LCBcImNyb3BcIik7XG4gICAgICAgIGlmICghYXZhdGFyVXJsKSB7XG4gICAgICAgICAgICBpbml0aWFsTGV0dGVyID0gQXZhdGFyLmdldEluaXRpYWxMZXR0ZXIodGhpcy5yb29tID8gdGhpcy5yb29tLm5hbWUgOiB0aGlzLnJlc291cmNlSWQpO1xuICAgICAgICAgICAgYXZhdGFyVXJsID0gQXZhdGFyLmRlZmF1bHRBdmF0YXJVcmxGb3JTdHJpbmcodGhpcy5yb29tID8gdGhpcy5yb29tLnJvb21JZCA6IHRoaXMucmVzb3VyY2VJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRBdmF0YXJWYXJzKG5vZGUsIGF2YXRhclVybCwgaW5pdGlhbExldHRlcik7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCB0eXBlKCk6IElQaWxsUGFydFtcInR5cGVcIl0ge1xuICAgICAgICByZXR1cm4gVHlwZS5Sb29tUGlsbDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGNsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwibXhfUm9vbVBpbGwgbXhfUGlsbFwiO1xuICAgIH1cbn1cblxuY2xhc3MgQXRSb29tUGlsbFBhcnQgZXh0ZW5kcyBSb29tUGlsbFBhcnQge1xuICAgIGNvbnN0cnVjdG9yKHRleHQ6IHN0cmluZywgcm9vbTogUm9vbSkge1xuICAgICAgICBzdXBlcih0ZXh0LCB0ZXh0LCByb29tKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IHR5cGUoKTogSVBpbGxQYXJ0W1widHlwZVwiXSB7XG4gICAgICAgIHJldHVybiBUeXBlLkF0Um9vbVBpbGw7XG4gICAgfVxuXG4gICAgcHVibGljIHNlcmlhbGl6ZSgpOiBJU2VyaWFsaXplZFBpbGxQYXJ0IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6IHRoaXMudHlwZSxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMudGV4dCxcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmNsYXNzIFVzZXJQaWxsUGFydCBleHRlbmRzIFBpbGxQYXJ0IHtcbiAgICBjb25zdHJ1Y3Rvcih1c2VySWQsIGRpc3BsYXlOYW1lLCBwcml2YXRlIG1lbWJlcjogUm9vbU1lbWJlcikge1xuICAgICAgICBzdXBlcih1c2VySWQsIGRpc3BsYXlOYW1lKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IHR5cGUoKTogSVBpbGxQYXJ0W1widHlwZVwiXSB7XG4gICAgICAgIHJldHVybiBUeXBlLlVzZXJQaWxsO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJteF9Vc2VyUGlsbCBteF9QaWxsXCI7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHNldEF2YXRhcihub2RlOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMubWVtYmVyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMubWVtYmVyLm5hbWUgfHwgdGhpcy5tZW1iZXIudXNlcklkO1xuICAgICAgICBjb25zdCBkZWZhdWx0QXZhdGFyVXJsID0gQXZhdGFyLmRlZmF1bHRBdmF0YXJVcmxGb3JTdHJpbmcodGhpcy5tZW1iZXIudXNlcklkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyVXJsID0gQXZhdGFyLmF2YXRhclVybEZvck1lbWJlcih0aGlzLm1lbWJlciwgMTYsIDE2LCBcImNyb3BcIik7XG4gICAgICAgIGxldCBpbml0aWFsTGV0dGVyID0gXCJcIjtcbiAgICAgICAgaWYgKGF2YXRhclVybCA9PT0gZGVmYXVsdEF2YXRhclVybCkge1xuICAgICAgICAgICAgaW5pdGlhbExldHRlciA9IEF2YXRhci5nZXRJbml0aWFsTGV0dGVyKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0QXZhdGFyVmFycyhub2RlLCBhdmF0YXJVcmwsIGluaXRpYWxMZXR0ZXIpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBvbkNsaWNrID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICBkZWZhdWx0RGlzcGF0Y2hlci5kaXNwYXRjaCh7XG4gICAgICAgICAgICBhY3Rpb246IEFjdGlvbi5WaWV3VXNlcixcbiAgICAgICAgICAgIG1lbWJlcjogdGhpcy5tZW1iZXIsXG4gICAgICAgIH0pO1xuICAgIH07XG59XG5cbmNsYXNzIFBpbGxDYW5kaWRhdGVQYXJ0IGV4dGVuZHMgUGxhaW5CYXNlUGFydCBpbXBsZW1lbnRzIElQaWxsQ2FuZGlkYXRlUGFydCB7XG4gICAgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLCBwcml2YXRlIGF1dG9Db21wbGV0ZUNyZWF0b3I6IElBdXRvY29tcGxldGVDcmVhdG9yKSB7XG4gICAgICAgIHN1cGVyKHRleHQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVBdXRvQ29tcGxldGUodXBkYXRlQ2FsbGJhY2s6IFVwZGF0ZUNhbGxiYWNrKTogQXV0b2NvbXBsZXRlV3JhcHBlck1vZGVsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXV0b0NvbXBsZXRlQ3JlYXRvci5jcmVhdGUodXBkYXRlQ2FsbGJhY2spO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBhY2NlcHRzSW5zZXJ0aW9uKGNocjogc3RyaW5nLCBvZmZzZXQ6IG51bWJlciwgaW5wdXRUeXBlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKG9mZnNldCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc3VwZXIuYWNjZXB0c0luc2VydGlvbihjaHIsIG9mZnNldCwgaW5wdXRUeXBlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBtZXJnZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBhY2NlcHRzUmVtb3ZhbChwb3NpdGlvbjogbnVtYmVyLCBjaHI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXQgdHlwZSgpOiBJUGlsbENhbmRpZGF0ZVBhcnRbXCJ0eXBlXCJdIHtcbiAgICAgICAgcmV0dXJuIFR5cGUuUGlsbENhbmRpZGF0ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBdXRvQ29tcGxldGVDcmVhdG9yKGdldEF1dG9jb21wbGV0ZXJDb21wb25lbnQ6IEdldEF1dG9jb21wbGV0ZXJDb21wb25lbnQsIHVwZGF0ZVF1ZXJ5OiBVcGRhdGVRdWVyeSkge1xuICAgIHJldHVybiAocGFydENyZWF0b3I6IFBhcnRDcmVhdG9yKSA9PiB7XG4gICAgICAgIHJldHVybiAodXBkYXRlQ2FsbGJhY2s6IFVwZGF0ZUNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEF1dG9jb21wbGV0ZVdyYXBwZXJNb2RlbChcbiAgICAgICAgICAgICAgICB1cGRhdGVDYWxsYmFjayxcbiAgICAgICAgICAgICAgICBnZXRBdXRvY29tcGxldGVyQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5LFxuICAgICAgICAgICAgICAgIHBhcnRDcmVhdG9yLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfTtcbiAgICB9O1xufVxuXG50eXBlIEF1dG9Db21wbGV0ZUNyZWF0b3IgPSBSZXR1cm5UeXBlPHR5cGVvZiBnZXRBdXRvQ29tcGxldGVDcmVhdG9yPjtcblxuaW50ZXJmYWNlIElBdXRvY29tcGxldGVDcmVhdG9yIHtcbiAgICBjcmVhdGUodXBkYXRlQ2FsbGJhY2s6IFVwZGF0ZUNhbGxiYWNrKTogQXV0b2NvbXBsZXRlV3JhcHBlck1vZGVsO1xufVxuXG5leHBvcnQgY2xhc3MgUGFydENyZWF0b3Ige1xuICAgIHByb3RlY3RlZCByZWFkb25seSBhdXRvQ29tcGxldGVDcmVhdG9yOiBJQXV0b2NvbXBsZXRlQ3JlYXRvcjtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IHJvb206IFJvb20sXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgY2xpZW50OiBNYXRyaXhDbGllbnQsXG4gICAgICAgIGF1dG9Db21wbGV0ZUNyZWF0b3I6IEF1dG9Db21wbGV0ZUNyZWF0b3IgPSBudWxsLFxuICAgICkge1xuICAgICAgICAvLyBwcmUtY3JlYXRlIHRoZSBjcmVhdG9yIGFzIGFuIG9iamVjdCBldmVuIHdpdGhvdXQgY2FsbGJhY2sgc28gaXQgY2FuIGFscmVhZHkgYmUgcGFzc2VkXG4gICAgICAgIC8vIHRvIFBpbGxDYW5kaWRhdGVQYXJ0IChlLmcuIHdoaWxlIGRlc2VyaWFsaXppbmcpIGFuZCBzZXQgbGF0ZXIgb25cbiAgICAgICAgdGhpcy5hdXRvQ29tcGxldGVDcmVhdG9yID0geyBjcmVhdGU6IGF1dG9Db21wbGV0ZUNyZWF0b3I/Lih0aGlzKSB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRBdXRvQ29tcGxldGVDcmVhdG9yKGF1dG9Db21wbGV0ZUNyZWF0b3I6IEF1dG9Db21wbGV0ZUNyZWF0b3IpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hdXRvQ29tcGxldGVDcmVhdG9yLmNyZWF0ZSA9IGF1dG9Db21wbGV0ZUNyZWF0b3IodGhpcyk7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZVBhcnRGb3JJbnB1dChpbnB1dDogc3RyaW5nLCBwYXJ0SW5kZXg6IG51bWJlciwgaW5wdXRUeXBlPzogc3RyaW5nKTogUGFydCB7XG4gICAgICAgIHN3aXRjaCAoaW5wdXRbMF0pIHtcbiAgICAgICAgICAgIGNhc2UgXCIjXCI6XG4gICAgICAgICAgICBjYXNlIFwiQFwiOlxuICAgICAgICAgICAgY2FzZSBcIjpcIjpcbiAgICAgICAgICAgIGNhc2UgXCIrXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGlsbENhbmRpZGF0ZShcIlwiKTtcbiAgICAgICAgICAgIGNhc2UgXCJcXG5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5ld2xpbmVQYXJ0KCk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUGxhaW5QYXJ0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlRGVmYXVsdFBhcnQodGV4dDogc3RyaW5nKTogUGFydCB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsYWluKHRleHQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBkZXNlcmlhbGl6ZVBhcnQocGFydDogU2VyaWFsaXplZFBhcnQpOiBQYXJ0IHtcbiAgICAgICAgc3dpdGNoIChwYXJ0LnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgVHlwZS5QbGFpbjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wbGFpbihwYXJ0LnRleHQpO1xuICAgICAgICAgICAgY2FzZSBUeXBlLk5ld2xpbmU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV3bGluZSgpO1xuICAgICAgICAgICAgY2FzZSBUeXBlLkF0Um9vbVBpbGw6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXRSb29tUGlsbChwYXJ0LnRleHQpO1xuICAgICAgICAgICAgY2FzZSBUeXBlLlBpbGxDYW5kaWRhdGU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGlsbENhbmRpZGF0ZShwYXJ0LnRleHQpO1xuICAgICAgICAgICAgY2FzZSBUeXBlLlJvb21QaWxsOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJvb21QaWxsKHBhcnQucmVzb3VyY2VJZCk7XG4gICAgICAgICAgICBjYXNlIFR5cGUuVXNlclBpbGw6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXNlclBpbGwocGFydC50ZXh0LCBwYXJ0LnJlc291cmNlSWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHBsYWluKHRleHQ6IHN0cmluZyk6IFBsYWluUGFydCB7XG4gICAgICAgIHJldHVybiBuZXcgUGxhaW5QYXJ0KHRleHQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZXdsaW5lKCk6IE5ld2xpbmVQYXJ0IHtcbiAgICAgICAgcmV0dXJuIG5ldyBOZXdsaW5lUGFydChcIlxcblwiKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcGlsbENhbmRpZGF0ZSh0ZXh0OiBzdHJpbmcpOiBQaWxsQ2FuZGlkYXRlUGFydCB7XG4gICAgICAgIHJldHVybiBuZXcgUGlsbENhbmRpZGF0ZVBhcnQodGV4dCwgdGhpcy5hdXRvQ29tcGxldGVDcmVhdG9yKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcm9vbVBpbGwoYWxpYXM6IHN0cmluZywgcm9vbUlkPzogc3RyaW5nKTogUm9vbVBpbGxQYXJ0IHtcbiAgICAgICAgbGV0IHJvb207XG4gICAgICAgIGlmIChyb29tSWQgfHwgYWxpYXNbMF0gIT09IFwiI1wiKSB7XG4gICAgICAgICAgICByb29tID0gdGhpcy5jbGllbnQuZ2V0Um9vbShyb29tSWQgfHwgYWxpYXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcm9vbSA9IHRoaXMuY2xpZW50LmdldFJvb21zKCkuZmluZCgocikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiByLmdldENhbm9uaWNhbEFsaWFzKCkgPT09IGFsaWFzIHx8XG4gICAgICAgICAgICAgICAgICAgICAgIHIuZ2V0QWx0QWxpYXNlcygpLmluY2x1ZGVzKGFsaWFzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUm9vbVBpbGxQYXJ0KGFsaWFzLCByb29tID8gcm9vbS5uYW1lIDogYWxpYXMsIHJvb20pO1xuICAgIH1cblxuICAgIHB1YmxpYyBhdFJvb21QaWxsKHRleHQ6IHN0cmluZyk6IEF0Um9vbVBpbGxQYXJ0IHtcbiAgICAgICAgcmV0dXJuIG5ldyBBdFJvb21QaWxsUGFydCh0ZXh0LCB0aGlzLnJvb20pO1xuICAgIH1cblxuICAgIHB1YmxpYyB1c2VyUGlsbChkaXNwbGF5TmFtZTogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyk6IFVzZXJQaWxsUGFydCB7XG4gICAgICAgIGNvbnN0IG1lbWJlciA9IHRoaXMucm9vbS5nZXRNZW1iZXIodXNlcklkKTtcbiAgICAgICAgcmV0dXJuIG5ldyBVc2VyUGlsbFBhcnQodXNlcklkLCBkaXNwbGF5TmFtZSwgbWVtYmVyKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlTWVudGlvblBhcnRzKFxuICAgICAgICBpbnNlcnRUcmFpbGluZ0NoYXJhY3RlcjogYm9vbGVhbixcbiAgICAgICAgZGlzcGxheU5hbWU6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgKTogW1VzZXJQaWxsUGFydCwgUGxhaW5QYXJ0XSB7XG4gICAgICAgIGNvbnN0IHBpbGwgPSB0aGlzLnVzZXJQaWxsKGRpc3BsYXlOYW1lLCB1c2VySWQpO1xuICAgICAgICBjb25zdCBwb3N0Zml4ID0gdGhpcy5wbGFpbihpbnNlcnRUcmFpbGluZ0NoYXJhY3RlciA/IFwiOiBcIiA6IFwiIFwiKTtcbiAgICAgICAgcmV0dXJuIFtwaWxsLCBwb3N0Zml4XTtcbiAgICB9XG59XG5cbi8vIHBhcnQgY3JlYXRvciB0aGF0IHN1cHBvcnQgYXV0byBjb21wbGV0ZSBmb3IgL2NvbW1hbmRzLFxuLy8gdXNlZCBpbiBTZW5kTWVzc2FnZUNvbXBvc2VyXG5leHBvcnQgY2xhc3MgQ29tbWFuZFBhcnRDcmVhdG9yIGV4dGVuZHMgUGFydENyZWF0b3Ige1xuICAgIHB1YmxpYyBjcmVhdGVQYXJ0Rm9ySW5wdXQodGV4dDogc3RyaW5nLCBwYXJ0SW5kZXg6IG51bWJlcik6IFBhcnQge1xuICAgICAgICAvLyBhdCBiZWdpbm5pbmcgYW5kIHN0YXJ0cyB3aXRoIC8/IGNyZWF0ZVxuICAgICAgICBpZiAocGFydEluZGV4ID09PSAwICYmIHRleHRbMF0gPT09IFwiL1wiKSB7XG4gICAgICAgICAgICAvLyB0ZXh0IHdpbGwgYmUgaW5zZXJ0ZWQgYnkgbW9kZWwsIHNvIHBhc3MgZW1wdHkgc3RyaW5nXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kKFwiXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmNyZWF0ZVBhcnRGb3JJbnB1dCh0ZXh0LCBwYXJ0SW5kZXgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNvbW1hbmQodGV4dDogc3RyaW5nKTogQ29tbWFuZFBhcnQge1xuICAgICAgICByZXR1cm4gbmV3IENvbW1hbmRQYXJ0KHRleHQsIHRoaXMuYXV0b0NvbXBsZXRlQ3JlYXRvcik7XG4gICAgfVxuXG4gICAgcHVibGljIGRlc2VyaWFsaXplUGFydChwYXJ0OiBTZXJpYWxpemVkUGFydCk6IFBhcnQge1xuICAgICAgICBpZiAocGFydC50eXBlID09PSBUeXBlLkNvbW1hbmQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbW1hbmQocGFydC50ZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5kZXNlcmlhbGl6ZVBhcnQocGFydCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIENvbW1hbmRQYXJ0IGV4dGVuZHMgUGlsbENhbmRpZGF0ZVBhcnQge1xuICAgIHB1YmxpYyBnZXQgdHlwZSgpOiBJUGlsbENhbmRpZGF0ZVBhcnRbXCJ0eXBlXCJdIHtcbiAgICAgICAgcmV0dXJuIFR5cGUuQ29tbWFuZDtcbiAgICB9XG59XG4iXX0=