"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.formatCallTime = formatCallTime;
exports.formatDate = formatDate;
exports.formatFullDate = formatFullDate;
exports.formatFullDateNoDay = formatFullDateNoDay;
exports.formatFullDateNoDayNoTime = formatFullDateNoDayNoTime;
exports.formatFullDateNoTime = formatFullDateNoTime;
exports.formatFullTime = formatFullTime;
exports.formatRelativeTime = formatRelativeTime;
exports.formatSeconds = formatSeconds;
exports.formatTime = formatTime;
exports.wantsDateSeparator = wantsDateSeparator;

var _languageHandler = require("./languageHandler");

/*
Copyright 2015, 2016 OpenMarket Ltd
Copyright 2017 Vector Creations Ltd

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
function getDaysArray() {
  return [(0, _languageHandler._t)('Sun'), (0, _languageHandler._t)('Mon'), (0, _languageHandler._t)('Tue'), (0, _languageHandler._t)('Wed'), (0, _languageHandler._t)('Thu'), (0, _languageHandler._t)('Fri'), (0, _languageHandler._t)('Sat')];
}

function getMonthsArray() {
  return [(0, _languageHandler._t)('Jan'), (0, _languageHandler._t)('Feb'), (0, _languageHandler._t)('Mar'), (0, _languageHandler._t)('Apr'), (0, _languageHandler._t)('May'), (0, _languageHandler._t)('Jun'), (0, _languageHandler._t)('Jul'), (0, _languageHandler._t)('Aug'), (0, _languageHandler._t)('Sep'), (0, _languageHandler._t)('Oct'), (0, _languageHandler._t)('Nov'), (0, _languageHandler._t)('Dec')];
}

function pad(n) {
  return (n < 10 ? '0' : '') + n;
}

function twelveHourTime(date, showSeconds = false) {
  let hours = date.getHours() % 12;
  const minutes = pad(date.getMinutes());
  const ampm = date.getHours() >= 12 ? (0, _languageHandler._t)('PM') : (0, _languageHandler._t)('AM');
  hours = hours ? hours : 12; // convert 0 -> 12

  if (showSeconds) {
    const seconds = pad(date.getSeconds());
    return `${hours}:${minutes}:${seconds}${ampm}`;
  }

  return `${hours}:${minutes}${ampm}`;
}

function formatDate(date, showTwelveHour = false) {
  const now = new Date();
  const days = getDaysArray();
  const months = getMonthsArray();

  if (date.toDateString() === now.toDateString()) {
    return formatTime(date, showTwelveHour);
  } else if (now.getTime() - date.getTime() < 6 * 24 * 60 * 60 * 1000) {
    // TODO: use standard date localize function provided in counterpart
    return (0, _languageHandler._t)('%(weekDayName)s %(time)s', {
      weekDayName: days[date.getDay()],
      time: formatTime(date, showTwelveHour)
    });
  } else if (now.getFullYear() === date.getFullYear()) {
    // TODO: use standard date localize function provided in counterpart
    return (0, _languageHandler._t)('%(weekDayName)s, %(monthName)s %(day)s %(time)s', {
      weekDayName: days[date.getDay()],
      monthName: months[date.getMonth()],
      day: date.getDate(),
      time: formatTime(date, showTwelveHour)
    });
  }

  return formatFullDate(date, showTwelveHour);
}

function formatFullDateNoTime(date) {
  const days = getDaysArray();
  const months = getMonthsArray();
  return (0, _languageHandler._t)('%(weekDayName)s, %(monthName)s %(day)s %(fullYear)s', {
    weekDayName: days[date.getDay()],
    monthName: months[date.getMonth()],
    day: date.getDate(),
    fullYear: date.getFullYear()
  });
}

function formatFullDate(date, showTwelveHour = false, showSeconds = true) {
  const days = getDaysArray();
  const months = getMonthsArray();
  return (0, _languageHandler._t)('%(weekDayName)s, %(monthName)s %(day)s %(fullYear)s %(time)s', {
    weekDayName: days[date.getDay()],
    monthName: months[date.getMonth()],
    day: date.getDate(),
    fullYear: date.getFullYear(),
    time: showSeconds ? formatFullTime(date, showTwelveHour) : formatTime(date, showTwelveHour)
  });
}

function formatFullTime(date, showTwelveHour = false) {
  if (showTwelveHour) {
    return twelveHourTime(date, true);
  }

  return pad(date.getHours()) + ':' + pad(date.getMinutes()) + ':' + pad(date.getSeconds());
}

function formatTime(date, showTwelveHour = false) {
  if (showTwelveHour) {
    return twelveHourTime(date);
  }

  return pad(date.getHours()) + ':' + pad(date.getMinutes());
}

function formatCallTime(delta) {
  const hours = delta.getUTCHours();
  const minutes = delta.getUTCMinutes();
  const seconds = delta.getUTCSeconds();
  let output = "";
  if (hours) output += `${hours}h `;
  if (minutes || output) output += `${minutes}m `;
  if (seconds || output) output += `${seconds}s`;
  return output;
}

function formatSeconds(inSeconds) {
  const hours = Math.floor(inSeconds / (60 * 60)).toFixed(0).padStart(2, '0');
  const minutes = Math.floor(inSeconds % (60 * 60) / 60).toFixed(0).padStart(2, '0');
  const seconds = Math.floor(inSeconds % (60 * 60) % 60).toFixed(0).padStart(2, '0');
  let output = "";
  if (hours !== "00") output += `${hours}:`;
  output += `${minutes}:${seconds}`;
  return output;
}

const MILLIS_IN_DAY = 86400000;

function withinPast24Hours(prevDate, nextDate) {
  return Math.abs(prevDate.getTime() - nextDate.getTime()) <= MILLIS_IN_DAY;
}

function withinCurrentYear(prevDate, nextDate) {
  return prevDate.getFullYear() === nextDate.getFullYear();
}

function wantsDateSeparator(prevEventDate, nextEventDate) {
  if (!nextEventDate || !prevEventDate) {
    return false;
  } // Return early for events that are > 24h apart


  if (!withinPast24Hours(prevEventDate, nextEventDate)) {
    return true;
  } // Compare weekdays


  return prevEventDate.getDay() !== nextEventDate.getDay();
}

function formatFullDateNoDay(date) {
  return (0, _languageHandler._t)("%(date)s at %(time)s", {
    date: date.toLocaleDateString().replace(/\//g, '-'),
    time: date.toLocaleTimeString().replace(/:/g, '-')
  });
}

function formatFullDateNoDayNoTime(date) {
  return date.getFullYear() + "/" + pad(date.getMonth() + 1) + "/" + pad(date.getDate());
}

function formatRelativeTime(date, showTwelveHour = false) {
  const now = new Date(Date.now());

  if (withinPast24Hours(date, now)) {
    return formatTime(date, showTwelveHour);
  } else {
    const months = getMonthsArray();
    let relativeDate = `${months[date.getMonth()]} ${date.getDate()}`;

    if (!withinCurrentYear(date, now)) {
      relativeDate += `, ${date.getFullYear()}`;
    }

    return relativeDate;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9EYXRlVXRpbHMudHMiXSwibmFtZXMiOlsiZ2V0RGF5c0FycmF5IiwiZ2V0TW9udGhzQXJyYXkiLCJwYWQiLCJuIiwidHdlbHZlSG91clRpbWUiLCJkYXRlIiwic2hvd1NlY29uZHMiLCJob3VycyIsImdldEhvdXJzIiwibWludXRlcyIsImdldE1pbnV0ZXMiLCJhbXBtIiwic2Vjb25kcyIsImdldFNlY29uZHMiLCJmb3JtYXREYXRlIiwic2hvd1R3ZWx2ZUhvdXIiLCJub3ciLCJEYXRlIiwiZGF5cyIsIm1vbnRocyIsInRvRGF0ZVN0cmluZyIsImZvcm1hdFRpbWUiLCJnZXRUaW1lIiwid2Vla0RheU5hbWUiLCJnZXREYXkiLCJ0aW1lIiwiZ2V0RnVsbFllYXIiLCJtb250aE5hbWUiLCJnZXRNb250aCIsImRheSIsImdldERhdGUiLCJmb3JtYXRGdWxsRGF0ZSIsImZvcm1hdEZ1bGxEYXRlTm9UaW1lIiwiZnVsbFllYXIiLCJmb3JtYXRGdWxsVGltZSIsImZvcm1hdENhbGxUaW1lIiwiZGVsdGEiLCJnZXRVVENIb3VycyIsImdldFVUQ01pbnV0ZXMiLCJnZXRVVENTZWNvbmRzIiwib3V0cHV0IiwiZm9ybWF0U2Vjb25kcyIsImluU2Vjb25kcyIsIk1hdGgiLCJmbG9vciIsInRvRml4ZWQiLCJwYWRTdGFydCIsIk1JTExJU19JTl9EQVkiLCJ3aXRoaW5QYXN0MjRIb3VycyIsInByZXZEYXRlIiwibmV4dERhdGUiLCJhYnMiLCJ3aXRoaW5DdXJyZW50WWVhciIsIndhbnRzRGF0ZVNlcGFyYXRvciIsInByZXZFdmVudERhdGUiLCJuZXh0RXZlbnREYXRlIiwiZm9ybWF0RnVsbERhdGVOb0RheSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsInJlcGxhY2UiLCJ0b0xvY2FsZVRpbWVTdHJpbmciLCJmb3JtYXRGdWxsRGF0ZU5vRGF5Tm9UaW1lIiwiZm9ybWF0UmVsYXRpdmVUaW1lIiwicmVsYXRpdmVEYXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7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cmlnaHQgMjAxNyBWZWN0b3IgQ3JlYXRpb25zIEx0ZFxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCB7IF90IH0gZnJvbSAnLi9sYW5ndWFnZUhhbmRsZXInO1xuXG5mdW5jdGlvbiBnZXREYXlzQXJyYXkoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbXG4gICAgICAgIF90KCdTdW4nKSxcbiAgICAgICAgX3QoJ01vbicpLFxuICAgICAgICBfdCgnVHVlJyksXG4gICAgICAgIF90KCdXZWQnKSxcbiAgICAgICAgX3QoJ1RodScpLFxuICAgICAgICBfdCgnRnJpJyksXG4gICAgICAgIF90KCdTYXQnKSxcbiAgICBdO1xufVxuXG5mdW5jdGlvbiBnZXRNb250aHNBcnJheSgpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgX3QoJ0phbicpLFxuICAgICAgICBfdCgnRmViJyksXG4gICAgICAgIF90KCdNYXInKSxcbiAgICAgICAgX3QoJ0FwcicpLFxuICAgICAgICBfdCgnTWF5JyksXG4gICAgICAgIF90KCdKdW4nKSxcbiAgICAgICAgX3QoJ0p1bCcpLFxuICAgICAgICBfdCgnQXVnJyksXG4gICAgICAgIF90KCdTZXAnKSxcbiAgICAgICAgX3QoJ09jdCcpLFxuICAgICAgICBfdCgnTm92JyksXG4gICAgICAgIF90KCdEZWMnKSxcbiAgICBdO1xufVxuXG5mdW5jdGlvbiBwYWQobjogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gKG4gPCAxMCA/ICcwJyA6ICcnKSArIG47XG59XG5cbmZ1bmN0aW9uIHR3ZWx2ZUhvdXJUaW1lKGRhdGU6IERhdGUsIHNob3dTZWNvbmRzID0gZmFsc2UpOiBzdHJpbmcge1xuICAgIGxldCBob3VycyA9IGRhdGUuZ2V0SG91cnMoKSAlIDEyO1xuICAgIGNvbnN0IG1pbnV0ZXMgPSBwYWQoZGF0ZS5nZXRNaW51dGVzKCkpO1xuICAgIGNvbnN0IGFtcG0gPSBkYXRlLmdldEhvdXJzKCkgPj0gMTIgPyBfdCgnUE0nKSA6IF90KCdBTScpO1xuICAgIGhvdXJzID0gaG91cnMgPyBob3VycyA6IDEyOyAvLyBjb252ZXJ0IDAgLT4gMTJcbiAgICBpZiAoc2hvd1NlY29uZHMpIHtcbiAgICAgICAgY29uc3Qgc2Vjb25kcyA9IHBhZChkYXRlLmdldFNlY29uZHMoKSk7XG4gICAgICAgIHJldHVybiBgJHtob3Vyc306JHttaW51dGVzfToke3NlY29uZHN9JHthbXBtfWA7XG4gICAgfVxuICAgIHJldHVybiBgJHtob3Vyc306JHttaW51dGVzfSR7YW1wbX1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlOiBEYXRlLCBzaG93VHdlbHZlSG91ciA9IGZhbHNlKTogc3RyaW5nIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGRheXMgPSBnZXREYXlzQXJyYXkoKTtcbiAgICBjb25zdCBtb250aHMgPSBnZXRNb250aHNBcnJheSgpO1xuICAgIGlmIChkYXRlLnRvRGF0ZVN0cmluZygpID09PSBub3cudG9EYXRlU3RyaW5nKCkpIHtcbiAgICAgICAgcmV0dXJuIGZvcm1hdFRpbWUoZGF0ZSwgc2hvd1R3ZWx2ZUhvdXIpO1xuICAgIH0gZWxzZSBpZiAobm93LmdldFRpbWUoKSAtIGRhdGUuZ2V0VGltZSgpIDwgNiAqIDI0ICogNjAgKiA2MCAqIDEwMDApIHtcbiAgICAgICAgLy8gVE9ETzogdXNlIHN0YW5kYXJkIGRhdGUgbG9jYWxpemUgZnVuY3Rpb24gcHJvdmlkZWQgaW4gY291bnRlcnBhcnRcbiAgICAgICAgcmV0dXJuIF90KCclKHdlZWtEYXlOYW1lKXMgJSh0aW1lKXMnLCB7XG4gICAgICAgICAgICB3ZWVrRGF5TmFtZTogZGF5c1tkYXRlLmdldERheSgpXSxcbiAgICAgICAgICAgIHRpbWU6IGZvcm1hdFRpbWUoZGF0ZSwgc2hvd1R3ZWx2ZUhvdXIpLFxuICAgICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKG5vdy5nZXRGdWxsWWVhcigpID09PSBkYXRlLmdldEZ1bGxZZWFyKCkpIHtcbiAgICAgICAgLy8gVE9ETzogdXNlIHN0YW5kYXJkIGRhdGUgbG9jYWxpemUgZnVuY3Rpb24gcHJvdmlkZWQgaW4gY291bnRlcnBhcnRcbiAgICAgICAgcmV0dXJuIF90KCclKHdlZWtEYXlOYW1lKXMsICUobW9udGhOYW1lKXMgJShkYXkpcyAlKHRpbWUpcycsIHtcbiAgICAgICAgICAgIHdlZWtEYXlOYW1lOiBkYXlzW2RhdGUuZ2V0RGF5KCldLFxuICAgICAgICAgICAgbW9udGhOYW1lOiBtb250aHNbZGF0ZS5nZXRNb250aCgpXSxcbiAgICAgICAgICAgIGRheTogZGF0ZS5nZXREYXRlKCksXG4gICAgICAgICAgICB0aW1lOiBmb3JtYXRUaW1lKGRhdGUsIHNob3dUd2VsdmVIb3VyKSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBmb3JtYXRGdWxsRGF0ZShkYXRlLCBzaG93VHdlbHZlSG91cik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRGdWxsRGF0ZU5vVGltZShkYXRlOiBEYXRlKTogc3RyaW5nIHtcbiAgICBjb25zdCBkYXlzID0gZ2V0RGF5c0FycmF5KCk7XG4gICAgY29uc3QgbW9udGhzID0gZ2V0TW9udGhzQXJyYXkoKTtcbiAgICByZXR1cm4gX3QoJyUod2Vla0RheU5hbWUpcywgJShtb250aE5hbWUpcyAlKGRheSlzICUoZnVsbFllYXIpcycsIHtcbiAgICAgICAgd2Vla0RheU5hbWU6IGRheXNbZGF0ZS5nZXREYXkoKV0sXG4gICAgICAgIG1vbnRoTmFtZTogbW9udGhzW2RhdGUuZ2V0TW9udGgoKV0sXG4gICAgICAgIGRheTogZGF0ZS5nZXREYXRlKCksXG4gICAgICAgIGZ1bGxZZWFyOiBkYXRlLmdldEZ1bGxZZWFyKCksXG4gICAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRGdWxsRGF0ZShkYXRlOiBEYXRlLCBzaG93VHdlbHZlSG91ciA9IGZhbHNlLCBzaG93U2Vjb25kcyA9IHRydWUpOiBzdHJpbmcge1xuICAgIGNvbnN0IGRheXMgPSBnZXREYXlzQXJyYXkoKTtcbiAgICBjb25zdCBtb250aHMgPSBnZXRNb250aHNBcnJheSgpO1xuICAgIHJldHVybiBfdCgnJSh3ZWVrRGF5TmFtZSlzLCAlKG1vbnRoTmFtZSlzICUoZGF5KXMgJShmdWxsWWVhcilzICUodGltZSlzJywge1xuICAgICAgICB3ZWVrRGF5TmFtZTogZGF5c1tkYXRlLmdldERheSgpXSxcbiAgICAgICAgbW9udGhOYW1lOiBtb250aHNbZGF0ZS5nZXRNb250aCgpXSxcbiAgICAgICAgZGF5OiBkYXRlLmdldERhdGUoKSxcbiAgICAgICAgZnVsbFllYXI6IGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgdGltZTogc2hvd1NlY29uZHMgPyBmb3JtYXRGdWxsVGltZShkYXRlLCBzaG93VHdlbHZlSG91cikgOiBmb3JtYXRUaW1lKGRhdGUsIHNob3dUd2VsdmVIb3VyKSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdEZ1bGxUaW1lKGRhdGU6IERhdGUsIHNob3dUd2VsdmVIb3VyID0gZmFsc2UpOiBzdHJpbmcge1xuICAgIGlmIChzaG93VHdlbHZlSG91cikge1xuICAgICAgICByZXR1cm4gdHdlbHZlSG91clRpbWUoZGF0ZSwgdHJ1ZSk7XG4gICAgfVxuICAgIHJldHVybiBwYWQoZGF0ZS5nZXRIb3VycygpKSArICc6JyArIHBhZChkYXRlLmdldE1pbnV0ZXMoKSkgKyAnOicgKyBwYWQoZGF0ZS5nZXRTZWNvbmRzKCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0VGltZShkYXRlOiBEYXRlLCBzaG93VHdlbHZlSG91ciA9IGZhbHNlKTogc3RyaW5nIHtcbiAgICBpZiAoc2hvd1R3ZWx2ZUhvdXIpIHtcbiAgICAgICAgcmV0dXJuIHR3ZWx2ZUhvdXJUaW1lKGRhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gcGFkKGRhdGUuZ2V0SG91cnMoKSkgKyAnOicgKyBwYWQoZGF0ZS5nZXRNaW51dGVzKCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0Q2FsbFRpbWUoZGVsdGE6IERhdGUpOiBzdHJpbmcge1xuICAgIGNvbnN0IGhvdXJzID0gZGVsdGEuZ2V0VVRDSG91cnMoKTtcbiAgICBjb25zdCBtaW51dGVzID0gZGVsdGEuZ2V0VVRDTWludXRlcygpO1xuICAgIGNvbnN0IHNlY29uZHMgPSBkZWx0YS5nZXRVVENTZWNvbmRzKCk7XG5cbiAgICBsZXQgb3V0cHV0ID0gXCJcIjtcbiAgICBpZiAoaG91cnMpIG91dHB1dCArPSBgJHtob3Vyc31oIGA7XG4gICAgaWYgKG1pbnV0ZXMgfHwgb3V0cHV0KSBvdXRwdXQgKz0gYCR7bWludXRlc31tIGA7XG4gICAgaWYgKHNlY29uZHMgfHwgb3V0cHV0KSBvdXRwdXQgKz0gYCR7c2Vjb25kc31zYDtcblxuICAgIHJldHVybiBvdXRwdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRTZWNvbmRzKGluU2Vjb25kczogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IoaW5TZWNvbmRzIC8gKDYwICogNjApKS50b0ZpeGVkKDApLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IoKGluU2Vjb25kcyAlICg2MCAqIDYwKSkgLyA2MCkudG9GaXhlZCgwKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKCgoaW5TZWNvbmRzICUgKDYwICogNjApKSAlIDYwKSkudG9GaXhlZCgwKS5wYWRTdGFydCgyLCAnMCcpO1xuXG4gICAgbGV0IG91dHB1dCA9IFwiXCI7XG4gICAgaWYgKGhvdXJzICE9PSBcIjAwXCIpIG91dHB1dCArPSBgJHtob3Vyc306YDtcbiAgICBvdXRwdXQgKz0gYCR7bWludXRlc306JHtzZWNvbmRzfWA7XG5cbiAgICByZXR1cm4gb3V0cHV0O1xufVxuXG5jb25zdCBNSUxMSVNfSU5fREFZID0gODY0MDAwMDA7XG5mdW5jdGlvbiB3aXRoaW5QYXN0MjRIb3VycyhwcmV2RGF0ZTogRGF0ZSwgbmV4dERhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gTWF0aC5hYnMocHJldkRhdGUuZ2V0VGltZSgpIC0gbmV4dERhdGUuZ2V0VGltZSgpKSA8PSBNSUxMSVNfSU5fREFZO1xufVxuXG5mdW5jdGlvbiB3aXRoaW5DdXJyZW50WWVhcihwcmV2RGF0ZTogRGF0ZSwgbmV4dERhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gcHJldkRhdGUuZ2V0RnVsbFllYXIoKSA9PT0gbmV4dERhdGUuZ2V0RnVsbFllYXIoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdhbnRzRGF0ZVNlcGFyYXRvcihwcmV2RXZlbnREYXRlOiBEYXRlLCBuZXh0RXZlbnREYXRlOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgaWYgKCFuZXh0RXZlbnREYXRlIHx8ICFwcmV2RXZlbnREYXRlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gUmV0dXJuIGVhcmx5IGZvciBldmVudHMgdGhhdCBhcmUgPiAyNGggYXBhcnRcbiAgICBpZiAoIXdpdGhpblBhc3QyNEhvdXJzKHByZXZFdmVudERhdGUsIG5leHRFdmVudERhdGUpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIENvbXBhcmUgd2Vla2RheXNcbiAgICByZXR1cm4gcHJldkV2ZW50RGF0ZS5nZXREYXkoKSAhPT0gbmV4dEV2ZW50RGF0ZS5nZXREYXkoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdEZ1bGxEYXRlTm9EYXkoZGF0ZTogRGF0ZSkge1xuICAgIHJldHVybiBfdChcIiUoZGF0ZSlzIGF0ICUodGltZSlzXCIsIHtcbiAgICAgICAgZGF0ZTogZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKS5yZXBsYWNlKC9cXC8vZywgJy0nKSxcbiAgICAgICAgdGltZTogZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcoKS5yZXBsYWNlKC86L2csICctJyksXG4gICAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRGdWxsRGF0ZU5vRGF5Tm9UaW1lKGRhdGU6IERhdGUpIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBkYXRlLmdldEZ1bGxZZWFyKCkgK1xuICAgICAgICBcIi9cIiArXG4gICAgICAgIHBhZChkYXRlLmdldE1vbnRoKCkgKyAxKSArXG4gICAgICAgIFwiL1wiICtcbiAgICAgICAgcGFkKGRhdGUuZ2V0RGF0ZSgpKVxuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRSZWxhdGl2ZVRpbWUoZGF0ZTogRGF0ZSwgc2hvd1R3ZWx2ZUhvdXIgPSBmYWxzZSk6IHN0cmluZyB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoRGF0ZS5ub3coKSk7XG4gICAgaWYgKHdpdGhpblBhc3QyNEhvdXJzKGRhdGUsIG5vdykpIHtcbiAgICAgICAgcmV0dXJuIGZvcm1hdFRpbWUoZGF0ZSwgc2hvd1R3ZWx2ZUhvdXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IG1vbnRocyA9IGdldE1vbnRoc0FycmF5KCk7XG4gICAgICAgIGxldCByZWxhdGl2ZURhdGUgPSBgJHttb250aHNbZGF0ZS5nZXRNb250aCgpXX0gJHtkYXRlLmdldERhdGUoKX1gO1xuXG4gICAgICAgIGlmICghd2l0aGluQ3VycmVudFllYXIoZGF0ZSwgbm93KSkge1xuICAgICAgICAgICAgcmVsYXRpdmVEYXRlICs9IGAsICR7ZGF0ZS5nZXRGdWxsWWVhcigpfWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlbGF0aXZlRGF0ZTtcbiAgICB9XG59XG4iXX0=