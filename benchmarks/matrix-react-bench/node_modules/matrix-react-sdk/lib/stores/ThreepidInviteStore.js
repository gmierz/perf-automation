"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _events = _interopRequireDefault(require("events"));

var _rfc = require("rfc4648");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

const STORAGE_PREFIX = "mx_threepid_invite_";

class ThreepidInviteStore extends _events.default {
  static get instance() {
    if (!ThreepidInviteStore._instance) {
      ThreepidInviteStore._instance = new ThreepidInviteStore();
    }

    return ThreepidInviteStore._instance;
  }

  storeInvite(roomId, wireInvite) {
    const invite = _objectSpread({
      roomId
    }, wireInvite);

    const id = this.generateIdOf(invite);
    localStorage.setItem(`${STORAGE_PREFIX}${id}`, JSON.stringify(invite));
    return this.translateInvite(invite);
  }

  getWireInvites() {
    const results = [];

    for (let i = 0; i < localStorage.length; i++) {
      const keyName = localStorage.key(i);
      if (!keyName.startsWith(STORAGE_PREFIX)) continue;
      results.push(JSON.parse(localStorage.getItem(keyName)));
    }

    return results;
  }

  getInvites() {
    return this.getWireInvites().map(i => this.translateInvite(i));
  } // Currently Element can only handle one invite at a time, so handle that


  pickBestInvite() {
    return this.getInvites()[0];
  }

  resolveInvite(invite) {
    localStorage.removeItem(`${STORAGE_PREFIX}${invite.id}`);
  }

  generateIdOf(persisted) {
    // Use a consistent "hash" to form an ID.
    return _rfc.base32.stringify(Buffer.from(JSON.stringify(persisted)));
  }

  translateInvite(persisted) {
    return {
      id: this.generateIdOf(persisted),
      roomId: persisted.roomId,
      toEmail: persisted.email,
      signUrl: persisted.signurl,
      roomName: persisted.room_name,
      roomAvatarUrl: persisted.room_avatar_url,
      inviterName: persisted.inviter_name
    };
  }

  translateToWireFormat(invite) {
    return {
      email: invite.toEmail,
      signurl: invite.signUrl,
      room_name: invite.roomName,
      room_avatar_url: invite.roomAvatarUrl,
      inviter_name: invite.inviterName
    };
  }

}

exports.default = ThreepidInviteStore;
(0, _defineProperty2.default)(ThreepidInviteStore, "_instance", void 0);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdG9yZXMvVGhyZWVwaWRJbnZpdGVTdG9yZS50cyJdLCJuYW1lcyI6WyJTVE9SQUdFX1BSRUZJWCIsIlRocmVlcGlkSW52aXRlU3RvcmUiLCJFdmVudEVtaXR0ZXIiLCJpbnN0YW5jZSIsIl9pbnN0YW5jZSIsInN0b3JlSW52aXRlIiwicm9vbUlkIiwid2lyZUludml0ZSIsImludml0ZSIsImlkIiwiZ2VuZXJhdGVJZE9mIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0cmFuc2xhdGVJbnZpdGUiLCJnZXRXaXJlSW52aXRlcyIsInJlc3VsdHMiLCJpIiwibGVuZ3RoIiwia2V5TmFtZSIsImtleSIsInN0YXJ0c1dpdGgiLCJwdXNoIiwicGFyc2UiLCJnZXRJdGVtIiwiZ2V0SW52aXRlcyIsIm1hcCIsInBpY2tCZXN0SW52aXRlIiwicmVzb2x2ZUludml0ZSIsInJlbW92ZUl0ZW0iLCJwZXJzaXN0ZWQiLCJiYXNlMzIiLCJCdWZmZXIiLCJmcm9tIiwidG9FbWFpbCIsImVtYWlsIiwic2lnblVybCIsInNpZ251cmwiLCJyb29tTmFtZSIsInJvb21fbmFtZSIsInJvb21BdmF0YXJVcmwiLCJyb29tX2F2YXRhcl91cmwiLCJpbnZpdGVyTmFtZSIsImludml0ZXJfbmFtZSIsInRyYW5zbGF0ZVRvV2lyZUZvcm1hdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7Ozs7OztBQTRDQSxNQUFNQSxjQUFjLEdBQUcscUJBQXZCOztBQUVlLE1BQU1DLG1CQUFOLFNBQWtDQyxlQUFsQyxDQUErQztBQUdoQyxhQUFSQyxRQUFRLEdBQXdCO0FBQzlDLFFBQUksQ0FBQ0YsbUJBQW1CLENBQUNHLFNBQXpCLEVBQW9DO0FBQ2hDSCxNQUFBQSxtQkFBbUIsQ0FBQ0csU0FBcEIsR0FBZ0MsSUFBSUgsbUJBQUosRUFBaEM7QUFDSDs7QUFDRCxXQUFPQSxtQkFBbUIsQ0FBQ0csU0FBM0I7QUFDSDs7QUFFTUMs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KlxuQ29weXJpZ2h0IDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgRXZlbnRFbWl0dGVyIGZyb20gXCJldmVudHNcIjtcbmltcG9ydCB7IGJhc2UzMiB9IGZyb20gXCJyZmM0NjQ4XCI7XG5pbXBvcnQgeyBSb29tVHlwZSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9AdHlwZXMvZXZlbnRcIjtcblxuLy8gRGV2IG5vdGU6IHRoZSBpbnRlcmZhY2UgaXMgc3BsaXQgaW4gdHdvIHNvIHdlIGRvbid0IGhhdmUgdG8gZGlzYWJsZSB0aGVcbi8vIGxpbnRlciBhY3Jvc3MgdGhlIHdob2xlIHByb2plY3QuXG5leHBvcnQgaW50ZXJmYWNlIElUaHJlZXBpZEludml0ZVdpcmVGb3JtYXQge1xuICAgIGVtYWlsOiBzdHJpbmc7XG4gICAgc2lnbnVybDogc3RyaW5nO1xuICAgIHJvb21fbmFtZTogc3RyaW5nOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNhbWVsY2FzZVxuICAgIHJvb21fYXZhdGFyX3VybDogc3RyaW5nOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNhbWVsY2FzZVxuICAgIGludml0ZXJfbmFtZTogc3RyaW5nOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNhbWVsY2FzZVxuXG4gICAgLy8gVE9ETzogRmlndXJlIG91dCBpZiB0aGVzZSBhcmUgZXZlciBwb3B1bGF0ZWRcbiAgICBndWVzdF9hY2Nlc3NfdG9rZW4/OiBzdHJpbmc7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG4gICAgZ3Vlc3RfdXNlcl9pZD86IHN0cmluZzsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcbn1cblxuaW50ZXJmYWNlIElQZXJzaXN0ZWRUaHJlZXBpZEludml0ZSBleHRlbmRzIElUaHJlZXBpZEludml0ZVdpcmVGb3JtYXQge1xuICAgIHJvb21JZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElUaHJlZXBpZEludml0ZSB7XG4gICAgaWQ6IHN0cmluZzsgLy8gZ2VuZXJhdGVkIGJ5IHVzXG4gICAgcm9vbUlkOiBzdHJpbmc7XG4gICAgdG9FbWFpbDogc3RyaW5nO1xuICAgIHNpZ25Vcmw6IHN0cmluZztcbiAgICByb29tTmFtZTogc3RyaW5nO1xuICAgIHJvb21BdmF0YXJVcmw6IHN0cmluZztcbiAgICBpbnZpdGVyTmFtZTogc3RyaW5nO1xufVxuXG4vLyBBbnkgZGF0YSBhYm91dCB0aGUgcm9vbSB0aGF0IHdvdWxkIG5vcm1hbGx5IGNvbWUgZnJvbSB0aGUgaG9tZXNlcnZlclxuLy8gYnV0IGhhcyBiZWVuIHBhc3NlZCBvdXQtb2YtYmFuZCwgZWcuIHRoZSByb29tIG5hbWUgYW5kIGF2YXRhciBVUkxcbi8vIGZyb20gYW4gZW1haWwgaW52aXRlIChhIHdvcmthcm91bmQgZm9yIHRoZSBmYWN0IHRoYXQgd2UgY2FuJ3Rcbi8vIGdldCB0aGlzIGluZm9ybWF0aW9uIGZyb20gdGhlIEhTIHVzaW5nIGFuIGVtYWlsIGludml0ZSkuXG5leHBvcnQgaW50ZXJmYWNlIElPT0JEYXRhIHtcbiAgICBuYW1lPzogc3RyaW5nOyAvLyBUaGUgcm9vbSdzIG5hbWVcbiAgICBhdmF0YXJVcmw/OiBzdHJpbmc7IC8vIFRoZSBteGM6Ly8gYXZhdGFyIFVSTCBmb3IgdGhlIHJvb21cbiAgICBpbnZpdGVyTmFtZT86IHN0cmluZzsgLy8gVGhlIGRpc3BsYXkgbmFtZSBvZiB0aGUgcGVyc29uIHdobyBpbnZpdGVkIHVzIHRvIHRoZSByb29tXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuICAgIHJvb21fbmFtZT86IHN0cmluZzsgLy8gVGhlIG5hbWUgb2YgdGhlIHJvb20sIHRvIGJlIHVzZWQgdW50aWwgd2UgYXJlIHRvbGQgYmV0dGVyIGJ5IHRoZSBzZXJ2ZXJcbiAgICByb29tVHlwZT86IFJvb21UeXBlOyAvLyBUaGUgdHlwZSBvZiB0aGUgcm9vbSwgdG8gYmUgdXNlZCB1bnRpbCB3ZSBhcmUgdG9sZCBiZXR0ZXIgYnkgdGhlIHNlcnZlclxufVxuXG5jb25zdCBTVE9SQUdFX1BSRUZJWCA9IFwibXhfdGhyZWVwaWRfaW52aXRlX1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaHJlZXBpZEludml0ZVN0b3JlIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgICBwcml2YXRlIHN0YXRpYyBfaW5zdGFuY2U6IFRocmVlcGlkSW52aXRlU3RvcmU7XG5cbiAgICBwdWJsaWMgc3RhdGljIGdldCBpbnN0YW5jZSgpOiBUaHJlZXBpZEludml0ZVN0b3JlIHtcbiAgICAgICAgaWYgKCFUaHJlZXBpZEludml0ZVN0b3JlLl9pbnN0YW5jZSkge1xuICAgICAgICAgICAgVGhyZWVwaWRJbnZpdGVTdG9yZS5faW5zdGFuY2UgPSBuZXcgVGhyZWVwaWRJbnZpdGVTdG9yZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBUaHJlZXBpZEludml0ZVN0b3JlLl9pbnN0YW5jZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RvcmVJbnZpdGUocm9vbUlkOiBzdHJpbmcsIHdpcmVJbnZpdGU6IElUaHJlZXBpZEludml0ZVdpcmVGb3JtYXQpOiBJVGhyZWVwaWRJbnZpdGUge1xuICAgICAgICBjb25zdCBpbnZpdGUgPSA8SVBlcnNpc3RlZFRocmVlcGlkSW52aXRlPnsgcm9vbUlkLCAuLi53aXJlSW52aXRlIH07XG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5nZW5lcmF0ZUlkT2YoaW52aXRlKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYCR7U1RPUkFHRV9QUkVGSVh9JHtpZH1gLCBKU09OLnN0cmluZ2lmeShpbnZpdGUpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlSW52aXRlKGludml0ZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFdpcmVJbnZpdGVzKCk6IElQZXJzaXN0ZWRUaHJlZXBpZEludml0ZVtdIHtcbiAgICAgICAgY29uc3QgcmVzdWx0czogSVBlcnNpc3RlZFRocmVlcGlkSW52aXRlW10gPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb2NhbFN0b3JhZ2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGtleU5hbWUgPSBsb2NhbFN0b3JhZ2Uua2V5KGkpO1xuICAgICAgICAgICAgaWYgKCFrZXlOYW1lLnN0YXJ0c1dpdGgoU1RPUkFHRV9QUkVGSVgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleU5hbWUpKSBhcyBJUGVyc2lzdGVkVGhyZWVwaWRJbnZpdGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRJbnZpdGVzKCk6IElUaHJlZXBpZEludml0ZVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0V2lyZUludml0ZXMoKS5tYXAoaSA9PiB0aGlzLnRyYW5zbGF0ZUludml0ZShpKSk7XG4gICAgfVxuXG4gICAgLy8gQ3VycmVudGx5IEVsZW1lbnQgY2FuIG9ubHkgaGFuZGxlIG9uZSBpbnZpdGUgYXQgYSB0aW1lLCBzbyBoYW5kbGUgdGhhdFxuICAgIHB1YmxpYyBwaWNrQmVzdEludml0ZSgpOiBJVGhyZWVwaWRJbnZpdGUge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnZpdGVzKClbMF07XG4gICAgfVxuXG4gICAgcHVibGljIHJlc29sdmVJbnZpdGUoaW52aXRlOiBJVGhyZWVwaWRJbnZpdGUpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYCR7U1RPUkFHRV9QUkVGSVh9JHtpbnZpdGUuaWR9YCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZW5lcmF0ZUlkT2YocGVyc2lzdGVkOiBJUGVyc2lzdGVkVGhyZWVwaWRJbnZpdGUpOiBzdHJpbmcge1xuICAgICAgICAvLyBVc2UgYSBjb25zaXN0ZW50IFwiaGFzaFwiIHRvIGZvcm0gYW4gSUQuXG4gICAgICAgIHJldHVybiBiYXNlMzIuc3RyaW5naWZ5KEJ1ZmZlci5mcm9tKEpTT04uc3RyaW5naWZ5KHBlcnNpc3RlZCkpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyYW5zbGF0ZUludml0ZShwZXJzaXN0ZWQ6IElQZXJzaXN0ZWRUaHJlZXBpZEludml0ZSk6IElUaHJlZXBpZEludml0ZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogdGhpcy5nZW5lcmF0ZUlkT2YocGVyc2lzdGVkKSxcbiAgICAgICAgICAgIHJvb21JZDogcGVyc2lzdGVkLnJvb21JZCxcbiAgICAgICAgICAgIHRvRW1haWw6IHBlcnNpc3RlZC5lbWFpbCxcbiAgICAgICAgICAgIHNpZ25Vcmw6IHBlcnNpc3RlZC5zaWdudXJsLFxuICAgICAgICAgICAgcm9vbU5hbWU6IHBlcnNpc3RlZC5yb29tX25hbWUsXG4gICAgICAgICAgICByb29tQXZhdGFyVXJsOiBwZXJzaXN0ZWQucm9vbV9hdmF0YXJfdXJsLFxuICAgICAgICAgICAgaW52aXRlck5hbWU6IHBlcnNpc3RlZC5pbnZpdGVyX25hbWUsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIHRyYW5zbGF0ZVRvV2lyZUZvcm1hdChpbnZpdGU6IElUaHJlZXBpZEludml0ZSk6IElUaHJlZXBpZEludml0ZVdpcmVGb3JtYXQge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZW1haWw6IGludml0ZS50b0VtYWlsLFxuICAgICAgICAgICAgc2lnbnVybDogaW52aXRlLnNpZ25VcmwsXG4gICAgICAgICAgICByb29tX25hbWU6IGludml0ZS5yb29tTmFtZSxcbiAgICAgICAgICAgIHJvb21fYXZhdGFyX3VybDogaW52aXRlLnJvb21BdmF0YXJVcmwsXG4gICAgICAgICAgICBpbnZpdGVyX25hbWU6IGludml0ZS5pbnZpdGVyTmFtZSxcbiAgICAgICAgfTtcbiAgICB9XG59XG4iXX0=