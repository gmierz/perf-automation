"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _MatrixClientPeg = require("../../../../MatrixClientPeg");

var _fileSaver = _interopRequireDefault(require("file-saver"));

var _languageHandler = require("../../../../languageHandler");

var _Modal = _interopRequireDefault(require("../../../../Modal"));

var _SecurityManager = require("../../../../SecurityManager");

var _strings = require("../../../../utils/strings");

var _InteractiveAuthEntryComponents = require("../../../../components/views/auth/InteractiveAuthEntryComponents");

var _PassphraseField = _interopRequireDefault(require("../../../../components/views/auth/PassphraseField"));

var _StyledRadioButton = _interopRequireDefault(require("../../../../components/views/elements/StyledRadioButton"));

var _AccessibleButton = _interopRequireDefault(require("../../../../components/views/elements/AccessibleButton"));

var _DialogButtons = _interopRequireDefault(require("../../../../components/views/elements/DialogButtons"));

var _InlineSpinner = _interopRequireDefault(require("../../../../components/views/elements/InlineSpinner"));

var _RestoreKeyBackupDialog = _interopRequireDefault(require("../../../../components/views/dialogs/security/RestoreKeyBackupDialog"));

var _WellKnownUtils = require("../../../../utils/WellKnownUtils");

var _Security = _interopRequireDefault(require("../../../../customisations/Security"));

var _logger = require("matrix-js-sdk/src/logger");

var _Field = _interopRequireDefault(require("../../../../components/views/elements/Field"));

var _BaseDialog = _interopRequireDefault(require("../../../../components/views/dialogs/BaseDialog"));

var _Spinner = _interopRequireDefault(require("../../../../components/views/elements/Spinner"));

var _InteractiveAuthDialog = _interopRequireDefault(require("../../../../components/views/dialogs/InteractiveAuthDialog"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2018, 2019 New Vector Ltd
Copyright 2019, 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
// I made a mistake while converting this and it has to be fixed!
var Phase;

(function (Phase) {
  Phase["Loading"] = "loading";
  Phase["LoadError"] = "load_error";
  Phase["ChooseKeyPassphrase"] = "choose_key_passphrase";
  Phase["Migrate"] = "migrate";
  Phase["Passphrase"] = "passphrase";
  Phase["PassphraseConfirm"] = "passphrase_confirm";
  Phase["ShowKey"] = "show_key";
  Phase["Storing"] = "storing";
  Phase["ConfirmSkip"] = "confirm_skip";
})(Phase || (Phase = {}));

const PASSWORD_MIN_SCORE = 4; // So secure, many characters, much complex, wow, etc, etc.

/*
 * Walks the user through the process of creating a passphrase to guard Secure
 * Secret Storage in account data.
 */
class CreateSecretStorageDialog extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "recoveryKey", void 0);
    (0, _defineProperty2.default)(this, "backupKey", void 0);
    (0, _defineProperty2.default)(this, "recoveryKeyNode", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "passphraseField", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "onKeyBackupStatusChange", () => {
      if (this.state.phase === Phase.Migrate) this.fetchBackupInfo();
    });
    (0, _defineProperty2.default)(this, "onKeyPassphraseChange", e => {
      this.setState({
        passPhraseKeySelected: e.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onChooseKeyPassphraseFormSubmit", async () => {
      if (this.state.passPhraseKeySelected === _WellKnownUtils.SecureBackupSetupMethod.Key) {
        this.recoveryKey = await _MatrixClientPeg.MatrixClientPeg.get().createRecoveryKeyFromPassphrase();
        this.setState({
          copied: false,
          downloaded: false,
          setPassphrase: false,
          phase: Phase.ShowKey
        });
      } else {
        this.setState({
          copied: false,
          downloaded: false,
          phase: Phase.Passphrase
        });
      }
    });
    (0, _defineProperty2.default)(this, "onMigrateFormSubmit", e => {
      e.preventDefault();

      if (this.state.backupSigStatus.usable) {
        this.bootstrapSecretStorage();
      } else {
        this.restoreBackup();
      }
    });
    (0, _defineProperty2.default)(this, "onCopyClick", () => {
      const successful = (0, _strings.copyNode)(this.recoveryKeyNode.current);

      if (successful) {
        this.setState({
          copied: true
        });
      }
    });
    (0, _defineProperty2.default)(this, "onDownloadClick", () => {
      const blob = new Blob([this.recoveryKey.encodedPrivateKey], {
        type: 'text/plain;charset=us-ascii'
      });

      _fileSaver.default.saveAs(blob, 'security-key.txt');

      this.setState({
        downloaded: true
      });
    });
    (0, _defineProperty2.default)(this, "doBootstrapUIAuth", async makeRequest => {
      if (this.state.canUploadKeysWithPasswordOnly && this.state.accountPassword) {
        await makeRequest({
          type: 'm.login.password',
          identifier: {
            type: 'm.id.user',
            user: _MatrixClientPeg.MatrixClientPeg.get().getUserId()
          },
          // TODO: Remove `user` once servers support proper UIA
          // See https://github.com/matrix-org/synapse/issues/5665
          user: _MatrixClientPeg.MatrixClientPeg.get().getUserId(),
          password: this.state.accountPassword
        });
      } else {
        const dialogAesthetics = {
          [_InteractiveAuthEntryComponents.SSOAuthEntry.PHASE_PREAUTH]: {
            title: (0, _languageHandler._t)("Use Single Sign On to continue"),
            body: (0, _languageHandler._t)("To continue, use Single Sign On to prove your identity."),
            continueText: (0, _languageHandler._t)("Single Sign On"),
            continueKind: "primary"
          },
          [_InteractiveAuthEntryComponents.SSOAuthEntry.PHASE_POSTAUTH]: {
            title: (0, _languageHandler._t)("Confirm encryption setup"),
            body: (0, _languageHandler._t)("Click the button below to confirm setting up encryption."),
            continueText: (0, _languageHandler._t)("Confirm"),
            continueKind: "primary"
          }
        };

        const {
          finished
        } = _Modal.default.createTrackedDialog('Cross-signing keys dialog', '', _InteractiveAuthDialog.default, {
          title: (0, _languageHandler._t)("Setting up keys"),
          matrixClient: _MatrixClientPeg.MatrixClientPeg.get(),
          makeRequest,
          aestheticsForStagePhases: {
            [_InteractiveAuthEntryComponents.SSOAuthEntry.LOGIN_TYPE]: dialogAesthetics,
            [_InteractiveAuthEntryComponents.SSOAuthEntry.UNSTABLE_LOGIN_TYPE]: dialogAesthetics
          }
        });

        const [confirmed] = await finished;

        if (!confirmed) {
          throw new Error("Cross-signing key upload auth canceled");
        }
      }
    });
    (0, _defineProperty2.default)(this, "bootstrapSecretStorage", async () => {
      this.setState({
        phase: Phase.Storing,
        error: null
      });

      const cli = _MatrixClientPeg.MatrixClientPeg.get();

      const {
        forceReset
      } = this.props;

      try {
        if (forceReset) {
          _logger.logger.log("Forcing secret storage reset");

          await cli.bootstrapSecretStorage({
            createSecretStorageKey: async () => this.recoveryKey,
            setupNewKeyBackup: true,
            setupNewSecretStorage: true
          });
        } else {
          // For password authentication users after 2020-09, this cross-signing
          // step will be a no-op since it is now setup during registration or login
          // when needed. We should keep this here to cover other cases such as:
          //   * Users with existing sessions prior to 2020-09 changes
          //   * SSO authentication users which require interactive auth to upload
          //     keys (and also happen to skip all post-authentication flows at the
          //     moment via token login)
          await cli.bootstrapCrossSigning({
            authUploadDeviceSigningKeys: this.doBootstrapUIAuth
          });
          await cli.bootstrapSecretStorage({
            createSecretStorageKey: async () => this.recoveryKey,
            keyBackupInfo: this.state.backupInfo,
            setupNewKeyBackup: !this.state.backupInfo,
            getKeyBackupPassphrase: async () => {
              // We may already have the backup key if we earlier went
              // through the restore backup path, so pass it along
              // rather than prompting again.
              if (this.backupKey) {
                return this.backupKey;
              }

              return (0, _SecurityManager.promptForBackupPassphrase)();
            }
          });
        }

        this.props.onFinished(true);
      } catch (e) {
        if (this.state.canUploadKeysWithPasswordOnly && e.httpStatus === 401 && e.data.flows) {
          this.setState({
            accountPassword: '',
            accountPasswordCorrect: false,
            phase: Phase.Migrate
          });
        } else {
          this.setState({
            error: e
          });
        }

        _logger.logger.error("Error bootstrapping secret storage", e);
      }
    });
    (0, _defineProperty2.default)(this, "onCancel", () => {
      this.props.onFinished(false);
    });
    (0, _defineProperty2.default)(this, "restoreBackup", async () => {
      // It's possible we'll need the backup key later on for bootstrapping,
      // so let's stash it here, rather than prompting for it twice.
      const keyCallback = k => this.backupKey = k;

      const {
        finished
      } = _Modal.default.createTrackedDialog('Restore Backup', '', _RestoreKeyBackupDialog.default, {
        showSummary: false,
        keyCallback
      }, null,
      /* priority = */
      false,
      /* static = */
      false);

      await finished;
      const {
        backupSigStatus
      } = await this.fetchBackupInfo();

      if (backupSigStatus.usable && this.state.canUploadKeysWithPasswordOnly && this.state.accountPassword) {
        this.bootstrapSecretStorage();
      }
    });
    (0, _defineProperty2.default)(this, "onLoadRetryClick", () => {
      this.setState({
        phase: Phase.Loading
      });
      this.fetchBackupInfo();
    });
    (0, _defineProperty2.default)(this, "onShowKeyContinueClick", () => {
      this.bootstrapSecretStorage();
    });
    (0, _defineProperty2.default)(this, "onCancelClick", () => {
      this.setState({
        phase: Phase.ConfirmSkip
      });
    });
    (0, _defineProperty2.default)(this, "onGoBackClick", () => {
      this.setState({
        phase: Phase.ChooseKeyPassphrase
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseNextClick", async e => {
      e.preventDefault();
      if (!this.passphraseField.current) return; // unmounting

      await this.passphraseField.current.validate({
        allowEmpty: false
      });

      if (!this.passphraseField.current.state.valid) {
        this.passphraseField.current.focus();
        this.passphraseField.current.validate({
          allowEmpty: false,
          focused: true
        });
        return;
      }

      this.setState({
        phase: Phase.PassphraseConfirm
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseConfirmNextClick", async e => {
      e.preventDefault();
      if (this.state.passPhrase !== this.state.passPhraseConfirm) return;
      this.recoveryKey = await _MatrixClientPeg.MatrixClientPeg.get().createRecoveryKeyFromPassphrase(this.state.passPhrase);
      this.setState({
        copied: false,
        downloaded: false,
        setPassphrase: true,
        phase: Phase.ShowKey
      });
    });
    (0, _defineProperty2.default)(this, "onSetAgainClick", () => {
      this.setState({
        passPhrase: '',
        passPhraseValid: false,
        passPhraseConfirm: '',
        phase: Phase.Passphrase
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseValidate", result => {
      this.setState({
        passPhraseValid: result.valid
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseChange", e => {
      this.setState({
        passPhrase: e.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseConfirmChange", e => {
      this.setState({
        passPhraseConfirm: e.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onAccountPasswordChange", e => {
      this.setState({
        accountPassword: e.target.value
      });
    });
    let passPhraseKeySelected;
    const setupMethods = (0, _WellKnownUtils.getSecureBackupSetupMethods)();

    if (setupMethods.includes(_WellKnownUtils.SecureBackupSetupMethod.Key)) {
      passPhraseKeySelected = _WellKnownUtils.SecureBackupSetupMethod.Key;
    } else {
      passPhraseKeySelected = _WellKnownUtils.SecureBackupSetupMethod.Passphrase;
    }

    const accountPassword = props.accountPassword || "";
    let canUploadKeysWithPasswordOnly = null;

    if (accountPassword) {
      // If we have an account password in memory, let's simplify and
      // assume it means password auth is also supported for device
      // signing key upload as well. This avoids hitting the server to
      // test auth flows, which may be slow under high load.
      canUploadKeysWithPasswordOnly = true;
    } else {
      this.queryKeyUploadAuth();
    }

    this.state = {
      phase: Phase.Loading,
      passPhrase: '',
      passPhraseValid: false,
      passPhraseConfirm: '',
      copied: false,
      downloaded: false,
      setPassphrase: false,
      backupInfo: null,
      backupSigStatus: null,
      // does the server offer a UI auth flow with just m.login.password
      // for /keys/device_signing/upload?
      accountPasswordCorrect: null,
      canSkip: !(0, _WellKnownUtils.isSecureBackupRequired)(),
      canUploadKeysWithPasswordOnly,
      passPhraseKeySelected,
      accountPassword
    };

    _MatrixClientPeg.MatrixClientPeg.get().on('crypto.keyBackupStatus', this.onKeyBackupStatusChange);

    this.getInitialPhase();
  }

  componentWillUnmount() {
    _MatrixClientPeg.MatrixClientPeg.get().removeListener('crypto.keyBackupStatus', this.onKeyBackupStatusChange);
  }

  getInitialPhase() {
    var _SecurityCustomisatio;

    const keyFromCustomisations = (_SecurityCustomisatio = _Security.default.createSecretStorageKey) === null || _SecurityCustomisatio === void 0 ? void 0 : _SecurityCustomisatio.call(_Security.default);

    if (keyFromCustomisations) {
      _logger.logger.log("Created key via customisations, jumping to bootstrap step");

      this.recoveryKey = {
        privateKey: keyFromCustomisations
      };
      this.bootstrapSecretStorage();
      return;
    }

    this.fetchBackupInfo();
  }

  async fetchBackupInfo() {
    try {
      const backupInfo = await _MatrixClientPeg.MatrixClientPeg.get().getKeyBackupVersion();
      const backupSigStatus = // we may not have started crypto yet, in which case we definitely don't trust the backup
      _MatrixClientPeg.MatrixClientPeg.get().isCryptoEnabled() && (await _MatrixClientPeg.MatrixClientPeg.get().isKeyBackupTrusted(backupInfo));
      const {
        forceReset
      } = this.props;
      const phase = backupInfo && !forceReset ? Phase.Migrate : Phase.ChooseKeyPassphrase;
      this.setState({
        phase,
        backupInfo,
        backupSigStatus
      });
      return {
        backupInfo,
        backupSigStatus
      };
    } catch (e) {
      this.setState({
        phase: Phase.LoadError
      });
    }
  }

  async queryKeyUploadAuth() {
    try {
      await _MatrixClientPeg.MatrixClientPeg.get().uploadDeviceSigningKeys(null, {}); // We should never get here: the server should always require
      // UI auth to upload device signing keys. If we do, we upload
      // no keys which would be a no-op.

      _logger.logger.log("uploadDeviceSigningKeys unexpectedly succeeded without UI auth!");
    } catch (error) {
      if (!error.data || !error.data.flows) {
        _logger.logger.log("uploadDeviceSigningKeys advertised no flows!");

        return;
      }

      const canUploadKeysWithPasswordOnly = error.data.flows.some(f => {
        return f.stages.length === 1 && f.stages[0] === 'm.login.password';
      });
      this.setState({
        canUploadKeysWithPasswordOnly
      });
    }
  }

  renderOptionKey() {
    return /*#__PURE__*/_react.default.createElement(_StyledRadioButton.default, {
      key: _WellKnownUtils.SecureBackupSetupMethod.Key,
      value: _WellKnownUtils.SecureBackupSetupMethod.Key,
      name: "keyPassphrase",
      checked: this.state.passPhraseKeySelected === _WellKnownUtils.SecureBackupSetupMethod.Key,
      onChange: this.onKeyPassphraseChange,
      outlined: true
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_optionTitle"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_CreateSecretStorageDialog_optionIcon mx_CreateSecretStorageDialog_optionIcon_secureBackup"
    }), (0, _languageHandler._t)("Generate a Security Key")), /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("We'll generate a Security Key for you to store somewhere safe, like a password manager or a safe.")));
  }

  renderOptionPassphrase() {
    return /*#__PURE__*/_react.default.createElement(_StyledRadioButton.default, {
      key: _WellKnownUtils.SecureBackupSetupMethod.Passphrase,
      value: _WellKnownUtils.SecureBackupSetupMethod.Passphrase,
      name: "keyPassphrase",
      checked: this.state.passPhraseKeySelected === _WellKnownUtils.SecureBackupSetupMethod.Passphrase,
      onChange: this.onKeyPassphraseChange,
      outlined: true
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_optionTitle"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_CreateSecretStorageDialog_optionIcon mx_CreateSecretStorageDialog_optionIcon_securePhrase"
    }), (0, _languageHandler._t)("Enter a Security Phrase")), /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Use a secret phrase only you know, and optionally save a Security Key to use for backup.")));
  }

  renderPhaseChooseKeyPassphrase() {
    const setupMethods = (0, _WellKnownUtils.getSecureBackupSetupMethods)();
    const optionKey = setupMethods.includes(_WellKnownUtils.SecureBackupSetupMethod.Key) ? this.renderOptionKey() : null;
    const optionPassphrase = setupMethods.includes(_WellKnownUtils.SecureBackupSetupMethod.Passphrase) ? this.renderOptionPassphrase() : null;
    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onChooseKeyPassphraseFormSubmit
    }, /*#__PURE__*/_react.default.createElement("p", {
      className: "mx_CreateSecretStorageDialog_centeredBody"
    }, (0, _languageHandler._t)("Safeguard against losing access to encrypted messages & data by " + "backing up encryption keys on your server.")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_primaryContainer",
      role: "radiogroup"
    }, optionKey, optionPassphrase), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)("Continue"),
      onPrimaryButtonClick: this.onChooseKeyPassphraseFormSubmit,
      onCancel: this.onCancelClick,
      hasCancel: this.state.canSkip
    }));
  }

  renderPhaseMigrate() {
    // TODO: This is a temporary screen so people who have the labs flag turned on and
    // click the button are aware they're making a change to their account.
    // Once we're confident enough in this (and it's supported enough) we can do
    // it automatically.
    // https://github.com/vector-im/element-web/issues/11696
    let authPrompt;
    let nextCaption = (0, _languageHandler._t)("Next");

    if (this.state.canUploadKeysWithPasswordOnly) {
      authPrompt = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Enter your account password to confirm the upgrade:")), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_Field.default, {
        type: "password",
        label: (0, _languageHandler._t)("Password"),
        value: this.state.accountPassword,
        onChange: this.onAccountPasswordChange,
        forceValidity: this.state.accountPasswordCorrect === false ? false : null,
        autoFocus: true
      })));
    } else if (!this.state.backupSigStatus.usable) {
      authPrompt = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Restore your key backup to upgrade your encryption")));
      nextCaption = (0, _languageHandler._t)("Restore");
    } else {
      authPrompt = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You'll need to authenticate with the server to confirm the upgrade."));
    }

    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onMigrateFormSubmit
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Upgrade this session to allow it to verify other sessions, " + "granting them access to encrypted messages and marking them " + "as trusted for other users.")), /*#__PURE__*/_react.default.createElement("div", null, authPrompt), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: nextCaption,
      onPrimaryButtonClick: this.onMigrateFormSubmit,
      hasCancel: false,
      primaryDisabled: this.state.canUploadKeysWithPasswordOnly && !this.state.accountPassword
    }, /*#__PURE__*/_react.default.createElement("button", {
      type: "button",
      className: "danger",
      onClick: this.onCancelClick
    }, (0, _languageHandler._t)('Skip'))));
  }

  renderPhasePassPhrase() {
    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onPassPhraseNextClick
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Enter a security phrase only you know, as it's used to safeguard your data. " + "To be secure, you shouldn't re-use your account password.")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_passPhraseContainer"
    }, /*#__PURE__*/_react.default.createElement(_PassphraseField.default, {
      className: "mx_CreateSecretStorageDialog_passPhraseField",
      onChange: this.onPassPhraseChange,
      minScore: PASSWORD_MIN_SCORE,
      value: this.state.passPhrase,
      onValidate: this.onPassPhraseValidate,
      fieldRef: this.passphraseField,
      autoFocus: true,
      label: (0, _languageHandler._td)("Enter a Security Phrase"),
      labelEnterPassword: (0, _languageHandler._td)("Enter a Security Phrase"),
      labelStrongPassword: (0, _languageHandler._td)("Great! This Security Phrase looks strong enough."),
      labelAllowedButUnsafe: (0, _languageHandler._td)("Great! This Security Phrase looks strong enough.")
    })), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('Continue'),
      onPrimaryButtonClick: this.onPassPhraseNextClick,
      hasCancel: false,
      disabled: !this.state.passPhraseValid
    }, /*#__PURE__*/_react.default.createElement("button", {
      type: "button",
      onClick: this.onCancelClick,
      className: "danger"
    }, (0, _languageHandler._t)("Cancel"))));
  }

  renderPhasePassPhraseConfirm() {
    let matchText;
    let changeText;

    if (this.state.passPhraseConfirm === this.state.passPhrase) {
      matchText = (0, _languageHandler._t)("That matches!");
      changeText = (0, _languageHandler._t)("Use a different passphrase?");
    } else if (!this.state.passPhrase.startsWith(this.state.passPhraseConfirm)) {
      // only tell them they're wrong if they've actually gone wrong.
      // Security concious readers will note that if you left element-web unattended
      // on this screen, this would make it easy for a malicious person to guess
      // your passphrase one letter at a time, but they could get this faster by
      // just opening the browser's developer tools and reading it.
      // Note that not having typed anything at all will not hit this clause and
      // fall through so empty box === no hint.
      matchText = (0, _languageHandler._t)("That doesn't match.");
      changeText = (0, _languageHandler._t)("Go back to set it again.");
    }

    let passPhraseMatch = null;

    if (matchText) {
      passPhraseMatch = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", null, matchText), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        element: "span",
        className: "mx_linkButton",
        onClick: this.onSetAgainClick
      }, changeText)));
    }

    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onPassPhraseConfirmNextClick
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Enter your Security Phrase a second time to confirm it.")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_passPhraseContainer"
    }, /*#__PURE__*/_react.default.createElement(_Field.default, {
      type: "password",
      onChange: this.onPassPhraseConfirmChange,
      value: this.state.passPhraseConfirm,
      className: "mx_CreateSecretStorageDialog_passPhraseField",
      label: (0, _languageHandler._t)("Confirm your Security Phrase"),
      autoFocus: true,
      autoComplete: "new-password"
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_passPhraseMatch"
    }, passPhraseMatch)), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('Continue'),
      onPrimaryButtonClick: this.onPassPhraseConfirmNextClick,
      hasCancel: false,
      disabled: this.state.passPhrase !== this.state.passPhraseConfirm
    }, /*#__PURE__*/_react.default.createElement("button", {
      type: "button",
      onClick: this.onCancelClick,
      className: "danger"
    }, (0, _languageHandler._t)("Skip"))));
  }

  renderPhaseShowKey() {
    let continueButton;

    if (this.state.phase === Phase.ShowKey) {
      continueButton = /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
        primaryButton: (0, _languageHandler._t)("Continue"),
        disabled: !this.state.downloaded && !this.state.copied && !this.state.setPassphrase,
        onPrimaryButtonClick: this.onShowKeyContinueClick,
        hasCancel: false
      });
    } else {
      continueButton = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_CreateSecretStorageDialog_continueSpinner"
      }, /*#__PURE__*/_react.default.createElement(_InlineSpinner.default, null));
    }

    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Store your Security Key somewhere safe, like a password manager or a safe, " + "as it's used to safeguard your encrypted data.")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_primaryContainer mx_CreateSecretStorageDialog_recoveryKeyPrimarycontainer"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_recoveryKeyContainer"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_recoveryKey"
    }, /*#__PURE__*/_react.default.createElement("code", {
      ref: this.recoveryKeyNode
    }, this.recoveryKey.encodedPrivateKey)), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateSecretStorageDialog_recoveryKeyButtons"
    }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "primary",
      className: "mx_Dialog_primary",
      onClick: this.onDownloadClick,
      disabled: this.state.phase === Phase.Storing
    }, (0, _languageHandler._t)("Download")), /*#__PURE__*/_react.default.createElement("span", null, (0, _languageHandler._t)("or")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "primary",
      className: "mx_Dialog_primary mx_CreateSecretStorageDialog_recoveryKeyButtons_copyBtn",
      onClick: this.onCopyClick,
      disabled: this.state.phase === Phase.Storing
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_CreateSecretStorageDialog_recoveryKeyCopyButtonText",
      style: {
        height: this.state.copied ? '0' : 'auto'
      },
      "aria-hidden": this.state.copied
    }, (0, _languageHandler._t)("Copy")), /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_CreateSecretStorageDialog_recoveryKeyCopyButtonText",
      style: {
        height: this.state.copied ? 'auto' : '0'
      },
      "aria-hidden": !this.state.copied
    }, (0, _languageHandler._t)("Copied!")))))), continueButton);
  }

  renderBusyPhase() {
    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_Spinner.default, null));
  }

  renderPhaseLoadError() {
    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Unable to query secret storage status")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_Dialog_buttons"
    }, /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('Retry'),
      onPrimaryButtonClick: this.onLoadRetryClick,
      hasCancel: this.state.canSkip,
      onCancel: this.onCancel
    })));
  }

  renderPhaseSkipConfirm() {
    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("If you cancel now, you may lose encrypted messages & data if you lose access to your logins.")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("You can also set up Secure Backup & manage your keys in Settings.")), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('Go back'),
      onPrimaryButtonClick: this.onGoBackClick,
      hasCancel: false
    }, /*#__PURE__*/_react.default.createElement("button", {
      type: "button",
      className: "danger",
      onClick: this.onCancel
    }, (0, _languageHandler._t)('Cancel'))));
  }

  titleForPhase(phase) {
    switch (phase) {
      case Phase.ChooseKeyPassphrase:
        return (0, _languageHandler._t)('Set up Secure Backup');

      case Phase.Migrate:
        return (0, _languageHandler._t)('Upgrade your encryption');

      case Phase.Passphrase:
        return (0, _languageHandler._t)('Set a Security Phrase');

      case Phase.PassphraseConfirm:
        return (0, _languageHandler._t)('Confirm Security Phrase');

      case Phase.ConfirmSkip:
        return (0, _languageHandler._t)('Are you sure?');

      case Phase.ShowKey:
        return (0, _languageHandler._t)('Save your Security Key');

      case Phase.Storing:
        return (0, _languageHandler._t)('Setting up keys');

      default:
        return '';
    }
  }

  render() {
    let content;

    if (this.state.error) {
      content = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Unable to set up secret storage")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_Dialog_buttons"
      }, /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
        primaryButton: (0, _languageHandler._t)('Retry'),
        onPrimaryButtonClick: this.bootstrapSecretStorage,
        hasCancel: this.state.canSkip,
        onCancel: this.onCancel
      })));
    } else {
      switch (this.state.phase) {
        case Phase.Loading:
          content = this.renderBusyPhase();
          break;

        case Phase.LoadError:
          content = this.renderPhaseLoadError();
          break;

        case Phase.ChooseKeyPassphrase:
          content = this.renderPhaseChooseKeyPassphrase();
          break;

        case Phase.Migrate:
          content = this.renderPhaseMigrate();
          break;

        case Phase.Passphrase:
          content = this.renderPhasePassPhrase();
          break;

        case Phase.PassphraseConfirm:
          content = this.renderPhasePassPhraseConfirm();
          break;

        case Phase.ShowKey:
          content = this.renderPhaseShowKey();
          break;

        case Phase.Storing:
          content = this.renderBusyPhase();
          break;

        case Phase.ConfirmSkip:
          content = this.renderPhaseSkipConfirm();
          break;
      }
    }

    let titleClass = null;

    switch (this.state.phase) {
      case Phase.Passphrase:
      case Phase.PassphraseConfirm:
        titleClass = ['mx_CreateSecretStorageDialog_titleWithIcon', 'mx_CreateSecretStorageDialog_securePhraseTitle'];
        break;

      case Phase.ShowKey:
        titleClass = ['mx_CreateSecretStorageDialog_titleWithIcon', 'mx_CreateSecretStorageDialog_secureBackupTitle'];
        break;

      case Phase.ChooseKeyPassphrase:
        titleClass = 'mx_CreateSecretStorageDialog_centeredTitle';
        break;
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_CreateSecretStorageDialog",
      onFinished: this.props.onFinished,
      title: this.titleForPhase(this.state.phase),
      titleClass: titleClass,
      hasCancel: this.props.hasCancel && [Phase.Passphrase].includes(this.state.phase),
      fixedWidth: false
    }, /*#__PURE__*/_react.default.createElement("div", null, content));
  }

}

exports.default = CreateSecretStorageDialog;
(0, _defineProperty2.default)(CreateSecretStorageDialog, "defaultProps", {
  hasCancel: true,
  forceReset: false
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9hc3luYy1jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3Mvc2VjdXJpdHkvQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZy50c3giXSwibmFtZXMiOlsiUGhhc2UiLCJQQVNTV09SRF9NSU5fU0NPUkUiLCJDcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInN0YXRlIiwicGhhc2UiLCJNaWdyYXRlIiwiZmV0Y2hCYWNrdXBJbmZvIiwiZSIsInNldFN0YXRlIiwicGFzc1BocmFzZUtleVNlbGVjdGVkIiwidGFyZ2V0IiwidmFsdWUiLCJTZWN1cmVCYWNrdXBTZXR1cE1ldGhvZCIsIktleSIsInJlY292ZXJ5S2V5IiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0IiwiY3JlYXRlUmVjb3ZlcnlLZXlGcm9tUGFzc3BocmFzZSIsImNvcGllZCIsImRvd25sb2FkZWQiLCJzZXRQYXNzcGhyYXNlIiwiU2hvd0tleSIsIlBhc3NwaHJhc2UiLCJwcmV2ZW50RGVmYXVsdCIsImJhY2t1cFNpZ1N0YXR1cyIsInVzYWJsZSIsImJvb3RzdHJhcFNlY3JldFN0b3JhZ2UiLCJyZXN0b3JlQmFja3VwIiwic3VjY2Vzc2Z1bCIsInJlY292ZXJ5S2V5Tm9kZSIsImN1cnJlbnQiLCJibG9iIiwiQmxvYiIsImVuY29kZWRQcml2YXRlS2V5IiwidHlwZSIsIkZpbGVTYXZlciIsInNhdmVBcyIsIm1ha2VSZXF1ZXN0IiwiY2FuVXBsb2FkS2V5c1dpdGhQYXNzd29yZE9ubHkiLCJhY2NvdW50UGFzc3dvcmQiLCJpZGVudGlmaWVyIiwidXNlciIsImdldFVzZXJJZCIsInBhc3N3b3JkIiwiZGlhbG9nQWVzdGhldGljcyIsIlNTT0F1dGhFbnRyeSIsIlBIQVNFX1BSRUFVVEgiLCJ0aXRsZSIsImJvZHkiLCJjb250aW51ZVRleHQiLCJjb250aW51ZUtpbmQiLCJQSEFTRV9QT1NUQVVUSCIsImZpbmlzaGVkIiwiTW9kYWwiLCJjcmVhdGVUcmFja2VkRGlhbG9nIiwiSW50ZXJhY3RpdmVBdXRoRGlhbG9nIiwibWF0cml4Q2xpZW50IiwiYWVzdGhldGljc0ZvclN0YWdlUGhhc2VzIiwiTE9HSU5fVFlQRSIsIlVOU1RBQkxFX0xPR0lOX1RZUEUiLCJjb25maXJtZWQiLCJFcnJvciIsIlN0b3JpbmciLCJlcnJvciIsImNsaSIsImZvcmNlUmVzZXQiLCJsb2dnZXIiLCJsb2ciLCJjcmVhdGVTZWNyZXRTdG9yYWdlS2V5Iiwic2V0dXBOZXdLZXlCYWNrdXAiLCJzZXR1cE5ld1NlY3JldFN0b3JhZ2UiLCJib290c3RyYXBDcm9zc1NpZ25pbmciLCJhdXRoVXBsb2FkRGV2aWNlU2lnbmluZ0tleXMiLCJkb0Jvb3RzdHJhcFVJQXV0aCIsImtleUJhY2t1cEluZm8iLCJiYWNrdXBJbmZvIiwiZ2V0S2V5QmFja3VwUGFzc3BocmFzZSIsImJhY2t1cEtleSIsIm9uRmluaXNoZWQiLCJodHRwU3RhdHVzIiwiZGF0YSIsImZsb3dzIiwiYWNjb3VudFBhc3N3b3JkQ29ycmVjdCIsImtleUNhbGxiYWNrIiwiayIsIlJlc3RvcmVLZXlCYWNrdXBEaWFsb2ciLCJzaG93U3VtbWFyeSIsIkxvYWRpbmciLCJDb25maXJtU2tpcCIsIkNob29zZUtleVBhc3NwaHJhc2UiLCJwYXNzcGhyYXNlRmllbGQiLCJ2YWxpZGF0ZSIsImFsbG93RW1wdHkiLCJ2YWxpZCIsImZvY3VzIiwiZm9jdXNlZCIsIlBhc3NwaHJhc2VDb25maXJtIiwicGFzc1BocmFzZSIsInBhc3NQaHJhc2VDb25maXJtIiwicGFzc1BocmFzZVZhbGlkIiwicmVzdWx0Iiwic2V0dXBNZXRob2RzIiwiaW5jbHVkZXMiLCJxdWVyeUtleVVwbG9hZEF1dGgiLCJjYW5Ta2lwIiwib24iLCJvbktleUJhY2t1cFN0YXR1c0NoYW5nZSIsImdldEluaXRpYWxQaGFzZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlTGlzdGVuZXIiLCJrZXlGcm9tQ3VzdG9taXNhdGlvbnMiLCJTZWN1cml0eUN1c3RvbWlzYXRpb25zIiwicHJpdmF0ZUtleSIsImdldEtleUJhY2t1cFZlcnNpb24iLCJpc0NyeXB0b0VuYWJsZWQiLCJpc0tleUJhY2t1cFRydXN0ZWQiLCJMb2FkRXJyb3IiLCJ1cGxvYWREZXZpY2VTaWduaW5nS2V5cyIsInNvbWUiLCJmIiwic3RhZ2VzIiwibGVuZ3RoIiwicmVuZGVyT3B0aW9uS2V5Iiwib25LZXlQYXNzcGhyYXNlQ2hhbmdlIiwicmVuZGVyT3B0aW9uUGFzc3BocmFzZSIsInJlbmRlclBoYXNlQ2hvb3NlS2V5UGFzc3BocmFzZSIsIm9wdGlvbktleSIsIm9wdGlvblBhc3NwaHJhc2UiLCJvbkNob29zZUtleVBhc3NwaHJhc2VGb3JtU3VibWl0Iiwib25DYW5jZWxDbGljayIsInJlbmRlclBoYXNlTWlncmF0ZSIsImF1dGhQcm9tcHQiLCJuZXh0Q2FwdGlvbiIsIm9uQWNjb3VudFBhc3N3b3JkQ2hhbmdlIiwib25NaWdyYXRlRm9ybVN1Ym1pdCIsInJlbmRlclBoYXNlUGFzc1BocmFzZSIsIm9uUGFzc1BocmFzZU5leHRDbGljayIsIm9uUGFzc1BocmFzZUNoYW5nZSIsIm9uUGFzc1BocmFzZVZhbGlkYXRlIiwicmVuZGVyUGhhc2VQYXNzUGhyYXNlQ29uZmlybSIsIm1hdGNoVGV4dCIsImNoYW5nZVRleHQiLCJzdGFydHNXaXRoIiwicGFzc1BocmFzZU1hdGNoIiwib25TZXRBZ2FpbkNsaWNrIiwib25QYXNzUGhyYXNlQ29uZmlybU5leHRDbGljayIsIm9uUGFzc1BocmFzZUNvbmZpcm1DaGFuZ2UiLCJyZW5kZXJQaGFzZVNob3dLZXkiLCJjb250aW51ZUJ1dHRvbiIsIm9uU2hvd0tleUNvbnRpbnVlQ2xpY2siLCJvbkRvd25sb2FkQ2xpY2siLCJvbkNvcHlDbGljayIsImhlaWdodCIsInJlbmRlckJ1c3lQaGFzZSIsInJlbmRlclBoYXNlTG9hZEVycm9yIiwib25Mb2FkUmV0cnlDbGljayIsIm9uQ2FuY2VsIiwicmVuZGVyUGhhc2VTa2lwQ29uZmlybSIsIm9uR29CYWNrQ2xpY2siLCJ0aXRsZUZvclBoYXNlIiwicmVuZGVyIiwiY29udGVudCIsInRpdGxlQ2xhc3MiLCJoYXNDYW5jZWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUtBOztBQUVBOztBQUdBOztBQUNBOztBQUNBOztBQUdBOzs7Ozs7QUE5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFtQ0E7SUFDS0EsSzs7V0FBQUEsSztBQUFBQSxFQUFBQSxLO0FBQUFBLEVBQUFBLEs7QUFBQUEsRUFBQUEsSztBQUFBQSxFQUFBQSxLO0FBQUFBLEVBQUFBLEs7QUFBQUEsRUFBQUEsSztBQUFBQSxFQUFBQSxLO0FBQUFBLEVBQUFBLEs7QUFBQUEsRUFBQUEsSztHQUFBQSxLLEtBQUFBLEs7O0FBWUwsTUFBTUMsa0JBQWtCLEdBQUcsQ0FBM0IsQyxDQUE4Qjs7QUE0QjlCO0FBQ0E7QUFDQTtBQUNBO0FBQ2UsTUFBTUMseUJBQU4sU0FBd0NDLGVBQU1DLGFBQTlDLENBQTRFO0FBVXZGQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBZ0I7QUFDdkIsVUFBTUEsS0FBTjtBQUR1QjtBQUFBO0FBQUEsd0VBSEQsdUJBR0M7QUFBQSx3RUFGRCx1QkFFQztBQUFBLG1FQWdITyxNQUFZO0FBQzFDLFVBQUksS0FBS0MsS0FBTCxDQUFXQyxLQUFYLEtBQXFCUixLQUFLLENBQUNTLE9BQS9CLEVBQXdDLEtBQUtDLGVBQUw7QUFDM0MsS0FsSDBCO0FBQUEsaUVBb0hNQyxDQUFELElBQWtEO0FBQzlFLFdBQUtDLFFBQUwsQ0FBYztBQUNWQyxRQUFBQSxxQkFBcUIsRUFBRUYsQ0FBQyxDQUFDRyxNQUFGLENBQVNDO0FBRHRCLE9BQWQ7QUFHSCxL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LypcbkNvcHlyaWdodCAyMDE4LCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSwgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwgeyBjcmVhdGVSZWYgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tICcuLi8uLi8uLi8uLi9NYXRyaXhDbGllbnRQZWcnO1xuaW1wb3J0IEZpbGVTYXZlciBmcm9tICdmaWxlLXNhdmVyJztcbmltcG9ydCB7IF90LCBfdGQgfSBmcm9tICcuLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IE1vZGFsIGZyb20gJy4uLy4uLy4uLy4uL01vZGFsJztcbmltcG9ydCB7IHByb21wdEZvckJhY2t1cFBhc3NwaHJhc2UgfSBmcm9tICcuLi8uLi8uLi8uLi9TZWN1cml0eU1hbmFnZXInO1xuaW1wb3J0IHsgY29weU5vZGUgfSBmcm9tIFwiLi4vLi4vLi4vLi4vdXRpbHMvc3RyaW5nc1wiO1xuaW1wb3J0IHsgU1NPQXV0aEVudHJ5IH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvYXV0aC9JbnRlcmFjdGl2ZUF1dGhFbnRyeUNvbXBvbmVudHNcIjtcbmltcG9ydCBQYXNzcGhyYXNlRmllbGQgZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvYXV0aC9QYXNzcGhyYXNlRmllbGRcIjtcbmltcG9ydCBTdHlsZWRSYWRpb0J1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL1N0eWxlZFJhZGlvQnV0dG9uJztcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL0FjY2Vzc2libGVCdXR0b25cIjtcbmltcG9ydCBEaWFsb2dCdXR0b25zIGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL0RpYWxvZ0J1dHRvbnNcIjtcbmltcG9ydCBJbmxpbmVTcGlubmVyIGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL0lubGluZVNwaW5uZXJcIjtcbmltcG9ydCBSZXN0b3JlS2V5QmFja3VwRGlhbG9nIGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3Mvc2VjdXJpdHkvUmVzdG9yZUtleUJhY2t1cERpYWxvZ1wiO1xuaW1wb3J0IHtcbiAgICBnZXRTZWN1cmVCYWNrdXBTZXR1cE1ldGhvZHMsXG4gICAgaXNTZWN1cmVCYWNrdXBSZXF1aXJlZCxcbiAgICBTZWN1cmVCYWNrdXBTZXR1cE1ldGhvZCxcbn0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbHMvV2VsbEtub3duVXRpbHMnO1xuaW1wb3J0IFNlY3VyaXR5Q3VzdG9taXNhdGlvbnMgZnJvbSBcIi4uLy4uLy4uLy4uL2N1c3RvbWlzYXRpb25zL1NlY3VyaXR5XCI7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9sb2dnZXJcIjtcbmltcG9ydCB7IElLZXlCYWNrdXBJbmZvIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NyeXB0by9rZXliYWNrdXBcIjtcbmltcG9ydCB7IElEaWFsb2dQcm9wcyB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvSURpYWxvZ1Byb3BzXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvZWxlbWVudHMvRmllbGRcIjtcbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQmFzZURpYWxvZ1wiO1xuaW1wb3J0IFNwaW5uZXIgZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvZWxlbWVudHMvU3Bpbm5lclwiO1xuaW1wb3J0IHsgVHJ1c3RJbmZvIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2NyeXB0by9iYWNrdXBcIjtcbmltcG9ydCB7IENyb3NzU2lnbmluZ0tleXMgfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmNcIjtcbmltcG9ydCBJbnRlcmFjdGl2ZUF1dGhEaWFsb2cgZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvZGlhbG9ncy9JbnRlcmFjdGl2ZUF1dGhEaWFsb2dcIjtcbmltcG9ydCB7IElSZWNvdmVyeUtleSB9IGZyb20gXCJtYXRyaXgtanMtc2RrL3NyYy9jcnlwdG8vYXBpXCI7XG5pbXBvcnQgeyBJVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL1ZhbGlkYXRpb25cIjtcblxuLy8gSSBtYWRlIGEgbWlzdGFrZSB3aGlsZSBjb252ZXJ0aW5nIHRoaXMgYW5kIGl0IGhhcyB0byBiZSBmaXhlZCFcbmVudW0gUGhhc2Uge1xuICAgIExvYWRpbmcgPSBcImxvYWRpbmdcIixcbiAgICBMb2FkRXJyb3IgPSBcImxvYWRfZXJyb3JcIixcbiAgICBDaG9vc2VLZXlQYXNzcGhyYXNlID0gXCJjaG9vc2Vfa2V5X3Bhc3NwaHJhc2VcIixcbiAgICBNaWdyYXRlID0gXCJtaWdyYXRlXCIsXG4gICAgUGFzc3BocmFzZSA9IFwicGFzc3BocmFzZVwiLFxuICAgIFBhc3NwaHJhc2VDb25maXJtID0gXCJwYXNzcGhyYXNlX2NvbmZpcm1cIixcbiAgICBTaG93S2V5ID0gXCJzaG93X2tleVwiLFxuICAgIFN0b3JpbmcgPSBcInN0b3JpbmdcIixcbiAgICBDb25maXJtU2tpcCA9IFwiY29uZmlybV9za2lwXCIsXG59XG5cbmNvbnN0IFBBU1NXT1JEX01JTl9TQ09SRSA9IDQ7IC8vIFNvIHNlY3VyZSwgbWFueSBjaGFyYWN0ZXJzLCBtdWNoIGNvbXBsZXgsIHdvdywgZXRjLCBldGMuXG5cbmludGVyZmFjZSBJUHJvcHMgZXh0ZW5kcyBJRGlhbG9nUHJvcHMge1xuICAgIGhhc0NhbmNlbDogYm9vbGVhbjtcbiAgICBhY2NvdW50UGFzc3dvcmQ6IHN0cmluZztcbiAgICBmb3JjZVJlc2V0OiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgSVN0YXRlIHtcbiAgICBwaGFzZTogUGhhc2U7XG4gICAgcGFzc1BocmFzZTogc3RyaW5nO1xuICAgIHBhc3NQaHJhc2VWYWxpZDogYm9vbGVhbjtcbiAgICBwYXNzUGhyYXNlQ29uZmlybTogc3RyaW5nO1xuICAgIGNvcGllZDogYm9vbGVhbjtcbiAgICBkb3dubG9hZGVkOiBib29sZWFuO1xuICAgIHNldFBhc3NwaHJhc2U6IGJvb2xlYW47XG4gICAgYmFja3VwSW5mbzogSUtleUJhY2t1cEluZm87XG4gICAgYmFja3VwU2lnU3RhdHVzOiBUcnVzdEluZm87XG4gICAgLy8gZG9lcyB0aGUgc2VydmVyIG9mZmVyIGEgVUkgYXV0aCBmbG93IHdpdGgganVzdCBtLmxvZ2luLnBhc3N3b3JkXG4gICAgLy8gZm9yIC9rZXlzL2RldmljZV9zaWduaW5nL3VwbG9hZD9cbiAgICBjYW5VcGxvYWRLZXlzV2l0aFBhc3N3b3JkT25seTogYm9vbGVhbjtcbiAgICBhY2NvdW50UGFzc3dvcmQ6IHN0cmluZztcbiAgICBhY2NvdW50UGFzc3dvcmRDb3JyZWN0OiBib29sZWFuO1xuICAgIGNhblNraXA6IGJvb2xlYW47XG4gICAgcGFzc1BocmFzZUtleVNlbGVjdGVkOiBzdHJpbmc7XG4gICAgZXJyb3I/OiBzdHJpbmc7XG59XG5cbi8qXG4gKiBXYWxrcyB0aGUgdXNlciB0aHJvdWdoIHRoZSBwcm9jZXNzIG9mIGNyZWF0aW5nIGEgcGFzc3BocmFzZSB0byBndWFyZCBTZWN1cmVcbiAqIFNlY3JldCBTdG9yYWdlIGluIGFjY291bnQgZGF0YS5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZyBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwdWJsaWMgc3RhdGljIGRlZmF1bHRQcm9wczogUGFydGlhbDxJUHJvcHM+ID0ge1xuICAgICAgICBoYXNDYW5jZWw6IHRydWUsXG4gICAgICAgIGZvcmNlUmVzZXQ6IGZhbHNlLFxuICAgIH07XG4gICAgcHJpdmF0ZSByZWNvdmVyeUtleTogSVJlY292ZXJ5S2V5O1xuICAgIHByaXZhdGUgYmFja3VwS2V5OiBVaW50OEFycmF5O1xuICAgIHByaXZhdGUgcmVjb3ZlcnlLZXlOb2RlID0gY3JlYXRlUmVmPEhUTUxFbGVtZW50PigpO1xuICAgIHByaXZhdGUgcGFzc3BocmFzZUZpZWxkID0gY3JlYXRlUmVmPEZpZWxkPigpO1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgbGV0IHBhc3NQaHJhc2VLZXlTZWxlY3RlZDtcbiAgICAgICAgY29uc3Qgc2V0dXBNZXRob2RzID0gZ2V0U2VjdXJlQmFja3VwU2V0dXBNZXRob2RzKCk7XG4gICAgICAgIGlmIChzZXR1cE1ldGhvZHMuaW5jbHVkZXMoU2VjdXJlQmFja3VwU2V0dXBNZXRob2QuS2V5KSkge1xuICAgICAgICAgICAgcGFzc1BocmFzZUtleVNlbGVjdGVkID0gU2VjdXJlQmFja3VwU2V0dXBNZXRob2QuS2V5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFzc1BocmFzZUtleVNlbGVjdGVkID0gU2VjdXJlQmFja3VwU2V0dXBNZXRob2QuUGFzc3BocmFzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFjY291bnRQYXNzd29yZCA9IHByb3BzLmFjY291bnRQYXNzd29yZCB8fCBcIlwiO1xuICAgICAgICBsZXQgY2FuVXBsb2FkS2V5c1dpdGhQYXNzd29yZE9ubHkgPSBudWxsO1xuICAgICAgICBpZiAoYWNjb3VudFBhc3N3b3JkKSB7XG4gICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGFuIGFjY291bnQgcGFzc3dvcmQgaW4gbWVtb3J5LCBsZXQncyBzaW1wbGlmeSBhbmRcbiAgICAgICAgICAgIC8vIGFzc3VtZSBpdCBtZWFucyBwYXNzd29yZCBhdXRoIGlzIGFsc28gc3VwcG9ydGVkIGZvciBkZXZpY2VcbiAgICAgICAgICAgIC8vIHNpZ25pbmcga2V5IHVwbG9hZCBhcyB3ZWxsLiBUaGlzIGF2b2lkcyBoaXR0aW5nIHRoZSBzZXJ2ZXIgdG9cbiAgICAgICAgICAgIC8vIHRlc3QgYXV0aCBmbG93cywgd2hpY2ggbWF5IGJlIHNsb3cgdW5kZXIgaGlnaCBsb2FkLlxuICAgICAgICAgICAgY2FuVXBsb2FkS2V5c1dpdGhQYXNzd29yZE9ubHkgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5xdWVyeUtleVVwbG9hZEF1dGgoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBwaGFzZTogUGhhc2UuTG9hZGluZyxcbiAgICAgICAgICAgIHBhc3NQaHJhc2U6ICcnLFxuICAgICAgICAgICAgcGFzc1BocmFzZVZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIHBhc3NQaHJhc2VDb25maXJtOiAnJyxcbiAgICAgICAgICAgIGNvcGllZDogZmFsc2UsXG4gICAgICAgICAgICBkb3dubG9hZGVkOiBmYWxzZSxcbiAgICAgICAgICAgIHNldFBhc3NwaHJhc2U6IGZhbHNlLFxuICAgICAgICAgICAgYmFja3VwSW5mbzogbnVsbCxcbiAgICAgICAgICAgIGJhY2t1cFNpZ1N0YXR1czogbnVsbCxcbiAgICAgICAgICAgIC8vIGRvZXMgdGhlIHNlcnZlciBvZmZlciBhIFVJIGF1dGggZmxvdyB3aXRoIGp1c3QgbS5sb2dpbi5wYXNzd29yZFxuICAgICAgICAgICAgLy8gZm9yIC9rZXlzL2RldmljZV9zaWduaW5nL3VwbG9hZD9cbiAgICAgICAgICAgIGFjY291bnRQYXNzd29yZENvcnJlY3Q6IG51bGwsXG4gICAgICAgICAgICBjYW5Ta2lwOiAhaXNTZWN1cmVCYWNrdXBSZXF1aXJlZCgpLFxuICAgICAgICAgICAgY2FuVXBsb2FkS2V5c1dpdGhQYXNzd29yZE9ubHksXG4gICAgICAgICAgICBwYXNzUGhyYXNlS2V5U2VsZWN0ZWQsXG4gICAgICAgICAgICBhY2NvdW50UGFzc3dvcmQsXG4gICAgICAgIH07XG5cbiAgICAgICAgTWF0cml4Q2xpZW50UGVnLmdldCgpLm9uKCdjcnlwdG8ua2V5QmFja3VwU3RhdHVzJywgdGhpcy5vbktleUJhY2t1cFN0YXR1c0NoYW5nZSk7XG5cbiAgICAgICAgdGhpcy5nZXRJbml0aWFsUGhhc2UoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XG4gICAgICAgIE1hdHJpeENsaWVudFBlZy5nZXQoKS5yZW1vdmVMaXN0ZW5lcignY3J5cHRvLmtleUJhY2t1cFN0YXR1cycsIHRoaXMub25LZXlCYWNrdXBTdGF0dXNDaGFuZ2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0SW5pdGlhbFBoYXNlKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBrZXlGcm9tQ3VzdG9taXNhdGlvbnMgPSBTZWN1cml0eUN1c3RvbWlzYXRpb25zLmNyZWF0ZVNlY3JldFN0b3JhZ2VLZXk/LigpO1xuICAgICAgICBpZiAoa2V5RnJvbUN1c3RvbWlzYXRpb25zKSB7XG4gICAgICAgICAgICBsb2dnZXIubG9nKFwiQ3JlYXRlZCBrZXkgdmlhIGN1c3RvbWlzYXRpb25zLCBqdW1waW5nIHRvIGJvb3RzdHJhcCBzdGVwXCIpO1xuICAgICAgICAgICAgdGhpcy5yZWNvdmVyeUtleSA9IHtcbiAgICAgICAgICAgICAgICBwcml2YXRlS2V5OiBrZXlGcm9tQ3VzdG9taXNhdGlvbnMsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5ib290c3RyYXBTZWNyZXRTdG9yYWdlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZldGNoQmFja3VwSW5mbygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgZmV0Y2hCYWNrdXBJbmZvKCk6IFByb21pc2U8eyBiYWNrdXBJbmZvOiBJS2V5QmFja3VwSW5mbywgYmFja3VwU2lnU3RhdHVzOiBUcnVzdEluZm8gfT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYmFja3VwSW5mbyA9IGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRLZXlCYWNrdXBWZXJzaW9uKCk7XG4gICAgICAgICAgICBjb25zdCBiYWNrdXBTaWdTdGF0dXMgPSAoXG4gICAgICAgICAgICAgICAgLy8gd2UgbWF5IG5vdCBoYXZlIHN0YXJ0ZWQgY3J5cHRvIHlldCwgaW4gd2hpY2ggY2FzZSB3ZSBkZWZpbml0ZWx5IGRvbid0IHRydXN0IHRoZSBiYWNrdXBcbiAgICAgICAgICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuaXNDcnlwdG9FbmFibGVkKCkgJiYgKGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5pc0tleUJhY2t1cFRydXN0ZWQoYmFja3VwSW5mbykpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb25zdCB7IGZvcmNlUmVzZXQgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgICAgICBjb25zdCBwaGFzZSA9IChiYWNrdXBJbmZvICYmICFmb3JjZVJlc2V0KSA/IFBoYXNlLk1pZ3JhdGUgOiBQaGFzZS5DaG9vc2VLZXlQYXNzcGhyYXNlO1xuXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBwaGFzZSxcbiAgICAgICAgICAgICAgICBiYWNrdXBJbmZvLFxuICAgICAgICAgICAgICAgIGJhY2t1cFNpZ1N0YXR1cyxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGJhY2t1cEluZm8sXG4gICAgICAgICAgICAgICAgYmFja3VwU2lnU3RhdHVzLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHBoYXNlOiBQaGFzZS5Mb2FkRXJyb3IgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHF1ZXJ5S2V5VXBsb2FkQXV0aCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS51cGxvYWREZXZpY2VTaWduaW5nS2V5cyhudWxsLCB7fSBhcyBDcm9zc1NpZ25pbmdLZXlzKTtcbiAgICAgICAgICAgIC8vIFdlIHNob3VsZCBuZXZlciBnZXQgaGVyZTogdGhlIHNlcnZlciBzaG91bGQgYWx3YXlzIHJlcXVpcmVcbiAgICAgICAgICAgIC8vIFVJIGF1dGggdG8gdXBsb2FkIGRldmljZSBzaWduaW5nIGtleXMuIElmIHdlIGRvLCB3ZSB1cGxvYWRcbiAgICAgICAgICAgIC8vIG5vIGtleXMgd2hpY2ggd291bGQgYmUgYSBuby1vcC5cbiAgICAgICAgICAgIGxvZ2dlci5sb2coXCJ1cGxvYWREZXZpY2VTaWduaW5nS2V5cyB1bmV4cGVjdGVkbHkgc3VjY2VlZGVkIHdpdGhvdXQgVUkgYXV0aCFcIik7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoIWVycm9yLmRhdGEgfHwgIWVycm9yLmRhdGEuZmxvd3MpIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIubG9nKFwidXBsb2FkRGV2aWNlU2lnbmluZ0tleXMgYWR2ZXJ0aXNlZCBubyBmbG93cyFcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY2FuVXBsb2FkS2V5c1dpdGhQYXNzd29yZE9ubHkgPSBlcnJvci5kYXRhLmZsb3dzLnNvbWUoZiA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGYuc3RhZ2VzLmxlbmd0aCA9PT0gMSAmJiBmLnN0YWdlc1swXSA9PT0gJ20ubG9naW4ucGFzc3dvcmQnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBjYW5VcGxvYWRLZXlzV2l0aFBhc3N3b3JkT25seSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbktleUJhY2t1cFN0YXR1c0NoYW5nZSA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUucGhhc2UgPT09IFBoYXNlLk1pZ3JhdGUpIHRoaXMuZmV0Y2hCYWNrdXBJbmZvKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25LZXlQYXNzcGhyYXNlQ2hhbmdlID0gKGU6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcGFzc1BocmFzZUtleVNlbGVjdGVkOiBlLnRhcmdldC52YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25DaG9vc2VLZXlQYXNzcGhyYXNlRm9ybVN1Ym1pdCA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUucGFzc1BocmFzZUtleVNlbGVjdGVkID09PSBTZWN1cmVCYWNrdXBTZXR1cE1ldGhvZC5LZXkpIHtcbiAgICAgICAgICAgIHRoaXMucmVjb3ZlcnlLZXkgPVxuICAgICAgICAgICAgICAgIGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5jcmVhdGVSZWNvdmVyeUtleUZyb21QYXNzcGhyYXNlKCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBjb3BpZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRvd25sb2FkZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNldFBhc3NwaHJhc2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHBoYXNlOiBQaGFzZS5TaG93S2V5LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBjb3BpZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRvd25sb2FkZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHBoYXNlOiBQaGFzZS5QYXNzcGhyYXNlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbk1pZ3JhdGVGb3JtU3VibWl0ID0gKGU6IFJlYWN0LkZvcm1FdmVudCk6IHZvaWQgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmJhY2t1cFNpZ1N0YXR1cy51c2FibGUpIHtcbiAgICAgICAgICAgIHRoaXMuYm9vdHN0cmFwU2VjcmV0U3RvcmFnZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZXN0b3JlQmFja3VwKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkNvcHlDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3Qgc3VjY2Vzc2Z1bCA9IGNvcHlOb2RlKHRoaXMucmVjb3ZlcnlLZXlOb2RlLmN1cnJlbnQpO1xuICAgICAgICBpZiAoc3VjY2Vzc2Z1bCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgY29waWVkOiB0cnVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkRvd25sb2FkQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbdGhpcy5yZWNvdmVyeUtleS5lbmNvZGVkUHJpdmF0ZUtleV0sIHtcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXMtYXNjaWknLFxuICAgICAgICB9KTtcbiAgICAgICAgRmlsZVNhdmVyLnNhdmVBcyhibG9iLCAnc2VjdXJpdHkta2V5LnR4dCcpO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZG93bmxvYWRlZDogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgZG9Cb290c3RyYXBVSUF1dGggPSBhc3luYyAobWFrZVJlcXVlc3Q6IChhdXRoRGF0YTogYW55KSA9PiB2b2lkKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmNhblVwbG9hZEtleXNXaXRoUGFzc3dvcmRPbmx5ICYmIHRoaXMuc3RhdGUuYWNjb3VudFBhc3N3b3JkKSB7XG4gICAgICAgICAgICBhd2FpdCBtYWtlUmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ20ubG9naW4ucGFzc3dvcmQnLFxuICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ20uaWQudXNlcicsXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRVc2VySWQoKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIFRPRE86IFJlbW92ZSBgdXNlcmAgb25jZSBzZXJ2ZXJzIHN1cHBvcnQgcHJvcGVyIFVJQVxuICAgICAgICAgICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbWF0cml4LW9yZy9zeW5hcHNlL2lzc3Vlcy81NjY1XG4gICAgICAgICAgICAgICAgdXNlcjogTWF0cml4Q2xpZW50UGVnLmdldCgpLmdldFVzZXJJZCgpLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLnN0YXRlLmFjY291bnRQYXNzd29yZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZGlhbG9nQWVzdGhldGljcyA9IHtcbiAgICAgICAgICAgICAgICBbU1NPQXV0aEVudHJ5LlBIQVNFX1BSRUFVVEhdOiB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBfdChcIlVzZSBTaW5nbGUgU2lnbiBPbiB0byBjb250aW51ZVwiKSxcbiAgICAgICAgICAgICAgICAgICAgYm9keTogX3QoXCJUbyBjb250aW51ZSwgdXNlIFNpbmdsZSBTaWduIE9uIHRvIHByb3ZlIHlvdXIgaWRlbnRpdHkuXCIpLFxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZVRleHQ6IF90KFwiU2luZ2xlIFNpZ24gT25cIiksXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlS2luZDogXCJwcmltYXJ5XCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBbU1NPQXV0aEVudHJ5LlBIQVNFX1BPU1RBVVRIXToge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogX3QoXCJDb25maXJtIGVuY3J5cHRpb24gc2V0dXBcIiksXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IF90KFwiQ2xpY2sgdGhlIGJ1dHRvbiBiZWxvdyB0byBjb25maXJtIHNldHRpbmcgdXAgZW5jcnlwdGlvbi5cIiksXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlVGV4dDogX3QoXCJDb25maXJtXCIpLFxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZUtpbmQ6IFwicHJpbWFyeVwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCB7IGZpbmlzaGVkIH0gPSBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKFxuICAgICAgICAgICAgICAgICdDcm9zcy1zaWduaW5nIGtleXMgZGlhbG9nJywgJycsIEludGVyYWN0aXZlQXV0aERpYWxvZyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBfdChcIlNldHRpbmcgdXAga2V5c1wiKSxcbiAgICAgICAgICAgICAgICAgICAgbWF0cml4Q2xpZW50OiBNYXRyaXhDbGllbnRQZWcuZ2V0KCksXG4gICAgICAgICAgICAgICAgICAgIG1ha2VSZXF1ZXN0LFxuICAgICAgICAgICAgICAgICAgICBhZXN0aGV0aWNzRm9yU3RhZ2VQaGFzZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFtTU09BdXRoRW50cnkuTE9HSU5fVFlQRV06IGRpYWxvZ0Flc3RoZXRpY3MsXG4gICAgICAgICAgICAgICAgICAgICAgICBbU1NPQXV0aEVudHJ5LlVOU1RBQkxFX0xPR0lOX1RZUEVdOiBkaWFsb2dBZXN0aGV0aWNzLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgW2NvbmZpcm1lZF0gPSBhd2FpdCBmaW5pc2hlZDtcbiAgICAgICAgICAgIGlmICghY29uZmlybWVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ3Jvc3Mtc2lnbmluZyBrZXkgdXBsb2FkIGF1dGggY2FuY2VsZWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBib290c3RyYXBTZWNyZXRTdG9yYWdlID0gYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHBoYXNlOiBQaGFzZS5TdG9yaW5nLFxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGNsaSA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcblxuICAgICAgICBjb25zdCB7IGZvcmNlUmVzZXQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChmb3JjZVJlc2V0KSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIkZvcmNpbmcgc2VjcmV0IHN0b3JhZ2UgcmVzZXRcIik7XG4gICAgICAgICAgICAgICAgYXdhaXQgY2xpLmJvb3RzdHJhcFNlY3JldFN0b3JhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVTZWNyZXRTdG9yYWdlS2V5OiBhc3luYyAoKSA9PiB0aGlzLnJlY292ZXJ5S2V5LFxuICAgICAgICAgICAgICAgICAgICBzZXR1cE5ld0tleUJhY2t1cDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2V0dXBOZXdTZWNyZXRTdG9yYWdlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgcGFzc3dvcmQgYXV0aGVudGljYXRpb24gdXNlcnMgYWZ0ZXIgMjAyMC0wOSwgdGhpcyBjcm9zcy1zaWduaW5nXG4gICAgICAgICAgICAgICAgLy8gc3RlcCB3aWxsIGJlIGEgbm8tb3Agc2luY2UgaXQgaXMgbm93IHNldHVwIGR1cmluZyByZWdpc3RyYXRpb24gb3IgbG9naW5cbiAgICAgICAgICAgICAgICAvLyB3aGVuIG5lZWRlZC4gV2Ugc2hvdWxkIGtlZXAgdGhpcyBoZXJlIHRvIGNvdmVyIG90aGVyIGNhc2VzIHN1Y2ggYXM6XG4gICAgICAgICAgICAgICAgLy8gICAqIFVzZXJzIHdpdGggZXhpc3Rpbmcgc2Vzc2lvbnMgcHJpb3IgdG8gMjAyMC0wOSBjaGFuZ2VzXG4gICAgICAgICAgICAgICAgLy8gICAqIFNTTyBhdXRoZW50aWNhdGlvbiB1c2VycyB3aGljaCByZXF1aXJlIGludGVyYWN0aXZlIGF1dGggdG8gdXBsb2FkXG4gICAgICAgICAgICAgICAgLy8gICAgIGtleXMgKGFuZCBhbHNvIGhhcHBlbiB0byBza2lwIGFsbCBwb3N0LWF1dGhlbnRpY2F0aW9uIGZsb3dzIGF0IHRoZVxuICAgICAgICAgICAgICAgIC8vICAgICBtb21lbnQgdmlhIHRva2VuIGxvZ2luKVxuICAgICAgICAgICAgICAgIGF3YWl0IGNsaS5ib290c3RyYXBDcm9zc1NpZ25pbmcoe1xuICAgICAgICAgICAgICAgICAgICBhdXRoVXBsb2FkRGV2aWNlU2lnbmluZ0tleXM6IHRoaXMuZG9Cb290c3RyYXBVSUF1dGgsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgY2xpLmJvb3RzdHJhcFNlY3JldFN0b3JhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVTZWNyZXRTdG9yYWdlS2V5OiBhc3luYyAoKSA9PiB0aGlzLnJlY292ZXJ5S2V5LFxuICAgICAgICAgICAgICAgICAgICBrZXlCYWNrdXBJbmZvOiB0aGlzLnN0YXRlLmJhY2t1cEluZm8sXG4gICAgICAgICAgICAgICAgICAgIHNldHVwTmV3S2V5QmFja3VwOiAhdGhpcy5zdGF0ZS5iYWNrdXBJbmZvLFxuICAgICAgICAgICAgICAgICAgICBnZXRLZXlCYWNrdXBQYXNzcGhyYXNlOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBtYXkgYWxyZWFkeSBoYXZlIHRoZSBiYWNrdXAga2V5IGlmIHdlIGVhcmxpZXIgd2VudFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhyb3VnaCB0aGUgcmVzdG9yZSBiYWNrdXAgcGF0aCwgc28gcGFzcyBpdCBhbG9uZ1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmF0aGVyIHRoYW4gcHJvbXB0aW5nIGFnYWluLlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFja3VwS2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmFja3VwS2V5O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21wdEZvckJhY2t1cFBhc3NwaHJhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucHJvcHMub25GaW5pc2hlZCh0cnVlKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuY2FuVXBsb2FkS2V5c1dpdGhQYXNzd29yZE9ubHkgJiYgZS5odHRwU3RhdHVzID09PSA0MDEgJiYgZS5kYXRhLmZsb3dzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGFjY291bnRQYXNzd29yZDogJycsXG4gICAgICAgICAgICAgICAgICAgIGFjY291bnRQYXNzd29yZENvcnJlY3Q6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBwaGFzZTogUGhhc2UuTWlncmF0ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yOiBlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiRXJyb3IgYm9vdHN0cmFwcGluZyBzZWNyZXQgc3RvcmFnZVwiLCBlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQ2FuY2VsID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLm9uRmluaXNoZWQoZmFsc2UpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIHJlc3RvcmVCYWNrdXAgPSBhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIC8vIEl0J3MgcG9zc2libGUgd2UnbGwgbmVlZCB0aGUgYmFja3VwIGtleSBsYXRlciBvbiBmb3IgYm9vdHN0cmFwcGluZyxcbiAgICAgICAgLy8gc28gbGV0J3Mgc3Rhc2ggaXQgaGVyZSwgcmF0aGVyIHRoYW4gcHJvbXB0aW5nIGZvciBpdCB0d2ljZS5cbiAgICAgICAgY29uc3Qga2V5Q2FsbGJhY2sgPSBrID0+IHRoaXMuYmFja3VwS2V5ID0gaztcblxuICAgICAgICBjb25zdCB7IGZpbmlzaGVkIH0gPSBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKFxuICAgICAgICAgICAgJ1Jlc3RvcmUgQmFja3VwJywgJycsIFJlc3RvcmVLZXlCYWNrdXBEaWFsb2csXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc2hvd1N1bW1hcnk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGtleUNhbGxiYWNrLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG51bGwsIC8qIHByaW9yaXR5ID0gKi8gZmFsc2UsIC8qIHN0YXRpYyA9ICovIGZhbHNlLFxuICAgICAgICApO1xuXG4gICAgICAgIGF3YWl0IGZpbmlzaGVkO1xuICAgICAgICBjb25zdCB7IGJhY2t1cFNpZ1N0YXR1cyB9ID0gYXdhaXQgdGhpcy5mZXRjaEJhY2t1cEluZm8oKTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgYmFja3VwU2lnU3RhdHVzLnVzYWJsZSAmJlxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5jYW5VcGxvYWRLZXlzV2l0aFBhc3N3b3JkT25seSAmJlxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY2NvdW50UGFzc3dvcmRcbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aGlzLmJvb3RzdHJhcFNlY3JldFN0b3JhZ2UoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uTG9hZFJldHJ5Q2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBwaGFzZTogUGhhc2UuTG9hZGluZyB9KTtcbiAgICAgICAgdGhpcy5mZXRjaEJhY2t1cEluZm8oKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblNob3dLZXlDb250aW51ZUNsaWNrID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLmJvb3RzdHJhcFNlY3JldFN0b3JhZ2UoKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkNhbmNlbENsaWNrID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgcGhhc2U6IFBoYXNlLkNvbmZpcm1Ta2lwIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uR29CYWNrQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBwaGFzZTogUGhhc2UuQ2hvb3NlS2V5UGFzc3BocmFzZSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBhc3NQaHJhc2VOZXh0Q2xpY2sgPSBhc3luYyAoZTogUmVhY3QuRm9ybUV2ZW50KSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKCF0aGlzLnBhc3NwaHJhc2VGaWVsZC5jdXJyZW50KSByZXR1cm47IC8vIHVubW91bnRpbmdcblxuICAgICAgICBhd2FpdCB0aGlzLnBhc3NwaHJhc2VGaWVsZC5jdXJyZW50LnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogZmFsc2UgfSk7XG4gICAgICAgIGlmICghdGhpcy5wYXNzcGhyYXNlRmllbGQuY3VycmVudC5zdGF0ZS52YWxpZCkge1xuICAgICAgICAgICAgdGhpcy5wYXNzcGhyYXNlRmllbGQuY3VycmVudC5mb2N1cygpO1xuICAgICAgICAgICAgdGhpcy5wYXNzcGhyYXNlRmllbGQuY3VycmVudC52YWxpZGF0ZSh7IGFsbG93RW1wdHk6IGZhbHNlLCBmb2N1c2VkOiB0cnVlIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHBoYXNlOiBQaGFzZS5QYXNzcGhyYXNlQ29uZmlybSB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBhc3NQaHJhc2VDb25maXJtTmV4dENsaWNrID0gYXN5bmMgKGU6IFJlYWN0LkZvcm1FdmVudCkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgaWYgKHRoaXMuc3RhdGUucGFzc1BocmFzZSAhPT0gdGhpcy5zdGF0ZS5wYXNzUGhyYXNlQ29uZmlybSkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMucmVjb3ZlcnlLZXkgPVxuICAgICAgICAgICAgYXdhaXQgTWF0cml4Q2xpZW50UGVnLmdldCgpLmNyZWF0ZVJlY292ZXJ5S2V5RnJvbVBhc3NwaHJhc2UodGhpcy5zdGF0ZS5wYXNzUGhyYXNlKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBjb3BpZWQ6IGZhbHNlLFxuICAgICAgICAgICAgZG93bmxvYWRlZDogZmFsc2UsXG4gICAgICAgICAgICBzZXRQYXNzcGhyYXNlOiB0cnVlLFxuICAgICAgICAgICAgcGhhc2U6IFBoYXNlLlNob3dLZXksXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU2V0QWdhaW5DbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBwYXNzUGhyYXNlOiAnJyxcbiAgICAgICAgICAgIHBhc3NQaHJhc2VWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBwYXNzUGhyYXNlQ29uZmlybTogJycsXG4gICAgICAgICAgICBwaGFzZTogUGhhc2UuUGFzc3BocmFzZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25QYXNzUGhyYXNlVmFsaWRhdGUgPSAocmVzdWx0OiBJVmFsaWRhdGlvblJlc3VsdCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHBhc3NQaHJhc2VWYWxpZDogcmVzdWx0LnZhbGlkLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBhc3NQaHJhc2VDaGFuZ2UgPSAoZTogUmVhY3QuQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBwYXNzUGhyYXNlOiBlLnRhcmdldC52YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25QYXNzUGhyYXNlQ29uZmlybUNoYW5nZSA9IChlOiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50Pik6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHBhc3NQaHJhc2VDb25maXJtOiBlLnRhcmdldC52YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25BY2NvdW50UGFzc3dvcmRDaGFuZ2UgPSAoZTogUmVhY3QuQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBhY2NvdW50UGFzc3dvcmQ6IGUudGFyZ2V0LnZhbHVlLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZW5kZXJPcHRpb25LZXkoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPFN0eWxlZFJhZGlvQnV0dG9uXG4gICAgICAgICAgICAgICAga2V5PXtTZWN1cmVCYWNrdXBTZXR1cE1ldGhvZC5LZXl9XG4gICAgICAgICAgICAgICAgdmFsdWU9e1NlY3VyZUJhY2t1cFNldHVwTWV0aG9kLktleX1cbiAgICAgICAgICAgICAgICBuYW1lPVwia2V5UGFzc3BocmFzZVwiXG4gICAgICAgICAgICAgICAgY2hlY2tlZD17dGhpcy5zdGF0ZS5wYXNzUGhyYXNlS2V5U2VsZWN0ZWQgPT09IFNlY3VyZUJhY2t1cFNldHVwTWV0aG9kLktleX1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbktleVBhc3NwaHJhc2VDaGFuZ2V9XG4gICAgICAgICAgICAgICAgb3V0bGluZWRcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfb3B0aW9uVGl0bGVcIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ19vcHRpb25JY29uIG14X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfb3B0aW9uSWNvbl9zZWN1cmVCYWNrdXBcIiAvPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiR2VuZXJhdGUgYSBTZWN1cml0eSBLZXlcIikgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXY+eyBfdChcIldlJ2xsIGdlbmVyYXRlIGEgU2VjdXJpdHkgS2V5IGZvciB5b3UgdG8gc3RvcmUgc29tZXdoZXJlIHNhZmUsIGxpa2UgYSBwYXNzd29yZCBtYW5hZ2VyIG9yIGEgc2FmZS5cIikgfTwvZGl2PlxuICAgICAgICAgICAgPC9TdHlsZWRSYWRpb0J1dHRvbj5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlck9wdGlvblBhc3NwaHJhc2UoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPFN0eWxlZFJhZGlvQnV0dG9uXG4gICAgICAgICAgICAgICAga2V5PXtTZWN1cmVCYWNrdXBTZXR1cE1ldGhvZC5QYXNzcGhyYXNlfVxuICAgICAgICAgICAgICAgIHZhbHVlPXtTZWN1cmVCYWNrdXBTZXR1cE1ldGhvZC5QYXNzcGhyYXNlfVxuICAgICAgICAgICAgICAgIG5hbWU9XCJrZXlQYXNzcGhyYXNlXCJcbiAgICAgICAgICAgICAgICBjaGVja2VkPXt0aGlzLnN0YXRlLnBhc3NQaHJhc2VLZXlTZWxlY3RlZCA9PT0gU2VjdXJlQmFja3VwU2V0dXBNZXRob2QuUGFzc3BocmFzZX1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbktleVBhc3NwaHJhc2VDaGFuZ2V9XG4gICAgICAgICAgICAgICAgb3V0bGluZWRcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfb3B0aW9uVGl0bGVcIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ19vcHRpb25JY29uIG14X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfb3B0aW9uSWNvbl9zZWN1cmVQaHJhc2VcIiAvPlxuICAgICAgICAgICAgICAgICAgICB7IF90KFwiRW50ZXIgYSBTZWN1cml0eSBQaHJhc2VcIikgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXY+eyBfdChcIlVzZSBhIHNlY3JldCBwaHJhc2Ugb25seSB5b3Uga25vdywgYW5kIG9wdGlvbmFsbHkgc2F2ZSBhIFNlY3VyaXR5IEtleSB0byB1c2UgZm9yIGJhY2t1cC5cIikgfTwvZGl2PlxuICAgICAgICAgICAgPC9TdHlsZWRSYWRpb0J1dHRvbj5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclBoYXNlQ2hvb3NlS2V5UGFzc3BocmFzZSgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGNvbnN0IHNldHVwTWV0aG9kcyA9IGdldFNlY3VyZUJhY2t1cFNldHVwTWV0aG9kcygpO1xuICAgICAgICBjb25zdCBvcHRpb25LZXkgPSBzZXR1cE1ldGhvZHMuaW5jbHVkZXMoU2VjdXJlQmFja3VwU2V0dXBNZXRob2QuS2V5KSA/IHRoaXMucmVuZGVyT3B0aW9uS2V5KCkgOiBudWxsO1xuICAgICAgICBjb25zdCBvcHRpb25QYXNzcGhyYXNlID0gc2V0dXBNZXRob2RzLmluY2x1ZGVzKFNlY3VyZUJhY2t1cFNldHVwTWV0aG9kLlBhc3NwaHJhc2UpXG4gICAgICAgICAgICA/IHRoaXMucmVuZGVyT3B0aW9uUGFzc3BocmFzZSgpXG4gICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgcmV0dXJuIDxmb3JtIG9uU3VibWl0PXt0aGlzLm9uQ2hvb3NlS2V5UGFzc3BocmFzZUZvcm1TdWJtaXR9PlxuICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwibXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ19jZW50ZXJlZEJvZHlcIj57IF90KFxuICAgICAgICAgICAgICAgIFwiU2FmZWd1YXJkIGFnYWluc3QgbG9zaW5nIGFjY2VzcyB0byBlbmNyeXB0ZWQgbWVzc2FnZXMgJiBkYXRhIGJ5IFwiICtcbiAgICAgICAgICAgICAgICBcImJhY2tpbmcgdXAgZW5jcnlwdGlvbiBrZXlzIG9uIHlvdXIgc2VydmVyLlwiLFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3ByaW1hcnlDb250YWluZXJcIiByb2xlPVwicmFkaW9ncm91cFwiPlxuICAgICAgICAgICAgICAgIHsgb3B0aW9uS2V5IH1cbiAgICAgICAgICAgICAgICB7IG9wdGlvblBhc3NwaHJhc2UgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8RGlhbG9nQnV0dG9uc1xuICAgICAgICAgICAgICAgIHByaW1hcnlCdXR0b249e190KFwiQ29udGludWVcIil9XG4gICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMub25DaG9vc2VLZXlQYXNzcGhyYXNlRm9ybVN1Ym1pdH1cbiAgICAgICAgICAgICAgICBvbkNhbmNlbD17dGhpcy5vbkNhbmNlbENsaWNrfVxuICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17dGhpcy5zdGF0ZS5jYW5Ta2lwfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgPC9mb3JtPjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclBoYXNlTWlncmF0ZSgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIC8vIFRPRE86IFRoaXMgaXMgYSB0ZW1wb3Jhcnkgc2NyZWVuIHNvIHBlb3BsZSB3aG8gaGF2ZSB0aGUgbGFicyBmbGFnIHR1cm5lZCBvbiBhbmRcbiAgICAgICAgLy8gY2xpY2sgdGhlIGJ1dHRvbiBhcmUgYXdhcmUgdGhleSdyZSBtYWtpbmcgYSBjaGFuZ2UgdG8gdGhlaXIgYWNjb3VudC5cbiAgICAgICAgLy8gT25jZSB3ZSdyZSBjb25maWRlbnQgZW5vdWdoIGluIHRoaXMgKGFuZCBpdCdzIHN1cHBvcnRlZCBlbm91Z2gpIHdlIGNhbiBkb1xuICAgICAgICAvLyBpdCBhdXRvbWF0aWNhbGx5LlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vdmVjdG9yLWltL2VsZW1lbnQtd2ViL2lzc3Vlcy8xMTY5NlxuXG4gICAgICAgIGxldCBhdXRoUHJvbXB0O1xuICAgICAgICBsZXQgbmV4dENhcHRpb24gPSBfdChcIk5leHRcIik7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmNhblVwbG9hZEtleXNXaXRoUGFzc3dvcmRPbmx5KSB7XG4gICAgICAgICAgICBhdXRoUHJvbXB0ID0gPGRpdj5cbiAgICAgICAgICAgICAgICA8ZGl2PnsgX3QoXCJFbnRlciB5b3VyIGFjY291bnQgcGFzc3dvcmQgdG8gY29uZmlybSB0aGUgdXBncmFkZTpcIikgfTwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXY+PEZpZWxkXG4gICAgICAgICAgICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdChcIlBhc3N3b3JkXCIpfVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5hY2NvdW50UGFzc3dvcmR9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uQWNjb3VudFBhc3N3b3JkQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICBmb3JjZVZhbGlkaXR5PXt0aGlzLnN0YXRlLmFjY291bnRQYXNzd29yZENvcnJlY3QgPT09IGZhbHNlID8gZmFsc2UgOiBudWxsfVxuICAgICAgICAgICAgICAgICAgICBhdXRvRm9jdXM9e3RydWV9XG4gICAgICAgICAgICAgICAgLz48L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5zdGF0ZS5iYWNrdXBTaWdTdGF0dXMudXNhYmxlKSB7XG4gICAgICAgICAgICBhdXRoUHJvbXB0ID0gPGRpdj5cbiAgICAgICAgICAgICAgICA8ZGl2PnsgX3QoXCJSZXN0b3JlIHlvdXIga2V5IGJhY2t1cCB0byB1cGdyYWRlIHlvdXIgZW5jcnlwdGlvblwiKSB9PC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgICAgICBuZXh0Q2FwdGlvbiA9IF90KFwiUmVzdG9yZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGF1dGhQcm9tcHQgPSA8cD5cbiAgICAgICAgICAgICAgICB7IF90KFwiWW91J2xsIG5lZWQgdG8gYXV0aGVudGljYXRlIHdpdGggdGhlIHNlcnZlciB0byBjb25maXJtIHRoZSB1cGdyYWRlLlwiKSB9XG4gICAgICAgICAgICA8L3A+O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDxmb3JtIG9uU3VibWl0PXt0aGlzLm9uTWlncmF0ZUZvcm1TdWJtaXR9PlxuICAgICAgICAgICAgPHA+eyBfdChcbiAgICAgICAgICAgICAgICBcIlVwZ3JhZGUgdGhpcyBzZXNzaW9uIHRvIGFsbG93IGl0IHRvIHZlcmlmeSBvdGhlciBzZXNzaW9ucywgXCIgK1xuICAgICAgICAgICAgICAgIFwiZ3JhbnRpbmcgdGhlbSBhY2Nlc3MgdG8gZW5jcnlwdGVkIG1lc3NhZ2VzIGFuZCBtYXJraW5nIHRoZW0gXCIgK1xuICAgICAgICAgICAgICAgIFwiYXMgdHJ1c3RlZCBmb3Igb3RoZXIgdXNlcnMuXCIsXG4gICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICA8ZGl2PnsgYXV0aFByb21wdCB9PC9kaXY+XG4gICAgICAgICAgICA8RGlhbG9nQnV0dG9uc1xuICAgICAgICAgICAgICAgIHByaW1hcnlCdXR0b249e25leHRDYXB0aW9ufVxuICAgICAgICAgICAgICAgIG9uUHJpbWFyeUJ1dHRvbkNsaWNrPXt0aGlzLm9uTWlncmF0ZUZvcm1TdWJtaXR9XG4gICAgICAgICAgICAgICAgaGFzQ2FuY2VsPXtmYWxzZX1cbiAgICAgICAgICAgICAgICBwcmltYXJ5RGlzYWJsZWQ9e3RoaXMuc3RhdGUuY2FuVXBsb2FkS2V5c1dpdGhQYXNzd29yZE9ubHkgJiYgIXRoaXMuc3RhdGUuYWNjb3VudFBhc3N3b3JkfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzTmFtZT1cImRhbmdlclwiIG9uQ2xpY2s9e3RoaXMub25DYW5jZWxDbGlja30+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoJ1NraXAnKSB9XG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L0RpYWxvZ0J1dHRvbnM+XG4gICAgICAgIDwvZm9ybT47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJQaGFzZVBhc3NQaHJhc2UoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gPGZvcm0gb25TdWJtaXQ9e3RoaXMub25QYXNzUGhyYXNlTmV4dENsaWNrfT5cbiAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgXCJFbnRlciBhIHNlY3VyaXR5IHBocmFzZSBvbmx5IHlvdSBrbm93LCBhcyBpdCdzIHVzZWQgdG8gc2FmZWd1YXJkIHlvdXIgZGF0YS4gXCIgK1xuICAgICAgICAgICAgICAgIFwiVG8gYmUgc2VjdXJlLCB5b3Ugc2hvdWxkbid0IHJlLXVzZSB5b3VyIGFjY291bnQgcGFzc3dvcmQuXCIsXG4gICAgICAgICAgICApIH08L3A+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ19wYXNzUGhyYXNlQ29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICAgPFBhc3NwaHJhc2VGaWVsZFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3Bhc3NQaHJhc2VGaWVsZFwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uUGFzc1BocmFzZUNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgbWluU2NvcmU9e1BBU1NXT1JEX01JTl9TQ09SRX1cbiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUucGFzc1BocmFzZX1cbiAgICAgICAgICAgICAgICAgICAgb25WYWxpZGF0ZT17dGhpcy5vblBhc3NQaHJhc2VWYWxpZGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgZmllbGRSZWY9e3RoaXMucGFzc3BocmFzZUZpZWxkfVxuICAgICAgICAgICAgICAgICAgICBhdXRvRm9jdXM9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdGQoXCJFbnRlciBhIFNlY3VyaXR5IFBocmFzZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgbGFiZWxFbnRlclBhc3N3b3JkPXtfdGQoXCJFbnRlciBhIFNlY3VyaXR5IFBocmFzZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgbGFiZWxTdHJvbmdQYXNzd29yZD17X3RkKFwiR3JlYXQhIFRoaXMgU2VjdXJpdHkgUGhyYXNlIGxvb2tzIHN0cm9uZyBlbm91Z2guXCIpfVxuICAgICAgICAgICAgICAgICAgICBsYWJlbEFsbG93ZWRCdXRVbnNhZmU9e190ZChcIkdyZWF0ISBUaGlzIFNlY3VyaXR5IFBocmFzZSBsb29rcyBzdHJvbmcgZW5vdWdoLlwiKX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zXG4gICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbj17X3QoJ0NvbnRpbnVlJyl9XG4gICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMub25QYXNzUGhyYXNlTmV4dENsaWNrfVxuICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17ZmFsc2V9XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9eyF0aGlzLnN0YXRlLnBhc3NQaHJhc2VWYWxpZH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uQ2FuY2VsQ2xpY2t9XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImRhbmdlclwiXG4gICAgICAgICAgICAgICAgPnsgX3QoXCJDYW5jZWxcIikgfTwvYnV0dG9uPlxuICAgICAgICAgICAgPC9EaWFsb2dCdXR0b25zPlxuICAgICAgICA8L2Zvcm0+O1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyUGhhc2VQYXNzUGhyYXNlQ29uZmlybSgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGxldCBtYXRjaFRleHQ7XG4gICAgICAgIGxldCBjaGFuZ2VUZXh0O1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5wYXNzUGhyYXNlQ29uZmlybSA9PT0gdGhpcy5zdGF0ZS5wYXNzUGhyYXNlKSB7XG4gICAgICAgICAgICBtYXRjaFRleHQgPSBfdChcIlRoYXQgbWF0Y2hlcyFcIik7XG4gICAgICAgICAgICBjaGFuZ2VUZXh0ID0gX3QoXCJVc2UgYSBkaWZmZXJlbnQgcGFzc3BocmFzZT9cIik7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuc3RhdGUucGFzc1BocmFzZS5zdGFydHNXaXRoKHRoaXMuc3RhdGUucGFzc1BocmFzZUNvbmZpcm0pKSB7XG4gICAgICAgICAgICAvLyBvbmx5IHRlbGwgdGhlbSB0aGV5J3JlIHdyb25nIGlmIHRoZXkndmUgYWN0dWFsbHkgZ29uZSB3cm9uZy5cbiAgICAgICAgICAgIC8vIFNlY3VyaXR5IGNvbmNpb3VzIHJlYWRlcnMgd2lsbCBub3RlIHRoYXQgaWYgeW91IGxlZnQgZWxlbWVudC13ZWIgdW5hdHRlbmRlZFxuICAgICAgICAgICAgLy8gb24gdGhpcyBzY3JlZW4sIHRoaXMgd291bGQgbWFrZSBpdCBlYXN5IGZvciBhIG1hbGljaW91cyBwZXJzb24gdG8gZ3Vlc3NcbiAgICAgICAgICAgIC8vIHlvdXIgcGFzc3BocmFzZSBvbmUgbGV0dGVyIGF0IGEgdGltZSwgYnV0IHRoZXkgY291bGQgZ2V0IHRoaXMgZmFzdGVyIGJ5XG4gICAgICAgICAgICAvLyBqdXN0IG9wZW5pbmcgdGhlIGJyb3dzZXIncyBkZXZlbG9wZXIgdG9vbHMgYW5kIHJlYWRpbmcgaXQuXG4gICAgICAgICAgICAvLyBOb3RlIHRoYXQgbm90IGhhdmluZyB0eXBlZCBhbnl0aGluZyBhdCBhbGwgd2lsbCBub3QgaGl0IHRoaXMgY2xhdXNlIGFuZFxuICAgICAgICAgICAgLy8gZmFsbCB0aHJvdWdoIHNvIGVtcHR5IGJveCA9PT0gbm8gaGludC5cbiAgICAgICAgICAgIG1hdGNoVGV4dCA9IF90KFwiVGhhdCBkb2Vzbid0IG1hdGNoLlwiKTtcbiAgICAgICAgICAgIGNoYW5nZVRleHQgPSBfdChcIkdvIGJhY2sgdG8gc2V0IGl0IGFnYWluLlwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBwYXNzUGhyYXNlTWF0Y2ggPSBudWxsO1xuICAgICAgICBpZiAobWF0Y2hUZXh0KSB7XG4gICAgICAgICAgICBwYXNzUGhyYXNlTWF0Y2ggPSA8ZGl2PlxuICAgICAgICAgICAgICAgIDxkaXY+eyBtYXRjaFRleHQgfTwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGVsZW1lbnQ9XCJzcGFuXCIgY2xhc3NOYW1lPVwibXhfbGlua0J1dHRvblwiIG9uQ2xpY2s9e3RoaXMub25TZXRBZ2FpbkNsaWNrfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgY2hhbmdlVGV4dCB9XG4gICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gPGZvcm0gb25TdWJtaXQ9e3RoaXMub25QYXNzUGhyYXNlQ29uZmlybU5leHRDbGlja30+XG4gICAgICAgICAgICA8cD57IF90KFxuICAgICAgICAgICAgICAgIFwiRW50ZXIgeW91ciBTZWN1cml0eSBQaHJhc2UgYSBzZWNvbmQgdGltZSB0byBjb25maXJtIGl0LlwiLFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3Bhc3NQaHJhc2VDb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25QYXNzUGhyYXNlQ29uZmlybUNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUucGFzc1BocmFzZUNvbmZpcm19XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfcGFzc1BocmFzZUZpZWxkXCJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw9e190KFwiQ29uZmlybSB5b3VyIFNlY3VyaXR5IFBocmFzZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgYXV0b0ZvY3VzPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJuZXctcGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3Bhc3NQaHJhc2VNYXRjaFwiPlxuICAgICAgICAgICAgICAgICAgICB7IHBhc3NQaHJhc2VNYXRjaCB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zXG4gICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbj17X3QoJ0NvbnRpbnVlJyl9XG4gICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMub25QYXNzUGhyYXNlQ29uZmlybU5leHRDbGlja31cbiAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e2ZhbHNlfVxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLnBhc3NQaHJhc2UgIT09IHRoaXMuc3RhdGUucGFzc1BocmFzZUNvbmZpcm19XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5vbkNhbmNlbENsaWNrfVxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJkYW5nZXJcIlxuICAgICAgICAgICAgICAgID57IF90KFwiU2tpcFwiKSB9PC9idXR0b24+XG4gICAgICAgICAgICA8L0RpYWxvZ0J1dHRvbnM+XG4gICAgICAgIDwvZm9ybT47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJQaGFzZVNob3dLZXkoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBsZXQgY29udGludWVCdXR0b247XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnBoYXNlID09PSBQaGFzZS5TaG93S2V5KSB7XG4gICAgICAgICAgICBjb250aW51ZUJ1dHRvbiA9IDxEaWFsb2dCdXR0b25zIHByaW1hcnlCdXR0b249e190KFwiQ29udGludWVcIil9XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9eyF0aGlzLnN0YXRlLmRvd25sb2FkZWQgJiYgIXRoaXMuc3RhdGUuY29waWVkICYmICF0aGlzLnN0YXRlLnNldFBhc3NwaHJhc2V9XG4gICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMub25TaG93S2V5Q29udGludWVDbGlja31cbiAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e2ZhbHNlfVxuICAgICAgICAgICAgLz47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250aW51ZUJ1dHRvbiA9IDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ19jb250aW51ZVNwaW5uZXJcIj5cbiAgICAgICAgICAgICAgICA8SW5saW5lU3Bpbm5lciAvPlxuICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDxkaXY+XG4gICAgICAgICAgICA8cD57IF90KFxuICAgICAgICAgICAgICAgIFwiU3RvcmUgeW91ciBTZWN1cml0eSBLZXkgc29tZXdoZXJlIHNhZmUsIGxpa2UgYSBwYXNzd29yZCBtYW5hZ2VyIG9yIGEgc2FmZSwgXCIgK1xuICAgICAgICAgICAgICAgIFwiYXMgaXQncyB1c2VkIHRvIHNhZmVndWFyZCB5b3VyIGVuY3J5cHRlZCBkYXRhLlwiLFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3ByaW1hcnlDb250YWluZXIgbXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ19yZWNvdmVyeUtleVByaW1hcnljb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfcmVjb3ZlcnlLZXlDb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3JlY292ZXJ5S2V5XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Y29kZSByZWY9e3RoaXMucmVjb3ZlcnlLZXlOb2RlfT57IHRoaXMucmVjb3ZlcnlLZXkuZW5jb2RlZFByaXZhdGVLZXkgfTwvY29kZT5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ19yZWNvdmVyeUtleUJ1dHRvbnNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGtpbmQ9J3ByaW1hcnknXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfRGlhbG9nX3ByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMub25Eb3dubG9hZENsaWNrfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLnBoYXNlID09PSBQaGFzZS5TdG9yaW5nfVxuICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJEb3dubG9hZFwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57IF90KFwib3JcIikgfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2luZD0ncHJpbWFyeSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9EaWFsb2dfcHJpbWFyeSBteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3JlY292ZXJ5S2V5QnV0dG9uc19jb3B5QnRuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uQ29weUNsaWNrfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLnBoYXNlID09PSBQaGFzZS5TdG9yaW5nfVxuICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm14X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfcmVjb3ZlcnlLZXlDb3B5QnV0dG9uVGV4dFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IGhlaWdodDogdGhpcy5zdGF0ZS5jb3BpZWQgPyAnMCcgOiAnYXV0bycgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS1oaWRkZW49e3RoaXMuc3RhdGUuY29waWVkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkNvcHlcIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3JlY292ZXJ5S2V5Q29weUJ1dHRvblRleHRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17eyBoZWlnaHQ6IHRoaXMuc3RhdGUuY29waWVkID8gJ2F1dG8nIDogJzAnIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtaGlkZGVuPXshdGhpcy5zdGF0ZS5jb3BpZWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KFwiQ29waWVkIVwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgeyBjb250aW51ZUJ1dHRvbiB9XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlckJ1c3lQaGFzZSgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgPFNwaW5uZXIgLz5cbiAgICAgICAgPC9kaXY+O1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyUGhhc2VMb2FkRXJyb3IoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gPGRpdj5cbiAgICAgICAgICAgIDxwPnsgX3QoXCJVbmFibGUgdG8gcXVlcnkgc2VjcmV0IHN0b3JhZ2Ugc3RhdHVzXCIpIH08L3A+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0RpYWxvZ19idXR0b25zXCI+XG4gICAgICAgICAgICAgICAgPERpYWxvZ0J1dHRvbnMgcHJpbWFyeUJ1dHRvbj17X3QoJ1JldHJ5Jyl9XG4gICAgICAgICAgICAgICAgICAgIG9uUHJpbWFyeUJ1dHRvbkNsaWNrPXt0aGlzLm9uTG9hZFJldHJ5Q2xpY2t9XG4gICAgICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17dGhpcy5zdGF0ZS5jYW5Ta2lwfVxuICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbD17dGhpcy5vbkNhbmNlbH1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclBoYXNlU2tpcENvbmZpcm0oKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gPGRpdj5cbiAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgXCJJZiB5b3UgY2FuY2VsIG5vdywgeW91IG1heSBsb3NlIGVuY3J5cHRlZCBtZXNzYWdlcyAmIGRhdGEgaWYgeW91IGxvc2UgYWNjZXNzIHRvIHlvdXIgbG9naW5zLlwiLFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPHA+eyBfdChcbiAgICAgICAgICAgICAgICBcIllvdSBjYW4gYWxzbyBzZXQgdXAgU2VjdXJlIEJhY2t1cCAmIG1hbmFnZSB5b3VyIGtleXMgaW4gU2V0dGluZ3MuXCIsXG4gICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICA8RGlhbG9nQnV0dG9ucyBwcmltYXJ5QnV0dG9uPXtfdCgnR28gYmFjaycpfVxuICAgICAgICAgICAgICAgIG9uUHJpbWFyeUJ1dHRvbkNsaWNrPXt0aGlzLm9uR29CYWNrQ2xpY2t9XG4gICAgICAgICAgICAgICAgaGFzQ2FuY2VsPXtmYWxzZX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzc05hbWU9XCJkYW5nZXJcIiBvbkNsaWNrPXt0aGlzLm9uQ2FuY2VsfT57IF90KCdDYW5jZWwnKSB9PC9idXR0b24+XG4gICAgICAgICAgICA8L0RpYWxvZ0J1dHRvbnM+XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRpdGxlRm9yUGhhc2UocGhhc2U6IFBoYXNlKTogc3RyaW5nIHtcbiAgICAgICAgc3dpdGNoIChwaGFzZSkge1xuICAgICAgICAgICAgY2FzZSBQaGFzZS5DaG9vc2VLZXlQYXNzcGhyYXNlOlxuICAgICAgICAgICAgICAgIHJldHVybiBfdCgnU2V0IHVwIFNlY3VyZSBCYWNrdXAnKTtcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuTWlncmF0ZTpcbiAgICAgICAgICAgICAgICByZXR1cm4gX3QoJ1VwZ3JhZGUgeW91ciBlbmNyeXB0aW9uJyk7XG4gICAgICAgICAgICBjYXNlIFBoYXNlLlBhc3NwaHJhc2U6XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90KCdTZXQgYSBTZWN1cml0eSBQaHJhc2UnKTtcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuUGFzc3BocmFzZUNvbmZpcm06XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90KCdDb25maXJtIFNlY3VyaXR5IFBocmFzZScpO1xuICAgICAgICAgICAgY2FzZSBQaGFzZS5Db25maXJtU2tpcDpcbiAgICAgICAgICAgICAgICByZXR1cm4gX3QoJ0FyZSB5b3Ugc3VyZT8nKTtcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuU2hvd0tleTpcbiAgICAgICAgICAgICAgICByZXR1cm4gX3QoJ1NhdmUgeW91ciBTZWN1cml0eSBLZXknKTtcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuU3RvcmluZzpcbiAgICAgICAgICAgICAgICByZXR1cm4gX3QoJ1NldHRpbmcgdXAga2V5cycpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgcmVuZGVyKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgbGV0IGNvbnRlbnQ7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmVycm9yKSB7XG4gICAgICAgICAgICBjb250ZW50ID0gPGRpdj5cbiAgICAgICAgICAgICAgICA8cD57IF90KFwiVW5hYmxlIHRvIHNldCB1cCBzZWNyZXQgc3RvcmFnZVwiKSB9PC9wPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRGlhbG9nX2J1dHRvbnNcIj5cbiAgICAgICAgICAgICAgICAgICAgPERpYWxvZ0J1dHRvbnMgcHJpbWFyeUJ1dHRvbj17X3QoJ1JldHJ5Jyl9XG4gICAgICAgICAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17dGhpcy5ib290c3RyYXBTZWNyZXRTdG9yYWdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzQ2FuY2VsPXt0aGlzLnN0YXRlLmNhblNraXB9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbD17dGhpcy5vbkNhbmNlbH1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZS5waGFzZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgUGhhc2UuTG9hZGluZzpcbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMucmVuZGVyQnVzeVBoYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgUGhhc2UuTG9hZEVycm9yOlxuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy5yZW5kZXJQaGFzZUxvYWRFcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFBoYXNlLkNob29zZUtleVBhc3NwaHJhc2U6XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLnJlbmRlclBoYXNlQ2hvb3NlS2V5UGFzc3BocmFzZSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFBoYXNlLk1pZ3JhdGU6XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLnJlbmRlclBoYXNlTWlncmF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFBoYXNlLlBhc3NwaHJhc2U6XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLnJlbmRlclBoYXNlUGFzc1BocmFzZSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFBoYXNlLlBhc3NwaHJhc2VDb25maXJtOlxuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy5yZW5kZXJQaGFzZVBhc3NQaHJhc2VDb25maXJtKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgUGhhc2UuU2hvd0tleTpcbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMucmVuZGVyUGhhc2VTaG93S2V5KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgUGhhc2UuU3RvcmluZzpcbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMucmVuZGVyQnVzeVBoYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgUGhhc2UuQ29uZmlybVNraXA6XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLnJlbmRlclBoYXNlU2tpcENvbmZpcm0oKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdGl0bGVDbGFzcyA9IG51bGw7XG4gICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZS5waGFzZSkge1xuICAgICAgICAgICAgY2FzZSBQaGFzZS5QYXNzcGhyYXNlOlxuICAgICAgICAgICAgY2FzZSBQaGFzZS5QYXNzcGhyYXNlQ29uZmlybTpcbiAgICAgICAgICAgICAgICB0aXRsZUNsYXNzID0gW1xuICAgICAgICAgICAgICAgICAgICAnbXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ190aXRsZVdpdGhJY29uJyxcbiAgICAgICAgICAgICAgICAgICAgJ214X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfc2VjdXJlUGhyYXNlVGl0bGUnLFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFBoYXNlLlNob3dLZXk6XG4gICAgICAgICAgICAgICAgdGl0bGVDbGFzcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgJ214X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2dfdGl0bGVXaXRoSWNvbicsXG4gICAgICAgICAgICAgICAgICAgICdteF9DcmVhdGVTZWNyZXRTdG9yYWdlRGlhbG9nX3NlY3VyZUJhY2t1cFRpdGxlJyxcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBQaGFzZS5DaG9vc2VLZXlQYXNzcGhyYXNlOlxuICAgICAgICAgICAgICAgIHRpdGxlQ2xhc3MgPSAnbXhfQ3JlYXRlU2VjcmV0U3RvcmFnZURpYWxvZ19jZW50ZXJlZFRpdGxlJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZyBjbGFzc05hbWU9J214X0NyZWF0ZVNlY3JldFN0b3JhZ2VEaWFsb2cnXG4gICAgICAgICAgICAgICAgb25GaW5pc2hlZD17dGhpcy5wcm9wcy5vbkZpbmlzaGVkfVxuICAgICAgICAgICAgICAgIHRpdGxlPXt0aGlzLnRpdGxlRm9yUGhhc2UodGhpcy5zdGF0ZS5waGFzZSl9XG4gICAgICAgICAgICAgICAgdGl0bGVDbGFzcz17dGl0bGVDbGFzc31cbiAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e3RoaXMucHJvcHMuaGFzQ2FuY2VsICYmIFtQaGFzZS5QYXNzcGhyYXNlXS5pbmNsdWRlcyh0aGlzLnN0YXRlLnBoYXNlKX1cbiAgICAgICAgICAgICAgICBmaXhlZFdpZHRoPXtmYWxzZX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICB7IGNvbnRlbnQgfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9CYXNlRGlhbG9nPlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==