"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _fileSaver = _interopRequireDefault(require("file-saver"));

var _MatrixClientPeg = require("../../../../MatrixClientPeg");

var _languageHandler = require("../../../../languageHandler");

var _SecurityManager = require("../../../../SecurityManager");

var _AccessibleButton = _interopRequireDefault(require("../../../../components/views/elements/AccessibleButton"));

var _strings = require("../../../../utils/strings");

var _PassphraseField = _interopRequireDefault(require("../../../../components/views/auth/PassphraseField"));

var _Spinner = _interopRequireDefault(require("../../../../components/views/elements/Spinner"));

var _BaseDialog = _interopRequireDefault(require("../../../../components/views/dialogs/BaseDialog"));

var _DialogButtons = _interopRequireDefault(require("../../../../components/views/elements/DialogButtons"));

var _logger = require("matrix-js-sdk/src/logger");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2018, 2019 New Vector Ltd
Copyright 2019, 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
var Phase;

(function (Phase) {
  Phase["Passphrase"] = "passphrase";
  Phase["PassphraseConfirm"] = "passphrase_confirm";
  Phase["ShowKey"] = "show_key";
  Phase["KeepItSafe"] = "keep_it_safe";
  Phase["BackingUp"] = "backing_up";
  Phase["Done"] = "done";
  Phase["OptOutConfirm"] = "opt_out_confirm";
})(Phase || (Phase = {}));

const PASSWORD_MIN_SCORE = 4; // So secure, many characters, much complex, wow, etc, etc.

/*
 * Walks the user through the process of creating an e2e key backup
 * on the server.
 */
class CreateKeyBackupDialog extends _react.default.PureComponent {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "keyBackupInfo", void 0);
    (0, _defineProperty2.default)(this, "recoveryKeyNode", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "passphraseField", /*#__PURE__*/(0, _react.createRef)());
    (0, _defineProperty2.default)(this, "onCopyClick", () => {
      const successful = (0, _strings.copyNode)(this.recoveryKeyNode.current);

      if (successful) {
        this.setState({
          copied: true,
          phase: Phase.KeepItSafe
        });
      }
    });
    (0, _defineProperty2.default)(this, "onDownloadClick", () => {
      const blob = new Blob([this.keyBackupInfo.recovery_key], {
        type: 'text/plain;charset=us-ascii'
      });

      _fileSaver.default.saveAs(blob, 'security-key.txt');

      this.setState({
        downloaded: true,
        phase: Phase.KeepItSafe
      });
    });
    (0, _defineProperty2.default)(this, "createBackup", async () => {
      const {
        secureSecretStorage
      } = this.state;
      this.setState({
        phase: Phase.BackingUp,
        error: null
      });
      let info;

      try {
        if (secureSecretStorage) {
          await (0, _SecurityManager.accessSecretStorage)(async () => {
            info = await _MatrixClientPeg.MatrixClientPeg.get().prepareKeyBackupVersion(null
            /* random key */
            , {
              secureSecretStorage: true
            });
            info = await _MatrixClientPeg.MatrixClientPeg.get().createKeyBackupVersion(info);
          });
        } else {
          info = await _MatrixClientPeg.MatrixClientPeg.get().createKeyBackupVersion(this.keyBackupInfo);
        }

        await _MatrixClientPeg.MatrixClientPeg.get().scheduleAllGroupSessionsForBackup();
        this.setState({
          phase: Phase.Done
        });
      } catch (e) {
        _logger.logger.error("Error creating key backup", e); // TODO: If creating a version succeeds, but backup fails, should we
        // delete the version, disable backup, or do nothing?  If we just
        // disable without deleting, we'll enable on next app reload since
        // it is trusted.


        if (info) {
          _MatrixClientPeg.MatrixClientPeg.get().deleteKeyBackupVersion(info.version);
        }

        this.setState({
          error: e
        });
      }
    });
    (0, _defineProperty2.default)(this, "onCancel", () => {
      this.props.onFinished(false);
    });
    (0, _defineProperty2.default)(this, "onDone", () => {
      this.props.onFinished(true);
    });
    (0, _defineProperty2.default)(this, "onSetUpClick", () => {
      this.setState({
        phase: Phase.Passphrase
      });
    });
    (0, _defineProperty2.default)(this, "onSkipPassPhraseClick", async () => {
      this.keyBackupInfo = await _MatrixClientPeg.MatrixClientPeg.get().prepareKeyBackupVersion();
      this.setState({
        copied: false,
        downloaded: false,
        phase: Phase.ShowKey
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseNextClick", async e => {
      e.preventDefault();
      if (!this.passphraseField.current) return; // unmounting

      await this.passphraseField.current.validate({
        allowEmpty: false
      });

      if (!this.passphraseField.current.state.valid) {
        this.passphraseField.current.focus();
        this.passphraseField.current.validate({
          allowEmpty: false,
          focused: true
        });
        return;
      }

      this.setState({
        phase: Phase.PassphraseConfirm
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseConfirmNextClick", async e => {
      e.preventDefault();
      if (this.state.passPhrase !== this.state.passPhraseConfirm) return;
      this.keyBackupInfo = await _MatrixClientPeg.MatrixClientPeg.get().prepareKeyBackupVersion(this.state.passPhrase);
      this.setState({
        copied: false,
        downloaded: false,
        phase: Phase.ShowKey
      });
    });
    (0, _defineProperty2.default)(this, "onSetAgainClick", () => {
      this.setState({
        passPhrase: '',
        passPhraseValid: false,
        passPhraseConfirm: '',
        phase: Phase.Passphrase
      });
    });
    (0, _defineProperty2.default)(this, "onKeepItSafeBackClick", () => {
      this.setState({
        phase: Phase.ShowKey
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseValidate", result => {
      this.setState({
        passPhraseValid: result.valid
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseChange", e => {
      this.setState({
        passPhrase: e.target.value
      });
    });
    (0, _defineProperty2.default)(this, "onPassPhraseConfirmChange", e => {
      this.setState({
        passPhraseConfirm: e.target.value
      });
    });
    this.state = {
      secureSecretStorage: null,
      phase: Phase.Passphrase,
      passPhrase: '',
      passPhraseValid: false,
      passPhraseConfirm: '',
      copied: false,
      downloaded: false
    };
  }

  async componentDidMount() {
    const cli = _MatrixClientPeg.MatrixClientPeg.get();

    const secureSecretStorage = await cli.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing");
    this.setState({
      secureSecretStorage
    }); // If we're using secret storage, skip ahead to the backing up step, as
    // `accessSecretStorage` will handle passphrases as needed.

    if (secureSecretStorage) {
      this.setState({
        phase: Phase.BackingUp
      });
      this.createBackup();
    }
  }

  renderPhasePassPhrase() {
    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onPassPhraseNextClick
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("<b>Warning</b>: You should only set up key backup from a trusted computer.", {}, {
      b: sub => /*#__PURE__*/_react.default.createElement("b", null, sub)
    })), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("We'll store an encrypted copy of your keys on our server. " + "Secure your backup with a Security Phrase.")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("For maximum security, this should be different from your account password.")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_primaryContainer"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_passPhraseContainer"
    }, /*#__PURE__*/_react.default.createElement(_PassphraseField.default, {
      className: "mx_CreateKeyBackupDialog_passPhraseInput",
      onChange: this.onPassPhraseChange,
      minScore: PASSWORD_MIN_SCORE,
      value: this.state.passPhrase,
      onValidate: this.onPassPhraseValidate,
      fieldRef: this.passphraseField,
      autoFocus: true,
      label: (0, _languageHandler._td)("Enter a Security Phrase"),
      labelEnterPassword: (0, _languageHandler._td)("Enter a Security Phrase"),
      labelStrongPassword: (0, _languageHandler._td)("Great! This Security Phrase looks strong enough."),
      labelAllowedButUnsafe: (0, _languageHandler._td)("Great! This Security Phrase looks strong enough.")
    }))), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('Next'),
      onPrimaryButtonClick: this.onPassPhraseNextClick,
      hasCancel: false,
      disabled: !this.state.passPhraseValid
    }), /*#__PURE__*/_react.default.createElement("details", null, /*#__PURE__*/_react.default.createElement("summary", null, (0, _languageHandler._t)("Advanced")), /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      kind: "primary",
      onClick: this.onSkipPassPhraseClick
    }, (0, _languageHandler._t)("Set up with a Security Key"))));
  }

  renderPhasePassPhraseConfirm() {
    let matchText;
    let changeText;

    if (this.state.passPhraseConfirm === this.state.passPhrase) {
      matchText = (0, _languageHandler._t)("That matches!");
      changeText = (0, _languageHandler._t)("Use a different passphrase?");
    } else if (!this.state.passPhrase.startsWith(this.state.passPhraseConfirm)) {
      // only tell them they're wrong if they've actually gone wrong.
      // Security concious readers will note that if you left element-web unattended
      // on this screen, this would make it easy for a malicious person to guess
      // your passphrase one letter at a time, but they could get this faster by
      // just opening the browser's developer tools and reading it.
      // Note that not having typed anything at all will not hit this clause and
      // fall through so empty box === no hint.
      matchText = (0, _languageHandler._t)("That doesn't match.");
      changeText = (0, _languageHandler._t)("Go back to set it again.");
    }

    let passPhraseMatch = null;

    if (matchText) {
      passPhraseMatch = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_CreateKeyBackupDialog_passPhraseMatch"
      }, /*#__PURE__*/_react.default.createElement("div", null, matchText), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        element: "span",
        className: "mx_linkButton",
        onClick: this.onSetAgainClick
      }, changeText)));
    }

    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this.onPassPhraseConfirmNextClick
    }, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Enter your Security Phrase a second time to confirm it.")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_primaryContainer"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_passPhraseContainer"
    }, /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("input", {
      type: "password",
      onChange: this.onPassPhraseConfirmChange,
      value: this.state.passPhraseConfirm,
      className: "mx_CreateKeyBackupDialog_passPhraseInput",
      placeholder: (0, _languageHandler._t)("Repeat your Security Phrase..."),
      autoFocus: true
    })), passPhraseMatch)), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('Next'),
      onPrimaryButtonClick: this.onPassPhraseConfirmNextClick,
      hasCancel: false,
      disabled: this.state.passPhrase !== this.state.passPhraseConfirm
    }));
  }

  renderPhaseShowKey() {
    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Your Security Key is a safety net - you can use it to restore " + "access to your encrypted messages if you forget your Security Phrase.")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Keep a copy of it somewhere secure, like a password manager or even a safe.")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_primaryContainer"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_recoveryKeyHeader"
    }, (0, _languageHandler._t)("Your Security Key")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_recoveryKeyContainer"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_recoveryKey"
    }, /*#__PURE__*/_react.default.createElement("code", {
      ref: this.recoveryKeyNode
    }, this.keyBackupInfo.recovery_key)), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_CreateKeyBackupDialog_recoveryKeyButtons"
    }, /*#__PURE__*/_react.default.createElement("button", {
      className: "mx_Dialog_primary",
      onClick: this.onCopyClick
    }, (0, _languageHandler._t)("Copy")), /*#__PURE__*/_react.default.createElement("button", {
      className: "mx_Dialog_primary",
      onClick: this.onDownloadClick
    }, (0, _languageHandler._t)("Download"))))));
  }

  renderPhaseKeepItSafe() {
    let introText;

    if (this.state.copied) {
      introText = (0, _languageHandler._t)("Your Security Key has been <b>copied to your clipboard</b>, paste it to:", {}, {
        b: s => /*#__PURE__*/_react.default.createElement("b", null, s)
      });
    } else if (this.state.downloaded) {
      introText = (0, _languageHandler._t)("Your Security Key is in your <b>Downloads</b> folder.", {}, {
        b: s => /*#__PURE__*/_react.default.createElement("b", null, s)
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", null, introText, /*#__PURE__*/_react.default.createElement("ul", null, /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("<b>Print it</b> and store it somewhere safe", {}, {
      b: s => /*#__PURE__*/_react.default.createElement("b", null, s)
    })), /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("<b>Save it</b> on a USB key or backup drive", {}, {
      b: s => /*#__PURE__*/_react.default.createElement("b", null, s)
    })), /*#__PURE__*/_react.default.createElement("li", null, (0, _languageHandler._t)("<b>Copy it</b> to your personal cloud storage", {}, {
      b: s => /*#__PURE__*/_react.default.createElement("b", null, s)
    }))), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)("Continue"),
      onPrimaryButtonClick: this.createBackup,
      hasCancel: false
    }, /*#__PURE__*/_react.default.createElement("button", {
      onClick: this.onKeepItSafeBackClick
    }, (0, _languageHandler._t)("Back"))));
  }

  renderBusyPhase() {
    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_Spinner.default, null));
  }

  renderPhaseDone() {
    return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Your keys are being backed up (the first backup could take a few minutes).")), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('OK'),
      onPrimaryButtonClick: this.onDone,
      hasCancel: false
    }));
  }

  renderPhaseOptOutConfirm() {
    return /*#__PURE__*/_react.default.createElement("div", null, (0, _languageHandler._t)("Without setting up Secure Message Recovery, you won't be able to restore your " + "encrypted message history if you log out or use another session."), /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
      primaryButton: (0, _languageHandler._t)('Set up Secure Message Recovery'),
      onPrimaryButtonClick: this.onSetUpClick,
      hasCancel: false
    }, /*#__PURE__*/_react.default.createElement("button", {
      onClick: this.onCancel
    }, "I understand, continue without")));
  }

  titleForPhase(phase) {
    switch (phase) {
      case Phase.Passphrase:
        return (0, _languageHandler._t)('Secure your backup with a Security Phrase');

      case Phase.PassphraseConfirm:
        return (0, _languageHandler._t)('Confirm your Security Phrase');

      case Phase.OptOutConfirm:
        return (0, _languageHandler._t)('Warning!');

      case Phase.ShowKey:
      case Phase.KeepItSafe:
        return (0, _languageHandler._t)('Make a copy of your Security Key');

      case Phase.BackingUp:
        return (0, _languageHandler._t)('Starting backup...');

      case Phase.Done:
        return (0, _languageHandler._t)('Success!');

      default:
        return (0, _languageHandler._t)("Create key backup");
    }
  }

  render() {
    let content;

    if (this.state.error) {
      content = /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Unable to create key backup")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_Dialog_buttons"
      }, /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
        primaryButton: (0, _languageHandler._t)('Retry'),
        onPrimaryButtonClick: this.createBackup,
        hasCancel: true,
        onCancel: this.onCancel
      })));
    } else {
      switch (this.state.phase) {
        case Phase.Passphrase:
          content = this.renderPhasePassPhrase();
          break;

        case Phase.PassphraseConfirm:
          content = this.renderPhasePassPhraseConfirm();
          break;

        case Phase.ShowKey:
          content = this.renderPhaseShowKey();
          break;

        case Phase.KeepItSafe:
          content = this.renderPhaseKeepItSafe();
          break;

        case Phase.BackingUp:
          content = this.renderBusyPhase();
          break;

        case Phase.Done:
          content = this.renderPhaseDone();
          break;

        case Phase.OptOutConfirm:
          content = this.renderPhaseOptOutConfirm();
          break;
      }
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_CreateKeyBackupDialog",
      onFinished: this.props.onFinished,
      title: this.titleForPhase(this.state.phase),
      hasCancel: [Phase.Passphrase, Phase.Done].includes(this.state.phase)
    }, /*#__PURE__*/_react.default.createElement("div", null, content));
  }

}

exports.default = CreateKeyBackupDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9hc3luYy1jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3Mvc2VjdXJpdHkvQ3JlYXRlS2V5QmFja3VwRGlhbG9nLnRzeCJdLCJuYW1lcyI6WyJQaGFzZSIsIlBBU1NXT1JEX01JTl9TQ09SRSIsIkNyZWF0ZUtleUJhY2t1cERpYWxvZyIsIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzdWNjZXNzZnVsIiwicmVjb3ZlcnlLZXlOb2RlIiwiY3VycmVudCIsInNldFN0YXRlIiwiY29waWVkIiwicGhhc2UiLCJLZWVwSXRTYWZlIiwiYmxvYiIsIkJsb2IiLCJrZXlCYWNrdXBJbmZvIiwicmVjb3Zlcnlfa2V5IiwidHlwZSIsIkZpbGVTYXZlciIsInNhdmVBcyIsImRvd25sb2FkZWQiLCJzZWN1cmVTZWNyZXRTdG9yYWdlIiwic3RhdGUiLCJCYWNraW5nVXAiLCJlcnJvciIsImluZm8iLCJNYXRyaXhDbGllbnRQZWciLCJnZXQiLCJwcmVwYXJlS2V5QmFja3VwVmVyc2lvbiIsImNyZWF0ZUtleUJhY2t1cFZlcnNpb24iLCJzY2hlZHVsZUFsbEdyb3VwU2Vzc2lvbnNGb3JCYWNrdXAiLCJEb25lIiwiZSIsImxvZ2dlciIsImRlbGV0ZUtleUJhY2t1cFZlcnNpb24iLCJ2ZXJzaW9uIiwib25GaW5pc2hlZCIsIlBhc3NwaHJhc2UiLCJTaG93S2V5IiwicHJldmVudERlZmF1bHQiLCJwYXNzcGhyYXNlRmllbGQiLCJ2YWxpZGF0ZSIsImFsbG93RW1wdHkiLCJ2YWxpZCIsImZvY3VzIiwiZm9jdXNlZCIsIlBhc3NwaHJhc2VDb25maXJtIiwicGFzc1BocmFzZSIsInBhc3NQaHJhc2VDb25maXJtIiwicGFzc1BocmFzZVZhbGlkIiwicmVzdWx0IiwidGFyZ2V0IiwidmFsdWUiLCJjb21wb25lbnREaWRNb3VudCIsImNsaSIsImRvZXNTZXJ2ZXJTdXBwb3J0VW5zdGFibGVGZWF0dXJlIiwiY3JlYXRlQmFja3VwIiwicmVuZGVyUGhhc2VQYXNzUGhyYXNlIiwib25QYXNzUGhyYXNlTmV4dENsaWNrIiwiYiIsInN1YiIsIm9uUGFzc1BocmFzZUNoYW5nZSIsIm9uUGFzc1BocmFzZVZhbGlkYXRlIiwib25Ta2lwUGFzc1BocmFzZUNsaWNrIiwicmVuZGVyUGhhc2VQYXNzUGhyYXNlQ29uZmlybSIsIm1hdGNoVGV4dCIsImNoYW5nZVRleHQiLCJzdGFydHNXaXRoIiwicGFzc1BocmFzZU1hdGNoIiwib25TZXRBZ2FpbkNsaWNrIiwib25QYXNzUGhyYXNlQ29uZmlybU5leHRDbGljayIsIm9uUGFzc1BocmFzZUNvbmZpcm1DaGFuZ2UiLCJyZW5kZXJQaGFzZVNob3dLZXkiLCJvbkNvcHlDbGljayIsIm9uRG93bmxvYWRDbGljayIsInJlbmRlclBoYXNlS2VlcEl0U2FmZSIsImludHJvVGV4dCIsInMiLCJvbktlZXBJdFNhZmVCYWNrQ2xpY2siLCJyZW5kZXJCdXN5UGhhc2UiLCJyZW5kZXJQaGFzZURvbmUiLCJvbkRvbmUiLCJyZW5kZXJQaGFzZU9wdE91dENvbmZpcm0iLCJvblNldFVwQ2xpY2siLCJvbkNhbmNlbCIsInRpdGxlRm9yUGhhc2UiLCJPcHRPdXRDb25maXJtIiwicmVuZGVyIiwiY29udGVudCIsImluY2x1ZGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWlCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFHQTs7Ozs7O0FBaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0lBbUJLQSxLOztXQUFBQSxLO0FBQUFBLEVBQUFBLEs7QUFBQUEsRUFBQUEsSztBQUFBQSxFQUFBQSxLO0FBQUFBLEVBQUFBLEs7QUFBQUEsRUFBQUEsSztBQUFBQSxFQUFBQSxLO0FBQUFBLEVBQUFBLEs7R0FBQUEsSyxLQUFBQSxLOztBQVVMLE1BQU1DLGtC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RSxLQUFLN0UsS0FBTCxDQUFXK0IsVUFEM0I7QUFFSSxNQUFBLEtBQUssRUFBRSxLQUFLaUQsYUFBTCxDQUFtQixLQUFLL0QsS0FBTCxDQUFXWCxLQUE5QixDQUZYO0FBR0ksTUFBQSxTQUFTLEVBQUUsQ0FBQ1osS0FBSyxDQUFDc0MsVUFBUCxFQUFtQnRDLEtBQUssQ0FBQ2dDLElBQXpCLEVBQStCMEQsUUFBL0IsQ0FBd0MsS0FBS25FLEtBQUwsQ0FBV1gsS0FBbkQ7QUFIZixvQkFLSSwwQ0FDTTZFLE9BRE4sQ0FMSixDQURKO0FBV0g7O0FBdGJrRiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOCwgMjAxOSBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTksIDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QsIHsgY3JlYXRlUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IEZpbGVTYXZlciBmcm9tICdmaWxlLXNhdmVyJztcbmltcG9ydCB7IE1hdHJpeENsaWVudFBlZyB9IGZyb20gJy4uLy4uLy4uLy4uL01hdHJpeENsaWVudFBlZyc7XG5pbXBvcnQgeyBfdCwgX3RkIH0gZnJvbSAnLi4vLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCB7IGFjY2Vzc1NlY3JldFN0b3JhZ2UgfSBmcm9tICcuLi8uLi8uLi8uLi9TZWN1cml0eU1hbmFnZXInO1xuaW1wb3J0IEFjY2Vzc2libGVCdXR0b24gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IHsgY29weU5vZGUgfSBmcm9tIFwiLi4vLi4vLi4vLi4vdXRpbHMvc3RyaW5nc1wiO1xuaW1wb3J0IFBhc3NwaHJhc2VGaWVsZCBmcm9tIFwiLi4vLi4vLi4vLi4vY29tcG9uZW50cy92aWV3cy9hdXRoL1Bhc3NwaHJhc2VGaWVsZFwiO1xuaW1wb3J0IHsgSURpYWxvZ1Byb3BzIH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvZGlhbG9ncy9JRGlhbG9nUHJvcHNcIjtcbmltcG9ydCBGaWVsZCBmcm9tIFwiLi4vLi4vLi4vLi4vY29tcG9uZW50cy92aWV3cy9lbGVtZW50cy9GaWVsZFwiO1xuaW1wb3J0IFNwaW5uZXIgZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvZWxlbWVudHMvU3Bpbm5lclwiO1xuaW1wb3J0IEJhc2VEaWFsb2cgZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvZGlhbG9ncy9CYXNlRGlhbG9nXCI7XG5pbXBvcnQgRGlhbG9nQnV0dG9ucyBmcm9tIFwiLi4vLi4vLi4vLi4vY29tcG9uZW50cy92aWV3cy9lbGVtZW50cy9EaWFsb2dCdXR0b25zXCI7XG5pbXBvcnQgeyBJVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL1ZhbGlkYXRpb25cIjtcbmltcG9ydCB7IElQcmVwYXJlZEtleUJhY2t1cFZlcnNpb24gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvY3J5cHRvL2JhY2t1cFwiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIm1hdHJpeC1qcy1zZGsvc3JjL2xvZ2dlclwiO1xuXG5lbnVtIFBoYXNlIHtcbiAgICBQYXNzcGhyYXNlID0gXCJwYXNzcGhyYXNlXCIsXG4gICAgUGFzc3BocmFzZUNvbmZpcm0gPSBcInBhc3NwaHJhc2VfY29uZmlybVwiLFxuICAgIFNob3dLZXkgPSBcInNob3dfa2V5XCIsXG4gICAgS2VlcEl0U2FmZSA9IFwia2VlcF9pdF9zYWZlXCIsXG4gICAgQmFja2luZ1VwID0gXCJiYWNraW5nX3VwXCIsXG4gICAgRG9uZSA9IFwiZG9uZVwiLFxuICAgIE9wdE91dENvbmZpcm0gPSBcIm9wdF9vdXRfY29uZmlybVwiLFxufVxuXG5jb25zdCBQQVNTV09SRF9NSU5fU0NPUkUgPSA0OyAvLyBTbyBzZWN1cmUsIG1hbnkgY2hhcmFjdGVycywgbXVjaCBjb21wbGV4LCB3b3csIGV0YywgZXRjLlxuXG5pbnRlcmZhY2UgSVByb3BzIGV4dGVuZHMgSURpYWxvZ1Byb3BzIHt9XG5cbmludGVyZmFjZSBJU3RhdGUge1xuICAgIHNlY3VyZVNlY3JldFN0b3JhZ2U6IGJvb2xlYW47XG4gICAgcGhhc2U6IFBoYXNlO1xuICAgIHBhc3NQaHJhc2U6IHN0cmluZztcbiAgICBwYXNzUGhyYXNlVmFsaWQ6IGJvb2xlYW47XG4gICAgcGFzc1BocmFzZUNvbmZpcm06IHN0cmluZztcbiAgICBjb3BpZWQ6IGJvb2xlYW47XG4gICAgZG93bmxvYWRlZDogYm9vbGVhbjtcbiAgICBlcnJvcj86IHN0cmluZztcbn1cblxuLypcbiAqIFdhbGtzIHRoZSB1c2VyIHRocm91Z2ggdGhlIHByb2Nlc3Mgb2YgY3JlYXRpbmcgYW4gZTJlIGtleSBiYWNrdXBcbiAqIG9uIHRoZSBzZXJ2ZXIuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENyZWF0ZUtleUJhY2t1cERpYWxvZyBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8SVByb3BzLCBJU3RhdGU+IHtcbiAgICBwcml2YXRlIGtleUJhY2t1cEluZm86IFBpY2s8SVByZXBhcmVkS2V5QmFja3VwVmVyc2lvbiwgXCJyZWNvdmVyeV9rZXlcIiB8IFwiYWxnb3JpdGhtXCIgfCBcImF1dGhfZGF0YVwiPjtcbiAgICBwcml2YXRlIHJlY292ZXJ5S2V5Tm9kZSA9IGNyZWF0ZVJlZjxIVE1MRWxlbWVudD4oKTtcbiAgICBwcml2YXRlIHBhc3NwaHJhc2VGaWVsZCA9IGNyZWF0ZVJlZjxGaWVsZD4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBJUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBzZWN1cmVTZWNyZXRTdG9yYWdlOiBudWxsLFxuICAgICAgICAgICAgcGhhc2U6IFBoYXNlLlBhc3NwaHJhc2UsXG4gICAgICAgICAgICBwYXNzUGhyYXNlOiAnJyxcbiAgICAgICAgICAgIHBhc3NQaHJhc2VWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBwYXNzUGhyYXNlQ29uZmlybTogJycsXG4gICAgICAgICAgICBjb3BpZWQ6IGZhbHNlLFxuICAgICAgICAgICAgZG93bmxvYWRlZDogZmFsc2UsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGNvbXBvbmVudERpZE1vdW50KCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBjbGkgPSBNYXRyaXhDbGllbnRQZWcuZ2V0KCk7XG4gICAgICAgIGNvbnN0IHNlY3VyZVNlY3JldFN0b3JhZ2UgPSBhd2FpdCBjbGkuZG9lc1NlcnZlclN1cHBvcnRVbnN0YWJsZUZlYXR1cmUoXCJvcmcubWF0cml4LmUyZV9jcm9zc19zaWduaW5nXCIpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2VjdXJlU2VjcmV0U3RvcmFnZSB9KTtcblxuICAgICAgICAvLyBJZiB3ZSdyZSB1c2luZyBzZWNyZXQgc3RvcmFnZSwgc2tpcCBhaGVhZCB0byB0aGUgYmFja2luZyB1cCBzdGVwLCBhc1xuICAgICAgICAvLyBgYWNjZXNzU2VjcmV0U3RvcmFnZWAgd2lsbCBoYW5kbGUgcGFzc3BocmFzZXMgYXMgbmVlZGVkLlxuICAgICAgICBpZiAoc2VjdXJlU2VjcmV0U3RvcmFnZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHBoYXNlOiBQaGFzZS5CYWNraW5nVXAgfSk7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUJhY2t1cCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkNvcHlDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgY29uc3Qgc3VjY2Vzc2Z1bCA9IGNvcHlOb2RlKHRoaXMucmVjb3ZlcnlLZXlOb2RlLmN1cnJlbnQpO1xuICAgICAgICBpZiAoc3VjY2Vzc2Z1bCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgY29waWVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBoYXNlOiBQaGFzZS5LZWVwSXRTYWZlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkRvd25sb2FkQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbdGhpcy5rZXlCYWNrdXBJbmZvLnJlY292ZXJ5X2tleV0sIHtcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXMtYXNjaWknLFxuICAgICAgICB9KTtcbiAgICAgICAgRmlsZVNhdmVyLnNhdmVBcyhibG9iLCAnc2VjdXJpdHkta2V5LnR4dCcpO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZG93bmxvYWRlZDogdHJ1ZSxcbiAgICAgICAgICAgIHBoYXNlOiBQaGFzZS5LZWVwSXRTYWZlLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjcmVhdGVCYWNrdXAgPSBhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIGNvbnN0IHsgc2VjdXJlU2VjcmV0U3RvcmFnZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBwaGFzZTogUGhhc2UuQmFja2luZ1VwLFxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgaW5mbztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChzZWN1cmVTZWNyZXRTdG9yYWdlKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgYWNjZXNzU2VjcmV0U3RvcmFnZShhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGluZm8gPSBhd2FpdCBNYXRyaXhDbGllbnRQZWcuZ2V0KCkucHJlcGFyZUtleUJhY2t1cFZlcnNpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsIC8qIHJhbmRvbSBrZXkgKi8sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IHNlY3VyZVNlY3JldFN0b3JhZ2U6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGF3YWl0IE1hdHJpeENsaWVudFBlZy5nZXQoKS5jcmVhdGVLZXlCYWNrdXBWZXJzaW9uKGluZm8pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbmZvID0gYXdhaXQgTWF0cml4Q2xpZW50UGVnLmdldCgpLmNyZWF0ZUtleUJhY2t1cFZlcnNpb24oXG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2V5QmFja3VwSW5mbyxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgTWF0cml4Q2xpZW50UGVnLmdldCgpLnNjaGVkdWxlQWxsR3JvdXBTZXNzaW9uc0ZvckJhY2t1cCgpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgcGhhc2U6IFBoYXNlLkRvbmUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcga2V5IGJhY2t1cFwiLCBlKTtcbiAgICAgICAgICAgIC8vIFRPRE86IElmIGNyZWF0aW5nIGEgdmVyc2lvbiBzdWNjZWVkcywgYnV0IGJhY2t1cCBmYWlscywgc2hvdWxkIHdlXG4gICAgICAgICAgICAvLyBkZWxldGUgdGhlIHZlcnNpb24sIGRpc2FibGUgYmFja3VwLCBvciBkbyBub3RoaW5nPyAgSWYgd2UganVzdFxuICAgICAgICAgICAgLy8gZGlzYWJsZSB3aXRob3V0IGRlbGV0aW5nLCB3ZSdsbCBlbmFibGUgb24gbmV4dCBhcHAgcmVsb2FkIHNpbmNlXG4gICAgICAgICAgICAvLyBpdCBpcyB0cnVzdGVkLlxuICAgICAgICAgICAgaWYgKGluZm8pIHtcbiAgICAgICAgICAgICAgICBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZGVsZXRlS2V5QmFja3VwVmVyc2lvbihpbmZvLnZlcnNpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgZXJyb3I6IGUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIG9uQ2FuY2VsID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLm9uRmluaXNoZWQoZmFsc2UpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uRG9uZSA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKHRydWUpO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU2V0VXBDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHBoYXNlOiBQaGFzZS5QYXNzcGhyYXNlIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU2tpcFBhc3NQaHJhc2VDbGljayA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgdGhpcy5rZXlCYWNrdXBJbmZvID0gYXdhaXQgTWF0cml4Q2xpZW50UGVnLmdldCgpLnByZXBhcmVLZXlCYWNrdXBWZXJzaW9uKCk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgY29waWVkOiBmYWxzZSxcbiAgICAgICAgICAgIGRvd25sb2FkZWQ6IGZhbHNlLFxuICAgICAgICAgICAgcGhhc2U6IFBoYXNlLlNob3dLZXksXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUGFzc1BocmFzZU5leHRDbGljayA9IGFzeW5jIChlOiBSZWFjdC5Gb3JtRXZlbnQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAoIXRoaXMucGFzc3BocmFzZUZpZWxkLmN1cnJlbnQpIHJldHVybjsgLy8gdW5tb3VudGluZ1xuXG4gICAgICAgIGF3YWl0IHRoaXMucGFzc3BocmFzZUZpZWxkLmN1cnJlbnQudmFsaWRhdGUoeyBhbGxvd0VtcHR5OiBmYWxzZSB9KTtcbiAgICAgICAgaWYgKCF0aGlzLnBhc3NwaHJhc2VGaWVsZC5jdXJyZW50LnN0YXRlLnZhbGlkKSB7XG4gICAgICAgICAgICB0aGlzLnBhc3NwaHJhc2VGaWVsZC5jdXJyZW50LmZvY3VzKCk7XG4gICAgICAgICAgICB0aGlzLnBhc3NwaHJhc2VGaWVsZC5jdXJyZW50LnZhbGlkYXRlKHsgYWxsb3dFbXB0eTogZmFsc2UsIGZvY3VzZWQ6IHRydWUgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgcGhhc2U6IFBoYXNlLlBhc3NwaHJhc2VDb25maXJtIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUGFzc1BocmFzZUNvbmZpcm1OZXh0Q2xpY2sgPSBhc3luYyAoZTogUmVhY3QuRm9ybUV2ZW50KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5wYXNzUGhyYXNlICE9PSB0aGlzLnN0YXRlLnBhc3NQaHJhc2VDb25maXJtKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5rZXlCYWNrdXBJbmZvID0gYXdhaXQgTWF0cml4Q2xpZW50UGVnLmdldCgpLnByZXBhcmVLZXlCYWNrdXBWZXJzaW9uKHRoaXMuc3RhdGUucGFzc1BocmFzZSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgY29waWVkOiBmYWxzZSxcbiAgICAgICAgICAgIGRvd25sb2FkZWQ6IGZhbHNlLFxuICAgICAgICAgICAgcGhhc2U6IFBoYXNlLlNob3dLZXksXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uU2V0QWdhaW5DbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBwYXNzUGhyYXNlOiAnJyxcbiAgICAgICAgICAgIHBhc3NQaHJhc2VWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICBwYXNzUGhyYXNlQ29uZmlybTogJycsXG4gICAgICAgICAgICBwaGFzZTogUGhhc2UuUGFzc3BocmFzZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25LZWVwSXRTYWZlQmFja0NsaWNrID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHBoYXNlOiBQaGFzZS5TaG93S2V5LFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBhc3NQaHJhc2VWYWxpZGF0ZSA9IChyZXN1bHQ6IElWYWxpZGF0aW9uUmVzdWx0KTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcGFzc1BocmFzZVZhbGlkOiByZXN1bHQudmFsaWQsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwcml2YXRlIG9uUGFzc1BocmFzZUNoYW5nZSA9IChlOiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50Pik6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHBhc3NQaHJhc2U6IGUudGFyZ2V0LnZhbHVlLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblBhc3NQaHJhc2VDb25maXJtQ2hhbmdlID0gKGU6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KTogdm9pZCA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgcGFzc1BocmFzZUNvbmZpcm06IGUudGFyZ2V0LnZhbHVlLFxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSByZW5kZXJQaGFzZVBhc3NQaHJhc2UoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gPGZvcm0gb25TdWJtaXQ9e3RoaXMub25QYXNzUGhyYXNlTmV4dENsaWNrfT5cbiAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgXCI8Yj5XYXJuaW5nPC9iPjogWW91IHNob3VsZCBvbmx5IHNldCB1cCBrZXkgYmFja3VwIGZyb20gYSB0cnVzdGVkIGNvbXB1dGVyLlwiLCB7fSxcbiAgICAgICAgICAgICAgICB7IGI6IHN1YiA9PiA8Yj57IHN1YiB9PC9iPiB9LFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPHA+eyBfdChcbiAgICAgICAgICAgICAgICBcIldlJ2xsIHN0b3JlIGFuIGVuY3J5cHRlZCBjb3B5IG9mIHlvdXIga2V5cyBvbiBvdXIgc2VydmVyLiBcIiArXG4gICAgICAgICAgICAgICAgXCJTZWN1cmUgeW91ciBiYWNrdXAgd2l0aCBhIFNlY3VyaXR5IFBocmFzZS5cIixcbiAgICAgICAgICAgICkgfTwvcD5cbiAgICAgICAgICAgIDxwPnsgX3QoXCJGb3IgbWF4aW11bSBzZWN1cml0eSwgdGhpcyBzaG91bGQgYmUgZGlmZmVyZW50IGZyb20geW91ciBhY2NvdW50IHBhc3N3b3JkLlwiKSB9PC9wPlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0NyZWF0ZUtleUJhY2t1cERpYWxvZ19wcmltYXJ5Q29udGFpbmVyXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVLZXlCYWNrdXBEaWFsb2dfcGFzc1BocmFzZUNvbnRhaW5lclwiPlxuICAgICAgICAgICAgICAgICAgICA8UGFzc3BocmFzZUZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJteF9DcmVhdGVLZXlCYWNrdXBEaWFsb2dfcGFzc1BocmFzZUlucHV0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uUGFzc1BocmFzZUNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG1pblNjb3JlPXtQQVNTV09SRF9NSU5fU0NPUkV9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5wYXNzUGhyYXNlfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25WYWxpZGF0ZT17dGhpcy5vblBhc3NQaHJhc2VWYWxpZGF0ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkUmVmPXt0aGlzLnBhc3NwaHJhc2VGaWVsZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Gb2N1cz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdGQoXCJFbnRlciBhIFNlY3VyaXR5IFBocmFzZVwiKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsRW50ZXJQYXNzd29yZD17X3RkKFwiRW50ZXIgYSBTZWN1cml0eSBQaHJhc2VcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbFN0cm9uZ1Bhc3N3b3JkPXtfdGQoXCJHcmVhdCEgVGhpcyBTZWN1cml0eSBQaHJhc2UgbG9va3Mgc3Ryb25nIGVub3VnaC5cIil9XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbEFsbG93ZWRCdXRVbnNhZmU9e190ZChcIkdyZWF0ISBUaGlzIFNlY3VyaXR5IFBocmFzZSBsb29rcyBzdHJvbmcgZW5vdWdoLlwiKX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8RGlhbG9nQnV0dG9uc1xuICAgICAgICAgICAgICAgIHByaW1hcnlCdXR0b249e190KCdOZXh0Jyl9XG4gICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMub25QYXNzUGhyYXNlTmV4dENsaWNrfVxuICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17ZmFsc2V9XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9eyF0aGlzLnN0YXRlLnBhc3NQaHJhc2VWYWxpZH1cbiAgICAgICAgICAgIC8+XG5cbiAgICAgICAgICAgIDxkZXRhaWxzPlxuICAgICAgICAgICAgICAgIDxzdW1tYXJ5PnsgX3QoXCJBZHZhbmNlZFwiKSB9PC9zdW1tYXJ5PlxuICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGtpbmQ9J3ByaW1hcnknIG9uQ2xpY2s9e3RoaXMub25Ta2lwUGFzc1BocmFzZUNsaWNrfT5cbiAgICAgICAgICAgICAgICAgICAgeyBfdChcIlNldCB1cCB3aXRoIGEgU2VjdXJpdHkgS2V5XCIpIH1cbiAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICA8L2RldGFpbHM+XG4gICAgICAgIDwvZm9ybT47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJQaGFzZVBhc3NQaHJhc2VDb25maXJtKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgbGV0IG1hdGNoVGV4dDtcbiAgICAgICAgbGV0IGNoYW5nZVRleHQ7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnBhc3NQaHJhc2VDb25maXJtID09PSB0aGlzLnN0YXRlLnBhc3NQaHJhc2UpIHtcbiAgICAgICAgICAgIG1hdGNoVGV4dCA9IF90KFwiVGhhdCBtYXRjaGVzIVwiKTtcbiAgICAgICAgICAgIGNoYW5nZVRleHQgPSBfdChcIlVzZSBhIGRpZmZlcmVudCBwYXNzcGhyYXNlP1wiKTtcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5zdGF0ZS5wYXNzUGhyYXNlLnN0YXJ0c1dpdGgodGhpcy5zdGF0ZS5wYXNzUGhyYXNlQ29uZmlybSkpIHtcbiAgICAgICAgICAgIC8vIG9ubHkgdGVsbCB0aGVtIHRoZXkncmUgd3JvbmcgaWYgdGhleSd2ZSBhY3R1YWxseSBnb25lIHdyb25nLlxuICAgICAgICAgICAgLy8gU2VjdXJpdHkgY29uY2lvdXMgcmVhZGVycyB3aWxsIG5vdGUgdGhhdCBpZiB5b3UgbGVmdCBlbGVtZW50LXdlYiB1bmF0dGVuZGVkXG4gICAgICAgICAgICAvLyBvbiB0aGlzIHNjcmVlbiwgdGhpcyB3b3VsZCBtYWtlIGl0IGVhc3kgZm9yIGEgbWFsaWNpb3VzIHBlcnNvbiB0byBndWVzc1xuICAgICAgICAgICAgLy8geW91ciBwYXNzcGhyYXNlIG9uZSBsZXR0ZXIgYXQgYSB0aW1lLCBidXQgdGhleSBjb3VsZCBnZXQgdGhpcyBmYXN0ZXIgYnlcbiAgICAgICAgICAgIC8vIGp1c3Qgb3BlbmluZyB0aGUgYnJvd3NlcidzIGRldmVsb3BlciB0b29scyBhbmQgcmVhZGluZyBpdC5cbiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBub3QgaGF2aW5nIHR5cGVkIGFueXRoaW5nIGF0IGFsbCB3aWxsIG5vdCBoaXQgdGhpcyBjbGF1c2UgYW5kXG4gICAgICAgICAgICAvLyBmYWxsIHRocm91Z2ggc28gZW1wdHkgYm94ID09PSBubyBoaW50LlxuICAgICAgICAgICAgbWF0Y2hUZXh0ID0gX3QoXCJUaGF0IGRvZXNuJ3QgbWF0Y2guXCIpO1xuICAgICAgICAgICAgY2hhbmdlVGV4dCA9IF90KFwiR28gYmFjayB0byBzZXQgaXQgYWdhaW4uXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHBhc3NQaHJhc2VNYXRjaCA9IG51bGw7XG4gICAgICAgIGlmIChtYXRjaFRleHQpIHtcbiAgICAgICAgICAgIHBhc3NQaHJhc2VNYXRjaCA9IDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlS2V5QmFja3VwRGlhbG9nX3Bhc3NQaHJhc2VNYXRjaFwiPlxuICAgICAgICAgICAgICAgIDxkaXY+eyBtYXRjaFRleHQgfTwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGVsZW1lbnQ9XCJzcGFuXCIgY2xhc3NOYW1lPVwibXhfbGlua0J1dHRvblwiIG9uQ2xpY2s9e3RoaXMub25TZXRBZ2FpbkNsaWNrfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgY2hhbmdlVGV4dCB9XG4gICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gPGZvcm0gb25TdWJtaXQ9e3RoaXMub25QYXNzUGhyYXNlQ29uZmlybU5leHRDbGlja30+XG4gICAgICAgICAgICA8cD57IF90KFxuICAgICAgICAgICAgICAgIFwiRW50ZXIgeW91ciBTZWN1cml0eSBQaHJhc2UgYSBzZWNvbmQgdGltZSB0byBjb25maXJtIGl0LlwiLFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVLZXlCYWNrdXBEaWFsb2dfcHJpbWFyeUNvbnRhaW5lclwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlS2V5QmFja3VwRGlhbG9nX3Bhc3NQaHJhc2VDb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uUGFzc1BocmFzZUNvbmZpcm1DaGFuZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUucGFzc1BocmFzZUNvbmZpcm19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXhfQ3JlYXRlS2V5QmFja3VwRGlhbG9nX3Bhc3NQaHJhc2VJbnB1dFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e190KFwiUmVwZWF0IHlvdXIgU2VjdXJpdHkgUGhyYXNlLi4uXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Gb2N1cz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICB7IHBhc3NQaHJhc2VNYXRjaCB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zXG4gICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbj17X3QoJ05leHQnKX1cbiAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17dGhpcy5vblBhc3NQaHJhc2VDb25maXJtTmV4dENsaWNrfVxuICAgICAgICAgICAgICAgIGhhc0NhbmNlbD17ZmFsc2V9XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMuc3RhdGUucGFzc1BocmFzZSAhPT0gdGhpcy5zdGF0ZS5wYXNzUGhyYXNlQ29uZmlybX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgIDwvZm9ybT47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJQaGFzZVNob3dLZXkoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gPGRpdj5cbiAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgXCJZb3VyIFNlY3VyaXR5IEtleSBpcyBhIHNhZmV0eSBuZXQgLSB5b3UgY2FuIHVzZSBpdCB0byByZXN0b3JlIFwiICtcbiAgICAgICAgICAgICAgICBcImFjY2VzcyB0byB5b3VyIGVuY3J5cHRlZCBtZXNzYWdlcyBpZiB5b3UgZm9yZ2V0IHlvdXIgU2VjdXJpdHkgUGhyYXNlLlwiLFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPHA+eyBfdChcbiAgICAgICAgICAgICAgICBcIktlZXAgYSBjb3B5IG9mIGl0IHNvbWV3aGVyZSBzZWN1cmUsIGxpa2UgYSBwYXNzd29yZCBtYW5hZ2VyIG9yIGV2ZW4gYSBzYWZlLlwiLFxuICAgICAgICAgICAgKSB9PC9wPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVLZXlCYWNrdXBEaWFsb2dfcHJpbWFyeUNvbnRhaW5lclwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfQ3JlYXRlS2V5QmFja3VwRGlhbG9nX3JlY292ZXJ5S2V5SGVhZGVyXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgX3QoXCJZb3VyIFNlY3VyaXR5IEtleVwiKSB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVLZXlCYWNrdXBEaWFsb2dfcmVjb3ZlcnlLZXlDb250YWluZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVLZXlCYWNrdXBEaWFsb2dfcmVjb3ZlcnlLZXlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxjb2RlIHJlZj17dGhpcy5yZWNvdmVyeUtleU5vZGV9PnsgdGhpcy5rZXlCYWNrdXBJbmZvLnJlY292ZXJ5X2tleSB9PC9jb2RlPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9DcmVhdGVLZXlCYWNrdXBEaWFsb2dfcmVjb3ZlcnlLZXlCdXR0b25zXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cIm14X0RpYWxvZ19wcmltYXJ5XCIgb25DbGljaz17dGhpcy5vbkNvcHlDbGlja30+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdChcIkNvcHlcIikgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cIm14X0RpYWxvZ19wcmltYXJ5XCIgb25DbGljaz17dGhpcy5vbkRvd25sb2FkQ2xpY2t9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoXCJEb3dubG9hZFwiKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+O1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyUGhhc2VLZWVwSXRTYWZlKCk6IEpTWC5FbGVtZW50IHtcbiAgICAgICAgbGV0IGludHJvVGV4dDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuY29waWVkKSB7XG4gICAgICAgICAgICBpbnRyb1RleHQgPSBfdChcbiAgICAgICAgICAgICAgICBcIllvdXIgU2VjdXJpdHkgS2V5IGhhcyBiZWVuIDxiPmNvcGllZCB0byB5b3VyIGNsaXBib2FyZDwvYj4sIHBhc3RlIGl0IHRvOlwiLFxuICAgICAgICAgICAgICAgIHt9LCB7IGI6IHMgPT4gPGI+eyBzIH08L2I+IH0sXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUuZG93bmxvYWRlZCkge1xuICAgICAgICAgICAgaW50cm9UZXh0ID0gX3QoXG4gICAgICAgICAgICAgICAgXCJZb3VyIFNlY3VyaXR5IEtleSBpcyBpbiB5b3VyIDxiPkRvd25sb2FkczwvYj4gZm9sZGVyLlwiLFxuICAgICAgICAgICAgICAgIHt9LCB7IGI6IHMgPT4gPGI+eyBzIH08L2I+IH0sXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgeyBpbnRyb1RleHQgfVxuICAgICAgICAgICAgPHVsPlxuICAgICAgICAgICAgICAgIDxsaT57IF90KFwiPGI+UHJpbnQgaXQ8L2I+IGFuZCBzdG9yZSBpdCBzb21ld2hlcmUgc2FmZVwiLCB7fSwgeyBiOiBzID0+IDxiPnsgcyB9PC9iPiB9KSB9PC9saT5cbiAgICAgICAgICAgICAgICA8bGk+eyBfdChcIjxiPlNhdmUgaXQ8L2I+IG9uIGEgVVNCIGtleSBvciBiYWNrdXAgZHJpdmVcIiwge30sIHsgYjogcyA9PiA8Yj57IHMgfTwvYj4gfSkgfTwvbGk+XG4gICAgICAgICAgICAgICAgPGxpPnsgX3QoXCI8Yj5Db3B5IGl0PC9iPiB0byB5b3VyIHBlcnNvbmFsIGNsb3VkIHN0b3JhZ2VcIiwge30sIHsgYjogcyA9PiA8Yj57IHMgfTwvYj4gfSkgfTwvbGk+XG4gICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICAgPERpYWxvZ0J1dHRvbnMgcHJpbWFyeUJ1dHRvbj17X3QoXCJDb250aW51ZVwiKX1cbiAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17dGhpcy5jcmVhdGVCYWNrdXB9XG4gICAgICAgICAgICAgICAgaGFzQ2FuY2VsPXtmYWxzZX0+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXt0aGlzLm9uS2VlcEl0U2FmZUJhY2tDbGlja30+eyBfdChcIkJhY2tcIikgfTwvYnV0dG9uPlxuICAgICAgICAgICAgPC9EaWFsb2dCdXR0b25zPlxuICAgICAgICA8L2Rpdj47XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW5kZXJCdXN5UGhhc2UoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICByZXR1cm4gPGRpdj5cbiAgICAgICAgICAgIDxTcGlubmVyIC8+XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclBoYXNlRG9uZSgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgPHA+eyBfdChcbiAgICAgICAgICAgICAgICBcIllvdXIga2V5cyBhcmUgYmVpbmcgYmFja2VkIHVwICh0aGUgZmlyc3QgYmFja3VwIGNvdWxkIHRha2UgYSBmZXcgbWludXRlcykuXCIsXG4gICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICA8RGlhbG9nQnV0dG9ucyBwcmltYXJ5QnV0dG9uPXtfdCgnT0snKX1cbiAgICAgICAgICAgICAgICBvblByaW1hcnlCdXR0b25DbGljaz17dGhpcy5vbkRvbmV9XG4gICAgICAgICAgICAgICAgaGFzQ2FuY2VsPXtmYWxzZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbmRlclBoYXNlT3B0T3V0Q29uZmlybSgpOiBKU1guRWxlbWVudCB7XG4gICAgICAgIHJldHVybiA8ZGl2PlxuICAgICAgICAgICAgeyBfdChcbiAgICAgICAgICAgICAgICBcIldpdGhvdXQgc2V0dGluZyB1cCBTZWN1cmUgTWVzc2FnZSBSZWNvdmVyeSwgeW91IHdvbid0IGJlIGFibGUgdG8gcmVzdG9yZSB5b3VyIFwiICtcbiAgICAgICAgICAgICAgICBcImVuY3J5cHRlZCBtZXNzYWdlIGhpc3RvcnkgaWYgeW91IGxvZyBvdXQgb3IgdXNlIGFub3RoZXIgc2Vzc2lvbi5cIixcbiAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgPERpYWxvZ0J1dHRvbnMgcHJpbWFyeUJ1dHRvbj17X3QoJ1NldCB1cCBTZWN1cmUgTWVzc2FnZSBSZWNvdmVyeScpfVxuICAgICAgICAgICAgICAgIG9uUHJpbWFyeUJ1dHRvbkNsaWNrPXt0aGlzLm9uU2V0VXBDbGlja31cbiAgICAgICAgICAgICAgICBoYXNDYW5jZWw9e2ZhbHNlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17dGhpcy5vbkNhbmNlbH0+SSB1bmRlcnN0YW5kLCBjb250aW51ZSB3aXRob3V0PC9idXR0b24+XG4gICAgICAgICAgICA8L0RpYWxvZ0J1dHRvbnM+XG4gICAgICAgIDwvZGl2PjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRpdGxlRm9yUGhhc2UocGhhc2U6IFBoYXNlKTogc3RyaW5nIHtcbiAgICAgICAgc3dpdGNoIChwaGFzZSkge1xuICAgICAgICAgICAgY2FzZSBQaGFzZS5QYXNzcGhyYXNlOlxuICAgICAgICAgICAgICAgIHJldHVybiBfdCgnU2VjdXJlIHlvdXIgYmFja3VwIHdpdGggYSBTZWN1cml0eSBQaHJhc2UnKTtcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuUGFzc3BocmFzZUNvbmZpcm06XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90KCdDb25maXJtIHlvdXIgU2VjdXJpdHkgUGhyYXNlJyk7XG4gICAgICAgICAgICBjYXNlIFBoYXNlLk9wdE91dENvbmZpcm06XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90KCdXYXJuaW5nIScpO1xuICAgICAgICAgICAgY2FzZSBQaGFzZS5TaG93S2V5OlxuICAgICAgICAgICAgY2FzZSBQaGFzZS5LZWVwSXRTYWZlOlxuICAgICAgICAgICAgICAgIHJldHVybiBfdCgnTWFrZSBhIGNvcHkgb2YgeW91ciBTZWN1cml0eSBLZXknKTtcbiAgICAgICAgICAgIGNhc2UgUGhhc2UuQmFja2luZ1VwOlxuICAgICAgICAgICAgICAgIHJldHVybiBfdCgnU3RhcnRpbmcgYmFja3VwLi4uJyk7XG4gICAgICAgICAgICBjYXNlIFBoYXNlLkRvbmU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90KCdTdWNjZXNzIScpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gX3QoXCJDcmVhdGUga2V5IGJhY2t1cFwiKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBsZXQgY29udGVudDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnRlbnQgPSA8ZGl2PlxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXCJVbmFibGUgdG8gY3JlYXRlIGtleSBiYWNrdXBcIikgfTwvcD5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0RpYWxvZ19idXR0b25zXCI+XG4gICAgICAgICAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zIHByaW1hcnlCdXR0b249e190KCdSZXRyeScpfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMuY3JlYXRlQmFja3VwfVxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzQ2FuY2VsPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw9e3RoaXMub25DYW5jZWx9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUucGhhc2UpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFBoYXNlLlBhc3NwaHJhc2U6XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLnJlbmRlclBoYXNlUGFzc1BocmFzZSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFBoYXNlLlBhc3NwaHJhc2VDb25maXJtOlxuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy5yZW5kZXJQaGFzZVBhc3NQaHJhc2VDb25maXJtKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgUGhhc2UuU2hvd0tleTpcbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMucmVuZGVyUGhhc2VTaG93S2V5KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgUGhhc2UuS2VlcEl0U2FmZTpcbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMucmVuZGVyUGhhc2VLZWVwSXRTYWZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgUGhhc2UuQmFja2luZ1VwOlxuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy5yZW5kZXJCdXN5UGhhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBQaGFzZS5Eb25lOlxuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy5yZW5kZXJQaGFzZURvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBQaGFzZS5PcHRPdXRDb25maXJtOlxuICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy5yZW5kZXJQaGFzZU9wdE91dENvbmZpcm0oKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEJhc2VEaWFsb2cgY2xhc3NOYW1lPSdteF9DcmVhdGVLZXlCYWNrdXBEaWFsb2cnXG4gICAgICAgICAgICAgICAgb25GaW5pc2hlZD17dGhpcy5wcm9wcy5vbkZpbmlzaGVkfVxuICAgICAgICAgICAgICAgIHRpdGxlPXt0aGlzLnRpdGxlRm9yUGhhc2UodGhpcy5zdGF0ZS5waGFzZSl9XG4gICAgICAgICAgICAgICAgaGFzQ2FuY2VsPXtbUGhhc2UuUGFzc3BocmFzZSwgUGhhc2UuRG9uZV0uaW5jbHVkZXModGhpcy5zdGF0ZS5waGFzZSl9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgeyBjb250ZW50IH1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvQmFzZURpYWxvZz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=