"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _MatrixClientPeg = require("../../../../MatrixClientPeg");

var _dispatcher = _interopRequireDefault(require("../../../../dispatcher/dispatcher"));

var _languageHandler = require("../../../../languageHandler");

var _Modal = _interopRequireDefault(require("../../../../Modal"));

var _RestoreKeyBackupDialog = _interopRequireDefault(require("../../../../components/views/dialogs/security/RestoreKeyBackupDialog"));

var _actions = require("../../../../dispatcher/actions");

var _DialogButtons = _interopRequireDefault(require("../../../../components/views/elements/DialogButtons"));

var _BaseDialog = _interopRequireDefault(require("../../../../components/views/dialogs/BaseDialog"));

/*
Copyright 2018, 2019 New Vector Ltd
Copyright 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class NewRecoveryMethodDialog extends _react.default.PureComponent {
  constructor(...args) {
    super(...args);
    (0, _defineProperty2.default)(this, "onOkClick", () => {
      this.props.onFinished();
    });
    (0, _defineProperty2.default)(this, "onGoToSettingsClick", () => {
      this.props.onFinished();

      _dispatcher.default.fire(_actions.Action.ViewUserSettings);
    });
    (0, _defineProperty2.default)(this, "onSetupClick", async () => {
      _Modal.default.createTrackedDialog('Restore Backup', '', _RestoreKeyBackupDialog.default, {
        onFinished: this.props.onFinished
      }, null,
      /* priority = */
      false,
      /* static = */
      true);
    });
  }

  render() {
    const title = /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_KeyBackupFailedDialog_title"
    }, (0, _languageHandler._t)("New Recovery Method"));

    const newMethodDetected = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("A new Security Phrase and key for Secure Messages have been detected."));

    const hackWarning = /*#__PURE__*/_react.default.createElement("p", {
      className: "warning"
    }, (0, _languageHandler._t)("If you didn't set the new recovery method, an " + "attacker may be trying to access your account. " + "Change your account password and set a new recovery " + "method immediately in Settings."));

    let content;

    if (_MatrixClientPeg.MatrixClientPeg.get().getKeyBackupEnabled()) {
      content = /*#__PURE__*/_react.default.createElement("div", null, newMethodDetected, /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("This session is encrypting history using the new recovery method.")), hackWarning, /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
        primaryButton: (0, _languageHandler._t)("OK"),
        onPrimaryButtonClick: this.onOkClick,
        cancelButton: (0, _languageHandler._t)("Go to Settings"),
        onCancel: this.onGoToSettingsClick
      }));
    } else {
      content = /*#__PURE__*/_react.default.createElement("div", null, newMethodDetected, hackWarning, /*#__PURE__*/_react.default.createElement(_DialogButtons.default, {
        primaryButton: (0, _languageHandler._t)("Set up Secure Messages"),
        onPrimaryButtonClick: this.onSetupClick,
        cancelButton: (0, _languageHandler._t)("Go to Settings"),
        onCancel: this.onGoToSettingsClick
      }));
    }

    return /*#__PURE__*/_react.default.createElement(_BaseDialog.default, {
      className: "mx_KeyBackupFailedDialog",
      onFinished: this.props.onFinished,
      title: title
    }, content);
  }

}

exports.default = NewRecoveryMethodDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9hc3luYy1jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3Mvc2VjdXJpdHkvTmV3UmVjb3ZlcnlNZXRob2REaWFsb2cudHN4Il0sIm5hbWVzIjpbIk5ld1JlY292ZXJ5TWV0aG9kRGlhbG9nIiwiUmVhY3QiLCJQdXJlQ29tcG9uZW50IiwicHJvcHMiLCJvbkZpbmlzaGVkIiwiZGlzIiwiZmlyZSIsIkFjdGlvbiIsIlZpZXdVc2VyU2V0dGluZ3MiLCJNb2RhbCIsImNyZWF0ZVRyYWNrZWREaWFsb2ciLCJSZXN0b3JlS2V5QmFja3VwRGlhbG9nIiwicmVuZGVyIiwidGl0bGUiLCJuZXdNZXRob2REZXRlY3RlZCIsImhhY2tXYXJuaW5nIiwiY29udGVudCIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsImdldEtleUJhY2t1cEVuYWJsZWQiLCJvbk9rQ2xpY2siLCJvbkdvVG9TZXR0aW5nc0NsaWNrIiwib25TZXR1cENsaWNrIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWlCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUExQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFrQmUsTUFBTUEsdUJBQU4sU0FBc0NDLGVBQU1DLGFBQTVDLENBQWtFO0FBQUE7QUFBQTtBQUFBLHFEQUN6RCxNQUFZO0FBQzVCLFdBQUtDLEtBQUwsQ0FBV0MsVUFBWDtBQUNILEtBSDRFO0FBQUEsK0RBSy9DLE1BQVk7QUFDdEMsV0FBS0QsS0FBTCxDQUFXQyxVQUFYOztBQUNBQywwQkFBSUMsSUFBSixDQUFTQyxnQkFBT0MsZ0JBQWhCO0FBQ0gsS0FSNEU7QUFBQSx3REFVdEQsWUFBMkI7QUFDOUNDLHFCQUFNQyxtQkFBTixDQUNJLGdCQURKLEVBQ3NCLEVBRHRCLEVBQzBCQywrQkFEMUIsRUFDa0Q7QUFDMUNQLFFBQUFBLFVBQVUsRUFBRSxLQUFLRCxLQUFMLENBQVdDO0FBRG1CLE9BRGxELEVBR08sSUFIUDtBQUdhO0FBQWlCLFdBSDlCO0FBR3FDO0FBQWUsVUFIcEQ7QUFLSCxLQWhCNEU7QUFBQTs7QUFrQnRFUSxFQUFBQSxNQUFNLEdBQWdCO0FBQ3pCLFVBQU1DLEtBQUssZ0JBQUc7QUFBTSxNQUFBLFNBQVMsRUFBQztBQUFoQixPQUNSLHlCQUFHLHFCQUFILENBRFEsQ0FBZDs7QUFJQSxVQUFNQyxpQkFBaUIsZ0JBQUcsd0NBQUsseUJBQzNCLHVFQUQyQixDQUFMLENBQTFCOztBQUlBLFVBQU1DLFdBQVcsZ0JBQUc7QUFBRyxNQUFBLFNBQVMsRUFBQztBQUFiLE9BQXlCLHlCQUN6QyxtREFDQSxpREFEQSxHQUVBLHNEQUZBLEdBR0EsaUNBSnlDLENBQXpCLENBQXBCOztBQU9BLFFBQUlDLE9BQUo7O0FBQ0EsUUFBSUMsaUNBQWdCQyxHQUFoQixHQUFzQkMsbUJBQXRCLEVBQUosRUFBaUQ7QUFDN0NILE1BQUFBLE9BQU8sZ0JBQUcsMENBQ0pGLGlCQURJLGVBRU4sd0NBQUsseUJBQ0QsbUVBREMsQ0FBTCxDQUZNLEVBS0pDLFdBTEksZUFNTiw2QkFBQyxzQkFBRDtBQUNJLFFBQUEsYUFBYSxFQUFFLHlCQUFHLElBQUgsQ0FEbkI7QUFFSSxRQUFBLG9CQUFvQixFQUFFLEtBQUtLLFNBRi9CO0FBR0ksUUFBQSxZQUFZLEVBQUUseUJBQUcsZ0JBQUgsQ0FIbEI7QUFJSSxRQUFBLFFBQVEsRUFBRSxLQUFLQztBQUpuQixRQU5NLENBQVY7QUFhSCxLQWRELE1BY087QUFDSEwsTUFBQUEsT0FBTyxnQkFBRywwQ0FDSkYsaUJBREksRUFFSkMsV0FGSSxlQUdOLDZCQUFDLHNCQUFEO0FBQ0ksUUFBQSxhQUFhLEVBQUUseUJBQUcsd0JBQUgsQ0FEbkI7QUFFSSxRQUFBLG9CQUFvQixFQUFFLEtBQUtPLFlBRi9CO0FBR0ksUUFBQSxZQUFZLEVBQUUseUJBQUcsZ0JBQUgsQ0FIbEI7QUFJSSxRQUFBLFFBQVEsRUFBRSxLQUFLRDtBQUpuQixRQUhNLENBQVY7QUFVSDs7QUFFRCx3QkFDSSw2QkFBQyxtQkFBRDtBQUFZLE1BQUEsU0FBUyxFQUFDLDBCQUF0QjtBQUNJLE1BQUEsVUFBVSxFQUFFLEtBQUtsQixLQUFMLENBQVdDLFVBRDNCO0FBRUksTUFBQSxLQUFLLEVBQUVTO0FBRlgsT0FJTUcsT0FKTixDQURKO0FBUUg7O0FBdEU0RSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOCwgMjAxOSBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMjAgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBNYXRyaXhDbGllbnRQZWcgfSBmcm9tICcuLi8uLi8uLi8uLi9NYXRyaXhDbGllbnRQZWcnO1xuaW1wb3J0IGRpcyBmcm9tIFwiLi4vLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyXCI7XG5pbXBvcnQgeyBfdCB9IGZyb20gXCIuLi8uLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXJcIjtcbmltcG9ydCBNb2RhbCBmcm9tIFwiLi4vLi4vLi4vLi4vTW9kYWxcIjtcbmltcG9ydCBSZXN0b3JlS2V5QmFja3VwRGlhbG9nIGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3Mvc2VjdXJpdHkvUmVzdG9yZUtleUJhY2t1cERpYWxvZ1wiO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSBcIi4uLy4uLy4uLy4uL2Rpc3BhdGNoZXIvYWN0aW9uc1wiO1xuaW1wb3J0IHsgSURpYWxvZ1Byb3BzIH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvdmlld3MvZGlhbG9ncy9JRGlhbG9nUHJvcHNcIjtcbmltcG9ydCBEaWFsb2dCdXR0b25zIGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2VsZW1lbnRzL0RpYWxvZ0J1dHRvbnNcIjtcbmltcG9ydCBCYXNlRGlhbG9nIGZyb20gXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvQmFzZURpYWxvZ1wiO1xuaW1wb3J0IHsgSUtleUJhY2t1cEluZm8gfSBmcm9tIFwibWF0cml4LWpzLXNkay9zcmMvY3J5cHRvL2tleWJhY2t1cFwiO1xuXG5pbnRlcmZhY2UgSVByb3BzIGV4dGVuZHMgSURpYWxvZ1Byb3BzIHtcbiAgICBuZXdWZXJzaW9uSW5mbzogSUtleUJhY2t1cEluZm87XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE5ld1JlY292ZXJ5TWV0aG9kRGlhbG9nIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxJUHJvcHM+IHtcbiAgICBwcml2YXRlIG9uT2tDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgb25Hb1RvU2V0dGluZ3NDbGljayA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbmlzaGVkKCk7XG4gICAgICAgIGRpcy5maXJlKEFjdGlvbi5WaWV3VXNlclNldHRpbmdzKTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvblNldHVwQ2xpY2sgPSBhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgICAgIE1vZGFsLmNyZWF0ZVRyYWNrZWREaWFsb2coXG4gICAgICAgICAgICAnUmVzdG9yZSBCYWNrdXAnLCAnJywgUmVzdG9yZUtleUJhY2t1cERpYWxvZywge1xuICAgICAgICAgICAgICAgIG9uRmluaXNoZWQ6IHRoaXMucHJvcHMub25GaW5pc2hlZCxcbiAgICAgICAgICAgIH0sIG51bGwsIC8qIHByaW9yaXR5ID0gKi8gZmFsc2UsIC8qIHN0YXRpYyA9ICovIHRydWUsXG4gICAgICAgICk7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBjb25zdCB0aXRsZSA9IDxzcGFuIGNsYXNzTmFtZT1cIm14X0tleUJhY2t1cEZhaWxlZERpYWxvZ190aXRsZVwiPlxuICAgICAgICAgICAgeyBfdChcIk5ldyBSZWNvdmVyeSBNZXRob2RcIikgfVxuICAgICAgICA8L3NwYW4+O1xuXG4gICAgICAgIGNvbnN0IG5ld01ldGhvZERldGVjdGVkID0gPHA+eyBfdChcbiAgICAgICAgICAgIFwiQSBuZXcgU2VjdXJpdHkgUGhyYXNlIGFuZCBrZXkgZm9yIFNlY3VyZSBNZXNzYWdlcyBoYXZlIGJlZW4gZGV0ZWN0ZWQuXCIsXG4gICAgICAgICkgfTwvcD47XG5cbiAgICAgICAgY29uc3QgaGFja1dhcm5pbmcgPSA8cCBjbGFzc05hbWU9XCJ3YXJuaW5nXCI+eyBfdChcbiAgICAgICAgICAgIFwiSWYgeW91IGRpZG4ndCBzZXQgdGhlIG5ldyByZWNvdmVyeSBtZXRob2QsIGFuIFwiICtcbiAgICAgICAgICAgIFwiYXR0YWNrZXIgbWF5IGJlIHRyeWluZyB0byBhY2Nlc3MgeW91ciBhY2NvdW50LiBcIiArXG4gICAgICAgICAgICBcIkNoYW5nZSB5b3VyIGFjY291bnQgcGFzc3dvcmQgYW5kIHNldCBhIG5ldyByZWNvdmVyeSBcIiArXG4gICAgICAgICAgICBcIm1ldGhvZCBpbW1lZGlhdGVseSBpbiBTZXR0aW5ncy5cIixcbiAgICAgICAgKSB9PC9wPjtcblxuICAgICAgICBsZXQgY29udGVudDtcbiAgICAgICAgaWYgKE1hdHJpeENsaWVudFBlZy5nZXQoKS5nZXRLZXlCYWNrdXBFbmFibGVkKCkpIHtcbiAgICAgICAgICAgIGNvbnRlbnQgPSA8ZGl2PlxuICAgICAgICAgICAgICAgIHsgbmV3TWV0aG9kRGV0ZWN0ZWQgfVxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXG4gICAgICAgICAgICAgICAgICAgIFwiVGhpcyBzZXNzaW9uIGlzIGVuY3J5cHRpbmcgaGlzdG9yeSB1c2luZyB0aGUgbmV3IHJlY292ZXJ5IG1ldGhvZC5cIixcbiAgICAgICAgICAgICAgICApIH08L3A+XG4gICAgICAgICAgICAgICAgeyBoYWNrV2FybmluZyB9XG4gICAgICAgICAgICAgICAgPERpYWxvZ0J1dHRvbnNcbiAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbj17X3QoXCJPS1wiKX1cbiAgICAgICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMub25Pa0NsaWNrfVxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b249e190KFwiR28gdG8gU2V0dGluZ3NcIil9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsPXt0aGlzLm9uR29Ub1NldHRpbmdzQ2xpY2t9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRlbnQgPSA8ZGl2PlxuICAgICAgICAgICAgICAgIHsgbmV3TWV0aG9kRGV0ZWN0ZWQgfVxuICAgICAgICAgICAgICAgIHsgaGFja1dhcm5pbmcgfVxuICAgICAgICAgICAgICAgIDxEaWFsb2dCdXR0b25zXG4gICAgICAgICAgICAgICAgICAgIHByaW1hcnlCdXR0b249e190KFwiU2V0IHVwIFNlY3VyZSBNZXNzYWdlc1wiKX1cbiAgICAgICAgICAgICAgICAgICAgb25QcmltYXJ5QnV0dG9uQ2xpY2s9e3RoaXMub25TZXR1cENsaWNrfVxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b249e190KFwiR28gdG8gU2V0dGluZ3NcIil9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsPXt0aGlzLm9uR29Ub1NldHRpbmdzQ2xpY2t9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QmFzZURpYWxvZyBjbGFzc05hbWU9XCJteF9LZXlCYWNrdXBGYWlsZWREaWFsb2dcIlxuICAgICAgICAgICAgICAgIG9uRmluaXNoZWQ9e3RoaXMucHJvcHMub25GaW5pc2hlZH1cbiAgICAgICAgICAgICAgICB0aXRsZT17dGl0bGV9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgeyBjb250ZW50IH1cbiAgICAgICAgICAgIDwvQmFzZURpYWxvZz5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=